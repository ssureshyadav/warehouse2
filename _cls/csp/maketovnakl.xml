<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.maketovnakl">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62174,50987.252796</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load();"" onkeypress=""ManageWindow();"">"
	Write !,"<form name=""myform"" id=""myform"">"
	Write !,..InsertHiddenFields(""),!
	Write !,"<b><center>Формирование товарной накладной</center></b>",!
	Write "<table>",!
	Write "<tr><td>Номер товарной накладной</td><td>"
	Write "<input type=""text"" name=""nomnakl"" id=""nomnakl"">"
	Write "</td></tr>",!
	Write "<tr><td>Дата документа</td><td>"
	Write "<div onclick=""OpenCalendar(this)"" name=""Dat"" id=""Dat"" style=""border:solid 1 grey;width:150px;cursor:hand"">"
	Write "</div>"
	Write "</td></tr>",!
	Write "<tr><td>Грузоотправитель</td><td><SKLAD2:table id=""PropTable1"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp1Complite()""/></td></tr>",!
	Write "<tr><td>Грузополучатель</td><td><SKLAD2:table id=""PropTable2"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp24Complite()""/></td></tr>",!
	Write "<tr><td>Поставщик</td><td><SKLAD2:table id=""PropTable3"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp3Complite()""/></td></tr>",!
	Write "<tr><td>Плательщик</td><td><SKLAD2:table id=""PropTable4"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp24Complite()""/></td></tr>",!
	Write "<tr>",!
	Write "	<td>НДС включён в цену товара</td><td> "
	Write "<input type=""checkbox"" name=""NDSinside"" id=""NDSinside"" CHECKED>"
	Write "</td>",!
	Write "</tr>",!
	Write "<!-- <tr><td>Рассчитывать рублёвую сумму на дату документа</td><td> <input type=""checkbox"" name=""KursFromDoc"" id=""KursFromDoc"" CHECKED ></td></tr> -->"
	Write !,"</table>",!
	Write "<center><br>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun();"" TITLE=""""><center>Да</center></span>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.close()"" TITLE=""""><center>Отмена</center></span>"
	Write "</center>",!
	Write "</form>"
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s docid=%request.Get("docid")
	s class=%request.Get("class")
	s doc=##class(Docs.Rash).%OpenId(docid)
	d:$ISOBJECT(doc)
	. s docname=doc.Name
	. s DocDate=$ZD(doc.Dat,4)
	. s KontrID=doc.Kontr.%Id()
	. s KontrName=$ZCVT(doc.Kontr.Name,"O","JS")
	// Грузоотправитель
	s GruzootpravitelID=%request.GetCookie("GruzootpravitelID")
	d:GruzootpravitelID'=""
	. s GruzootpravitelObj=##class(Common.Kontragent).%OpenId(GruzootpravitelID)
	. q:'$ISOBJECT(GruzootpravitelObj)
	. s GruzootpravitelName=$ZCVT(GruzootpravitelObj.Name,"O","JS")
	// Грузоотправитель
	s PostavchikID=%request.GetCookie("PostavchikID")
	d:PostavchikID'=""
	. s PostavchikObj=##class(Common.Kontragent).%OpenId(PostavchikID)
	. q:'$ISOBJECT(PostavchikObj)
	. s PostavchikName=$ZCVT(PostavchikObj.Name,"O","JS")
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<title>"_($G(%session.Data("systemname")))_"</title>",!
	Write "<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""Jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<script language=""JScript"">"
	Write !,"var sessionid="""_(%session.SessionId)_""";",!
	Write "var docid="""_($G(docid))_""";",!
	Write "var clas="""_($G(class))_""";",!
	Write "var KontrID="""_($G(KontrID))_""";",!
	Write "var KontrName="""_($G(KontrName))_""";",!
	Write "var DocDate="""_($G(DocDate))_""";",!
	Write "var GruzootpravitelID="""_($G(GruzootpravitelID))_""";",!
	Write "var GruzootpravitelName="""_($G(GruzootpravitelName))_""";",!
	Write "var PostavchikID="""_($G(PostavchikID))_""";",!
	Write "var PostavchikName="""_($G(PostavchikName))_""";",!
	Write !,"window.dialogHeight='350px';",!
	Write !,"function startFun(){",!
	Write "var k1=PropTable1.item(""Kontr"")",!
	Write "var k2=PropTable2.item(""Kontr"")",!
	Write "var k3=PropTable3.item(""Kontr"")",!
	Write "var k4=PropTable4.item(""Kontr"")",!
	Write "SetCookie(""GruzootpravitelID"",k1);",!
	Write "SetCookie(""PostavchikID"",k3);",!
	Write "var nomnakl=document.myform.nomnakl.value",!
	Write "if(k1==""""){alert(""Не заполнено поле Грузоотправитель"");return}",!
	Write "if(k2==""""){alert(""Не заполнено поле Грузополучатель"");return}",!
	Write "if(k3==""""){alert(""Не заполнено поле Поставщик"");return}",!
	Write "if(k4==""""){alert(""Не заполнено поле Плательщик"");return}",!
	Write "if(nomnakl==""""){alert(""Не заполнен номер товарной накладной"");return}",!
	Write "window.open(""print.csp?id=""+docid+""&class=""+clas+""&kontr=""+k1+""&kontr2=""+k2+""&kontr3=""+k3+""&kontr4=""+k4+""&nomernakl=""+nomnakl+""&NDSinside=""+document.all.NDSinside.checked+""&DocDate=""+Dat.innerText+""&sessionid=""+sessionid)",!
	Write "}",!
	Write !,"function load(){",!
	Write "Dat.innerText=DocDate;",!
	Write "PropTable1.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "PropTable2.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "PropTable3.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "PropTable4.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "document.myform.nomnakl.value='"_(docname)_"'",!
	Write "}",!
	Write !,"function OpenCalendar(InputObj){",!
	Write "var newDate=window.showModalDialog(""calendar.csp"","""",""center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;"");",!
	Write "if(ReturnSpace(newDate)!=""""){InputObj.innerText=newDate;}",!
	Write "}",!
	Write !,"function LoadProp24Complite(){",!
	Write "	PropTable2.setCellValue(""Kontr"",KontrName,KontrID);",!
	Write "	PropTable4.setCellValue(""Kontr"",KontrName,KontrID);",!
	Write !,"}",!
	Write !,"function LoadProp1Complite(){",!
	Write "	if(GruzootpravitelID!="""")",!
	Write "	{",!
	Write "	PropTable1.setCellValue(""Kontr"",GruzootpravitelName,GruzootpravitelID);",!
	Write "	}",!
	Write "}",!
	Write !,"function LoadProp3Complite(){",!
	Write "	if(PostavchikID!="""")",!
	Write "	{",!
	Write "	PropTable3.setCellValue(""Kontr"",PostavchikName,PostavchikID);",!
	Write "	}",!
	Write "}",!
	Write "</script>"
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLAD2>"
	Write !,"<IMPORT NAMESPACE=""SKLAD2"" IMPLEMENTATION=""htc/table.htc"" >",!
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\maketovnakl.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/maketovnakl.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61696,48612</Default>
</Parameter>
</Class>
</Export>

<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.login">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62301,49203.077509</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""onload()"" onkeypress=""ManageWindow(this)"">"
	Write !,"<TABLE cellSpacing=0 width=""100%"" celpadding=""0"" >",!
	Write !,"<TR>",!
	Write "<TD align=center style=""BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid"" colspan=2><strong>Регистрация</strong></TD></tr>",!
	Write "<tr><td colspan=2 align=right><br><br></td></tr>",!
	Write "<form name=""forma"" id=""forma"">"
	Write !,..InsertHiddenFields(""),!
	Write "<input type=""hidden"" id=""SystemDrive"" name=""SystemDrive"">"
	Write !,"<tr><td width=50%>"
	Write "<img src=""images/brace.gif"" width=200px height=1>"
	Write "Склад:</td><td width=50%>",!
	Write "<select style=""width:150px"" name=""depot"">"
	Write !
	w ##class(Docs.Action2).GetClassValuesOptions(,"Store.Depot",,,0)
	Write !,"</select>"
	Write !,"</td></tr>",!
	Write "<tr><td width=50% valign=right>"
	Write "<img src=""images/brace.gif"" width=200px height=1>"
	Write "Имя пользователя:</td><td width=50%>"
	Write "<input type=""text"" name=""user"" value="_($G(%session.Data("login"))),">"
	Write "</td></tr>",!
	Write "<tr><td width=50%>"
	Write "<img src=""images/brace.gif"" width=200px height=1>"
	Write "Пароль:</td><td width=50%>"
	Write "<input type=""password"" name=""password"" value="_($G(%session.Data("passworders"))),">"
	Write "</td></tr>",!
	Write "<tr><td colspan=2 align=center>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun()"" TITLE=""""><center>ok</center></span>"
	Write "</td></tr>",!
	Write "</form>"
	Write !,"</TABLE>",!
	Write !,"<span id=""MustExist"" name=""MustExist"" style=""display:none"">"
	Write !
	//Здесь лежат названия файлов которые должны быть на локальном диске
	s i="" f  s i=$O(^MustExist(i)) q:i=""  d
	. w i_"/"
	Write !,"</span>"
	Write !
	If '(login=7) Goto %csp00001 ;{
	Write !,"	"
	Write "<input type=""text"" id=""edtText"" style=""width:300px"">"
	Write !,"<input type=""button"" value=""test"" onclick=""alert(eval(edtText.value));"">"
	Write !
%csp00001	;}
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !
	s user=$G(%request.Data("user",1))
	s useres="" s ^passworders=""
	s password=$G(%request.Data("password",1))
	s depot=$G(%request.Data("depot",1))
	s SystDisk=$G(%request.Data("SystemDrive",1))
	s result=""
	i $D(%request.Data("user",1)) d
	. s:%request.IsDefinedCgiEnv("REMOTE_ADDR") REMOTEADDR=%request.GetCgiEnv("REMOTE_ADDR")
	. s LoginRight=##class(Common.Rights).login(user,password,depot,SystDisk,$G(REMOTEADDR))
	. i +$G(LoginRight) d
	. . s result="hui();"
	. e  s result="alert('"_LoginRight_"');"_result
	s login=$G(%session.Data("user"))
	Write !,"<script language=""jscript"">"
	Write !," function startFun()",!
	Write " {",!
	Write "	forma.submit();",!
	Write " }",!
	Write "		 ",!
	Write "function onload(){",!
	Write (result),!
	Write "}",!
	Write !,"function hui()",!
	Write "{",!
	Write "	frameElement.document.all.MainFrameSet.rows=""37px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,*,20px"";",!
	Write "	frameElement.document.all.statusFR.src='status.csp';",!
	Write "	frameElement.document.all.topFR.src='toolbar.csp';",!
	Write "	frameElement.document.all.goods.src=""goods.csp"";",!
	Write "	frameElement.document.all.docs.src=""docs.csp"";",!
	Write "	frameElement.document.all.dicts.src=""dicts.csp"";",!
	Write "	frameElement.document.all.store.src=""store.csp"";",!
	Write "	frameElement.document.all.tuneup.src=""tuneup.csp"";",!
	Write "	frameElement.document.all.chief.src=""chief.csp"";",!
	Write "	frameElement.document.all.emplight.src=""emplight.csp"";",!
	Write "	frameElement.document.all.analyzis.src=""analyzis.csp"";",!
	Write "	frameElement.document.all.kontr.src=""kontr.csp"";",!
	Write "	frameElement.document.all.finance.src=""finance.csp"";",!
	Write "	frameElement.document.all.director.src=""director.csp"";",!
	Write "}",!
	Write !,"</script>"
	Write !,"<script language=""jscript"" src=""common.js"">"
	Write "</script>"
	Write !,!,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\login.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/login.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>62046,62829</Default>
</Parameter>
</Class>
</Export>

<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.pricegroups">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62107,82453.573248</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load()"">"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,!,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.location.href='goods.csp'"" TITLE=""""><center>Назад</center></span>"
	Write "<br>",!
	Write "<TABLE cellSpacing=0 width=""100%"" celpadding=""0"" >",!
	Write "<TR>",!
	Write "	<TD align=center style=""BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid"" colspan=3><strong>Ценовые группы товаров</strong></TD>",!
	Write "</TR>",!
	Write "</table>",!
	Write "<table border=0 width=100% id=""maintable"">",!
	Write "<tr >",!
	Write "<td width=30% valign=top>",!
	Write "	<fieldset ><legend>Группы</legend>",!
	Write "		"
	Write "<span id=""namfld"">"
	Write "</span>"
	Write "&nbsp;"
	Write "<input type=""text"" id=""fldval"" onkeyup=""gg();"">"
	Write !,"		"
	Write "<select onchange=""ShowPriceGroups('Razdel='+cmbCurrentRazdel.value)"" id=""cmbCurrentRazdel"">"
	Write !,"			"
	w ##class(Docs.Action2).GetDisplaylistOptions(,"Common.Dictionary12||Razdel")
	Write !,"		"
	Write "</select>"
	Write !,"		<br>",!
	Write "		<SKLADList:listview ClassName=""Common.Dictionary12"" width=100% height=300 id=""currentdict"" zonDblClick=""EditPriceGroup(currentdict.ItemID);"" zonColumnClick=""colclick()"" zClick=""showgoods('izdelie='+currentdict.ItemID)"" onAddColumns=""ShowPriceGroups()""/>",!
	Write "		<br>",!
	Write "  		"
	Write !,"<img src=""images/new.gif"" onmouseover=""newrec.src='images/Onnew.gif'"" onmouseout=""newrec.src='images/new.gif'""  id=""newrec"" name=""newrec"" alt=""Создать ценовую группу"" onclick=""AddPriceGroup()"" style="""">"
	Write !,"  		"
	Write !,"<img src=""images/edit.gif"" onmouseover=""editrec.src='images/Onedit.gif'"" onmouseout=""editrec.src='images/edit.gif'""  id=""editrec"" name=""editrec"" alt=""Редактировать название ценовой группы"" onclick=""EditPriceGroup(currentdict.ItemID)"" style="""">"
	Write !,"  		"
	Write !,"<img src=""images/change.gif"" onmouseover=""changerec.src='images/Onchange.gif'"" onmouseout=""changerec.src='images/change.gif'""  id=""changerec"" name=""changerec"" alt=""Переместить ценовую группу в другой раздел"" onclick=""MovePriceGroup(currentdict.ItemID)"" style="""">"
	Write !,"  		"
	Write !,"<img src=""images/del.gif"" onmouseover=""delrec.src='images/Ondel.gif'"" onmouseout=""delrec.src='images/del.gif'""  id=""delrec"" name=""delrec"" alt=""Удалить ценовую группу"" onclick=""DeletePriceGroup(currentdict.ItemID)"" style="""">"
	Write "  ",!
	Write "	</fieldset>",!
	Write "</td>",!
	Write "<td width=70% valign=top>",!
	Write "	<fieldset ><legend>Товары в выбранной группе</legend>",!
	Write "		"
	Write "<span id=""namfld2"">"
	Write "</span>"
	Write "&nbsp;"
	Write "<input type=""text"" id=""fldval2"" onkeyup=""gg2();"">"
	Write !,"		<br>",!
	Write "		<SKLADList:listview ClassName=""Goods.Goods"" width=100% height=300 id=""Goods"" zonDblClick=""OpenCard();"" zonColumnClick=""colclick2()""/><br>",!
	Write "  		"
	Write !,"<img src=""images/new+.gif"" onmouseover=""new1.src='images/Onnew+.gif'"" onmouseout=""new1.src='images/new+.gif'""  id=""new1"" name=""new1"" alt=""Добавить товары в группу"" onclick=""AddGoodsToGroup()"" style="""">"
	Write !,"  		"
	Write !,"<img src=""images/del.gif"" onmouseover=""delrec1.src='images/Ondel.gif'"" onmouseout=""delrec1.src='images/del.gif'""  id=""delrec1"" name=""delrec1"" alt=""Убрать товары из группы"" onclick=""RemoveGoodsFromGroup()"" style="""">"
	Write "  ",!
	Write "  	</fieldset>",!
	Write "</td>",!
	Write "</table>",!
	Write "<!--",!
	Write "		Отсюда идёт блок где расположены контролы для отбора товара из группы или по параметрам",!
	Write "-->"
	Write !,"<span id=""AddTovarBlock"" style=""display:none"">"
	Write !,"<table width=100% border=0>",!
	Write "<tr ><td width=50% valign=""top"">",!
	Write "<fieldset><legend>Отбор из группы</legend>",!
	Write "Классификатор:"
	Write "<select id=""Catalogues"" onchange=""LoadTree()"" style=""behavior:url('#default#download');"">"
	Write "</select>"
	Write "<br>",!
	Write "  <SKLADz:treeview id=""GroupsTree"" width=""200"" height=170 ImagesPath="""_(%session.Data("ImagesPath"))_""" zonClick=""GroupsTreeClick();"" onDownloadCmpl=""LoadPropTree()"" />",!
	Write "  <br>",!
	Write "  "
	Write "<input type=""button"" id=""SelectWholeGroup"" value=""выбрать всю ветку"" onclick=""AddFromWholeGroup()"">"
	Write !," </fieldset>",!
	Write "</td>",!
	Write "<td width=50% valign=""top"">",!
	Write !,"<fieldset><legend>Отбор по параметрам</legend>",!
	Write "<table><tr><td valign=top>",!
	Write "<SKLAD2:table id=""PropTable"" width=220 height=200 zonTableClick=""TableClick()"" DisplaySecondCol=""none"" />",!
	Write "</td>",!
	Write "<td valign=top>",!
	Write "  <SKLADz:treeview id=""PropsTree"" width=200 height=130 ShowImages=0 ImagesPath="""_(%session.Data("ImagesPath"))_""" zonClick=""PropsTreeClick()"" />",!
	Write "</td></tr>",!
	Write "<tr><td width=100% colspan=2 align=center>",!
	Write "	"
	Write "<span id=""Pname"">"
	Write "</span>"
	Write "&nbsp;&nbsp;",!
	Write "	"
	Write "<select id=""Pequal"">"
	Write !,"		"
	Write "<option value=""="">"
	Write "=</option>",!
	Write "		"
	Write "<option value=""<>"">"
	Write "&#8800;</option>",!
	Write "		"
	Write "<option value=""<"">"
	Write "&lt;</option>",!
	Write "		"
	Write "<option value=""<="">"
	Write "&lt;=</option>",!
	Write "		"
	Write "<option value="">"">"
	Write "&gt;</option>",!
	Write "		"
	Write "<option value="">="">"
	Write "&gt;=</option>",!
	Write "	"
	Write "</select>"
	Write "&nbsp;&nbsp;",!
	Write "	"
	Write "<span id=""Pvalue"" style=""background:#ddffff;width:150px;border:dotted 1 gray"">"
	Write "&nbsp;&nbsp;&nbsp;"
	Write "</span>"
	Write "</td>",!
	Write "</tr>",!
	Write "<tr><td colspan=2>",!
	Write "	<center>",!
	Write "	"
	Write "<input type=""button"" value=""И"" id=""Pand"" onclick=""dork('AND')"" style=""width:50px"">"
	Write !,"	"
	Write "<input type=""button"" value=""ИЛИ"" id=""Por"" onclick=""dork('OR')"" style=""width:50px"">"
	Write !,"<img src=""images/del.gif"" onmouseover=""Clear.src='images/Ondel.gif'"" onmouseout=""Clear.src='images/del.gif'""  id=""Clear"" name=""Clear"" alt=""Очистить поле 'Параметры'"" onclick=""ClearSelect();"" style="""">"
	Write "</center>",!
	Write "<fieldset><legend>Параметры отбора</legend>",!
	Write "&nbsp;"
	Write "<span id=""Express"" style=""font:Arial 13;color:#000033"">"
	Write "</span>"
	Write !,"</fieldset>",!
	Write "</td></tr>",!
	Write "<tr><td colspan=2 align=""center"">",!
	Write "		"
	Write "<input type=""button"" onclick=""AddFromSelect()"" value=""Выбрать товары"">"
	Write !,"		"
	Write "<input type=""checkbox"" id=""ThisGroupOnly"" style=""border:0;width:20px"">"
	Write " только в группе "
	Write "<span id=""CurrentGroupName"">"
	Write "</span>"
	Write !,"	</td>",!
	Write "	</tr>",!
	Write "</table>",!
	Write "</fieldset>",!
	Write "</td>",!
	Write "</tr>",!
	Write "<tr><td valign=""top""  colspan=2>",!
	Write "<fieldset id=""SelectedGoods""><legend>Выбранные товары</legend>",!
	Write " 	<SKLADList:listview width=100% height=130 id=""TempGoods""  ClassName=""Goods.Goods"" AddOnClear=""false"" zonDblClick=""startFun();""  AddHeaders=""true""/><br>",!
	Write !,"<img src=""images/del.gif"" onmouseover=""addrtrr.src='images/Ondel.gif'"" onmouseout=""addrtrr.src='images/del.gif'""  id=""addrtrr"" name=""addrtrr"" alt=""Убрать выделенные товары из списка"" onclick=""TempGoods.DelItems()"" style="""">"
	Write !,!,"<img src=""images/down.gif"" onmouseover=""CopyGoodsAnotherTable_Btn.src='images/Ondown.gif'"" onmouseout=""CopyGoodsAnotherTable_Btn.src='images/down.gif'""  id=""CopyGoodsAnotherTable_Btn"" name=""CopyGoodsAnotherTable_Btn"" alt=""Отобрать товары для документа"" onclick=""CopyGoodsAnotherTable_Fn()"" style=""display:none"">"
	Write !,"<br>"
	Write "<input type=""checkbox"" id=""TurnOnGoodsForDoc_checkbox"" onclick=""TurnOnGoodsForDoc()"" style=""width:15;border:none"">"
	Write " Включить промежуточную таблицу для выбранных товаров",!
	Write "</fieldset>",!
	Write "</td></tr>",!
	Write "<tr id=""GoodsForDoc_TR"" style=""display:none"">",!
	Write "	<td colspan=2><SKLADList:listview width=100% height=130 id=""GoodsForDoc""  ClassName=""Goods.Goods"" AddOnClear=""false"" zonDblClick=""startFun();""  AddHeaders=""true""/><br>",!
	Write !,"<img src=""images/del.gif"" onmouseover=""RemoveGoodsForDoc_Button.src='images/Ondel.gif'"" onmouseout=""RemoveGoodsForDoc_Button.src='images/del.gif'""  id=""RemoveGoodsForDoc_Button"" name=""RemoveGoodsForDoc_Button"" alt=""Убрать выделенные товары из списка"" onclick=""GoodsForDoc.DelItems()"" style="""">"
	Write !,"</tr>",!
	Write "<tr><td valign=bottom  colspan=2>",!
	Write "<center>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;width:200"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun();"" TITLE=""""><center>Добавить выбранные товары</center></span>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""CloseSelectBlock()"" TITLE=""""><center>Отмена</center></span>"
	Write "</center>",!
	Write "</td></tr>",!
	Write "</table>",!
	Write "</span>"
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !,!
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<title>	Cache Server Page </title>",!
	Write "<script language=""javascript"">"
	Write !,"var CurrentProperty;",!
	Write "var Objvalue;",!
	Write "var InCard=false;",!
	Write "var FromTable="""";",!
	Write "var FromTree="""";",!
	Write "var Number=0;",!
	Write "ExpressType2="""";",!
	Write "var ColCode="""";",!
	Write "var depot="""_($G(%session.Data("depot")))_"""",!
	Write "var commongroups="""_($G(%session.Data("commongroups")))_"""",!
	Write !,!,"var ColCode="""";",!
	Write "var ColCode2="""";",!
	Write "sessionid="""_(%session.SessionId)_""";",!
	Write "function load(){",!
	Write "currentdict.LoadHeaders();",!
	Write "Goods.LoadHeaders(""Property312,Property675,Property9469,Property3609,Property7053,Name,Size1,Weight,abbr,izdelie,Tovar,ModelNumber"");",!
	Write "TempGoods.attachEvent(""onAddColumns"", addcol)",!
	Write "TempGoods.LoadHeaders(""izdelie"");",!
	Write "GoodsForDoc.LoadHeaders(""izdelie"");",!
	Write "Catalogues.startDownload(strForGroups(depot,commongroups), putCatalogue);",!
	Write "PropTable.DownLoadPairs("""","""");",!
	Write "LoadPropTree();",!
	Write "}",!
	Write !,"function gg(){",!
	Write "if(ColCode=="""")return false;",!
	Write "var where = ColCode+"" %STARTSWITH '""+fldval.value+""'"";",!
	Write "if(fldval.value=="""")where="""";",!
	Write "ShowPriceGroups(where);",!
	Write "}",!
	Write !,"function colclick(){",!
	Write "	if(currentdict.ColType==""%Date""){alert(""Поля с датами не обрабатываются"");return false;}",!
	Write "	namfld.innerText=currentdict.ColName;",!
	Write "	ColCode=currentdict.ColCode;",!
	Write "}",!
	Write !,"function gg2(){",!
	Write "if(ColCode2=="""")return false;",!
	Write "var where = ""izdelie="" + currentdict.ItemID + "" and "" + ColCode2+"" %STARTSWITH '""+fldval2.value+""'"";",!
	Write "if(fldval2.value=="""")where="""";",!
	Write "showgoods(where);",!
	Write "}",!
	Write !,"function colclick2(){",!
	Write "	if(Goods.ColType==""%Date""){alert(""Поля с датами не обрабатываются"");return false;}",!
	Write "	namfld2.innerText=Goods.ColName;",!
	Write "	ColCode2=Goods.ColCode;",!
	Write "}",!
	Write !,!,"function ShowPriceGroups(where){",!
	Write "var where=ReturnSpace(where);",!
	Write "if(where==""Razdel="")where="""";",!
	Write "currentdict.DownLoad(where);",!
	Write "}",!
	Write !,"function showgoods(where){",!
	Write "var where=ReturnSpace(where);",!
	Write "Goods.DownLoad(where);",!
	Write "}",!
	Write !,"//Открыть карточку товара",!
	Write "function OpenCard(){",!
	Write "var gid=Goods.ItemID",!
	Write "if(gid=="""")return",!
	Write "var gname=currentdict.ItemName;",!
	Write "ok=window.showModalDialog(""GoodsCard.csp?GoodsId=""+gid+""&groupspath="",gid+InnerSplitter+gname,""center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes"")",!
	Write "}",!
	Write !,"	/// ФУНКЦИИ ДЛЯ РАБОТЫ С САМИМИ ГРУППАМИ",!
	Write "//создать группу",!
	Write "function AddPriceGroup(){",!
	Write "if(cmbCurrentRazdel.value==""""){alert(""Укажите раздел ценовой группы"");return}",!
	Write "var NewName=window.prompt(""Введите новое название группы"","""");",!
	Write "var NewGroupId="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.AddPriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',NewName,cmbCurrentRazdel.value)",!
	Write "if(isNaN(NewGroupId)){alert(NewGroupId)}",!
	Write "else{",!
	Write "	var arr = new Array();",!
	Write "	arr[1]=NewName;",!
	Write "	currentdict.addrow(NewGroupId,arr);",!
	Write "	}",!
	Write "}",!
	Write "//редактировать название группы",!
	Write "function EditPriceGroup(PriceGroupID){",!
	Write "if(ReturnSpace(PriceGroupID)=="""")return",!
	Write "var gname=currentdict.ItemName;",!
	Write "var NewName=window.prompt(""Введите новое название группы"",gname);",!
	Write "if(NewName==null)return",!
	Write "var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.SetNamePriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',PriceGroupID,NewName)",!
	Write "if(isNaN(ok)){alert(ok)}",!
	Write "else{currentdict.ItemName=NewName;}",!
	Write "}",!
	Write "//удалить группу",!
	Write "function DeletePriceGroup(PriceGroupID){",!
	Write "if(!window.confirm(""Удалить ценовую группу?""))return",!
	Write "var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.DeletePriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',PriceGroupID)",!
	Write "if(isNaN(ok)){alert(ok)}",!
	Write "else{currentdict.DelItems()}",!
	Write "}",!
	Write !,"	/// ФУНКЦИИ ДЛЯ ПРИВЯЗКИ И ОТВЯЗКИ ТОВАРОВ И ГРУПП",!
	Write "//добавить товары в группу",!
	Write "function AddGoodsToGroup(){",!
	Write "if(currentdict.ItemID==""""){alert(""Не указана ценовая группа"");return}",!
	Write "maintable.style.display=""none"";",!
	Write "AddTovarBlock.style.display=""block"";",!
	Write "}",!
	Write !,"//убрать товары из группы",!
	Write "function RemoveGoodsFromGroup(){",!
	Write "if(!window.confirm(""Убрать выбранные товары из группы ""+currentdict.ItemName+""?""))return",!
	Write "var SelectedGoodsIDs=Goods.GetAllItems(""selected"");	//список ID отмеченных товаров (через ~)",!
	Write "var PriceGroupID=""null"";",!
	Write "var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.GoodsPriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',SelectedGoodsIDs,PriceGroupID)",!
	Write "if(isNaN(ok)){alert(""Ошибка\n""+ok)}",!
	Write "else{Goods.DelItems()}",!
	Write "}",!
	Write !,"function MovePriceGroup(SelectedGoodsIDs){",!
	Write "if(SelectedGoodsIDs=="""")return",!
	Write "var RazdelId=window.showModalDialog(""ComboBox.csp?ClassProperty=Common.Dictionary12||Razdel"","""",""center:yes;status:no;dialogHeight:140px;dialogWidth:350px;resizable:yes;"");",!
	Write "if(ReturnSpace(RazdelId)=="""")return;",!
	Write "var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.MovePriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',SelectedGoodsIDs,RazdelId)",!
	Write "if(isNaN(ok)){alert(ok)}",!
	Write "else{ShowPriceGroups('Razdel='+cmbCurrentRazdel.value)}",!
	Write "}",!
	Write !,"	///ФУНКЦИИ УПРАВЛЕНИЯ БЛОКОМ ОТБОРА ТОВАРОВ",!
	Write "function CloseSelectBlock(){",!
	Write "maintable.style.display=""block"";",!
	Write "AddTovarBlock.style.display=""none"";",!
	Write "}",!
	Write !,"//клик на кнопке ДОБАВИТЬ ВЫБРАННЫЕ ТОВАРЫ",!
	Write "function startFun(){",!
	Write "if(!TurnOnGoodsForDoc_checkbox.checked)",!
	Write "	{",!
	Write "	var SelectedGoodsIDs=TempGoods.GetAllItems(""selected"");",!
	Write "	}",!
	Write "else",!
	Write "	{",!
	Write "	var SelectedGoodsIDs=GoodsForDoc.GetAllItems();",!
	Write "	}",!
	Write "if(SelectedGoodsIDs=="""")return",!
	Write "var PriceGroupID=currentdict.ItemID;	//ID отмеченной ценовой группы",!
	Write "var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.GoodsPriceGroup:csp.pricegroups"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',SelectedGoodsIDs,PriceGroupID)",!
	Write "if(isNaN(ok)){alert(ok)}",!
	Write "else{showgoods('izdelie='+PriceGroupID)}",!
	Write "CloseSelectBlock();",!
	Write "}",!
	Write !,"function addcol(){",!
	Write "TempGoods.detachEvent(""onAddColumns"", addcol)",!
	Write "TempGoodsfields=TempGoods.GetColumns(""Goods->"");",!
	Write "}",!
	Write !,"function putCatalogue(text){",!
	Write "addOptions(text,""Catalogues"");",!
	Write "LoadTree();",!
	Write "}",!
	Write !,"function LoadTree(){",!
	Write "GroupsTree.AdditionalID=Catalogues.value;",!
	Write "GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params=""'+depot+'"",""'+Catalogues.value+'""')	",!
	Write "}",!
	Write !,"function LoadPropTree(){",!
	Write "Group=ReturnSpace(GroupsTree.NodeCode);",!
	Write "LoadPropTree2(""PropsTree"","""",Group,Catalogues.value)",!
	Write "}",!
	Write !,"// добавить товар в таблицу из текущей ветки",!
	Write "function AddFromGroup(){",!
	Write "var where=""Groups='""+GroupsTree.NodeID+""'""",!
	Write "TempGoods.loadfrommethod(""Goods.GoodsAction.fromgroup"",where,TempGoodsfields)",!
	Write "}",!
	Write !,"// добавить товар в таблицу из всех подветок данной ветки",!
	Write "function AddFromWholeGroup(){",!
	Write "var where=""Groups->Depot='""+depot+""' and Groups->Catalogue='""+Catalogues.value+""' and Groups->Code %STARTSWITH '""+GroupsTree.NodeCode+""'"";",!
	Write "TempGoods.loadfrommethod(""Goods.GoodsAction.fromgroup"",where,TempGoodsfields);",!
	Write "}",!
	Write !,"function AddFromSelect(){",!
	Write "if(ThisGroupOnly.checked){var GroupCondition=""Groups->Depot='""+depot+""' and Groups->Catalogue='""+Catalogues.value+""' and Groups->Code %STARTSWITH '""+GroupsTree.NodeCode+""'"";}",!
	Write "else{var GroupCondition="""";}",!
	Write "var where=GroupCondition+FromTable;",!
	Write "TempGoods.loadfrommethod(""Goods.GoodsAction.fromgroup"",where,TempGoodsfields)",!
	Write "}",!
	Write !,"function TableClick(){",!
	Write "	ExpressType=""FromTable"";",!
	Write "	CurrentProperty=PropTable.CurrentRowTag;",!
	Write "	Pname.innerText=PropTable.CurrentRowName;",!
	Write "	newObj=PropTable.CurrentRowElement.cloneNode(true);",!
	Write "	Pvalue.innerHTML="""";",!
	Write "	Pvalue.appendChild(newObj);",!
	Write "}",!
	Write !,"function AddExpress(){",!
	Write "	tagNamez=Pvalue.firstChild.tagName;",!
	Write "	if(tagNamez==""DIV""){",!
	Write "		Objvalue=Pvalue.firstChild.Tag;",!
	Write "		if(Objvalue.split(""@"")[0]==""""){Objvalue=Pvalue.firstChild.innerText+Objvalue;}",!
	Write "		}",!
	Write "	if(tagNamez==""SELECT""){Objvalue=Pvalue.firstChild.options(Objec.selectedIndex).text+""@%String"";}",!
	Write "	return Objvalue;",!
	Write "}",!
	Write !,"function TakeValue(){",!
	Write "FrstPart=AddExpress().split(""@"")[0]",!
	Write "ScndPart=AddExpress().split(""@"")[1]",!
	Write "//if(ScndPart!=""%Date"")return FrstPart",!
	Write "if(ScndPart!=""%Date"")return ""'""+FrstPart+""'""",!
	Write "else {",!
	Write "	dateArr=FrstPart.split(""/"")",!
	Write "	Data=dateArr[2]+""-""+dateArr[1]+""-""+dateArr[0]",!
	Write "	return ""CAST('""+Data+""' AS DATE)""",!
	Write "}",!
	Write "}",!
	Write !,"function dork(concatenation){",!
	Write "if(Pname.innerText=="""")return false",!
	Write "if(ExpressType2!=ExpressType){",!
	Write "	Express.innerHTML="""";",!
	Write "	ExpressType2=ExpressType;",!
	Write "	}",!
	Write "newCaption=Pname.innerText;",!
	Write "newEqual=Pequal.options(Pequal.selectedIndex).text;",!
	Write "newValue=TakeVisibleValue();",!
	Write "newExpression=newCaption+newEqual+newValue;",!
	Write "value=TakeValue();",!
	Write "if(ExpressType==""FromTree""){",!
	Write "	//exp=(CurrentProperty+InnerSplitter+Pequal.value+InnerSplitter+value);",!
	Write "	if(FromTree==""""){FromTreeconcatenation="""";}",!
	Write "	else{FromTreeconcatenation=concatenation}",!
	Write "	Number++;",!
	Write "	field=""t""+Number+"".Gvalue""",!
	Write "	if((Pequal.value!=""="")&(Pequal.value!=""<>"")){field=""CAST(t""+Number+"".Gvalue AS INTEGER)""}",!
	Write "	exp="" (t""+Number+"".Param=""+CurrentProperty+"" and ""+field+Pequal.value+value+"") """,!
	Write "	FromTree=FromTree+FromTreeconcatenation+ exp;",!
	Write "	}",!
	Write "if(ExpressType==""FromTable""){",!
	Write "	if(FromTable==""""){FromTableconcatenation="""";}",!
	Write "	else{FromTableconcatenation=concatenation}",!
	Write "	exp="" Goods->""+CurrentProperty+Pequal.value+value+"" """,!
	Write "	FromTable=FromTable+FromTableconcatenation + exp;",!
	Write "	}",!
	Write "if(Express.innerHTML=="""")concatenation="""";",!
	Write "if(concatenation==""AND""){concatenation=""И""}",!
	Write "if(concatenation==""OR""){concatenation=""ИЛИ""}",!
	Write "newString=Express.innerHTML+""<b> ""+concatenation+"" (</b>""+newExpression+""<b>)</b>""",!
	Write "Express.innerHTML=newString;",!
	Write "}",!
	Write !,"function TakeVisibleValue(){",!
	Write "	Objec=Pvalue.firstChild;",!
	Write "	if(Objec.tagName==""SELECT"")return Objec.options(Objec.selectedIndex).text",!
	Write "	else{return Objec.innerText;}",!
	Write "}",!
	Write !,"function PropsTreeClick(){",!
	Write "	ExpressType=""FromTree"";",!
	Write "	CurrentProperty=PropsTree.NodeID;",!
	Write "	Pname.innerText=PropsTree.NodeCaption;",!
	Write "	newObj=CreateDiv("""",""dsd"");",!
	Write "	Pvalue.innerHTML="""";",!
	Write "	Pvalue.appendChild(newObj);",!
	Write "}",!
	Write !,"function DelItems(element){",!
	Write "document.getElementById(element).DelItems();",!
	Write "}",!
	Write !,"function ClearSelect(){",!
	Write "Express.innerText='';",!
	Write "FromTree="""";",!
	Write "FromTable="""";",!
	Write "Number=0;",!
	Write "}",!
	Write !,"function showdictionary(where){",!
	Write "TempGoods.AddOnClear=true;",!
	Write "TempGoods.DownLoad(where);",!
	Write "TempGoods.AddOnClear=""false"";",!
	Write "}",!
	Write !,"//функция нужна для совместимости с table.htc",!
	Write "function cellaction(oo){",!
	Write "}",!
	Write !,"//функция нужна для совместимости с table.htc",!
	Write "function getDivChange(oo){",!
	Write "}",!
	Write !,"function GroupsTreeClick(){",!
	Write "	CurrentGroupName.innerText=GroupsTree.NodeCaption;",!
	Write "	LoadPropTree();",!
	Write "	AddFromGroup();",!
	Write "}",!
	Write !,"// показать/убрать промежуточную таблицу для выбора документов",!
	Write "function TurnOnGoodsForDoc(){",!
	Write "	if(TurnOnGoodsForDoc_checkbox.checked){",!
	Write "		GoodsForDoc_TR.style.display=""inline"";",!
	Write "		CopyGoodsAnotherTable_Btn.style.display=""inline"";",!
	Write "		}",!
	Write "	else{",!
	Write "		GoodsForDoc_TR.style.display=""none"";",!
	Write "		CopyGoodsAnotherTable_Btn.style.display=""none"";",!
	Write "		}",!
	Write "}",!
	Write !,"//Переместить",!
	Write "function CopyGoodsAnotherTable_Fn(){",!
	Write "var Strings=TempGoods.ListViewGetItems(""selected"").split(StringSplitter)",!
	Write "for(var i=0; i<Strings.length-1; i++)",!
	Write "	{",!
	Write "		var StringArray = Strings[i].split(InnerSplitter);",!
	Write "		GoodsForDoc.addrow(StringArray[0],StringArray)",!
	Write "	}",!
	Write "}",!
	Write "</script>"
	Write !,(..HyperEventHead())
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLADz XMLNS:SKLADList XMLNS:SKLAD2>"
	Write !,"<IMPORT NAMESPACE=""SKLADList"" IMPLEMENTATION=""htc/listview.htc"">",!
	Write "<IMPORT NAMESPACE=""SKLADz"" IMPLEMENTATION=""htc/treeview.htc"">",!
	Write "<IMPORT NAMESPACE=""SKLAD2"" IMPLEMENTATION=""htc/table.htc"">",!
	Do ..OnPageHEAD()
	Write !,!
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
  s login=$G(%session.Data("user"))
  i '+login s %response.ServerSideRedirect="norights.csp" 
  i '##class(Common.Rights).getrights(login,4) s %response.ServerSideRedirect="norights.csp" 
  q 1
 
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\PriceGroups.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/PriceGroups.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>60975,5647</Default>
</Parameter>
</Class>
</Export>

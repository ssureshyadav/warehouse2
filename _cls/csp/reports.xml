<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.reports">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62091,296.055082</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body>"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,!,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.location.href='tuneup.csp'"" TITLE=""""><center>Назад</center></span>"
	Write "<br>",!
	Write "<TABLE cellSpacing=0 width=""100%"" celpadding=""0"" >",!
	Write "<TR>",!
	Write "<TD align=center style=""BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid"" colspan=3><strong>Поступившие отчёты</strong></TD></tr>",!
	Write "<tr>",!
	Write "</table>",!
	Write !,!,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""ReloadPage()"" TITLE=""""><center>Обновить</center></span>"
	Write "<br>",!
	Write "<table border=1><tr><td>Дата<td>Код, Название СЦ<td>Результат<td>&nbsp;",!
	s period=%request.Get("period")
	s klient=%request.Get("klient")
	i period&klient k ^SCReports(period,klient)
	s ResultTable(1)="Новый поступивший отчёт"
	s ResultTable(2)="Создан документ на основании отчёта"
	s ResultTable(3)="Создаётся документ на основании отчёта"
	s ResultTable(4)="Ошибка при создании документа"
	s period="" f  s period=$O(^SCReports(period)) q:period=""  d
	. s klient="" f  s klient=$O(^SCReports(period,klient)) q:klient=""  d
	. . s ReportState=$G(^SCReports(period,klient))
	. . s klientName=##class(Kontragent.Action).GetKontrIdFromCode(klient)
	. . w "<tr>"
	. . w "<td>"_$E(period,1,4)_"-"_$E(period,5,6)
	. . w "<td>"_klient_", "_klientName
	. . w "<td>"_$G(ResultTable(ReportState))
	. . w "<td><a href=""Reports.csp?period="_period_"&klient="_klient_""">удалить для повторного приёма</a>"
	Write !,!,"</table>",!
	Write "</body>"
	Write !,(..HyperEventFrame(0))
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<title>	Cache Server Page </title>",!
	Write "<script language=""javascript"">"
	Write !,"var Progress="""_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Sync.Progress:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"')"";",!
	Write "function startFun(){",!
	Write "	cspCallServerMethod('"_(..Encrypt($listbuild("Common.Sync.Synchronization2:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:"")_"&WCHARSET="_%response.CharSet)_"');",!
	Write "	window.location.reload();",!
	Write "}",!
	Write !,"function lookup(){",!
	Write "Progress="""_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Sync.Progress:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"')"";",!
	Write "load();",!
	Write "if(!ReturnBoolean(Progress))",!
	Write "	{",!
	Write "	ShowResult();",!
	Write "	window.clearInterval(timerID);",!
	Write "	}",!
	Write "}",!
	Write !,"function ShowResult(){",!
	Write "CurrentProgress.innerHTML="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Sync.ShowResult:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"');",!
	Write "}",!
	Write !,"function load(){",!
	Write "	return",!
	Write "if(ReturnBoolean(Progress))",!
	Write "	{",!
	Write "	SyncLabel.innerText='..Идёт синхронизация';",!
	Write "	ShowResult();",!
	Write "	}",!
	Write "else{SyncLabel.innerText='Данные синхронизации';}",!
	Write "}",!
	Write !,"function Export(){",!
	Write "var result="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Sync.ExportSyncFile:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"')",!
	Write "if(result.split(""@"")[0]==1){ExportedFile.innerText=""Экспортировано в файл: ""+result.split(""@"")[1];}",!
	Write "else{alert(""Ошибка\n""+result)}",!
	Write "}",!
	Write !,"function Import(){",!
	Write "var file=oFile1.value",!
	Write "var result="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Sync.ImportSyncFile:csp.reports"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',file)",!
	Write "if(result==1){alert(""Данные успешно загружены."")}",!
	Write "else{alert(result)}",!
	Write "}",!
	Write !,"function ReloadPage(){",!
	Write "window.location.reload()",!
	Write "}",!
	Write "</script>"
	Write !,(..HyperEventHead())
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !,!
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\Reports.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/Reports.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>60932,7808</Default>
</Parameter>
</Class>
</Export>

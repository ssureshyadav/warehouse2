<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.utilizationdochelper">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<IncludeCode>xmlmacros</IncludeCode>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62037,85286.079552</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body>"
	Write !
	n ModelId,DetailsToSkip,i,CurrentDetail,ID,FullName,Property5300,codedetail
	s ModelsId=%request.Get("ModelsId")
	if $E(ModelsId,$L(ModelsId))="," s ModelsId=$E(ModelsId,1,$L(ModelsId)-1)
	s DetailsToSkip=%request.Get("DetailsToSkip")
	f i=1:1:$L(DetailsToSkip,",") d
	. s CurrentDetail=$P(DetailsToSkip,",",i)
	. q:CurrentDetail=""
	. s DetailsToSkip(CurrentDetail)=""
	&html<
	<table id="DetailsTable" border=1 style="border-collapse:collapse;">
	<tr bgcolor="#deeeef"><td>&nbsp;<td>Наименование запчасти<td>Номер по схеме<td>Код
	>
	if ModelsId'="" 
	{
	s rs=##class(%ResultSet).%New()
	s SqlQuery="select ID,FullName,Property5300,codedetail from Goods.Goods where Tovar in ("_ModelsId_")"
	s ok=rs.Prepare(SqlQuery)
	if '+ok $$$WriteObjError(ok) w "Извините. Ошибка при подготовке запроса."
	s ok=rs.Execute()
	if '+ok $$$WriteObjError(ok) w "Извините. Ошибка при выполнении запроса."
	while rs.Next() 
	{
	for i="ID","FullName","Property5300","codedetail" 
	{
	s @i=rs.Data(i)
	}
	if $D(DetailsToSkip(ID)) CONTINUE
	w "<tr id="""_ID_""">"
	w "<td><input type=""checkbox"">"
	w "<td>"_FullName
	w "<td>"_Property5300
	w "<td>"_codedetail
	}
	}
	w "</table>",!
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,!,"<!-- Put your page Title here -->"
	Write !,"<title>	Cache Server Page </title>",!
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !,!
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\UtilizationDocHelper.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/UtilizationDocHelper.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61397,86300</Default>
</Parameter>
</Class>
</Export>

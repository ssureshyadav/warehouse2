(function(a){var l={init:function(f){var b=a.extend({onSelect:null,urlCAT:"json.Catalogue.cls",urlGROUP:"json.GoodsGroup2.cls",urlGOOD:"json.Goods.cls",title:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u0432\u0430\u0440",bSelect:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c",bCancel:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c",width:820,height:630,tName:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",tCatLabel:"\u041a\u0430\u0442\u0430\u043b\u043e\u0433",
tCatButton:"\u0412\u044b\u0431\u043e\u0440 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430",tCatClmn:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",tCatDlg:"\u0412\u044b\u0431\u043e\u0440 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430",tGrpGrd:"\u0413\u0440\u0443\u043f\u043f\u044b \u0442\u043e\u0432\u0430\u0440\u043e\u0432",tGrpCollapse:"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c",tGrpExpand:"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c",tGdGrd:"\u0422\u043e\u0432\u0430\u0440\u044b",
tWarnTtl:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!",tWarnMsg:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u0432\u0430\u0440!"},f);return this.each(function(){var h=a(this);if(!h.data("jqGoodsDialog")){var g=h.attr("id");if(g){var f=g+"_cat",i=g+"_Grp",j=i+"Grd";i+="Bar";g+="_Good";var k=g+"Grd";g+="Bar";var l=f+"Warn";a(["<div id='",l,"' style='margin-top: 20px; padding: 0 .7em;' class='ui-state-highlight ui-corner-all'><p><span style='float: left; margin-right: .3em;' class='ui-icon ui-icon-info'></span>",
b.tWarnMsg,"</p></div>"].join("")).appendTo(h).dialog({title:b.tWarnTtl,autoOpen:false,modal:true});a(["<table><tr><td valign='top'><table id='",j,"'><tr><td></td></tr></table><div id='",i,"'></div></td><td valign='top'><table id='",k,"'><tr><td></td></tr></table><div id='",g,"'></div></td></tr></table>"].join("")).appendTo(h);var m=[];a.ajax({url:b.urlCAT,async:false,data:{sidx:"nm",sord:""},dataType:"json",success:function(c){var a=0;if(c.rows)a=c.rows.length;for(var b=0;b<a;b++){var n=c.rows[b];
m.push(n.id+":"+n.nm)}}});a("#"+j).jqGrid({caption:b.tGrpGrd,colModel:[{name:"id",hidden:true},{name:"n",label:b.tCatClmn,width:350,sortable:false,search:true,stype:"select",searchoptions:{value:m.join(";")}}],idPrefix:"gg",url:b.urlGROUP,datatype:"json",postData:{depot:1,cat:a("#"+f).val()},treeGrid:true,treeGridModel:"adjacency",treeIcons:{plus:"ui-icon-circlesmall-plus",minus:"ui-icon-circlesmall-minus",leaf:"ui-icon-arrowstop-1-e"},ExpandColumn:"n",ExpandColClick:true,jsonReader:{repeatitems:false},
treeReader:{level_field:"level",parent_id_field:"parent",leaf_field:"leaf",expanded_field:"expanded"},onSelectRow:function(c){var b=a("#"+k),e=b.jqGrid("getGridParam","postData");e.gp=c;b.jqGrid("setGridParam","postData",e).trigger("reloadGrid")},pager:"#"+i,viewrecords:true,height:400,hidegrid:false}).jqGrid("navGrid","#"+i,{add:false,edit:false,del:false,view:false,search:false}).jqGrid("gridResize",{minWidth:100,minHeight:100}).jqGrid("filterToolbar",{searchOnEnter:false}).jqGrid("navButtonAdd",
"#"+i,{caption:"",title:b.tGrpExpand,buttonicon:"ui-icon-circlesmall-plus",onClickButton:function(){var c=a("#"+j),b=c.jqGrid("getRowData")[0],e=function(a){a._id_=a.id;var b=c.jqGrid("getNodeChildren",a);if(b.length){for(var d in b)e(b[d]);c.jqGrid("expandRow",a);c.jqGrid("expandNode",a)}};e(b)}}).jqGrid("navButtonAdd","#"+i,{caption:"",buttonicon:"ui-icon-circlesmall-minus",title:b.tGrpCollapse,onClickButton:function(){var b=a("#"+j),d=b.jqGrid("getRowData")[0],e=function(a){a._id_=a.id;var d=b.jqGrid("getNodeChildren",
a);if(d.length){for(var f in d)e(d[f]);b.jqGrid("collapseRow",a);b.jqGrid("collapseNode",a)}};e(d)}});a("#"+i+"_center").remove();a("#"+k).jqGrid({caption:b.tGdGrd,colModel:[{name:"id",hidden:true},{name:"gd",hidden:true},{name:"nm",label:b.tName,width:350}],url:b.urlGOOD,datatype:"json",jsonReader:{repeatitems:false},postData:{gp:""},idPrefix:"g",pager:"#"+g,height:400,hidegrid:false,rownumbers:true,viewrecords:true,rowNum:100,scroll:1,hoverrows:true,gridview:true,ondblClickRow:function(c){var c=
a(this).jqGrid("getRowData",c),d=b.onSelect;typeof d=="function"&&d({id:c.gd,nm:c.nm});h.jqGoodsDialog("close")}}).jqGrid("navGrid","#"+g,{add:false,edit:false,del:false,view:false,search:false}).jqGrid("gridResize",{minWidth:100,minHeight:100}).jqGrid("filterToolbar",{searchOnEnter:false});a("#"+g+"_center").remove();a("#gs_n","#gview_"+j).unbind().change(function(){var b=a(this).val(),d=a("#"+j),e=d.jqGrid("getGridParam","postData");e.cat=b;d.jqGrid("setGridParam","postData",e);d.trigger("reloadGrid");
b=a("#"+k);e=b.jqGrid("getGridParam","postData");e.gp="";b.jqGrid("setGridParam","postData",e).trigger("reloadGrid")});h.dialog({title:b.title,modal:true,width:b.width,height:b.height,autoOpen:false,buttons:[{text:b.bSelect,click:function(){var c=a("#"+k).jqGrid("getGridParam","selrow");if(c){var d=b.onSelect;typeof d=="function"&&(c=a("#"+k).jqGrid("getRowData",c),d({id:c.gd,nm:c.nm}));a(this).dialog("close")}else a("#"+l).dialog("open")}},{text:b.bCancel,click:function(){a(this).dialog("close")}}]});
h.data("jqGoodsDialog",{target:h})}else alert("element without id")}})},open:function(){return this.each(function(){a(this).dialog("open")})},close:function(){return this.each(function(){a(this).dialog("close")})}};a.fn.jqGoodsDialog=function(f){if(l[f])return l[f].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof f==="object"||!f)return l.init.apply(this,arguments);else a.error("Method "+f+" does not exist on jQuery.jqGoodsDialog")}})(jQuery);

<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20" zv="Cache for Windows (Intel) 5.1 (Build 826)" ts="2014-01-22 12:08:28">
<Class name="Common.Bank">
<Description>
Банковские реквизиты</Description>
<Super>%SerialObject</Super>
<TimeCreated>60419,3535.784217</TimeCreated>

<Property name="kpp">
<Description>
КПП</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="bik">
<Description>
БИК</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="rsch">
<Description>
Расчетный счет</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="ksch">
<Description>
Корреспондетский счет</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="inn">
<Description>
ИНН</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="pbank">
<Description>
Банк</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="code">
<Description>
Банк</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="city">
<Description>
Город банка</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="okpo">
<Description>
ОКПО</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="okud">
<Description>
ОКУД</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="okdp">
<Description>
Деятельность по ОКДП</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="okonh">
<Description>
ОКОНХ</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="ogrn">
<Description>
ОГРН</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="okato">
<Description>
ОКАТО</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="regnumber">
<Description>
Свидетельство о регистрации</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheSerialState</Type>
<State>BankState</State>
<StreamLocation>^Common.BankS</StreamLocation>
<Data name="BankState">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>account1</Value>
</Value>
<Value name="2">
<Value>account2</Value>
</Value>
<Value name="3">
<Value>bik</Value>
</Value>
<Value name="4">
<Value>inn</Value>
</Value>
<Value name="5">
<Value>kpp</Value>
</Value>
<Value name="6">
<Value>ksch</Value>
</Value>
<Value name="7">
<Value>pbank</Value>
</Value>
<Value name="8">
<Value>rsch</Value>
</Value>
<Value name="9">
<Value>code</Value>
</Value>
<Value name="10">
<Value>city</Value>
</Value>
<Value name="11">
<Value>okpo</Value>
</Value>
<Value name="12">
<Value>okdp</Value>
</Value>
<Value name="13">
<Value>okud</Value>
</Value>
<Value name="14">
<Value>okonh</Value>
</Value>
<Value name="15">
<Value>ogrn</Value>
</Value>
<Value name="16">
<Value>okato</Value>
</Value>
<Value name="17">
<Value>regnumber</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Boss">
<Super>%Persistent</Super>
<TimeCreated>60477,16844.753781</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="kontact">
<Description>
Контактная информация</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="comment">
<Description>
Комментарий</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="kontr">
<Type>Common.Kontragent</Type>
<Cardinality>many</Cardinality>
<Inverse>boss</Inverse>
<Relationship>1</Relationship>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.BossD</DataLocation>
<DefaultData>BossDefaultData</DefaultData>
<IdLocation>^Common.BossD</IdLocation>
<IndexLocation>^Common.BossI</IndexLocation>
<StreamLocation>^Common.BossS</StreamLocation>
<Data name="BossDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>comment</Value>
</Value>
<Value name="3">
<Value>kontact</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Common">
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60347,55264.066044</TimeCreated>

<Method name="GetGarantIdByName">
<Description>
получить ID гарантийного талона по его имени</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GarantName:%String</FormalSpec>
<Implementation><![CDATA[
	q:'$D(^Common.Dictionary2I("garantInd"," "_GarantName)) ""
	q $O(^Common.Dictionary2I("garantInd"," "_GarantName,""))
]]></Implementation>
</Method>

<Method name="CheckSerialUnique">
<Description>
проверить уникальность серийного номера</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial:%String,GarantID</FormalSpec>
<Implementation><![CDATA[
	s ^mtempArt("CheckSerialUnique",$I(^mtempArt("CheckSerialUnique")),"serial")=serial
	s ^mtempArt("CheckSerialUnique",$I(^mtempArt("CheckSerialUnique")),"GarantID")=GarantID
	
	q:'$D(^Common.Dictionary2I("serialInd"," "_serial)) 1
	s GarantID = $O(^Common.Dictionary2I("serialInd"," "_serial,""))
	if GarantID="" q "Удивительная ошибка. Серийный номер "_serial_" есть в индексе, но нет записи о гарантийном номере."

	q "Серийный номер "_serial_" уже существует, но принадлежит гарантийному талону "_$LG($G(^Common.Dictionary2I("serialInd"," "_serial,GarantID)),2)
	//q $O(^Common.Dictionary2I("garantInd"," "_GarantName,""))
]]></Implementation>
</Method>

<Method name="SaveItem">
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName,ItemId="",ItemNames,ItemValues,ItemTypes,newtype=0</FormalSpec>
<Implementation><![CDATA[
 q:$G(ClassName)="" "Не указано имя класса"
 q:$G(ItemNames)="" "Список имён сохраняемых полей пуст"
 q:$G(ItemValues)="" "Список сохраняемых значений пуст"
 q:$G(ItemTypes)="" "Список типов сохраняемых значений пуст"
 s $ZT="SaveItemErr"
 s err=1
 i ItemId'="" d
 . s Item=$ZOBJCLASSMETHOD(ClassName,"%OpenId",ItemId)
 . i '$ISOBJECT(Item) s Item=$ZOBJCLASSMETHOD(ClassName,"%New")
 e  s Item=$ZOBJCLASSMETHOD(ClassName,"%New")
 f i=1:1:$L(ItemNames,"~")-1 q:'+err  d
 . s CurrentName=$P(ItemNames,"~",i)
 . s CurrentValue=$P(ItemValues,"~",i)
 . s CurValueType=$P($P(ItemTypes,"~",i),"@",2)
 . s CurValueDB=$P($P(ItemTypes,"~",i),"@",1)
 . s necessary=$$unrequired(ClassName,CurrentName)
 . i (CurrentValue="")&('necessary) s err="Не заполнены все необходимые поля документа" q
 . i newtype s CurValueDB=CurrentValue
 . i (CurValueType'="")&(CurValueType'["%") d //Тоесть тип указан и он не содержит процент - наверное это объектная ссылка
 . . d $ZOBJMETHOD(Item,CurrentName_"SetObjectId",CurValueDB)
 . e  d
 . . d:CurValueType="%Date" 
 . . . i CurrentValue'="" s CurrentValue=$ZDH(CurrentValue,4)
 . . . e  s CurrentValue=+$H
 . . s $ZOBJPROPERTY(Item,CurrentName)=CurrentValue
 q:'+err err
 s ok=Item.%Save()
 i '+ok $$$WriteObjError(ok) q "Ошибка при сохранении"
 //i ClassName="Common.Dictionary2" q 1  //потому что этот класс имеет собственные ID символьные и вообще любые
 q Item.%Id()
SaveItemErr
 $$$WriteError($ZE)
 q "Ошибка при сохранении"
unrequired(class,field)
 q:field="Comment" 1
 q:class="Common.Kontragent" 1
 q:class="Common.Dictionary2" 1
 
 q $D(^UnRequiredFields(class,field))
]]></Implementation>
</Method>

<Method name="DeleteItem">
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName,ItemID</FormalSpec>
<Implementation><![CDATA[
 s $ZT="DeleteItemErr"
 q:$G(ClassName)="" "Не указано имя класса"
 q:$G(ItemID)="" "Не указан код удаляемого объекта"
 s ok=$ZOBJCLASSMETHOD(ClassName,"%DeleteId",ItemID)
 i '+ok $$$WriteObjError(ok) q "Не удалось удалить объект"
 q 1
DeleteItemErr
 $$$WriteError($ZE)
 q "Не удалось удалить объект"
]]></Implementation>
</Method>

<Method name="CreateClass">
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName,ItemId="",ItemNames,ItemValues,ItemTypes</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CreateClassErr"
 
 f i=1:1:$L(ItemNames,"~")-1 d
 . s common($P(ItemNames,"~",i))=$P(ItemValues,"~",i)
 &sql(select max(number) into :maxnumber from Common.Dicts)
 s maxnumber=+$G(maxnumber)+1
 s found=1
 s common("Code")="Common.Dictionary"_maxnumber

 while found {
	s common("Code")="Common.Dictionary"_maxnumber
 	&sql(select id from %Dictionary.ClassDefinition where id=:common("Code"))
 	i SQLCODE s found=0
 	e  s found=1,maxnumber=+$G(maxnumber)+1
 }
 
 s common("Code")="Common.Dictionary"_maxnumber 
 s ItemNames=ItemNames_"Code~"_"number~"
 s ItemValues=ItemValues_"~"_common("Code")_"~"_maxnumber
 //TSTART
 Set cdef = ##class(%Dictionary.ClassDefinition).%New(common("Code"))
 
 If '$ISOBJECT(cdef)  {
     Do DecomposeStatus^%apiOBJ(%objlasterror,.Err)
     //TROLLBACK
     q Err(Err)
 }
 Set cdef.ClassType = "persistent"
 Set cdef.Super = "%Persistent"
 s ok=cdef.%Save()
 If '+ok  {
     Do DecomposeStatus^%apiOBJ(%objlasterror,.Err)
     //TROLLBACK
     q Err(Err)
 }
 s err=$$Comple(common("Code"))
 //i '+err TROLLBACK  q err
 i '+err q err

 s err=..SaveItem(ClassName, ItemId, ItemNames, ItemValues, ItemTypes)
 //TCOMMIT
 q err
Comple(clname)
 s glob=$NA(^mtempSklad($I,"Compile"))
 k @glob
 j Compile^cmpl(clname,glob)
 while $G(@glob)="" {
 h .1
 }
 q:@glob@("err")>0 @glob@("err",@glob@("err"))
 q 1
CreateClassErr
 $$$WriteError($ZE)
 q "Извините, ошибка при создании справочника"
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//Показать данные хранимого класса

]]></Content>
</UDLText>

<Method name="showdata">
<ClassMethod>1</ClassMethod>
<FormalSpec>class="",fields="",params="",where="",xml="",returndata=0,param=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="showdataErr"
 s currentpage=$G(param("currentpage"))
 s stroknastr=$G(param("stroknastr"))

 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr

 i class="" q "Error=Не указан класс"
 i fields="" q "Error=Не указаны поля"
 s order=$G(param("order"))
 s kolbasaddr=$G(param("kolbasaddr"))
 if params'="" 
 {
	 Set result = ##class(%ResultSet).%New(class_":Common")
	 If $$$ISERR(result) $$$WriteObjError(result) q
	 s str="s ok=result.Execute("_params_")"
	 x str
	 i '+ok $$$WriteObjError(ok) q
 }
 else 
 {
	 s result = ##class(%ResultSet).%New()
	 i $$$ISERR(result) d ..showerror(result,"Data.csp, %ResultSet 2") q
	 i kolbasaddr d
	 . f i=1:1:$L(fields,",") d
	 . . i $P(fields,",",i)="addr->Name" s $P(fields,",",i)="addr"
	 . . i $P(fields,",",i)="addr2->Name" s $P(fields,",",i)="addr2"
	 i class="Docs.Utiliz" s fields=fields_",%external(Stat) As Stat"
	 s sql="SELECT "_fields_" FROM "_class
	 s sqlcount="SELECT count(*) as strcount from "_class
	 if where'="" s sql=sql_" where "_where
	 
	 //странная хрень с полем Holding в классе Common.Kontragent 
	 //если в выборку включить Holding->Name то первичный ключ
	 if (order="")&&(class="Common.Kontragent") s sql=sql_" order by ID"
	 if order'="" s sql=sql_" order by "_order
	 s ^mtempArt("sql")=sql
	 //s ^lastsql($I(^lastsql))=sql
	 i $ISOBJECT($G(%session)) s user=$G(%session.Data("user"),"not found")
	
	 s ok=result.Prepare(sql)
	 i '+ok $$$WriteObjError(ok) q "Ошибка при формировании запроса"
	 //s result.RuntimeMode=1
	 s ok=result.Execute()
	 i '+ok $$$WriteObjError(ok) q
	 
	 //посчитаем количество записей соответствующих текущему запросу с помощью запроса sqlcount
	 s strcount=..Count(class,where)
 }
 s:xml xmlstr=##class(%XML.Writer).%New()
 s:xml xmlstr.Charset="windows-1251"
 d:xml xmlstr.OutputToDevice()
 s:xml sc=xmlstr.RootElement("AllObjects")
 
 //соберём все названия колонок в одну переменную
 f i=1:1:result.GetColumnCount() d
 . s columns(i)=result.GetColumnName(i)
 . s columnstypes(i)=result.GetColumnType(i)
 . s columns(i,"type")=result.GetColumnType(i)
 . q:(class="Store.Address")&(columns(i)="block")
 . s columns(i,"enum")=##class(%Dictionary.CompiledMethod).%ExistsId(class_"||"_columns(i)_"LogicalToDisplay")

 d:+currentpage
 . i (returndata)&('xml) s out2=$G(out2)_$G(strcount)_"#@#"
 . e  w:'xml $G(strcount)_"#@#"
 
 While result.Next() 
 {
	 i $I(strig)
	 continue:(strig<from)&(+currentpage)
	 q:(strig>to)&(+currentpage)
	 s:xml sc=xmlstr.Element("OneObject")
	 f i=1:1:result.GetColumnCount() d
	 . s text=result.GetData(i)
	 . i $G(columns(i,"enum")) s text=$ZOBJCLASSMETHOD(class,columns(i)_"LogicalToDisplay",text)
	 . i (columns(i)="addr")&(kolbasaddr) s text=##class(Store.Action).AddressPath(text)
	 . i (columns(i)="addr2")&(kolbasaddr) s text=##class(Store.Action).AddressPath(text)
	 . //i (class="Operation.Instructions")&(columns(i)="State") s text=##class(Operation.Instructions).StateLogicalToDisplay(text)
	 . s $P(OutString,"~",i)=text
	 . s:xml sc=xmlstr.Element(columns(i))
	 . d:xml xmlstr.Write(text)
	 . s:xml sc=xmlstr.EndElement()
	 i (returndata)&('xml) s out2=$G(out2)_OutString_"#@#"
	 e  w:'xml OutString_"#@#"
	 s:xml sc=xmlstr.EndElement()
 }
 i xml $$$WriteElementTwice("strcount",strcount)

 s:xml sc=xmlstr.EndRootElement()
 q:returndata $G(out2)
 q 1
showdataErr
 $$$WriteError($ZE)
 q $ZE
]]></Implementation>
</Method>

<Method name="showerror">
<ClassMethod>1</ClassMethod>
<FormalSpec>error,descr="ошибка"</FormalSpec>
<Implementation><![CDATA[
 Do DecomposeStatus^%apiOBJ(error,.Err)
 s ^Errors($H,descr)=Err(Err)
 q
]]></Implementation>
</Method>

<Method name="saveerror">
<ClassMethod>1</ClassMethod>
<FormalSpec>error,descr</FormalSpec>
<Implementation><![CDATA[
 s ^Errors($H,descr)=error
 q
]]></Implementation>
</Method>

<Method name="CheckPattern">
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName="",Property="",PropertyValue=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 s $ZT="CheckPatternErr"
 s output=1
 i (ClassName="")!(Property="") s ^Errors($H,"Common.Common.CheckPattern")="не указан класс или свойство" q output
 s pattern=$G(^Property(ClassName,Property,"Pattern"))
 s prohibited=$G(^Property(ClassName,Property,"Prohibited"))
 q:(pattern="")&(prohibited="") output
 i pattern'="" d
 . x "s ok="""_PropertyValue_""""_pattern
 . q:ok
 . s PropertyName=$$GetPropertyName(ClassName,Property)
 . s output="Свойство "_PropertyName_" не соответствует своему шаблону ("_pattern_")"
 e  d
 . f i=1:1:$L(prohibited) q:'output  d
 . . s SingleChar=$E(prohibited,i,i)
 . . d:PropertyValue[SingleChar 
 . . . s PropertyName=$$GetPropertyName(ClassName,Property)
 . . . s output="Свойство "_PropertyName_" содержит символ "_SingleChar_", что недопустимо."
 q output
CheckPatternErr
 s ^Errors($H,"$ZE")=$ZE
 q $ZE
GetPropertyName(ClassName,Property)
 s f=##class(%Dictionary.PropertyDefinition).%OpenId(ClassName_"||"_Property)
 q f.Description
]]></Implementation>
</Method>

<Method name="GetDocsByTovar">
<ClassMethod>1</ClassMethod>
<FormalSpec>idtov,dates,kontr</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetDocsByTovarErr"
 s xmlstr=##class(%XML.Writer).%New()
 s xmlstr.Charset="windows-1251"
 d xmlstr.OutputToDevice()
 s sc=xmlstr.RootElement("AllObjects")
 s dat1=$P(dates,"~",1)
 s dat2=$P(dates,"~",2)
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 if kontr'="" s kontr="and b.Kontr="_kontr
 s result = ##class(%ResultSet).%New()
 i $$$ISERR(result) $$$WriteObjError(result)
 s sql="SELECT b.Dat As DocDat,Kontr->Name As Kontrn,b.Name as DocName,a.DocType as DocType,a.DocType->Name as DocTypeName,a.Quantity as Quantity,a.Total as Total,a.Price as Price FROM Docs.DocItems a, Docs.Super b where a.Doc=b.ID and a.Goods="_idtov_" and b.Dat>="_dat1_" and b.Dat<="_dat2_" "_kontr_" order by DocDat"
 
 s ok=result.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "Ошибка при формировании запроса"
 
 s ok=result.Execute()
 i '+ok $$$WriteObjError(ok) q
  
 //соберём все названия колонок в одну переменную
 f i=1:1:result.GetColumnCount() d
 . s columns(i)=result.GetColumnName(i)

 While result.Next() {
 s sc=xmlstr.Element("OneObject")
 d WriteOneItem("docdata",$ZD($g(result.Data("DocDat")),4))
 d WriteOneItem("Kontr",$g(result.Data("Kontrn")))
 d WriteOneItem("doctype",$g(result.Data("DocTypeName")))
 d WriteOneItem("doc",$g(result.Data("DocName")))
 if $g(result.Data("DocType"))="Docs.Prih" d
 . d WriteOneItem("prih",$g(result.Data("Total")))
 if $g(result.Data("DocType"))="Docs.Rash" d
 . d WriteOneItem("rash",$g(result.Data("Total")))
 d WriteOneItem("kol",$g(result.Data("Quantity")))
 d WriteOneItem("cena",$g(result.Data("Price")))
 s sc=xmlstr.EndElement()
 }

 s sc=xmlstr.EndRootElement()
 q
GetDocsByTovarErr
 $$$WriteError($ZE)
 q
WriteOneItem(namedelement,text)
 s sc=xmlstr.Element(namedelement)
 $$$WriteElement("text",text)
 s sc=xmlstr.EndElement()
 q
]]></Implementation>
</Method>

<Method name="ClassHaveProperty">
<ClassMethod>1</ClassMethod>
<FormalSpec>class,method</FormalSpec>
<Implementation><![CDATA[ q ##class(%Dictionary.PropertyDefinition).%ExistsId(class_"||"_method)
]]></Implementation>
</Method>

<Method name="showheaders">
<Description><![CDATA[
Возвращает заголовки столбцов для элементов отображения
<var>skip</var> - Список подавляемых (невыводимых) столбцов через запятую]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Class,ID="",skip:%String="",AddArrow="",xml="",massiv,source="",show=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="showheadersErr"
 
 d:skip'=""
 . f i=1:1:$L(skip,",") d
 . . s skipField=$P(skip,",",i)
 . . s:skipField'="" SkipGlob(skipField)=1
 
 d:show'=""
 . f i=1:1:$L(show,",") d
 . . s showField=$P(show,",",i)
 . . s:showField'="" ShowGlob(showField)=1
 
 
 s glob=$NA(^GoodsPropOrder(Class))  //здесь лежит порядок отображения свойств
 
 s ExistTov=0
 d:ID]""
 . s tov=$ZOBJCLASSMETHOD(Class,"%OpenId",ID)
 . s ExistTov=1
 
 i source'="" d
 . s sourceclass=$P(source,"@",2)
 . i (sourceclass'="")&(+source>0) s sourcedoc=$ZOBJCLASSMETHOD(sourceclass,"%OpenId",+source)

 //класс от которого создается документ это инструкция 
 //по отбору, то выдадим инструкцию за товар и оттуда
 //возьмем все данные
 d:$G(sourceclass)="Docs.StorageOut"  
 . s tov=sourcedoc,ExistTov=1

 s cl=##class(%Dictionary.CompiledClass).%OpenId(Class)
 i '$ISOBJECT(cl) $$$WriteError("showheaders не удалось открыть объект "_Class_" класса %Dictionary.CompiledClass") q "Извините, внутренняя ошибка в программе"
 s count=cl.Properties.Count()
 f i=1:1:count d
 . q:cl.Properties.GetAt(i).Relationship
 . s Name=cl.Properties.GetAt(i).Name,oldName=Name
 . q:Name="%Concurrency"
 . s Type=cl.Properties.GetAt(i).Type
 . i $P(Type,".")="%Library" s Type="%"_$P(Type,".",2)  //После подмены ClassDefinition на CompiledClass то что было %String стало %Library.String, возвращаем всё к %String
 . q:$D(SkipGlob(Name))
 . s CAPTION=cl.Properties.GetAt(i).Parameters.GetAt("CAPTION")
 . //сформируем массив из ручных свойств
 . k pairs
 . f fi=2:1:$L(CAPTION,",") d
 . . s pair=$P(CAPTION,",",fi)
 . . q:$P(pair,"=")=""
 . . s pairs($P(pair,"="))=$P(pair,"=",2)
 . q:($G(pairs("display"))="none")&('$D(ShowGlob(Name)))
 . s massiv(Name)=Type
 . if (Name="Goods")&&(AddArrow)&&(Class'="Common.Dictionary8") s Name=Name_"->FullName"
 . else  s:(Type'["%")&('ExistTov)&(AddArrow) Name=Name_"->Name"
 . s xmlstr="<key>"_Name_"</key>"
 . s descr=cl.Properties.GetAt(i).Description
 . s str=Name_"~"_descr
 . s massiv(Name,"descr")=descr
 . s xmlstr=xmlstr_"<text>"_descr_"</text>"
 . s DISPLAYLIST=cl.Properties.GetAt(i).Parameters.GetAt("DISPLAYLIST")
 . s VALUELIST=cl.Properties.GetAt(i).Parameters.GetAt("VALUELIST")
 . s str=str_"~"
 . i (DISPLAYLIST'="")&(VALUELIST'="") d
 . . s str=str_"DISPLAYLIST="_DISPLAYLIST_";VALUELIST="_VALUELIST
 . . s xmlstr=xmlstr_"<Displaylist>"_DISPLAYLIST_"</Displaylist>"
 . . s xmlstr=xmlstr_"<Valuelist>"_VALUELIST_"</Valuelist>"
 . . s massiv(oldName,"VALUELIST")=VALUELIST
 . . s massiv(oldName,"DISPLAYLIST")=DISPLAYLIST
 . q:+$G(massiv)
 . s str=str_"~"
 . s ObjID=""
 . d:(source'="")&(Name="Kontr")
 . . i ($ISOBJECT(sourcedoc))&((sourceclass="Operation.Instructions")||(sourceclass="Operation.Plan")||(sourceclass="Docs.Prih")) d
 . . . s ValueObj=$ZOBJPROPERTY(sourcedoc,Name)
 . . . i $ISOBJECT(ValueObj) d
 . . . . s Value=$ZOBJPROPERTY(ValueObj,"Name")
 . . . . s ObjID=ValueObj.%Id()
 . . . s str=str_Value
 . d:(source'="")&(Name="Name")
 . . i ($ISOBJECT(sourcedoc))&((sourceclass="Operation.Plan")) d
 . . . s Value=$ZOBJPROPERTY(sourcedoc,"Name")
 . . . s str=str_Value
 . d:ExistTov
 . . s Value=$ZOBJPROPERTY(tov,Name)
 . . s:(Type="%Date")&(Value]"") Value=$ZD(Value,4)
 . . s:(Type="%Time")&(Value]"") Value=$ZT(Value)
 . . d:(Type'["%")&(Value'="")
 . . . s ObjID=Value.%Id()
 . . . i Type="Store.Address" s Value=##class(Store.Action).AddressPath(Value)   //если это адрес то формируем полную строку адреса
 . . . e  s Value=$ZOBJPROPERTY(Value,"Name")  //Если свойство объектная ссылка то извлекаем поле Name у ссылки
 . . s str=str_Value
 . s readonly=$D(pairs("readonly"))
 . s str=str_"~"_ObjID_"@"_Type_"@"_readonly
 . s xmlstr=xmlstr_"<type>"_Type_"</type>"
 . s xmlstr=xmlstr_"<readonly>"_readonly_"</readonly>"
 . //единицы измерения соответствующие данному полю
 . d ..getPropAlong(Name,.display,.values)
 . i display'="" s str=str_"~"_display,xmlstr=xmlstr_"<dispalong>"_display_"</dispalong>"
 . i values'="" s str=str_"~"_values,xmlstr=xmlstr_"<valuealong>"_values_"</valuealong>"
 . s str=str_"#@#"
 . s order=$G(@glob@(Name),$P(str,"~",1))
 . s:order="Name" order=0
 . s Props(order)=str
 . s XmlProps(order)=xmlstr

 s answer=""
 
 i xml d
 . s answer="<?xml version=""1.0"" encoding=""windows-1251"" ?><AllHeaders>"
 . s i="" f  s i=$O(XmlProps(i)) q:i=""  d
 . . s answer=answer_"<OneObject>"
 . . s answer=answer_XmlProps(i)
 . . s answer=answer_"</OneObject>"
 . s answer=answer_"</AllHeaders>"
 e  d
 . s i="" f  s i=$O(Props(i)) q:i=""  d
 . . s answer=answer_Props(i)
 
 //s ^mtempArt($I(^mtempArt),"answer")=answer
 //s ^mtempArt("")=
 
 q answer
showheadersErr
 $$$WriteError($ZE)
 q "Извините, ошибка при выводе заголовков"
]]></Implementation>
</Method>

<Method name="getPropAlong">
<ClassMethod>1</ClassMethod>
<FormalSpec>pname,disp,val</FormalSpec>
<Implementation><![CDATA[
 q:pname=""
 s val="",disp=""
 &sql(declare z cursor for select ID,Name,Factor into :ID,:Name,:Factor from Store.Measures where Type=:pname)
 &sql(open z)
 f  &sql(fetch z) q:SQLCODE  d
 . s disp=disp_"~"_Name
 . s val=val_"~"_ID_"|"_Factor
 &sql(close z)
 q
]]></Implementation>
</Method>

<Method name="SaveGoodsImage">
<ClassMethod>1</ClassMethod>
<FormalSpec>gid="",fname=""</FormalSpec>
<Implementation><![CDATA[
 q:fname=""
 q:gid=""
 s gobj=##class(Goods.Goods).%OpenId(gid)
 q:'$ISOBJECT(gobj)
 s currentimages=gobj.Images
 i currentimages'="" s delim="\"
 e  s delim=""
 s gobj.Images=currentimages_delim_fname
 s ok2=gobj.%Save()
 i '+ok2 $$$WriteObjError(ok2)
 q
]]></Implementation>
</Method>

<Method name="Count">
<ClassMethod>1</ClassMethod>
<FormalSpec>From="",Where=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CountErr",err="Извините, ошибка при подсчёте количества строк в запросе.",ok=1
 s rss=##class(%Library.ResultSet).%New()
 s sqlcount="select count(*) as strcount from "_From
 if Where'="" s sqlcount=sqlcount_" where "_Where
 s ok=rss.Prepare(sqlcount)
 
 i '+ok $$$WriteObjError(ok) q err
 s ok=rss.Execute()
 i '+ok $$$WriteObjError(ok) q err 
 while rss.Next(){
 s strcount=$G(rss.Data("strcount"))
 }
 q +$G(strcount)
CountErr
 $$$WriteError($ZE)
 q "Извините, ошибка при подсчёте количества строк в запросе."
]]></Implementation>
</Method>

<Method name="SetDetailAnalogRelation">
<Description>
Установить связь деталь-аналог</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DetailId:%String="",AnalogId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="SetDetailAnalogRelationErr"
 i '+DetailId q "Не указана заменяемая деталь"
 i '+AnalogId q "Не указан аналог"
 s answer=1
 f i=1:1:$L(AnalogId,"~")-1 q:'+answer  d  
 . s NewRelation=##class(Common.Dictionary4).%New()
 . d NewRelation.NameSetObjectId(DetailId)
 . d NewRelation.Property6625SetObjectId($P(AnalogId,"~",i))
 . s ok=NewRelation.%Save()
 . i $$$ISERR(ok) d
 . . Do DecomposeStatus^%apiOBJ(ok,.Err)
 . . s answer="Ошибка при сохранении связки деталь-аналог."
 . . i (Err(1,"code")=5808)&&(Err(1,"param",1)="Uniq") s answer=1
 q answer
SetDetailAnalogRelationErr
 q $ZE
]]></Implementation>
</Method>

<Method name="SaveGoodsDictionary">
<Description><![CDATA[
Выгрузить справочник товаров
<br>ClientFolder - номер клиента, то есть свойство Property2506 класса Common.Dictionary
<br>RptVersion - версия клиента Менеджер отчётов]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClientFolder="1",RptVersion=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="SaveGoodsDictionaryErr"
 d ..PrepareFolder(ClientFolder)
 s ClientUniqueCode=ClientFolder
 s KontrID=..GetKontrgentIdByCode(ClientUniqueCode)
 s ClientProperty2506=##class(Common.Kontragent).GetPropertyValue(KontrID,"Property2506")
 &sql(SELECT Property126->ActPriceInstrument,Property126->DiagPriceInstrument,Property127->ActPriceTechnic,Property127->DiagPriceTechnic,Property2506,Currency,%external(Currency) 
 	INTO :ActPriceInstrument,:DiagPriceInstrument,:ActPriceTechnic,:DiagPriceTechnic,:Property2506,:Currency,:CurrencyName
 	FROM Common.Kontragent 
 	WHERE ID=:KontrID)
 i SQLCODE s (ActPriceInstrument,DiagPriceInstrument,ActPriceTechnic,DiagPriceTechnic)=""
 s ClientFolder="C:\SKLAD\RemCl\"_ClientFolder_"\"
 s Delimeter="^"
 s glob=$NA(^Goods.GoodsD)
 s FullFileName=ClientFolder_"Goods.txt"
 s abbrListIndex=##class(Goods.Goods).GetPropertyListIndex("abbr")
 s Property3609ListIndex=##class(Goods.Goods).GetPropertyListIndex("Property3609")
 s NameListIndex=##class(Goods.Goods).GetPropertyListIndex("Name")
 s PriceListIndex=##class(Goods.Goods).GetPropertyListIndex("Price")
 s codedetailListIndex=##class(Goods.Goods).GetPropertyListIndex("codedetail")
 s izdelieListIndex=##class(Goods.Goods).GetPropertyListIndex("izdelie")
 s Property5300ListIndex=##class(Goods.Goods).GetPropertyListIndex("Property5300")
 s AllowToSendIndex=##class(Goods.Goods).GetPropertyListIndex("AllowToSend")
 s ok=1
	Set file=##class(%File).%New(FullFileName)
	s ok=file.Open("WSN")
	i '+ok $$$WriteObjError(ok) q "Ошибка при открытии файла "_FullFileName
	s CurrentGoodsVersion=..GetCurrentDictVersion("Goods.Goods")	//текущая версия справочника товаров
	if Property2506'[2 s (ActPriceInstrument,DiagPriceInstrument)=""
	if Property2506'[3 s (ActPriceTechnic,DiagPriceTechnic)=""
	s FirstStringInFile=CurrentGoodsVersion_"^"_ActPriceTechnic_"^"_DiagPriceTechnic_"^"_ActPriceInstrument_"^"_DiagPriceInstrument_"^"_Currency_"^"_CurrencyName
	Do file.WriteLine(FirstStringInFile)
 s i="" f  s i=$O(@glob@(i)) q:(i="")||('+ok)  d
 . s LBLine=@glob@(i)
 . s Name=$LG(LBLine,NameListIndex)
 . s abbr=$LG(LBLine,abbrListIndex)
 . s Property3609=$LG(LBLine,Property3609ListIndex)
 . s Price=$LG(LBLine,PriceListIndex)
 . s codedetail=$LG(LBLine,codedetailListIndex)
 . s Property5300=$LG(LBLine,Property5300ListIndex)	// Номер по схеме
 . //AllowToSend - определяет, можно ли использовать этот товар в заявках
 . s AllowToSend=+$LG(LBLine,AllowToSendIndex)	// Артём 29.02.2012
 . //раньше это поле брали просто из товара, а теперь берём с учётом контрагента
 . s kbanned='+##class(Goods.Goods).kbanned(i,KontrID)
 . //если товар запрещён к использованию, то его всё таки можно разрешить в интерфейсе "Ограничение использования запчастей контрагентами"
 . s AllowToSend=kbanned
 . s (ShowPrice,ShowClients)=1
 . s Groups=$$Groups(i,.ShowPrice,.ShowClients)
 . //пропускаем товары которые низя показывать клиентам
 . if (ShowClients'=0)&(ClientProperty2506'[ShowClients) q
 . i 'ShowPrice s Price="" 	//обнуляем цены которые низя показывать клиентам
 . s RemontPrice=..GetRemontPrice(ClientUniqueCode,$LG(LBLine,izdelieListIndex))
 . if i=27206 s ^mtempArt(KontrID)=AllowToSend
 . if i=27206 s ^mtempArt(KontrID,"kban")=kbanned
 . s Line=i_Delimeter_abbr_Delimeter_Property3609_Delimeter_Name_Delimeter_codedetail_Delimeter_Price_Delimeter_Groups_Delimeter_RemontPrice_Delimeter_Property5300_Delimeter_AllowToSend
 . s ok=file.WriteLine(Line)
 i '+ok $$$WriteObjError(ok) q "Ошибка при открытии файла."
 Do file.Close()
 q ..ArjFile(FullFileName,..GetPasswordFromCode(ClientUniqueCode))
Groups(GoodsID,ShowPrice,ShowClients)
 s return=""
 s IndexGlob=$NA(^Goods.GoodsGroupI("GoodsIndex",GoodsID))
 s z="" f  s z=$O(@IndexGlob@(z)) q:z=""  d
 . s GroupID=$LG(^Goods.GoodsGroupD(z),6)
 . s CatalogueID=$LG(^Goods.GroupD(GroupID),##class(Goods.Group).GetPropertyListIndex("Catalogue"))
 . //показывать цену клиентам
 . s ShowPrice=$LG(^Goods.CatalogueD(CatalogueID),##class(Goods.Catalogue).GetPropertyListIndex("ShowPrice"))
 . //показывать клиентам вообще
 . s ShowClients=$LG(^Goods.CatalogueD(CatalogueID),##class(Goods.Catalogue).GetPropertyListIndex("ShowClients"))
 . s return=return_GroupID_"~"
 q $E(return,1,$L(return)-1)
SaveGoodsDictionaryErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при выгрузке справочника товаров."
]]></Implementation>
</Method>

<Method name="GetRemontPrice">
<Description>
Получить цену ремонта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClientCode="",IzdelieID=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="GetRemontPriceErr"
 q:ClientCode="" 0
 q:IzdelieID="" 0
 //найдём ID контрагента опираясь на его уникальный код
 s KontrID=$O(^Common.KontragentI("CodeInd"," "_ClientCode, ""))
 i KontrID="" q 0
 
 //Проверим есть ли вообще такая ценовая группа
 q:'##class(Common.Dictionary12).%ExistsId(IzdelieID) 0
 
 //определим к какому типу относится эта ценовая группа товара
 //бытовка (1) или электроинструмент (2)
 s ThisGroupTypeIs=##class(Common.Dictionary12).GetPropertyValue(IzdelieID, "Razdel")
 s KontrCurrencyCode = ##class(Common.Kontragent).GetPropertyValue(KontrID, "Currency")
 if KontrCurrencyCode<=0 s KontrCurrencyCode=1
 
 //определим из какого поля контрагента вытаскивать его ценовую категорию
 //если группа принадлежит бытовой технике, тогда из поля Property127, иначе из Property126
 s KontragentCenaKateg = "Property126"
 if ThisGroupTypeIs = 1 s KontragentCenaKateg = "Property127"
 
 //узнаем к какой ремонтно-ценовой категории относится этот контрагент (это ссылка на спр. Common.Dictionary9)
 s PropertyCenaKategIndex=##class(Common.Kontragent).GetPropertyListIndex(KontragentCenaKateg,.DataLocation)
 s PriceTypeID=$LG(@DataLocation@(KontrID),PropertyCenaKategIndex)
 i PriceTypeID="" q 0
 
 //вытащим сначала ID записи из справочника, ЦЕНЫ ЗА РЕМОНТ
 s ID=$O(^Common.Dictionary8I("NewIndex1",PriceTypeID,IzdelieID,""))
 i ID="" q 0
 
 //KontrCurrencyCode - код валюты в которой работает контрагент, 1 - рубли, 2 - уе 
 //а потом значение, во втором индексе значение цены в рублях, в третьем - цена в долларах
 q +$LG(^Common.Dictionary8I("NewIndex1",PriceTypeID,IzdelieID,ID),KontrCurrencyCode+1)
GetRemontPriceErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="SaveGroupsDictionary">
<Description><![CDATA[
Выгрузить каталог и группу
<br>ClientFolder - номер клиента, то есть свойство Property2506 класса Common.Dictionary
<br>RptVersion - версия клиента Менеджер отчётов]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClientFolder="1",RptVersion=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 s $ZT="SaveGroupsDictionaryErr"
 s err="Ошибка при выгрузке групп"
 d ..PrepareFolder(ClientFolder)
 s ClientUniqueCode=ClientFolder
 s ClientFolder="C:\SKLAD\RemCl\"_ClientFolder_"\"
 s FullFileName=ClientFolder_"GoodsGr.txt"
 s Delimeter="^"
 	Set file=##class(%File).%New(FullFileName)
	s ok=file.Open("WSN")
	i '+ok $$$WriteObjError(ok) q "Ошибка при открытии файла "__FullFileName
	Do file.WriteLine(..GetCurrentDictVersion("Goods.Group"))
 
 s rs=##class(%ResultSet).%New()
 s ClientID=..GetKontrgentIdByCode(ClientUniqueCode)
 s ClientProperty2506=##class(Common.Kontragent).GetPropertyValue(ClientID,"Property2506")
 s SqlQuery="select ID,Catalogue->Name as CatalogueName,Name,Code from Goods.Group where depot=1 and (Catalogue->ShowClients=0 OR '"_ClientProperty2506_"' LIKE STRING('%',Catalogue->ShowClients,'%')) order by Catalogue,Code"
 s ok=rs.Prepare(SqlQuery)
 i '+ok $$$WriteObjError(ok) q err
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q err
 while rs.Next() {
 	s ID=rs.Data("ID")
 	s CatalogueName=rs.Data("CatalogueName")
 	s Name=rs.Data("Name")
 	s Code=rs.Data("Code")
 	s Line=ID_Delimeter_CatalogueName_Delimeter_Name_Delimeter_Code
 	Do file.WriteLine(Line)
 }
 Do file.Close()
 q ..ArjFile(FullFileName,..GetPasswordFromCode(ClientUniqueCode))
SaveGroupsDictionaryErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при выгрузке справочника товарных групп."
]]></Implementation>
</Method>

<Method name="GetCurrentDictVersion">
<Description><![CDATA[
Вернуть текущую версию справочника
<br><var>Dict</var> - справочник]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dict:%String=1</FormalSpec>
<Implementation><![CDATA[  q +$G(^Dictionaries(Dict))
]]></Implementation>
</Method>

<Method name="IncreaseCurrentDictVersion">
<Description><![CDATA[
Увеличить текущую версию справочника
<br><var>Dict</var> - справочник]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dict:%String=1</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s ^Dictionaries(Dict)=$G(^Dictionaries(Dict))+1
 q
]]></Implementation>
</Method>

<Method name="PrepareFolder">
<Description>
Проверить существование подпапки и создать (если че)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClientFolder=""</FormalSpec>
<Implementation><![CDATA[
 q:ClientFolder=""
 i '##class(%File).Exists("C:\SKLAD\RemCl\"_ClientFolder) d
 . d ##class(%File).CreateDirectory("c:\sklad\RemCl\"_ClientFolder)
 q
]]></Implementation>
</Method>

<Method name="ArjFile">
<Description>
упаковать файл с паролем</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String="",password:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="ArjFileErr"
 s FileWithoutExt=$P(file,".",1,$L(file,".")-1)
 i '##class(%File).Exists("c:\pkzip25.exe") q "Ошибка. Отсутствует c:\pkzip25.exe"
 //i '##class(%File).Exists("c:\7z.exe") q "Ошибка. Отсутствует c:\7z.exe"
 //s CommandString="c:\7z.exe a -t7z -p"_password_" "_FileWithoutExt_".zip "_file_" >c:\cachesys\csp\sklad2\1.txt"
 s CommandString="c:\pkzip25.exe -add -NoFix -move -pass="_password_" "_FileWithoutExt_".zip "_file_" >c:\cachesys\csp\sklad2\1.txt"
 //тут такое дело - старая версия Менеджера отчётов, не присылала версию и одновременно работала 
 //и одновременно работала с ARJ поэтому такой финт ногами, смотрим в %request версию и определяем чем паковать
 s CurrentVersion=$S($ISOBJECT($G(%request)):%request.Get("CurrentVersion"),1:"нет %request")
 if CurrentVersion="" s CommandString="c:\arj.exe a -d -y -g:"_password_" "_FileWithoutExt_".arj "_file_" >c:\cachesys\csp\sklad2\1.txt"
 //i '##class(%File).Exists("c:\arj.exe") q "Ошибка. Отсутствует c:\arj.exe"
 d $ZF(-1,CommandString)
 q 1
ArjFileErr
 $$$WriteError($ZE)
 q "Ошибка при архивировании файла."
]]></Implementation>
</Method>

<Method name="GetPasswordFromCode">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ClientCode:%String="",&ClientID:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s ClientID=..GetKontrgentIdByCode(ClientCode)
 q:ClientID="" ""
 q $LG($G(^Common.KontragentD(ClientID)),38)
]]></Implementation>
</Method>

<Method name="GetKontrgentIdByCode">
<Description>
Получить ID контрагента по его уникальному коду</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClientCode=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ClientCode="" ""
 q $O(^Common.KontragentI("CodeInd"," "_ClientCode,""))
]]></Implementation>
</Method>

<Method name="PlugArchiveBase">
<Description>
Получить запрос CSP странички, запустить метод в отдельном JOB</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ArchivePath:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="PlugArchiveBaseErr"
 if ArchivePath="" q ^ArchivePath
 if $E($G(^ArchivePath,"stop"),1,4)'="stop" q ^ArchivePath
 j ##class(Common.Common).CopyAndMountArchive(ArchivePath)
 q ^ArchivePath
PlugArchiveBaseErr
 s ^Errors($H,$ZNAME)=$ZE
 s ^ArchivePath="stopИзвините. Ошибка при подключении архивной базы"
 q
]]></Implementation>
</Method>

<Method name="CopyAndMountArchive">
<Description>
Размонтировать, разархивировать и смонтировать область SKLAD</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ArchivePath:%String=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CopyAndMountArchiveErr"
 if ArchivePath="" s ^ArchivePath="stopОшибка. Не указана архивная база данных." q
 s ^ArchivePath="Запуск "_$ZDT($H,4)
 
 //проверяем наличие архива с базой
 s source=ArchivePath_"\"_"Sklad_cache.rar"
 if '##class(%File).Exists(source) s ^ArchivePath="stopНе найден файл с архивом базы "_source q
 s destination=$P($zu(86),"\",1,2)_"\mgr\SKLAD\"
 
 //размонтируем SKLAD
 s ^ArchivePath="Подготавливается архивная база для приёма архивных данных."
 s ok=$ZU(3,destination)
 if '+ok s ^ArchivePath="stopНевозможно подготовить архивную базу для приёма архивных данных." q
  
 //разархивируем архивную базу прям в mgr\sklad
 s ^ArchivePath="Идёт процесс разархивации данных. Пожалуйста ждите. "_$ZT($P($H,",",2))
 //разархивировать с ключами: заменять существующие файлы, не выводить сообщения об ошибках
 d $ZF(-1,"c:\progra~1\winrar\winrar e -o+ -inul "_source_" "_destination)	//копируем source в destination
 
 //монтируем SKLAD
 s ^ArchivePath="Данные разархивированы, подготавливается архивная база."
 s ok=$zu(17,destination,0,0)
 if '+ok s ^ArchivePath="stopНевозможно подготовить к работе архивную базу после приёма архивных данных." q
 
 s ^ArchivePath="stopАрхивная база "_ArchivePath_" успешно подключена"
 q
CopyAndMountArchiveErr
 s ^Errors($H,$ZNAME)=$ZE
 s ^ArchivePath="stopИзвините. Ошибка при подключении архивной базы."
 q
]]></Implementation>
</Method>

<Method name="GetRequestStatus">
<ClassMethod>1</ClassMethod>
<FormalSpec>RequestIDs,KontrId</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetRequestStatusErr"
 
 //цикл по переданным ID заявок
 f i=1:1:$L(RequestIDs,",") d
 . s Request = $TR($P(RequestIDs,",",i),"'","")	//ID и номер заявки
 . s ReqsAgain=$G(ReqsAgain)_+Request_","		//сливаем несколько ID в одну строку
 . s ReqId = +Request							//ID заявки
 . s ReqNumber = $P(Request,"#",2)				//номер заявки
 . if $G(st,"undefined")'="undefined" w ","
 . s (st,HasBeenSent,cnt)=""
 . //w i_" "_"ReqId="_ReqId_$C(9)_"ReqNumber="_ReqNumber,!
 . if +ReqId d
 . . //w $C(9)_"ID"
 . . &sql(select %External(State),%External(HasBeenSent),RefuseReason into :st,:HasBeenSent,:RefuseReason from Operation.Instructions where ID=:ReqId and Kontr=:KontrId)
 . else  if +ReqNumber d
 . . &sql(select %External(State),%External(HasBeenSent),count(id),RefuseReason into :st,:HasBeenSent,:cnt,:RefuseReason from Operation.Instructions where Kontr=:KontrId and Name=:ReqNumber)
 . . //w $C(9)_"Name"_$C(9)_"cnt="_cnt
 . . if cnt>1 s st="Ошибка проверки."
 . if $G(SQLCODE) s (st,HasBeenSent,cnt)=""
 . w st
 . w:HasBeenSent'="" ". ("_HasBeenSent_")"
 . s RR(i) = $G(RefuseReason)
 w ","
 f i=1:1:$L(RequestIDs,",") d
 . w "^",RR(i)
 q
 // $G(answer)
 
 s ReqsAgain=$E(ReqsAgain,1,$L(ReqsAgain)-1)
 
 s sql="select id,%External(State) as st,%External(HasBeenSent) as HasBeenSent from Operation.Instructions where id in ("_$G(ReqsAgain)_")"
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql)
 if '+ok $$$WriteObjError(ok) q "Извините. Ошибка при извлечении статуса заявок."
 s ok=rs.Execute()
 if '+ok $$$WriteObjError(ok) q "Извините. Ошибка при извлечении статуса заявок."
 while rs.Next() 
 {
	s HasBeenSent = rs.Data("HasBeenSent")
 	s answer=$G(answer)_rs.Data("st")
 	s:HasBeenSent'="" answer=$G(answer)_". ("_HasBeenSent_")"
 	s answer=$G(answer)_","
 }
 q $G(answer)
GetRequestStatusErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при извлечении статуса заявок."
]]></Implementation>
</Method>

<Method name="GeneratePassword">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 f i=1:1:8 d
 . if $R(2) s char=$C($R(26)+65)
 . else  s char=$R(9)+1
 . s str=$G(str)_char
 q str
]]></Implementation>
</Method>

<Method name="GetOtchetStatus">
<Description>
Вывести состояние одного найденного отчёта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocName:%String="",KontragentId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &sql(SELECT Stat,ErrorDescription into :Stat,:ErrorDescription 
 	FROM Docs.Otchet 
 	WHERE Name=:DocName and Kontr=:KontragentId
 	ORDER BY ID DESC)
 if SQLCODE q "Невозможно найти отчёт "_DocName_". Состояние отчёта неизвестно."
 q "Ok"_Stat_$C(9)_ErrorDescription
]]></Implementation>
</Method>

<Method name="GetGoodRemontPriceForKontr">
<Description>
Получить цену за ремонт данног товара для данного контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId=0,KontrId=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if GoodsId = 0 q "Не указан товар"
 if KontrId = 0 q "Не указан контрагент"
 &sql(select izdelie into :izdelie from Goods.Goods where ID = :GoodsId)
 if SQLCODE q "Ошибка при поиске товара "_GoodsId
 &sql(select Code into :Code from Common.Kontragent where ID = :KontrId)
 if SQLCODE q "Ошибка при поиске контрагента "_KontrId
 q ..GetRemontPrice(Code,izdelie)
]]></Implementation>
</Method>

<Method name="ExportImages">
<Description><![CDATA[
запуск ExportImages
Экспортировать изображения товаров в указанную директорию
<br> Root - папка куда лягут картинки
<br> ExportForMO - флажок указывающий на то, что экспортировать надо в одну папку, причём без названий товаров]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Root,ExportForMO</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  s glob=$Na(^mtempReport($J))	
  k @glob
  j ##class(Common.Common).ExportImages2(Root, ExportForMO, glob)
  q $J
]]></Implementation>
</Method>

<Method name="ExportImages2">
<Description><![CDATA[
Экспортировать изображения товаров в указанную директорию
<br> Root - папка куда лягут картинки
<br> ExportForMO - флажок указывающий на то, что экспортировать надо в одну папку, причём без названий товаров
<br> glob - глобал в который будут записаны результаты]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Root,ExportForMO,glob</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 //n GoodsId,Images,FullName,ok,Delimeter,i,Root,DestinationDir,FilesDir,
 //CurrentImageFile,LineTerminator,Rest
  s $ZT="ExportImagesErr"
  s Root=$G(Root,"c:\Goods\")
  if $E(Root,$L(Root))'="\" s Root=Root_"\"
  s Rest="Прочее"
  s FilesDir="C:\CacheSys\CSP\sklad2\GoodsImages\"
  s Error=""
  s LineTerminator=$C(13,10)
  &sql(declare zz cursor for
  select ID,Images,FullName,Name
  into :GoodsId,:Images,:FullName,:Name
  from Goods.Goods where Images<>'')
  &sql(open zz)
  f  &sql(fetch zz) q:SQLCODE  d
  . if ExportForMO d
  . . s DestinationDir=Root
  . else  d
  . . s GroupFullName=..GetGroupFullName(GoodsId)
  . . s DestinationDir=Root_GroupFullName_"\"
  . . s ok=##class(%File).CreateDirectoryChain(DestinationDir)
  . . if '+ok d 
  . . . s DestinationDir=Root_Rest
  . . . s ok=##class(%File).CreateDirectoryChain(DestinationDir)
  . . . if '+ok s Error=Error_"Ошибка подготовки каталога "_DestinationDir_" для : "_FullName_LineTerminator q
  . f i=1:1:$L(Images,"\") d
  . . s CurrentImageFile=$P(Images,"\",i)
  . . s NewFileExtention = $P(CurrentImageFile,".",$L(CurrentImageFile,"."))
  . . //если для МО то название по простому
  . . if ExportForMO s NewFileName=GoodsId_"_"_i
  . . else  d
  . . . s NewFileName=GoodsId_"^"_Name
  . . . if $L(Images,"\")>1 s NewFileName=NewFileName_" ("_i_")"
  . . s NewFileName=$TR(NewFileName,"\/:*?:<>|","")
  . . s ok = ##class(%File).CopyFile(FilesDir_CurrentImageFile,DestinationDir_NewFileName_"."_NewFileExtention)
  . . if 'ok d
  . . . s Error=Error_"Ошибка копирования "_CurrentImageFile_" из "_FilesDir_" в "_DestinationDir_LineTerminator
  . . . //s ^mtempArt($i(^mtempArt))=FilesDir_CurrentImageFile_","_DestinationDir_NewFileName_"."_NewFileExtention
  &sql(close zz)
  if $L(Error)>2000 s Error=$E(Error,1,2000)_"..."
  s @glob=Error
  if Error="" s @glob="Все изображения были экспортированы." q 1
  q Error
ExportImagesErr
 $$$WriteError($ZE)
 s @glob = "Извините, ошибка при экспорте изображений."
 q
]]></Implementation>
</Method>

<Method name="GetGroupFullName">
<Description>
Получить имя директории для изображения товара</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if GoodsId="" q ""
 //n Delimeter,GroupFullName,i
 s Delimeter=$C(9)
 &sql(select Groups,Common.SqlProcs_GroupFullName(Groups,:Delimeter) into :Groups,:GroupFullName from Goods.GoodsGroup where Goods=:GoodsId)
 //w FullName_" = "_$TR(GroupFullName,$C(9),"/"),!
 //удалим 
 f i="\","/",":","*","?",":","<",">","|" d
 . s GroupFullName=$TR(GroupFullName,i,"_")
 s GroupFullName=$TR(GroupFullName,$C(9),"\")
 q GroupFullName
]]></Implementation>
</Method>

<Method name="SetGarantDisabled">
<Description>
установить гарантийному талону статус "Недействителен"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Garant="",SetClosingUser=1</FormalSpec>
<Implementation><![CDATA[
	s $ZT="SetGarantDisabledErr"
	if $ISOBJECT(Garant) s GarantObj=Garant,GarantId=Garant.%Id()
	else  s GarantId=Garant,GarantObj=##class(Common.Dictionary2).%OpenId(Garant)
	
	if '$ISOBJECT(GarantObj) q "Невозможно найти гарантийный талон "_Garant
	
	s GarantObj.Property9194=2
	s GarantObj.CloseDat=+$H
	s GarantObj.CloseTime=$p($H,",",2)
	s:SetClosingUser GarantObj.CloseUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
	
	s ok=GarantObj.%Save()
	i '+ok $$$WriteObjError(ok) q "Ошибка при сохранении гарантийного талона "_GarantId
	q 1
SetGarantDisabledErr
 $$$WriteError($ZE)
 q "Извините, ошибка при установке статуса ""Недействительный"" гарантийному талону"
]]></Implementation>
</Method>

<Method name="AddGoodsToKontr">
<Description>
Добавить товары на баланс контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>KontrId="",GoodsString="",quant=0</FormalSpec>
<Implementation><![CDATA[
	s $ZT="AddGoodsToKontrErr"
		s ^mtempArt("AddGoodsToKontr",KontrId,GoodsString)=quant
	
	if '+KontrId q "Невозможно зачислить запчасти на баланс, так как не указан контрагент."
	if '+GoodsString q "Невозможно зачислить запчасти на баланс, так как они не указаны."
	s user = $S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
	for i=1:1:$L(GoodsString,"#@#")
	{
		s GoodsId = +$P(GoodsString,"#@#",i)
		CONTINUE:'+GoodsId
		if $D(^t(KontrId,GoodsId)) CONTINUE
		s ^t(KontrId,GoodsId)=quant
		s count=$i(^t(KontrId,GoodsId,"count"))
		s ^t(KontrId,GoodsId,count,"user")=user
		s ^t(KontrId,GoodsId,count,"datetime")=$H
	}
	q 1
AddGoodsToKontrErr
 $$$WriteError($ZE)
 q "Извините, ошибка при попытке зачислить товары на баланс."
]]></Implementation>
</Method>

<Method name="RemoveGoodsFromKontr">
<Description>
Снять товары с баланса контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>KontrId="",GoodsString="",quant=0</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
	n user,GoodsId,i,count
	
	s $ZT="RemoveGoodsFromKontrErr"
	if '+KontrId q "Невозможно зачислить запчасти на баланс, так как не указан контрагент."
	if '+GoodsString q "Невозможно зачислить запчасти на баланс, так как они не указаны."
	if '$D(^t(KontrId)) q "Данный контрагент не имеет запчастей на балансе"
	s user = $S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
	for i=1:1:$L(GoodsString,"#@#")
	{
		s GoodsId = $P(GoodsString,"#@#",i)
		CONTINUE:'+GoodsId
		CONTINUE:'+$D(^t(KontrId,GoodsId))
		//if $D(^t(KontrId,GoodsId)) CONTINUE
		
		
		//счётчик истории изменений
		s count=$i(^tHistory(KontrId,GoodsId,"count"))
		
		// копируем в историю
		m ^tHistory(KontrId,GoodsId,count,"history")=^t(KontrId,GoodsId)
		s ^tHistory(KontrId,GoodsId,count,"user")=user
		s ^tHistory(KontrId,GoodsId,count,"datetime")=$H
				
		//если указали больше одной строки
		//то снимаемое количество это текущее количество на балансе
		if $L(GoodsString,"#@#")>2 s quant=$G(^t(KontrId,GoodsId))
		
		//снимаем нужное количество с баланса
		s ^t(KontrId,GoodsId)=^t(KontrId,GoodsId)-quant
		
		//если остался ноль, то удаляем строчку
		k:'+^t(KontrId,GoodsId) ^t(KontrId,GoodsId)
	}
	q 1
RemoveGoodsFromKontrErr
 $$$WriteError($ZE)
 q "Извините, ошибка при попытке снять товары с баланса контрагента."
]]></Implementation>
</Method>

<Method name="SaveDocsImage">
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,filename</FormalSpec>
<Implementation><![CDATA[
	s DocObj = ##class(Docs.Super).%OpenId(DocId)
	if '$ISOBJECT(DocObj)
	{
		$$$WriteError("SaveDocsImage Не открылся документ "_DocId)
		quit
	}
	s DocObj.Images=DocObj.Images_"\"_filename
	s ok = DocObj.%Save()
	if '+ok $$$WriteObjError(ok)
	q
]]></Implementation>
</Method>
</Class>


<Class name="Common.Dictionary1">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60368,43326</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary1D</DataLocation>
<DefaultData>Dictionary1DefaultData</DefaultData>
<IdLocation>^Common.Dictionary1D</IdLocation>
<IndexLocation>^Common.Dictionary1I</IndexLocation>
<StreamLocation>^Common.Dictionary1S</StreamLocation>
<Data name="Dictionary1DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property7023</Value>
</Value>
<Value name="4">
<Value>Property5710</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary10">
<Description>
Разобранные товары</Description>
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60534,42983</TimeCreated>

<Property name="Name">
<Description>
Номер товара</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Номер товара"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="Property7148">
<Description>
Запчасть</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Запчасть"/>
</Property>

<Index name="Property7148Ind">
<Properties>Property7148</Properties>
</Index>

<Property name="Property8836">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="Property8836Ind">
<Properties>Property8836</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary10D</DataLocation>
<DefaultData>Dictionary10DefaultData</DefaultData>
<IdLocation>^Common.Dictionary10D</IdLocation>
<IndexLocation>^Common.Dictionary10I</IndexLocation>
<StreamLocation>^Common.Dictionary10S</StreamLocation>
<Data name="Dictionary10DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property8836</Value>
</Value>
<Value name="4">
<Value>Property7148</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary11">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60619,59215</TimeCreated>

<Property name="Name">
<Description>
Состояние</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Состояние"/>
</Property>

<Property name="Property3033">
<Description>
Код</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Код"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary11D</DataLocation>
<DefaultData>Dictionary11DefaultData</DefaultData>
<IdLocation>^Common.Dictionary11D</IdLocation>
<IndexLocation>^Common.Dictionary11I</IndexLocation>
<StreamLocation>^Common.Dictionary11S</StreamLocation>
<Data name="Dictionary11DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property3033</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary12">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60643,52734</TimeCreated>

<Property name="Name">
<Description>
Изделие</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Изделие"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="Razdel">
<Description>
Раздел</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Бытовая техника,Электроинструмент"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="RazdelIndex">
<Properties>Razdel</Properties>
</Index>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG($G(@DataLocation@(ID)),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary12D</DataLocation>
<DefaultData>Dictionary12DefaultData</DefaultData>
<IdLocation>^Common.Dictionary12D</IdLocation>
<IndexLocation>^Common.Dictionary12I</IndexLocation>
<StreamLocation>^Common.Dictionary12S</StreamLocation>
<Data name="Dictionary12DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Razdel</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary13">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60643,55217</TimeCreated>

<Property name="Name">
<Description>
Тип платежа</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Тип платежа"/>
</Property>

<Property name="Property2274">
<Description>
Пояснение</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Пояснение"/>
<Parameter name="MAXLEN" value="400"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Index name="Property2274Ind">
<Properties>Property2274</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary13D</DataLocation>
<DefaultData>Dictionary13DefaultData</DefaultData>
<IdLocation>^Common.Dictionary13D</IdLocation>
<IndexLocation>^Common.Dictionary13I</IndexLocation>
<StreamLocation>^Common.Dictionary13S</StreamLocation>
<Data name="Dictionary13DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property2274</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary14">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60701,39416</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Property3212">
<Description>
Файл</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Файл"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Index name="Property3212Ind">
<Properties>Property3212</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary14D</DataLocation>
<DefaultData>Dictionary14DefaultData</DefaultData>
<IdLocation>^Common.Dictionary14D</IdLocation>
<IndexLocation>^Common.Dictionary14I</IndexLocation>
<StreamLocation>^Common.Dictionary14S</StreamLocation>
<Data name="Dictionary14DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property3212</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary15">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60778,62993</TimeCreated>

<Property name="Name">
<Description>
Товары</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Товары"/>
</Property>

<Property name="Property1490">
<Description>
Дата приема</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value="Дата приема"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="Property6403">
<Description>
Количество</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Количество"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Index name="Property1490Ind">
<Properties>Property1490</Properties>
</Index>

<Index name="Property6403Ind">
<Properties>Property6403</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary15D</DataLocation>
<DefaultData>Dictionary15DefaultData</DefaultData>
<IdLocation>^Common.Dictionary15D</IdLocation>
<IndexLocation>^Common.Dictionary15I</IndexLocation>
<StreamLocation>^Common.Dictionary15S</StreamLocation>
<Data name="Dictionary15DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Property1490</Value>
</Value>
<Value name="3">
<Value>Property4876</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>Property6403</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary16">
<Description>
История курса USD</Description>
<Super>%Persistent</Super>
<TimeCreated>61438,58034.12288</TimeCreated>

<Property name="Name">
<Description>
Курс</Description>
</Property>

<Property name="Dat">
<Description>
Дата</Description>
<Type>%Library.Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="Dat">
<Properties>Dat</Properties>
</Index>

<Method name="Get">
<Description>
Вернуть курс доллара по состоянию на дату</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>date:%Date</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s factor="" 
	&sql(Select Top 1 Name Into :factor From Common.Dictionary16 Where Dat<=:date Order By Dat Desc)
 Q:SQLCODE=0 factor
 Q ""
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary16D</DataLocation>
<DefaultData>Dictionary16DefaultData</DefaultData>
<IdLocation>^Common.Dictionary16D</IdLocation>
<IndexLocation>^Common.Dictionary16I</IndexLocation>
<StreamLocation>^Common.Dictionary16S</StreamLocation>
<Data name="Dictionary16DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Dat</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary18">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>61681,51917</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary18D</DataLocation>
<DefaultData>Dictionary18DefaultData</DefaultData>
<IdLocation>^Common.Dictionary18D</IdLocation>
<IndexLocation>^Common.Dictionary18I</IndexLocation>
<StreamLocation>^Common.Dictionary18S</StreamLocation>
<Data name="Dictionary18DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary19">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>61720,45343</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary19D</DataLocation>
<DefaultData>Dictionary19DefaultData</DefaultData>
<IdLocation>^Common.Dictionary19D</IdLocation>
<IndexLocation>^Common.Dictionary19I</IndexLocation>
<StreamLocation>^Common.Dictionary19S</StreamLocation>
<Data name="Dictionary19DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary2">
<Description>
Справочник гарантийных талонов</Description>
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60373,43165</TimeCreated>

<Property name="remont1">
<Description>
1 заявка</Description>
<Type>Docs.Remont</Type>
</Property>

<Property name="remont2">
<Description>
2 заявка</Description>
<Type>Docs.Remont</Type>
</Property>

<Property name="remont3">
<Description>
3 заявка</Description>
<Type>Docs.Remont</Type>
</Property>

<Property name="remont1otch">
<Description>
1 отчет</Description>
<Type>Docs.Otchet</Type>
</Property>

<Property name="remont2otch">
<Description>
2 отчет</Description>
<Type>Docs.Otchet</Type>
</Property>

<Property name="remont3otch">
<Description>
3 отчет</Description>
<Type>Docs.Otchet</Type>
</Property>

<Property name="remont4otch">
<Description>
4 отчет</Description>
<Type>Docs.Otchet</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="Act">
<Description>
Акт технического осмотра</Description>
<Type>Docs.Act</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="Utiliz">
<Description>
Акт утилизации</Description>
<Type>Docs.Utiliz</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="Name">
<Description>
Серийный номер</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Номер"/>
</Property>

<Index name="garantInd">
<Description>
Имя индекса используется в коде serials.csp !!!
Отключил ибо бессмыссленно [ Data = Name ]
Нашел такое //Index NewIndex1 On Name [ IdKey, Unique ];
ВНИМАНИЕ!!! Путаница в наименованиях</Description>
<Properties>Name</Properties>
</Index>

<Property name="Property5330">
<Description>
Контрагент</Description>
<Type>Common.Kontragent</Type>
<Parameter name="CAPTION" value="Контрагент"/>
</Property>

<Property name="Property8550">
<Description>
Дата выдачи</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value="Дата выдачи"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="Property9194">
<Description>
Актуальность</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="CAPTION" value="Актуальность"/>
<Parameter name="DISPLAYLIST" value=",Действителен,Не действителен"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="serial">
<Description>
Гарантийный номер</Description>
<Type>%String</Type>
</Property>

<Index name="serialInd">
<Description>
Имя индекса используется в коде serials.csp !!!
Используется для прямого доступа в csp.WarrantyCardImport
csp.CheckSerial3
ВНИМАНИЕ!!! Путаница в наименованиях</Description>
<Data>Name</Data>
<Properties>serial</Properties>
<Unique>1</Unique>
</Index>

<Method name="DirectGetIdBySerial">
<Description>
Пример получения ид гарантийного (csp.CheckSerial3.cls)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    s serial = " "_$ZCVT(serial,"U")
    s id = $o(^Common.Dictionary2I("serialInd", serial, ""))
    Q id
]]></Implementation>
</Method>

<Property name="tovar">
<Description>
Модель изделия</Description>
<Type>%String</Type>
</Property>

<Property name="Dat">
<Description>
Дата создания</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
</Property>

<Index name="Dat">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время создания</Description>
<Type>%Time</Type>
<InitialExpression>$P($H,",",2)</InitialExpression>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="Tim">
<Properties>Tim</Properties>
</Index>

<Property name="CloseDat">
<Description>
Дата недействительного статуса</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="CloseTime">
<Description>
Время недействительного статуса</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="CloseUser">
<Description>
Оператор установивший недействительный статус</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="Comment">
<Description>
Примечание</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Property name="CloseReason">
<Description>
Причина закрытия</Description>
<Type>%String</Type>
</Property>

<Property name="SaleDate">
<Description>
Дата продажи</Description>
<Type>%Date</Type>
</Property>

<Method name="Delete">
<Description>
Удаление гарантийного талона с проверками</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
     if '..%ExistsId(id) Q $$$ERROR($$$GeneralError,"Нет такого гарантийного талона")
     #;проверки
     s inInstructions=##class(Operation.InstructionsItems).HasGarant(id)
     Q:inInstructions $$$ERROR($$$GeneralError,"Гарантийный талон используется в заявках")
     s inOtchetItems=##class(Docs.OtchetItems).HasGarant(id)
     Q:inOtchetItems $$$ERROR($$$GeneralError,"Гарантийный талон используется в отчетах")
     s inActs=##class(Docs.Act).HasGarant(id)
     Q:inActs $$$ERROR($$$GeneralError,"Гарантийный талон используется в актах")
     Q ..%DeleteId(id)
]]></Implementation>
</Method>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation:%String="",&IndexLocation:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" s IndexLocation="""_%compiledclass.Storages.GetAt(1).IndexLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
    s PropertyName=data.Value
    s ListIndex=data.Name
    Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
    s data=StorageData.Values.GetNext(.number)
    }   
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String="",PropertyNumber:%String="",DataLocation:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 if ('+PropertyNumber)||(DataLocation="") s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG($G(@DataLocation@(ID)),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Method name="%OnBeforeSave">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%Save</METHOD> method to 
provide notification that the object is being saved. It is called before 
any data is written to disk.

<P><VAR>insert</VAR> will be set to 1 if this object is being saved for the first time.

<P>If this method returns an error then the call to <METHOD>%Save</METHOD> will fail.]]></Description>
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    if ##this.Property9194=2,'+##this.CloseDat
    {
        s ##this.CloseDat=+$H
        s ##this.CloseTime=$P($H,",",2)
        if $ISOBJECT($G(%session)) 
        {
            //d ##this.CloseUserSetObjectId($G(%session.Data("user")))
        }
    }
    Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary2D</DataLocation>
<DefaultData>Dictionary2DefaultData</DefaultData>
<IdLocation>^Common.Dictionary2D</IdLocation>
<IndexLocation>^Common.Dictionary2I</IndexLocation>
<StreamLocation>^Common.Dictionary2S</StreamLocation>
<Data name="Dictionary2DefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property5330</Value>
</Value>
<Value name="4">
<Value>Property8550</Value>
</Value>
<Value name="5">
<Value>Property9194</Value>
</Value>
<Value name="6">
<Value>Property742</Value>
</Value>
<Value name="7">
<Value>Property1184</Value>
</Value>
<Value name="8">
<Value>Property7407</Value>
</Value>
<Value name="9">
<Value>Property8673</Value>
</Value>
<Value name="10">
<Value>remont1</Value>
</Value>
<Value name="11">
<Value>remont2</Value>
</Value>
<Value name="12">
<Value>remont3</Value>
</Value>
<Value name="13">
<Value>serial</Value>
</Value>
<Value name="14">
<Value>tovar</Value>
</Value>
<Value name="15">
<Value>remont1otch</Value>
</Value>
<Value name="16">
<Value>remont2otch</Value>
</Value>
<Value name="17">
<Value>remont3otch</Value>
</Value>
<Value name="18">
<Value>Dat</Value>
</Value>
<Value name="19">
<Value>Tim</Value>
</Value>
<Value name="20">
<Value>remont4otch</Value>
</Value>
<Value name="21">
<Value>Act</Value>
</Value>
<Value name="22">
<Value>CloseDat</Value>
</Value>
<Value name="23">
<Value>CloseTime</Value>
</Value>
<Value name="24">
<Value>CloseUser</Value>
</Value>
<Value name="25">
<Value>Comment</Value>
</Value>
<Value name="26">
<Value>Utiliz</Value>
</Value>
<Value name="27">
<Value>CloseReason</Value>
</Value>
<Value name="28">
<Value>SaleDate</Value>
</Value>
</Data>
<Property name="Name"/>
<Property name="Property5330"/>
<Property name="Property8550"/>
<Property name="Property9194"/>
<Property name="remont1"/>
<Property name="remont1otch"/>
<Property name="remont2"/>
<Property name="remont2otch"/>
<Property name="remont3"/>
<Property name="remont3otch"/>
<Property name="serial"/>
<Property name="tovar"/>
</Storage>
</Class>


<Class name="Common.Dictionary20">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>62496,82402</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary20D</DataLocation>
<DefaultData>Dictionary20DefaultData</DefaultData>
<IdLocation>^Common.Dictionary20D</IdLocation>
<IndexLocation>^Common.Dictionary20I</IndexLocation>
<StreamLocation>^Common.Dictionary20S</StreamLocation>
<Data name="Dictionary20DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary4">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60400,63326</TimeCreated>

<Property name="Name">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="Property6625">
<Description>
Аналог</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Аналог"/>
</Property>

<Index name="Property6625Ind">
<Properties>Property6625</Properties>
</Index>

<Index name="Uniq">
<Properties>Name,Property6625</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary4D</DataLocation>
<DefaultData>Dictionary4DefaultData</DefaultData>
<IdLocation>^Common.Dictionary4D</IdLocation>
<IndexLocation>^Common.Dictionary4I</IndexLocation>
<StreamLocation>^Common.Dictionary4S</StreamLocation>
<Data name="Dictionary4DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property6625</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary5">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60402,63112</TimeCreated>

<Property name="Name">
<Description>
ФИО</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="ФИО"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary5D</DataLocation>
<DefaultData>Dictionary5DefaultData</DefaultData>
<IdLocation>^Common.Dictionary5D</IdLocation>
<IndexLocation>^Common.Dictionary5I</IndexLocation>
<StreamLocation>^Common.Dictionary5S</StreamLocation>
<Data name="Dictionary5DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property3985</Value>
</Value>
<Value name="4">
<Value>Property4215</Value>
</Value>
<Value name="5">
<Value>Property3715</Value>
</Value>
<Value name="6">
<Value>Property5768</Value>
</Value>
<Value name="7">
<Value>Property7689</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary6">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60407,58319</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Property4139">
<Description>
Пояснение</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Пояснение"/>
<Parameter name="DISPLAYLIST" value=",Основная продажная, "/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary6D</DataLocation>
<DefaultData>Dictionary6DefaultData</DefaultData>
<IdLocation>^Common.Dictionary6D</IdLocation>
<IndexLocation>^Common.Dictionary6I</IndexLocation>
<StreamLocation>^Common.Dictionary6S</StreamLocation>
<Data name="Dictionary6DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property4139</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary7">
<Description>
Как оплачено по гарантии или платно</Description>
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60408,57864</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary7D</DataLocation>
<DefaultData>Dictionary7DefaultData</DefaultData>
<IdLocation>^Common.Dictionary7D</IdLocation>
<IndexLocation>^Common.Dictionary7I</IndexLocation>
<StreamLocation>^Common.Dictionary7S</StreamLocation>
<Data name="Dictionary7DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary8">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60526,37094</TimeCreated>

<Property name="Name">
<Description>
Ценовая категория контрагента</Description>
<Type>Common.Dictionary9</Type>
<Parameter name="CAPTION" value="Категория"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="Property2969">
<Description>
цена</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена руб"/>
</Property>

<Property name="PriceUE">
<Description>
цена уе</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена уе"/>
</Property>

<Property name="Goods">
<Description>
Товар</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="GoodsInd">
<Properties>Goods</Properties>
</Index>

<Property name="GoodsCateg">
<Description>
Категория товара</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=", -,Электроинструмент,Бытовая техника"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Index name="GoodsCategInd">
<Properties>GoodsCateg</Properties>
</Index>

<Property name="izdelie">
<Description>
Ценовая группа</Description>
<Type>Common.Dictionary12</Type>
</Property>

<Index name="IzdelieInd">
<Properties>izdelie</Properties>
</Index>

<Index name="NewIndex1">
<Data>Property2969,PriceUE</Data>
<Properties>Name,izdelie</Properties>
</Index>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary8D</DataLocation>
<DefaultData>Dictionary8DefaultData</DefaultData>
<IdLocation>^Common.Dictionary8D</IdLocation>
<IndexLocation>^Common.Dictionary8I</IndexLocation>
<StreamLocation>^Common.Dictionary8S</StreamLocation>
<Data name="Dictionary8DefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Property2969</Value>
</Value>
<Value name="4">
<Value>Goods</Value>
</Value>
<Value name="5">
<Value>Property4232</Value>
</Value>
<Value name="6">
<Value>GoodsCateg</Value>
</Value>
<Value name="7">
<Value>Izdelie</Value>
</Value>
<Value name="8">
<Value>izdelie</Value>
</Value>
<Value name="9">
<Value>PriceUE</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dictionary9">
<ClassType>persistent</ClassType>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Persistent</Super>
<TimeCreated>60533,48705</TimeCreated>

<Property name="ActPriceInstrument">
<Description>
Цена за акт (Электроинструмент)</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена за акт (Электроинструмент)"/>
</Property>

<Property name="DiagPriceInstrument">
<Description>
Цена за диагностику (Электроинструмент)</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена за диагностику (Электроинструмент)"/>
</Property>

<Property name="ActPriceTechnic">
<Description>
Цена за акт (Бытовая техника)</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена за акт (Бытовая техника)"/>
</Property>

<Property name="DiagPriceTechnic">
<Description>
Цена за диагностику (Бытовая техника)</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Цена за диагностику (Бытовая техника)"/>
</Property>

<Index name="ActPriceInstrumentInd">
<Properties>ActPriceInstrument</Properties>
</Index>

<Index name="DiagPriceInstrumentInd">
<Properties>DiagPriceInstrument</Properties>
</Index>

<Index name="ActPriceTechnicInd">
<Properties>ActPriceTechnic</Properties>
</Index>

<Index name="DiagPriceTechnicInd">
<Properties>DiagPriceTechnic</Properties>
</Index>

<Property name="Name">
<Description>
Категория цен</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Категория цен"/>
</Property>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG(@DataLocation@(ID),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.Dictionary9D</DataLocation>
<DefaultData>Dictionary9DefaultData</DefaultData>
<IdLocation>^Common.Dictionary9D</IdLocation>
<IndexLocation>^Common.Dictionary9I</IndexLocation>
<StreamLocation>^Common.Dictionary9S</StreamLocation>
<Data name="Dictionary9DefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>ActPriceInstrument</Value>
</Value>
<Value name="4">
<Value>ActPriceTechnic</Value>
</Value>
<Value name="5">
<Value>DiagPriceInstrument</Value>
</Value>
<Value name="6">
<Value>DiagPriceTechnic</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Dicts">
<Description>
Справочники</Description>
<Super>%Persistent</Super>
<TimeCreated>60347,76457.807052</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
</Property>

<Property name="Comment">
<Description>
Описание</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="Code">
<Description>
Код</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="NewIndex1">
<IdKey>1</IdKey>
<Properties>Code</Properties>
<Unique>1</Unique>
</Index>

<Property name="number">
<Description>
Номер</Description>
<Type>%Integer</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="NewIndex2">
<Properties>number</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.DictsD</DataLocation>
<DefaultData>DictsDefaultData</DefaultData>
<IdLocation>^Common.DictsD</IdLocation>
<IndexLocation>^Common.DictsI</IndexLocation>
<StreamLocation>^Common.DictsS</StreamLocation>
<Data name="DictsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Code</Value>
</Value>
<Value name="5">
<Value>Property737</Value>
</Value>
<Value name="6">
<Value>number</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Kontragent">
<Description>
Контрагенты (поставщики, производители, клиенты)</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%Persistent</Super>
<TimeCreated>60319,62442.888387</TimeCreated>

<Property name="Property126">
<Description>
Категория цен инструмент</Description>
<Type>Common.Dictionary9</Type>
<Parameter name="CAPTION" value="Категория цен"/>
</Property>

<Index name="Property126">
<Properties>Property126</Properties>
</Index>

<Property name="Property127">
<Description>
Категория цен бытовка</Description>
<Type>Common.Dictionary9</Type>
<Parameter name="CAPTION" value="Категория цен"/>
</Property>

<Index name="Property127">
<Properties>Property127</Properties>
</Index>

<Property name="Property2506">
<Description>
Вид деятельности</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Вид деятельности"/>
<Parameter name="DISPLAYLIST" value=", -,Электроинструмент,Бытовая техника,Электроинструмент и бытовая техника"/>
<Parameter name="VALUELIST" value=",1,2,3,23"/>
</Property>

<Property name="Property831">
<Description>
Способ доставки</Description>
<Type>Common.Dictionary1</Type>
<Parameter name="CAPTION" value="Способ доставки"/>
</Property>

<Property name="Agree">
<Description>
№ договора</Description>
<Type>%String</Type>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="AgreeInd">
<Properties>Agree</Properties>
</Index>

<Property name="City">
<Description>
Город (факт адрес)</Description>
<Type>%String</Type>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Cityind">
<Properties>City</Properties>
</Index>

<Property name="CityCode">
<Description>
Код города</Description>
<Type>%String</Type>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="CityCodeInd">
<Properties>CityCode</Properties>
</Index>

<Property name="Comment">
<Description>
Комментарий</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Commentind">
<Properties>Comment</Properties>
</Index>

<Property name="ContPers">
<Description>
Контактные лица</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="ContPersind">
<Properties>ContPers</Properties>
</Index>

<Property name="EMail">
<Description>
e-mail</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="EMailind">
<Properties>EMail</Properties>
</Index>

<Property name="Koeff">
<Description>
Работает (коэфф. 1-3)</Description>
<Type>%String</Type>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Koeffind">
<Properties>Koeff</Properties>
</Index>

<Property name="Manager">
<Description>
Менеджер</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Managerind">
<Properties>Manager</Properties>
</Index>

<Property name="Phones">
<Description>
Контактные телефоны</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Phonesind">
<Properties>Phones</Properties>
</Index>

<Property name="Status">
<Description>
Статус</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Клиент,Мастерская,Клиент/Мастерская"/>
<Parameter name="TRUNCATE" value="1"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Index name="Statusind">
<Properties>Status</Properties>
</Index>

<Property name="WCalc">
<Description>
Как рассчитываемся</Description>
<Type>%String</Type>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="WCalcind">
<Properties>WCalc</Properties>
</Index>

<Property name="WCalc2">
<Description>
Как рассчитываемся</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",б/н,взаимозачет,по договорённости"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Index name="WCalc2ind">
<Properties>WCalc2</Properties>
</Index>

<Property name="Address">
<Description>
Адрес фактический</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Addrind">
<Properties>Address</Properties>
</Index>

<Property name="Name">
<Description>
Название</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="Namind">
<Properties>Name</Properties>
</Index>

<UDLText name="T">
<Content><![CDATA[
// Федеральный округ

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Property Region As %String(MAXLEN = 200, TRUNCATE = 1);

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Index Regind On Region;

]]></Content>
</UDLText>

<Property name="chief">
<Description>
Директор</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="glavbuh">
<Description>
Главный бухгалтер</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Index name="glavbuhInd">
<Properties>glavbuh</Properties>
</Index>

<Property name="fax">
<Description>
Факс</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="bank">
<Description>
Банковские реквизиты</Description>
<Type>Common.Bank</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="region2">
<Description>
Регион</Description>
<Type>User.REGION</Type>
</Property>

<Index name="region2ind">
<Properties>region2</Properties>
</Index>

<Property name="Postalcode">
<Description>
Индекс (факт адрес)</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="500"/>
</Property>

<Index name="PostalcodeInd">
<Properties>Postalcode</Properties>
</Index>

<Property name="PostalcodeUr">
<Description>
Индекс (юр адрес)</Description>
<Type>%String</Type>
</Property>

<Index name="PostalcodeUrInd">
<Properties>PostalcodeUr</Properties>
</Index>

<Property name="AddressUr">
<Description>
Адрес юридический</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="AddrUrind">
<Properties>AddressUr</Properties>
</Index>

<Property name="CityUr">
<Description>
Город (юр адрес)</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="CityUrind">
<Properties>CityUr</Properties>
</Index>

<Property name="Code">
<Description>
Уникальный номер </Description>
<Type>%String</Type>
<InitialExpression>^Common.KontragentD+1</InitialExpression>
</Property>

<Index name="CodeInd">
<Properties>Code</Properties>
<Unique>1</Unique>
</Index>

<Property name="Password">
<Description>
Пароль</Description>
<Type>%String</Type>
<InitialExpression>##class(Common.Common).GeneratePassword()</InitialExpression>
</Property>

<Property name="ChangeDate">
<Description>
Дата последнего изменения</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",readonly"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="ChangeDateInd">
<Properties>ChangeDate</Properties>
</Index>

<Property name="ChangeTime">
<Description>
Время последнего изменения</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="ChangeTimeInd">
<Properties>ChangeTime</Properties>
</Index>

<Property name="ChangeUser">
<Description>
Человек внесший изменения</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="ChangeUserInd">
<Properties>ChangeUser</Properties>
</Index>

<Property name="OtgruzPrincip">
<Description>
Принцип отгрузки запчастей</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=", ,В кредит,По предоплате"/>
<Parameter name="VALUELIST" value=",0,1,2"/>
</Property>

<Index name="OtgruzPrincipInd">
<Properties>OtgruzPrincip</Properties>
</Index>

<Property name="Balance">
<Description>
Баланс</Description>
<Type>%Numeric</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Property name="Activity">
<Description>
Активность</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Работает,Не работает"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Index name="ActivityInd">
<Properties>Activity</Properties>
</Index>

<Property name="NotifyEmails">
<Description>
Уведомлять о сообщении от этого клиента</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1024"/>
</Property>

<Property name="Currency">
<Description>
Валюта расчётов</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Руб.,Дол. США"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="Discount">
<Description>
Скидка (%)</Description>
<Type>%Numeric</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="NDSPayment">
<Description>
Оплата по договору (с НДС, Без НДС)</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Required>1</Required>
<Parameter name="DISPLAYLIST" value=",с ндс,без ндс"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Index name="NDSPayment">
<Properties>NDSPayment</Properties>
</Index>

<Property name="Federal">
<Description>
Федеральный округ</Description>
<Type>Common.Dictionary18</Type>
</Property>

<Index name="Federal">
<Properties>Federal</Properties>
</Index>

<Property name="OurCompany">
<Description>
Наше юр. лицо с которым работает этот контрагент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Property name="IsWe">
<Description>
Это юр лицо принадлежит нам</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Это наше юр.лицо,Это стороннее юр.лицо"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Property name="AdPhone">
<Description>
Телефон указанный в рекламе</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Property name="Pseudonym">
<Description>
Псевдоним</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Index name="PseudonymInd">
<Properties>Pseudonym</Properties>
</Index>

<Property name="Holding">
<Description>
Холдинг</Description>
<Type>Common.Dictionary20</Type>
<Parameter name="CAPTION" value="Холдинг"/>
</Property>

<Index name="HoldingInd">
<Properties>Holding</Properties>
</Index>

<Method name="%OnBeforeSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 n ChangeUser
 q:'%this.%IsModified() $$$OK
 s MaxDiscount = $$$TunesVariableGlobal("MaxDiscount")
 if %this.Discount>MaxDiscount Quit $$$ERROR($$$GeneralError,"Скидка "_%this.Discount_" больше максимально установленной скидки "_MaxDiscount)
 s %this.ChangeDate=+$H
 s %this.ChangeTime=$P($H,",",2)
 s ChangeUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 d:ChangeUser %this.ChangeUserSetObjectId(ChangeUser)
 Quit $$$OK
]]></Implementation>
</Method>

<Trigger name="OnUpdate">
<Code> s obj=##class(Common.Kontragent).%OpenId({ID})
 s obj.ChangeDate=+$H
 s obj.ChangeTime=$P($H,",",2)
 s ChangeUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 d:ChangeUser obj.ChangeUserSetObjectId(ChangeUser)
 d obj.%Save()</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG(@DataLocation@(ID),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Common.Kontragent")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Common.Kontragent")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Common.Kontragent")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Common.Kontragent")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Common.Kontragent")
	if (insert)
	{
		d ..SetGoodsBan(%this.%Id())
	}
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyType">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&Data:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 f i=1:1:%compiledclass.Properties.Count() d
 . Do %code.WriteLine(" Set Prop("""_%compiledclass.Properties.GetAt(i).Name_""")="""_%compiledclass.Properties.GetAt(i).Type_"""")
 . Do %code.WriteLine(" Set Prop("""_%compiledclass.Properties.GetAt(i).Name_""",""Displaylist"")="""_%compiledclass.Properties.GetAt(i).Parameters.GetAt("DISPLAYLIST")_"""")
 . Do %code.WriteLine(" Set Prop("""_%compiledclass.Properties.GetAt(i).Name_""",""Valuelist"")="""_%compiledclass.Properties.GetAt(i).Parameters.GetAt("VALUELIST")_"""")
 . Do %code.WriteLine(" Set Prop("""_%compiledclass.Properties.GetAt(i).Name_""",""Description"")="""_%compiledclass.Properties.GetAt(i).Description_"""")
 Do %code.WriteLine(" Set Data(""Description"")=$G(Prop(PropertyName,""Description""))")
 Do %code.WriteLine(" Set Data(""Displaylist"")=$G(Prop(PropertyName,""Displaylist""))")
 Do %code.WriteLine(" Set Data(""Valuelist"")=$G(Prop(PropertyName,""Valuelist""))")
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="SetGoodsBan">
<ClassMethod>1</ClassMethod>
<FormalSpec>KontragentId</FormalSpec>
<Implementation><![CDATA[
	s ^mtempArt("newkontr")=KontragentId
	&sql(DECLARE gc CURSOR FOR
		SELECT ID
		INTO :GoodsId
		FROM Goods.Goods
		where AllowToSend=0
	)
		
	&sql(open gc)
	for  
	{
		&sql(fetch gc)
		q:SQLCODE
		d ##class(Goods.Goods).kbanAdd(GoodsId, KontragentId)
	}
	&sql(close gc)
	
	q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.KontragentD</DataLocation>
<DefaultData>KontragentDefaultData</DefaultData>
<IdLocation>^Common.KontragentD</IdLocation>
<IndexLocation>^Common.KontragentI</IndexLocation>
<StreamLocation>^Common.KontragentS</StreamLocation>
<Data name="KontragentDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>NewProperty1</Value>
</Value>
<Value name="3">
<Value>Comment</Value>
</Value>
<Value name="4">
<Value>Contact</Value>
</Value>
<Value name="5">
<Value>Name</Value>
</Value>
<Value name="6">
<Value>INN</Value>
</Value>
<Value name="7">
<Value>Address</Value>
</Value>
<Value name="8">
<Value>Agree</Value>
</Value>
<Value name="9">
<Value>City</Value>
</Value>
<Value name="10">
<Value>CityCode</Value>
</Value>
<Value name="11">
<Value>ContPers</Value>
</Value>
<Value name="12">
<Value>EMail</Value>
</Value>
<Value name="13">
<Value>Koeff</Value>
</Value>
<Value name="14">
<Value>Manager</Value>
</Value>
<Value name="15">
<Value>Phones</Value>
</Value>
<Value name="16">
<Value>Region</Value>
</Value>
<Value name="17">
<Value>State</Value>
</Value>
<Value name="18">
<Value>WCalc</Value>
</Value>
<Value name="19">
<Value>Poluh</Value>
</Value>
<Value name="20">
<Value>Postav</Value>
</Value>
<Value name="21">
<Value>Property831</Value>
</Value>
<Value name="22">
<Value>Status</Value>
</Value>
<Value name="23">
<Value>chief</Value>
</Value>
<Value name="24">
<Value>fax</Value>
</Value>
<Value name="25">
<Value>bank</Value>
</Value>
<Value name="26">
<Value>Property2506</Value>
</Value>
<Value name="27">
<Value>Yepercent</Value>
</Value>
<Value name="28">
<Value>boss</Value>
</Value>
<Value name="29">
<Value>maxcredit</Value>
</Value>
<Value name="30">
<Value>Property126</Value>
</Value>
<Value name="31">
<Value>region2</Value>
</Value>
<Value name="32">
<Value>glavbuh</Value>
</Value>
<Value name="33">
<Value>Postalcode</Value>
</Value>
<Value name="34">
<Value>AddressUr</Value>
</Value>
<Value name="35">
<Value>CityUr</Value>
</Value>
<Value name="36">
<Value>PostalcodeUr</Value>
</Value>
<Value name="37">
<Value>Code</Value>
</Value>
<Value name="38">
<Value>Password</Value>
</Value>
<Value name="39">
<Value>ChangeDate</Value>
</Value>
<Value name="40">
<Value>ChangeTime</Value>
</Value>
<Value name="41">
<Value>ChangeUser</Value>
</Value>
<Value name="42">
<Value>OtgruzPrincip</Value>
</Value>
<Value name="43">
<Value>Balance</Value>
</Value>
<Value name="44">
<Value>Activity</Value>
</Value>
<Value name="45">
<Value>Activityz</Value>
</Value>
<Value name="46">
<Value>Property127</Value>
</Value>
<Value name="47">
<Value>NotifyEmails</Value>
</Value>
<Value name="48">
<Value>Currency</Value>
</Value>
<Value name="49">
<Value>Currenc</Value>
</Value>
<Value name="50">
<Value>Discount</Value>
</Value>
<Value name="51">
<Value>NDSPayment</Value>
</Value>
<Value name="52">
<Value>Federal</Value>
</Value>
<Value name="53">
<Value>OurCompany</Value>
</Value>
<Value name="54">
<Value>IsWe</Value>
</Value>
<Value name="55">
<Value>LegalName</Value>
</Value>
<Value name="56">
<Value>AdPhone</Value>
</Value>
<Value name="57">
<Value>Pseudonym</Value>
</Value>
<Value name="58">
<Value>WCalc2</Value>
</Value>
<Value name="59">
<Value>Holding</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Rights">
<Description>
Права пользователей</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>60321,85494.351366</TimeCreated>

<Method name="login">
<Description><![CDATA[
Логин пользователя
<br><var>user</var> - Пользователь ID
<br><var>password</var> - Пароль пользователя
<br><var>depot</var> - Выбранный склад
<br><var>SysDisk</var> - Системный диск
<br><var>UserIP</var> - IP c которого пришёл пользователь]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>user,password,depot,SysDisk,UserIP=""</FormalSpec>
<Implementation><![CDATA[
 s id=##class(Users.Dates).check(user,password)
 q:'+id id
 s userobj=##class(Users.Dates).%OpenId(id)
 s %session.Data("user")=id
 s %session.Data("login")=userobj.Login
 s %session.Data("depot")=depot
 s %session.Data("passworders")=password 
 s %session.Data("userName")=userobj.Name
 d ##class(Users.FunctionUser).ReadRole(id,userobj.Rol)  //создать глобал и записать в него все функции пользователя
 s %session.Data("depotName")=##class(Store.Depot).NameGetStored(depot)
 s %session.Data("ImagesPath")=SysDisk_"\SKLAD\"
 s %session.Data("systemname")= $$$TunesVariableGlobal("systemname")
 
 s Tunes=$NA(^Tunes)
 s o="" s o="" f  s o=$O(@Tunes@(o)) q:o=""  d
 . q:'+o
 . s i="" f  s i=$O(@Tunes@(o,i)) q:i=""  d
 . . s %session.Data(i)=$G(@Tunes@(o,i,"Value"),"undefinwed")
 s JournalObj=##class(Users.Journal).%New()
 s JournalObj.UserIP=UserIP
 s JournalObj.SessionID=$S($ISOBJECT($G(%session)):%session.SessionId,1:"")
 d JournalObj.%Save()
 q 1
]]></Implementation>
</Method>

<Method name="getrights">
<ClassMethod>1</ClassMethod>
<FormalSpec>login,func</FormalSpec>
<Implementation><![CDATA[ q $D(^func(login,func))
]]></Implementation>
</Method>

<Method name="LogoutMethod">
<Description>
Записать в таблицу выход пользователя из системы</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 q:'$ISOBJECT(%session)
 q:$G(%session.Data("user"))=""
 n CurrentDat,CurrentTim,UserID,SessionID
 s UserID=%session.Data("user")
 s SessionID=$S($ISOBJECT($G(%session)):%session.SessionId,1:"")
 s CurrentDat=+$H
 s CurrentTim=$P($H,",",2)
 &sql(update Users.Journal Set LogOutType=1,DatOut=:CurrentDat,TimOut=:CurrentTim where User1=:UserID and SessionID=:SessionID)
 q
]]></Implementation>
</Method>

<Method name="CloseDeadLogins">
<Description>
Пометить закрытыми записи в журнале логина которые не имеют соответствующей сессии</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 //n SQLCODE,ID,SessionID,rs,CurrentDat,CurrentTim,sql,ok
 &sql(declare sess cursor for select ID,SessionID into :ID,:SessionID from Users.Journal where DatOut is null)
 &sql(open sess)
 f  &sql(fetch sess) q:SQLCODE  d
 . i '##class(%CSP.Session).%ExistsId(SessionID) s SessionsToBeClosed=$G(SessionsToBeClosed)_"'"_ID_"',"
 &sql(close sess)
 s SessionsToBeClosed=$E($g(SessionsToBeClosed),1,$L($G(SessionsToBeClosed))-1)
 d:$G(SessionsToBeClosed)'=""
 . s rs=##class(%ResultSet).%New()
 . s CurrentDat=+$H
 . s CurrentTim=$P($H,",",2)
 . s sql="update Users.Journal set LogOutType=2,DatOut="_CurrentDat_",TimOut="_CurrentTim_" where ID in ("_SessionsToBeClosed_")"
 . s ok=rs.Prepare(sql)
 . s ok=rs.Execute()
 q
]]></Implementation>
</Method>

<Method name="CheckKontragentLoginPassword">
<Description>
Проверка логина и пароля 
Используется в системе отправки сообщений - на странице Support.csp</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Code:%String="",Password:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s ID="", Code=$g(Code), Password=$g(Password) 
 &sql(SELECT id into :ID 
 	FROM Common.Kontragent 
 	WHERE Code=:Code and Password=:Password
 )
 Q:'SQLCODE +ID
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="Common.SouceFiles">
<Description>
Include %finstream</Description>
<Super>%RegisteredObject</Super>
<TimeCreated>63083,47110.922789</TimeCreated>

<Method name="LoadAllFromDir">
<Description>
Загрузка содержимого папки в обход контроля версий
d ##class(%Finstream.SourceControl.Files).LoadAllFromDir("\ensemble\mgr\AWLTDZH\stream\",1)
d ##class(%Finstream.SourceControl.Files).LoadAllFromDir("C:\work\Sources\AWLS")
compile=1 - после загрузки запустится компиляция всей области
Ошибки экспорта логируются в ^%SourcesErrors("LoadAllFromDir",logDate,logTime)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Path,compile=0</FormalSpec>
<Implementation><![CDATA[
#define StartsWith(%str, %substr) ($E(%str, 1, $L(%substr))=%substr)
	
 s logTime=$p($zdt($H,4)," ",2),logDate=$p($zdt($H,4)," ")
 S dir = $TR(Path,"\","/"), dir = $ZSTRIP(dir, ">", "/") // normalize the path
 i (dir="")||('##class(%File).DirectoryExists(dir)) {
	 w "Путь "_Path_" не найден ("_dir_")",!
	 q
 }
 // check for directory name collisions on Windows
 S existingDir = $ZSTRIP($TR($ZSE(dir), "\", "/"), ">", "/")
 I existingDir'=dir {
	 w "Directory name collision: '"_existingDir_"' <> '"_dir_"'",!
	 q
 }
 // generate file index
 D ..ScanDir(dir, .files)
 ;m ^Ast("files")=files
 s file=""
 s i=0
 f  {
	 s file=$o(files(file))
	 q:file=""
	 CONTINUE:$$$StartsWith($zcvt(file,"u"),"/CSP/") ;!CSP папка неимпортится
	 w "Loading "_dir_file,!
	 s sc=$SYSTEM.OBJ.Load(dir_file, "fv-d-l")
	 i $$$ISERR(sc) {
		 s ErrText=$system.Status.GetErrorText(sc)
		 w ErrText,!
		 s ^%SourcesErrors("LoadAllFromDir",logDate,logTime,$i(^%SourcesErrors("LoadAllFromDir",logDate,logTime)))=ErrText
	 }
	 ;s ^Ast(dir_file)=sc
	 s i=i+1
 }
 s sc=$$$OK
 I (compile) {
	d $system.OBJ.CompileAll() 
	d $system.OBJ.CompileList("*.MAC","ckub /checkuptodate=expandedonly")
	d $system.CSP.LoadPageDir($system.CSP.GetDefaultApp($zu(5)))
 }
 Q
]]></Implementation>
</Method>

<Method name="ScanDir">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[dir:%String,&files,baseLen:%Integer=0]]></FormalSpec>
<Implementation><![CDATA[
	S dir = $ZSTRIP($TR(dir, "\", "/"), ">", "/")
	I baseLen=0 { // initial call
		K files
		S baseLen = $L(dir) + 1
	}
	
	S path = $ZSE(dir_"/*")
	While path'="" {
		S filename = ##class(%File).GetFilename(path)
		I ($E(filename)=".") || ($E(filename)="_") G Next // skip ., .., .svn, _svn etc.
		
		I ##class(%File).DirectoryExists(path) { // subdir
			S subdirs(path) = ""
		} Else { // file
			S path = $TR(path, "\", "/")
			S files($E(path, baseLen, $L(path))) = ##class(%File).GetFileDateModified(path, 1)
		}
Next
		S path = $ZSE("")
	}
	
	S subdir = ""
	F {
		S subdir = $O(subdirs(subdir))
		Q:subdir=""
		D ..ScanDir(subdir, .files, baseLen)
	}
]]></Implementation>
</Method>
</Class>


<Class name="Common.SqlProcs">
<Description>
Класс хранящий SQL процедуры</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%Persistent</Super>
<TimeCreated>60584,53222.083348</TimeCreated>

<Method name="AddrPath">
<Description><![CDATA[
Показывает адрес ячейки по id
<br><var>addr</var> - id ячейки]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>addr:%String</FormalSpec>
<ReturnType>%Integer</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s n=##class(Store.Action).AddressPath(addr,0)
 q n
]]></Implementation>
</Method>

<Method name="DocQuant">
<Description><![CDATA[
Возвращает количество из ячейки согласно типу документа
<br><var>StringID</var> - id строки в Docs.DocItems
<br><var>DocClass</var> - id класса (например Docs.Invent)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>StringID=0,DocClass=""</FormalSpec>
<ReturnType>%Integer</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s return=0
 if DocClass="Docs.StorageOut" &sql(select quantreal into :return from Docs.StorageOutItems where ID=:StringID) q return
 if DocClass="Docs.StorageIn"  &sql(select quantreal into :return from Docs.StorageInItems where ID=:StringID) q return
 &sql(select Quantity into :return from Docs.StorageInItems where ID=:StringID)
 q return
]]></Implementation>
</Method>

<Method name="GroupFullName">
<Description><![CDATA[
построить полное имя товарной группы исходя из ID
<br><var>GroupId</var> - ID или объект товарной группы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GroupId="",Delimeter=" - "</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 i $ISOBJECT(GroupId) s GroupObject=GroupId
 s err="Ошибка при определении полного наименования группы."
 e  s GroupObject=##class(Goods.Group).%OpenId(GroupId)
 q:'$ISOBJECT(GroupObject) ""
 s GroupCode=GroupObject.Code
 s GroupCatalogue=$S($ISOBJECT(GroupObject.Catalogue):GroupObject.Catalogue.%Id(),1:"")
 s GroupCatalogueName=$S($ISOBJECT(GroupObject.Catalogue):GroupObject.Catalogue.Name,1:"")
 s GroupDepot=$S($ISOBJECT(GroupObject.Depot):GroupObject.Depot.%Id(),1:"")
 f i=2:1:$L(GroupCode,"*") d
 . s Nodes=$G(Nodes)_",'"_$P(GroupCode,"*",1,i)_"'"
 q:$G(Nodes)="" ""
 s Nodes=$E(Nodes,2,$L(Nodes))
 s QueryObject=##class(%ResultSet).%New()
 s sql="select ID,Name from Goods.Group where Code in ("_Nodes_") and Catalogue='"_GroupCatalogue_"' and Depot='"_GroupDepot_"'"
 s ok=QueryObject.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q err
 s ok=QueryObject.Execute()
 i '+ok $$$WriteObjError(ok) q err
 s GroupFullName=""
 While QueryObject.Next() {
  s GroupFullName = GroupFullName_Delimeter_QueryObject.Data("Name")
 }
 s:GroupFullName'="" GroupFullName=$E(GroupFullName,$L(Delimeter)+1,$L(GroupFullName))
 q GroupFullName
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.SqlProcsD</DataLocation>
<DefaultData>SqlProcsDefaultData</DefaultData>
<IdLocation>^Common.SqlProcsD</IdLocation>
<IndexLocation>^Common.SqlProcsI</IndexLocation>
<StreamLocation>^Common.SqlProcsS</StreamLocation>
<Data name="SqlProcsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Common.Sync">
<Description>
Набор методов для удалённой синхронизации</Description>
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60749,41339.286798</TimeCreated>

<Method name="ExportSyncFile">
<Description>
Выгрузить последние транзакции в файл</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s SystemGUID=##class(%SYS.System).InstanceGUID()
 s ok=##class(%SYNC.SyncTime).GetlTrn(SystemGUID,$ZU(5),.LastSuccessfullTransaction)
 s MySync=##class(%SYNC.SyncSet).%New()
 s GetLastTRN=MySync.GetLastTRN()
 s added=MySync.AddTransactions(+LastSuccessfullTransaction,GetLastTRN)
 s newid=GetLastTRN
 i 'added d  q err
 . s err="Ошибка во время экспорта"
 . s:+GetLastTRN=+LastSuccessfullTransaction err="Все данные уже были синхронизированы. Синхронизация не требуется"
 . d:MySync.ErrCount() 
 . . s err="Ошибки во время экспорта: "_MySync.ErrCount()
 . . d ..WriteSyncError(MySync)
 . . d MySync.Clear()
 s file="file~"_GetLastTRN_".SklExp"
 s ExportDir=$$$TunesVariable("ExportDir")
 s ok=MySync.ExportFile(ExportDir_file,"-d",0)
 d MySync.Clear()
 //хорошо бы архивировать и запаролить файл
 i '+ok $$$WriteObjError(ok) q "Ошибка при экспорте файла с обновлениями. Синхронизация невозможна."
 q 1_"@"_file
]]></Implementation>
</Method>

<Method name="GetFileFromFtp">
<Description><![CDATA[
Скачать файл с фтп сервера, сохранить его локально
<br><var>File</var> - файл]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>File</FormalSpec>
<Implementation><![CDATA[
 Set ftp=##class(%Net.FtpSession).%New()
 s FtpServer=$$$TunesVariable("RemoteServer")
 s Directory=$$$TunesVariable("FtpDir")
 //соединяемся с фтп сервером
 If 'ftp.Connect(FtpServer,$$$TunesVariable("RemoteFtpLogin"),$$$TunesVariable("RemoteFtpPassword")) q "Не удалось подключиться к удалённому серверу "_FtpServer
 //зачем то переключаем его в двоичный режим, хз что это такое
 If 'ftp.Binary() q "Невозможно переключить сервер в режим двоичной передачи данных."
 //переходим в нужную директорию на сервере
 d ftp.SetDirectory(Directory)
 Set stream=##class(%GlobalCharacterStream).%New()
 //скачиваем нужный файл
 If 'ftp.Retrieve(File,stream) q "Ошибка. На сервере "_FtpServer_", в каталоге "_Directory_" недоступен файл "_File
 //cохраняем скачаный файлик
 s FileForSave=$$$TunesVariable("ImportDir")_File
 s file=##class(%File).%New(FileForSave)
 Do file.Open("WSN")
 d file.CopyFrom(stream)
 s ok=file.%Save()
 i $$$ISERR(ok) $$$WriteObjError(ok) q "Ошибка. Невозможно сохранить файл "_FileForSave
 q 1
]]></Implementation>
</Method>

<Method name="ImportSyncFile">
<Description>
Импортировать файл синхронизации с другой системы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>File,Delete=1</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 n MySync,newid,ok
 s MySync=##class(%SYNC.SyncSet).%New()
 // каталог1\directory1\неважночто~ВОТ_ЭТУ_ЧАСТЬ_ИЗВЛЕЧЁМ.НеважноКакоеРасширение
 s newid=..GetSyncIDFromFile(File)
 s ok=MySync.Import(File)
 i MySync.ErrCount() d  q err
 . s err="Ошибки во время импорта: "_MySync.ErrCount()_". File"
 . d ..WriteSyncError(MySync)
 . //d MySync.Clear()
 //d MySync.Clear()
 i $$$ISERR(ok) $$$WriteObjError(ok) q "Ошибка при импорте файла синхронизации "_File
 //i Delete,##class(%File).Exists(File) s ok=##class(%File).Delete(File)
 q 1
]]></Implementation>
</Method>

<Method name="Synchronization">
<Description>
Запустить синхронизацию</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	s glob=$NA(^Synchronization)
	d ..StartProgress()
 	s RemoteServer=$$$TunesVariable("RemoteServer")
 	i glob'="" k @glob
 	i glob'="" s @glob@(1)=$ZDT($H,4)_" Запущена синхронизация с сервером "_RemoteServer
 //экспортируем файл с собственной синхронизацией
 	s ok=..ExportSyncFile()
 	i +ok s file=$P(ok,"@",2)
 	i '+ok d SetLast(ok) q
 	i glob'="" s @glob@(2)=$ZDT($H,4)_" Экспортирован файл синхронизации "_file
 //Коннектимся к другой системе
 	s rc=##class(%Net.RemoteConnection).%New()
 	Set Status=rc.Connect(RemoteServer,$ZU(5),1972,"_system","SOS")
 	i $$$ISERR(Status) $$$WriteObjError(Status) d SetLast("Ошибка. Невозможно соединиться с системой "_RemoteServer) q
 	i glob'="" s @glob@(3)=$ZDT($H,4)_" Успешное соединение с сервером "_RemoteServer
 //Выполняем синхронизацию на удалённой системе
 	s Code="Set ReturnValue=##class(Common.Sync).DownloadAndImport("""_file_""")"
 	d rc.ExecuteCode(.Code)
 	i +Code s txSIDlocal=$P(Code,"@",2)
 	i '+Code d SetLast(Code) q
 	i glob'="" s @glob@(4)=$ZDT($H,4)_" Выполнена загрузка и импорт файла синхронизации "_file_" на сервере "_RemoteServer
 //записываем успех экспорта синхронизации
 	s ok=..SetExportSuccess(txSIDlocal, $ZU(5), ..GetSyncIDFromFile(file))
 	i '+ok d SetLast(ok) q
 	i glob'="" s @glob@(5)=$ZDT($H,4)_" Записан результат успешной синхронизации с сервером "_RemoteServer
 //Заставим удалённую систему экспортировать свой файл синхронизации
	s Code="Set ReturnValue=##class(Common.Sync).ExportSyncFile()"
	d rc.ExecuteCode(.Code)
 	i +Code s file=$P(Code,"@",2)
 	i '+Code d SetLast(Code) q
 	i glob'="" s @glob@(6)=$ZDT($H,4)_" Удалённый сервер "_RemoteServer_" экспортировал собственный файл синхронизации "_file
 //Скачаем и импортируем файл
 	s ok=..DownloadAndImport(file)
 	i +ok s txSIDlocal=$P(ok,"@",2)
 	i '+ok d SetLast(ok) q
 	i glob'="" s @glob@(7)=$ZDT($H,4)_" Загружен и успешно импортирован файл синхронизации "_file_" с удалённого сервера "_RemoteServer
 //Запишем успех экспорта на удалённой системе
	s Code="Set ReturnValue=##class(Common.Sync).SetExportSuccess("""_txSIDlocal_""","""_$ZU(5)_""","""_..GetSyncIDFromFile(file)_""")"
	d rc.ExecuteCode(.Code)
 	i '+Code d SetLast(Code) q
 	i glob'="" s @glob@(8)=$ZDT($H,4)_" На удалённом сервере сделана запись об успешной синхронизации."
 	i glob'="" s @glob@(9)=$ZDT($H,4)_" Синхронизация с удалённым сервером "_RemoteServer_" прошла успешно."
 	d ..StopProgress()
 q
SetLast(text)
 s ^Synchronization(($O(^Synchronization(""),-1))+1)=$G(text)
 q
]]></Implementation>
</Method>

<Method name="GetSyncIDFromFile">
<Description><![CDATA[
извлечь номер транзакции из файла (\каталог1\каталог2\...~НОМЕР_ТРАНЗАКЦИИ~....РасширениеФайла"
<br><var>File</var> - имя файла в котором содержится номер транзакции]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>File</FormalSpec>
<Implementation><![CDATA[	q $P($P($P(File,"\",$L(File,"\")),"."),"~",2)
]]></Implementation>
</Method>

<Method name="SetExportSuccess">
<Description><![CDATA[
Установить флаг успешного экспорта указанной транзакции
<br><var>syncSYSID</var> - ID системы с которой произошла синхронизация
<br><var>syncNSID</var> - NameSpace в который удалённая система записала данные синхронизации
<br><var>ltrn</var> - Успешно экспортированная транзакция]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ltrn="",syncSYSID="",syncNSID=""</FormalSpec>
<Implementation><![CDATA[
 i syncSYSID=""  s syncSYSID=##class(%SYS.System).InstanceGUID()
 i syncNSID="" s syncNSID=$ZU(5)
 q:ltrn="" "Ошибка. Не указан номер транзакции. Данные синхронизированы но результат не сохранён. Следующий экспорт повторит эти данные."
 Set Status=##class(%SYNC.SyncTime).SetlTrn(syncSYSID, syncNSID, ltrn)
 i $$$ISERR(Status) $$$WriteObjError(ok) q "Ошибка при записи результата транзакции. Данные синхронизированы но результат не сохранён. Следующий экспорт повторит эти данные."
 
 s ok=1
 s FileToDelete=$$$TunesVariable("ExportDir")_"file~"_ltrn_".SklExp"
 s:##class(%File).Exists(FileToDelete) ok=##class(%File).Delete(FileToDelete)
 i '+ok q "Ошибка при удалении файла синхронизации "_FileToDelete
 
 q 1
]]></Implementation>
</Method>

<Method name="DownloadAndImport">
<Description><![CDATA[
Скачать и импортировать файл синхронизации с удалённого сервера 
<br><var>File</var> - Файл]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>File</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 //Скачиваем файл с фтп
	s ok=..GetFileFromFtp(File) 
 	q:'+ok ok
 //Импортируем скачанный файл
 	s ok=..ImportSyncFile($$$TunesVariable("ImportDir")_File)
 	q:'+ok ok
 q 1_"@"_$$$txSIDlocal
]]></Implementation>
</Method>

<Method name="Progress">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[ q ^Synchronization
]]></Implementation>
</Method>

<Method name="StartProgress">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s ^Synchronization=1
 q
]]></Implementation>
</Method>

<Method name="StopProgress">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s ^Synchronization=0
 q
]]></Implementation>
</Method>

<Method name="ShowResult">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s i="" f  s i=$O(^Syncronization(i)) q:i=""  d
 . s str=$g(str)_"<li>"_$G(^Syncronization(i))
 q $G(str)
]]></Implementation>
</Method>

<Method name="WriteSyncError">
<ClassMethod>1</ClassMethod>
<FormalSpec>MySync</FormalSpec>
<Implementation><![CDATA[
 s GlobalName=MySync.GlobalName()
 s i="" f  s i=$O(@GlobalName@("%%ERR",i)) q:i=""  d
 . s Error=@GlobalName@("%%ERR",i,"Status")
 . $$$WriteObjError(Error)
 q
]]></Implementation>
</Method>

<Method name="StartRemExport">
<Description>
Выполнить экспорт на удалённой машине</Description>
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 n RemoteServer,rc,Status,Code,CopyCommand,ok,file
 s RemoteServer=$$$TunesVariable("RemoteServer")
 s rc=##class(%Net.RemoteConnection).%New()	
 Set Status=rc.Connect(RemoteServer,$ZU(5),1972,"_system","SOS")
 i $$$ISERR(Status) $$$WriteObjError(Status) q "Ошибка. Невозможно соединиться с системой "_RemoteServer
 s ok=rc.InvokeClassMethod("Common.Sync","ExportSyncFile",.Code,1)
 i $$$ISERR(ok) $$$WriteObjError(ok) q "Ошибка выполнения экспорта на удалённом сервере."
 i +Code s file=$P(Code,"@",2)
 e  q "Ошибка экспорта на удалённом сервере: "_Code
 //тянем файл с сервера
 s ok=..GetFileFromFtp(file) q:'+ok ok 
 //импортируем файл с локальной папки
 s ok=..ImportSyncFile($$$TunesVariable("ImportDir")_file) 
 d:ok
 . //если ок установим ОК на удалённой машине
 . d rc.ResetArguments()
 . //добавляем аргумент к методу
 . d rc.AddArgument(..GetSyncIDFromFile(file))
 . //выполняем метод установки успешности транзакции на удалённом компе
 . d rc.InvokeClassMethod("Common.Sync","SetExportSuccess")
 q ok
]]></Implementation>
</Method>

<Method name="Synchronization2">
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 n ok
 d ##class(%SYSTEM.Security).Login("_system","SOS")
 s ok=..StartRemExport()
 s ^Sync(+$H,$P($H,",",2))=$S(ok=1:"Синхронизация успешно проведена",1:ok)
 q
]]></Implementation>
</Method>

<Method name="KillAllSync">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 //k ^OBJ.GUID
 k ^OBJ.JournalT
 f i=1:1:$G(^OBJ.SYNCJOB) d
 . s global="^OBJ.SYNC."_i
 . k @global
 k ^OBJ.SYNCJOB
 &sql(delete from %SYNC.SyncTime)
 q
]]></Implementation>
</Method>

<Method name="KillTransWithoutJournal">
<Description>
убить транзации все для которых не сохранилось файлов журнала</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s journal=$NA(^OBJ.JournalT)
 s i=""
 f  s i=$O(@journal@(i)) q:(i="")||(##class(%File).Exists($P($LG($G(^OBJ.JournalT(i)),2),",")))  k @journal@(i)
 q i
]]></Implementation>
</Method>
</Class>


<Class name="Common.talking">
<Super>%Persistent</Super>
<TimeCreated>60481,41373.48396</TimeCreated>

<Property name="dat">
<Description>
Дата вопроса</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="tim">
<Description>
Время вопроса</Description>
<Type>%Time</Type>
<InitialExpression>$PIECE($H,",",2)</InitialExpression>
</Property>

<Property name="quest">
<Description>
Вопрос</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="answ">
<Description>
Ответ</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="answdat">
<Description>
Дата ответа</Description>
<Type>%Date</Type>
</Property>

<Property name="answtim">
<Description>
Время ответа</Description>
<Type>%Time</Type>
</Property>

<Property name="User1">
<Description>
Юзер</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Common.talkingD</DataLocation>
<DefaultData>talkingDefaultData</DefaultData>
<IdLocation>^Common.talkingD</IdLocation>
<IndexLocation>^Common.talkingI</IndexLocation>
<StreamLocation>^Common.talkingS</StreamLocation>
<Data name="talkingDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>answ</Value>
</Value>
<Value name="3">
<Value>answdat</Value>
</Value>
<Value name="4">
<Value>answtim</Value>
</Value>
<Value name="5">
<Value>dat</Value>
</Value>
<Value name="6">
<Value>quest</Value>
</Value>
<Value name="7">
<Value>tim</Value>
</Value>
<Value name="8">
<Value>User1</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="csp.Base">
<Description>
Базовая страница для внутренних (защищенных) страниц приложения </Description>
<Super>csp.Protected,csp.Design</Super>
<TimeCreated>62334,84474.032358</TimeCreated>
</Class>


<Class name="csp.Chat2Ka">
<Description>
Общение с контрагентом
Модернизация страницы KontrMeetingResult.csp</Description>
<IncludeCode>csp,sklad2</IncludeCode>
<Super>%CSP.Page</Super>
<TimeCreated>62683,61983.25184</TimeCreated>

<Parameter name="DOMAIN">
<Description>
Локализация</Description>
<Default>sklad2</Default>
</Parameter>

<Parameter name="RIGHTS">
<Description><![CDATA[
Дополнительные права на страницу
<example>
if '##class(Common.Rights).getrights(login,..#RIGHTS) s %response.ServerSideRedirect="norights.csp" 
</example>]]></Description>
<Default>3</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##super()
 s KontrId=$$$g("Kontr") 
 
 &html<<!doctype html><html lang="ru"><head>
 <meta charset="windows-1251"/>
 
<link rel='stylesheet' type='text/css' 
    href='css/redmond/jquery-ui-1.8.22.custom.css'
    class='ui-theme'
 />
<style type="text/css" media="all">

html, body {margin:0; padding:0; } 
body {padding:.2em; font:1em; }

/*информация о контрагенте*/
.ka-info { font-size: 90%;} 
.ka-info th { font-size: 100%; text-align: right; padding-right: .5em;} 
.ka-info td { padding: 0 1em;}

/*таблица переписки*/
.history td,.history th {border: 1px solid #ccc; padding: .3em;}
.history th {font-weight: normal; font-size: 90%;}

table {border-collapse:collapse;}

.from {background-color: #eee; }/*Сообщения от контрагента*/
.to {color: #333; }/*Сообщения для контрагента*/
.self { font-style: italic; color: #555; }/*Собственные сообщения*/
.c1 {font-size: 90%; vertical-align: top;} /*Колонка дата время*/
.eml {width: 16px; height: 16px; } /*Статус отправки письма*/
.ok {background: url("images/okay.png") no-repeat;} /*успешный*/
.err {background: url("images/fail.png") no-repeat;} /*неуспешный*/
.tac {text-align: center;} .tar {text-align: right;} 
.w95p {width:95%;}
.ui-widget {font-size: .8em;}
#msg {width: 95%;}
.dAjax {text-align: center;}
.attachment { color: #000;}
label {font: 90%; color: #555;padding:0 1em;} /*подписи к кнопкам*/
p {padding:.3em;}
    
</style><style type="text/css" media="print">
    p, .no-print {display:none}
</style>
<title>Результаты общения с контрагентом </title>
</head><body>>
 #; Выводим информацию о контрагенте 
 d ..wKontrInfo(KontrId) 
 
 &html<<textarea id="TextAreaText" cols="1" rows="1" style="display:none"></textarea>
<br/>
<div class='w95p tar'>
 <button id="bMsgNew">Добавить новое сообщение</button>
</div> 
 
 <table id="ResTable" class='history ui-widget ui-widget-content w95p'>
    <col class='c1'/>
<thead>
<tr>
    <th>Дата, время</th>
    <th>Тип</th>
    <th title='Статус доставки сообщения электронной почтой'>Ст.</th>
    <th>Результат разговора</th>
    <th>Отправил</th>
    <th></th>
</tr>
</thead><tbody>>
 
 #; Выводим список сообщений в порядке поступления
 d ..wChatHistory(KontrId)
 
 &html<</tbody></table>

 <div id="dMsgNew" class="no-print w95p">
    
    <p class='dErr ui-state-error' style="display: none">
        При отправке сообщения произошла ошибка
    </p>
    
    <div class='dForm'>
     <label>Дата: </label>
     <input id="d" value="#($tr($zd(+$H,4),"/","."))#" size="10" maxlength="10"/>
     <label>время: </label>
     <input id="t" value="#($ZT($P($H,",",2)))#" size="8" maxlength="8"/>
     <br/><br/>
     <label>Текст сообщения :</label><br/>
     <textarea id="msg" name="msg" cols=60 rows=5></textarea><br/>
     <label for="file">Файл:</label>
     <input type="file" id="file" name="file" size="50" enctype="multipart/form-data"/>
    </div>
    
    <div class='dAjax' style="display: none">Пожалуйста подождите, идет отправка сообщения</div>
    
    
 </div>
<div class="tac w95p">
    <button id="bPrint" type="button">Печать</button>&nbsp;&nbsp;
    <button id="bClose" type="button">Закрыть</button>
</div>

<script type='text/javascript' src='js/jquery-1.7.2.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.22.custom.min.js'></script>
<script type='text/javascript' src='js/ajaxfileupload4.min.js'></script>
<script type="text/javascript">
var NOTE=0,MAIL=3; //Какой тип сообщения будем создавать
var RES=0,ERR=1,ID=2,JSON=3; //Позиции значений в ответе сервера после сохранения

var AjaxFileUploadURL = '#(..Link("json.Kontragent.Meeting.cls"))#' ;
var CurrentKontrId = '#(KontrId)#';

function SetwEmailButtonFN()
{
    return #(..wEmailButton())# ;
}
</script>
<script type="text/javascript" src="js/pages/chat2ka4.js"></script>

</body>
</html>
>
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="wKontrInfo">
<Description>
Выводит информацию о контрагенте</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>kid</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    s kontr=##class(Common.Kontragent).%OpenId($g(kid)) Q:'$IsObject(kontr) "" 
    &html<<table class='ka-info ui-widget ui-widget-content w95p'>
    <tr>
        <th>Контрагент: </th><td class='ui-state-highlight'>#(kontr.Name)#</td>
        <th>Город: </th><td>#(kontr.City)#</td>
    </tr>
    <tr>
        <th>Директор:</th><td>#(kontr.chief)#</td>
        <th>Контактные лица:</th><td>#(kontr.ContPers)#</td>
    </tr>
    <tr><th>Контакты: </th><td>#(kontr.Phones)#</td>>
    s email=kontr.EMail
    if email'="" {
      &html<<th>email:</th><td>
      <a href='mailto:#($ZCVT(kontr.Name,"O","HTML"))# <#(email)#>?subject=sklad2'>#(email)#</a>
      </td>>
    }
    &html<</tr></table>>
    Q ""
]]></Implementation>
</Method>

<Method name="wChatHistory">
<Description>
Рисует таблицу переписки с контрагентом</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>kid:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s kid=$g(kid)
 s (ID,Dat,Tim,Result,User1,MessageType,MessageTypeText
    ,SendMailLogResult,SendMailLog,SendMailLogResultCode
    ,AttachName,Attachment
 )=""
 
 &sql(DECLARE chat cursor for 

    SELECT ID, Dat, Tim, Result, User1->Name, MessageType, %external(MessageType)
            , SendMailLog->Result, SendMailLog, SendMailLog->ResultCode
            , AttachName, Attachment
    
    into :ID, :Dat, :Tim, :Result, :User1, :MessageType, :MessageTypeText
         , :SendMailLogResult, :SendMailLog, :SendMailLogResultCode
         , :AttachName, :Attachment
    
    FROM Kontragent.Meeting 
    WHERE Kontr = :kid
    ORDER By Dat desc, Tim desc
    
 ) &sql(OPEN chat)
 
 for  { &sql(FETCH chat) Q:SQLCODE  
 
  s cls=$CASE(MessageType,0:"self",2:"from",3:"to",:"") ;тип сообщения
  s tp=$CASE(MessageType,0:"*",2:"&lt;-",3:"-&gt;",:"&nbsp;") ;тип сообщения символом
  
  &html<<tr id="#(ID)#" class='#(cls)#'><th>#($tr($zd(Dat,4),"/","."))#<br/>#($zt(Tim))#</th>
  <th title='#(MessageTypeText)#'>#(tp)#</th>>
   s sc=""      
   if SendMailLog {
    if SendMailLogResultCode=1 {
        s sc="ok", SendMailLogResult="Сообщение успешно доставлено"
    } else {
        s sc="err"
    }
   }
   &html<<td title='#(SendMailLogResult)#'><div class='eml #(sc)#'>&nbsp;</div></td>    
   <td><div class='txt'>#(Result)#</div>>
   
   #; Обработка пустых значений (NULL)
   #; Attachment - $lb("внутреннее имя файла","%Library.FileBinaryStream" )
   #; в остальных случаях $c(0)
   #; убрал шифрование ID 4.09.2012 была строчка <a target="_blank" href="csp.StreamServer.cls?ID=#(..Encrypt(ID))#">
   if $l(Attachment)'=0  {
    &html<<div class="attachment"><span>Приложение:</span>
        <a target="_blank" href="csp.StreamServer.cls?ID=#(ID)#" test="#(..Encrypt(ID))#">
            #(..EscapeHTML(AttachName))# 
        </a>
    </div>>   
   }
   
   &html<</td>
    <td>#(User1)#</td>
    <td><img class="copy" src="images/txt.gif"/></td>
   </tr>>
  
 } &sql(CLOSE chat)
 
 Q ""
]]></Implementation>
</Method>

<Method name="wEmailButton">
<Description>
Проверяет права, выводит кнопку отправки сообщений по почте</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  //set HaveRightToWrite=##class(Common.Rights).getrights($$$user,19)
  set HaveRightToWrite=1
  
  if HaveRightToWrite=1 {   
        s str = "{ id: 'bMail', title: 'Эту запись контрагент сможет увидеть в МО в пункте Справка\\Обратиться в офис',mt: MAIL ,text: 'Ответить клиенту' ,click: function(){} }"
        //
  } else {
        s str = ""
  }
  Q str
]]></Implementation>
</Method>
</Class>


<Class name="csp.CheckSerial3">
<Description>
Проверка серийных номеров прямо из отчета о ремонте</Description>
<Super>%CSP.Page</Super>
<TimeCreated>63125,11046.00817</TimeCreated>

<Parameter name="DOMAIN">
<Default>csp</Default>
</Parameter>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 
 #;  бывает что при открытии нового окна каша запускает новую сессию,
 #;  соответственно пользователь залогинился 
 #;  а в новом окне ему отлуп "залогиньтесь"
 #;  поэтому передаю ID сессии и в случае если каша пыталась запустить новую сессию 
 #;  я её завершаю и восстанавливаю из указанного ID
 if %session.NewSession {
    s sid=%request.Get("sessionid",1)
    s %session.EndSession=1, %session=%session.GetSession(sid)
 }
 
 Q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Вывод содержимого </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 
 #define g(%name) $g(%request.Data(%name,1))
  
 &html<<!doctype html><html lang="ru">
 <head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
 <title> Проверка действительности серийных номеров </title>
 <link href="style.css" type=text/css rel=stylesheet>
</head><body>
<table border=1 cellpadding=6 cellspacing=0>
 <thead><tr>
    <td>№ п/п
    <td>Серийный номер
    <td>Актуальность
    <td>Наличие заявки
    <td>Модель
    <td>Примечание
    <td>Дубль серийного номера
 </tr></thead><tbody>>
 
     s doccls = $$$g("cls"), docid= $$$g("id")
     d ..ShowDocData( doccls, docid )
     
 &html<</tbody>
 </table>
 
 <script type="text/javascript">
var sessionid="#(%session.SessionId)#";

function s( currentrecord ) {
    var mdo = "center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;" //modal dialog options
    var url = "garant.csp?sessionid="+sessionid+"&GarantId="+currentrecord; 
    ok=window.showModalDialog( url, currentrecord+";Common.Dictionary2", mdo );
}
</script>

 </body></html>>
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowDocData">
<Description>
Получение проверяемого списка из документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doccls:%String,docid:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 s doccls=$g( doccls ), docid = $g( docid )
 s allow = $lb("Docs.Act","Docs.Otchet")
 if '$lf( allow, doccls ) {
     w "<h2>",$$$Text("Неправильный тип документа. Обратитесь к разработчику"),"</h2>"
     Q ""
 }

 #; ПОДГОТОВКА ЗАПРОСА
 if doccls = "Docs.Otchet" {
   s sql="Select serial From Docs.OtchetItems Where Doc = ?"
 } else {
   s sql="Select Serial as serial From Docs.Act Where ID = ?"  
 }
 
 s rs=##class(%ResultSet).%New()
 s sc=rs.Prepare(sql) ;w "Prepare: ",sc
 s sc=rs.Execute( docid ) ;w "Execute: ",sc
  
 #; Вспомогательные данные для отображения 
 s CountLines = 0 ;количество строк
 #; Common.Dictionary2 - Справочник гарантийных талонов
 s glob=$NA(^Common.Dictionary2I("serialInd")) ;прямой доступ к глобали индекса по серийному номеру
 
 #; DISPLAYLIST для свойства актуальность (Property9194)
 s pid="Common.Dictionary2||Property9194" 
 d ##class(Docs.Action2).GetDisplayListArray(pid,.Property9194Array)
 
 for { Q:'rs.Next()

    s serial= $g( rs.Data( "serial" ) )  if serial="" continue
    s shtml = serial ;выводим просто как текст
    s (Property9194, actual, garant, comment, Model, remont1, HasRequest)="Не найден" ;значения по умолчанию
    s ID="", color="#FFFFFF", SearchString = " "_$ZCVT(serial,"U")
    i $I(CountLines)    ;плюс строка
    
    #;если в индексе справочника гарантийных есть такой серийный
    s ID = $O(@glob@( SearchString, "" )) ;id гарантийного талона
    
    if ( ID '= "" )  { ;серийный номер есть в индексе
        
        s Property9194 = ##class(Common.Dictionary2).Property9194GetStored( ID )
        s:Property9194=2 color="#DEDEDE"
        s actual=$G( Property9194Array( Property9194 ) ) ;display value
    
        s garant=$LG( @glob@(SearchString,ID),2 ) ;в индексе сразу хранится номер гарантийного талона
        , garant="<a href=""javascript:s('"_ID_"')"">"_garant_"</a>" ;оформляем
    
        s comment = ##class(Common.Dictionary2).CommentGetStored( ID )
        s Model = ##class(Common.Dictionary2).tovarGetStored( ID ) 
        s remont1 = ##class(Common.Dictionary2).remont1GetStored(  ID  )
        s HasRequest="нет" s:remont1'="" HasRequest="<b>есть</b>"
        s shtml = "<a href=""javascript:s('"_$G(ID)_"')"">"_serial_"</a>"
        
    }
    
    &html<<tr bgcolor='#(color)#'>
    <td>#(CountLines)#
    <td>#(shtml)#
    <td>#(actual)#
    <td>#(HasRequest)#
    <td>#(Model)#
    <td>#(comment)#&nbsp
    <td>#( $G(Serials(SearchString)) )# &nbsp;
    </tr>>    
    
    #; в какой строке нашли?
    if '$D( Serials( SearchString ) ) s Serials( SearchString ) = +$G(CountLines)
    
 } d rs.Close() k rs
 
 
 
 Quit ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.console">
<Super>%CSP.Page</Super>
<TimeCreated>62475,56877.042752</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&html<<html><head></head><body>>
	
	
	&html<</body></html>>
	Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.Design">
<Description>
Типовая разметка на страницы </Description>
<Super>%CSP.Page</Super>
<TimeCreated>62334,84474.032358</TimeCreated>

<Parameter name="DOMAIN">
<Description>
Узел крепления для текстовых ресурсов приложения</Description>
<Default>sklad2</Default>
</Parameter>

<Method name="OnPage">
<Description><![CDATA[
Вывод тела страницы
<var>args</var> массив параметров запроса для тестирования]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $IsObject(%request) m args=%request.Data
 &html<<!doctype html>
<html lang="ru"><head>>  d ..wMeta(.args) 
 &html<<title>> d ..wTitle(.args) &html<</title>>
 d ..wCss(.args)
 w ..HyperEventHead()
 &html<</head><body><div style="width:90%;margin-left:auto;margin-right:auto;">
 <div>> d ..wPageHeader(.args) &html<</div>>
 d ..wBody(.args) 
 &html<</div>>
 w ..HyperEventFrame()
 d ..wJs(.args) 
 &html<</body></html>>
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="wMeta">
<Description>
write Вывод мета тэгов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<<meta http-equiv="Content-Language" content="ru"><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">>
	Q ""
]]></Implementation>
</Method>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Склад2 :: "
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<<link type="text/css" rel="stylesheet" href="style.css" />>
	Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.Documents">
<Description>
Список всех документов системы
Замена страницы docs.csp </Description>
<Super>csp.Protected</Super>
<TimeCreated>62519,28336.604235</TimeCreated>

<Method name="OnPreHTTP">
<Description>
Для отладки</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[ Quit 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Вывод страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s login=$G(%session.Data("user")), ActRights = ##class(Common.Rights).getrights(login,12)
	
	&html<<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV8.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head><title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>

 <style type="text/css">
 	body {margin:0px;padding:0px;}
 	.ui-jqgrid {font-size:90%;}
 	.ui-widget {font-size:12px;}
 	.datar{width:70;border:none;cursor:hand}
</style>

<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript">

	var ActRights = #(ActRights)#; // права на документ 
	sessionid="#(%session.SessionId)#"; //это зря
	depot="#($G(%session.Data("depot")))#" // склад
	docssame="#($G(%session.Data("docssame")))#"; //??
	var login = '#($G(login))#'; // Who
	var page={}; //пакуем все переменные в одну
	page.fn= { //серверные вызовы
		ShowDocItemsHeaders: function(ItemsClassName){
			return #server(..ShowDocItemsHeaders(ItemsClassName))#
		}
		, ShowDocItems: function(ItemsClassName,DocId){
			return #server(..ShowDocItems(ItemsClassName,DocId))#	
		}
		, processdoc: function(doc){ //обработать документ
			return #server(Docs.Action.processdoc(doc))#
		}
		, deletedoc: function(classname,itemid){
			return #server(Docs.Action.deletedoc(classname,itemid))#
		}
		, MakeFile: function(ItemID,ItemClass,value){
			return #server(Kontragent.Action.MakeFile(ItemID,ItemClass,value))#
		}
		, EmailFromDoc: function(ItemID,ItemClass){
			return #server(Docs.Action.EmailFromDoc(ItemID,ItemClass))#	
		}
		, SetOthcetStatFailed2: function(docid,Descr){
			return #server(Docs.Otchet.SetOthcetStatFailed2(docid,Descr))#	
		} 
		, SetOthcetStatAccepted: function(docid) {
			return #server(Docs.Otchet.SetOthcetStatAccepted(docid))#
		}
		, SetActStatFailed: function(docid,Descr){
			return #server(Docs.Act.SetActStatFailed(docid,Descr))#
		}
		, getRashNumb: function(val){
			return #server(Docs.Action.getRashNumb(val))#;
		}
		, GetActSumma: function(docid){
			return #server(Docs.Act.GetActSumma(docid))#;
		}
		, GetActType: function(docid){
			return #server(Docs.Act.GetActType(docid))#;
		}
		, SetActStatAccepted: function(docid,ActNumber,ActSumma,ActType){
			return #server(Docs.Act.SetActStatAccepted(docid,ActNumber,ActSumma,ActType))#	
		}
		, CreateActNote: function(docids,newItem,Comment){
			return #server(Docs.Action2.CreateActNote(docids,newItem,Comment))#
		}
		, SetParerProve: function(docItemID){ //подтвердить документ
			return #server(Docs.Otchet.SetParerProve(docItemID))#
		}
		, SetBrakAnswer: function(DocId,Answer){ //записать ответ
			ok = #server(..SetBrakAnswer(DocId,Answer))#
		}
	}; //page.fn 
</script>
<script type="text/javascript" src="js/csp.Documents.js"></script>>
 d ..HyperEventHead()
 &html<</head><body>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Документы</strong></TD>
<td width=10% align=right><a href="help/docs.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<table><tr>
<td><label>Тип документов:</label></td>
<td><input >
<!--Диалог выбора типа документа -->
<div id="docTypeDlg">
	<!--таблица c типами (class) документов -->
	<table id="doctypeg"></table>
	<div id="doctypeb"></div>
	 <!-- id="doctypes" ClassName="Docs.Docs" 
	 	onAddColumns="show()" zClick="okfunc()" zonDblClick="CreateDocument()"/-->
</div>

</td></tr>
</table>
<!--Таблица с шапками документов и панель управления -->
<table id="docg"></table><div id="docb"></div>

<!--Таблица со стороками документов и панель управления -->
<table id="rowg"></table><div id="rowb"></div>



<fieldset><legend id="TypDocument"></legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
<option value="all">Все</option>
<option value="choose">Выбрать контрагента...</option>
</select> <input type="text" id="DocName" title="Начальные цифры номера" style="width:30px">
 <span id="ActAddFields" style="display:none;border:solid black 1">
 	Неоплаченные <input type="checkbox" style="border:none;width:15px" id="ShowUnpaid" title="Выводить только неоплаченные акты">
 </span>
<sklad:LittleButton name="ok" id="okbut" onclick="okfunc()" alt="Показать документы"><br>
<SKLADList:listview width=100% height=150 id="docums" onAddColumns="showdocums()" zClick="showitems()" zonDblClick="CreateDocument(docums.ItemID)" />
  <Table width=100%><tr><td width=100%>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('')" alt="Создать документ">
<sklad:LittleButton name="edit" id="editbut" onclick="CreateDocument(docums.ItemID)" alt="Редактировать документ">
<sklad:LittleButton name="ok" id="okbut2" onclick="processdoc()" alt="Обработать документ">
<sklad:LittleButton name="print" id="okbwut2" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
<sklad:LittleButton name="printword" id="PrntButWord" onclick="prnt(docums.ItemID,docums.ClassName,'word')" alt="Печать документа Word">
<!--
<sklad:LittleButton name="mail" id="EmailDocument" onclick="EmailDocumentFn(docums.ItemID,docums.ClassName)" alt="Отправить по почте">
-->

<!-- кнопки кнопки инструкции по отгрузке -->
<span style="display:none" id="StorageOutField">
	<sklad:LittleButton name="goinside" id="goinside" onclick="ShowLogOfCreation()" alt="Протокол сборки инструкции по отбору">
</span>

<!-- кнопки расходной накладной -->
<span style="display:none" id="okbwut3"> 
	<sklad:LittleButton name="change" id="ChangeTovInDoc" onclick="ChangeTovInDocFn()" alt="Заменить товар в расходной накладной">
	<sklad:LittleButton name="card" id="dkfi" onclick="makescet('Docs.Chet')" alt="Сформировать счет на оплату">
	<sklad:LittleButton name="card" id="okbwut4" onclick="makescet('factura')" alt="Сформировать счет-фактуру">
	<sklad:LittleButton name="card" id="hernya" onclick="maketovnakl('tovnakladn')" alt="Сформировать товарную накладную">
</span>

<!-- кнопки отчёта контрагента -->
<span style="display:none" id="OtchetSpecButton"> 
	<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Errors')" alt="Показать ошибки отчёта">
	<img src="images/red_stop.gif" alt="Отклонить отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetFailed()">
	<img src="images/green_butt.gif" alt="Принять отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetAccepted()">
	<sklad:LittleButton name="txtok" id="btnProveOthet" onclick="ProveOthet()" alt="Бумажный отчёт проверен">
</span>

<!-- кнопки инструкции руководителя -->
<span style="display:none" id="InstrSpecButton">
	<sklad:LittleButton name="txt" id="btnLookBrakComment" onclick="ShowOtchetErrorsFn('BrakComment')" alt="Показать негативный отзыв контрагента">
	<sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetBrakAnswer()" alt="Ответить на негативный отзыв">
	<sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowOtchetErrorsFn('BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
</span>

<!-- кнопки акта технического осмотра -->
<span style="display:none" id="ActSpecButton"> 
<script language="cache" runat="server">
 if  &html<
		<img src="images/txt.gif" onmouseover="btnShowReqsFromAct.src='images/Ontxt.gif'" onmouseout="btnShowReqsFromAct.src='images/txt.gif'"  id="btnShowReqsFromAct" name="btnShowReqsFromAct" alt="Показать заявки этого акта" onclick="ShowReqsFromActFn()">
		<img src="images/red_stop.gif" alt="Отклонить акт" width="20px" height="20px" style="cursor:hand" onclick="setActFailed()">
		<img src="images/green_butt.gif" alt="Принять акт" width="20px" height="20px" style="cursor:hand" onclick="setActAccepted()">
		<img src="images/print.gif" onmouseout="this.src='images/print.gif'" onmouseover="this.src='images/Onprint.gif'" alt="Сформировать служебную записку" width="20px" height="20px" style="cursor:hand" onclick="MakeActNote()">
	>
</script>
<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Comment')" alt="Показать комментарии к акту">
</span>
</td><td>
<sklad:LittleButton name="del" id="dk2fi" onclick="deldoc()" alt="Удалить документ">
</td></tr></table>
<!--
<sklad:LittleButton name="ok" id="okbut3" onclick="printdoc()" alt="Распечатать документ">
-->
</fieldset>
<fieldset><legend>Строки документа</legend>
<SKLADList:listview width=100% height=150 id="docitems" onAddColumns="showitems()"/><br>
</fieldset>
<!--
	<br><br><br>
	<SKLADiGrid:iGrid id="IGridDocstr" width="100%" height="300" Enabled="true" RowMode="true" /><br>
-->
</td></tr>
</table>
</body>
</html>>
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowDocItemsHeaders">
<Description>
Вернет строку отображения столбцов строк документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Class:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ 	Quit ##class(Common.Common).showheaders(Class)
]]></Implementation>
</Method>

<Method name="ShowDocItems">
<Description>
Отображение строк документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Class:%String,DocId:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s str=##class(Common.Common).showheaders(Class,,,1)
 for i=1:1:$L(str,"#@#")  {
	s header=$P(str,"#@#",i) 
	s headerKey = $P(header,"~")
	s fields=$G(fields)_headerKey_","
 }
 s fields=$E(fields,1,$L(fields)-2)
 q ##class(Common.Common).showdata(Class,fields,,"doc="_DocId,,1)
]]></Implementation>
</Method>

<Method name="SetBrakAnswer">
<Description>
Установка конкретного свойства документа, в данном случае 
Ответ на брак</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String,Answer:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 s obj.BrakCommentAnswer = Answer
 s obj.BrakCommentAnswerUser = $G(%session.Data("user"))
 s obj.BrakCommentAnswerDat = +$H
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
]]></Implementation>
</Method>
</Class>


<Class name="csp.Documents2">
<Description>
Сразу перевести страницу docs.csp не получилось
Попробую частями</Description>
<Super>csp.Base</Super>
<TimeCreated>62556,78800.403714</TimeCreated>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<
	 <!--Грид и панель грида для выбора типа документа-->
	 <label>Тип документов:</label>
	 <input type="text" id="dt" readonly="readonly" />
	 <button type="button" id="bdt">Выбрать</button>
	 <table id="dtg"></table><div id="dtb"></div>
	 <!--Грид и панель грида c шапками документов-->
	 <table id="docg"></table><div id="docb"></div>
	 <!--Грид и панель грида cо строками документов-->
	 <table id="rowg"></table><div id="rowb"></div>
	>
	
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>

 <style type="text/css">
 	body {margin:0px;padding:0px;}
 	.ui-jqgrid {font-size:90%;}
 	.ui-widget {font-size:12px;}
 	.datar{width:70;border:none;cursor:hand}
</style>

	>
	Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<!-- настройки гридов для каждого типа документа вынесены в отдельные файлы -->
<script type='text/javascript' src='js/csp.Documents.Act.js'></script>
<script type='text/javascript' src='js/csp.Documents.ActNote.js'></script>
<script type='text/javascript' src='js/csp.Documents.Brakremont.js'></script>
<script type='text/javascript' src='js/csp.Documents.Diff.js'></script>
<script type='text/javascript' src='js/csp.Documents.DocBrak.js'></script>
<script type='text/javascript' src='js/csp.Documents.Inner.js'></script>
<script type='text/javascript' src='js/csp.Documents.InnerDiff.js'></script>
<script type='text/javascript' src='js/csp.Documents.Invent.js'></script>
<script type='text/javascript' src='js/csp.Documents.Otchet.js'></script>
<script type='text/javascript' src='js/csp.Documents.OtchetNote.js'></script>
<script type='text/javascript' src='js/csp.Documents.Platejka.js'></script>
<script type='text/javascript' src='js/csp.Documents.Prih.js'></script>
<script type='text/javascript' src='js/csp.Documents.Rash.js'></script>
<script type='text/javascript' src='js/csp.Documents.Remont.js'></script>
<script type='text/javascript' src='js/csp.Documents.StorageIn.js'></script>
<script type='text/javascript' src='js/csp.Documents.StorageOut.js'></script>
<script type='text/javascript' src='js/csp.Documents.Utiliz.js'></script>
<script type='text/javascript' src='js/csp.Documents.Instructions.js'></script>
<script type='text/javascript' src='js/csp.Documents.Plan.js'></script>


<script type="text/javascript">
	$(function(){
		var GRID="#dtg",BAR="#dtb",JSON="json.Docs.Docs.cls";
		$(GRID).jqGrid({ //Таблица с типами  документов
		 	caption: "Типы документов"
		 	,url: JSON, datatype: "json", jsonReader : { repeatitems: false }
		 	, colModel: [
		  	{name:'id', hidden:true}
	    , {name:'nm',label:'Тип', width:250}
	    , {name:'ot',label:'Операция', width:150}
	  	]
	  	, pager: BAR
	  	, viewrecords:true
	  	, height:300
	  	, hidegrid: false
	   , gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
	   , hoverrows:true ,scroll:1 
	  	, onSelectRow: function(/*Тип документа*/ id){ //выбран новый тип документа
		 		 
			 		if (!window.toggleDocs[id]) { 
			 			alert("Просмотр документов "+id+" в разработке"); return;
			 		}
			 		
			 		$( window.DOCGRID ).jqGrid("GridUnload", window.DOCGRID); //сбрасываем настройки
			 		window.toggleDocs[id](); //запускаем перезагрузку
			 		
		 	}
	 }).jqGrid('navGrid',BAR, 
       {add:false,edit:false,del:false,view:false,search:false}
  ).jqGrid('gridResize',{});
  
  	/**
	 *Автоулучшение существующих и сформированных на странице гридов
	 *Выбираем гриды на странице по классу ui-jqgrid-btable и цепляемся к ним  
	 **/
	var fn_improve=function(grid){ 		
		var $grid=$(grid);
		
		/**
		 * @opt - string - опция грида которую надо получить
		 * */
		var fn_goget=function(opt){
			return $(this).jqGrid("getGridParam",opt);
		};
		
		var fn_goset=function(key,opt){
			return $(this).jqGrid("setGridParam",key,opt);
		};
		
		//в зависимости от версии грида 
		alert(fn_goget("pager"));
			
		
	};		
		
	fn_improve("#dtg");	
  
  

});
</script>>

	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.EmpLight3">
<Description>
3 Вариант страницы emplight.csp
параметры тип инструкции и контрагент</Description>
<Super>csp.Base</Super>
<TimeCreated>62305,77157.240215</TimeCreated>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Рабочее место кладовщика"
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	&html<<link type="text/css" rel="stylesheet" href="css/csp.EmpLight3_.css"/>>
	Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<
		<div class="pageLegend">Рабочее место на складе</div>
	>
	Q ""
]]></Implementation>
</Method>

<Method name="wITypeOpts">
<Description>
Вывести типы инструкций в html-options</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(Declare iotrs Cursor For 
		SELECT id,name Into :id,:name
		From Operation.OperTemplate Order By Name
	) &sql(Open iotrs)
	for { &sql(Fetch iotrs) Q:SQLCODE
		w "<option value='",id,"'>",name,"</option>"		
	} &sql(Close iotrs)
	Q ""
]]></Implementation>
</Method>

<Method name="wIDocs">
<Description><![CDATA[
Выводит документы по инструкциям
<var>where</var> - массив условий вида <example>where(key)="FIELD < ?"</example>
<var>qp</var> - массив соответсвующих условиям параметров вида <example>qp(key)="VALUE"</example>
<var>order</var> - массив правил сортировки вида <example>order(key,FIELD)=direction</example>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&where:%String="",&qp:%String="",&order:%String=""]]></FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
 s sql="SELECT IID,INAME,IKONTR,IKONTRNAME,IUSERNAME,IDATE"
 	   _",ISTATE,ISTATENAME,IDOSTAVKANAME,ICOLOR,IOPER,IOPERNAME"
 	   _",IPOSTNUM,IPOSTDATE,IROTNAME"
 	   _",DCLASS,DOCID,DNAME"
 	   _" from Operation.IDocView "
 	   _" where (ISTATE Between 2 and 8.5) "
 #; расписываем where
 s i="" for { s i=$o(where(i)) q:i=""
	s cond=$g(where(i))  continue:cond=""
	s sql=sql_" AND "_cond
 }
 #; расписываем order
 if $d(order)>1 {
	s sql=sql_" ORDER BY " 
	s i="" for { s i=$o(order(i)) q:i=""
		s field=$o(order(i,""))
		s dir=$g(order(i,field))
		s:i>1 sql=sql_","
		s sql=sql_field_$s(dir=-1:" DESC",1:"")
	} 
 } 
 
 
 
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql) i '+ok w "Ошибка при формировании списка инструкций" Q ""
 
 #;define debug
 #ifdef debug
 	w "<div style='white-space:pre'>"
 	w !,"SQL:",sql,!
 	zw qp
 	w !,ok
 	w "<div>"
 #endif
 
 #define qp(%i) $g(qp(%i))
 #;в этой версии всего 16 параметров запроса
 s ok=rs.Execute($$$qp(1),$$$qp(2),$$$qp(3),$$$qp(4),$$$qp(5),$$$qp(6),$$$qp(7)
 	,$$$qp(8),$$$qp(9),$$$qp(10),$$$qp(11),$$$qp(12),$$$qp(13),$$$qp(14),$$$qp(15),$$$qp(16)
 ) 
 
 if '+ok w "Ошибка при формировании списка инструкций" Q ""
 
 s odm=$$SetDCFormat^%NLS("DateSeparator",".") ;разделитель в дате 
 
 #define g(%field) s %field=$g(rs.Data("%field"))
 while rs.Next(){
	$$$g(IID) $$$g(INAME) $$$g(IKONTR) $$$g(IKONTRNAME)
	$$$g(IUSERNAME) $$$g(IDATE) $$$g(ISTATE)
	$$$g(ISTATENAME) $$$g(IDOSTAVKANAME) $$$g(ICOLOR)
	$$$g(IOPER) $$$g(IOPERNAME) $$$g(IPOSTNUM)
	$$$g(IPOSTDATE) $$$g(IROTNAME)
	$$$g(DCLASS) $$$g(DOCID) $$$g(DNAME)
	
	s IDATE=$ZD(IDATE,4,,,,,,,"") ;преобразование даты
 	s css="" s:ICOLOR'="" css="style='color:"_ICOLOR_"'"
 	
 	s DCLASS1=$p(DCLASS,",") ;основной класс документа
 	if DCLASS1="Docs.Rash" { 
 		#;подменяем название типа оплаты инструкции
 		#;названием типа оплаты документа
	 	&sql(Select opl->Name INTO :IROTNAME From Docs.Rash Where ID=:DOCID)
	}
 	
 	
 	w "<tr ",css,">"
 	w "<td>",INAME," (",DNAME,") ",IROTNAME,"</td>"
 	w "<td>",IDATE,"</td>"
 	w "<td style='cursor:hand' onclick=""ShowKontr('",IKONTR,"')"">",IKONTRNAME,"</td>"
 	w "<td>",IUSERNAME,"</td>"
 	w "<td id=""Instr",DOCID,"Stat"">",ISTATENAME
 	s:IOPER'=10 IDOSTAVKANAME=IOPERNAME
 	w "<td>",IDOSTAVKANAME,"</td>"
 	w "<td style=""width:90px""><nobr>"
 	w "<button class='stateDoc' onclick='chstat(",IID,",",DOCID,")'></button>"
 	w "<button class='printDoc' onclick=""prnt('",DOCID,"@",DCLASS1,"')""></button>"
 	
 	#;определяем наличие документов третьего уровня от инструкции (дочерние дочерних)
 	&sql(select ID,DocumentClass,Name,stat into :DOC2,:DCLASS2,:DNAME2,:DSTAT2 
 		 From Docs.Super where Source=:DOCID
 	)
 	if SQLCODE {
	 	w "<button class='new' onclick=""create('",DCLASS,"',",DOCID,")""></button>"
 	} else {	 
 		w "<button class='edit' onclick=""lookinnerinstr('",DOC2,"@",DCLASS2,"')""></button>"
 		w "<button class='print' onclick=""prnt('",DOC2,"@",DCLASS2,"')""></button>"
 		if DSTAT2=1 {
	 		w "<button class='state' onclick=""savestore(",DOC2,",'",$ZCVT($TR(DNAME2,""""," "),"O","JS"),"')"" ></button>"
 		} else {
 			w "<button class='out'></button>"
 		}
 		
	 }
	w:ISTATE=8 "<button class='post' onclick=""post('",IID,"')""></button>"
 	w "</nobr></td>"
 	w "</tr>",!	
 }
 d rs.Close(), rs.%Close() k rs
 d SetDCFormat^%NLS("DateSeparator",odm) ;восстанавливаем разделитель в дате 
 
 Q %ROWCOUNT
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<
  <table><tr><td>
 	<img title="Обновить раздел [ F5 ]" 
		onclick="window.location.reload()"
		src="images/refresh.gif" 
	/></td>
	<td>
	<button onclick="window.location='BrakUtiliz.csp'"
	 style="padding:3px;" 
	>
		Списание брака
	</button> 
	</td>
 </tr></table>
 
 <fieldset id="fsInstr"><legend>Инструкции</legend>

 
<p style="margin:5px 0px;"><label for='ChooseInstrType'>Тип инструкции:</label> 
	<select id="ChooseInstrType" onchange="ReloadWithParams()">
	<option value="">Все</option>>
		d ..wITypeOpts()
	&html<</select>
	<label for='ChooseKontragent'>Контрагент:</label>
	<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
	<option value="">Все</option>
	<option value="choose">Выбрать контрагента...</option>
	</select>
	</p>
<table id="TIH">>
	#; выводим шапку таблицы с текущим режимом сортировки
	s SignCode(-1)="&#9650;", SignCode(1)="&#9660;" ;символы направления сортировки
	#; режим сортировки 
	s sort=$g(%request.Data("sort",1)) s:sort="" sort="DNAME" ;по умолчанию сортировка по номеру связанного с инструкцией документа
	s dir=$g(%request.Data("dir",1)) s:dir="" dir=1 ;направление сортировки
	#; закладываем следующие режимы сортировки
    if sort="DNAME" s NumberOrder=dir*-1,NumberSign=SignCode(dir)
	if sort="IDATE" s DateOrder=dir*-1,DateSign=SignCode(dir)
	if sort="IKONTRNAME" s KontrOrder=dir*-1,KontrSign=SignCode(dir)
	if sort="IUSERNAME" s OperOrder=dir*-1,OperSign=SignCode(dir)
	if sort="ISTATE" s StateOrder=dir*-1,StateSign=SignCode(dir)
	if sort="IDOSTAVKA" s TaskOrder=dir*-1,TaskSign=SignCode(dir)
    f i=1:1:7 w "<col class='c",i,"'/>"
	w "<thead><tr>"
	w "<th><a href='?sort=DNAME&dir=",$g(NumberOrder,1),"'>Номер ",$g(NumberSign),"</a></th>"
	w "<th><a href='?sort=IDATE&dir=",$g(DateOrder,1),"'>Дата ",$g(DateSign),"</a></th>"
	w "<th><a href='?sort=IKONTRNAME&dir=",$g(KontrOrder,1),"'>Контрагент ",$g(KontrSign),"</a></th>"
	w "<th><a href='?sort=IUSERNAME&dir=",$g(OperOrder,1),"'>Оператор ",$g(OperSign),"</a></th>"
	w "<th><a href='?sort=ISTATE&dir=",$g(StateOrder,1),"'>Состояние ",$g(StateSign),"</a></th>"
	w "<th><a href='?sort=IDOSTAVKA&dir=",$g(TaskOrder,1),"'>Задача<br>(Способ отправки) ",$g(TaskSign),"</a></th>"
	w "<th style='font-weight:normal;font-size:12px;font-family:Arial;width:90px'>Действия</th>"
	w "</thead></table>"
	&html<<div id="TIBbox"><table id="TIB">>
	f i=1:1:7 w "<col class='c",i,"'/>"
	&html<<tbody>>
	
	s depot=$G(%session.Data("depot"),1) ;по какому складу показывать
	s instr=$G(%request.Data("instr",1)) 
	s kontr=$G(%request.Data("kontr",1)) ;фильтр по контрагенту
	s instrtype=$G(%request.Data("instrtype",1)) ;фильтр по типу инструкции
	
	k where,qp,order 
	
	if depot'="" s where($i(where))="IDEPOT1=?",qp($i(qp))=depot
	s kontrID=$P(kontr,"~") if kontrID'="" s where($i(where))="IKONTR=?",qp($i(qp))=kontrID
	s ITypeId=$P(instrtype,"~") if ITypeId'="" s where($i(where))="IOPER=?",qp($i(qp))=ITypeId
	if sort'="" s order($i(order),sort)=dir ;выбранный режим сортировки
	s docs=..wIDocs(.where,.qp,.order) ;выводим документы с выбранными параметрами
	
	&html<</tbody></table></div>>
	w "Всего: ",docs," документ(ов)"
	&html<</fieldset>
	<div id="debug"></div>
	<script type='text/javascript' src='js/m.js'></script>
	<script type='text/javascript'>
	var sessionid="#(%session.SessionId)#";
	var kontr='#(kontr)#';
	var instrtype='#(instrtype)#';
	var server={ /*прячем сюда все серверные вызовы*/
		changeState: function(docid,newstat){
			return #server(Operation.InstrActions.changestat(docid,newstat))#
		}
		,killTempAddress: function(){
			#server(Store.Action.KillTempAddress())#	
		}
		,createChildDoc: function(docid,cl){
			return #server(Docs.Action.CreateChildDoc(docid,cl))#	
		}
		,saveQuantFromInstr: function(InstrID){
			return #server(Store.Action.SaveQuantFromInstr(InstrID))#	
		}	
	}

   </script>
	<script type='text/javascript' src='js/pages/csp.EmpLight3.js'></script>
	>
	s sess=%request.Get("sessionid")
	s userid=$G(%session.Data("user"))
	s newstat=%request.Get("newstat")
  	i newstat'="" d
	. s ok=##class(Operation.InstrActions).changestat(instr,newstat)
	. i '+ok d
	. . w "<script type='text/javascript'>alert('",ok,"')</script",">"

	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.GlobalBinary">
<Description><![CDATA[
Хранение больших файлов ресурсов (js,png,css) > 32kb в глобале и выгрузка их через csp страницу]]></Description>
<Super>%CSP.Page</Super>
<TimeCreated>62367,56627.311672</TimeCreated>

<Parameter name="CONTENTTYPE">
<Description><![CDATA[
Specifies the default content type for the page.  This can be overriden using the
&lt;CSP:CONTENT TYPE=&gt; tag, or by setting the <b>%response</b>.ContentType property
in the <method>OnPreHTTP</method> method.  The default value if this parameter is
not set is text/html.
text/javascript
text/css]]></Description>
<Default>image/png</Default>
</Parameter>

<Parameter name="EXPIRES">
<Description>
В течении суток контент не меняется!!!</Description>
<Default>86400</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ d ..Export() Quit $$$OK
]]></Implementation>
</Method>

<Method name="Export">
<Description>
Выгрузка на страницу</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<Implementation><![CDATA[
  s gln="^"_%class
  s major=$system.Version.GetMajor(), minor=$system.Version.GetMinor()
  s version=+(major_"."_minor)
  if version<5.1 {
   $$$GENERATE(" s strm=##class(%GlobalBinaryStream).%New() ")
   $$$GENERATE(" s id=$LB("""_gln_""",1) ")
   $$$GENERATE(" d strm.OpenStream(id) ")
  } else {
   $$$GENERATE(" s oid=$lb(1,""%Stream.GlobalBinary"","""_gln_""") ")
   $$$GENERATE(" s strm=##class(%Stream.GlobalBinary).%Open(oid) ")
  }
  $$$GENERATE(" d strm.OutputToDevice() k strm ")
]]></Implementation>
</Method>

<Method name="Import">
<Description>
Загрузка файла в глобаль </Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>file:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  s gln="^"_%class 
  s major=$system.Version.GetMajor(), minor=$system.Version.GetMinor()
  s version=+(major_"."_minor)
  
  $$$GENERATE(" k "_gln_" ")
  $$$GENERATE(" s file=##class(%File).%New(file) ")
  $$$GENERATE(" d file.Open(""RU:/TRANSLATE=0"") ")
  if version < 5.1 {
  $$$GENERATE(" s s=##class(%GlobalBinaryStream).%New("""_gln_""") ")
  } else {
  $$$GENERATE(" s s=##class(%Stream.GlobalBinary).%New("""_gln_""") ")
  }
  $$$GENERATE(" d s.CopyFromAndSave(file) ")
  $$$GENERATE(" d file.Close() k file,s ")
  $$$GENERATE(" Q $$$OK ")
  Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.GoodsRights">
<Description>
Установка ограничений на экспорт справочника товаров
 </Description>
<IncludeCode>csp</IncludeCode>
<Super>csp.Design</Super>
<TimeCreated>62462,61031.670471</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>windows-1251</Default>
</Parameter>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 w "Склад2 :: Привилегии" 
 Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<
 <link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
 <style type="text/css">
    body {margin:0px;padding:0px;}
    .ui-jqgrid {font-size:90%;}
    .ui-widget {font-size:12px;}
</style>
 >
 Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s depot=$g(%session.Data("depot"),1)
 s cat=$g(args("cat",1),1), catName=""
 s:##class(Goods.Catalogue).%ExistsId(cat) catName=##class(Goods.Catalogue).NameGetStored(cat)
 &html<<table >
    <tr><td colspan="2">>

    &html<<div style="BACKGROUND: rgb(233,243,255); BORDER-BOTTOM: rgb(0,0,102) 1px solid">
    <button id="btnBack">Назад</button>
    <span style="FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102);padding-left:30px;padding:10px">
        <strong>Ограничение использования запчастей контрагентами</strong>
    </span>
    </div>
    </td></tr>
    <tr><td style="vertical-align:top;">
    <label for="catSel">Каталог:&nbsp;</label><input id="catId" type="hidden" value="#(cat)#"/>
    <input id="cat" value="#(catName)#" readonly="readonly"/><button id="catSel">...</button>

 <div id="catDlg">
  <table id="catGrid"><tr><td></td></tr></table><div id="catBar"></div>
 </div>

    <table id="group"><tr><td></td></tr></table><div id="groupBar"></div>
 
 </td><td style="vertical-align:top;">
 
  <label for="kontrSel">Контрагент:&nbsp;</label><input id="kontrId" type="hidden" />
  <input id="kontr" readonly="readonly" /><button id="kontrSel">...</button>
  <div id="kontrDlg">
    <table id="kontrGrid"><tr><td></td></tr></table><div id="kontrBar"></div>
  </div>
  <table id="good"><tr><td></td></tr></table><div id="goodBar"></div>
    
 </td></tr></table>
 <div id="debug"></div>>
 Q ""
]]></Implementation>
</Method>

<Method name="wCatOpts">
<Description>
В локальный массив с ключом по Наименованию</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    #define qt(%js) $tr(..QuoteJS(%js),"'","""")
    
    s depot=$g(Args("depot",1),1)
    k cats s cats=""
    &sql(Declare crs Cursor For
        Select Id,Name Into :id,:name
        From Goods.Catalogue
        Where depot=:depot
        Order By Name
    ) &sql(Open crs)
    w "{rows:["
    s first=1
    for { &sql(Fetch crs) Q:SQLCODE'=0
     w:'first "," s:first first=0
        w "{id:",id,",name:",$$$qt(name),"}"
    } &sql(Close crs)
    w "],page:1,records:",%ROWCOUNT,",total:1}"
    
    Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
 s depot=$g(%session.Data("depot"),1)
 s cat=$g(args("cat",1),1), catName=""
 s:##class(Goods.Catalogue).%ExistsId(cat) catName=##class(Goods.Catalogue).NameGetStored(cat)
    
    
 
 w "<script type='text/javascript'>",!
 #; динамическое содержимое 
 w "var page = page || {};"
 w "page.goodjson='",..Link("json.GoodsRights.cls"),"';"

 w "var CatOpts = "
 d ..wCatOpts()
 w ";",!
 w "var jsonGoodsGroup2cls = '"_..Link("json.GoodsGroup2.cls")_"';",!
 w "var depot= '"_depot_"';",!
 w "var cat='"_cat_"';",!
 w !,"</"_"script>",!

 &html<
<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<script type="text/javascript" src='js/pages/GoodsRight4.js'></script>
    >
    Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.Instruction">
<Description>
Создание/редактирование экземпляра инструкции</Description>
<Super>csp.Design</Super>
<TimeCreated>62486,72362.437478</TimeCreated>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	w "Инструкция"
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super(.args)
	&html<<style type="text/css">
		th {text-align:left;font-weight:normal;font-size:95%;}	
		th label {display:block; margin:2px 3px;}
		#Name,#InstDate {width:6em;}
		#Comment {width:95%}
	</style>>
	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s InstrID=$g(%request.Data("id",1))
 s Oper=10 //тип инструкции, по умолчанию - заказ на поставку запасных частей
 	,Name="",Comment="быт"
 	,InstDate=$zd(+$h,3) //текуая дата 
 	,Depot1=1 //Склад №1
 	,RashOplatType=1 //по гарантии
 	,Stat=1 //Создана
 	,Summa=0
 	,(Kontr,KontrName,btnSaveStyle
 	,CloseDate,CloseTime,CloseUserName
 	)=""
 	s ClosedString="" ;информация о закрытии	
 
 /*,Kontr,Kontr->Name*/
 if InstrID { ;передан код инструкции - выполняем запрос
 #SqlCompile Select=ODBC
 	&sql(SELECT Oper,Name,Comment,InstDate
 			,Depot1,RashOplatType
 			,CloseDate,CloseTime,CloseUser->Name
 			,State,Summa
		 	INTO :Oper,:Name,:Comment,:InstDate
				,:Depot1,:RashOplatType
				,:CloseDate,:CloseTime,:CloseUserName
				,:Stat,:Summa
		 	FROM Operation.Instructions 
		 	WHERE ID=:InstrID)
 s Depot1=$g(Depot1,1), Summa=+Summa
 if SQLCODE'=0 {
	 &html<<div>Ошибка при выводе инструкции #(InstrID)#: #($system.SQL.SQLCODE(SQLCODE))#</td></tr>>
	 if Stat=2 d   ;закрыт? 
 	. ;какая-то информационная строка
 	. s ClosedString=CloseUserName_" "_$S(CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(CloseTime:$ZT(CloseTime),1:"")
 	. s ClosedString=ClosedString_" "_HasBeenSent
 	. s btnSaveStyle="display:none" ;прячем кнопку сохранить
 	i postdata s postdata=$ZD(postdata,4)
 }
} //if $g(id)'=""
 
 &html<<table id="docHead" class='ui-widget ui-widget-content' style='border-collapse: collapse;'>
 
<tr><td>
<input type="hidden" id='Oper' value='#(Oper)#' />
<input type="hidden" id='Depot1' value='#(Depot1)#' />
<input type="hidden" id="InstDate" value='#(InstDate)#'/>
</td></tr>
<tr>
	<th><label>Номер*</label></th>
	<td>
		<input type="text" id="Name" maxlength="50" 
		value='#(Name)#'>
	</td>
	<th><label>Оплата*</label></th>
	<td><select id='RashOplatType' >
	#( ##class(Docs.Action2).GetClassValuesOptions(RashOplatType,"Common.Dictionary7") )#
	</select></td>
	<th><label>Сумма</label></th>
	<td>#($G(Summa))#&nbsp;</td>
</tr>
<tr>
	<th><label>Комментарий</label></th>
	<td colspan="5">
		<input id="Comment" maxlength="1000" 
			value='#(Comment)#' />
	</td>
</tr>
>
 if ClosedString'="" {
	  &html<<tr><td colspan=4>Инструкция завершена <i>"_ClosedString_"</i></td></tr>>
 }

 &html<</table>
 <table id="grid"><tr><td></td></tr></table><div id="bar"></div>
 <div id='gsd'></div>
 <button id="btnSave" style="#(btnSaveStyle)#" title="Сохранить документ"></button>
 >
	Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s id=$g(args("id",1)),status=1 ;по умолчанию открыта
	if id'="" && ##class(Operation.Instructions).%ExistsId(id) {
		s status=##class(Operation.Instructions).StateGetStored(id)
	}
	s editable=$s(status=1:"true",1:"false")
	s saved="false" s:id'="" saved="true"
	&html<
		<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
		<script src="js/i18n/jquery-ui.datepicker-ru.min.js" type="text/javascript"></script>
		<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
		<script type='text/javascript' src='js/i18n/grid.locale-ru.js'></script>
		<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
		<script type='text/javascript' src='js/jqGoodsDialog.min.js'></script>
		<script type="text/javascript">
		var page={ doc:'#(id)#' //код текущего документа
			,docSaved: #(saved)#
			,editMode: function(/*Boolean*/ edit){ //включает выключает режим редактирования инструкции
				var Name=$("#Name"),RashOplatType=$("#RashOplatType")
					,Comment=$("#Comment")
					,bRowAdd=$("#bRowAdd"),bRowEdit=$("#bRowEdit")
					,bRowDel=$("#del_grid");
				if ( edit ) {
					Name.removeAttr("disabled");
					RashOplatType.removeAttr("disabled");
					Comment.removeAttr("disabled")
					bRowAdd.show(); bRowEdit.show(); bRowDel.show();
				} else {
					Name.attr("disabled","disabled");
					RashOplatType.attr("disabled","disabled");
					Comment.attr("disabled","disabled")
					bRowAdd.hide(); bRowEdit.hide(); bRowDel.hide();
				}
				
			}
			,docSave: function(){ //Сохранение самого документа
				var required=["#Name","#RashOplatType"]
				,labels=["Номер","Способ оплаты",]
				;
				if (!page.docCheckRequired(required,labels)) return; //не все заполнили
				//собираем данные шапки документа 
				var docData={
					id: page.doc
					,oper: (page.doc=="")?"add":"edit"
					,type: $("#Oper").val()	
					,name: $("#Name").val()
					,date: $("#InstDate").val()
					,depot: $("#Depot1").val()
					,payment: $("#RashOplatType").val()
					,comment: $("#Comment").val()
					
				}
				$.ajax({url:'#(..Link("json.instruction.cls"))#'
					,async: false
					,type: "POST"
					,data: docData
					,docType: 'text'
					,success: function(data, textStatus, jqXH){
					 var arr=eval(data);
					 if (!arr[0]){
						alert(arr[1]); return;	 
					 }
					 page.doc=arr[2]; //обновили код документа в javascript
					 var $grid=$("#grid");
					 var postData=$grid.jqGrid("getGridParam","postData");
					 postData.Doc=page.doc;
					 $grid.jqGrid("setGridParam","postData",postData)
					 .trigger("reloadGrid");
					 $("#btnSave").button("option","disabled",true);
					 page.docSaved=true;
					}
				});
				return page.docSaved;
			
			}
			,docCheckRequired: function(arr,lbl){ //Проверяем обязательные поля
				for (var i in arr){
					var inp=$(arr[i]);
					if (!inp.val()) {
						page.msgBox("Поле [ "+lbl[i]+" ] обязательно для заполнения. Документ не сохранен");
						if (inp[0]) inp[0].focus();
						return false; 	
					}
				}
				return true;	
			}
			,msgBox: function(msg){
				alert(msg);
			}
			
		}; //end of page
		
		
$(function(){
	
		var editable=#(editable)#;
		$("#btnSave").button({
	 		text: true
			 ,label:"Сохранить"
			 ,icons:{primary:'ui-icon-disk'}
			 ,disabled: #($CASE(id,"":"false",:"true"))#
		}).click(function(){
			page.docSave();
 		});
		
		//При любом изменении в шапке документа включаем кнопку сохранить
		$("input,select","#docHead").change(function(){
		  page.docSaved=false; //флаг, что документ нуждается в сохранении
		  $("#btnSave").button("option","disabled",false);
		});
		
		$.datepicker.setDefaults( $.datepicker.regional[ "ru" ] );
		$("#InstDate").datepicker({dateFormat: 'yy-mm-dd' }); //выбор даты документа
		
				
				
		///Параметры формы рсоздания-редактирования товарной строки
		var formOptions={ 
			addCaption: "Добавить товарную строку"
			,editCaption: "Редактировать товарную строку"	
			,closeAfterEdit: true
			,closeAfterAdd: true
			,clearAfterAdd: true
			,width: 600
			,onInitializeForm: function(fid){
				$("#sdt",fid).datepicker({dateFormat:"yy-mm-dd"});
				var fn_selGood=function(obj){
					$("#g",fid).val(obj.id);
					$("#gn",fid).val(obj.nm);
				}
				/// привязываем его к кнопке
				$("#btnSelGood",fid).click(function(){
					$("#gsd").jqGoodsDialog("open");
				});
				
				/// инициализируем плагин
				$("#gsd").jqGoodsDialog({onSelect: fn_selGood});
				
			}
			//обходим глюки компонента - не отсылал код документа
			,beforeSubmit: function(postdata, formid) {
				postdata["Doc"]=page.doc;
				return[true,""];
			}
			,afterSubmit: function(resp){
				var res=resp.responseText;
				var arr=eval(res);
				return arr;
			}
			
		};
		
			
		var GRID="#grid",BAR="#bar",URL="json.irows.cls"
		$(GRID).jqGrid({
						caption: 'Содержание инструкции'
						,url: URL, editurl: URL
						,colModel: [
							{name:"id",hidden: true}
							,{name:"g",hidden: true, label:"Товар"
								,editable:true
								,editrules: { required: true}
							}	
							,{name:"gn",label:"Товар",width:200
								, editable: true
								, editoptions: { readonly: "readonly",size:40,title:'Выбирается из справочника' }
								, formoptions: { label:"Товар*", elmsuffix: "<button id='btnSelGood'>...</button>"}
							}	
							,{name:"sn",label:"Серия",width:120
								, editable: true
							}	
							,{name:"qnt",label:"Кол-во",width:100
								, editable: true
								, editrules: {required: true}
								, formoptions: {label:"Количество*"}
							}
							,{name:"sdt",label:"Продан",width:100
								, editable: true
								, editoptions: {maxlength:10,size:10}
							}
							,{name:"slr",label:"Продавец",width:120
								, editable: true
							}
							,{name:"rsn",label:"Поломка",width:120
								, editable: true
							}
							,{name:"nt",label:"Прим.",width:120
								, editable: true
							}
						]
						
						,postData: {Doc:#("'"_id_"'")#}
						,datatype: "json"
						,jsonReader : { repeatitems: false }
						,sortname: "sdt", sortorder: "desc"
						//,idPrefix:"kt"
					 ,pager:BAR 
					 ,viewrecords:true
					 ,height:300
					 ,hidegrid: false
					 ,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
					 ,/*scrollrows:true,*/hoverrows:true ,scroll:1
					 //,ondblClickRow: function(){}
 		})
 		.jqGrid('navGrid',BAR, {
	 		add: false //собственная реализация с предварительным сохранением шапки документа
       		,edit: false //собственная реализация с предварительным сохранением шапки документа
       		,del: true, deltext: "Удалить" // стандартное удаление
       		,view: false,search: false
       	}
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{} //Параметры удаления
	 ).jqGrid('navButtonAdd',BAR,{ 
		   			caption:"Редактировать", buttonicon:"ui-icon-pencil"
		   			, id: 'bRowEdit'
		   			, title:"Редактировать товарную строку" 
		   			, position: 'first'
		   			, onClickButton: function(){
			   			if (!page.docSaved){ //шапка документа не сохранена
				   			if (!page.docSave()) return; //пытаемся сохранить
				   		}
				   		var $grid=$(GRID),id=$grid.jqGrid('getGridParam',"selrow");
				   		$grid.jqGrid('editGridRow', id, formOptions );
			   		}
	 })
	  .jqGrid('navButtonAdd',BAR,{ 
		   			caption:"Создать", buttonicon:"ui-icon-plus"
		   			, id: 'bRowAdd'
		   			, title:"Добавить товарную строку" 
		   			, position: 'first'
		   			, onClickButton: function(){
			   			if (!page.docSaved){ //шапка документа не сохранена
				   			if (!page.docSave()) return; //пытаемся сохранить
				   		}
				   		$(GRID).jqGrid('editGridRow', "new", formOptions );
				   	}
	 })
	 .jqGrid('gridResize',{});
	 ///.jqGrid('filterToolbar',{searchOnEnter:false})
	 $(BAR+"_center").remove(); //пагинатора не будет
	 $(BAR+"_left").css("width","70%"); //надпись о количестве записей на бОльшую часть футера
	 $("th").addClass("ui-state-default").css("font-weight","normal");
  	 page.editMode(editable);
});
</script>
		
 >
 	
	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.jqGrid">
<Description>
Базовая для списков</Description>
<Super>csp.Design</Super>
<TimeCreated>62503,71028.77827</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Склад2 :: Список инструкций"
	Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	  Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<link type="text/css" rel="stylesheet" href="style.css" />
 <link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
 <style type="text/css">
 	.ui-jqgrid {font-size:90%;}
 	.ui-widget {font-size:1.2em;}
 	input {width:auto}
</style>
 >
	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	 &html<<table id="grid"><tr><td></td></tr></table><div id="bar"></div>>
	Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<
		<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
		<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
		<script type='text/javascript' src='js/i18n/grid.locale-ru.js'></script>
		<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
	>
  Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.jqgrid412src">
<Super>%CSP.Page</Super>
<TimeCreated>62370,53039.819303</TimeCreated>

<Parameter name="CONTENTTYPE">
<Description><![CDATA[
Specifies the default content type for the page.  This can be overriden using the
&lt;CSP:CONTENT TYPE=&gt; tag, or by setting the <b>%response</b>.ContentType property
in the <method>OnPreHTTP</method> method.  The default value if this parameter is
not set is text/html.]]></Description>
<Default>text/javascript</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 &js<
 
 >
 Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.Ka">
<Description>
Главная страница для подсистемы web-доступа контрагентов</Description>
<IncludeCode>csp,web</IncludeCode>
<Super>csp.Design,csp.KaProtected</Super>
<TimeCreated>62676,56341.860712</TimeCreated>

<Parameter name="CHARSET">
<Default>utf-8</Default>
</Parameter>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	w $$$Text("Aska Elc")
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 &html<
 #($$$icon("box.ico"))#
 <link rel='stylesheet' type='text/css' 
 	href='css/redmond/jquery-ui-1.8.22.custom.css'
 	class='ui-theme'
 />
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid-4.4.0.css'/>
 <style type="text/css">
 	.ui-widget {font-size: .8em}
 </style>
 >
	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	 &html<<table width=100%>
	 	<tr><td align="left" 
	 		style="font-family:Arial;color:#555;font-size:12px">
	 			#($$$Text("Cервисный центр"))#: <b>#($$$client)#</b> #($$$clientName)#
	 	</td>
	 	<td align="right">
	 		<button id='bExit' type="button">#($$$Text("Выход"))#</button>
	 	</td>
	 	</tr></table>
	 	
	 	<div id="instabs">
			<ul>
				<li><a href='#(..Link("csp.KaChat.cls"))#'>#($$$Text("Обратная связь"))#</a></li>
				<li><a href='#(..Link("csp.KaReports.cls"))#'>#($$$Text("Отчёты"))#</a></li>
			>
				#;<li><a href='#(..Link("csp.KaOrders.cls"))#'>#($$$Text("Заявки"))#</a></li>
				&html<
			</ul>
			
		</div>>
	Q ""
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//Скрипты

]]></Content>
</UDLText>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&html<
		<script type='text/javascript' src='js/jquery-1.7.2.min.js'></script>
		<script type='text/javascript' src='js/jquery-ui-1.8.22.custom.min.js'></script>
		<script type='text/javascript' src='js/i18n/grid.locale-ru.js'></script>
		<script type='text/javascript' src='js/jquery.jqGrid-4.4.0.min.js'></script>
		<script type='text/javascript' src='js/grid.setcolumns.min.js'></script>
		<script type='text/javascript' src='js/grid.usersettings.min.js'></script>
		<script type='text/javascript' src='js/jquery.cookie.min.js'></script>
		<script type='text/javascript' src='js/jquery.themeloader.min.js'></script>
		<script type='text/javascript' src='js/jquery.obj2json.js'></script>
		<script type='text/javascript' src='js/jquery.contextmenu.min.js'></script>
		<script type="text/javascript">
		$(function(){
			
		 $("#bExit").button({icons:{secondary: 'ui-icon-circle-close'}}).click(function(){
			window.location='#(..Link("csp.KaAuth.cls"))#';
		 });
		
		 $("#instabs").tabs({ cookie: { expires: 30 } });
		 
 	
});
</script>>
  Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaAuth">
<Description>
Страница входа в подсистему для контрагентов </Description>
<IncludeCode>csp</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62650,40877.487019</TimeCreated>

<Parameter name="TITLE">
<Type>%String</Type>
<Default>Вход в систему</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	k Args m Args=%request.Data
	k %session.Data("Login") //если вышли на страницу - сбрасываем пользователя
	&html<#($$$DOCTYPE)#<html lang="ru"><head>
	#($$$icon("box.ico"))#
	<link media="all" type="text/css" href="css/redmond/jquery-ui-1.8.16.custom.css" rel="stylesheet">
	#($$$css("css/ui.jqgrid-4.2.0.css"))#
	<title>#(..#TITLE)#</title>
	#(..wCss(.Args))#
	</head><body>	
	#(..wBody(.Args))#	
	#($$$js("js/jquery-1.7.2.min.js"))#
	#($$$js("js/jquery-ui-1.8.22.custom.min.js"))#
	#($$$js("js/md5.min.js"))#
	#(..wJS(.Args))#
	</body></html>>
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="wBody">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<
  	<table >
	<tr>
	<td><div class="ui-icon ui-icon-person">&nbsp;</div></td>
	<td><input id="login" tabindex="1" title="Введите код" value="#($g(Args("login",1)))#" /></td>
	<td rowspan="2"><button id="btnEnter" tabindex="3">Войти</button></td>
	</tr>
	<tr>
	<td><div class="ui-icon ui-icon-key">&nbsp;</div></td>
	<td><input id="passw" type="password" tabindex="2" title="Введите пароль" /></td>
	</tr>
	</table>
<div id="dlg"></div>
>
 Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<style type="text/css">
	body {
		background: url('http://www.securegion.com/images/vault.jpg') no-repeat;
		background-position: 50% 45px;
	}
	table {position: absolute;
		top: 150px;
		left: 28%;
		}
	table input {width:8em; border:1px solid #999;}
	</style>>
 Q ""
]]></Implementation>
</Method>

<Method name="wJS">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<script type="text/javascript">

$(function(){
	
	var fnLogin=function(res){
		if (res==1) {
		$("table").effect( "explode",{},1500,function(){
			window.location='#(..Link("csp.Ka.cls"))#';
		}); 
		
		return;
	}
	if (res==0) {
		$("#dlg").dialog(
			{ title:"В доступе отказано!",modal:true
				,buttons: {
					"OK":function() {
						$(this).dialog("close");
				}
			 }
			}
		);
		return;
	}	
	};
	
	$("#btnEnter").button({icons:{primary:'ui-icon-unlocked'}})
	.click(function(){
		var login=$("#login").val(), pass=$("#passw").val();
		if (login=="") return;
		
		var hash=MD5('#($system.Encryption.Base64Encode(%session.Key))#'+pass);
		$.ajax({ url:'#(..Link("csp.KaAuthCheck.cls"))#'
			,data:{login:login, hash:hash}
			,success: fnLogin
		});
	});
	$("table").effect( "bounce", {}, 500);
	$("#login").focus();
});
</script>>
 q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaAuthCheck">
<Description>
Закрытая страница-сервис, проверяющая имя и хеш пароля</Description>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62650,41454.786708</TimeCreated>

<Parameter name="PRIVATE">
<Default>1</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	m args=%request.Data
	s login=$g(args("login",1)), ClienthashHex=$zcvt($g(args("hash",1)),"U")
	s ssid=$system.Encryption.Base64Encode(%session.Key)
	s passw="" &sql(Select Password Into :passw From Common.Kontragent Where Code=:login)

	s hash=$system.Encryption.MD5Encode(ssid_passw)
	s serverHex=..EncodeHash(hash)
	s hashHexUpperCase = $ZCVT(ClienthashHex,"U")
	
	if hashHexUpperCase=serverHex {
		s %session.Data("Login")=login 
		s %session.AppTimeout=10800 ;3 часа * 60 мин * 60 сек
		w 1
	} else {
		k %session.Data("Login") w 0
	}	
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="EncodeHash">
<ClassMethod>1</ClassMethod>
<FormalSpec>hash:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s serverHex="",len=$l(hash)
	f i=1:1:len 
	{
		s byteHex=$zh($a($e(hash,i))) 
		s:$l(byteHex)=1 serverHex=serverHex_"0"
		s serverHex=serverHex_byteHex
	}
	q serverHex
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaChat">
<Description><![CDATA[
Подстраница общения с контрагентом
Часть страницы <class>csp.KaOrders</class>]]></Description>
<IncludeCode>web,KaChat</IncludeCode>
<Super>%CSP.Page,csp.KaProtected</Super>
<TimeCreated>62675,68754.371151</TimeCreated>

<Parameter name="DOMAIN">
<Default>sklad2</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	m args=%request.Data
 if $d(args("msg")) Q ..AddMsg(.args)
 
 &html<<style>
#box {font:12px Verdana; height: 25em; overflow: auto;}
#box p span {font: 90% Arial; font-weight: bold;}
#box p div { padding:0 1em; white-space: pre;}
</style>>

 &html<
 <div style="margin-bottom:2em">Отправка сообщения в офис Aska Elc.:
	 <br/><textarea cols="60" rows="7" id="msg"></textarea>
	 <br/><button id='bSend'>Отправить</button>
 </div>
 
 <div class='ui-widget'>
  <div class='ui-widget-header' style='text-indent:3em;'>Сохраненные сообщения</div>
  <div id='box' class='ui-widget-content'>
  </div>
 </div>>
  
 
 &html<<script type="text/javascript">
 $(function(){
	
	 //Коробка куда добавляются сообщения
		var $box=$("#box");
		
		 ///Функция, которая умеет рисовать сообщение на странице
	 var fnWrite=function(obj){
		 var $msg=$("<p></p>"); if (obj["in"]) $msg.addClass('ui-state-default'); 
		 $("<span></span>").text(obj.dt+" "+obj.tm).appendTo($msg);
		 $("<div></div>").html(obj.msg).appendTo($msg);
		 $box.prepend($msg);
		};
	 
	 $("#bSend").button({icons:{secondary:'ui-icon-mail-closed'}})
			.click(function(){
			 var msg=$("#msg").val(); if (msg=="") return;
			 $.ajax({ url: '#(..Link("csp.KaChat.cls"))#'
						,type: 'POST'
						,data: {oper:'add',msg: msg }
						,dataType: "text"
						,success: function(data){
						
							try {
								var arr=eval(data);
							} catch (e){
								alert(e.description);
							}
							
							if (!arr[0]) {
									alert(arr[1]);
							} else {
								 fnWrite(arr[2]); $("#msg").val("");
							}
								
						} //success
				}) //ajax
			 
			
			});  
	 
	 // Сохраненные сообщения
	 var msg=[
	 	#(..wMessages())#
	 ];
	 // Выводим их
	 for (var i=0,obj;obj=msg[i];i++){
		 	fnWrite(obj);
		}

	 

 })
 </script>>
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="wMessages">
<Description>
Выводим пришедшие сообщения </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  s kontr=+$$$client Q:'kontr ""
  
  &sql(DECLARE joke CURSOR FOR 
   SELECT ID INTO :id
 		FROM Kontragent.Meeting 
 		WHERE MessageType IN ($$$FromClient,$$$ForClient) 
 			  AND Kontr=:kontr
 		ORDER BY Dat, Tim 
 
  ) &sql(OPEN joke)
  s first=1
  for { &sql(FETCH joke) Q:SQLCODE  
   w:'first "," s:first first=0
			d ..wJson(id)   
  } &sql(CLOSE joke)
  Q ""
]]></Implementation>
</Method>

<Method name="wJson">
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(Select Dat,Tim,Result,MessageType 
								Into :dt,:tm,:msg,:tp
							From Kontragent.Meeting
							Where ID=:id
	)
	w "{dt:'", $tr($zd(dt,4),"/","."),"'"
   	, ",tm:'",$zt(tm),"'"
   	, ",msg:'",$zcvt(msg,"O","JS"),"'"
   	, ",in:",$S(tp=$$$ForClient:"true",1:"false") 
 ,"}"
	Q ""
]]></Implementation>
</Method>

<Method name="AddMsg">
<Description><![CDATA[
Отправляем сообщение <var>Msg</var> котрагенту <var>Kontr</var>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s Kontr=$$$client, msg=$g(args("msg",1))
	
	#; Запросы присылается javascript в кодировке utf
	s msg=$zcvt(msg,"I","UTF8")
	
	#; если нет такого 
	if '##class(Common.Kontragent).%ExistsId(Kontr) {
		w "[false,'Ошибка: Указанный контрагент не существует."
			, "Свяжитесь с сервисом по телефону или по электронной почте'"
			, ",null]"
		Q ""
	}
	
	#define prop(%propName) %propName
 #define Kontr(%propName) ##class(Common.Kontragent).$$$prop(%propName)GetStored(Kontr)
	 
 s KontrName=$$$Kontr(Name), KontrEmail=$$$Kontr(EMail)
 s MailDestination=$$$Kontr(NotifyEmails)
 s MailText = "Новое сообщение в системе Аска-Склад."
		_$C(13,10)_"Клиент: "_KontrName
		_$C(13,10)_"Дата: "_$ZDT($H,4)
		_$C(13,10)_"Сообщение: "_msg
  													
  s MailSubject = "Сообщение от клиента "_KontrName
  
  s KMeet=##class(Kontragent.Meeting).%New()
  s KMeet.MessageType=2
  s KMeet.Result=msg
  s KMeet.Dat=+$H
  s KMeet.Tim=$P($H,",",2)
  d KMeet.KontrSetObjectId(Kontr)
  s ok=KMeet.%Save() 
  
  if '+ok {
  		 w "[false,'Ошибка при сохранении сообщения',null]"
  		 Q ""
  } 
   
  s id=KMeet.%Id() k KMeet
    
  s SendMailResult = ##class(Kontragent.Action).SendMailNotification(MailDestination,"",MailText,MailSubject)
  if 'SendMailResult {
	      w "[false"
	       	, ",'Сообщение сохранено, но возникла ошибка при отправке уведомления"
	       	, "Пожалуйста, свяжитесь с офисом Aska Elc.'"
	       	, "null"
	      ,"]"
	      Q
   }
   
   w "[true,'',"
   		,..wJson(id)
   ,"]"
  	Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaOrders">
<Description>
Список заявок - часть страницы csp.Ka</Description>
<IncludeCode>csp,web</IncludeCode>
<Super>%CSP.Page,csp.KaProtected</Super>
<TimeCreated>62482,83020.332849</TimeCreated>

<Parameter name="DOMAIN">
<Default>sklad2</Default>
</Parameter>

<Method name="OnPage">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	 &html<<table id="KaOrdersg"></table><div id="KaOrdersb"></div>
		<script type="text/javascript">
		$(function(){
			
		 var openDoc=function(id){
			 if (!id) id="";
			 window.location='#(..Link("csp.Instruction.cls"))#?id='+id;
		 };
		
		 var GRID="#KaOrdersg", $GRID=$(GRID), BAR="#KaOrdersb"
		 , URL='#(..Link("json.KaOrders.cls"))#';
		 
		 //функция определения выделенной строки
		 var gid=function(){
				return $GRID.jqGrid("getGridParam","selrow");
		 };
		 
		 //настройки грида
		 var GOPTS={ 
				url: URL, editurl: URL
				,datatype: "json"
				,jsonReader : { repeatitems: false }
				,sortname: "d", sortorder: "desc"
				,colModel: [
					{name:"id",hidden: true}
					,{name:"d",label:'#($$$Text("Дата"))#',width:120
					, search: true
					, stype: 'text'
					, searchoptions:{
								dataInit: function(elem){
									/*$(elem).datepicker(
										{dateFormat:'yy-mm-dd'
											,changeMonth: true
											,changeYear: true
											,yearRange: "2006:+1"
										}
									);*/	
								}	
							}
						
						}
						,{name:"nm",label:'#($$$Text("Наименование документа"))#'
							,width:450
							, search:true
						
						}
						,{name:"ste",index:"st", label:'#($$$Text("Статус"))#'
							,width:150
							, search:true
							, stype: 'select'
							, searchoptions: {value:
								#(..wInstrStateSelOpts())#
							}
						}
					]
				 ,pager: BAR 
				 ,viewrecords: true
				 ,height: 300
				 ,hidegrid: false
				 ,gridview: true ,rownumbers: true,viewrecords: true,rowNum:100
				 ,hoverrows: true ,scroll: 1
				 ,ondblClickRow: function(id){openDoc(id);}
 	};
		
	//восстанавливаем пользовательские настройки
  	var userSettings=$GRID.jqGrid("userSettings", GOPTS);
 
	$GRID.jqGrid( userSettings )
	.jqGrid('navGrid',BAR, {
	       	add: false
       		, edit:false
       		, del:false 
       		, view:false
       		, search:false
    }).jqGrid('navButtonAdd',BAR,{ 
   			caption:'#($$$Text("Печать"))#', buttonicon:"ui-icon-print"
   			, title:'#($$$Text("Распечатать документ"))#' 
   			, position: 'first'
   			, onClickButton: function(){
	   			var id=gid();
	   			window.open('#(..Link("screen/ChiefInstr.csp"))#?docid='+id);
	   		}
   })
   .jqGrid('filterToolbar',{searchOnEnter:false})
   .jqGrid('gridResize',{});
 	
 	//добавляем необходимые обработчики
	//добавляем контекстное меню
	//перетаскивание колонок, изменение размеров	
	$(GRID).jqGrid("improve",{contextmenu: false});	 
 	
});
</script>>
  Q $$$OK
]]></Implementation>
</Method>

<Method name="wInstrStateSelOpts">
<Description>
Выводит Display/Value списки значений в определенном формате</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##class(Utils.Class).wVDList("Operation.Instructions","State")
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaProtected">
<Description><![CDATA[
Базовая защищенная страница для
подсистемы web-доступа контрагентов
На наследников этой страницы можно попасть после
аутенфикации в классе <class>csp.KaAuth</class>]]></Description>
<Abstract>1</Abstract>
<IncludeCode>web</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>62674,52530.012408</TimeCreated>

<Method name="OnPreHTTP">
<Description>
Отказываем в доступе если не определен контрагент</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	if ($$$client="") s %response.Status=403 Q 0
	Q 1
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaReportCSA3">
<Description><![CDATA[
[rep]ort [C]ontract [S]ervices [A]ttachment
Печатная форма - 
Приложение №3 к договору на проведение сервисного обслуживания
Исходный класс - <class>csp.screen.otchet2</class>]]></Description>
<IncludeCode>web</IncludeCode>
<Super>%CSP.Page,csp.KaProtected</Super>
<TimeCreated>62671,69659.423136</TimeCreated>

<Parameter name="PRIVATE">
<Default>1</Default>
</Parameter>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	
 if $d(%request.Data("word")) {
	 s %response.ContentType = "application/msword"
	 do %response.SetHeader("Content-Disposition","attachment;word.doc")
	 s %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
	}
	
 Q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	 
	 s AllColumns = %request.Get("AllColumns")
	 s WordFormat=0 s:$d(%request.Data("word")) WordFormat=1
	 
	 s mn(1)="Январь",mn(2)="Февраль",mn(3)="Март",mn(4)="Апрель",mn(5)="Май",mn(6)="Июнь",mn(7)="Июль",mn(8)="Август",mn(9)="Сентябрь",mn(10)="Октябрь",mn(11)="Ноябрь",mn(12)="Декабрь"
	 s id=%request.Get("id")
	 s obj=##class(Docs.Otchet).%OpenId(id)
	 d:$ISOBJECT(obj)
	 . s OtchetMonth=$G(mn(+obj.Name))
	 . s OtchetYear=$P(obj.Name,"\",2)
	 . d:$ISOBJECT(obj.Kontr)
	 . . s KontragentName=obj.Kontr.Name
	 . . s Address=obj.Kontr.Address
	 . . s City=obj.Kontr.City
	 . . s Phones=obj.Kontr.Phones
	 . . s EMail=obj.Kontr.EMail
	 . . s chief=obj.Kontr.chief
	 . . s CurrencyName = ##class(Common.Kontragent).CurrencyLogicalToDisplay(obj.Kontr.Currency)
	 . s summa = $J(obj.Summa,".",2)
	 . s DocKurs = obj.Kurs
	 . s SluzapObj=obj.Sluzap	//документ "служебная записка"
	 . if $ISOBJECT(SluzapObj) d
	 . . s SluzapName=SluzapObj.Name
	 . . s SluzapId=SluzapObj.%Id()
	 . . s args("docid",1)=SluzapId, args("class",1)="Docs.Sluzap"
	 . . s SluzapPrintUrl=..Link("screen/sluzap.csp")_"?docid="_SluzapId_"&class=Docs.Sluzap"

	&html<<!doctype html><html><head><meta charset="windows-1251"/>
		<title>№ </title>
		<style type="text/css">
			body { }
			#t1 {border-collapse:collapse;}
			#t1 th,#t1 td {border: solid 1px #555;font-family: Arial;font-size:12px;padding:2px 3px;}
			#t1 th {font-family: Verdana; font-weight:normal; font-size:11px; color: #333;}
			.tac {text-align:center;}
			p {color: #333;}
			p span {font-weight:bold; color:#000;}
		</style>
	</head><body>
		<h3>ПРИЛОЖЕНИЕ 3.</h3>
		<div>К ДОГОВОРУ НА ПРОВЕДЕНИЕ	СЕРВИСНОГО ОБСЛУЖИВАНИЯ №_____   от ______________20__ г.      
			<br/>
			<p class="tac">Технический отчет за <span>#($G(OtchetMonth))# #($G(OtchetYear))# г.</span></p>
			<p>Наименование сервисного	центра: <span>#($G(KontragentName))#</span>;<br/>
			Адрес: <span>#($G(City))# #($G(Address))#</span>; 
			<br/>Телефон: <span>#($G(Phones))#</span>; Факс: <span>#($G(fax))#;</span>	 
			<br/>E-mail: <span>#($G(EMail))#;</span>
			<br/>Ф.И.О. директора: <span>#($G(chief))#</span>
			<br/>Служебная записка: <a href="#($G(SluzapPrintUrl))#" target=_blank><span>#($G(SluzapName))#</span></a>
			</p>
			<br/>
		</div>
		<p>(Форма и образец заполнения)</p>
		<table id="t1">
<!--
	<COL width=21>
	<COL width=101>
	<COL width=58>
	<COL width=106>
	<COL width=70>
	<COL width=46>
	<COL width=118>
	<COL width=82>
	<COL width=34>
	<COL width=70>
	<COL width=58>
	-->
	<thead>
	<tr valign="top">
		<th width="21">№<br/>п/п</th>
		<th width="101">Наименование<br/>изделия</th>
		<th width="58">Модель</th>
		<th width=106>Заводской №</th>
		<th width=70>Гарант.<br/>талон №</th>
		<th width=46>Отр.<br/>талон (A/B/C)</th>
		<th width=118>Наименование<br/>детали</th>
		<th width=82>Марка<br/>детали</th>
		<th width=34>Кол-во</th>
		<th width=70>Цена<br/>детали</th>
		<th width=58>Цена<br/>ремонта</th>>
	
		if AllColumns,WordFormat {
			w "<th>Примечание</th>"
			w "<th>Дата</th>"
			w "<th>Тип<br/> ремонта</th>"
		}
 w "</tr></thead>",!
 
 #include xmlmacros

 #;соберём в одну глобаль все модели и запчасти
 k glob,i,count,item,z

 #;список аббревиатур мастермакс через запятую
 #;списки которые через запятую перегоним в массивы, и вырежем пробелы
 f brandname="MM","VC","TL" d
 . s @brandname=$$$TunesVariableGlobal(brandname)
 . f i=1:1:$L(@brandname,",") d
 . . //обрезаем пробелы
 . . s abbr=$TR($P(@brandname,",",i)," ","")
 . . q:abbr=""
 . . s @brandname@(abbr)=""

 s glob=$NA(^mtempOthcet($J)) k @glob
 
 d:$ISOBJECT(obj.Items)
 . s i="" f  s i=obj.Items.Next(i) Q:i=""  d
 . . s item=obj.Items.GetAt(i)
 . . s groups=+item.Groups 
 . . Q:'$IsObject(item.Goods)
 . . s GoodsId = item.Goods.%Id()
 . . &sql(select Groups->Catalogue->Name into :CatalogueName from Goods.GoodsGroup where Goods=:GoodsId)
 . . else  s CatalogueName="Каталог не найден"
 . . if SQLCODE s CatalogueName="Каталог не найден"
 . . s Summa=item.CalculatedStringRubSumma()
 . . s SumsArray(CatalogueName)=$G(SumsArray(CatalogueName))+Summa
 . . if $ISOBJECT(item.RemTovar) d
 . . . //это модель
 . . . s @glob@(groups,"ModelName")=item.RemTovar.Name
 . . . s @glob@(groups,"AbbrNumber")=item.RemTovar.ModelNumber
 . . . s Abbr=item.RemTovar.abbr
 . . . s @glob@(groups,"Serial")=item.serial
 . . . s @glob@(groups,"Garant")=item.garant
 . . . s @glob@(groups,"Talon")=item.talonLogicalToDisplay(item.talon)
 . . . s @glob@(groups,"Quantity")=item.Quantity
 . . . s @glob@(groups,"RemontCost")=item.remcost
 . . . s @glob@(groups,"RemType")=item.RemType
 . . . s @glob@(groups,"ActNumber")=item.ActNumber
 . . . s:AllColumns&WordFormat @glob@(groups,"Comment")=item.Comment
 . . . s:AllColumns&WordFormat @glob@(groups,"Dat")=$S(+item.Dat:$ZD(item.Dat,4),1:"")
 . . . //s:AllColumns&WordFormat @glob@(groups,"goodssource")= ##class(Docs.OtchetItems).goodssourceLogicalToDisplay(item.goodssource)
 . . . s:AllColumns&WordFormat @glob@(groups,"RemType")=##class(Docs.OtchetItems).RemTypeLogicalToDisplay(item.RemType)
 . . . //s @glob@(groups,"Total")=item.Total
 . . . s @glob@(groups,"Summa")=Summa
 . . else  d
 . . . //это запчасть
 . . . i $I(DetailCount)
 . . . s @glob@(groups,DetailCount,"DetailName")=item.Goods.Name
 . . . s @glob@(groups,DetailCount,"DetailBrand")=item.Goods.abbr_"-"_item.Goods.Property3609
 . . . s Abbr=item.Goods.abbr
 . . . s @glob@(groups,DetailCount,"Quantity")=item.Quantity
 . . . s @glob@(groups,DetailCount,"DetailPrice")=item.Price
 . . . s:WordFormat @glob@(groups,DetailCount,"Comment")=item.Comment
 . . . s @glob@(groups,DetailCount,"Dat")=$S(+item.Dat:$ZD(item.Dat,4),1:"")
 . . . s @glob@(groups,DetailCount,"goodssource")= ##class(Docs.OtchetItems).goodssourceLogicalToDisplay(item.goodssource)
 . . . s @glob@(groups,DetailCount,"RemType")=##class(Docs.OtchetItems).RemTypeLogicalToDisplay(item.RemType)
 . . . s @glob@(groups,DetailCount,"Summa")=Summa
 . . . //s @glob@(groups,DetailCount,"Total")=item.Total
 . . s var=$S($D(MM(Abbr)):"MM",$D(VC(Abbr)):"VC",$D(TL(Abbr)):"TL",1:"untitled")
 . . s @var=+$G(@var)+Summa
 . . k item
 
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s ModelName=$G(@glob@(i,"ModelName"))
 . s AbbrNumber=$G(@glob@(i,"AbbrNumber"))
 . s Serial=$G(@glob@(i,"Serial"))
 . s GarantId = $G(@glob@(i,"Garant"))
 . s Garant= GarantId
 . //s:GarantId'="" Garant=Garant_"/"_##class(Common.Dictionary2).GetPropertyValue(GarantId,"Property9194")
 . s Talon=$G(@glob@(i,"Talon"))
 . s Quantity=$G(@glob@(i,"Quantity"))
 . s RemontCost=$G(@glob@(i,"RemontCost"))
 . s Comment=$G(@glob@(i,"Comment"))
 . s Dat=$G(@glob@(i,"Dat"))
 . s goodssource=$G(@glob@(i,"goodssource"))
 . s RemType=$G(@glob@(i,"RemType"))
 . s ActNumber=$G(@glob@(i,"ActNumber"))
 . s ActNumberName=$S(ActNumber="":"",1:" Акт "_ActNumber)
 . s RemTypeName = ##class(Docs.OtchetItems).RemTypeLogicalToDisplay(RemType)
 . //s Total=$G(@glob@(i,"Total"))
 . s (DetailPrice,DetailName)="&nbsp;"
 . i $I(count)
 . w "<tr VALIGN=TOP>"
 . w "<td width=21 title="""_Comment_""">",$G(count),"</td>"
 . w "<td width=101 style=""word-break:break-all"">",$G(ModelName),"</td>"
 . w "<td width=58>",$G(AbbrNumber),"</td>"
 . w "<td width=106>",$G(Serial),"</td>"
 . w "<td width=70>",$G(Garant),"</td>"
 . w "<td width=46>",$G(Talon)," (",RemTypeName,ActNumberName,")","</td>"
 . w "<td width=118>",$G(DetailName),"</td>"
 . w "<td width=82></td>"
 . w "<td width=34>",$G(Quantity),"</td>"
 . w "<td width=70>-</td>"
 . w "<td width=58>",$G(RemontCost),"</td>"
 . if WordFormat&AllColumns w "<td>",$G(Comment)	//примечание
 . if WordFormat&AllColumns w "<td>",$G(Dat)	//дата
 . if WordFormat&AllColumns w "<td>",$G(goodssource)	//источник товара
 . if WordFormat&AllColumns w "<td>",$G(RemType)	//тип ремонта
 . //if WordFormat w "<td>"_$G(Total)	//сумма
 . w "</tr>",!
 . s z="" f  s z=$O(@glob@(i,z)) q:z=""  d
 . . q:'+z
 . . i $I(count)
 . . s DetailName=@glob@(i,z,"DetailName")
 . . s DetailBrand=@glob@(i,z,"DetailBrand")
 . . s Quantity=@glob@(i,z,"Quantity")
 . . s DetailPrice=@glob@(i,z,"DetailPrice")
 . . s Comment=$G(@glob@(i,"Comment"))
 . . s Dat=$G(@glob@(i,"Dat"))
 . . s goodssource=$G(@glob@(i,"goodssource"))
 . . s RemType=$G(@glob@(i,"RemType"))
 . . s ActNumber=$G(@glob@(i,"ActNumber"))
 . . //s Total=$G(@glob@(i,"Total"))
 . . s (ModelName,AbbrNumber,Serial,Garant,Talon,RemontCost)="&nbsp;"
 . . if Quantity="" s Quantity="&nbsp;"
 . . if DetailPrice="" s DetailPrice="&nbsp;"
 . . if DetailName="" s DetailName="&nbsp;"
 . . s Summa = $G(@glob@(i,z,"Summa"))
 . . w "<TR VALIGN=TOP>"
 . . w "<td width=21>",$G(count),"</td>"
 . . w "<td width=101 style=""word-break:break-all"">",$G(ModelName),"</td>"
 . . w "<td width=58>",$G(AbbrNumber),"</td>"
 . . w "<td width=106>",$G(Serial),"</td>"
 . . w "<td width=70>",$G(Garant),"</td>"
 . . w "<td width=46>",$G(Talon),"</td>"
 . . w "<td width=118>",$G(DetailName),"</td>"
 . . w "<td width=82>",$G(DetailBrand),"</td>"
 . . w "<td width=34>",$G(Quantity),"</td>"
 . . w "<td width=70>",$G(Summa),"</td>"
 . . w "<td width=58>",$G(RemontCost),"</td>"
 . . if WordFormat&AllColumns w "<td>",$G(Comment)	//примечание
 . . if WordFormat&AllColumns w "<td>",$G(Dat)	//дата
 . . if WordFormat&AllColumns w "<td>",$G(goodssource)	//источник товара
 . . if WordFormat&AllColumns w "<td>",$G(RemType)	//тип ремонта
 . . //if WordFormat w "<td>"_$G(Total)	//сумма
 . . w "</TR>"
 k @glob
	&html<</table><p>Сумма отчёта<span> #($G(summa))#>
	
 #; в итоге сумма должна сопровождаться названием валюты 
 #; (название забить прям в коде страницы), 
 #; некоторые клиенты работают в долларах, некоторые в рублях, 
 #; различать их можно по полю в Common.Kontragent (не помню название - там в комментах видно)	
 if $IsObject(obj)&&$IsObject(obj.Kontr) w obj.Kontr.CurrencyLogicalToDisplay(obj.Kontr.Currency)	
 #;if +$G(DocKurs) w "Курс "_$G(DocKurs)
 &html<</span></p>>
 
 #;для клиентов НЕ должно быть видно блока под таблицей, 
 #;для пользователей системы СкладСервис этот блок должен быть виден
 if $$$client="" {
	 w "<br><br>Сумма сгруппированная по классификаторам<table>"
	 f i="" f  s i=$O(SumsArray(i)) q:i=""  d
	 . w "<tr><td>",i,"<td>",$J($G(SumsArray(i)),"",2)
	 w "</table>"
 
	 w "<br>Сумма сгруппированная по брендам<table>"
	 w "<tr><td>Mastermax<td>"_$J($G(MM),"",2)
	 w "<tr><td>Viconte<td>"_$J($G(VC),"",2)
	 w "<tr><td>Tull<td>"_$J($G(TL),"",2)
	 w:+$G(untitled) "<tr><td>Товары с неизвестным брендом<td>"_$J($G(untitled),"",2)
	 w "</table><br>" 
	 w "Валюта расчётов с клиентом: "_$G(CurrencyName)
 }
	&html<
	<div>
		<p>Директор сервисного
		центра					/______________/</p>
		
		<p>&laquo;___&raquo;________________201 г.</p>												М.П.
	</div></body></html>>
	Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.KaReports">
<Description><![CDATA[
Список отчетов по заявкам
Часть страницы <class>csp.KaOrders</class>
Самостоятельно в качестве страницы не выступает]]></Description>
<Super>%CSP.Page,csp.KaProtected</Super>
<TimeCreated>62651,41274.753077</TimeCreated>

<Parameter name="DOMAIN">
<Description>
Точка локализации</Description>
<Default>sklad2</Default>
</Parameter>

<Method name="OnPage">
<Description>
Только часть страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  &html<<table id="KaReportsg"></table><div id="KaReportsb"></div>
	<script type="text/javascript">
	$(function(){
				
	var GRID="#KaReportsg", $GRID=$(GRID)
	BAR="#KaReportsb",URL='#(..Link("json.KaReports.cls"))#';
	var printDoc=function(id){
		if (!id) id=""; 
		if (id=="")
		{
			alert("Укажите, пожалуйста, отчёт.");
			return;
		}
		var href='#(..Link("screen/otchet2.csp"))#';
		var ch=(href.indexOf("?")>-1)?"&":"?";
		window.open(href+ch+"id="+id);
	};
	 
	var GOPTS={
			url: URL, editurl: URL
			,datatype: "json"
			,jsonReader : { repeatitems: false }
			,colModel: [
				{name:"id",hidden: true}
				,{name:"dt",label:'#($$$Text("Дата"))#',width:120
					, search:true
					, stype: 'text'
					, searchoptions:{
						dataInit: function(elem){
							/*$(elem).datepicker(
								{dateFormat:'yy-mm-dd'
									,changeMonth: true
									,changeYear: true
									,yearRange: "2006:+1"
								}
							);*/	
						}	
					}
				
				}
				,{name:"nm",label:'#($$$Text("Наименование документа"))#',width:450
					, search:true
				}
			]
		,sortname: "dt", sortorder: "desc"
		,pager:BAR 
		,viewrecords:true
		,height:300
		,hidegrid: false
		,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
		,hoverrows:true ,scroll:1
		,ondblClickRow: function(id){openDoc(id);}
	}; 
	
 var userSettings=$GRID.jqGrid("userSettings", GOPTS); 
	 
 $GRID.jqGrid( userSettings )
	 	.jqGrid('navGrid',BAR, {
       	add: false
   		, edit:false
   		, del:false 
   		, view:false
   		, search:false
	}).jqGrid('navButtonAdd',BAR,{ 
		caption:'#($$$Text("Печать"))#', buttonicon:"ui-icon-print"
		,position: 'first'
		, title:'#($$$Text("Распечатать документ"))#' 
		, onClickButton: function(id){
			var id=$(GRID).jqGrid("getGridParam","selrow");
			printDoc(id);
		}
   })
   .jqGrid('filterToolbar',{searchOnEnter:false})
   .jqGrid('gridResize',{});
   $GRID.jqGrid("improve");	  
}); </script>>
  Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.KontragentAccount">
<Description>
Просмотр журнала транзакций с контрагентом</Description>
<Super>csp.Design</Super>
<TimeCreated>62365,79584.542154</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Method name="wMeta">
<Description>
write Вывод мета тэгов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<meta http-equiv="Content-Language" content="ru"><meta http-equiv="Content-Type" content="text/html; charset=utf-8">>
 Q ""
]]></Implementation>
</Method>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 w "Склад.v2::Просмотр баланса контрагента" 
 Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s kid=$g(args("id",1))
 s name="",balance=""
 if ##class(Common.Kontragent).%ExistsId(kid) {
  s name=##class(Common.Kontragent).NameGetStored(kid)
  s balance=+##class(Common.Kontragent).BalanceGetStored(kid)
 }
 w "Контрагент: ",name,"; Текущий баланс: ",balance," руб. "
 Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<
 <link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
 <style type="text/css">
 	.ui-jqgrid {font-size:90%;}
 	.ui-widget {font-size:.8em;}
</style>
 >
 Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<<table id="table"><tr><td></td></tr></table><div id="tableCtrl"></div>
<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<script type="text/javascript">

;

$(function(){
 function obj2str(obj){ //преобразование js объекта в строку
  var arr=new Array();
  for (var i in obj){ arr.push(i+"="+obj[i]); }
  return arr.join("&");
 }; 
 
 $("#table").jqGrid({
  datatype: function(p){
   var query=obj2str(p); //объект в GET строку
   #call(..gData(query,"parent.add2grid"))#  
  }
  ,jsonReader: {repeatitems:false}
  ,caption: "Баланс контрагента"
  ,colModel: [
      {name:'id',label:'Код', width:'40' ,hidden:true}
      ,{name:'doc',label:'Документ', hidden:true,search:false}
      ,{name:'ts',label:'Дата Время', width:'140'
      		,formatter: function (cellvalue, options, rowObject){ 
      				var doc=rowObject["doc"].split(",");
      				var dclass=doc[0],docid=doc[1];
      				return "<a href='print.csp?class="+dclass+"&id="+docid+"' title='Просмотреть документ' >"+cellvalue+"</a>"; 
      			}
      	}
      ,{name:'shift',label:'Cумма, руб',width:'100',search:false,align:"right"}
      ,{name:'amount',label:'Итого, руб.',width:'100',search:false,align:"right"}
      ,{name:'factor',label:'Курс $',width:'100',search:false,align:"right"}
      ,{name:'amountUSD',label:'Итого, $',width:'100',search:false,align:"right"}
    ]
  ,postData:{holder: #(..QuoteJS($g(args("id",1))))#}
  ,sortname:"ts",sortorder:"desc"
  ,autowidth:true,height:450,hidegrid:false 
  ,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
  ,pager:"#tableCtrl" ,/*scrollrows:true,*/hoverrows:true ,scroll:1
 });
 
 $("#table").jqGrid('navGrid',"#tableCtrl", 
       {add:false,edit:false,del:false,view:false,search:false}
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{}
 ).jqGrid('gridResize',{minWidth:100,minHeight:100})
  .jqGrid('filterToolbar',{searchOnEnter:false})
  .jqGrid('navButtonAdd',"#tableCtrl",{
    caption: "Столбцы",
    title: "Настройка столбцов",
    onClickButton : function (){
        jQuery("#table").jqGrid('columnChooser');
    }
});
    

});

window.add2grid=function(json){
 $("#table")[0].addJSONData(json); 
};

</script>>
 Q ""
]]></Implementation>
</Method>

<Method name="gData">
<Description>
Подготовка и выдача данных </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>p:%String="",jsfunc:%String="alert"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 
 #;w "alert(",..QuoteJS(p),");"
 
 #; разбор на пары holder=12&search=false&....
 s list=$LFS(p,"&"),i=0,keyval=""
 while $listnext(list,i,keyval){
  s key=$p(keyval,"="),val=$p(keyval,"=",2)
  s p(key)=val 
 }
 
 s sql="Select ID,ts,doc->DocumentClass as dclass,doc,shift,amount,factor,amountUSD"
   _" FROM Account.Kontragent "
   _" Where holder = ? "
 s qp="" s qp($i(qp))=$g(p("holder")) ;обязательный по логике параметр
 
 #; Where
 if $g(p("_search"))="true" { ;включен режим поиска 
  
  
  #; ожидаем поиска по дата-времени 
  if $d(p("ts")) {
   s sql=sql_" AND ts %STARTSWITH ? "
   s qp($i(qp))=$g(p("ts")) 
  }
  #; или id 
  if $d(p("id")) {
   s sql=sql_" AND id = ? "
   s qp($i(qp))=$g(p("id")) 
  }
 }
 #; сортировка 
 s sidx=$g(p("sidx")), sord=$g(p("sord"))
 s:sidx'="" sql=sql_" ORDER BY "_sidx_" "_sord
 
 #;w "alert(",..QuoteJS(sql),");"
 
 #; ограничения - какую страницу по сколько строк
 s page=$g(p("page"),1), rows=$g(p("rows"),100)
 s max=page*rows, min=max-rows
 
 
 s sc="", rs=..GetRS(sql,.qp,.sc) if '$IsObject(rs) Q 
 
 w jsfunc,"({rows:["
 s records=0, first=1
 while rs.Next(){
  
  s records=records+1
  if records<min continue
  if records>max continue
  w:'first "," s:first first=0
  d ..wRow(rs)
  
 }
 s total=records\rows ;целых страниц
 s:records#rows>0 total=total+1 ;учтем остаток
 w "],page:",page,",records:",records,",total:",total,"});"
 d rs.Close(), rs.%Close() k rs
]]></Implementation>
</Method>

<Method name="GetRS">
<Description><![CDATA[
Подготавливает запрос
<var>qp</var> - Query Paramaters - массив(1)=value,(2)=value2]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[sql:%String,&qp:%String="",&sc:%String=""]]></FormalSpec>
<ReturnType>%ResultSet</ReturnType>
<Implementation><![CDATA[
 s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
 s sc=rs.Prepare(sql) Q:'sc ""
 s sc=rs.Execute(
  $g(qp(1)),$g(qp(2)),$g(qp(3)),$g(qp(4)),$g(qp(5)),$g(qp(6)),$g(qp(7)),$g(qp(8))
  ,$g(qp(9)),$g(qp(10)),$g(qp(11)),$g(qp(12)),$g(qp(13)),$g(qp(14)),$g(qp(15)),$g(qp(16))
 )
 q rs
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
/*&js<{"page":1,"total":1,"records":1,"rows":[
 {"id":1
  ,"ts":"2011-01-01 01:01:01.75642"
  ,"doc":"Платежка"
  ,"shift":300
  ,"amount":1000
  ,"factor":28.5778
  ,"amountUSD":30
 }
]}>*/
]]></Content>
</UDLText>

<Method name="wRow">
<ClassMethod>1</ClassMethod>
<FormalSpec>rs:%ResultSet</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 #define g(%fn) $g(rs.Data(%fn))
 &js<{id:#($$$g("ID"))#,ts:#(..QuoteJS($$$g("ts")))#
 			,doc:#(..QuoteJS($$$g("dclass")_","_$$$g("doc")))#
 			,shift:#($$$g("shift"))#,amount:#($$$g("amount"))#,factor:#($$$g("factor"))#,amountUSD:#($$$g("amountUSD"))#}>
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.Logon">
<Description>
Устарела - оставлена для совместимости
Страница входа в подсистему web доступа для контрагентов</Description>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62650,40877.487019</TimeCreated>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	s %response.Redirect=..Link("csp.KaAuth.cls")
	Q 1
]]></Implementation>
</Method>
</Class>


<Class name="csp.makeTovNaklV2">
<Description>
Страница выбора параметров печати товарной накладной
с настройкой фамилий в подвале</Description>
<Super>%CSP.Page</Super>
<TimeCreated>63141,56816.607642</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 
 /*Вывод страницы*/   
 s id=%request.Get("docid"), cls = %request.Get("class","tovnakladn")
 s (nm,dt,k,knm)=""
 s (gzo,gzonm,pst,pstnm)=""
 
  
 if ##class(Docs.Rash).%ExistsId(id){
    s nm = ##class(Docs.Rash).NameGetStored(id)
    , dt = ##class(Docs.Rash).DatGetStored(id), dt=$zd(dt,4), dt=$tr(dt,"/",".")
    s k = ##class(Docs.Rash).KontrGetStored(id) if ##class(Common.Kontragent).%ExistsId(k) {
     s knm = ##class(Common.Kontragent).NameGetStored(k)
    }
 }
 
 #; Грузоотправитель
 s gzo=%request.GetCookie("GruzootpravitelID") if ##class(Common.Kontragent).%ExistsId(gzo) { 
    s gzonm=##class(Common.Kontragent).NameGetStored(gzo)
 }

 s pst=%request.GetCookie("PostavchikID") if ##class(Common.Kontragent).%ExistsId(pst) {
    s pstnm=##class(Common.Kontragent).NameGetStored(pst)
 } 
   
 &html<<!doctype html><html><head><title> #($G(%session.Data("systemname")))# </title>
<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.22.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid-4.4.0.css'/>
<style type='text/css'>
    
html,body {margin:0,padding:0}
.fieldset { padding: .3em;}
#send {margin:1em auto 0 auto;text-align:center;}
#close {margin:0 0 0 1em;}
.input { cursor:hand; }
.datepicker {width:8em;}

/*уменьшим гигантские отступы на кнопках*/
.ui-button-text-only .ui-button-text { padding: .1em .5em .1em .5em }

/*и закладках*/
.ui-tabs .ui-tabs-nav LI A { padding: .2em .5em .2em .5em }

/*Больше шрифт в гриде*/
.ui-jqgrid .ui-jqgrid-view { font-size: 1em; }
        
    </style>
</head><body>
<div id='tabs'>
<ul>
    <li><a href='#params'>Формирование товарной накладной</a></li>
</ul>

<div id='params'>
<table>
<tr>
    <td>Накладная №:</td>
    <td>
        <input id="nm" value='#(nm)#' class='input'/>
    </td>
    <td>дата: </td>
    <td>
        <input id="dt" value='#(dt)#' class='input datepicker'/>
    </td>
</tr>
<tr>
    <td>Грузоотправитель</td>
    <td colspan='3'>
        <input id="gzo" data-id='#(gzo)#' value='#(gzonm)#' class='refinp' 
            data-dlgtitle='Выбор грузоотправителя' 
        />
    </td>
</tr>
<tr>
    <td>Грузополучатель</td>
    <td colspan='3'>
        <input id="gzp" data-id='#(k)#' value='#(knm)#' class='refinp'
            data-dlgtitle='Выбор грузополучателя' 
         />
    </td>
 </tr>
<tr>
    <td>Поставщик</td>
    <td colspan='3'>
        <input id='pst' data-id='#(pst)#' value='#(pstnm)#' class='refinp'
            data-dlgtitle='Выбор поставщика' 
        >
    </td>
</tr>
<tr>
    <td>Плательщик</td>
    <td colspan='3'>
        <input id='plt' data-id='#(k)#' value='#(knm)#' class='refinp'
            data-dlgtitle='Выбор плательщика' 
        >
     </td>
</tr>
<tr>
    <td colspan='4'>
    <div class='ui-widget-content fieldset'>
        <input id="ndsi" type="checkbox" name="ndsi" checked="checked">
        <label for="ndsi" >НДС включён в цену товара</label>
    </div>
    </td>
</tr>
</table>
<table>
<tr>
    <td >Отпуск груза разрешил:</td>
    <td><input id='permitter' ></td>
</tr>
<tr>
    <td>Доверенность №:</td>
    <td><input id="dv" name="dv" size='5' class='input' ><span> от: </span><input id="dvdt" name="dvdt" class='input datepicker'></td>
</tr>
<tr> 
    <td>Отпуск груза произвел:</td>
    <td><input id='executor' ></td>
</tr>   
</table>

<form id='send' action='#(..Link("print.csp"))#' target='_blank'>
    <input type='hidden' id='sessionid' name='sessionid'  value='#(%session.SessionId)#'/>
    <input type='hidden' id="class" name='class' value='#(cls)#' />
    <input type='hidden' id='id' name='id' value='#(id)#' />
    <input type='hidden' id='nomernakl' name='nomernakl' />
    <input type='hidden' id='DocDate' name='DocDate' />
    <input type='hidden' id='kontr' name='kontr'>
    <input type='hidden' id='kontr2' name='kontr2'>
    <input type='hidden' id='kontr3' name='kontr3'>
    <input type='hidden' id='kontr4' name='kontr4'>
    <input type='hidden' id='otpr' name='otpr'>
    <input type='hidden' id='otpp' name='otpp'>
    
    
    <input type='hidden' id='NDSinside' name='NDSinside'>
    <button type='submit' id='open'>Открыть</button>
    <button type='submit' id="excel" name='excel' >MS Excel</button>
    <button type='submit' id="word" name='word' >MS Word</button>
    
    <button type='button' id='close' >Отмена</button>
    <!--button type='button' id='debug' >dbg</button-->
</form>

</div>

</div><!--tabs-->

<div id='kdlg'>
    <table id='kgrid'></table>
    <div id='kbar'></div>
</div>

<script type='text/javascript' src="common.js"></script>
<script type='text/javascript' src='js/jquery-1.7.2.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.22.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/jquery-ui.datepicker-ru.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.4.0.min.js'></script>

<script type='text/javascript'>

$(function(){
 
 /// обертка для учета кодировки
 function fnCookie( key, val ){
     if (val === undefined){
        return unescape( GetCookie( key ) || "" );
     } else {
        SetCookie( key, escape( val ) )  
     }
 }
 
 
 $('#permitter').val( fnCookie('permitter') ); //отпуск разрешил
  $('#executor').val( fnCookie('executor') ); //отпуск произвел
 
 $('#dv').val( GetCookie('dv') ); //номер доверенности
 $('#dvdt').val( GetCookie('dvdt') ); //дата доверенности 

 $('#tabs').tabs({}) //две закладки
 $('input').addClass('ui-widget-content'); //плоская граница
 $('.datepicker').datepicker( $.datepicker.regional[ 'ru' ]); //календарик
 $('#open,#excel,#word,#close,#debug').button({}); //кнопки 
 
 $('#debug').on('click', function(){
    $('#send').attr('action','csp.screen.torg12v2Debug.cls') 
 });
 
 $('#close').on('click', function(){ window.close(); });
  
 $('#send').on('submit', function(){ 
   
    var gzo=$('#gzo'); if ( !gzo.val() ) { alert( "Не заполнено поле Грузоотправитель" ); return false; }
    var gzp=$('#gzp'); if ( !gzp.val() ) { alert( "Не заполнено поле Грузополучатель" ); return false; }
    var pst=$('#pst'); if ( !pst.val() ) { alert( "Не заполнено поле Поставщик" ); return false; }
    var plt=$('#plt'); if ( !plt.val() ) { alert("Не заполнено поле Плательщик"); return false; }
    var nm=$('#nm'); if ( !nm.val() ) { alert( "Не заполнен номер накладной" ); return false; }
    
    /// это передаем через куки
    SetCookie("GruzootpravitelID", gzo.data('id')); SetCookie("PostavchikID",pst.data('id'));
    SetCookie("dv", $('#dv').val());  SetCookie("dvdt", $('#dvdt').val()); //номер и дата доверенности 
    
    //отпуск груза разрешил и произвел
    fnCookie("permitter", $('#permitter').val() ); 
    fnCookie("executor", $('#executor').val() ); 
    
    /// это через запрос
    $( "#kontr").val( gzo.data('id') ); $("#kontr2").val( gzp.data('id') );
    $( "#kontr3" ).val( pst.data('id') ); $("#kontr4").val(plt.data('id'));
    $( "#nomernakl").val( nm.val() ); $( "#DocDate" ).val( $('#dt').val().split('.').join('/') );
    $( "#NDSinside" ).val( $('#ndsi').prop('checked') );
    $( "#otpr" ).val( $('#permitter').val() )
    $( "#otpp" ).val( $('#executor').val() ) 
   
 })
 
 /// ********* Диалог выбора контрагента ************
 
 /// грид 
 var kgrid = $('#kgrid').jqGrid({
     url: '#(..Link("json.Kontragent.cls"))#'
     ,datatype: "json", jsonReader : { repeatitems: false }
     ,colModel: [
        {name:'name', label:'Наименование', width: 300}
        ,{name:'city', label:'Город'}
     ]
     , scroll:1, gridview: true
     , rows: 100
     , height: 280, pager: '#kbar'
 })
 .jqGrid('navGrid','#kbar', { add: false, edit:false, del:false, view: false, search:false })
 .jqGrid('filterToolbar',{searchOnEnter:false}) 
 

 //диалог выбора контрагента
 var kdlg = $('#kdlg');
 kdlg.dialog({ 
    title: 'Выбор контрагента'
    , modal: true, autoOpen: false
    , width: 580, height: 420
    , buttons: [
        { text:'Выбрать', click: OnSelectRow }
        , { text:'Отмена', click: function(){ $(this).dialog('close') }}
    ]
 });
 
 /// обработчик при выборе строки
 var OnSelectRow = function(){ 
     var id = kgrid.jqGrid('getGridParam','selrow')
     , data = kgrid.jqGrid('getRowData',id);
     kdlg.trigger('dialogselect', [id, data["name"] ]);
 } 
 
 /// двойной клик на строке 
 kgrid.on('jqGridDblClickRow', OnSelectRow)
 
 ///При изменении размеров диалога меняем размер грида
 kdlg.on('dialogresize', function(){
    var dlg = $(this), width = dlg.width(), height = dlg.height(); 
    kgrid
     .jqGrid('setGridWidth', width-20 )
     .jqGrid('setGridHeight', height-80 )
    ;
 })
 
 ///При открытии диалога, обновляем грид и его размеры
 kdlg.on('dialogopen', function(){
    kgrid.trigger('reloadGrid');
    kdlg.trigger('dialogresize');
 });
 
///дополняем инпуты кнопками для выбора контрагента
 $('.refinp').each(function ( ){
     
    var inp=$( this ), box = inp.parent()
    , select = $( '<button type="button"></button>' )
      .appendTo( box )
      .button({text:false, icons: {primary: 'ui-icon-newwin' }})
    ;
    
    /// обработчик выбора
    var onselect = function(e, id, name ){
       inp.data( 'id', id ).val( name );
       $(this).dialog('close');
    }
    
    select.on('click', function(){
        kdlg.dialog('option','title', inp.data('dlgtitle'))
            .on('dialogselect', onselect)
            .one('dialogclose', function(){ $(this).off('dialogselect')}) //закроется - отключимся и концы в воду
            .dialog('open');    
    });
    
    inp.attr('readonly', 'readonly').on('click', function(){ select.click(); })
    
 }); 
 
 $("body").bind('keypress', ManageWindow ); //esc - close, enter - submit
 
 /*$('#debug').on('click', function(){
    $('#send').attr('action','csp.screen.torg12v4.cls');
    return false;
 })*/
     
})
</script>
</body>
</html>> 
 Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.PaymentOrderView">
<Description>
Просмотр платежного поручения </Description>
<Super>%CSP.Page</Super>
<TimeCreated>62353,64876.384088</TimeCreated>

<Method name="GP">
<Description><![CDATA[
Получение свойства объекта c проверками 
<example> w ..GP(doc,"Plat.INN")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,props</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if '$IsObject(obj) Q ""
 s plist=$LFS(props,"."), plen=$ll(plist) 
 s val="",prop="",oprop=obj
 for pi=1:1:plen {
  s prop=$LG(plist,pi) Q:pi=plen
  s oprop=$zobjproperty(oprop,prop)
  if '$IsObject(oprop) s oprop="" Q 
 }
 Q:$IsObject(oprop) $zobjproperty(oprop,prop)
 Q ""
]]></Implementation>
</Method>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  
 s did=$g(%request.Data("id",1)) ;код документа
 s doc=##class(Docs.Platejka).%OpenId(did) ;сам документ
 
 &html<<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="plat-por.files/filelist.xml">
<title>#(did)#</title>>
 d ..wCss() ;выводим стили

 &html<</head>

<body lang=RU link=blue vlink=purple style='tab-interval:36.0pt;text-justify-trim:punctuation'>
<div class=Section1>
<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'> 
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>>
  
  #; Поступило в банк плательщика
  	
  &html<</o:p></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>> 
  
  #; списано со счета плательщика
  
  &html<</o:p></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 style='width:42.5pt;border:solid windowtext 1.0pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>0401060</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Поступ. в банк плат.<o:p></o:p></span></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Списано со сч. плат.<o:p></o:p></span></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=57 valign=bottom style='width:42.5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:18.0pt'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal style='tab-stops:center 205.55pt'><b><span
  style='font-size:12.0pt'>ПЛАТЕЖНОЕ ПОРУЧЕНИЕ № <span style='mso-tab-count:
  1'>          </span><o:p>>
 
   #; Номер документа	
   w ..GP(doc,"Name")
 
  &html<</o:p></span></b></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>#($tr($zd(..GP(doc,"Dat"),4,,,,,,,""),"/","."))#</o:p></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>>
  
  #; Вид платежа
  w "Электронно"
  
  &html<</o:p></p>
  </td>
  <td width=28 valign=bottom style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=26 valign=bottom style='width:19.85pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p></o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Дата<o:p></o:p></span></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p></o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Вид платежа<o:p></o:p></span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=26 valign=top style='width:19.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;border:none;mso-border-left-alt:
 solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:
 solid windowtext .5pt;mso-padding-alt:0cm 1.4pt 0cm 1.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:41.0pt'>
  <td width=76 valign=top style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal>Сумма</p>
  <p class=MsoNormal>прописью</p>
  </td>
  <td width=605 colspan=12 valign=top style='width:16.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #; Сумма прописью  
  w ##class(Utils.Propis).Write(..GP(doc, "RubSumma"))
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:41.0pt;border:none' width=0 height=55></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  >
  
  #; Инн плательщика
  #;doc.Kontr.bank.inn
  w ..GP(doc, "Kontr.bank.inn")
  
  &html<</span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  >
 
  #; КПП плательщика 
  #;w doc.Kontr.bank.kpp
  w ..GP(doc, "Kontr.bank.kpp")
  
  &html<</span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сумма</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
   #; Сумма 
   #;w doc.Summa
   ;w ..GP(doc,"Summa")	 
   w ..GP(doc, "RubSumma")
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:2;page-break-inside:avoid;height:28.5pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  border-right:solid windowtext 1.0pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.5pt'>
  <p class=MsoNormal><o:p>>
   
   #; w "Наименование плательщика"
   w ..GP(doc,"Kontr.Name")
  
  &html<</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.5pt;border:none' width=0 height=38></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:3;page-break-inside:avoid;height:28.0pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;mso-border-top-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #;w "Счет плательщика" 
  #;w doc.Kontr.bank.rsch 
  w ..GP(doc,"Kontr.bank.rsch")
  
   
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:4;page-break-inside:avoid;height:14.1pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.1pt'>
  <p class=MsoNormal>Плательщик</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.1pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:5;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>>
  
  	#;w "Наименование банка плательщика"
  	#;w doc.Kontr.bank.pbank
  	w ..GP(doc,"Kontr.bank.pbank")
  
  &html<</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  	
  	#;w "БИК банка плательщика"
  	#;w doc.Kontr.bank.bik
  	w ..GP(doc,"Kontr.bank.bik")
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:6;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  	
  	#;w "Счет банка плательщика"
  	#;w doc.Kontr.bank.ksch
  	w ..GP(doc,"Kontr.bank.ksch")
  	
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:7;page-break-inside:avoid;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Банк плательщика</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language	:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:8;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>> 
  
   #;w "Наименование банка получателя"
   #;w doc.Poluh.bank.pbank
   w ..GP(doc,"Poluh.bank.pbank")
   
   
  &html<</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #;w "БИК получателя"
  #;w doc.Poluh.bank.bik
  w ..GP(doc, "Poluh.bank.bik")
   
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:9;page-break-inside:avoid;height:14.65pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:solid windowtext 1.0pt;border-bottom:none;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #;w "Счет банка получателя"
  #;w doc.Poluh.bank.ksch
  w ..GP(doc,"Poluh.bank.ksch")
  
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.65pt;border:none' width=0 height=20></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:10;page-break-inside:avoid;height:14.6pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.6pt'>
  <p class=MsoNormal>Банк получателя</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.6pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:11;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  >
  
  #; w doc.Poluh.bank.inn
  w ..GP(doc,"Poluh.bank.inn")
  
  &html<</span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:solid windowtext 1.0pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  >
  
  #; w doc.Poluh.bank.kpp
  w ..GP(doc,"Poluh.bank.kpp")
  
  &html<</span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #;w "Счет получателя"
  #;w doc.Poluh.bank.rsch
  w ..GP(doc,"Poluh.bank.rsch")
  
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:12;page-break-inside:avoid;height:28.0pt'>
  <td width=378 colspan=6 rowspan=3 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal><o:p>>
  
  #;w "Получатель"
  w doc.Poluh.Name
  
  
  &html<</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:13;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Вид оп.</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:solid windowtext 1.0pt;border-left:
  none;border-bottom:none;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
   
   #;w "Вид оплаты"
   #;w "???"
   
  &html<</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Срок плат.</p>
  </td>
  <td width=94 colspan=2 
  	style='border:none;mso-border-top-alt:solid windowtext 1pt;width:70.85pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  	
  	#;w "Срок платежа"
  	#;w "???"
  	
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:14;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Наз. пл.</p>
  </td>
  <td width=76 style='width:2.0cm;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
   #; Назначение платежа
   #; w "???"
  &html<</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Очер. плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #; Очередь платежа
  #; w "???"
  
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:15;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Получатель</p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Код</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #;"Код "
  #; w "???"
  
  &html<</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Рез. поле</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>>
  
  #; Рез. поле 
  #; w "???"
    	
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:16;height:13.0pt'>
  <td width=170 colspan=2 valign=bottom style='width:127.6pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>>
  
  #; Полоса полей перед назначением платежа 
  #; Первое поле слева
  
  &html<</o:p></p>
  </td>
  <td width=113 colspan=2 valign=bottom style='width:3.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>>
  
  #; Второе поле
  
  &html<</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 colspan=3 valign=bottom style='width:99.25pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:17;height:69.55pt'>
  <td width=680 colspan=13 valign=top style='width:18.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:69.55pt'>
  <p class=MsoNormal><o:p>>
   
   #; Назначение платежа
   #; w doc.Typeplatej.Name
   #; w ..GP(doc,"Typeplatej.Name")
   #; w "???"
   
   
  &html<</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:69.55pt;border:none' width=0 height=93></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:18;mso-yfti-lastrow:yes;height:13.65pt'>
  <td width=680 colspan=13 valign=bottom style='width:18.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.65pt'>
  <p class=MsoNormal>Назначение платежа</p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.65pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <![if !supportMisalignedColumns]>
 <tr height=0>
  <td width=76 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=76 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td style='border:none' width=0><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <![endif]>
</table>

<p class=MsoNormal style='margin-bottom:18.0pt;tab-stops:center 9.0cm left 14.0cm'><span
style='mso-tab-count:1'>                                                                                                         </span>Подписи<span
style='mso-tab-count:1'>                                                       </span>Отметки
банка</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=227 valign=bottom style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 rowspan=2 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:41.0pt'>
  <td width=227 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt;
  height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'>М.П.</p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>
<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>
<p class=MsoNormal><o:p>&nbsp;</o:p></p>
</div>


</body></html>>

 k doc ;закрываем документ
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="wCss">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &html<
 <!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>mvf</o:Author>
  <o:LastAuthor>Art</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:LastPrinted>2003-05-28T12:52:00Z</o:LastPrinted>
  <o:Created>2011-09-19T05:51:00Z</o:Created>
  <o:LastSaved>2011-09-19T05:51:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>61</o:Words>
  <o:Characters>354</o:Characters>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>414</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DoNotHyphenateCaps/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 пт</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 пт</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:Compatibility>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
  <w:LsdException Locked="true" Name="Normal"/>
  <w:LsdException Locked="true" Name="heading 1"/>
  <w:LsdException Locked="true" Name="heading 2"/>
  <w:LsdException Locked="true" Name="heading 3"/>
  <w:LsdException Locked="true" Name="heading 4"/>
  <w:LsdException Locked="true" Name="heading 5"/>
  <w:LsdException Locked="true" Name="heading 6"/>
  <w:LsdException Locked="true" Name="heading 7"/>
  <w:LsdException Locked="true" Name="heading 8"/>
  <w:LsdException Locked="true" Name="heading 9"/>
  <w:LsdException Locked="true" Name="toc 1"/>
  <w:LsdException Locked="true" Name="toc 2"/>
  <w:LsdException Locked="true" Name="toc 3"/>
  <w:LsdException Locked="true" Name="toc 4"/>
  <w:LsdException Locked="true" Name="toc 5"/>
  <w:LsdException Locked="true" Name="toc 6"/>
  <w:LsdException Locked="true" Name="toc 7"/>
  <w:LsdException Locked="true" Name="toc 8"/>
  <w:LsdException Locked="true" Name="toc 9"/>
  <w:LsdException Locked="true" Name="header"/>
  <w:LsdException Locked="true" Name="footer"/>
  <w:LsdException Locked="true" Name="caption"/>
  <w:LsdException Locked="true" Name="Title"/>
  <w:LsdException Locked="true" Name="Body Text"/>
  <w:LsdException Locked="true" Name="Subtitle"/>
  <w:LsdException Locked="true" Name="Hyperlink"/>
  <w:LsdException Locked="true" Name="Strong"/>
  <w:LsdException Locked="true" Name="Emphasis"/>
  <w:LsdException Locked="true" Name="Table Grid"/>
 </w:LatentStyles>
</xml><![endif]-->
 <style>
<!--
 /* Font Definitions */
 @font-face
 {font-family:Calibri;
 panose-1:2 15 5 2 2 2 4 3 2 4;
 mso-font-charset:204;
 mso-generic-font-family:swiss;
 mso-font-pitch:variable;
 mso-font-signature:-1610611985 1073750139 0 0 159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
 {mso-style-parent:"";
 margin:0cm;
 margin-bottom:.0001pt;
 mso-pagination:widow-orphan;
 text-autospace:none;
 font-size:10.0pt;
 font-family:"Times New Roman";
 mso-fareast-font-family:"Times New Roman";}

p.MsoHeader, li.MsoHeader, div.MsoHeader
 {mso-style-link:"Верхний колонтитул Знак";
 margin:0cm;
 margin-bottom:.0001pt;
 mso-pagination:widow-orphan;
 tab-stops:center 207.65pt right 415.3pt;
 text-autospace:none;
 font-size:10.0pt;
 font-family:"Times New Roman";
 mso-fareast-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
 {mso-style-link:"Нижний колонтитул Знак";
 margin:0cm;
 margin-bottom:.0001pt;
 mso-pagination:widow-orphan;
 tab-stops:center 207.65pt right 415.3pt;
 text-autospace:none;
 font-size:10.0pt;
 font-family:"Times New Roman";
 mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
 {mso-style-link:"Основной текст Знак";
 margin:0cm;
 margin-bottom:.0001pt;
 mso-pagination:widow-orphan;
 text-autospace:none;
 font-size:14.0pt;
 font-family:Arial;
 mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
 {font-family:"Times New Roman";
 mso-bidi-font-family:"Times New Roman";
 color:blue;
 text-decoration:underline;
 text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
 {color:purple;
 text-decoration:underline;
 text-underline:single;}
span.a
 {mso-style-name:"Верхний колонтитул Знак";
 mso-style-noshow:yes;
 mso-style-locked:yes;
 mso-style-link:"Верхний колонтитул";
 mso-ansi-font-size:10.0pt;
 mso-bidi-font-size:10.0pt;
 font-family:"Times New Roman";
 mso-ascii-font-family:"Times New Roman";
 mso-hansi-font-family:"Times New Roman";
 mso-bidi-font-family:"Times New Roman";}
span.a0
 {mso-style-name:"Нижний колонтитул Знак";
 mso-style-noshow:yes;
 mso-style-locked:yes;
 mso-style-link:"Нижний колонтитул";
 mso-ansi-font-size:10.0pt;
 mso-bidi-font-size:10.0pt;
 font-family:"Times New Roman";
 mso-ascii-font-family:"Times New Roman";
 mso-hansi-font-family:"Times New Roman";
 mso-bidi-font-family:"Times New Roman";}
span.a1
 {mso-style-name:"Основной текст Знак";
 mso-style-noshow:yes;
 mso-style-locked:yes;
 mso-style-link:"Основной текст";
 mso-ansi-font-size:10.0pt;
 mso-bidi-font-size:10.0pt;
 font-family:"Times New Roman";
 mso-ascii-font-family:"Times New Roman";
 mso-hansi-font-family:"Times New Roman";
 mso-bidi-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
 {mso-footnote-separator:url("plat-por.files/header.htm") fs;
 mso-footnote-continuation-separator:url("plat-por.files/header.htm") fcs;
 mso-endnote-separator:url("plat-por.files/header.htm") es;
 mso-endnote-continuation-separator:url("plat-por.files/header.htm") ecs;}
@page Section1
 {size:595.3pt 841.9pt;
 margin:34.0pt 1.0cm 1.0cm 2.0cm;
 mso-header-margin:19.85pt;
 mso-footer-margin:35.45pt;
 mso-header:url("plat-por.files/header.htm") h1;
 mso-footer:url("plat-por.files/header.htm") f1;
 mso-paper-source:0;}
div.Section1
 {page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
 {mso-style-name:"Обычная таблица";
 mso-tstyle-rowband-size:0;
 mso-tstyle-colband-size:0;
 mso-style-noshow:yes;
 mso-style-parent:"";
 mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
 mso-para-margin:0cm;
 mso-para-margin-bottom:.0001pt;
 mso-pagination:widow-orphan;
 font-size:10.0pt;
 font-family:Calibri;
 mso-ansi-language:#0400;
 mso-fareast-language:#0400;
 mso-bidi-language:#0400;}
</style>
<![endif]-->
 >
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.Protected">
<Description>
Базовая страница для защищенных страниц
А защищенными должны быть все страницы приложения</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62345,30872.045779</TimeCreated>

<Parameter name="RIGHTS">
<Description><![CDATA[
Дополнительные права на страницу
<example>
if '##class(Common.Rights).getrights(login,..#RIGHTS) s %response.ServerSideRedirect="norights.csp" 
</example>]]></Description>
<Type>%String</Type>
</Parameter>

<Method name="OnPreHTTP">
<Description>
Проверка прав доступа к странице</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
 s user=$G(%session.Data("user"))  
 if '+user { 
 	s %response.ServerSideRedirect="norights.csp" 
 	Q 1
 }
 
 if ..#RIGHTS'="" && ('##class(Common.Rights).getrights(user,..#RIGHTS)) {
	  s %response.ServerSideRedirect="norights.csp" 	 
 }
 Q 1
]]></Implementation>
</Method>
</Class>


<Class name="csp.repSO">
<Description>
(Rep)ort (S)torage(O)ut
отчет по отгрузке</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62421,38564.045717</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	k Args m Args=%request.Data
	s query=$d(Args("query")) ;режим ajax запроса
	if query Q ..Detail(.Args)
	s now=$zd(+$h,3)
	s d1=$g(Args("d1",1),now), d2=$g(Args("d2",1),now)
	
	&html<<html><head><title>Склад2 :: Отчет об отгрузке товаров</title>
	<meta http-equiv="Content-Language" content="ru">
  	<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
  	<link type="text/css" href="css/redmond/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
  	<style type="text/css">
  	.ui-widget {font-size:.8em;}
  	table {border-collapse:collapse;}
  	table.report {border:collapse;border:1px solid #6e6e6e;}
  	table.report th {font-weight:normal;color:#333;font-size:12px;}
  	table.report {table-layout:fixed; /*ширина столбцов определяется сразу*/}
  	table.report td,table.report th {border:1px solid #6e6e6e;font-size:12px;}
  	.c1 {width:200px;}
  	.c2 {width:250px;}
  	.c3 {width:50px;}
  	.c4 {width:70px;}
  	.c5 {width:70px;}
  	
  	td.gb {border-bottom:0px none ! important;} /*визуально объеденяем по контрагенту*/
  	td.gc {border-top:0px none ! important;border-bottom:0px none ! important;}
  	
  	.tar {text-align:right;font-size:16px;}
  	tr.detail {display:none} /*прячем строки детализации изначально*/
  	/*раскрываем*/
  	.expand {float:left;width:8px;padding:0px 2px;cursor:pointer;border:1px solid #555;color:#555;font-family:"Lucida Console"}
  	.foot {background-color:#cecece;}
  	.datepicker {width:6em;}
   </style>
	</head><body><form>
	<h2>Отчет по отгрузке товаров контрагентам</h2>
	<fieldset><legend>Параметры отчета</legend>
	<table>
	<tr><td>Период <label for="d1">с:</label></td>
		<td><input type="text" id="d1" name="d1" maxlength="10" class='datepicker' title="Начало диапазона" value="#(d1)#" />
			<label for="d2">по:</label>
			<input type="text" id="d2" name="d2" maxlength="10" class='datepicker' title="Конец диапазона" value="#(d2)#" />
		</td></tr>
	<tr><td><label for="kontr">Контрагент:</label></td>
		<td><select type="text" id="kontr" name="kontr" title="Контрагенты">>
		 d ..wKontrOptions(.Args)	
		&html<</select></td></tr>
	<!--tr><td><label for="gg">Группа(ы) товаров:</label></td>
		<td><input type="text" id="gg" name="gg" title="Группа(ы) товаров"/></td>
	</tr-->	
	</table>
	<input type="submit" id="btnRun" value="Сформировать" title="Запустить формирование отчета" />
	</fieldset>
	</form>
	<table class='report'><col class="c1"><col class="c2"><col class="c3"><col class="c4"><col class="c5">
	<thead>
	<tr><th>Контрагент</th><th>Классификатор - Группа</th>
	<th>Кол.-во,<br/>шт.</th>
	<th>Сумма<br/>по докум.</th>
	<th>Сумма<br/>закупоч.</th>
	</thead></table>
	<div id="report" style="height:400px;overflow:auto;">>
	 d ..wReport(.Args)
	&html<</div>
	<script src="js/jquery-1.6.4.min.js" type="text/javascript"></script>
	<script src="js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
	<script src="js/i18n/jquery-ui.datepicker-ru.min.js" type="text/javascript"></script>
	<script type="text/javascript">
	/*Расширяем JQuery */
	(function($){ $.fn.jqDetail = function(){
        var element = this
        //$(element).find("tr.detail").hide();
        //$(element).find("tr:first-child").show();
        $(element).find("tr.master").click(function() {
	        var $detailRow=$(this).next("tr");
	        $detailRow.toggle(); //видимость след строки
	        
	        var $expand=$(this).find(".expand"); //+-
	        var load=($expand.html()=="+");
	        (load)?$expand.html("-"):$expand.html("+");
	        if (!load) return; //
            
            //проверяем необходимость подгрузки
            var $detailTd=$(this).next("tr").children(":first-child");
            if ($detailTd.html()!="") return; //уже заполняли
            
            var query=$(this).attr("id")+","+$("#d1").val()+","+$("#d2").val(); //Контрагент, группа
            $detailTd.css("text-align","center").css("cursor","wait").html("Пожалуйста подождите, загружаю данные... ");
            
            $.ajax({
	            	url: "csp.repSO.cls",
            		data:{query:query},
  					dataType:"html",
  					context: $detailTd[0],
  					success: function(data){
    					$(this).css("text-align","left").css("cursor","default").html(data);
  					}
	        });
           	
            
        });
    }})(jQuery); 
    /**/
    $(document).ready(function(){
       	$.datepicker.setDefaults( $.datepicker.regional[ "ru" ] );
       	$(".datepicker").datepicker({ dateFormat: 'yy-mm-dd', duration: 0 });
       	$("#report").jqDetail(); //таблица - показываем детализацию
     });
	</script>
	
	</body></html>>
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="wReport">
<Description>
Запрос с группировкой по контрагенту, группе товара
контрагент, общая сумма запчастей сгруппированная по товарной группе, которой принадлежит запчасть (товар)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	#; основной запрос
	s select="SELECT "
		  _" Doc->Kontr as kontr, Doc->Kontr->Name as kontrName"
		  _",Goods"
		  _",csp.repSO_FirstGroup(Goods) as ggroup "
		  _",csp.repSO_GroupName(csp.repSO_FirstGroup(Goods)) as ggroupName "
		  _",Sum(quantreal) as gcount "
		  _",Sum(quantreal*Price) as summa "
		  _",Sum(quantreal*csp.repSO_CenaZak(Goods)) as summaZak "
	s from=" From Docs.StorageOutItems "
	s where=" Where Doc->Stat=2 "
	s group=" Group By Doc->Kontr, csp.repSO_FirstGroup(Goods) "
	s having=" Having Sum(quantreal) > 0"
	s order=" Order By Doc->Kontr->Name,csp.repSO_GroupName(csp.repSO_FirstGroup(Goods))"
	
	#;разбор параметров
	k qp s qp=0 ;query parameters
	#;Список контрагентов
	s kontr=$g(Args("kontr",1))
	if kontr'="" { 
		s count=$l(kontr,",") ;список контрагентов
		if count=1 { //один контрагент
			s where=where_" AND Doc->Kontr=?"
			s qp($i(qp))=kontr
		}
		if count>1 { //один контрагент
			s where=where_" AND (Doc->Kontr In ("_kontr_"))"
		}
	}
	#;интервал дат
	s d1=$g(Args("d1",1)), d1h=$zdh(d1,3,,,,,,,+$h), qp($i(qp))=d1h 
	s d2=$g(Args("d2",1)), d2h=$zdh(d2,3,,,,,,,+$h), qp($i(qp))=d2h 
	s where=where_" AND (Doc->Dat Between ? And ? )"
	s sql=select _ from _where _ group _ having _ order
	
	#; w sql
	s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
	s sc=rs.Prepare(sql)
	d:'sc $system.OBJ.DisplayError(sc)
	s sc=rs.Execute(
		$g(qp(1)),$g(qp(2)),$g(qp(3)),$g(qp(4))
		,$g(qp(5)),$g(qp(6)),$g(qp(7)),$g(qp(8))
		,$g(qp(9)),$g(qp(10)),$g(qp(11)),$g(qp(12))
		,$g(qp(13)),$g(qp(14)),$g(qp(15)),$g(qp(16))
	)
	d:'sc $system.OBJ.DisplayError(sc)
	
	
	w "<table class='report'><col class='c1'><col class='c2'><col class='c3'><col class='c4'><col class='c5'>"
	s last="",new=0 ;последний выведенный контрагент
	s (kcount,ksum,ksumZak)=0
	while rs.Next(){
		s kontr=$g(rs.Data("kontr")),kontrName=$g(rs.Data("kontrName"))
		s ggroup=$g(rs.Data("ggroup")), ggroupName=$g(rs.Data("ggroupName"))
		s gcount=$g(rs.Data("gcount")), goods=$g(rs.Data("Goods"))
		s summa=$g(rs.Data("summa")), summaZak=$g(rs.Data("summaZak"))
				
		if (kontr'=last) { ;новый контрагент
		  s new=1 ;флаг смены контрагента
		  if last'="" {
					w "<tr class='foot'><th></th><th>Итого</th>"
					w "<th class='tar'>",+kcount,"</th>"
					w "<th class='tar'>",+ksum,"</th>"
					w "<th class='tar'>",+ksumZak,"</th>"
					w "</tr>"
				}
			 s kcount=0,ksum=0,ksumZak=0	 ;сбрасываем данные предыдущего контрагента
			 s last=kontr ;переключаемся на нового контрагента
			
		}
		
		s kcount=kcount+gcount,ksum=ksum+summa,ksumZak=ksumZak+summaZak
		w "<tr id='",kontr,",",ggroup,"' class='master'><td"
		if new {
			w " class='gb'>" ;group begin
			w kontrName
			s new=0
		} else {
			w " class='gc'>&nbsp;"	;group continue
		}
		w "</td>"
		
		w "<td><div class='expand'>+</div>",ggroupName,"</td>"
		w "<td class='tar'>",+gcount,"</td>"
		w "<td class='tar'>",+summa,"</td>"
		w "<td class='tar'>",+summaZak,"</td>"
		w "</tr>"
		#;детализируем
		w "<tr class='detail'><td colspan='5'></td></tr>"
	} //прошли всех контрагентов
	
 if (kontr'="") { ;итого для последнего контрагента
				w "<tr class='foot'><th></th><th>Итого</th>"
				w "<th class='tar'>",+kcount,"</th>"
				w "<th class='tar'>",+ksum,"</th>"
				w "<th class='tar'>",+ksumZak,"</th>"
				w "</tr>"
	}
	w "</table>"
	d rs.Close(),rs.%Close() k rs
	
	Q ""
]]></Implementation>
</Method>

<Method name="wKontrOptions">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s kontr=$g(Args("kontr",1))
	w "<option value=''>&nbsp;&nbsp;Все контрагенты</option>"
	&sql(Declare krs Cursor For
		Select ID,Name Into :id,:name
		From Common.Kontragent
		Order By Name
	) &sql(Open krs)
	for { &sql(FETCH krs) Q:SQLCODE'=0
		w "<option value='",id,"' "
		w:id=kontr "selected='selected' "
		w ">",name,"</option>"
	} &sql(Close krs)
	Q ""
]]></Implementation>
</Method>

<Method name="FirstGroup">
<Description>
Определение группы товара по товару
Товар входит в несколько групп, надо выбрать одну
Пока берем первую</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>good:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	s group=""
	&sql(Select Groups Into :group 
		From Goods.GoodsGroup
		Where Goods=:good	
	)
	if SQLCODE=0 Q group
	Q ""
]]></Implementation>
</Method>

<Method name="GroupName">
<Description>
Имя группы по коду</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>group:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	Q:$g(group)="" "" Q:'##class(Goods.Group).%ExistsId(group) ""
	s gname=##class(Goods.Group).NameGetStored(group)
	s cat=##class(Goods.Group).CatalogueGetStored(group)
	s catName="" s:(cat'="")&&##class(Goods.Catalogue).%ExistsId(cat) catName=##class(Goods.Catalogue).NameGetStored(cat)
	Q catName_" - "_gname
]]></Implementation>
</Method>

<Method name="CenaZak">
<Description>
Закупочная цена товара, пока без даты</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>good:%String,date:%Date=""</FormalSpec>
<ReturnType>%Float</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	s price="" 
	&sql(
	 Select Top 1 Price Into :price 
	 From Store.Price 
	 Where Goods=:good And typcen=4 --используем индекс
	 Order By Dat Desc,Tim Desc --используем индекс вместо ID
	)	
	Q:SQLCODE=0 price
	Q 0
]]></Implementation>
</Method>

<Method name="Detail">
<Description>
Детализация ajax-запросом</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s query=$g(Args("query",1)) ;список через запятую контрагент, группа, дата1, дата2
	s kontr=$P(query,","), ggroup=$P(query,",",2)
	s d1=$P(query,",",3), d2=$P(query,",",4)
	#define sqldateh(%date) $zdh(%date,3,,,,,,,+$h)
	s d1=$$$sqldateh(d1), d2=$$$sqldateh(d2)
	&sql(Declare drs Cursor For
	SELECT Doc->Name,Doc->Dat
		   ,csp.repSO_GroupName(csp.repSO_FirstGroup(Goods))
		   ,Goods->Name,quantreal,csp.repSO_CenaZak(Goods)
		   ,Price
		  INTO :docname,:docdat,:group,:good,:amount,:cenaZak,:cena
	 FROM Docs.StorageOutItems 
	 WHERE Doc->Kontr=:kontr And (Doc->Dat Between :d1 And :d2) 
			 And csp.repSO_FirstGroup(Goods)=:ggroup 
	) &sql(Open drs)
	w "<table>"
	,"<thead><tr><th>Документ</th><th>Дата</th><th>Группа</th>"
	,"<th>Товар</th><th>Количество</th><th>Цена зак.</th><th>Цена</th>"
	,"<th>Сумма зак.</th><th>Сумма</th></tr></thead>"
	for { &sql(FETCH drs) Q:SQLCODE'=0
		w "<tr>"
			w "<td>",docname,"</td>"
			w "<td>",$zd(docdat,3),"</td>"
			w "<td>",group,"</td>"
			w "<td>",good,"</td>"
			w "<td class='tar'>",+amount,"</td>"
			w "<td class='tar'>",+cenaZak,"</td>"
			w "<td class='tar'>",+cena,"</td>"
			w "<td class='tar'>",amount*cenaZak,"</td>"
			w "<td class='tar'>",amount*cena,"</td>"
		w "</tr>"
	} &sql(Close drs)
	w "</table>"
	Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.ReqWar">
<Description><![CDATA[
Request - Warranty Card
Просмотр гарантийных талонов по заявке
Заявка <class>Operation.Instructions</class>  с Type=10
, содержит строки <class>Operation.InstructionsItems</class> 
c полем <var>garant</var> в котором хранится номер гарантийного талона
Задача - показывать связанные гарантиные талоны по ID заявки]]></Description>
<Super>json.service2</Super>
<TimeCreated>62582,60240.213642</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Common.Dictionary2</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default>Name as sn,serial as gn,Comment as cm,remont1 as rm,Property9194 as st</Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m rq=%request.Data  ;query arguments
  s oper=$G(rq("oper",1)), json=$d(rq("json")) 
  ;Q:oper="add" ..Add(.rq) 
  ;Q:oper="edit" ..Edit(.rq) 
  ;Q:oper="del" ..Delete(.rq)
  Q:json ..Out(.rq)  ;Просмотр записей
  d ..wUI(.rq)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="Out">
<Description><![CDATA[
Вывод первой или указанной страницы
<var>rq</var> %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s classname=..#CLASSNAME
 #; по коду Operation.Instruction
 #; отбираем Operation.InstructionItems
 s doc=$g(rq("id",1)), in="",allrows=0 
  
 #; Один раз отбираем id по гарантийные номерам из строкам документа
 #; Обнаружил, что инструкция с id=27220 содержит строки 
 #; с повторами гарантийных 
 &sql(Declare inrs Cursor For 
 	Select Distinct cd2.ID Into :gid 
 	From Operation.InstructionsItems oii Inner JOIN Common.Dictionary2 cd2
 		On oii.garant=cd2.Name
 	Where oii.Doc=:doc
 ) &sql(Open inrs)
 for { &sql(Fetch inrs) Q:SQLCODE'=0
 	s allrows=allrows+1
	s:allrows>1 in=in_","
	s in=in_"'"_gid_"'"
 } &sql(Close inrs)
 
 #; сливаем в параметры в запрос
 s rq("where")=" WHERE ID In ("_in_")"
 
 #;уже посчитали
 #;s allrows=..GetCount(.rq) ;количество строк с такими параметрами запроса
 
 s rows=+$G(rq("rows",1),100) ;вывести строк на страницу, по умолчанию 100
 s:rows<1 rows=100 ;контроль количества строк на страницу
 
 s page=+$G(rq("page",1),1) ;номер запрашиваемой страницы, по умолчанию первой
 s:page<1 page=1 ;контроль номера страницы 
 
 s pages=0 ;всего страниц данных
 s:allrows>0 pages=allrows\rows ; если есть строки 
 s:allrows#rows>0 pages=pages+1 ;непоместившиеся строки на след страницу
 s:page>pages page=pages ;нельзя вывести страницу больше чем есть

 #;диапазон выводимых строк
 s lastRow=rows*page ;последняя запись которую надо вывести с записи
 s firstRow=lastRow-rows ; начиная с записи
 
 s sql="SELECT ID FROM "_..#CLASSNAME_$g(rq("where"))_..GetOrder(.rq) 
 k qp s qp=0 m qp=rq("where","qp")
 #;w !,"sql: ",sql
 #;zw qp
 
 
 #; Переходим на универсальный интерфейс к динамическим запросам
 s sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
 if 'sc { w sc Q $$$OK  }
 s first=1 
 w "{"
 #; w """userData"":",..QuoteJS(sql),","
 w """page"":""",page,""""
 w ",""total"":""",pages,""",""records"":""",allrows,""",""rows"":["
 while rs.Next() {
   s i=$i(i) ;счетчик выведенных строк
   if i<=firstRow continue ;Не дошли до первой записи
   if i>lastRow quit  ;прошли последнюю запись
   w:'first "," s:first first=0 ;запятая перед каждым объектом кроме первого
   d ..wJson(rs.Get("ID")) ;вывод объекта 
 }
 d rs.Close() k rs
 w "]}"
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wJson">
<Description>
Свой вывод объектов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 w "{""id"":""",id,""""
 s sn=##class(Common.Dictionary2).NameGetStored(id)
 w ",""sn"":""",$$qt(sn),""""	
 s gn=##class(Common.Dictionary2).serialGetStored(id)
 w ",""gn"":""",$$qt(gn),""""	
 s cm=##class(Common.Dictionary2).CommentGetStored(id) 
 w ",""cm"":""",$$qt(cm),""""	 
 s st=##class(Common.Dictionary2).Property9194GetStored(id) 
 s stnm=##class(Common.Dictionary2).Property9194LogicalToDisplay(st) 
 w ",""st"":""",$$qt(stnm),""""	 
 w "}"
 Q $$$OK
	
qt(str)
	s qstr=..QuoteJS(str), uqstr=$e(qstr,2,$l(qstr)-1)
	Q uqstr
]]></Implementation>
</Method>

<Method name="wUI">
<Description>
Интерфейс для просмотра</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<Implementation><![CDATA[
 s iid=$g(rq("id",1)),(inm,idt)=""
 #SQLCompile Select=Display
 &sql(Select Name,InstDate Into :inm,:idt From Operation.Instructions
 	Where ID=:iid
 )
 
 &html<<!DOCTYPE html>
<html><head>
<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<script type="text/javascript">
$(function(){
	var GRID="#gg",BAR="#gb", id='#(iid)#';
	
	var fn_openTalon=function(id){
		window.showModalDialog("garant.csp?GarantId="+id
	   	,id+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;");	
	};
	
	$( GRID ).jqGrid({ //Таблица с типами  документов
	 url: ""+window.location
	 ,mtype: "POST"
	 ,datatype: "json", jsonReader : { repeatitems: false }
	 ,caption: "Гарантийные талоны заявки #(inm)# #(idt)#"
	 ,colModel: [
	  {name:'id', hidden:true}
      , {name:'sn',label:'Серийный', width:150}
      , {name:'gn',label:'Гарантийный', width:150}
      , {name:'st',label:'Актуальность', width:150}
      , {name:'cm',label:'Комментарий', width:250}
  	 ]
  	 , postData: {json:1, id: id}
  	 , pager: BAR
  	 , viewrecords:true
  	 , height: 300
  	 , width: 700 
  	 , hidegrid: false
     , gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
     , hoverrows:true ,scroll:1 
     , ondblClickRow: fn_openTalon
  	 
	})
	.jqGrid('navGrid',BAR, 
       {add:false,edit:false,del: false	,view:false,search:false}
    )
    .jqGrid('navButtonAdd',BAR,{
		caption:"Просмотр"
		, title:"Просмотр выбранного талона ( двойной клик )"
		, buttonicon:"ui-icon-document"
		, onClickButton: function(){
			var id=$( GRID ).jqGrid("getGridParam","selrow");
			if (!id) {alert("Выберите талон"); return;} 
			fn_openTalon(id);
		}
		, position: "first"
	})
    ;
	
	$( BAR +"_center").remove();
	$( BAR +"_right").css("width","30%");
	$( BAR +"_left").css("width","70%");

});


</script>
<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
<style type='text/css'>
	.ui-widget {font-size:.8em;}
	.ui-state-default {font-weight:normal}
	caption {text-align: left; }
</style>
</head><body><table id="gg"></table><div id="gb"></div></body></html>>
]]></Implementation>
</Method>
</Class>


<Class name="csp.ReqWar2">
<Description><![CDATA[
Request - Warranty Card
Просмотр гарантийных талонов по заявке
Заявка <class>Operation.Instructions</class>  с Type=10
, содержит строки <class>Operation.InstructionsItems</class> 
c полем <var>garant</var> в котором хранится номер гарантийного талона
Задача - показывать связанные гарантийные талоны по ID заявки
01.06.2012 - изменение требований
гарантийные показывать вместе с товаром
если гарантийный не найден - писать "не найден"]]></Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>json.service2</Super>
<TimeCreated>62582,60240.213642</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Operation.InstructionsItems</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Goods->FullName as gd]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m rq=%request.Data  ;query arguments
  s oper=$G(rq("oper",1)), json=$d(rq("json")) 
  #; только просмотр
  Q:json ..Out(.rq)  ;Просмотр записей
  d ..wUI(.rq)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="Out">
<Description><![CDATA[
Вывод первой или указанной страницы
<var>rq</var> %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s classname=..#CLASSNAME
 #; по коду Operation.Instruction отбираем Operation.InstructionItems
 s doc=$g(rq("id",1)), iid="",allrows=0
 
 s rq("where")=" Where Doc=? "
 s rq("where","qp")=1, rq("where","qp",1)=doc
 
 s allrows=..GetCount(.rq) ;количество строк с такими параметрами запроса
 
 s rows=+$G(rq("rows",1),100) ;вывести строк на страницу, по умолчанию 100
 s:rows<1 rows=100 ;контроль количества строк на страницу
 
 s page=+$G(rq("page",1),1) ;номер запрашиваемой страницы, по умолчанию первой
 s:page<1 page=1 ;контроль номера страницы 
 
 s pages=0 ;всего страниц данных
 s:allrows>0 pages=allrows\rows ; если есть строки 
 s:allrows#rows>0 pages=pages+1 ;непоместившиеся строки на след страницу
 s:page>pages page=pages ;нельзя вывести страницу больше чем есть

 #;диапазон выводимых строк
 s lastRow=rows*page ;последняя запись которую надо вывести с записи
 s firstRow=lastRow-rows ; начиная с записи
 
 s sql="SELECT ID FROM Operation.InstructionsItems "_$g(rq("where"))_..GetOrder(.rq) 
 k qp s qp=0 m qp=rq("where","qp")
 
 
 #; Переходим на универсальный интерфейс к динамическим запросам
 s sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
 if 'sc { w sc Q $$$OK  }
 s first=1 
 w "{"
 #; w """userData"":",..QuoteJS(sql),","
 w """page"":""",page,""""
 w ",""total"":""",pages,""",""records"":""",allrows,""",""rows"":["
 while rs.Next() {
   s i=$i(i) ;счетчик выведенных строк
   if i<=firstRow continue ;Не дошли до первой записи
   if i>lastRow quit  ;прошли последнюю запись
   w:'first "," s:first first=0 ;запятая перед каждым объектом кроме первого
   i $i(CountLines)			
   d ..wJson(rs.Get("ID"),.Serials,CountLines) ;вывод объекта 
 }
 d rs.Close() k rs
 w "]}"
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wJson">
<Description>
вывод строк инструкции</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String,Serials,Countlines</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s $ZT="wJsonErr"
 #define qt(%str) """"_$zconvert($tr(%str,"'"," "),"O","JS")_""""
 
 w "{""id"":",$$$qt(id) ;код инструкции
 
 s good=##class(Operation.InstructionsItems).GoodsGetStored(id) 
 s gd=##class(Goods.Goods).GetFullName(good)
	w ",""gd"":",$$$qt(gd)
  
 
 s gid=##class(Operation.InstructionsItems).snGetStored(id)

 &sql(select ID into :gid from Common.Dictionary2 where serial=:gid)
 if 'SQLCODE,##class(Common.Dictionary2).%ExistsId(gid) {
	 		
	 		 w ",""gid"":",$$$qt(gid)
			 s sn=##class(Common.Dictionary2).NameGetStored(gid)
			 w ",""sn"":",$$$qt(sn)
			 if $$$qt(sn)="" s sn="0"
			 
			 
			 s gn=##class(Common.Dictionary2).serialGetStored(gid)
			 w ",""gn"":",$$$qt(gn)
			 s cm=##class(Common.Dictionary2).CommentGetStored(gid) 
			 w ",""cm"":",$$$qt(cm)
			 s st=##class(Common.Dictionary2).Property9194GetStored(gid) 
			 s stnm=##class(Common.Dictionary2).Property9194LogicalToDisplay(st) 
			 w ",""st"":",$$$qt(stnm)
			 s remont1=##class(Common.Dictionary2).remont1GetStored(gid)
			 s hr=$S(remont1="":"нет",1:"есть")
			 w ",""hr"":",$$$qt(hr)
			 
			 s tovar=##class(Common.Dictionary2).tovarGetStored(gid)
			 w ",""t"":",$$$qt(tovar)
			 w ",""co"":",$$$qt($G(Serials(sn)))
			 
			 if '$D(Serials(sn)) s Serials(sn)=Countlines
	} else {
			 w ",""sn"":""НЕ НАЙДЕН"""
			 w ",""gn"":""НЕ НАЙДЕН"""
			 w ",""cm"":"""""
			 w ",""st"":"""""
	}
 
 w "}"
 Q $$$OK
wJsonErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="wUI">
<Description>
Интерфейс для просмотра</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<Implementation><![CDATA[
 s iid=$g(rq("id",1)),(inm,idt)=""
 #SQLCompile Select=Display
 &sql(Select Name,InstDate Into :inm,:idt From Operation.Instructions
 	Where ID=:iid
 )
 
 #define qt(%str) "'"_$zconvert(%str,"O","JS")_"'"
 s inm=$$$qt(inm)
 
 
 &html<<!DOCTYPE html>
<html><head>
<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>

<script type="text/javascript">
$(function(){
	var GRID="#gg",BAR="#gb", id='#(iid)#';
	
	var fn_openTalon=function(id){
		var row=$(GRID).jqGrid("getRowData",id), gid=row.gid; if (!gid) return;
		window.showModalDialog("garant.csp?GarantId="+gid
	   	,gid+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;");	
	};
	
	$( GRID ).jqGrid({ //Таблица с типами  документов
	 url: ""+window.location
	 ,mtype: "POST"
	 ,datatype: "json", jsonReader : { repeatitems: false }
	 ,caption: "Гарантийные талоны заявки #(inm)# #(idt)#"
	 ,colModel: [
	  {name:'id', hidden:true}
	  , {name:'gid',label:'Код гарантийного', hidden: true, width:200}
	  , {name:'gd',label:'Товар', width:200}
      , {name:'t',label:'Модель', width:60}
      , {name:'sn',label:'Серийный', width:150}
      , {name:'gn',label:'Гарантийный', width:150}
      , {name:'st',label:'Актуальность', width:130}
      , {name:'hr',label:'Заявки', width:60}
      , {name:'cm',label:'Комментарий', width:360}
      , {name:'co',label:' ', width:20}
  	 ]
  	 , postData: {json:1, id: id}
  	 , pager: BAR
  	 , viewrecords:true
  	 , height: 500
  	 , width: 960 
  	 , hidegrid: false
     , gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
     , hoverrows:true ,scroll:1 
     , ondblClickRow: fn_openTalon
  	 
	})
	.jqGrid('navGrid',BAR, 
       {add:false,edit:false,del: false	,view:false,search:false}
    )
    .jqGrid('navButtonAdd',BAR,{
		caption:"Просмотр"
		, title:"Просмотр выбранного талона ( двойной клик )"
		, buttonicon:"ui-icon-document"
		, onClickButton: function(){
			var id=$( GRID ).jqGrid("getGridParam","selrow");
			if (!id) {alert("Выберите талон"); return;} 
			fn_openTalon(id);
		}
		, position: "first"
	})
    ;
	
	$( BAR +"_center").remove();
	$( BAR +"_right").css("width","30%");
	$( BAR +"_left").css("width","70%");

});
</script>
<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
<style type='text/css'>
	.ui-widget {font-size:.8em;}
	.ui-state-default {font-weight:normal}
	caption {text-align: left; }
</style>
</head><body><table id="gg"></table><div id="gb"></div></body></html>>
]]></Implementation>
</Method>
</Class>


<Class name="csp.screen.chet2">
<Description>
Новая форма счета ( сентябрь 2013 )
Счёт можно распечатать из раздела Документы,
нужно выбрать тип документа "Расходная накладная", 
выбрать документ и нажать первую из трёх кнопок на которых папка с карандашиком. 
Откроется окно "формирование счёта на оплату". </Description>
<Super>%CSP.Page,csp.screen.chetapi</Super>
<TimeCreated>63069,74899.471839</TimeCreated>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 
 /*
 s %response.ContentType = "application/vnd.ms-excel"
 d %response.SetHeader("Content-Disposition","attachment; filename=schet.xls")
 s %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 */
 
 q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Вывод страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
 if $g(%request)'="" m args=%request.Data
    
 #;Поставщик и Получатель (Продавец)
 s kid = $g(args("kontr",1))
 k seller d ..KontrLoad( kid, .seller )
 #define seller(%prop) $g(seller(%prop))
 
 #; Заказчик и плательщик (Покупатель)
 s kid2 = $g(args("kontr2",1)) 
 k buyer d ..KontrLoad( kid2, .buyer )
 #define buyer(%prop) $g(buyer(%prop))
 
 #; Документ - Расходная накладная
 s docid=$g(args("id",1))
 k doc ;d ..DocLoad( docid, .doc )
 s doc("num")= $g(args("cv1",1))
 s date = $g(args("DocDate",1)), monthNum=+$P(date,"/",2)
 #; надо вынести в inc
 #define month( %num ) $CASE(%num,1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря",:"")
 s month = $$$month( monthNum )
 s $P(date,"/",2) = month, date = $tr(date,"/"," ") 
 s doc( "date" ) = date
 #define doc(%prop) $g(doc(%prop))
 
 #;Опции НДС
 s incNDS = $g(args("NDSinside",1)), incNDS=$CASE(incNDS,"true":1,:0)
 
 #;Пересчет в рубли
 s inRub = $g(args("CalculateInRubles",1))
 
    
 &html<<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
#(..wCss())#

<body>
<div id="chet_10184" align=center x:publishsource="Excel">

<table border=0 cellpadding=0 cellspacing=0 width=646 style='border-collapse: collapse;table-layout:fixed;width:490pt'>
 <col class=xl6310184 width=7 style='mso-width-source:userset;mso-width-alt: 298;width:5pt'>
 <col class=xl6310184 width=21 style='mso-width-source:userset;mso-width-alt: 896;width:16pt'>
 <col class=xl6310184 width=11 style='mso-width-source:userset;mso-width-alt: 469;width:8pt'>
 <col class=xl6310184 width=9 style='mso-width-source:userset;mso-width-alt: 384;width:7pt'>
 <col class=xl6310184 width=21 span=11 style='mso-width-source:userset; mso-width-alt:896;width:16pt'>
 <col class=xl6310184 width=16 style='mso-width-source:userset;mso-width-alt: 682;width:12pt'>
 <col class=xl6310184 width=15 style='mso-width-source:userset;mso-width-alt: 640;width:11pt'>
 <col class=xl6310184 width=16 span=2 style='mso-width-source:userset; mso-width-alt:682;width:12pt'>
 <col class=xl6310184 width=21 style='mso-width-source:userset;mso-width-alt: 896;width:16pt'>
 <col class=xl6310184 width=2 style='mso-width-source:userset;mso-width-alt: 85;width:2pt'>
 <col class=xl6310184 width=19 style='mso-width-source:userset;mso-width-alt: 810;width:14pt'>
 <col class=xl6310184 width=21 style='mso-width-source:userset;mso-width-alt: 896;width:16pt'>
 <col class=xl6310184 width=14 style='mso-width-source:userset;mso-width-alt: 597;width:11pt'>
 <col class=xl6310184 width=7 style='mso-width-source:userset;mso-width-alt: 298;width:5pt'>
 <col class=xl6310184 width=21 style='mso-width-source:userset;mso-width-alt: 896;width:16pt'>
 <col class=xl6310184 width=14 style='mso-width-source:userset;mso-width-alt: 597;width:11pt'>
 <col class=xl6310184 width=7 style='mso-width-source:userset;mso-width-alt: 298;width:5pt'>
 <col class=xl6310184 width=21 span=3 style='mso-width-source:userset; mso-width-alt:896;width:16pt'>
 <col class=xl6310184 width=16 style='mso-width-source:userset;mso-width-alt: 682;width:12pt'>
 <col class=xl6310184 width=4 style='mso-width-source:userset;mso-width-alt: 170;width:3pt'>
 <col class=xl6310184 width=21 span=4 style='mso-width-source:userset; mso-width-alt:896;width:16pt'>
 <col class=xl6310184 width=11 style='mso-width-source:userset;mso-width-alt: 469;width:8pt'>
 <tr class=xl6310184 height=15 style='mso-height-source:userset;height:11.25pt'>
 <td height=15 class=xl6310184 width=7 style='height:11.25pt;width:5pt'></td>
 <td colspan=37 rowspan=3 class=xl7010184 width=639 style='width:485pt'>
  Внимание!
  Оплата данного счета означает согласие с условиями поставки товара.
  Уведомление об оплате <br>
  обязательно, в противном случае не
  гарантируется наличие товара на складе. Товар отпускается по факту<br>
  прихода денег на р/с Поставщика.
 </td>
 </tr>
 <tr class=xl6310184 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td> </tr>
 
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td colspan=19 rowspan=2 class=xl7110184 width=356 style='width:270pt'>
  #( $$$seller("bankname") )# 
  #( $$$seller("bankcity") )#
  </td>
  <td colspan=5 class=xl7210184 style='border-left:none'>БИК</td>
  <td colspan=13 class=xl7310184 style='border-left:none'>
  #( $$$seller("bik") )#
  </td>
 </tr>
 
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td colspan=5 rowspan=2 class=xl7410184>Сч. №</td>
  <td colspan=13 rowspan=2 class=xl7510184>
    #( $$$seller("ksch") )#
  </td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td colspan=19 class=xl7610184>Банк получателя</td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td colspan=3 class=xl7910184>ИНН</td>
  <td colspan=7 class=xl8010184>
    #( $$$seller("inn") )#
  </td>
  <td colspan=2 class=xl7910184 style='border-left:none'>КПП</td>
  <td colspan=7 class=xl8110184>0</td>
  <td colspan=5 rowspan=4 class=xl7410184>Сч. №</td>
  <td colspan=13 rowspan=4 class=xl7410184>
    #( $$$seller("rsch") )#
  </td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td colspan=19 rowspan=2 class=xl7710184 width=356 style='width:270pt'>
  #( $$$seller("name") )#
  </td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td colspan=19 class=xl7810184>Получатель</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
<td height=15 class=xl6310184 style='height:11.25pt'></td>
<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
</tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td colspan=37 rowspan=2 class=xl8410184>Счет на оплату № #( $$$doc("num") )# от #( $$$doc("date") )# г.</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
 </tr>
 <tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
  <td colspan=37 class=xl6410184>&nbsp;</td>
 </tr>
 <tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td> </tr>
 <tr height=33 style='mso-height-source:userset;height:25.35pt'>
  <td height=33 class=xl1510184 style='height:25.35pt'></td>
  <td colspan=5 class=xl8510184>Поставщик:</td>
  <td colspan=32 class=xl8610184 width=556 style='width:422pt'>
  #( $$$seller("name"))#, ИНН #( $$$seller("inn") )#, #( $$$seller("postalcodeur") )#, #( $$$seller("cityur") )#, #( $$$seller("addressur") )#</td>
 </tr>
 <tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
 </tr>
 
 <tr height=33 style='mso-height-source:userset;height:25.35pt'>
  <td height=33 class=xl1510184 style='height:25.35pt'></td>
  <td colspan=5 class=xl8510184>Покупатель:</td>
  <td colspan=32 class=xl8610184 width=556 style='width:422pt'>
  #( $$$buyer("name") )#, ИНН #( $$$buyer("inn") )#, КПП #( $$$buyer("kpp") )#, #( $$$buyer("cityur") )#, #( $$$buyer("addressur") )#</td>
 </tr>
 
 <tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
 </tr>
 
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td colspan=2 class=xl9110184>№</td>
  <td colspan=18 class=xl8210184>Товары (работы, услуги)</td>
  <td colspan=3 class=xl8210184>Кол-во</td>
  <td colspan=3 class=xl8210184>Ед.</td>
  <td colspan=5 class=xl8210184>Цена</td>
  <td colspan=6 class=xl8310184>Сумма</td>
 </tr>>
 
 #; ******************************
 #; Вывод строк  
 k total               
 d ..wRows( docid, .total, incNDS )         
 #define total(%name) $g(total(%name))
 
 #; ******************************
 
 &html<<tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
  <td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td><td class=xl6510184>&nbsp;</td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  
  
  <td colspan=5 class=xl6610184>Итого:</td>
  <td colspan=6 class=xl9610184>#( $$$total("summa") )#</td>
 </tr>
 <tr class=xl1510184 height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  
  <td colspan="6" class=xl6710184 style='border:solid 1px #000'>Без налога НДС</td>
  <td colspan="5"></td>
  <td class=xl6610184>-</td>
  
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  
  
  <td colspan=6 class=xl6610184>Всего к оплате:</td>
  <td colspan=6 class=xl9610184>#( $$$total("summa") )#</td>
  
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td colspan=37 class=xl9410184>Всего наименований #( $$$total("count") )#, на сумму #( $$$total("summa") )# руб.</td>
 </tr>
 <tr height=22 style='mso-height-source:userset;height:16.5pt'>
  <td height=22 class=xl1510184 style='height:16.5pt'></td>
  <td colspan=36 class=xl8610184 width=628 style='width:477pt'>
  #( ##class(Utils.Propis).Write( $$$total("summa") ) )# (<font class="font610184">НДС не облагается</font>)*
  </td>
  <td class=xl1510184></td>
 </tr>
 <tr class=xl6310184 height=9 style='mso-height-source:userset;height:6.95pt'>
  <td height=9 class=xl6310184 style='height:6.95pt'></td>
  <td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td><td class=xl6410184>&nbsp;</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
 </tr>
 <tr class=xl1510184 height=16 style='height:12.0pt'>
  <td height=16 class=xl6310184 style='height:12.0pt'></td>
  <td class=xl6810184 colspan=7>Предприниматель</td>
  <td class=xl6910184>&nbsp;</td>
  <td class=xl6910184>&nbsp;</td>
  <td class=xl6910184>&nbsp;</td>
  <td colspan=9 class=xl6910184>&nbsp;</td>
  <td colspan=18 class=xl9510184>#( $$$seller("shortname") )#</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl6310184 style='height:11.25pt'></td>
  <td class=xl6310184 colspan=16>* Применяется упрощенная система налогообложения</td>
<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
 </tr>
 
 <tr height=0 style='display:none'>
  <td width=7 style='width:5pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=11 style='width:8pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=16 style='width:12pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=16 style='width:12pt'></td>
  <td width=16 style='width:12pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=2 style='width:2pt'></td>
  <td width=19 style='width:14pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=14 style='width:11pt'></td>
  <td width=7 style='width:5pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=14 style='width:11pt'></td>
  <td width=7 style='width:5pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=16 style='width:12pt'></td>
  <td width=4 style='width:3pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=21 style='width:16pt'></td>
  <td width=11 style='width:8pt'></td>
 </tr>
</table>

</div>
</body>
</html>
    
    >
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
Связанная таблица стилей</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    &html<<style type="text/css">
    <!--table
    {mso-displayed-decimal-separator:"\,";
    mso-displayed-thousand-separator:" ";}
.font510184
    {color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;}
.font610184
    {color:windowtext;
    font-size:11.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;}
.font710184
    {color:windowtext;
    font-size:12.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;}
.xl1510184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6310184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6410184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    border-top:none;
    border-right:none;
    border-bottom:1.0pt solid windowtext;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6510184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6610184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:right;
    vertical-align:top;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6710184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:right;
    vertical-align:top;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6810184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl6910184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7010184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:center;
    vertical-align:middle;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:normal;}
.xl7110184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:normal;}
.xl7210184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:middle;
    border:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7310184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:000000000;
    text-align:left;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7410184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7510184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7610184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7710184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:normal;}
.xl7810184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:middle;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl7910184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8010184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0;
    text-align:left;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8110184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8210184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8310184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8410184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:14.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:middle;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8510184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8610184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:normal;}
.xl8710184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:1.0pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl8810184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:normal;}
.xl8910184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9010184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9110184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:1.0pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9210184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9310184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:.5pt solid windowtext;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9410184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:General;
    text-align:left;
    vertical-align:bottom;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9510184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:right;
    vertical-align:bottom;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
.xl9610184
    {padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:9.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    mso-background-source:auto;
    mso-pattern:auto;
    white-space:nowrap;}
-->
    
    </style>>
    Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.screen.chetapi">
<Description>
Повторяющиеся блоки кода при составления счета</Description>
<Abstract>1</Abstract>
<TimeCreated>63070,6845.006093</TimeCreated>

<Method name="KontrLoad">
<Description>
"Безопасная" загрузка свойств контрагента в массив ключ-значение</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>kid:%String,*props:%String=""</FormalSpec>
<Implementation><![CDATA[

 s kontr=##class(Common.Kontragent).%OpenId(kid,,.sc) Q:'sc 
 Q:'$Isobject(kontr)
 s props("name")= kontr.Name
 s props("shortname") = kontr.Pseudonym
 s props("adress") = kontr.Address
 s bank = kontr.bank Q:'$IsObject(bank)
 s props("bankname") = bank.pbank
 s props("bankcity") = bank.city
 s props("kpp") = bank.kpp
 s props("inn") = bank.inn
 s props("bik") = bank.bik
 s props("rsch") = bank.rsch
 s props("ksch") = bank.ksch
 s props("code") = bank.code
 s props("okpo") = bank.okpo
 s props("postalcodeur") = kontr.PostalcodeUr
 s props("cityur") = kontr.CityUr
 s props("addressur") = kontr.AddressUr
 
 k bank, kontr
]]></Implementation>
</Method>

<Method name="GetData">
<Description>
Собираем данные из запроса</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 #define g(%name) $g(args(%name))

 
 s docid=$$$g("id")
 s DocDate=$$$g("DocDate")
 s docname="Платежное поручение"
 s NDSinside=$$$g("NDSinside")
 s CalculateInRubles=$$$g("CalculateInRubles")
 
 i NDSinside="true" s NdsDescription="НДС включен в цену товара"
 i NDSinside="false" s NdsDescription="НДС не включен в цену товара"
]]></Implementation>
</Method>

<Method name="wRows">
<Description><![CDATA[
Выводит строки и подсчитывает итого
<var>kurs</var> - курс рубля к доллару
<var>total</var> - итого (массив) по строкам
<var>incNDS</var> - включать ндс в стоимость ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>docid:%String,*total:%String="",incnds:%Boolean=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
 s (summaotnds,summabeznds,price,NdsDescription)=""
  
 s doc = ##class(Docs.Rash).%OpenId( docid ) Q:'$ISOBJECT(doc.Items) ""
 
 #; всегда пересчитываем в рубли
 #; взял из screen/chet.csp
 s kurs=doc.kurs if '+kurs s kurs=doc.RubSumma/doc.Summa
 s waste=##class(Goods.GoodsAction).kurs(.other) 
 s:'+$G(kurs) kurs=waste
 
 s knds=+$G(other("nds"))/100 ;например, 0.18
 
 s totsum=0, totquant=0, count=0
 s i="" for { s item=doc.Items.GetNext(.i) q:i=""  
 
    s goods="" s:$IsObject(item.Goods) goods=item.Goods.FullName
    s quant=item.Quantity if quant=0 continue  ;ПРОПУСКАЕМ строки с нулевым количеством
    
    s price = $j( item.Price * kurs, ".", 2 ) ;всегда переводим в рубли
    
    k ctx 
    s ctx("price")=price, ctx("count")=quant, ctx("knds")=knds, ctx("incnds")=incnds
    , sum = ..getSum( .ctx ) ; сумма с единообразным округлением
    //s price = $g(ctx("price")) ;при вычислении суммы могли включить ндс в стоимость
    
    s count = count + 1 ;порядковый номер строки
    , totsum = totsum + sum ;итоговая сумма
    , totquant = totquant + quant ;итоговое количество
    
    k row 
    s row("count")=count, row("goods")=goods
    , row("quant")=quant, row("price")=price
    , row("sum")=sum
    
    d ..wRow(.row)

 }
 s total("summa")=totsum
 s total("count")=count
 s total("amount")=totquant
  
  Q ""
]]></Implementation>
</Method>

<Method name="getSum">
<Description><![CDATA[
Нельзя просто так взять и рассчитать сумму по товарной строке
( количество умножить на цену - частный случай рассчета суммы без НДС ). 
При расчете с НДС начинаются расхождения из-за округлений
Для введения единообразного расчета используем этот метод 
За основу взят кусок кода из csp.screen.torg12v2:wRows
<var>context("price")</var> - цена товара в рублях, копейках 
<var>context("count")</var> - количество товара
ВАЖНО!!! <var>context("knds")</var> в формате .21, не как процент!!!
<var>context("incnds")</var> Boolean Включить nds в цену товара?]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&context:%String=""]]></FormalSpec>
<ReturnType>%Currency</ReturnType>
<Implementation><![CDATA[
   /// извлечение из контекста 
   #define g(%name) s %name=+$g(context("%name"))
   $$$g(price) $$$g(count) $$$g(knds) $$$g(incnds)
   
   s antinds = 1 / ( 1 + knds ) ;избегаем деления на ноль
   
   i incnds { ;включить ндс в стоимость товара
        s price=$J( price * antinds, ".", 2 ) ;стоимость единицы товара без ндс
        s summabeznds = $J( count * price, ".", 2 ) 
        s ndsotsumma = $J( summabeznds * knds, ".", 2 ) ;
        s summasnds = summabeznds + ndsotsumma
   } else { 
        s summabeznds=$J( count * price, ".", 2 ) ;округление
        s ndsotsumma=$J( summabeznds - (summabeznds * antinds), ".", 2 ) 
        s summasnds=$J( summabeznds + ndsotsumma, ".", 2 ) 
   }
   
   #; сохраняем изменненные и рассчитанные значения
   #define s(%name) s context("%name")=%name
   $$$s(antinds) $$$s(price) $$$s(summabeznds) $$$s(ndsotsumma) $$$s(summasnds)
   
   Q summasnds ;для удобства
]]></Implementation>
</Method>

<Method name="wRow">
<Description>
Вывод товарной строки</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&row:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[

 #define row(%name) $g(row(%name))

 &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl1510184 style='height:11.85pt'></td>
  <td colspan=2 class=xl8710184>#( $$$row("count") )#</td>
  <td colspan=18 class=xl8810184 width=326 style='width:248pt'>
  #( $zcvt( $$$row("goods"), "O", "HTML" ) )#
  </td>
  <td colspan=3 class=xl8910184>#( $$$row("quant") )#</td>
  <td colspan=3 class=xl9010184>шт</td>
  <td colspan=5 class=xl9210184>#( $$$row("price") )#</td>
  <td colspan=6 class=xl9310184>#( $$$row("sum") )#</td>
 </tr>>
 
  #; debug
  #;&html<<tr><td colspan=37><pre>>
  #;  zw row
  #;&html<</pre></td></tr>>
 
 Q ""
]]></Implementation>
</Method>

<Method name="GetStoredProperty">
<Description>
Вернет значение хранимого свойства хранимого класса для ид</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class:%String="",prop:%String="",id:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 Q:$g(class)="" "" Q:$g(prop)="" "" Q:$g(id)="" "" 
 s $zt="onGSPError"
 s val = $zobjclassmethod(class, prop_"GetStored", id)
 Q val     
 
onGSPError
    s $zt="", $ze=""
    Q ""
]]></Implementation>
</Method>

<Method name="GetObjectProperty">
<Description>
Разбирает цепочечный синтаксис и получает значение свойства</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj:%ObjectHandle,property:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $zt="onGOPError" 
 s val=obj
 for i=1:1:$l(property,".") {
    s val = $zobjproperty(val, $p(property,".",i))
 }
 Q val

onGOPError
   s $zt="", $ze=""
   Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.screen.torg12v2">
<Description>
Измененная сsp/screen/torg12:
Выставляется нулевая цена для товаров по гарантии 
ПРОМЕЖУТОЧНЫЙ ВАРИАНТ НАКЛАДНОЙ
НЕ УДАЛЯТЬ - используется как основа для csp.screen.torg12v3</Description>
<Super>%CSP.Page</Super>
<TimeCreated>63075,60506.96248</TimeCreated>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
    
    s login=$G(%session.Data("user"))
    //i '+login s %response.ServerSideRedirect="norights.csp" 
    
    s OpenWith = $g(args("OpenWith",1))   //чем открыть этот файл
    if OpenWith="" { //альтернативный вариант передачи типа вывода
        s:$d(%request.Data("excel")) OpenWith="excel" 
        s:$d(%request.Data("word")) OpenWith="word" 
    }
    
    s allowformats = $lb("word","excel")
    if $lf(allowformats , OpenWith ) {
        
        #; excel for default
        s contentType = "application/vnd.ms-excel", attachment="torg12.xls"
        
        if OpenWith="word" {
            s contentType = "application/msword", attachment="word.doc"
        }
    
        s %response.ContentType = contentType
        d %response.SetHeader("Content-Disposition","attachment; filename="""_attachment_"""")
        s %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
     
    }
    
 Q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Вывод страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
 #; Разбираем аргументы
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2"), kontr=%request.Get("kontr")
 s kontr3=%request.Get("kontr3"), kontr4=%request.Get("kontr4")
 s docid=%request.Get("id"), docname="Платежное поручение"
 , DocDate=%request.Get("DocDate")
 
 s nomnakl=%request.Get("nomernakladnoy")
 s NDSinside=%request.Get("NDSinside")
 
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$TR(docdate,"/",".")
 . s kurs=doc.kurs
 . if '+kurs,+doc.Summa s kurs=doc.RubSumma/doc.Summa
 
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s kname1=k.Name
 . s Address1=k.AddressUr
 . s bank1=k.bank
 . s codecity1=k.CityCode
 . s namecity1=k.CityUr
 . s Postalcode1=k.PostalcodeUr
 . d:$ISOBJECT(bank1)
 . . s pbank1=bank1.pbank
 . . s city1=bank1.city
 . . s kpp1=bank1.kpp
 . . s inn1=bank1.inn
 . . s bik1=bank1.bik
 . . s rsch1=bank1.rsch
 . . s ksch1=bank1.ksch
 . . s code1=bank1.code
 . . s okpo1=bank1.okpo
 . . s okud1=bank1.okud
 . . s okpo1=bank1.okpo
 . . s okdp1=bank1.okdp
 
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s kname2=k.Name
 . s Address2=k.AddressUr
 . s bank2=k.bank
 . s codecity2=k.CityCode
 . s namecity2=k.CityUr
 . s contract = k.Agree
 . s Postalcode2=k.PostalcodeUr
 . d:$ISOBJECT(bank2)
 . . s pbank2=bank2.pbank
 . . s city2=bank2.city
 . . s kpp2=bank2.kpp
 . . s inn2=bank2.inn
 . . s bik2=bank2.bik
 . . s rsch2=bank2.rsch
 . . s ksch2=bank2.ksch
 . . s code2=bank2.code
 . . s okpo2=bank2.okpo
 . . s okpo2=bank2.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr3)
 d:$ISOBJECT(k)
 . s kname3=k.Name
 . s Address3=k.AddressUr
 . s bank3=k.bank
 . s chief=k.chief
 . s buh=k.glavbuh
 . s codecity3=k.CityCode
 . s namecity3=k.CityUr
 . s Postalcode3=k.PostalcodeUr
 . d:$ISOBJECT(bank3)
 . . s pbank3=bank3.pbank
 . . s city3=bank3.city
 . . s kpp3=bank3.kpp
 . . s inn3=bank3.inn
 . . s bik3=bank3.bik
 . . s rsch3=bank3.rsch
 . . s ksch3=bank3.ksch
 . . s code3=bank3.code
 . . s okpo3=bank3.okpo
 . . s okpo3=bank3.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr4)
 d:$ISOBJECT(k)
 . s kname4=k.Name
 . s Address4=k.AddressUr
 . s bank4=k.bank
 . s codecity4=k.CityCode
 . s namecity4=k.CityUr
 . s Postalcode4=k.PostalcodeUr
 . d:$ISOBJECT(bank4)
 . . s pbank4=bank4.pbank
 . . s city4=bank4.city
 . . s kpp4=bank4.kpp
 . . s inn4=bank4.inn
 . . s bik4=bank4.bik
 . . s rsch4=bank4.rsch
 . . s ksch4=bank4.ksch
 . . s code4=bank4.code
 . . s okpo4=bank4.okpo
 . . s okpo4=bank4.okpo
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 s antinds=1
 &html<<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 11">
<title>Товарная накладная #(nomnakl)#</title>

<style>
#(..wCss())#
</style>
<!--[if gte mso 9]><xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
   <x:Name>torg12</x:Name>
    <x:WorksheetOptions>
     <x:Print>
      <x:ValidPrinterInfo/>
      <x:PaperSizeIndex>9</x:PaperSizeIndex>
     </x:Print>
     <x:DoNotDisplayGridlines/>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
 </x:ExcelWorkbook>
</xml><![endif]-->
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=1066 style='border-collapse:collapse;table-layout:fixed;width:804pt'>>

 d ..wCols() ;выводит колонки  (cols) таблицы
 
 &html<<tr height=22 style='mso-height-source:userset;height:17.1pt'>
  <td colspan=38 height=22 class=xl96 width=1062 style='height:17.1pt;width:801pt'>Унифицированная форма № ТОРГ-12<br>
    Утверждена постановлением Госкомстата России от 25.12.98 № 132</td>
  <td class=xl24 width=1 style='width:1pt'></td>
  <td class=xl24 width=3 style='width:2pt'></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 colspan=35 class=xl24 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl25 style='mso-ignore:colspan'></td>
  <td class=xl26>Коды</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=28 rowspan=2 class=xl125 width=818 style='width:617pt'>#($G(kname1))#, ИНН #($G(inn1))#, КПП #($G(kpp1))#, 
    #($G(Postalcode1))#, #($G(namecity1))#, #($G(Address1))#, Р/C #($G(rsch1))#, 
    #($G(pbank1))#, #($G(city1))#; БИК #($G(bik1))#, К/С #($G(ksch1))#</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl116 style='border-right:1.0pt solid black'>Форма по ОКУД</td>
  <td class=xl27 style='border-left:none'>#($G(okud1))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl30 style='border-left:none' >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>организация-грузоотправитель,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl32 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl97>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=33 class=xl98>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=19 style='mso-height-source:userset;height:14.65pt'>
  <td height=19 colspan=3 class=xl24 style='height:14.65pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>структурное
  подразделение</td>
  <td colspan=8 class=xl118 style='border-right:1.0pt solid black'>Вид
  деятельности по ОКДП</td>
  <td class=xl33 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td colspan=2 class=xl99 width=108 style='width:82pt'>Грузополучатель</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname2))#,  ИНН #($G(inn2))#, КПП #($G(kpp2))#,
    #($G(Postalcode2))#, #($G(namecity2))#,&nbsp; #($G(Address2))#, P/C #($G(rsch2))#, 
    #($G(pbank2))#, #($G(city2))#; БИК #($G(bik2))#, K/C #($G(ksch2))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl34 style='border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация, адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl30 >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Поставщик</td>
  <td colspan=31 class=xl125 width=806 style='width:608pt'>#($G(kname3))#,  ИНН #($G(inn3))#, КПП #($G(kpp3))#,
    #($G(Postalcode3))#, 
    #($G(namecity3))#,&nbsp; #($G(Address3))#, P/C #($G(rsch3))#, #($G(pbank3))#, 
    #($G(city3))#; БИК #($G(bik3))#, K/C #($G(ksch3))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Плательщик</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname4))#,  ИНН #($G(inn4))#, КПП #($G(kpp4))#,
    #($G(Postalcode4))#, 
    #($G(namecity4))#,&nbsp; #($G(Address4))#, P/C #($G(rsch4))#, #($G(pbank2))#, 
    #($G(city4))#; БИК #($G(bik4))#, К/С #($G(ksch4))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 rowspan=2 class=xl101>номер</td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl29></td>
  <td class=xl29>Основание</td>
  <td colspan=31 class=xl126><!--Счет № *** от **.**.**** г.-->Счёт № #(nomnakl)#</td>
  <td class=xl24></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>договор, заказ-наряд</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=10 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=4 class=xl102>Номер документа</td>
  <td colspan=4 class=xl102 style='border-left:none'>Дата составления</td>
  <td colspan=7 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=9 class=xl118>Транспортная накладная</td>
  <td class=xl24></td>
  <td colspan=2 class=xl101>номер</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
 
 &html<<tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl38></td>
  <td colspan=6 class=xl115 style='border-right:1.0pt solid black'>ТОВАРНАЯ НАКЛАДНАЯ<span style='mso-spacerun:yes'>  </span></td>
  <td colspan=4 class=xl103 style='border-left:none'>#(nomnakl)#</td>
  <td colspan=4 class=xl104 style='border-left:none'>#($G(docdate))#</td>
  <td colspan=17 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=35 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl29></td>
  <td class=xl29>Вид операции</td>
  <td class=xl39>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
 
 d ..wPageNumber()
  
 d ..wTablePageHeader()
 
 k summary 
 
 d ..wRows( doc, NDSinside, nds, antinds, kurs, .summary )
 
 d ..wSummary( .summary )  
  
 d ..wFooter(.summary) ;разбито из-за ограничений в 32к на размер программы

 &html<</table></body></html>>
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="wPageNumber">
<Description><![CDATA[
Выводит номер страницы
<var>page</var> - номер страницы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>page=1</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
    &html<<tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt;page-break-before:always;'>
  <td height=15 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl41 style='mso-ignore:colspan'></td>
  <td class=xl41>Страница #(page)#</td>
  <td class=xl40></td>
 </tr>>
]]></Implementation>
</Method>

<Method name="wTablePageHeader">
<Description>
Выводит заголовок таблицы с товарными строками на каждой странице</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
     &html<<tr class=xl40 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl42 style='height:11.1pt'>&nbsp;</td>
  <td rowspan=2 class=xl43 width=34 style='width:26pt'>Но-<br>мер<br> по по-<br>рядку</td>
  <td colspan=5 class=xl26 style='border-left:none'>Товар</td>
  <td colspan=5 class=xl26 style='border-left:none'>Единица измерения</td>
  <td rowspan=2 class=xl43 width=41 style='width:31pt'>Вид упаковки</td>
  <td colspan=4 class=xl26 style='border-left:none'>Количество</td>
  <td colspan=4 rowspan=2 class=xl43 width=48 style='width:36pt'>Масса брутто</td>
  <td colspan=2 rowspan=2 class=xl43 width=61 style='width:46pt'>Коли-<br>
    чество <br>
    (масса <br>
    нетто)</td>
  <td colspan=2 rowspan=2 class=xl43 width=79 style='width:60pt'>Цена,<br>
    руб. коп.</td>
  <td colspan=5 rowspan=2 class=xl43 width=88 style='width:66pt'>Сумма
  без<br>
    учета НДС,<br>
    руб. коп.</td>
  <td colspan=6 class=xl26 style='border-left:none'>НДС</td>
  <td colspan=3 rowspan=2 class=xl43 width=89 style='width:67pt'>Сумма с<br>
    учетом <br>
    НДС, <br>
    руб. коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl40 height=57 style='mso-height-source:userset;height:43.35pt'>
  <td height=57 class=xl42 style='height:43.35pt'>&nbsp;</td>
  <td colspan=4 class=xl43 width=209 style='border-left:none;width:158pt'>наименование, характеристика, сорт, артикул товара</td>
  <td class=xl26 style='border-top:none;border-left:none'>код</td>
  <td colspan=4 class=xl43 width=55 style='border-left:none;width:42pt'>наиме-нование</td>
  <td class=xl43 width=44 style='border-top:none;border-left:none;width:33pt'>код по ОКЕИ</td>
  <td colspan=3 class=xl43 width=42 style='border-left:none;width:32pt'>в одном месте</td>
  <td class=xl43 width=55 style='border-top:none;border-left:none;width:41pt'>мест,<br> штук</td>
  <td colspan=3 class=xl43 width=61 style='border-left:none;width:46pt'>ставка, %</td>
  <td colspan=3 class=xl43 width=79 style='border-left:none;width:60pt'>сумма, <br>руб. коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl44 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl45 style='height:11.25pt'>&nbsp;</td>
  <td class=xl46 style='border-top:none' >1</td>
  <td colspan=4 class=xl46 style='border-left:none' >2</td>
  <td class=xl47 style='border-top:none;border-left:none' >3</td>
  <td colspan=4 class=xl46 style='border-left:none' >4</td>
  <td class=xl47 style='border-top:none;border-left:none' >5</td>
  <td class=xl47 style='border-top:none;border-left:none' >6</td>
  <td colspan=3 class=xl47 style='border-left:none' >7</td>
  <td class=xl47 style='border-top:none;border-left:none' >8</td>
  <td colspan=4 class=xl47 style='border-left:none' >9</td>
  <td colspan=2 class=xl47 style='border-left:none' >10</td>
  <td colspan=2 class=xl47 style='border-left:none' >11</td>
  <td colspan=5 class=xl47 style='border-left:none' >12</td>
  <td colspan=3 class=xl46 style='border-left:none' >13</td>
  <td colspan=3 class=xl47 style='border-left:none' >14</td>
  <td colspan=3 class=xl47 style='border-left:none' >15</td>
  <td class=xl44></td>
 </tr>>
    Q ""
]]></Implementation>
</Method>

<Method name="wCols">
<Description>
Вывод колонок </Description>
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
  &html<<col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=34 style='mso-width-source:userset;mso-width-alt:1450;width:26pt'>
 <col class=xl24 width=74 style='mso-width-source:userset;mso-width-alt:3157;width:56pt'>
 <col class=xl24 width=14 style='mso-width-source:userset;mso-width-alt:597;width:11pt'>
 <col class=xl24 width=109 style='mso-width-source:userset;mso-width-alt:4650;width:82pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=71 style='mso-width-source:userset;mso-width-alt:3029;width:53pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=13 style='mso-width-source:userset;mso-width-alt:554;width:10pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=44 style='mso-width-source:userset;mso-width-alt:1877;width:33pt'>
 <col class=xl24 width=41 style='mso-width-source:userset;mso-width-alt:1749;width:31pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=55 style='mso-width-source:userset;mso-width-alt:2346;width:41pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=15 span=2 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=46 style='mso-width-source:userset;mso-width-alt:1962;width:35pt'>
 <col class=xl24 width=15 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=53 style='mso-width-source:userset;mso-width-alt:2261;width:40pt'>
 <col class=xl24 width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <col class=xl24 width=11 style='mso-width-source:userset;mso-width-alt:469;width:8pt'>
 <col class=xl24 width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col class=xl24 width=4 style='mso-width-source:userset;mso-width-alt:170;width:3pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=42 style='mso-width-source:userset;mso-width-alt:1792;width:32pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=17 style='mso-width-source:userset;mso-width-alt:725;width:13pt'>
 <col class=xl24 width=36 style='mso-width-source:userset;mso-width-alt:1536;width:27pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=76 style='mso-width-source:userset;mso-width-alt:3242;width:57pt'>
 <col class=xl24 width=1 style='mso-width-source:userset;mso-width-alt:42;width:1pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col width=64 span=216 style='mso-width-source:userset;mso-width-alt:2730;width:48pt'>>
  Q ""
]]></Implementation>
</Method>

<Method name="wRows">
<Description>
Вывод строк накладной</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc:Docs.Rash,NDSinside,nds,antinds,kurs,*summary:%String=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 Q:'$ISOBJECT(doc) ""  
 Q:'$IsObject(doc.Items) ""
 
 s (vsegoquant, vsegosummabeznds, vsegondsotsumma, vsegosummasnds) = ""  
 s (count,totquant)=0
 s ndsprocent=nds*100 if NDSinside="true" s ndsprocent=0
 
 #; основание - документ по гарантии?
 /// Common.Dictionary7 
 #define BYGARANT 1
 
 s docid = doc.%Id(), oplid = ##class(Docs.Rash).oplGetStored( docid )
 s isByGarant = ( oplid = $$$BYGARANT )
 
 #; debug
 #; w "<tr><td colspan=10>",docid,":",oplid,":",isByGarant,"</td></tr>"
 
 s i="" for {  s item=doc.Items.GetNext(.i) Q:i=""  
    
    s count = count + 1 
    
    s:$IsObject(item.Goods) goods=item.Goods.FullName
    
    s itempr=item.Price 
    
    #; Основное изменение:
    #; Документ по гарантии - цену убираем
    s:isByGarant itempr=0  
    
    s quant=item.Quantity
    
    /*
    k ^mtempArt
    s ^mtempArt("NDSinside")=NDSinside
    s ^mtempArt("antinds")=antinds
    s ^mtempArt("nds")=nds
    */
    
    i NDSinside="false" {
        s price=$J(kurs*itempr,".",2) ;так же как и в счете
        s summabeznds=$J(price*quant,".",2) ;округление
        s ndsotsumma=$J(summabeznds-(summabeznds*antinds),".",2) ;округление
        s summasnds=$J(summabeznds+ndsotsumma,".",2) ;!!! сумма округлений
    } else {
        s nds=0
        s price=$J(kurs*itempr*antinds,".",2)
        s summabeznds=$J(quant*price,".",2)
        s ndsotsumma=$J(summabeznds*nds,".",2)
        s summasnds=summabeznds+ndsotsumma
    }
 
    #; подсчёт итогов по колонкам
    s vsegoquant=vsegoquant+quant
    , vsegondsotsumma=vsegondsotsumma+ndsotsumma
    , vsegosummabeznds=vsegosummabeznds+summabeznds
    
    k row 
    s row("count") = count, row("goods") = goods
    , row("quant") = quant, row("price") = price
    s row("summabeznds") = summabeznds
    s row("ndsprocent") = ndsprocent
    , row("ndsotsumma") = ndsotsumma
    s row("summasnds") = summasnds
    
    #;debug
    s row("iprice") = item.Price, row("kurs") = kurs
    s row("nds") = nds, row("NDSinside")=NDSinside
    
    d ..wRow(.row) 
    
 }
 s vsegosummasnds=vsegosummabeznds+vsegondsotsumma
 
 s summary("vsegoquant") = vsegoquant
 s summary("vsegondsotsumma") = vsegondsotsumma
 s summary("vsegosummabeznds") = vsegosummabeznds
 s summary("vsegosummasnds") = vsegosummasnds
 s summary("rowcount") = count
 
 d ..wPageSummary( .summary )  ;последняя страница
 
 Q ""
]]></Implementation>
</Method>

<Method name="wRow">
<Description>
Вывод одной строки накладной </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&row:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
 #define g(%name) $g(row(%name))   
    
 &html<<tr class=xl40 height=29 style='mso-height-source:userset;height:22.35pt'>
 <td height=29 class=xl42 style='height:22.35pt'>&nbsp;</td>
 <td class=xl95 style='border-top:none'>
    #( $$$g("count") )#
 </td><td colspan=4 class=xl105 width=209 style='width:158pt'>
    #( $$$g("goods") )#
 </td><td class=xl48 width=71 style='border-top:none;width:53pt'>&nbsp;</td>
 <td colspan=4 class=xl106>шт</td>
 <td class=xl49 width=44 style='border-top:none;width:33pt'>&nbsp;</td>
 <td class=xl50 style='border-top:none'>&nbsp;</td>
 <td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl53 style='border-top:none'>&nbsp;</td>
 <td class=xl54 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl53 style='border-top:none'>&nbsp;</td>
 <td colspan=2 class=xl107 width=61 style='border-left:none;width:46pt' >
    #( $$$g("quant") )#
 </td><td colspan=2 class=xl90 style='border-left:none'>
    #( $$$g("price") )#
 </td><td colspan=5 class=xl91 width=88 style='border-left:none;width:66pt'>
    #( $$$g("summabeznds") )#
 </td><td colspan=3 class=xl127>
    #( $$$g("ndsprocent") )#
 </td><td class="xl57" width=26 style='border-top:none;width:20pt;border-left:.5pt solid windowtext;' colspan=3>
    #( $$$g("ndsotsumma") )#
 </td><td colspan=3 class=xl92 width=89 style='border-left:none;width:67pt'>
    #( $$$g("summasnds") )#
 </td><td class=xl40></td>
 </tr>>
    
    #; debug
    #;&html<<tr><td colspan=37><pre>>
    #;zw row
    #;&html<</td></tr>>
   
   Q ""
]]></Implementation>
</Method>

<Method name="wPageSummary">
<Description>
Строка итого после товарных строк</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&summary:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
   
  #define g(%name) $g(summary(%name))
  
  &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl61></td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td colspan=3 class=xl121 style='border-right:.5pt solid black' >Итого<span style='mso-spacerun:yes'> </span></td>
  <td class=xl63 style='border-left:none'>&nbsp;</td>
  <td class=xl65>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl66>&nbsp;</td>
  <td colspan=2 class=xl88 width=61 style='width:46pt'>
    #( $J( $$$g("vsegoquant"), ".", 0) )#
  </td><td colspan=2 class=xl89>Х</td>
  <td colspan=5 class=xl108 width=88 style='width:66pt'>
    #( $J( $$$g("vsegosummabeznds"), ".", 2) )#
  </td><td colspan=3 class=xl109>Х</td>
  <td class=xl68 width=43 style='width:33pt' colspan=2>
    #( $J( $$$g("vsegondsotsumma"), ".", 2) )#
  </td><td class=xl69 width=36 style='width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl93 width=89 style='width:67pt'>
    #($J( $$$g("vsegosummasnds"), ".", 2) )#
  </td><td></td>
 </tr>>
]]></Implementation>
</Method>

<Method name="wSummary">
<Description>
Строка итого после товарных строк</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&summary:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
   
  #define g(%name) $g(summary(%name))
  
  &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td colspan=10 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl123 style='border-right:.5pt solid black'>Всего по накладной<span style='mso-spacerun:yes'> </span></td>
  <td class=xl71 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl73 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl74 style='border-top:none'>&nbsp;</td>
  <td colspan=2 class=xl94 width=61 style='border-left:none;width:46pt'>
    #( $J( $$$g("vsegoquant"),".",0) )#
  </td><td colspan=2 class=xl50 style='border-left:none'>Х</td>
  <td colspan=5 class=xl87 width=88 style='border-left:none;width:66pt'>
    #( $J( $$$g("vsegosummabeznds"),".",2) )#
  </td><td colspan=3 class=xl50 style='border-left:none'>Х</td>
  <td class=xl75 width=26 style='border-top:none;border-left:none;width:20pt'>&nbsp;</td>
  <td class=xl55 width=17 style='border-top:none;width:13pt'>&nbsp;</td>
  <td class=xl57 width=36 style='border-top:none;width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl87 width=89 style='border-left:none;width:67pt'>
    #( $J( $$$g("vsegosummasnds"),".",2) )#
  </td><td></td>
 </tr>
>    
 Q ""
]]></Implementation>
</Method>

<Method name="wFooter">
<Description>
Выводим подвал формы </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>summary</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s DoverennNumber = %request.GetCookie("dv")      //номер доверенности
 s DoverennDatValue = %request.GetCookie("dvdt")  //дата доверенности
 s permitter = %request.Get("otpr") ;s permitter="Креймер А.Я." 
 s executor = %request.Get("otpp") ;s executor="Кашменский Ю.Е."
 
 s CountWords = 1
 s (CountWords(10),CountWords(5),CountWords(2),CountWords(1),CountWords(-1)) = ""
 
   
     &html<<tr class=xl24 height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 colspan=4 class=xl24 style='height:12.0pt;mso-ignore:colspan'></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>Товарная накладная имеет
  приложение на</td>
  <td class=xl76></td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=18 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 colspan=4 class=xl24 style='height:11.1pt;mso-ignore:colspan'></td>
  <td class=xl24>и содержит</td>
  <td class=xl78 colspan=2 style='mso-ignore:colspan'>#(##class(Utils.Propis).Write($G(summary("rowcount")),.CountWords))#<!-- Три --></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=8 style='mso-ignore:colspan'>порядковых номеров записей</td>
  <td colspan=8 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=27 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=5 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=3 rowspan=3 class=xl78>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span style='mso-spacerun:yes'>     </span>Масса груза (нетто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td colspan=5 class=xl81>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=13 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl24>Всего мест</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span
  style='mso-spacerun:yes'>     </span>Масса груза (брутто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td colspan=5 class=xl111>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=20 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=6 style='mso-height-source:userset;height:5.1pt'>
  <td height=6 colspan=40 class=xl24 style='height:5.1pt;mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl24 style='height:9.75pt'></td>
  <td class=xl24 colspan=5 style='mso-ignore:colspan'>Приложение (паспорта, сертификаты и т.п.) на</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>листах</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl70></td>
  <td class=xl70>По доверенности </td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl85 align=center style='mso-ignore:colspan'>от</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 colspan=6 class=xl24 style='height:10.5pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=9 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:10.35pt'>
  <td height=13 class=xl24 style='height:10.35pt'></td>
  <td class=xl86 colspan=4 style='mso-ignore:colspan'>Всего отпущено на сумму</td>
  <td colspan=10 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=4 class=xl84>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>выданной</td>
  <td class=xl24></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=18 class=xl112 width=575 style='width:434pt'>#(##class(Utils.Propis).Write(summary("vsegosummasnds")))#<!-- Пятьдесят один рубль 00 копеек --></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>кем, кому (организация, должность, фамилия, и. о.)</td>
  <td colspan=14 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 class=xl24 style='height:8.1pt'></td>
  <td colspan=14 class=xl113>прописью</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза разрешил</td>
  <td class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td class=xl129></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=10 class=xl130 width=218 style='width:164pt'>#(permitter)#<font
  class="font16">(доверенность #(DoverennNumber)# от #(DoverennDatValue)#)</font></td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 colspan=4 class=xl24 style='height:9.0pt;mso-ignore:colspan'></td>
  <td class=xl131>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl132 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl133>расшифровка подписи</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td colspan=3 class=xl86 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=10 class=xl134 width=218 style='width:164pt'></td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Груз принял</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=6 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl135 style='mso-ignore:colspan'></td>
  <td class=xl24></td>
  <td colspan=10 class=xl136>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза произвел</td>
  <td class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td class=xl129></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=10 class=xl130 width=218 style='width:164pt'>#(executor)#</td>
  <td class=xl24></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan' >Груз получил</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl83>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl114>расшифровка подписи</td>
  <td class=xl24></td>
  <td class=xl40 colspan=4 style='mso-ignore:colspan'>грузополучатель</td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>
 <tr class=xl24 height=6 style='mso-height-source:userset;height:5.1pt'>
  <td height=6 colspan=18 class=xl24 style='height:5.1pt;mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl24 style='height:11.25pt'></td>
  <td colspan=2 class=xl70 style='mso-ignore:colspan'></td>
  <td class=xl70>М.П.</td>
  <td class=xl24></td>
  <td class=xl70><!-- &quot;15&quot; --></td>
  <td class=xl28><!-- августа --></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>20___ г</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl85 align=center style='mso-ignore:colspan'>М.П.</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl24 colspan=10 style='mso-ignore:colspan'>&quot;_____&quot; _____________ 20__ г</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=7 style='width:5pt'></td>
  <td width=34 style='width:26pt'></td>
  <td width=74 style='width:56pt'></td>
  <td width=14 style='width:11pt'></td>
  <td width=109 style='width:82pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=71 style='width:53pt'></td>
  <td width=30 style='width:23pt'></td>
  <td width=13 style='width:10pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=3 style='width:2pt'></td>
  <td width=44 style='width:33pt'></td>
  <td width=41 style='width:31pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=30 style='width:23pt'></td>
  <td width=3 style='width:2pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=46 style='width:35pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=26 style='width:20pt'></td>
  <td width=53 style='width:40pt'></td>
  <td width=37 style='width:28pt'></td>
  <td width=11 style='width:8pt'></td>
  <td width=27 style='width:20pt'></td>
  <td width=4 style='width:3pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=7 style='width:5pt'></td>
  <td width=42 style='width:32pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=26 style='width:20pt'></td>
  <td width=17 style='width:13pt'></td>
  <td width=36 style='width:27pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=76 style='width:57pt'></td>
  <td width=1 style='width:1pt'></td>
  <td width=3 style='width:2pt'></td>
 </tr>
 <![endif]>>
  
 Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    &html<<!--table
    {mso-displayed-decimal-separator:"\,";
    mso-displayed-thousand-separator:" ";}
@page
    {margin:.16in .2in .16in .2in;
    mso-header-margin:.16in;
    mso-footer-margin:.16in;
    mso-page-orientation:landscape;}
.font16
    {color:windowtext;
    font-size:6.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;}
tr
    {mso-height-source:auto;}
col
    {mso-width-source:auto;}
br
    {mso-data-placement:same-cell;}
.style0
    {mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    white-space:nowrap;
    mso-rotate:0;
    mso-background-source:auto;
    mso-pattern:auto;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    border:none;
    mso-protection:locked visible;
    mso-style-name:Обычный;
    mso-style-id:0;}
td
    {mso-style-parent:style0;
    padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    border:none;
    mso-background-source:auto;
    mso-pattern:auto;
    mso-protection:locked visible;
    white-space:nowrap;
    mso-rotate:0;}
.xl24
    {mso-style-parent:style0;
    text-align:left;}
.xl25
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:middle;}
.xl26
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl27
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0000000;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl28
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl29
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;}
.xl30
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0000000000;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl31
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-weight:0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl32
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;}
.xl33
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl34
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl35
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl36
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl37
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl38
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:middle;}
.xl39
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl40
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;}
.xl41
    {mso-style-parent:style0;
    font-style:italic;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:top;}
.xl42
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;
    border:none;}
.xl43
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl44
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:middle;}
.xl45
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:middle;
    border:none;}
.xl46
    {mso-style-parent:style0;
    font-size:7.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl47
    {mso-style-parent:style0;
    font-size:7.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl48
    {mso-style-parent:style0;
    mso-number-format:00000000000;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl49
    {mso-style-parent:style0;
    mso-number-format:0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl50
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl51
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl52
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl53
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl54
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl55
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl56
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl57
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl58
    {mso-style-parent:style0;
    text-align:left;
    border:none;}
.xl59
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl60
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl61
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl62
    {mso-style-parent:style0;
    text-align:left;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl63
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl64
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl65
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl66
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl67
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl68
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl69
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl70
    {mso-style-parent:style0;
    text-align:right;}
.xl71
    {mso-style-parent:style0;
    text-align:right;
    border:.5pt solid windowtext;}
.xl72
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl73
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl74
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl75
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl76
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl77
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl78
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl79
    {mso-style-parent:style0;
    text-align:left;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl80
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl81
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl82
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl83
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl84
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl85
    {mso-style-parent:style0;
    text-align:center-across;}
.xl86
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;}
.xl87
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl88
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl89
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl90
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl91
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl92
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl93
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl94
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl95
    {mso-style-parent:style0;
    mso-number-format:0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl96
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    white-space:normal;}
.xl97
    {mso-style-parent:style0;
    font-size:9.0pt;
    text-align:left;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl98
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl99
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    white-space:normal;}
.xl100
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl101
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    border:.5pt solid windowtext;}
.xl102
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl103
    {mso-style-parent:style0;
    font-size:9.0pt;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl104
    {mso-style-parent:style0;
    font-size:9.0pt;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl105
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl106
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl107
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl108
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl109
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl110
    {mso-style-parent:style0;
    text-align:left;
    border:1.0pt solid windowtext;}
.xl111
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl112
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl113
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl114
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl115
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;}
.xl116
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;}
.xl117
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl118
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;}
.xl119
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl120
    {mso-style-parent:style0;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl121
    {mso-style-parent:style0;
    text-align:center;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl122
    {mso-style-parent:style0;
    text-align:center;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl123
    {mso-style-parent:style0;
    text-align:center;}
.xl124
    {mso-style-parent:style0;
    text-align:center;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl125
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl126
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl127
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl128
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl129
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;
    white-space:normal;}
.xl130
    {mso-style-parent:style0;
    font-weight:700;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl131
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl132
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl133
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl134
    {mso-style-parent:style0;
    text-align:left;
    white-space:normal;}
.xl135
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center-across;
    vertical-align:top;}
.xl136
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
 -->>
    
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.screen.torg12v3">
<Description><![CDATA[
Переопределенная сsp.screen.torg12v2 - :
На каждой странице печатается  итоговая строка по странице
Задача - определять количество строк на странице и формировать итоговую
При этом учитывать, что на первой странице строк меньше (из-за шапки)
Отладка на сервере - накладная в 200 строк:
http://localhost/csp/sklad2/csp.screen.torg12v3.cls?id=7132&class=tovnakladn&kontr=4&kontr2=242&kontr3=5&kontr4=242&nomernakl=710-2007&DoverennNumber=&DoverennDatValue=05/09/2013&NDSinside=true&DocDate=06/12/2007&sessionid=1e3RXyxw00&OpenWith=excel]]></Description>
<Super>csp.screen.torg12v2</Super>
<TimeCreated>63075,60506.96248</TimeCreated>

<Parameter name="FIRSTPAGEROWS">
<Description>
Максимальное количество товарных строк
размещаемых на первой странице </Description>
<Default>3</Default>
</Parameter>

<Parameter name="OTHERPAGEROWS">
<Description>
Максимальное количество товарных строк
размещаемых на последующих страницах </Description>
<Default>24</Default>
</Parameter>

<Parameter name="GOODNAMELIMIT">
<Description>
Максимальная количество символов в наимен. товара 
Остальное не отображается при печати, но остается
Пока не используется</Description>
<Default>42</Default>
</Parameter>

<Method name="wRows">
<Description>
Вывод строк накладной</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc:Docs.Rash,NDSinside,nds,antinds,kurs,*summary:%String=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 Q:'$ISOBJECT(doc) ""  Q:'$IsObject(doc.Items) ""
 
 s ndsprocent=nds*100 if NDSinside="true" s ndsprocent=0
 
 #; основание - документ по гарантии?
 #define BYGARANT 1
 s docid = doc.%Id(), oplid = ##class(Docs.Rash).oplGetStored( docid ) ; Common.Dictionary7 
 s isByGarant = ( oplid = $$$BYGARANT )
 
 s count=0, page=1
 
 s i="" for {  s item=doc.Items.GetNext(.i) Q:i=""  
    
    s count = count + 1 
    
    s:$IsObject(item.Goods) goods=item.Goods.FullName
    
    s itempr=item.Price 
    
    #;Документ по гарантии - цену убираем
    s:isByGarant itempr=0  
    
    s quant=item.Quantity
    
    i NDSinside="false" {
        s price=$J(kurs*itempr,".",2) ;так же как и в счете
        s summabeznds=$J(price*quant,".",2) ;округление
        s ndsotsumma=$J(summabeznds-(summabeznds*antinds),".",2) ;округление
        s summasnds=$J(summabeznds+ndsotsumma,".",2) ;!!! сумма округлений
    } else {
        s nds=0
        s price=$J(kurs*itempr*antinds,".",2)
        s summabeznds=$J(quant*price,".",2)
        s ndsotsumma=$J(summabeznds*nds,".",2)
        s summasnds=summabeznds+ndsotsumma
    }
 
    k row s row("count") = count, row("goods") = goods
    , row("quant") = quant, row("price") = price
    , row("summabeznds") = summabeznds, row("ndsprocent") = ndsprocent
    , row("ndsotsumma") = ndsotsumma,  row("summasnds") = summasnds
    
    d ..wRow(.row) 
    
    #; итого по странице    
    #define pagesum(%name,%val) s page(%name)=$g(page(%name))+%val
    
    $$$pagesum("rowcount",1)    
    $$$pagesum("vsegoquant",quant)
    $$$pagesum("vsegondsotsumma",ndsotsumma)
    $$$pagesum("vsegosummabeznds",summabeznds)
    s vsegosummasnds = $g(page("vsegosummabeznds")) + $g(page("vsegondsotsumma"))
    $$$pagesum("vsegosummasnds", vsegosummasnds)
    
    #; подсчёт итогов по колонкам
    #define summary(%name,%val) s summary(%name)=$g(summary(%name))+%val
    
    $$$summary("rowcount",1)
    $$$summary("vsegoquant",quant)
    $$$summary("vsegondsotsumma",ndsotsumma)
    $$$summary("vsegosummabeznds",summabeznds)
    s vsegosummasnds = $g(summary("vsegosummabeznds")) + $g(summary("vsegondsotsumma"))
    $$$summary("vsegosummasnds", vsegosummasnds)
    
    #; cчитаем сколько строк вывели
    s currpage = ..gPage(count)
    if currpage '= page { ;page break detected
             s page = currpage ;выставляем перед печатью
             d ..OnPageBreak(.page)
             k page ;очистка
             s page = currpage ;восстановление
    } 
    
 } //закончили вывод строк 
 
 d ..wPageSummary(.page) ;строка итого на последней странице, перед подвалом
 
  
 Q ""
]]></Implementation>
</Method>

<Method name="OnPageBreak">
<Description>
Вывод итоговой по странице, номера следующей, и шапки таблицы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&page:%String]]></FormalSpec>
<Implementation><![CDATA[
  d ..wPageSummary( .page )  ;выводим итого по странице
  //if page > 2 d ..wSpace() ;добираем до полной страницы
  d ..wPageNumber( page ) ;выводим номер новой страницы
  d ..wTablePageHeader() ;и заголовок таблицы
]]></Implementation>
</Method>

<Method name="gPage">
<Description>
Вернет номер страницы по номеру строки</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>row:%Integer</FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
   s fpr = ..#FIRSTPAGEROWS
   if row <= fpr Q 1 ;первую легко
   s opr = ..#OTHERPAGEROWS
   s page = row \ opr  ;целых страниц, +1 так как первую уже отдали
   #; разбираемся с остатком, учитываем неполную первую страницу
   s diff = row - (page * opr) s:diff<0 diff=diff*-1 ;беззнаковый остаток
   if diff > fpr s page=page+1 ;остаток превышает размер первой страницы
   #; w  w ! ;отдладка
   Q page + 1 ;всегда добаляем еще одну, так как первую уже отдали
]]></Implementation>
</Method>

<Method name="wSpace">
<Description><![CDATA[
Выводит номер страницы
<var>page</var> - номер страницы]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
  &html<<tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=19 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  </tr><tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=19 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  </tr>>
]]></Implementation>
</Method>
</Class>


<Class name="csp.screen.torg12v4">
<Description><![CDATA[
Модернизированный вариант torg12v2, torg12v3
Печатает подвал накладной без отрыва от товарных строк
Общая идея: 
на первой странице (т.е с шапкой) помещается 4 строки (И подвал)
на первой странице (т.е с шапкой) помещается 12 строк БЕЗ подвала
На других страницах (без шапки) помещается 15 строк (И подвал)
На других страницах (без шапки) помещается 24 строк (БЕЗ подвал)
В методе <method>wRows</method> выводится товарная строка
, затем вызывается метод <method>gPage</method> 
и если номер страницы изменился
печается итоговая строка по страницы и разрыв страницы

Отладочные накладные: 
1. 3 строки ( одна полная страница )
id=83911&nomernakl=1565-2013&DocDate=09%2F12%2F2013&kontr=4&kontr2=411&kontr3=5&kontr4=411&otpr=%CA%F0%E5%E9%EC%E5%F0+%C0.%DF.&otpp=%CA%E0%F8%EC%E5%ED%F1%EA%E8%E9+%DE.%C5.&NDSinside=true
2. 6 строк ( две неполные страницы )
id=83913&nomernakl=2013-11+868&DocDate=09%2F12%2F2013&kontr=4&kontr2=868&kontr3=5&kontr4=868&otpr=%CA%F0%E5%E9%EC%E5%F0+%C0.%DF.&otpp=%CA%E0%F8%EC%E5%ED%F1%EA%E8%E9+%DE.%C5.&NDSinside=true]]></Description>
<Super>%CSP.Page</Super>
<TimeCreated>63164,40452.491173</TimeCreated>

<Parameter name="P1MIN">
<Description>
Количество строк на ПЕРВОЙ странице с шапкой и подвалом</Description>
<Default>4</Default>
</Parameter>

<Parameter name="P1MAX">
<Description>
Макс. кол-во строк на ПЕРВОЙ странице с шапкой и БЕЗ подвала</Description>
<Default>13</Default>
</Parameter>

<Parameter name="P2MIN">
<Description>
Количество строк на ДРУГИХ страницах С подвалом</Description>
<Default>15</Default>
</Parameter>

<Parameter name="P2MAX">
<Description>
Макс. кол-во строк на ДРУГИХ страницах БЕЗ подвала</Description>
<Default>24</Default>
</Parameter>

<Parameter name="GOODNAMELIMIT">
<Description>
Максимальная количество символов в наимен.товара 
Остальное не отображается при печати, но остается
Пока не используется</Description>
<Default>42</Default>
</Parameter>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
    
    s login=$G(%session.Data("user"))
    //i '+login s %response.ServerSideRedirect="norights.csp" 
    
    s OpenWith = $g(args("OpenWith",1))   //чем открыть этот файл
    if OpenWith="" { //альтернативный вариант передачи типа вывода
        s:$d(%request.Data("excel")) OpenWith="excel" 
        s:$d(%request.Data("word")) OpenWith="word" 
    }
    
    s allowformats = $lb("word","excel")
    if $lf(allowformats , OpenWith ) {
        
        #; excel for default
        s contentType = "application/vnd.ms-excel", attachment="torg12.xls"
        
        if OpenWith="word" {
            s contentType = "application/msword", attachment="word.doc"
        }
    
        s %response.ContentType = contentType
        d %response.SetHeader("Content-Disposition","attachment; filename="""_attachment_"""")
        s %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
     
    }
    
 Q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Вывод страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
 #; Разбираем аргументы
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 
 s docid=%request.Get("id"), docname="Платежное поручение"
 , DocDate=%request.Get("DocDate")
 
 s nomnakl=%request.Get("nomernakladnoy")
 s NDSinside=%request.Get("NDSinside")
 
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 .s docname=doc.Name_"-П"
 .s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 .s:DocDate'="" docdate=DocDate
 .q:$G(docdate)=""
 .s docdate=$TR(docdate,"/",".")
 .s kurs=doc.kurs
 .if '+kurs,+doc.Summa s kurs=doc.RubSumma/doc.Summa

 s kontr1=%request.Get("kontr"), kontr2=%request.Get("kontr2")
 s kontr3=%request.Get("kontr3"), kontr4=%request.Get("kontr4")
 #;w !,kontr1,!, kontr2,!, kontr3,!, kontr4
 

 #define set(%n) s (kname%n, Address%n, codecity%n, namecity%n, Postalcode%n, pbank%n, city%n, kpp%n, inn%n, bik%n, rsch%n, ksch%n, code%n, okpo%n, okud%n, okdp%n)=""
 
 $$$set(1) $$$set(2) $$$set(3) $$$set(4)
 
 #define loadkontr(%n) ..LoadKontr(kontr%n,.kname%n,.Address%n,.codecity%n,.namecity%n,.Postalcode%n,.pbank%n,.city%n,.kpp%n,.inn%n,.bik%n,.rsch%n,.ksch%n,.code%n,.okpo%n,.okud%n,.okdp%n)
 
 d $$$loadkontr(1), $$$loadkontr(2), $$$loadkontr(3), $$$loadkontr(4)
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 s antinds=1
 &html<<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 11">
<title>Товарная накладная #(nomnakl)#</title>

<style>
#(..wCss())#
</style>
<!--[if gte mso 9]><xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
   <x:Name>torg12</x:Name>
    <x:WorksheetOptions>
     <x:Print>
      <x:ValidPrinterInfo/>
      <x:PaperSizeIndex>9</x:PaperSizeIndex>
     </x:Print>
     <x:DoNotDisplayGridlines/>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
 </x:ExcelWorkbook>
</xml><![endif]-->
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=1066 style='border-collapse:collapse;table-layout:fixed;width:804pt'>>

 d ..wCols() ;выводит колонки  (cols) таблицы
 
 &html<<tr height=22 style='mso-height-source:userset;height:17.1pt'>
  <td colspan=38 height=22 class=xl96 width=1062 style='height:17.1pt;width:801pt'>Унифицированная форма № ТОРГ-12<br>
    Утверждена постановлением Госкомстата России от 25.12.98 № 132</td>
  <td class=xl24 width=1 style='width:1pt'></td>
  <td class=xl24 width=3 style='width:2pt'></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 colspan=35 class=xl24 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl25 style='mso-ignore:colspan'></td>
  <td class=xl26>Коды</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=28 rowspan=2 class=xl125 width=818 style='width:617pt'>#($G(kname1))#, ИНН #($G(inn1))#, КПП #($G(kpp1))#, 
    #($G(Postalcode1))#, #($G(namecity1))#, #($G(Address1))#, Р/C #($G(rsch1))#, 
    #($G(pbank1))#, #($G(city1))#; БИК #($G(bik1))#, К/С #($G(ksch1))#</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl116 style='border-right:1.0pt solid black'>Форма по ОКУД</td>
  <td class=xl27 style='border-left:none'>#($G(okud1))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl30 style='border-left:none' >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>организация-грузоотправитель,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl32 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl97>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=33 class=xl98>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=19 style='mso-height-source:userset;height:14.65pt'>
  <td height=19 colspan=3 class=xl24 style='height:14.65pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>структурное
  подразделение</td>
  <td colspan=8 class=xl118 style='border-right:1.0pt solid black'>Вид
  деятельности по ОКДП</td>
  <td class=xl33 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td colspan=2 class=xl99 width=108 style='width:82pt'>Грузополучатель</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname2))#,  ИНН #($G(inn2))#, КПП #($G(kpp2))#,
    #($G(Postalcode2))#, #($G(namecity2))#,&nbsp; #($G(Address2))#, P/C #($G(rsch2))#, 
    #($G(pbank2))#, #($G(city2))#; БИК #($G(bik2))#, K/C #($G(ksch2))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl34 style='border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация, адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl30 >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Поставщик</td>
  <td colspan=31 class=xl125 width=806 style='width:608pt'>#($G(kname3))#,  ИНН #($G(inn3))#, КПП #($G(kpp3))#,
    #($G(Postalcode3))#, 
    #($G(namecity3))#,&nbsp; #($G(Address3))#, P/C #($G(rsch3))#, #($G(pbank3))#, 
    #($G(city3))#; БИК #($G(bik3))#, K/C #($G(ksch3))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Плательщик</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname4))#,  ИНН #($G(inn4))#, КПП #($G(kpp4))#,
    #($G(Postalcode4))#, 
    #($G(namecity4))#,&nbsp; #($G(Address4))#, P/C #($G(rsch4))#, #($G(pbank2))#, 
    #($G(city4))#; БИК #($G(bik4))#, К/С #($G(ksch4))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 rowspan=2 class=xl101>номер</td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl29></td>
  <td class=xl29>Основание</td>
  <td colspan=31 class=xl126><!--Счет № *** от **.**.**** г.-->Счёт № #(nomnakl)#</td>
  <td class=xl24></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>договор, заказ-наряд</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=10 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=4 class=xl102>Номер документа</td>
  <td colspan=4 class=xl102 style='border-left:none'>Дата составления</td>
  <td colspan=7 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=9 class=xl118>Транспортная накладная</td>
  <td class=xl24></td>
  <td colspan=2 class=xl101>номер</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
 
 &html<<tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl38></td>
  <td colspan=6 class=xl115 style='border-right:1.0pt solid black'>ТОВАРНАЯ НАКЛАДНАЯ<span style='mso-spacerun:yes'>  </span></td>
  <td colspan=4 class=xl103 style='border-left:none'>#(nomnakl)#</td>
  <td colspan=4 class=xl104 style='border-left:none'>#($G(docdate))#</td>
  <td colspan=17 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=35 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl29></td>
  <td class=xl29>Вид операции</td>
  <td class=xl39>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
 
 d ..wPageNumber()
  
 d ..wTablePageHeader()
 
 k summary 
 
 d ..wRows( doc, NDSinside, nds, antinds, kurs, .summary )
 
 d ..wSummary( .summary )  
  
 d ..wFooter(.summary) ;разбито из-за ограничений в 32к на размер программы

 &html<</table></body></html>>
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="wPageNumber">
<Description><![CDATA[
Выводит номер страницы
<var>page</var> - номер страницы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>page=1</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  s pagebreak = $s(page=1:"",1:"page-break-before:always;") 
  &html<<tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt;#(pagebreak)#'>
  <td height=15 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl41 style='mso-ignore:colspan'></td>
  <td class=xl41>Страница #(page)#</td>
  <td class=xl40></td>
 </tr>>
]]></Implementation>
</Method>

<Method name="wTablePageHeader">
<Description>
Выводит заголовок таблицы с товарными строками на каждой странице</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
     &html<<tr class=xl40 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl42 style='height:11.1pt'>&nbsp;</td>
  <td rowspan=2 class=xl43 width=34 style='width:26pt'>Но-<br>мер<br> по по-<br>рядку</td>
  <td colspan=5 class=xl26 style='border-left:none'>Товар</td>
  <td colspan=5 class=xl26 style='border-left:none'>Единица измерения</td>
  <td rowspan=2 class=xl43 width=41 style='width:31pt'>Вид упаковки</td>
  <td colspan=4 class=xl26 style='border-left:none'>Количество</td>
  <td colspan=4 rowspan=2 class=xl43 width=48 style='width:36pt'>Масса брутто</td>
  <td colspan=2 rowspan=2 class=xl43 width=61 style='width:46pt'>Коли-<br>
    чество <br>
    (масса <br>
    нетто)</td>
  <td colspan=2 rowspan=2 class=xl43 width=79 style='width:60pt'>Цена,<br>
    руб.коп.</td>
  <td colspan=5 rowspan=2 class=xl43 width=88 style='width:66pt'>Сумма
  без<br>
    учета НДС,<br>
    руб.коп.</td>
  <td colspan=6 class=xl26 style='border-left:none'>НДС</td>
  <td colspan=3 rowspan=2 class=xl43 width=89 style='width:67pt'>Сумма с<br>
    учетом <br>
    НДС, <br>
    руб.коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl40 height=57 style='mso-height-source:userset;height:43.35pt'>
  <td height=57 class=xl42 style='height:43.35pt'>&nbsp;</td>
  <td colspan=4 class=xl43 width=209 style='border-left:none;width:158pt'>наименование, характеристика, сорт, артикул товара</td>
  <td class=xl26 style='border-top:none;border-left:none'>код</td>
  <td colspan=4 class=xl43 width=55 style='border-left:none;width:42pt'>наиме-нование</td>
  <td class=xl43 width=44 style='border-top:none;border-left:none;width:33pt'>код по ОКЕИ</td>
  <td colspan=3 class=xl43 width=42 style='border-left:none;width:32pt'>в одном месте</td>
  <td class=xl43 width=55 style='border-top:none;border-left:none;width:41pt'>мест,<br> штук</td>
  <td colspan=3 class=xl43 width=61 style='border-left:none;width:46pt'>ставка, %</td>
  <td colspan=3 class=xl43 width=79 style='border-left:none;width:60pt'>сумма, <br>руб.коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl44 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl45 style='height:11.25pt'>&nbsp;</td>
  <td class=xl46 style='border-top:none' >1</td>
  <td colspan=4 class=xl46 style='border-left:none' >2</td>
  <td class=xl47 style='border-top:none;border-left:none' >3</td>
  <td colspan=4 class=xl46 style='border-left:none' >4</td>
  <td class=xl47 style='border-top:none;border-left:none' >5</td>
  <td class=xl47 style='border-top:none;border-left:none' >6</td>
  <td colspan=3 class=xl47 style='border-left:none' >7</td>
  <td class=xl47 style='border-top:none;border-left:none' >8</td>
  <td colspan=4 class=xl47 style='border-left:none' >9</td>
  <td colspan=2 class=xl47 style='border-left:none' >10</td>
  <td colspan=2 class=xl47 style='border-left:none' >11</td>
  <td colspan=5 class=xl47 style='border-left:none' >12</td>
  <td colspan=3 class=xl46 style='border-left:none' >13</td>
  <td colspan=3 class=xl47 style='border-left:none' >14</td>
  <td colspan=3 class=xl47 style='border-left:none' >15</td>
  <td class=xl44></td>
 </tr>>
    Q ""
]]></Implementation>
</Method>

<Method name="wCols">
<Description>
Вывод колонок </Description>
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
  &html<<col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=34 style='mso-width-source:userset;mso-width-alt:1450;width:26pt'>
 <col class=xl24 width=74 style='mso-width-source:userset;mso-width-alt:3157;width:56pt'>
 <col class=xl24 width=14 style='mso-width-source:userset;mso-width-alt:597;width:11pt'>
 <col class=xl24 width=109 style='mso-width-source:userset;mso-width-alt:4650;width:82pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=71 style='mso-width-source:userset;mso-width-alt:3029;width:53pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=13 style='mso-width-source:userset;mso-width-alt:554;width:10pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=44 style='mso-width-source:userset;mso-width-alt:1877;width:33pt'>
 <col class=xl24 width=41 style='mso-width-source:userset;mso-width-alt:1749;width:31pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=55 style='mso-width-source:userset;mso-width-alt:2346;width:41pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=15 span=2 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=46 style='mso-width-source:userset;mso-width-alt:1962;width:35pt'>
 <col class=xl24 width=15 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=53 style='mso-width-source:userset;mso-width-alt:2261;width:40pt'>
 <col class=xl24 width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <col class=xl24 width=11 style='mso-width-source:userset;mso-width-alt:469;width:8pt'>
 <col class=xl24 width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col class=xl24 width=4 style='mso-width-source:userset;mso-width-alt:170;width:3pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=42 style='mso-width-source:userset;mso-width-alt:1792;width:32pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=17 style='mso-width-source:userset;mso-width-alt:725;width:13pt'>
 <col class=xl24 width=36 style='mso-width-source:userset;mso-width-alt:1536;width:27pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=76 style='mso-width-source:userset;mso-width-alt:3242;width:57pt'>
 <col class=xl24 width=1 style='mso-width-source:userset;mso-width-alt:42;width:1pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col width=64 span=216 style='mso-width-source:userset;mso-width-alt:2730;width:48pt'>>
  Q ""
]]></Implementation>
</Method>

<Method name="wRows">
<Description>
Вывод строк накладной</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc:Docs.Rash,NDSinside,nds,antinds,kurs,*summary:%String=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 Q:'$ISOBJECT(doc) ""  Q:'$IsObject(doc.Items) ""
 
 s ndsprocent=nds*100 if NDSinside="true" s ndsprocent=0
 
 #; основание - документ по гарантии?
 #define BYGARANT 1
 s docid = doc.%Id(), oplid = ##class(Docs.Rash).oplGetStored( docid ) ; Common.Dictionary7 
 s isByGarant = ( oplid = $$$BYGARANT )
 
 s count=0, page=1
 #; для печати корректных разрывов страниц важно знать сколько строк всего
 , allrows = doc.Items.Count() 
 
 s i="" for {  s item=doc.Items.GetNext(.i) Q:i=""  
    
    s count = count + 1 
    
    s:$IsObject(item.Goods) goods=item.Goods.FullName
    
    s itempr=item.Price 
    
    #;Документ по гарантии - цену убираем
    s:isByGarant itempr=0  
    
    s quant=item.Quantity
    
    i NDSinside="false" {
        s price=$J(kurs*itempr,".",2) ;так же как и в счете
        s summabeznds=$J(price*quant,".",2) ;округление
        s ndsotsumma=$J(summabeznds-(summabeznds*antinds),".",2) ;округление
        s summasnds=$J(summabeznds+ndsotsumma,".",2) ;!!! сумма округлений
    } else {
        s nds=0
        s price=$J(kurs*itempr*antinds,".",2)
        s summabeznds=$J(quant*price,".",2)
        s ndsotsumma=$J(summabeznds*nds,".",2)
        s summasnds=summabeznds+ndsotsumma
    }
 
    k row s row("count") = count, row("goods") = goods
    , row("quant") = quant, row("price") = price
    , row("summabeznds") = summabeznds, row("ndsprocent") = ndsprocent
    , row("ndsotsumma") = ndsotsumma,  row("summasnds") = summasnds
    
    d ..wRow(.row) ;сначала выводится строка
    
    #; итого по странице    
    #define pagesum(%name,%val) s page(%name)=$g(page(%name))+%val
    
    $$$pagesum("rowcount",1)    
    $$$pagesum("vsegoquant",quant)
    $$$pagesum("vsegondsotsumma",ndsotsumma)
    $$$pagesum("vsegosummabeznds",summabeznds)
    s vsegosummasnds = $g(page("vsegosummabeznds")) + $g(page("vsegondsotsumma"))
    $$$pagesum("vsegosummasnds", vsegosummasnds)
    
    #; подсчёт итогов по колонкам
    #define summary(%name,%val) s summary(%name)=$g(summary(%name))+%val
    
    $$$summary("rowcount",1)
    $$$summary("vsegoquant",quant)
    $$$summary("vsegondsotsumma",ndsotsumma)
    $$$summary("vsegosummabeznds",summabeznds)
    s vsegosummasnds = $g(summary("vsegosummabeznds")) + $g(summary("vsegondsotsumma"))
    $$$summary("vsegosummasnds", vsegosummasnds)
    
    
    s nextpage = ..gPageAfter(count, allrows)
    
    if nextpage '= page { ;page break detected
             s page = nextpage ;выставляем перед печатью
             d ..OnPageBreak(.page)
             k page ;очистка
             s page = nextpage ;восстановление
    } 
    
 } //закончили вывод строк 
 
 d ..wPageSummary(.page) ;строка итого на последней странице, перед подвалом
 
  
 Q ""
]]></Implementation>
</Method>

<Method name="gPageAfter">
<Description><![CDATA[
Вернет номер страницы после печати строки
<var>row</var> - номер строки, которую уже НАПЕЧАТАЛИ
<var>rows</var> - количество строк в документе.]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>row:%Integer,rows:%Integer</FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
   
    
   #;1. Номер строки меньше первой минимальной. Просто возвращаем 1-цу
   if row < ..#P1MIN Q 1 ;это первая страница
   
   #;2. номер строки больше #P1MIN, но меньше #P1MAX
   #; fp - после какой строки печатать разрыв
   if rows <=..#P1MAX { ;общее количество строк меньше максимума строк для первой без футера 
       s fp = rows-1 ;одну товарную строку отдаем на вторую страницу и печатаем с футером
   } else {
       s fp = ..#P1MAX ;перенос сделаем после максимума первой   
   }
   if row < fp Q 1 ;еще не вышли за границы первой
   
   #;3 Однозначно уже не на первой. Но где?   
   #; Остаток от первой страницы разбиваем на целые последующие страницы
   #; номер страницы после первой: 0 - вторая страница, 1 - третья
   s page = (row - fp)\..#P2MAX 
   
   #;относительно порядковый номер строки внутри этой страницы
   s pn = row - fp - (page * ..#P2MAX) 
   
   #; можно печатать в рамках текущей 
   if pn < ..#P2MIN Q page + 2 ;
   
   #; здесь надо думать 
   s canPrintAtThisPage = ..#P2MAX-pn ;столько строк еще поместится на этой странице
   s hasRowsForPrint = rows-row ; сколько строк осталось печатать до конца документа
   
   if hasRowsForPrint > canPrintAtThisPage {
       Q page + 2 ;продолжаем на этой
   } 
   
   Q page +3 ;пора переходить
]]></Implementation>
</Method>

<Method name="testgPageAfter">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
    s page = "", rows=211
    for i=1:1:rows {
     s nextpage =  ..gPageAfter(i,rows) 
     s:page="" page=nextpage
     w !,page,": ",i," -> ",nextpage
     if page'=nextpage w !,"************",nextpage,"***************"
     s page=nextpage
    }
]]></Implementation>
</Method>

<Method name="OnPageBreak">
<Description>
Вывод итоговой по странице, номера следующей, и шапки таблицы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&page:%String]]></FormalSpec>
<Implementation><![CDATA[
  d ..wPageSummary( .page )  ;выводим итого по странице
  if page > 2 d ..wSpace() ;добираем до полной страницы
  d ..wPageNumber( page ) ;выводим номер новой страницы
  d ..wTablePageHeader() ;и заголовок таблицы
]]></Implementation>
</Method>

<Method name="wSpace">
<Description><![CDATA[
Выводит номер страницы
<var>page</var> - номер страницы]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
  &html<<tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=19 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  </tr><tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=19 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  </tr>>
]]></Implementation>
</Method>

<Method name="wRow">
<Description>
Вывод одной строки накладной </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&row:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
 #define g(%name) $g(row(%name))   
    
 &html<<tr class=xl40 height=29 style='mso-height-source:userset;height:22.35pt'>
 <td height=29 class=xl42 style='height:22.35pt'>&nbsp;</td>
 <td class=xl95 style='border-top:none'>
    #( $$$g("count") )#
 </td><td colspan=4 class=xl105 width=209 style='width:158pt'>
    #( $$$g("goods") )#
 </td><td class=xl48 width=71 style='border-top:none;width:53pt'>&nbsp;</td>
 <td colspan=4 class=xl106>шт</td>
 <td class=xl49 width=44 style='border-top:none;width:33pt'>&nbsp;</td>
 <td class=xl50 style='border-top:none'>&nbsp;</td>
 <td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl53 style='border-top:none'>&nbsp;</td>
 <td class=xl54 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl51 style='border-top:none'>&nbsp;</td>
 <td class=xl53 style='border-top:none'>&nbsp;</td>
 <td colspan=2 class=xl107 width=61 style='border-left:none;width:46pt' >
    #( $$$g("quant") )#
 </td><td colspan=2 class=xl90 style='border-left:none'>
    #( $$$g("price") )#
 </td><td colspan=5 class=xl91 width=88 style='border-left:none;width:66pt'>
    #( $$$g("summabeznds") )#
 </td><td colspan=3 class=xl127>
    #( $$$g("ndsprocent") )#
 </td><td class="xl57" width=26 style='border-top:none;width:20pt;border-left:.5pt solid windowtext;' colspan=3>
    #( $$$g("ndsotsumma") )#
 </td><td colspan=3 class=xl92 width=89 style='border-left:none;width:67pt'>
    #( $$$g("summasnds") )#
 </td><td class=xl40></td>
 </tr>>
    
    #; debug
    #;&html<<tr><td colspan=37><pre>>
    #;zw row
    #;&html<</td></tr>>
   
   Q ""
]]></Implementation>
</Method>

<Method name="wPageSummary">
<Description>
Строка итого после товарных строк</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&summary:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
   
  #define g(%name) $g(summary(%name))
  
  &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl61></td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td colspan=3 class=xl121 style='border-right:.5pt solid black' >Итого<span style='mso-spacerun:yes'> </span></td>
  <td class=xl63 style='border-left:none'>&nbsp;</td>
  <td class=xl65>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl66>&nbsp;</td>
  <td colspan=2 class=xl88 width=61 style='width:46pt'>
    #( $J( $$$g("vsegoquant"), ".", 0) )#
  </td><td colspan=2 class=xl89>Х</td>
  <td colspan=5 class=xl108 width=88 style='width:66pt'>
    #( $J( $$$g("vsegosummabeznds"), ".", 2) )#
  </td><td colspan=3 class=xl109>Х</td>
  <td class=xl68 width=43 style='width:33pt' colspan=2>
    #( $J( $$$g("vsegondsotsumma"), ".", 2) )#
  </td><td class=xl69 width=36 style='width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl93 width=89 style='width:67pt'>
    #($J( $$$g("vsegosummasnds"), ".", 2) )#
  </td><td></td>
 </tr>>
]]></Implementation>
</Method>

<Method name="wSummary">
<Description>
Строка итого после товарных строк</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&summary:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
   
  #define g(%name) $g(summary(%name))
  
  &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td colspan=10 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl123 style='border-right:.5pt solid black'>Всего по накладной<span style='mso-spacerun:yes'> </span></td>
  <td class=xl71 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl73 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl74 style='border-top:none'>&nbsp;</td>
  <td colspan=2 class=xl94 width=61 style='border-left:none;width:46pt'>
    #( $J( $$$g("vsegoquant"),".",0) )#
  </td><td colspan=2 class=xl50 style='border-left:none'>Х</td>
  <td colspan=5 class=xl87 width=88 style='border-left:none;width:66pt'>
    #( $J( $$$g("vsegosummabeznds"),".",2) )#
  </td><td colspan=3 class=xl50 style='border-left:none'>Х</td>
  <td class=xl75 width=26 style='border-top:none;border-left:none;width:20pt'>&nbsp;</td>
  <td class=xl55 width=17 style='border-top:none;width:13pt'>&nbsp;</td>
  <td class=xl57 width=36 style='border-top:none;width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl87 width=89 style='border-left:none;width:67pt'>
    #( $J( $$$g("vsegosummasnds"),".",2) )#
  </td><td></td>
 </tr>
>    
 Q ""
]]></Implementation>
</Method>

<Method name="wFooter">
<Description>
Выводим подвал формы </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>summary</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s DoverennNumber = %request.GetCookie("dv")      //номер доверенности
 s DoverennDatValue = %request.GetCookie("dvdt")  //дата доверенности
 s permitter = %request.Get("otpr") ;s permitter="Креймер А.Я." 
 s executor = %request.Get("otpp") ;s executor="Кашменский Ю.Е."
 
 s CountWords = 1
 s (CountWords(10),CountWords(5),CountWords(2),CountWords(1),CountWords(-1)) = ""
 
   
     &html<<tr class=xl24 height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 colspan=4 class=xl24 style='height:12.0pt;mso-ignore:colspan'></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>Товарная накладная имеет
  приложение на</td>
  <td class=xl76></td>
  <td class=xl77>&nbsp;</td><td class=xl77>&nbsp;</td><td class=xl77>&nbsp;</td><td class=xl77>&nbsp;</td><td class=xl77>&nbsp;</td><td class=xl77>&nbsp;</td>
  <td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td>
  <td colspan=18 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 colspan=4 class=xl24 style='height:11.1pt;mso-ignore:colspan'></td>
  <td class=xl24>и содержит</td>
  <td class=xl78 colspan=2 style='mso-ignore:colspan'>#(##class(Utils.Propis).Write($G(summary("rowcount")),.CountWords))#<!-- Три --></td>
  <td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td><td class=xl78>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td><td class=xl79 style='border-top:none'>&nbsp;</td><td class=xl79 style='border-top:none'>&nbsp;</td><td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td><td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=8 style='mso-ignore:colspan'>порядковых номеров записей</td>
  <td colspan=8 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=27 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=5 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=3 rowspan=3 class=xl78>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span style='mso-spacerun:yes'>     </span>Масса груза (нетто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td colspan=5 class=xl81>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=13 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl24>Всего мест</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span
  style='mso-spacerun:yes'>     </span>Масса груза (брутто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td colspan=5 class=xl111>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=20 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=6 style='mso-height-source:userset;height:5.1pt'>
  <td height=6 colspan=40 class=xl24 style='height:5.1pt;mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl24 style='height:9.75pt'></td>
  <td class=xl24 colspan=5 style='mso-ignore:colspan'>Приложение (паспорта, сертификаты и т.п.) на</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>листах</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl70></td>
  <td class=xl70>По доверенности </td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl85 align=center style='mso-ignore:colspan'>от</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 colspan=6 class=xl24 style='height:10.5pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=9 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:10.35pt'>
  <td height=13 class=xl24 style='height:10.35pt'></td>
  <td class=xl86 colspan=4 style='mso-ignore:colspan'>Всего отпущено на сумму</td>
  <td colspan=10 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=4 class=xl84>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>выданной</td>
  <td class=xl24></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=18 class=xl112 width=575 style='width:434pt'>#(##class(Utils.Propis).Write($G(summary("vsegosummasnds"))))#<!-- Пятьдесят один рубль 00 копеек --></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>кем, кому (организация, должность, фамилия, и.о.)</td>
  <td colspan=14 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 class=xl24 style='height:8.1pt'></td>
  <td colspan=14 class=xl113>прописью</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>>
 
 #;строка с доверенностью
 &html<<tr class=xl24 height=20 style='mso-height-source:userset;height:16pt'>
  
  <td rowspan=2 height=20 class=xl24 style='height:16pt'></td>
  <td rowspan=2 class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза разрешил</td>
  <td rowspan=2 class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td rowspan=2 class=xl129></td>
  <td rowspan=2 class=xl28>&nbsp;</td>
  <td rowspan=2 class=xl28>&nbsp;</td>
  <td rowspan=2 class=xl24></td>
  <td rowspan=2 colspan=10 class=xl130 width=218 style='width:164pt'>#(permitter)# <font
  class="font16">(доверенность #(DoverennNumber)# от #(DoverennDatValue)#)</font></td>
  
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=16 class=xl28>&nbsp;</td>
 </tr>>
 
 &html<<tr class=xl24 height=12 style='mso-height-source:userset;height:9.0pt'>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
 
 &html<<tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.85pt;mso-ignore:colspan'></td>
  <td class=xl131>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl132 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl133>расшифровка подписи</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Груз принял</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>>
 
 &html<<tr height=15 style='height:11.25pt'>
  <td height=15 colspan=6 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl135 style='mso-ignore:colspan'></td>
  <td class=xl24></td>
  <td colspan=10 class=xl136>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>>
 
 &html<<tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза произвел</td>
  <td class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td class=xl129></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=10 class=xl130 width=218 style='width:164pt'>#(executor)#</td>
  <td class=xl24></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan' >Груз получил</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>>
 
 &html<<tr height=15 style='height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl83>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl114>расшифровка подписи</td>
  <td class=xl24></td>
  <td class=xl40 colspan=4 style='mso-ignore:colspan'>грузополучатель</td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>>
 
 &html<<tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl24 style='height:11.25pt'></td>
  <td colspan=2 class=xl70 style='mso-ignore:colspan'></td>
  <td class=xl70>М.П.</td>
  <td class=xl24></td>
  <td class=xl70><!-- &quot;15&quot; --></td>
  <td class=xl28><!-- августа --></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>20___ г</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl85 align=center style='mso-ignore:colspan'>М.П.</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl24 colspan=10 style='mso-ignore:colspan'>&quot;_____&quot; _____________ 20__ г</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
 </tr>>
  
 Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    &html<<!--table
    {mso-displayed-decimal-separator:"\,";
    mso-displayed-thousand-separator:" ";}
@page
    {margin:.16in .2in .16in .2in;
    mso-header-margin:.16in;
    mso-footer-margin:.16in;
    mso-page-orientation:landscape;}
.font16
    {color:windowtext;
    font-size:6.0pt;
    font-weight:700;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;}
tr
    {mso-height-source:auto;}
col
    {mso-width-source:auto;}
br
    {mso-data-placement:same-cell;}
.style0
    {mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    white-space:nowrap;
    mso-rotate:0;
    mso-background-source:auto;
    mso-pattern:auto;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    border:none;
    mso-protection:locked visible;
    mso-style-name:Обычный;
    mso-style-id:0;}
td
    {mso-style-parent:style0;
    padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:windowtext;
    font-size:8.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Arial, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    border:none;
    mso-background-source:auto;
    mso-pattern:auto;
    mso-protection:locked visible;
    white-space:nowrap;
    mso-rotate:0;}
.xl24
    {mso-style-parent:style0;
    text-align:left;}
.xl25
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:middle;}
.xl26
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl27
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0000000;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl28
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl29
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;}
.xl30
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0000000000;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl31
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-weight:0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl32
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;}
.xl33
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl34
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl35
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl36
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl37
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:1.0pt solid windowtext;}
.xl38
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:middle;}
.xl39
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl40
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;}
.xl41
    {mso-style-parent:style0;
    font-style:italic;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    vertical-align:top;}
.xl42
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;
    border:none;}
.xl43
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl44
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:middle;}
.xl45
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:middle;
    border:none;}
.xl46
    {mso-style-parent:style0;
    font-size:7.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl47
    {mso-style-parent:style0;
    font-size:7.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl48
    {mso-style-parent:style0;
    mso-number-format:00000000000;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl49
    {mso-style-parent:style0;
    mso-number-format:0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl50
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl51
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl52
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl53
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl54
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl55
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl56
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;
    white-space:normal;}
.xl57
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl58
    {mso-style-parent:style0;
    text-align:left;
    border:none;}
.xl59
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl60
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl61
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl62
    {mso-style-parent:style0;
    text-align:left;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl63
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl64
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl65
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl66
    {mso-style-parent:style0;
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl67
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl68
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl69
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl70
    {mso-style-parent:style0;
    text-align:right;}
.xl71
    {mso-style-parent:style0;
    text-align:right;
    border:.5pt solid windowtext;}
.xl72
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl73
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl74
    {mso-style-parent:style0;
    text-align:right;
    border-top:.5pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl75
    {mso-style-parent:style0;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl76
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl77
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl78
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl79
    {mso-style-parent:style0;
    text-align:left;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl80
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl81
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl82
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl83
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl84
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl85
    {mso-style-parent:style0;
    text-align:center-across;}
.xl86
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;}
.xl87
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl88
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl89
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl90
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;}
.xl91
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl92
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl93
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl94
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl95
    {mso-style-parent:style0;
    mso-number-format:0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl96
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    white-space:normal;}
.xl97
    {mso-style-parent:style0;
    font-size:9.0pt;
    text-align:left;
    border-top:.5pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl98
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl99
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    white-space:normal;}
.xl100
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl101
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:right;
    border:.5pt solid windowtext;}
.xl102
    {mso-style-parent:style0;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;
    border:.5pt solid windowtext;}
.xl103
    {mso-style-parent:style0;
    font-size:9.0pt;
    mso-number-format:0;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl104
    {mso-style-parent:style0;
    font-size:9.0pt;
    text-align:center;
    vertical-align:middle;
    border-top:1.0pt solid windowtext;
    border-right:1.0pt solid windowtext;
    border-bottom:1.0pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl105
    {mso-style-parent:style0;
    text-align:left;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl106
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl107
    {mso-style-parent:style0;
    mso-number-format:"0\.000";
    text-align:right;
    vertical-align:top;
    border:.5pt solid windowtext;
    white-space:normal;}
.xl108
    {mso-style-parent:style0;
    mso-number-format:Standard;
    text-align:right;
    vertical-align:top;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;
    white-space:normal;}
.xl109
    {mso-style-parent:style0;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:.5pt solid windowtext;}
.xl110
    {mso-style-parent:style0;
    text-align:left;
    border:1.0pt solid windowtext;}
.xl111
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl112
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl113
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl114
    {mso-style-parent:style0;
    font-size:6.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl115
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;}
.xl116
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;}
.xl117
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:middle;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl118
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;}
.xl119
    {mso-style-parent:style0;
    font-size:9.0pt;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl120
    {mso-style-parent:style0;
    border-top:none;
    border-right:1.0pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl121
    {mso-style-parent:style0;
    text-align:center;
    border-top:1.0pt solid windowtext;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl122
    {mso-style-parent:style0;
    text-align:center;
    border-top:1.0pt solid windowtext;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl123
    {mso-style-parent:style0;
    text-align:center;}
.xl124
    {mso-style-parent:style0;
    text-align:center;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl125
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl126
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;}
.xl127
    {mso-style-parent:style0;
    font-weight:700;
    font-family:Arial, sans-serif;
    mso-font-charset:204;
    text-align:center;
    vertical-align:top;
    border-top:.5pt solid windowtext;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:1.0pt solid windowtext;}
.xl128
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl129
    {mso-style-parent:style0;
    text-align:left;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;
    white-space:normal;}
.xl130
    {mso-style-parent:style0;
    font-weight:700;
    text-align:left;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:.5pt solid windowtext;
    border-left:none;
    white-space:normal;}
.xl131
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl132
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center-across;
    vertical-align:top;
    border-top:none;
    border-right:none;
    border-bottom:none;
    border-left:none;}
.xl133
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
.xl134
    {mso-style-parent:style0;
    text-align:left;
    white-space:normal;}
.xl135
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center-across;
    vertical-align:top;}
.xl136
    {mso-style-parent:style0;
    font-size:6.0pt;
    text-align:center;
    vertical-align:top;
    border-top:none;
    border-right:.5pt solid windowtext;
    border-bottom:none;
    border-left:none;}
 -->>
    
 Q ""
]]></Implementation>
</Method>

<Method name="LoadKontr">
<Description>
Загрузка необходимых данных по контрагенту</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[id:%String,&name:%String="",&addr:%String="",&citycode:%String="",&cityname:%String="",&zip:%String="",&pbank,&city,&kpp,&inn,&bik,&rsch,&ksch,&code,&okpo,&okud,&okdp]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  
    #define kontr ##class(Common.Kontragent)
    if '$$$kontr.%ExistsId( id ) Q 1
    s name=$$$kontr.NameGetStored(id), addr=$$$kontr.AddressUrGetStored(id)
    , citycode=$$$kontr.CityCodeGetStored(id), cityname=$$$kontr.CityUrGetStored(id)
    , zip=$$$kontr.PostalcodeUrGetStored(id)
    
    s bankdata=$$$kontr.bankGetStored(id) ;serial object
    s bank = ##class(Common.Bank).%Open($lb(bankdata,"Common.Bank"))
    
    s pbank = bank.pbank, city  = bank.city    , kpp   = bank.kpp,   inn   = bank.inn
    , bik   = bank.bik,   rsch  = bank.rsch    , ksch  = bank.ksch,  code  = bank.code
    , okpo  = bank.okpo,  okud  = bank.okud    , okdp  = bank.okdp
    Q 1
]]></Implementation>
</Method>
</Class>


<Class name="csp.Serials2">
<Description>
Управление гарантийными талонами</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62579,7426.049182</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 &html<<!DOCTYPE html>
<html><head>
<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
<style type='text/css'>
	.ui-widget {font-size:.8em;}
	.ui-state-default {font-weight:normal}
	caption {text-align: left; }
	#edtSearch {font-size:24px;}
</style>

</head><body>
<table class="ui-widget" style="width:98%;padding:0px;margin:0px;" >
<tr><td style="white-space:nowrap">
	<button id="bBack" type="button" title="Вернуться на страницу товаров"
	>Товары</button>
	<button id="bRefresh" title="Обновить раздел">&nbsp;</button>
</td><td colspan="2" class="ui-widget-header" style="width:80%;text-align:center;font-size:18px;">
	Управление серийными номерами
</td><td style="width:15%">&nbsp;
	<!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>-->
</td></tr></table>
<p></p>
<button id="check" type="button" name="check"
	title="Проверка списка серийных номеров" >Проверка серийных номеров</button>
<button id="create" type="button" name="create">Создание серийных номеров из файла</button>
<p></p>

<table class="ui-widget ui-widget-content ui-state-default" >
<caption class="ui-widget-header">Поиск по первым символам номера</caption>
<tr><td><label for="FieldToFind">Искать по:</label></td>
	<td><select id="FieldToFind">
		<option value="serialInd">серийному номеру</option>
		<option value="garantInd">гарантийному номеру</option>
	</select></td>
</tr><tr class="ui-state-active">
	<td><label for="edtSearch">Номер:</label></td>
	<td>
		<input type="text" id="edtSearch" value="" 
			title="Введите минимум два первых символа номера"
		/>
		<button id="bFind">Искать</button>
	</td>
</tr><tr>
		<td><label>Фильтр:</label></td>
		<td>
		 	<label><input type="checkbox" id="HasReqCB" checked="checked"
		 		/><span>Есть заявка</span>
		 	</label>
		 	
		 	<select id="and">
		 	 	<option value="and">И</option>
		 	 	<option value="or">ИЛИ</option>
		 	</select>
		 	
		 	<label><input type="checkbox" id="HasCommentCB" checked="checked" 
		 		/><span>Есть примечание</span>
		 	</label>
		</td>
</tr><tr>
	<td style="vertical-align: top"><label>Показать поля:<label></td>
	<td>
		<div>
		 <label>
		 	<input type="checkbox" id="Property9194CB" checked="checked"/>
		 	<span>Актуальность</span>
		 </label>
		</div>
		<div>
		 <label>
		 	<input type="checkbox" id="CommentCB" checked="checked"/>
		 	<span>Комментарий</span>
		 </label>
		</div>
	</td>
 </tr>
</table>

<table id="resg"></table>
<div id="resb"></div>
	
<div id="DivResult"></div>

<script type="text/javascript" src="common.js"></script>
<script type="text/javascript">

var ColCode="";
sessionid="#(%session.SessionId)#";
var divObj;
var FieldToFindObj;

function Find()
{
	var ShowFields = "";
	var Params = "";
	
	if (CommentCBObj.checked) ShowFields=ShowFields+"Comment;";
	if (Property9194CBObj.checked) ShowFields=ShowFields+"Property9194;";
	if (HasReqCBObj.checked) Params=Params+"HasReq;";
	if (HasCommentCBObj.checked) Params=Params+"HasComment;";
	
	var SearchStr = edtSearch.value;
	ok = #server(..Find(FieldToFindObj.value,SearchStr,ShowFields,Params))#;
	ShowResult(ok);
}

function ShowResult(res)
{
	divObj.innerHTML = res;
}

function edtKeyUp()
{
	if(window.event.keyCode==13) Find();
}

function s(currentrecord)
{
	ok=window.showModalDialog("garant.csp?GarantId="+currentrecord,currentrecord+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function load() {
	divObj = document.getElementById("DivResult");
	FieldToFindObj = document.getElementById("FieldToFind");
	CommentCBObj = document.getElementById("CommentCB");
	Property9194CBObj = document.getElementById("Property9194CB");
	
	HasReqCBObj = document.getElementById("HasReqCB");
	HasReqCBObj.checked = ( GetCookie("HasReqCB")== 'true');
	
	HasCommentCBObj = document.getElementById("HasCommentCB");
	HasCommentCBObj.checked = (GetCookie("HasCommentCB")== 'true');
}

function newitems() {
	ok=window.showModalDialog("ManyGarants.csp",";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function newitem() {
	ok=window.showModalDialog("garant.csp?sessionid="+sessionid,";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}


$(function(){
	
	$("#bBack").button({icons:{primary: "ui-icon-circle-arrow-w"}})
		.click(function(){
			window.location.href='goods.csp';		
	});
	$("#bRefresh").button({icons:{primary:"ui-icon-refresh"},text:false})
		.click(function(){
			window.location.reload();
	});
	$("#check").button({icons:{primary:"ui-icon-check"}})
	.click(function(){
			window.location.href='CheckSerial.csp';
	});
	$("#create").button({icons:{primary:"ui-icon-document"}})
		.click(function(){
			window.open('csp.WarrantyCardImport.cls');
	});

	$("#HasReqCB").click(function(){
		SetCookie('HasReqCB',this.checked);
	});
	$("#HasCommentCB").click(function(){
		SetCookie('HasCommentCB',this.checked);
	});
	$("#edtSearch")
		.css("width","20em")
		.keyup(edtKeyUp)
	;
	
	
	var GRID="#resg",BAR="#resb",JSON="json.serials.cls";
	///Обработчик ответа сервера после удаления талона
	var afterSubmit=function(query,qdata){ 	
		var res=eval(query.responseText); 
		return res;
	};
	$( GRID ).jqGrid({ //Таблица с типами  документов
	 caption: "Результаты поиска"
	 ,url: JSON, editurl: JSON, datatype: "json", jsonReader : { repeatitems: false }
	 ,colModel: [
	  {name:'id', hidden:true}
      , {name:'sn',label:'Серийный', width:150}
      , {name:'gn',label:'Гарантийный', width:150}
      , {name:'st',label:'Актуальность', width:150}
      , {name:'cm',label:'Комментарий', width:250}
  	 ]
  	 , postData: {}
  	 , pager: BAR
  	 , viewrecords:true
  	 , height: 300
  	 , width: 700, autowidth:true
  	 , hidegrid: false
     , gridview:true ,rownumbers:true,viewrecords:true,rowNum:30
     , hoverrows:true ,scroll:1 
     , ondblClickRow: function(rowid){
	     s(rowid) //старый обработчик для просмотра
     }  
  	 
	})
	.jqGrid('navGrid',BAR, 
       {add:false,edit:false
       	,del: true
       	,deltext: "Удалить"
       	,deltitle:"Удалить серийный номер"
       	,view:false,search:false}
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{afterSubmit: afterSubmit} //Удаления
	).jqGrid('navButtonAdd',BAR,{
		caption:"Просмотр"
		, title:"Просмотр выбранного документа ( двойной клик )"
		, buttonicon:"ui-icon-copy"
		, onClickButton: function(){
			var id=$( GRID ).jqGrid("getGridParam","selrow");
			if (id) s(id);
		}
		, position: "first"
	}).jqGrid('navButtonAdd',BAR,{
		caption:"Новые"
		, title:"Создать несколько серийных номеров"
		, buttonicon:"ui-icon-copy"
		, onClickButton: newitems
		, position: "first"
	}).jqGrid('navButtonAdd',BAR,{
		caption:"Новая"
		, title:"Создать один серийный номер"
		, buttonicon:"ui-icon-plus"
		, onClickButton: newitem
		, position: "first"
	})
	;
	
	$( BAR +"_center").remove();
	$( BAR +"_right").css("width","30%");
	$( BAR +"_left").css("width","70%");
	
	
	$("#CommentCB").click(function(){
		SetCookie('SerialsCommentCB',this.checked);
	}).change(function(){
		$(this).prop("checked")?$(GRID).showCol("cm"):$(GRID).hideCol("cm");
	});
	
	$("#Property9194CB").click(function(){
		SetCookie('SerialsProperty9194CB',this.checked);
	}).change(function(){
		$(this).prop("checked")?$(GRID).showCol("st"):$(GRID).hideCol("st");
	});
	
	load();
	$(":checked").parent().addClass("ui-state-highlight");	
	$(":checkbox").change(function(){
		$(this).parent().toggleClass("ui-state-default ui-state-highlight");	
	});
	
	/// Вариант поиска на гриде
	var index="sn"; //индекс по которому будем искать, по умолчанию выбран серийный
	$("#FieldToFind").change(function(){ //следим за выбранным полем для поиска
		index=(index==="sn")?"gn":"sn";
	});
	
	var gridSearch=function(){ //поиск с помощью grid
		var query=$( GRID ).jqGrid("getGridParam","postData");
		
		//сбрасываем предыдущее значение
		delete query.sn; delete query.gn; delete query.cm; 
		delete query.rm; delete query.scm; delete query.sst;
		
		//устанавливаем актуальное
		query._search="true"; //включили режим поиска
		query[index]=$("#edtSearch").val(); //искомое значение
		
		if ( $("#HasReqCB").prop("checked") ) query.rm=1; 		//фильтр по наличию заявки
		if ( $("#HasCommentCB").prop("checked") ) query.cm=1; 	//фильтр по наличию коммментария
		query.and=$("#and").val(); //оператор группировки фильтров
		
		if ( $("#CommentCB").prop("checked") ) query.scm=1; //показывать комментарий
		if ( $("#Property9194CB").prop("checked") ) query.sst=1; //показывать актуальность
		
		$( GRID ).jqGrid("setGridParam","postData",query); //устанавливаем параметры
		$( GRID ).trigger("reloadGrid"); //перезагружаем грид
	};
	
	$("#bFind").button({
		icons: {primary: "ui-icon-search"}
		,text: false
		,title: "Нажмите кнопку для поиска"
		
	}).click( gridSearch ) // было Find
	;
});
</script>
</body></html>>
	Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.ShowLicense">
<Super>%CSP.Page</Super>
<TimeCreated>62352,74679.127192</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 &html<<html>
 <head>
 </head>
 <body><div style="white-space:pre">>
 ;To do...
 d ^ShowLicense
 
 w $system.Version.GetVersion()
 &html<</div></body>
 </html>>
 Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.StatusBar">
<Description>
Замена ActiveX статус-бара на html</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62411,76216.715852</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
s	&html<<html><head><style type="text/css">
	* {margin:0px;padding:0px;border-width:0;}
	body {background-color:buttonface;}
	div {padding: 2px 0px;height:99%;}
	table {border-collapse:collapse;height:16px;}
	td {border:1px solid #999999; color:#444444; font:normal 10px 'Arial';padding:0 3px; cursor:default;}
	#sysmsg {width:300px; height:16px; white-space:nowrap;overflow:hidden;}
	</style>
	<script type="text/javascript">
		function $(id){return document.getElementById(id);};
		window.WriteStatus=function(msg){ 
			var sysmsg=$("sysmsg"); if (!sysmsg) return;
			sysmsg.innerHTML=msg;
		}
	</script>
    </head>
	<body><div id="stbar"><table><tr>
		<td title="Текущий пользователь">#($g(%session.Data("userName")))#</td>
		<td title="Текущий склад">#(%session.Data("depotName"))#</td>
		<td title="Сообщения системы"><div id="sysmsg" /></td>
	</tr></table>
	</div></body>
	</html>>
	Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.StoreSelect">
<Description>
диалог выбора места хранения
для страницы storemodal3.csp (улучшение страницы storemodal2.csp)</Description>
<Abstract>1</Abstract>
<Super>%CSP.Page</Super>
<TimeCreated>62300,35142.765279</TimeCreated>

<Method name="getTempGln">
<Description>
Формирует уникальное имя временного глобала	</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
	Q $na(^CacheTemp.depotTree($P_"^"_$zu(188)))
]]></Implementation>
</Method>

<Method name="wAddressPath">
<Description>
Выводит путь к месту хранения товара на складе</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[depot:%String,tovid:%String,&path:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
  s tovid=$g(tovid) Q:tovid="" ""
  &sql(DECLARE sd CURSOR FOR 
  	SELECT Address,(Value1-Value2) as Amount,%external(Address->block) 
  	INTO :addr,:amount,:block 
  	FROM Store.Quantity 
  	WHERE Goods=:tovid and Address->Depot=:depot
  ) &sql(OPEN sd)
  if SQLCODE=100 w " Товар отсутствует на складе ",depotName Q
  for { &sql(FETCH sd) q:SQLCODE  d
  		w " Местоположение товара ",##class(Store.Action).AddressPath($G(addr))
  		  ," (",amount,") <font color=darkblue>",block,"</font><br>"
  } &sql(CLOSE sd)
  Q ""
]]></Implementation>
</Method>

<Method name="gBlockProp">
<Description>
Выводит настройки отображения для блоков с местами хранения</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>prop:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ 	Q:$g(prop)="" "" Q $G(^Tunes(2,prop,"Value"),"undefined")
]]></Implementation>
</Method>

<Method name="wDepotOptions">
<Description>
Выводит в html options список складов с выделением указанного</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>depot:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
   	
  &sql(DECLARE deprs CURSOR FOR 
  	SELECT ID,Name INTO :id,:name
  	FROM Store.Depot
  	ORDER BY Name 
  ) &sql(OPEN deprs)
  
  for { &sql(FETCH deprs) Q:SQLCODE  
  		w "<option value='",id,"'"
  		w:id=depot " selected='selected' "
  		w ">",name,"</option>"
  } &sql(CLOSE deprs)
]]></Implementation>
</Method>

<Method name="gDepotTree">
<Description>
Собирает дерево склада в глобал с сортировкой по наименованию</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gln:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s depot=@gln ;получаем код склада из глобала
	s root=$na(@gln@("root")), data=$na(@gln@("data")) ;определяем ветки в дереве
	&sql(Declare drs CURSOR For 
    	Select ID,ParentID,Name,Percent
    		Into :id,:parent,:name,:percent
    	From Store.Address
    	Where Depot=:depot
    	-- Сначала узлы верхнего уровня по наименованию --
    	Order By ParentID->Name,Name
    ) &sql(Open drs)
    for { &sql(FETCH drs) Q:SQLCODE
    	if parent="" {
    		s @root@(%ROWCOUNT)=id	
    		s @data@(id,"root")=1
    	} else {
	    	s @data@(parent,"child",%ROWCOUNT)=id
    	}	
    	s @data@(id)=name
    	s @data@(id,"percent")=percent
    } &sql(Close drs)
  	Q ""
]]></Implementation>
</Method>

<Method name="wJsDepotTree">
<Description>
Выводит дерево склада в объект js</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>depot:%String,jsfunc:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
 	s gln=..getTempGln() ;временный уникальный глобал   
 	k @gln ;зачистка на невероятный случай
 	s @gln=depot ;занесли в глобал параметр
    d ..gDepotTree(gln) ;заполнили глобал деревом склада с сортировкой по наименованию
    s rootgl=$na(@gln@("root")) ;ветка с корневыми узлами
    s datagl=$na(@gln@("data")) ;ветка с данными об узлах
    w:jsfunc'="" "parent.",jsfunc,"("
    w "{" ;Открываем js-объект
    d ..wJsDepotNodes(datagl,rootgl)
	w "}"
	w:jsfunc'="" ");"
	k @gln
	Q ""
]]></Implementation>
</Method>

<Method name="wJsDepotNodes">
<Description>
Выводит данные об узлах склада из dgl по отсортированному списку в rgl</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dgl:%String,rgl:%String</FormalSpec>
<Implementation><![CDATA[
	
	#; выводим собранные данные в js - необходимо квотирование
	#define js(%str) ..QuoteJS(%str)
	s next=0
	s rkey="" for { s rkey=$o(@rgl@(rkey)) Q:rkey=""
		s id=$g(@rgl@(rkey)),name=$g(@dgl@(id)),percent=+$g(@dgl@(id,"percent"))
		s:percent name=name_" - "_percent_"%"
    	w:next "," s:'next next=1
     	w id,":[",$$$js(name)
	   	if $d(@dgl@(id,"child")){
		   	w ",{"
			s crgl=$na(@dgl@(id,"child"))
			d ..wJsDepotNodes(dgl,crgl)   	
			w "}"
		}
		w "]"
	}
]]></Implementation>
</Method>

<Method name="gChilds">
<Description>
Собирает данные о дочерних узлах выбранного узла, с сортировкой по наименованию</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dgl:%String</FormalSpec>
<Implementation><![CDATA[
 	
 	 s parent=$g(@dgl@("id")),depot=$g(@dgl@("depot")) k @dgl ;очищаем перед заполнением
 	 if parent'="" s depot=##class(Store.Address).DepotGetStored(parent)
 	 &sql(Declare crs Cursor For 
	 	Select id,name,percent,tempstore,comment
	 	Into :id,:name,:percent,:temp,:comment From Store.Address 
	 	Where 
	 		Depot=:depot --дает гарантию загрузки нужного склада ---
	 		And 
	 		Store.Address_GetParentID(Depot,Code)=:parent 
	 	Order By Name
	 ) &sql(Open crs)
	 for { &sql(Fetch crs) Q:SQLCODE
		s:name="" name=" "
		s @dgl@(name,id)=name,@dgl@(name,id,"percent")=percent
		s @dgl@(name,id,"temp")=temp,@dgl@(name,id,"comment")=comment
	 } &sql(Close crs)
]]></Implementation>
</Method>

<Method name="wChildsHTML">
<Description>
Выводит данные о дочерних узлах в HTML</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parent:%String,depot:%String</FormalSpec>
<Implementation><![CDATA[
	 
   s gln=..getTempGln() k @gln  ;временная глобаль в которую будем собирать данные 
   s parent=$g(parent), depot=$g(depot)
   s @gln@("id")=parent,@gln@("depot")=depot ;входные параметры для отбора
   if parent'="" { ;указан конкретный узел
   	s hasChild=##class(Store.Address).HasChild(parent) ; is leaf?
   	if 'hasChild d ..wPropsHTML(parent) Q 
   }
   d ..gChilds(gln) ;собираем данные
   #; Выводим данные в html
   s key="" for { s key=$o(@gln@(key)) Q:key=""
	  s id="" for { s id=$o(@gln@(key,id)) Q:id=""
		  s name=$g(@gln@(key,id)), percent=$g(@gln@(key,id,"percent"))
		  s temp=$g(@gln@(key,id,"temp")), comment=$g(@gln@(key,id,"comment"))
		  w "<div id='",id,"' class='block" w:temp "temp" w "'"
		  w:comment " title='",comment,"'"
		  w ">",name
		  w "<div style='width:",$s(percent<10:"2em",1:percent_"%;")
		  	,$s(percent>100:"background-color:red;",1:""),"'>"
		  	,percent,"%</div></div>"
	  } 
    }
]]></Implementation>
</Method>

<Method name="wPropsHTML">
<Description>
Выводит свойства листового элемента в таблицу</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<Implementation><![CDATA[
	Q:'##class(Store.Address).%ExistsId(id)
	s obj=##class(Store.Address).%OpenId(id)
	w "<table><thead><th>Свойство</th><th>Значение</th></thead>"
	  ,"<tbody>"
			,"<tr><td>Наименование</td><td>",obj.Name,"</td></tr>"
			,"<tr><td>Состояние</td><td></td></tr>"
			,"<tr><td>Справочная информация</td><td>",obj.Comment,"</td></tr>"
			,"<tr><td>Текущий объем</td><td>",obj.Currentsize,"</td></tr>"
			,"<tr><td>Текущая нагрузка</td><td>",obj.Currentweight,"</td></tr>"
			,"<tr><td>Старый номер</td><td>",obj.oldnumb,"</td></tr>"
			,"<tr><td>Максимальный объем</td><td>",obj.Size1,"</td></tr>"
			,"<tr><td>Скорость доступа</td><td>",obj.speed,"</td></tr>"
			,"<tr><td>Временное хранение</td><td>",obj.tempstore,"</td></tr>"
			,"<tr><td>Максимальная нагрузка</td><td>",obj.Weight,"</td></tr>"
		,"</tbody></table>"
	d obj.%Close() k obj
]]></Implementation>
</Method>

<Method name="ShowChilds">
<Description>
Выводит данные о дочерних узлах в HTML</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parent:%String,depot:%String,jsfunc:%String="alert"</FormalSpec>
<Implementation><![CDATA[
	 w "parent.",jsfunc,"("""
     d ..wChildsHTML(parent,depot)
    w """);"
]]></Implementation>
</Method>

<Method name="OnPage">
<Description><![CDATA[
Event handler for <b>PAGE</b> event: this is invoked in order to  
generate the content of a csp page.]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
 &html<<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html XMLNS:SKLADz><head>
<meta http-equiv="Content-Language" content="ru"><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link href="style.css" type=text/css rel=stylesheet>
<style>
    .vat {vertical-align:top;}
    .temp {background-color: #efefef; } /*места временного хранения*/
	#addrBar {font-color: #447788; }
	#addrBar a {padding:5px;}
	#depotSelect {width:150px;}
	#tblMoveField {border-collapse:collapse;}
	#tblMoveField td {margin:0px;padding:0px;vertical-align:top;}
	#MoveField {height:300px; overflow:auto;margin:0px;padding:3px; border:1px solid #333;}
	#MoveField table {border-collapse:collapse;}
	#MoveField table th,#MoveField table td {padding:2px;border:1px solid #777;}
	#tv {width:250px;height:308px;}
	#tvToggle {width:auto;}
	#dlgBar {text-align:center;margin-left:auto;margin-right:auto;margin-top:20px;}
	#dlgBar button { height:48px; font-size:110%;margin:5px;}
	#addrPath {padding:3px 0px;}
	/*обычное место хранения*/
	.block div {background-color:#ccc;font-size:90%;color:#fff;margin-left:auto;margin-right:auto;}
	.block { margin-bottom:6px; margin-right:6px;font-size:90%; float:left;border:1px solid #777;overflow:hidden;text-align:center; vertical-align:center;
		height:#(..gBlockProp("BlockHeight"))#px;
		width:#(..gBlockProp("BlockWidth"))#px;
	}
</style>>
 #; Инициализация глобальных (для формирования страницы) переменных на стороне сервера
 #; склад - склад из запроса переопределяет склад в сессии
 s depot=$G(%session.Data("depot")), rdepot=%request.Get("depot") if rdepot'="" s depot=rdepot, %session.Data("depot")=depot
 s depotName="склад не найден" s:##class(Store.Depot).%ExistsId(depot) depotName=##class(Store.Depot).NameGetStored(depot)
 #; товар
 s tovid=%request.Get("goods")
 #; путь к изображению
 s imgPath=$g(%session.Data("ImagesPath"))
 w ..HyperEventHead()
 &html<</head><body>
<div id="adressPath">#(..wAddressPath(depot,tovid))#</div>
<div id="addrPath">
<select id="depotSelect" name="depotSelect">>
	  d ..wDepotOptions(depot)
 &html<</select>
<span id="addrBar"></span>
</div>
<table id="tblMoveField"><tr>
	<td id="tdTree">
		<OBJECT id="tv" classid="clsid:C74190B6-8589-11D1-B16A-00C0F0283628" codebase="Cab\MSComCtl.CAB">
		</OBJECT>
		<br/>
		<OBJECT id="tvil" classid="clsid:2C247F23-8591-11D1-B16A-00C0F0283628" codebase="Cab\MSComCtl.CAB">
		</OBJECT>
		<input type="checkbox" id="tvToggle" checked="true"/>
		<label for='tvToggle'>Скрыть/Показать</label>
	</td>
	<td id="tdContent">
		<div id="MoveField">>
		
	d ..wChildsHTML("",depot) ;чтобы сразу показать рутовые узлы выбранного склада 
		
		&html<</div>
	</td>
	</tr>
	<tr><td colspan="2">
		<div id='dlgBar'>
			<button id="btnSelect" title="Выбрать место хранения и закрыть окно">Выбрать</button>
			<button id="btnCancel" title="Отказаться от выбора и закрыть окно">Отмена</button>
		</div>
	</td></tr>
</table>
<script type="text/javascript" src="common.js"></script>
<script language="VBScript" src="js/LoadPicture.vbs"></script>
<script type="text/javascript" src="js/m.js"></script>
<script type="text/javascript" src="js/axtv.js"></script>
<script type="text/javascript" >
//сюда сложим все функции и переменные этой страницы
window.page={
	toChange:null //timeout обработкой смены узла, при быстрой смене узлов клавиатурой
	,scShowChilds: function(nid) { //вызов сервера
		#call(..ShowChilds(nid,depot,"page.ShowChilds"))#; //асинхронно вызываем загрузку схемы выбранного узла	
	}
	,scDepotChange: function(depot){
		#call(..wJsDepotTree(depot,"page.depotChange"))#;
	}
}; 
var depot='#($G(depot))#';
var ColumnHeight='#(..gBlockProp("ColumnHeight"))#';
//Дерево склада в js-объекте
var DepotData=
	#(..wJsDepotTree(depot))#
;
</script>
<script type="text/javascript" src="js/csp.StoreSelect3.js"></script>>
 Write ..HyperEventFrame(),!
 &html<</body></html>>
 Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.StreamServer">
<Description>
wrapper вокруг стандартного стрим-сервера
Обслуживает имя выгружаемого файла
переделан принимать ид Контрагент.Meeting для формирования правильных заголовков
используется в классе json.Kontragent.Meeting
В HTA прилоржении стрим-сервер не справился, рвет сессию</Description>
<Super>%CSP.StreamServer</Super>
<TimeCreated>62696,77159.707457</TimeCreated>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s ID=$g(%request.Data("ID",1)) 
	if ID'="" {
		s (STREAMOID,filename)=""
		&sql(Select Attachment,AttachName Into :STREAMOID,:filename
			From Kontragent.Meeting
			Where ID=:ID
		)
		if filename'=""{
			s filename=..EscapeURL($zcvt(filename,"O","UTF8"))
			d %response.SetHeader("Content-Disposition","attachment; filename="_filename)
		}
		s %request.Data("SOID")=STREAMOID 
	}
	Q 1
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Переопределяем под вывод определенного класса</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s soid=$g(%request.Data("SOID"))
	s stream=##class(%FileBinaryStream).%Open(soid)
	if stream'=$$$NULLOREF {
		Do stream.OutputToDevice()
	}
	Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="csp.WarrantyCard">
<Description>
Управление гарантийными талонами
</Description>
<Super>csp.jqGrid</Super>
<TimeCreated>62503,70781.543634</TimeCreated>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	  Q ""
]]></Implementation>
</Method>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Склад2 :: Гарантийные талоны"
	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	&html<
			
	<a href="goods.csp">Товары</a>&nbsp;&nbsp;&nbsp;
	<a href="serials.csp" >Управление серийными номерами</a>
		<br><br>
		<TABLE cellSpacing=0 width="100%" celpadding="0" >
		<TR>
		<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
		<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Проверка серийных номеров в текстовом файле</strong></TD>
		<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
		</tr>
		</TABLE>
		<br><Br>
	>
	
	d ##super()
	
	 
	Q ""
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  d ##super()
  &html<<script type="text/javascript">
	$(function(){
		var GRID="#grid",BAR="#bar",URL="json.WarrantyCard.cls";
		$(GRID).jqGrid({
			caption: 'Гарантийные талоны'
			,url: URL, editurl: URL
			,datatype: "json",jsonReader : { repeatitems: false }
			,colModel: [
				{name:"id",hidden: true}
				,{name:"sn",label:"Серийный",width:150}
				,{name:"stnm",index: "st", label:"Статус",width:150, search: false}
				,{name:"cm",label:"Прим.",width:300,search:false,sortable:false}
			]
				,pager:BAR 
			,viewrecords:true
			,height:300
			,hidegrid: false
			,gridview:true 
			,rownumbers:true /*номера строк показывать*/
			,rowNum: 30 /*больше запросов, меньше порции*/
			,rownumWidth: 50
			/*,viewrecords:true*/
			/*,scrollrows:true*/,hoverrows:true ,scroll:1
			,ondblClickRow: function(id){
				
			}
 		})
 		.jqGrid('navGrid',BAR, {
	       	add: false
       		, edit:false
       		, del:false 
       		, view: true, viewtext: "Просмотр"
       		, search:false
	       }
	       ,{} //Параметры редактирования
	       ,{} //Параметры добавления
	       ,{} //Параметры удаления
    
	   )
	   .jqGrid('navButtonAdd',BAR,{ 
	   			caption:"Импортировать", buttonicon:"ui-icon-newwin"
	   			, title:"Импортировать из файла и обновить состояние" 
	   			, position: 'first'
	   			, onClickButton: function(){
	   				window.open("csp.WarrantyCardImport.cls");
		   		}
	   })
	   .jqGrid('filterToolbar',{searchOnEnter:false})
	   .jqGrid('gridResize',{});
 	$(BAR+"_center").remove(); //пагинатора не будет
 	$(BAR+"_left").css("width","70%"); //надпись о количестве записей на бОльшую часть футера
 	
	

});
</script>>
  Q ""
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	  q 1

  s login=$G(%session.Data("user"))
  i '+login s %response.ServerSideRedirect="norights.csp" 
  i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
  s Access9func=##class(Common.Rights).getrights(login,9)
  s GoodsGoodsVersion = ##class(Common.Common).GetCurrentDictVersion("Goods.Goods")
  q 1
]]></Implementation>
</Method>
</Class>


<Class name="csp.WarrantyCardImport">
<Description>
Загрузка файла импорта и обновление гарантийных талонов</Description>
<Super>csp.Design</Super>
<TimeCreated>62503,76372.737704</TimeCreated>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Импорт гарантийных талонов"
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	&html<<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
		<style type="text/css">
			.box {height:250px;overflow:auto}
			.box table {table-layout: fixed; border-collapse:collapse; }
			.box table td { padding:1px 3px; border-bottom: 1px dotted #777;border-right: 1px dotted #777;}
		</style>
	>
	Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Q ""
]]></Implementation>
</Method>

<Method name="wLoadForm">
<Description>
Вывод формы загрузки файла</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	&html<<form enctype="multipart/form-data" method="POST" class="ui-widget">
			<table class="ui-widget-content"><caption class="ui-widget-header">
				 Импортировать файл с гарантийными талонами<br/>
				 ( несуществующие будут созданы, существующие обновлены )<br/>
				 и выставить для них указанный статус
				</caption>
			<tr> 
				<td class="ui-state-default">Файл: </td>
				<td><input name="wci" id="wci" type="file" style="width:300px"/></td>
			</tr>
			<tr> 
				<td class="ui-state-default">Cтатус: </td>
				<td><select name="st" id="st">
					<option value="1">действительный</option>
					<option value="2">недействительный</option>
					</select>
				</td>
			</tr>
			<tr>
				<td class="ui-state-default">Опция: </td>
				<td><Input type="checkbox" value="1" name="f" id="f" style="width:15px">
										<label for="f" id="lblf">Принудительная смена статуса</label>
				</td>
			</tr>
			<tr> 
				<td colspan="2"><button style="width:98%;height:48px" type="submit">Импорт</button></td>
			</tr>
			<table>
			В каждой строке файла <font face="courier">серийный номер, комментарий</font> (разделитель - символ табуляции)
		</form>
		>
		Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	s import=$d(%request.MimeData("wci",1)) 
	if 'import Q ..wLoadForm() ;выводим форму для загрузки и выходим
	
	#; получен файл
	s stream=%request.MimeData("wci",1)
	, status=$g(args("st",1)) ;выбранный статус
	, force=+$g(args("f",1))	;принудительная смена статуса
	
	&html<
	<div>Результат импорта данных из файла: 
		<span class="ui-state-highlight">#(stream.FileName)#</span>
	</div> 
	<div>и установки статуса: 
		<span class="ui-state-highlight">#($CASE(status,1:"Действительный",2:"Недействителен",:"Не установлен"))#</span>
	</div>
	<div>c опцией принудительной смены статуса: 
		<span class="ui-state-highlight">#($CASE(force,1:"Да",:"Нет"))#</span>
	</div>
	<div>Получено: #(stream.Size)# байт</div>
	<div class="box ui-widget" >
	<table class="ui-widget-content">
		<tr>
			<td>&nbsp;
			<td>Серийный номер
			<td>Комментарий
			<td>&nbsp;
		</tr>
	>
	s tab=$c(9) ;разделитель
	for { Q:stream.AtEnd
	;для каждой строки файла импорта
		k str s len=32000, str=stream.ReadLine(.len) Q:len<1
		s serial=$p(str,tab)
		s comment=$p(str,tab,2)
		d ..wProcess(serial, comment,status,force)
	} //for
	&html<</table></div><button onclick="window.close()">Закрыть</button>>
	
	Q ""
]]></Implementation>
</Method>

<Method name="wProcess">
<Description>
Обрабатываем прочитанную строку, и выставляем ей статус</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial:%String,comment:%String,status:%Integer,force:%Boolean</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
		
		k class s class="ui-icon" ;класс выводимой строки лога импорта
		k error s error=""		
		
		#; ищем всё через глобалы
		#; найдём ID нужного гарантийного талона
		#; &sql(Select ID,comment Into :id,:txt From Common.Dictionary2 Where Name=:serial )
		k match s match = " "_$ZCVT(serial,"U") ;индекс по текстовому полю, поэтому " "_value
		s ID = $O(^Common.Dictionary2I("serialInd", match,"")) ;жесткая привязка к глобалам
		
		if ID'="" { ; нашли по серийному - обновляем данные
				s class=class_" ui-icon-pencil"  
				s error=..Upgrade(ID,comment,status,force) ;обновляем статус и комментарий
		} else {  ;ID по серийному не найден. Добавляем данные
				s class=class_" ui-icon-plus" 
			 s error=..Insert(serial,comment,status) ;
		}
	
			&html<<tr #($S(error'="":" class='ui-state-error'",1:""))# >		
			<td><div class="#(class)#">&nbsp;</div></td>
			<td>#(serial)#</td>
			<td>#(comment)#</td>
			<td>#($S(error="":"Импорт прошёл успешно",1:error))#</td>
			</tr>>
]]></Implementation>
</Method>

<Method name="Upgrade">
<Description>
Обновление записи</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ID,comment,status,force</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
			
			s oldComment = ##class(Common.Dictionary2).CommentGetStored(ID)
			s dm="" s:(comment'="")||(oldComment'="") dm=" " ;delimeter
			s comment=oldComment_dm_comment 
			#; дописываем коммент в любом случае
			&sql(UPDATE Common.Dictionary2  Set comment=:comment 	Where ID=:ID)
			s error=$$ERR(SQLCODE) Q:error'="" error
			
			s oldStatus = ##class(Common.Dictionary2).Property9194GetStored(ID)
			s oldStatusText = ##class(Common.Dictionary2).Property9194LogicalToDisplay(oldStatus)
						
			if ( oldStatus=$G(status) ) || ( force ) { ; текущее состояние= выбранному режиму или  
				&sql(UPDATE Common.Dictionary2 
						Set Property9194=:status
						Where ID=:ID
				)
				s error=$$ERR(SQLCODE)
			} else {
				s error="Такой номер уже есть в базе, статус до импорта "_oldStatusText_", статус не изменён."	
			}
		 
	  Q error
	  
ERR(sqlcode)
		  if (sqlcode=100) Q error="Система не смогла обновить талон. Нарушение индекса Common.Dictionary2:serialInd"
		  if (sqlcode<0) Q error="Извините, "_$system.SQL.SQLCODE(SQLCODE)
				Q ""
]]></Implementation>
</Method>

<Method name="Insert">
<Description>
Добавление записи</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial,comment,status</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
			s error=""
			&sql(
				INSERT INTO Common.Dictionary2 (Name,Property9194,Comment,serial)
				VALUES (:serial,:status,:comment,:serial)
			)
			if ( SQLCODE'=0 ) s error="Извините, "_$system.SQL.SQLCODE(SQLCODE)
			Q error
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
  	&html<
  	<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
  	<script type="text/javascript" language="javascript">
	$(	function(){
			
			$("#st").change(function(){
				
						var val=$(this).val() //выбранный для установки статус
						
						, str=["Устанавливать статус [ "
								,$("#st option:selected").text()
								," ] <br/> всем найденным записям,<br/> даже если они в статусе [ "
								,(val==1)?"не":""
								,"действительные ]"
						].join("");
						
						$("#lblf").html(str);
					
			}).trigger("change");
				
	});
</script>>
	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="csp.WarrantyCardImport2">
<Description>
Загрузка файла импорта и обновление гарантийных талонов</Description>
<Super>csp.Design</Super>
<TimeCreated>62826,71445.661864</TimeCreated>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w "Импорт гарантийных талонов"
	Q ""
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	&html<<link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
		<style type="text/css">
			.box {height:250px;overflow:auto}
			.box table {table-layout: fixed; border-collapse:collapse; }
			.box table td { padding:1px 3px; border-bottom: 1px dotted #777;border-right: 1px dotted #777;}
		</style>
	>
	Q ""
]]></Implementation>
</Method>

<Method name="wPageHeader">
<Description>
write заголовок на странице</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Q ""
]]></Implementation>
</Method>

<Method name="wLoadForm">
<Description>
Вывод формы загрузки файла</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	&html<<form enctype="multipart/form-data" method="POST" class="ui-widget">
			<table class="ui-widget-content"><caption class="ui-widget-header">
				 Импортировать файл с гарантийными талонами<br/>
				 ( несуществующие будут созданы, существующие обновлены )<br/>
				 и выставить для них указанный статус
				</caption>
			<tr> 
				<td class="ui-state-default">Файл: </td>
				<td><input name="wci" id="wci" type="file" style="width:300px"/></td>
			</tr>
			<tr> 
				<td class="ui-state-default">Cтатус: </td>
				<td><select name="st" id="st">
					<option value="1">действительный</option>
					<option value="2">недействительный</option>
					</select>
				</td>
			</tr>
			<tr>
				<td class="ui-state-default">Опция: </td>
				<td><Input type="checkbox" value="1" name="f" id="f" style="width:15px">
										<label for="f" id="lblf">Принудительная смена статуса</label>
				</td>
			</tr>
			<tr> 
				<td colspan="2"><button style="width:98%;height:48px" type="submit">Импорт</button></td>
			</tr>
			<table>
			В каждой строке файла <font face="courier">серийный номер, гарантийный номер, модель, комментарий</font> (разделитель - символ табуляции)
		</form>
		>
		Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	s import=$d(%request.MimeData("wci",1)) 
	if 'import Q ..wLoadForm() ;выводим форму для загрузки и выходим
	
	#; получен файл
	s stream=%request.MimeData("wci",1)
	, status=$g(args("st",1)) ;выбранный статус
	, force=+$g(args("f",1))	;принудительная смена статуса
	
	&html<
	<div>Результат импорта данных из файла: 
		<span class="ui-state-highlight">#(stream.FileName)#</span>
	</div> 
	<div>и установки статуса: 
		<span class="ui-state-highlight">#($CASE(status,1:"Действительный",2:"Недействителен",:"Не установлен"))#</span>
	</div>
	<div>c опцией принудительной смены статуса: 
		<span class="ui-state-highlight">#($CASE(force,1:"Да",:"Нет"))#</span>
	</div>
	<div>Получено: #(stream.Size)# байт</div>
	<div class="box ui-widget" >
	<table class="ui-widget-content">
		<tr>
			<td>&nbsp;
			<td>Серийный номер
			<td>Гарантийный номер
			<td>Модель
			<td>Комментарий
			<td>&nbsp;
		</tr>
	>
	s tab=$c(9) ;разделитель
	for { Q:stream.AtEnd
	;для каждой строки файла импорта
		k str s len=32000, str=stream.ReadLine(.len) Q:len<1
		s serial=$p(str,tab),garant=$p(str,tab,2),model=$p(str,tab,3),comment=$p(str,tab,4)
		d ..wProcess(serial, garant ,model , comment,status,force)
	} //for
	&html<</table></div><button onclick="window.close()">Закрыть</button>>
	
	Q ""
]]></Implementation>
</Method>

<Method name="wProcess">
<Description>
Обрабатываем прочитанную строку, и выставляем ей статус</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial:%String,garant:%String,model:%String,comment:%String,status:%Integer,force:%Boolean</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
		
		k class s class="ui-icon" ;класс выводимой строки лога импорта
		k error s error=""		
		
		#; ищем всё через глобалы
		#; найдём ID нужного гарантийного талона
		#; &sql(Select ID,comment Into :id,:txt From Common.Dictionary2 Where Name=:serial )
		k match s match = " "_$ZCVT(serial,"U") ;индекс по текстовому полю, поэтому " "_value
		s ID = $O(^Common.Dictionary2I("serialInd", match,"")) ;жесткая привязка к глобалам
		
		if ID'="" { ; нашли по серийному - обновляем данные
				s class=class_" ui-icon-pencil"  
				s error=..Upgrade(ID,garant,model,comment,status,force) ;обновляем статус и комментарий
		} else {  ;ID по серийному не найден. Добавляем данные
				s class=class_" ui-icon-plus" 
			 s error=..Insert(serial,garant,model,comment,status) ;
		}
	
			&html<<tr #($S(error'="":" class='ui-state-error'",1:""))# >		
			<td><div class="#(class)#">&nbsp;</div></td>
			<td>#(serial)#</td>
			<td>#(garant)#</td>
			<td>#(model)#</td>
			<td>#(comment)#</td>
			<td>#($S(error="":"Импорт прошёл успешно",1:error))#</td>
			</tr>>
]]></Implementation>
</Method>

<Method name="Upgrade">
<Description>
Обновление записи</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ID,garant,model,comment,status,force</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
			
			s oldComment = ##class(Common.Dictionary2).CommentGetStored(ID)
			s dm="" s:(comment'="")||(oldComment'="") dm=" " ;delimeter
			s comment=oldComment_dm_comment 
			#; дописываем коммент в любом случае
			&sql(UPDATE Common.Dictionary2  Set comment=:comment 	Where ID=:ID)
			s error=$$ERR(SQLCODE) Q:error'="" error
			
			s oldStatus = ##class(Common.Dictionary2).Property9194GetStored(ID)
			s oldStatusText = ##class(Common.Dictionary2).Property9194LogicalToDisplay(oldStatus)
						
			if ( oldStatus=status ) || ( force ) { ; текущее состояние= выбранному режиму или  
				&sql(UPDATE Common.Dictionary2 
						Set Property9194=:status,tovar=:model,serial=:serial,Name=:garant
						Where ID=:ID
				)
				s error=$$ERR(SQLCODE)
			} else {
				s error="Такой номер уже есть в базе, статус до импорта "_oldStatusText_", статус не изменён."	
			}
		 
	  Q error
	  
ERR(sqlcode)
		  if (sqlcode=100) Q error="Система не смогла обновить талон. Нарушение индекса Common.Dictionary2:serialInd"
		  if (sqlcode<0) Q error="Извините, "_$system.SQL.SQLCODE(SQLCODE)
				Q ""
]]></Implementation>
</Method>

<Method name="Insert">
<Description>
Добавление записи</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>serial,garant,model,comment,status</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
			s error=""
			&sql(
				INSERT INTO Common.Dictionary2 (Name,serial,tovar,Property9194,Comment)
				VALUES (:garant,:serial,:model,:status,:comment)
			)
			if ( SQLCODE'=0 ) s error="Извините, "_$system.SQL.SQLCODE(SQLCODE)
			Q error
]]></Implementation>
</Method>

<Method name="wJs">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
  	&html<
  	<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
  	<script type="text/javascript" language="javascript">
	$(	function(){
			
			$("#st").change(function(){
				
						var val=$(this).val() //выбранный для установки статус
						
						, str=["Устанавливать статус [ "
								,$("#st option:selected").text()
								," ] <br/> всем найденным записям,<br/> даже если они в статусе [ "
								,(val==1)?"не":""
								,"действительные ]"
						].join("");
						
						$("#lblf").html(str);
					
			}).trigger("change");
				
	});
</script>>
	Q ""
]]></Implementation>
</Method>
</Class>


<CSP name="ActFromClient.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 .  s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 
Quit 1
</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
.Kontragent{width:170px;cursor:hand;border:1 solid black}
</style>
<script language="jscript" src="common.js"></script>
<script language="Jscript" type="text/javascript">
var sessionid="#(sessionid)#";

//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj){
newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}

//функция выбора товара
function ChooseTovar(Obj){
newItem=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(newItem==null)return
Goods=newItem.split(StringSplitter)
GoodsAttributes=newItem.split(InnerSplitter);
Obj.innerText=GoodsAttributes[9];
Obj.Tag=GoodsAttributes[0];
}

function startFun()
{
	alert("ещё не реализовано");
}
</script>

<title>	Ручное создание акта технического осмотра от клиента</title>

</head>

<body>

<script language="cache" runat="server">
s DocId=+%request.Get("docid")
s Kontr=325
s KontrName="Проверочный пользователь"
s Tovar = 15549  
s TovarName="MAG-1117 выключатель"
</script>
<br><br>
<fieldset><legend>Общие данные документа</legend>
<table class="LeftTop" cellspacing=0 width=100%>
<tr>
	<td class=RightBottom>Дата<td class=RightBottom><input type=text id="InstDate" value="#($ZD($G(InstDate,$H),4))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)">
	<td class=RightBottom>Контрагент<td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class="Kontragent" onclick="ChooseKonragent(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Kontr" Tag="#($G(Kontr))#">#($G(KontrName))#</span>
</tr>
<tR>
	<td class=RightBottom>Товар оставлен на ответственное хранение<td class=RightBottom><input type="checkbox" value="1">
	<td class=RightBottom>Дата составления акта<td class=RightBottom><input type=text id="InstDate" value="#($ZD($G(InstDate,$H),4))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)">
</tr>
</table>
</fieldset>

<br><br>

<fieldset><legend>Товар</legend>
<table class="LeftTop" cellspacing=0 width=100%>
<tr>
	<td class=RightBottom>Товар<td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class="Kontragent" onclick="ChooseTovar(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Tovar" Tag="#($G(Tovar))#">#($G(TovarName))#</span>
	<td colspan=2 class=RightBottom>&nbsp;
</tr>
<tr>
	<td class=RightBottom>Серийный номер<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
	<td class=RightBottom>Гарантийный номер<td class=RightBottom><input type=text id="Garant" MAXLENGTH=50 Value="#($G(Garant))#">
</tr>
</table>
</fieldset><br><br>

<fieldset><legend>Продавец</legend>
<!-- поправить имена контролов -->
<table class="LeftTop" cellspacing=0 width=100%>
<tR>
	<td class=RightBottom>Наименование продавца<td class=RightBottom><input type=text id="SellerName" MAXLENGTH=50 value="#($G(SellerName))#">
	<td class=RightBottom>Адрес продавца<td class=RightBottom><input type=text id="SellerAddress" MAXLENGTH=50 value="#($G(SellerAddress))#">
</tr>
<tR>
	<td class=RightBottom>Телефон продавца<td class=RightBottom><input type=text id="SellerPhone" MAXLENGTH=50 value="#($G(SellerPhone))#">
	<td class=RightBottom>Дата продажи<td class=RightBottom><input type=text id="SellerDate" value="#($ZD($G(SellerDate,$H),4))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)">
</tr>
</table>
</fieldset><br><br>

<fieldset><legend>Сервисный центр</legend>
<!-- поправить имена контролов -->
<table class="LeftTop" cellspacing=0 width=100%>
<tR>
	<td class=RightBottom>Дата осмотра<td class=RightBottom><input type=text id="ExpertDate" value="#($ZD($G(ExpertDate,$H),4))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)">
	<td class=RightBottom>Дата поступления в ремонт<td class=RightBottom><input type=text id="RemontDate" value="#($ZD($G(RemontDate,$H),4))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)">
</tr>

<tR>
	<td class=RightBottom>Количество ремонтов<td class=RightBottom><input type=text id="RepairsQnt" MAXLENGTH=50 value="#($G(RepairsQnt))#">
	<td class=RightBottom>Классификация дефекта<td class=RightBottom>
		<select id="DefectClass">
			<script language="cache" runat="server">
			w ##class(Docs.Action2).GetDisplaylistOptions($G(DefectClass),"Docs.Act||DefectClass")
			</script>
		</select>
</tr>
<tR>
	<td class=RightBottom>Описание неисправности<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
	<td class=RightBottom>Предполагаемая причина<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
</tr>
<tR>
	<td class=RightBottom>Причина отказа в ремонте<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
	<td class=RightBottom>Заявка по которой не поступили запчасти<td class=RightBottom>
</tr>
</table>
</fieldset><br><br>

<fieldset><legend>Потребитель</legend>
<!-- поправить имена контролов -->
<table class="LeftTop" cellspacing=0 width=100%>
<tR>
	<td class=RightBottom>ФИО потребителя<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
	<td class=RightBottom>Паспортные данные<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
</tr>
<tR>
	<td class=RightBottom>Телефон потребителя<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
	<td class=RightBottom>Контактные данные<td class=RightBottom><input type=text id="Serial" MAXLENGTH=50 value="#($G(Serial))#">
</tr>
</table>
</fieldset>

<center><br>

<CSP:IF condition="DocId=0">
	<sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#">
</CSP:IF>

<sklad:Button onclick="windowclose();" value="Отмена"></center>
</body>
</html>
]]></CSP>


<CSP name="addCard.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADz XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">

<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
Arguments=window.dialogArguments.split(InnerSplitter);
CardId=Arguments[0];
var CurrentProperty;
var Objvalue;
var InCard=false;
var FromTable="";
var FromTree="";
var Number=0;
ExpressType2=""

function startFun(){
name=CardName.value;
if(name==""){alert("Не указано название карточки");return false;}
AllItems=Goods.GetAllItems();
ok=#server(Goods.CardAction.SaveCard(CardId,AllItems,name,Goods.ClassName))#
if(ok==1){returnValue=1;window.close();}
else{alert(ok)}
}

function CopyToGoods(){
	old=TempGoods.ListViewGetItems()
	Goods.ListViewAddItems(old);
}

function load(){
CardName.value=Arguments[1];
Goods.LoadHeaders();
TempGoods.LoadHeaders();
Catalogues.startDownload('Data.csp?class=Goods.Catalogue&fields=ID,Name', putCatalogue);
PropTable.DownLoadPairs("","");
LoadPropTree();
AddGoodsClick(AddGoods.checked);
}

function LoadFromCard(){
if(CardId!=""){
	Goods.GetFromCard(CardId);
	//Goods.loadxml(CardId);
	}

}

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}
function AddGoodsClick(show){
if(!show){TemGoodsFld.style.display="block";InCard=false;}
else{TemGoodsFld.style.display="none";InCard=true;}
}

function LoadTree(){
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+#(%session.Data("depot"))#+'","'+Catalogues.value+'"')	
}

function LoadPropTree(){
Group=ReturnSpace(GroupsTree.NodeCode);
LoadPropTree2("PropsTree","",Group,Catalogues.value)
}

function AddFromGroup(){
TargetElement=SelectTarget();
document.getElementById(TargetElement).GoodsFromGroup(GroupsTree.NodeID);
}

function AddFromSelect(){
TargetElement=SelectTarget();
document.getElementById(TargetElement).LoadGoods(FromTable,FromTree,Number);
}

function TableClick(){
	ExpressType="FromTable";
	CurrentProperty=PropTable.CurrentRowTag;
	Pname.innerText=PropTable.CurrentRowName;
	newObj=PropTable.CurrentRowElement.cloneNode(true);
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function AddExpress(){
	tagNamez=Pvalue.firstChild.tagName;
	if(tagNamez=="DIV"){
		Objvalue=Pvalue.firstChild.Tag;
		if(Objvalue.split("@")[0]==""){Objvalue=Pvalue.firstChild.innerText+Objvalue;}
		}
	if(tagNamez=="SELECT"){Objvalue=Pvalue.firstChild.options(Objec.selectedIndex).text+"@%String";}
	return Objvalue;
}

function TakeValue(){
FrstPart=AddExpress().split("@")[0]
ScndPart=AddExpress().split("@")[1]
//if(ScndPart!="%Date")return FrstPart
if(ScndPart!="%Date")return "'"+FrstPart+"'"
else {
	dateArr=FrstPart.split("/")
	Data=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	return "CAST('"+Data+"' AS DATE)"
}
}

function dork(concatenation){
if(Pname.innerText=="")return false
if(ExpressType2!=ExpressType){
	Express.innerHTML="";
	ExpressType2=ExpressType;
	}
newCaption=Pname.innerText;
newEqual=Pequal.options(Pequal.selectedIndex).text;
newValue=TakeVisibleValue();
newExpression=newCaption+newEqual+newValue;
value=TakeValue();
if(ExpressType=="FromTree"){
	//exp=(CurrentProperty+InnerSplitter+Pequal.value+InnerSplitter+value);
	if(FromTree==""){FromTreeconcatenation="";}
	else{FromTreeconcatenation=concatenation}
	Number++;
	field="t"+Number+".Gvalue"
	if((Pequal.value!="=")&(Pequal.value!="<>")){field="CAST(t"+Number+".Gvalue AS INTEGER)"}
	exp=" (t"+Number+".Param="+CurrentProperty+" and "+field+Pequal.value+value+") "
	FromTree=FromTree+FromTreeconcatenation+ exp;
	}
if(ExpressType=="FromTable"){
	if(FromTable==""){FromTableconcatenation="";}
	else{FromTableconcatenation=concatenation}
	exp=" "+CurrentProperty+Pequal.value+value+" "
	FromTable=FromTable+FromTableconcatenation + exp;
	}
if(Express.innerHTML=="")concatenation="";
if(concatenation=="AND"){concatenation="И"}
if(concatenation=="OR"){concatenation="ИЛИ"}
newString=Express.innerHTML+"<b> "+concatenation+" (</b>"+newExpression+"<b>)</b>"
Express.innerHTML=newString;
}

function TakeVisibleValue(){
	Objec=Pvalue.firstChild;
	if(Objec.tagName=="SELECT")return Objec.options(Objec.selectedIndex).text
	else{return Objec.innerText;}
}

function PropsTreeClick(){
	ExpressType="FromTree";
	CurrentProperty=PropsTree.NodeID;
	Pname.innerText=PropsTree.NodeCaption;
	newObj=CreateDiv("","dsd");
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function SelectTarget(){
if(InCard){lokky="Goods"}
else{lokky="TempGoods"}
return lokky
}

function DelItems(element){
document.getElementById(element).DelItems();
}

function ClearSelect(){
Express.innerText='';
FromTree="";
FromTable="";
Number=0;
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();">
<table height=100% width=100% border=0>
<tr><td colspan=2>
Наименование карточки: <input type=text id=CardName><br>
Добавлять товары сразу в карточку<input type="checkbox" id="AddGoods" onclick="AddGoodsClick(this.checked)" style="border:none;width:15px" checked></td></tr>
<tr ><td width=50% valign="top">
<fieldset><legend>Отбор из группы</legend>
Классификатор:<select id="Catalogues" onchange="LoadTree()" style="behavior:url('#default#download');"></select><br>
  <SKLADz:treeview id="GroupsTree" width=200 height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="LoadPropTree()" onDownloadCmpl="LoadPropTree()" />
<center><sklad:LittleButton name="v2" id="add" onclick="AddFromGroup()" alt="Добавить выделенную группу"></center>
 </fieldset>
</td>
<td width=50% valign="top">
<fieldset><legend>Отбор по параметрам</legend>
<table><tr><td valign=top>
<SKLAD2:table id="PropTable" width=220 height=200 zonTableClick="TableClick()" DisplaySecondCol="none" />
</td>
<td valign=top>
  <SKLADz:treeview id="PropsTree" width=200 height=200 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="PropsTreeClick()" />
</td></tr>
<tr><td width=100% colspan=2 align=center>
	<span id="Pname"></span>&nbsp;&nbsp;
	<select id="Pequal" >
		<option value="=">=</option>
		<option value="<>">&#8800;</option>
		<option value="<">&lt;</option>
		<option value="<=">&lt;=</option>
		<option value=">">&gt;</option>
		<option value=">=">&gt;=</option>
	</select>&nbsp;&nbsp;
	<span id="Pvalue" style="background:#ddffff;width:150px;border:dotted 1 gray">&nbsp;&nbsp;&nbsp;</span></td>
</tr>
<tr><td colspan=2>
	<center><input type="button" value="И" id="Pand" onclick="dork('AND')" style="width:50px"><input type="button" value="ИЛИ" id="Por" onclick="dork('OR')" style="width:50px"><sklad:LittleButton name="del" id="Clear" onclick="ClearSelect();" alt="Очистить поле 'Параметры'"></center>
<fieldset><legend>Параметры отбора</legend>
&nbsp;<span id="Express" style="font:Arial 13;color:#000033"></span>
</fieldset>
</td></tr>
<tr><td colspan=2 align="center"><sklad:LittleButton name="v2" id="add2" onclick="AddFromSelect()" alt="Выбрать товары соответствующие параметрам"></td></tr>
</table>
</fieldset>
</td>
</tr>
<tr><td valign="top"  colspan=2>
<fieldset id="TemGoodsFld"><legend>Выбранные товары</legend>
 <table><tr><td valign=top>
 	<sklad:LittleButton name="del" id="del2" onclick="DelItems('TempGoods')" alt="Удалить выбранные товары">
 	<sklad:LittleButton name="down" id="copy2" onclick="CopyToGoods()" alt="Скопировать список в карточку">
 </td><td width=100%>
 	<SKLADList:listview width=100% height=130 id="TempGoods"  ClassName="Goods.Goods" AddOnClear="false" />
 </td></tr></table>
</fieldset>
<fieldset><legend>Товары в текущей карточке</legend>
 <table><tr><td valign=top>
 	<sklad:LittleButton name="del" id="del1" onclick="DelItems('Goods')" alt="Удалить выбранные товары">
 </td><td width=100%>
	<SKLADList:listview width=100% height=130 id="Goods" ClassName="Goods.Goods" AddOnClear="false" onAddColumns="LoadFromCard()"/>
 </td></tr></table>
</fieldset>
</td></tr>
<tr><td valign=bottom  colspan=2>
<center><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="AddGoodsProp.CSP" application="/csp/sklad2/" default="1"><![CDATA[

<html>
<head><title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
body{font-face: arial; font-size: 12}
</style>
<script language="jscript" src="common.js"></script>
<script language="jscript">
function startFun(){
if(PropDesc.value==""){alert("Не заполнено Наименование свойства");return false;}
if(window.confirm("Создать "+PropDesc.value+"?")==false)return false;
window.returnValue=PropDesc.value;
window.close();
}

</script>
</head>
<body onload="dlgArgs.innerText=window.dialogArguments" onkeypress="ManageWindow()">
<table width=100% cellspacing=10>
<tr><td>
<span id="dlgArgs"></span> </td><td> <input type="text" name="PropDesc" onkeypress="ManageWindow()"><br></td></tr>
<tr><td colspan=2 align="center"><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></td></tr>
</table>

</body>
</html>
]]></CSP>


<CSP name="AddGoodsProp2.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s ClassName=%request.Get("ItemID")
 s havename="false"
 i ClassName'="" d
 . s havename=##class(Common.Common).ClassHaveProperty($G(ClassName),"Name")
 . s havename=$S(havename:"false",1:"true")
 . s ClassObj=##class(Common.Dicts).%OpenId(ClassName)
 . i ' $ISOBJECT(ClassObj) q
 . s ClassDisplayName=ClassObj.Name
 . k ClassObj
</script>

<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head><title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
body{font-face: arial; font-size: 12}
</style>

<script language="Jscript" src="common.js"></script>
<script language="jscript">
var FieldType="%String";
var Res="";
var argArr=window.dialogArguments.split(";");
var ClassName=ReturnSpace(argArr[0]);
var PatternType;
var PatternValue;

function startFun(){
Proper=PropDesc.value;
if(Proper==""){alert("Не заполнено Наименование свойства");return false;}
if(window.confirm("Создасть свойство "+Proper+"?")==false)return false;
if(FieldType=="enumerated"){Res=jhu.ColumnData(0);}
if(!Pattern.checked)PatternFun();
wind=window.open("wait.csp",null,"height=100,width=200,toolbar=no,menubar=no,location=no,titlebar=no")
ok=#server(Goods.GoodsAction.addClassProperty(Proper,Res,FieldType,ClassName,KeyProp.checked,PatternType,PatternValue))#
wind.close();
if(ok==1){returnValue=1;window.close();}
else{alert(ok)}
}

function showflex(){
if (chbx.checked){
	window.dialogHeight="400px";
	document.all.flex.style.display="block";
	FieldType="enumerated";
	}
else{
	document.all.flex.style.display="none";
	window.dialogHeight="300px";
	}
}

function delStr(){
itemz=flexgrid.Row;
if(flexgrid.Rows==1){alert("Невозможно удалить единственную строку");return false;}
flexgrid.RemoveItem(itemz);
}

function DateField(){
	FieldType="%Date";
	showflex();
	showDicts();
}

function DictField(){
	showflex();
	showDicts();
	
}
function showDicts(){
	if (DictFld.checked){
		document.all.dict.style.display="block";
		newItem=window.showModalDialog("Dictionary.csp","Common.Dicts","cener:yes;status:no;dialogHeight:350px;dialogWidth:600px;resizable:yes;");
		if(newItem==null){return false;}
		newArr=newItem.split(InnerSplitter);
		DictName.innerText=newArr[1];
		FieldType=newArr[0];
		Res=newArr[0];
	}
	else{
		document.all.dict.style.display="none";
	}
}

function load(){
	if(ClassName!=""){
		KeyProp.checked=#(havename)#;
		osnprop.style.display="";
		}
}

function PatternClick(show){
if(show){PatternDescr.style.display="inline";window.dialogHeight="420px";}
else{PatternDescr.style.display="none";window.dialogHeight="300px";}
}

function PatternFun(){
if(PatternType2[0].checked){
	PatternType="prohibited";
	PatternValue=CharsProhibit.value;}
if(PatternType2[1].checked){
	PatternType="%Numeric";
	PatternValue="";}
if(PatternType2[2].checked){
	PatternType="%String";
	PatternValue="";}
if(PatternType2[3].checked){
	PatternType="cachepattern";
	PatternValue=CachePattern.value;}
}
</script>

</head>
<body onkeypress="ManageWindow()" onload="load()">
<center><font size=+2>Справочник <b>#($G(ClassDisplayName))#</b></font></center>
<table width=100% cellspacing=10>
<tr><td>Наименование поля: </td><td> <input type="text" name="PropDesc" onkeypress="ManageWindow()"><br></td></tr>
<tr><td>Поле является ссылкой на справочник</td><td> <input type="checkbox" id="DictFld" onclick="DateFld.checked=false;chbx.checked=false;DictField();" style="border:none;width:15px"></td></tr>
<tr id="dict" style="display:none"><td colspan=2 align=center id="DictName"></td></tr>
<tr><td>В поле будет записана дата</td><td> <input type="checkbox" id="DateFld" onclick="chbx.checked=false;DictFld.checked=false;DateField();" style="border:none;width:15px"></td></tr>
<tr><td>Значения поля ограничены списком</td><td> <input type="checkbox" id="chbx" onclick="DateFld.checked=false;DictFld.checked=false;showflex();" style="border:none;width:15px"></td></tr>
<tr id="flex" style="display:none"><td colspan=2 align=center>
<SKLAD2:table id="jhu" width=220 height=100 rows=1 cols=1 />
<sklad:LittleButton id="but21" name="ok" alt="Вставить строку" onclick="jhu.Insrow('')">
<sklad:LittleButton id="but1" name="del" alt="Удалить строку" onclick="jhu.Delrow()"></td></tr>

<tr style="display:none"><td>Тип свойства: смешанный (любые символы)</td><td><input type="checkbox" id="Pattern" style="border:none;width:15px" onclick="PatternClick(!this.checked)" checked></td></tr>
<tr id="PatternDescr" style="display:none"><td colspan=2>
<table>
<tr>
	<td width=15>&nbsp;</td><td><input type="radio" name="PatternType2" style="border:none;width:15px" CHECKED>
	Запрещены к использованию следующие символы:</td><td><input type="text" id="CharsProhibit"></td>
</tr>
<tr>
	<td width=15>&nbsp;</td><td><input type="radio" name="PatternType2" style="border:none;width:15px">
	Используются только цифры:</td><td></td>
</tr>
<tr>
	<td width=15>&nbsp;</td><td><input type="radio" name="PatternType2" style="border:none;width:15px">
	Используются только символы:</td><td></td>
</tr>
<tr style="display:none">
	<td width=15>&nbsp;</td><td><input type="radio" name="PatternType2" style="border:none;width:15px">
	Используется шаблон:</td><td><input type="text" id="CachePattern"></td>
</tr>
</table>
</td></tr>

<tr id="osnprop" style="display:none"><td>Это поле является главным</td><td> <input type="checkbox" id="KeyProp" style="border:none;width:15px"></td></tr>
<tr><td colspan=2 align="center"><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></td></tr>
</table>

</body>
</html>
]]></CSP>


<CSP name="addTovar.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
 s Access9func=##class(Common.Rights).getrights(login,9)
 if 'Access9func s Func9Refuse="return;"
 q 1
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var NodeData = new Array();

Arguments=window.dialogArguments.split(InnerSplitter);
if(Arguments[1]==null){alert("Не указана группа товара!");}
Catalogue=ReturnSpace(Arguments[0]);
GroupId=  ReturnSpace(Arguments[1]);
GroupCode=ReturnSpace(Arguments[2]);
GoodsId=  ReturnSpace(Arguments[3]);
GroupName=ReturnSpace(Arguments[4]);
//Классификатор+InnerSplitter+IDГруппы+InnerSplitter+КодГруппы+InnerSplitter+IDТовара

function startFun(){
if(GoodsId!=""){question="Внести изменения?"}
else{question="Создать товар?"}
if(!window.confirm(question))return false;
NamesStr=PropTable.names;
RowDataStr=PropTable.ColumnData(1);
NodesStr=trViewProp.IDsStr;
NodesDataStr=trViewProp.ValuesStr;
TypesStr=PropTable.ColumnTypes(1);
ok=#server(Goods.GoodsAction.SaveGoods(GroupId,NamesStr,RowDataStr,TypesStr,NodesStr,NodesDataStr,GoodsId))#
if(ok==1){returnValue=1;window.close();}
else{alert(ok);}
}

function LoadList(){
PropTable.DownLoadPairs('',GoodsId,"FullName,ModelNumber","","Tovar");
LoadPropTree2("trViewProp",GoodsId,GroupCode,Catalogue);
}
function load(){
LoadList()
trViewProp.onClick="Click()"
GrupName.innerText=GroupName;
}

function Click(){
NodeDatastrLayer.style.display="inline";
NodeDatastrText.innerText=trViewProp.NodeCaption;
NodeDatastr.value=trViewProp.NodeValue;
NodeDatastr.focus();
}

function ConvertArray(Arr){
res=""
for (z = 0; z < Arr.length; z++){
  res=res+Arr[z]+"~";
}
return res;
}

function ManageTextBox(element){
if(window.event.keyCode==13){okTextBox(element);}
if(window.event.keyCode==27){cancelTextBox(element);}
}

function okTextBox(element){
	document.getElementById(element+"Layer").style.display="none";
	trViewProp.NodeValue=ReturnSpace(document.getElementById(element).value);
}
function cancelTextBox(element){
	document.getElementById(element+"Layer").style.display="none";
}
function ManageWindow2(element){
if(event.srcElement.tagName=="INPUT")return false;
if(window.event.keyCode==13)
	{
	#($G(Func9Refuse))#
	startFun();
	}
if(window.event.keyCode==27)windowclose();
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow2();">
<center><h3>Группа <span id="GrupName"></span></h3></center>
<table cellpadding=0 cellspacing=0 width=100% border=0><tr>
<td width=50% align=center valign=top>
<fieldset style="width:250px"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width=350 height=400 Silent="Price"/>
</fieldset>
</td>
<td width=50% align=certer valign=top>
<fieldset style="width:215px"><legend>Дополнительные свойства</legend>
<SKLADz:treeview id="trViewProp" width=200 height=400 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" border=0 />
</fieldset>
</td></tr>
<tr><td colspan=2 align=center style="height:28px;" valign=middle><div id="NodeDatastrLayer" style="display:none"><span id="NodeDatastrText"></span>&nbsp;<input type="text" id="NodeDatastr" onkeypress="ManageTextBox(this.id);">
<sklad:LittleButton name="ok" id="okBut" onclick="okTextBox('NodeDatastr')">
<sklad:LittleButton name="del" id="cancelBut" onclick="cancelTextBox('NodeDatastr')">
</div><img src="images/brace.gif" width=1 height=19></td></tr>
<tr><td colspan=2 align=center>
	<CSP:IF CONDITION="Access9func=1">
		<sklad:Button value="Да" onclick="startFun()">
	</CSP:IF>	
	&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="windowclose()"></td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="addZone.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<title>#($G(%session.Data("systemname")))#</title>
<script language="jscript" src="common.js"></script>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript">
var args=window.dialogArguments.split(";");
code=args[0];
sub=args[1];
function startFun(){
	if(!window.confirm("Создать?"))return false;
	if(Name.value==""){alert("Не указано наименование");return false;}
	quant=Quant.value;
	name=Name.value;
	comment=txtComments.value;
	ok=#server(Store.Action.CreateLevel(name,quant,code,sub,comment,"",sta.value))#
	if(ok!=1){alert(ok);}
	else
	{
		window.returnValue=1;
		window.close();
	}
}
</script>
</head>
<body onkeypress="ManageWindow()">
<Table width=100%>
<tr><td>Наименование</td><td><input type="text" id="Name" name="Name"></td></tr>
<!--<tr><td>Требуется прорисовка</td><td><input style="border:none" type="checkbox" id="Draw"></td></tr>-->
<tr><td>Количество ячеек </td><td><input type="text" id="Quant" value=1> нумерация с <input type="text" id="sta" value=1></td></tr>
<tr><td>Пояснение</td><td><TEXTAREA STYLE="overflow:auto;border:solid 1 grey;" ID=txtComments rows=3 cols=40></TEXTAREA></td>
<!--
<tr><td>Временное хранение</td><td><input type=checkbox id=tempstore></td>
<!--
<tr><td colspan=2>
<INPUT type=radio name="rad" CHECKED >маленький 1 (3981,3)
<INPUT type=radio name="rad" >маленький 2 (4516,8)
<INPUT type=radio name="rad" >большой (21840)
<INPUT type=radio name="rad" >не указывать
</td></tr>
-->
<tr><td colspan=2 align="center"><br><sklad:ButtonDiv value="Да" onclick="startFun();"><sklad:ButtonDiv onclick="window.close()" value="Отмена"></td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="AnalogForm.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<csp:class includes="xmlmacros">
<script language="Cache" runat="server">
 s id=%request.Get("id")
 
 if (id'="")
 {
	 s newObj = ##class(Common.Dictionary4).%OpenId(id)
	 
	 if $ISOBJECT(newObj)
	 {
		 if $ISOBJECT(newObj.Name)
		 {
			 s Name=newObj.Name.FullName
			 s NameId=newObj.Name.%Id()
		 }
		 
		 if $ISOBJECT(newObj.Name)
		 {
			 s Property6625=newObj.Property6625.FullName
			 s Property6625Id=newObj.Property6625.%Id()
		 }
		 k newObj
	 }
	 else
	 {
		 s Property6625="Ошибка при извлечении значения"
		 s Name="Ошибка при извлечении значения"
	 }
 }
</script>
<script language="Cache" method="SetAnalog" arguments="id,Tovar,Analog" returntype="%String">
 if (id'="") s newObj = ##class(Common.Dictionary4).%OpenId(id)
 else  s newObj = ##class(Common.Dictionary4).%New()
 
 if (id'=""),'$ISOBJECT(newObj) q "Извините, не удалось получить данные по объекту "_id
 
 d newObj.NameSetObjectId(Tovar)
 d newObj.Property6625SetObjectId(Analog)
 
 s ok = newObj.%Save()
 if '+ok $$$WriteObjError(ok)
 Quit ok
</script>
<html>
<head>

<title>	Аналоги </title>
<script language="jscript" src="common.js"></script>
<script language="javascript" type="text/javascript">
var TovarId="#($G(NameId))#";		//ID товара
var AnalogId="#($G(Property6625Id))#";	//ID аналога
var id="#(id)#";

//функция выбора товара
function AddGoods()
{
	newItem=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;");
	if (ReturnSpace(newItem)=="")return;
	newItemArray = newItem.split("~");
	document.getElementById("tbGoods").value=newItemArray[10];
	TovarId = newItemArray[0];
}

//функция выбора аналога
function AddAnalog()
{
	newItem=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;");
	if (ReturnSpace(newItem)=="")return;
	newItemArray = newItem.split("~");
	document.getElementById("tbAnalog").value=newItemArray[10];
	AnalogId = newItemArray[0];
}

//обработка кнопки записать - установить соответствие в базе товара и его аналога
function SetAnalog()
{
	if (TovarId==""){alert("Пожалуйста, укажите товар (запчасть)");return;}
	if (AnalogId==""){alert("Пожалуйста, укажите аналог");return;}
	var ok = #server(..SetAnalog(id,TovarId,AnalogId))#
	
	if (isNaN(ok))
	{
		alert(ok);
	}
	else
	{
		alert("Аналог успешно записан.");
		window.close();
	}
}
</script>
<link href="style.css" type=text/css rel=stylesheet>
</head>

<body>
<center><h2>Аналоги</h2></center>

<table>
<tr>
	<td>Товар (запчасть)
	<td><input type="text" size="200" id="tbGoods" onclick="AddGoods()" style="width=300;cursor=hand;" value="#($G(Name))#" onmouseover="this.style.background='#dedece';" onmouseout="this.style.background='#ffffff';">
<tr>
	<td>Аналог
	<td><input type="text" id="tbAnalog" onclick="AddAnalog()" style="width=300;cursor=hand;" value="#($G(Property6625))#" onmouseover="this.style.background='#dedece';" onmouseout="this.style.background='#ffffff';">
<tr>
	<td colspan=2><bR><bR>
		<input type="button" value="Записать" onclick="SetAnalog()">
		<input type="button" value="Отмена" onclick="windowclose()">
</table>

</body>
</html>
]]></CSP>


<CSP name="analyzis.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,17) s %response.ServerSideRedirect="norights.csp" 
 
 s YearBeginDate = "01/01/"_(+$ZD($H,3))
 q 1
</script>

<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.Kontragent{width:230px;cursor:hand;border:solid 1 black}
.ta{border-left:1.0pt solid windowtext;border-top:1.0pt solid windowtext;}
.td{border-right:1.0pt solid windowtext;border-bottom:1.0pt solid windowtext;}
</style>

<script language="Jscript" src="common.js"></script>
<script language="JavaScript" type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
<script language="JScript">
sessionid="#(%session.SessionId)#";
login="#(%session.Data("login"))#";
var goodspars="";
var docparams="";

// разбор ItemID и вывод документа на печать
function PrintDocument(ItemID)
{
var docid = ItemID.split("@")[0];
var docclass = ItemID.split("@")[1];
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;	
window.open(url);
}

function ff(){
var DocName=report.item("TypDoc")
 var idclass=report.ItemID;
 if(ReturnSpace(idclass)=="")return;
 var arr=idclass.split("@")
 if(arr.length>1){
	 WinResult=window.showModalDialog("document.csp?silent=true",arr[1]+InnerSplitter+arr[0]+InnerSplitter+DocName,"cener:yes;status:no;dialogHeight:600px;dialogWidth:600px;resizable:yes;")
	 }
 }
 
function load(){
depotelem.startDownload('Data.csp?class=Store.Depot&fields=ID,Name', put);
PropTable1.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
PropTable.DownLoadPairs("","","Doc,DocType,Goods,Quantity,Price,Total,quantplan,Comment,kurs,dopperc");
//typdocs.DownLoadPairs("","","meas");
Rep9SelectFn()
}
 
function put(textStr){
addOptions(textStr,"depotelem");
var oOption = document.createElement("OPTION");
depotelem.options.add(oOption);
oOption.innerText = "Все склады";
oOption.value = "";
}

//отчет о приходе расходе
function show(){
var kontr=PropTable1.item("Kontr")
report.loadfrommethod("Reports.Analyzis.prihrash",dat1.value+"@"+dat2.value,depotelem.value,kontr)
rep1.checked=false;
}

//отчет об остатках
function showost(){
var addr=PropTable.item("addr");
rep2.checked=false;
report2.loadfrommethod("Reports.Analyzis.ostatok",addr)
}

//прогноз обнуления остатков
function shownull(){
rep3.checked=false;
report3.loadfrommethod("Reports.Analyzis.nullost",rep4dat1.value)
}

//показать документы по аттрибутам товара
function showdocs(){
if(goodspars==""){alert("Не установлены параметры товаров для отбора");return}
rep4.checked=false;
report4.loadfrommethod("Reports.Analyzis.docsbytovs",rep4dat1.value+"@"+rep4dat2.value,goodspars,Rep4DocsSelector.value)
}

//показать документы по указанным аттрибутам
function showdocs2(){
if(docparams==""){alert("Не установлены параметры документов для отбора");return}
rep5.checked=false;
report5.loadfrommethod("Reports.Analyzis.docsbypars",doctyp,docparams,rep5dat1.value+"@"+rep5dat2.value)
}

//показать скрыть 
function showhide(but){
var replist="";
if(but=="rep1")replist="report";
if(but=="rep2")replist="report2";
if(but=="rep3")replist="report3";
if(but=="rep4")replist="report4span";
if(but=="rep5")replist="report5";
if(but=="rep6")replist="report6";
if(but=="rep7")replist="report7";
if(but=="rep8")replist="report8";
if(but=="rep9")replist="report9";
if(but=="rep10")replist="report10";
if(but=="rep11")replist="report11";
if(replist=="")return
if(document.getElementById(replist).style.display=="none"){document.getElementById(replist).style.display="block";}
else{document.getElementById(replist).style.display="none";}
}

function rep4help(){
goodspars=window.showModalDialog("selgoodsparams.csp","","center:yes;status:no;dialogHeight:370px;dialogWidth:600px;resizable:yes;");
goodspars=ReturnSpace(goodspars);
}

//открыть карточку товара
function gcard(tovid){
	alert(tovid)
if(ReturnSpace(tovid)=="")return
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+tovid+"&groupspath="+"",tovid+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
}

// открыть окно с параметрами документа
function rep5params(){
doctyp=typDocsSel.value;
if(doctyp==""){alert("Не указан тип документа");return}
docparams=window.showModalDialog("seldocparams.csp?docclass="+doctyp,"","center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
docparams=ReturnSpace(docparams);
}

function showReport6(){
report6.loadfrommethod("Reports.Analyzis.Zapchasti",rep6dat1.value+"@"+rep6dat2.value,rep6models.value,rep6group.value)
}

//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj){
newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}

function GoodsForRep7(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
var TovarsString="";
var IDsString="";
var TovarsArray=WinResult.split(StringSplitter)
for(var i=0; i<TovarsArray.length-1; i++) 
	{
	var SingleTovarArray=TovarsArray[i].split(InnerSplitter)
	var IDsString=IDsString+","+SingleTovarArray[0];
	var TovarsString=TovarsString+" "+SingleTovarArray[8];
	}
Rep7TovarNames.innerText=TovarsString;
Rep7TovarNames.Tag=IDsString;
}

function showReport7(){
var Dates=rep7dat1.value+"@"+rep7dat2.value;
var TovarIDs=Rep7TovarNames.Tag
var KontrID=Kontr.Tag
report7.loadfrommethod("Reports.Analyzis.OtpravkaKontragentu",Dates,TovarIDs,KontrID)
}

function showReport8(){
var Dates=rep8dat1.value+"@"+rep8dat2.value;
report8.loadfrommethod("Reports.Analyzis.ShowInactiveKontr",Dates,"","")
}

//функции отчёта "Прогноз остатков"
	function showReport9(){
		Dates=rep9dat1.value+"@"+rep9dat2.value;
		rep9.checked=false;
		RepTypeGoodsAbbr=Rep9Select.value+"@"+Rep9abbr.value;
		#call(Reports.Analyzis.NullOstatokForecastPrepare(Dates,RepTypeGoodsAbbr,login))#
		Rep9TimerID = window.setInterval(LookUpRep9, 2000)
	}

	function LookUpRep9(){
		var answer=#server(Reports.Analyzis.NullOstatokForecastLookUp(login))#
		var command = answer.substr(0, 4);
		if(command=="stop")
			{
			window.clearInterval(Rep9TimerID);
			report9.loadfrommethod("Reports.Analyzis.NullOstatokForecastShow",Dates,Rep9Select.value,login)
			var answer=answer.substr(4, answer.length);
			}
		Rep9Result.innerHTML=answer+"<br>";
	}

	function Rep9SelectFn(){
		if(Rep9Select.value=="term"){var color="#000000";}
		else{var color="#aaaaaa";}
		Rep9Term.style.color=color;
		rep9dat1.style.color=color;
		rep9dat2.style.color=color;
	}

//Отчёт "Контроль сроков обработки"
function showReport10(){
rep10.checked=false;
var Dates=rep10dat1.value+"@"+rep10dat2.value;
var Term=Rep10Select.value+"@"+rep10term.value;
var ShowAllInstr=Rep10checkbox.checked;
report10.loadfrommethod("Reports.Analyzis.SendTermControl",Dates,Term,ShowAllInstr)
if(ShowAllInstr){Rep10Legend.style.display="block";}
else{Rep10Legend.style.display="none";}
}

//Отчёт "Запчасти которые требовал клиент и которые не были отправлены"
function showReport11()
{
	rep11.checked=false;
	var Dates=rep11dat1.value+"@"+rep11dat2.value;
	report11.loadfrommethod("Reports.Analyzis.ShowGoodsZeroSent",Dates,"",login)
}

function showReport12(){
window.open("Report12.csp?ContentType="+rep12select.value+"&showdate="+"rep12cb.checked"+"&Dat1="+rep12dat1.value+"&Dat2="+rep12dat2.value+"&sessionid="+sessionid);
}

function showReport13(){
window.open("Report13.csp?ContentType="+rep13select.value+"&Dat1="+rep13dat1.value+"&Dat2="+rep13dat2.value+"&sessionid="+sessionid);
}

function showReport14()
{
window.open("Report14.csp?ContentType="+rep14select.value+"&sessionid="+sessionid+"&Rezerv="+rep14Rezerv.checked+"&Catalogue="+rep14CatalogueSelect.value);
}

function showReport15()
{
	var url = "Report15.csp?ContentType="+rep15select.value+"&sessionid="+sessionid+"&Dat1="+rep15dat1.value+"&Dat2="+rep15dat2.value+"&State="+rep15Select.value;
	window.open(url);
}
</script>
</head>
<body onload="load();">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=3><strong>Аналитика</strong></TD>
<td width=10%></td>
</tr>
</table>
<table width=100%><tr><td>Приход/расход за период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select style="width:150px" id="depotelem" style='behavior:url(#default#download)'></select>
<SKLAD2:table id="PropTable1" width=260 ClassName="Docs.Super" />
<sklad:LittleButton name="ok" id="okbut" onclick="show()" alt="Показать документы">
<td align="right">скрыть <input type="checkbox" style="border:0;width:15" id="rep1" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report" style="display:none" onMethodComplite="this.style.display=''" ClassName="Operation.Instructions" zonDblClick="ff()"/><br>


<hr width=80%>1
<table width=100%><tr><td><nobr>Текущий остаток </nobr><td><SKLAD2:table id="PropTable" width=260 ClassName="Docs.InventItems" /><td><sklad:LittleButton name="ok" id="okbut2" onclick="showost()" alt="Показать остатки">
<td align="right" width=100%>скрыть <input type="checkbox" style="border:0;width:15" id="rep2" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report2" style="display:none" onMethodComplite="this.style.display=''" zonDblClick="gcard(this.ItemID)"/><br>


<hr width=80%>2
<table width=100% ><tr><td align=left>Поиск 
<select id="Rep4DocsSelector">
<option value="">Всех документов</option>
<option value="Brak">Документов брака</option>
</select> за период c <input type=text id="rep4dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="rep4dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по атрибутам товаров <input type="button" value="установить значения свойств" onclick="rep4help();"><sklad:LittleButton name="ok" id="okbut4" onclick="showdocs()" alt="Показать остатки">
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep4" CHECKED onclick="showhide(this.id)">
</table>
<span id="report4span" style="display:none">
<SKLADList:listview width=100% height=200 id="report4" onMethodComplite="report4span.style.display=''" zonDblClick="PrintDocument(this.ItemID)"/><br>
<br><font size="3" color="lightgrey">Двойной клик откроет форму печати документа</font>
</span>

<hr width=80%>3
<table width=100% ><tr><td align=left>Прогноз обнуления остатков на дату <input type=text id="dat3" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"><sklad:LittleButton name="ok" id="okbut3" onclick="shownull()" alt="Показать прогноз">
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep3" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report3" style="display:none" onMethodComplite="this.style.display=''" zonDblClick="gcard(this.ItemID)"/><br>

<hr width=80%>4
<table width=100% ><tr><td align=left>Поиск  за период c <input type=text id="rep5dat1" value="" onclick="fnCalendar(this)" class="datar"> по <input type=text id="rep5dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> 
<select id="typDocsSel" >
<script language="cache" runat="server">
 w ##class(Docs.Action2).GetClassValuesOptions("","Docs.Docs")
</script>
</select>
<input type="button" value="Параметры" onclick="rep5params()">
<sklad:LittleButton name="ok" id="okbut5" onclick="showdocs2()" alt="Вывести документы">
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep5" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report5" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>5
<table width=100% ><tr><td align=left>Отправка запчастей за период c <input type=text id="rep6dat1" value="" onclick="fnCalendar(this)" class="datar"> по <input type=text id="rep6dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">  
Объединять марки <input type="text" id="rep6models"> в название <input type="text" id="rep6group">
<sklad:LittleButton name="ok" id="okbut6" onclick="showReport6()" alt="Вывести документы">
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep6" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report6" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>6
<table width=100% ><tr><td align=left>Отправка <span title="Указать запчасти отправку которых необходимо проследить" onmouseout="UnPaint(this)" onclick="GoodsForRep7()" onmouseover="Paint(this)" style="cursor:hand">запчастей</span>  за период c <input type=text id="rep7dat1" value="#($ZD($H,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep7dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">  
Клиенту <span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class=Kontragent onclick="ChooseKonragent(this)" id="Kontr" Tag="" title="Указать клиента, что бы очистить поле нажмите правую кнопку мыши" oncontextmenu="this.innerText='';this.Tag=''"></span>
<sklad:LittleButton name="ok" id="okbut7" onclick="showReport7()" alt="Вывести отчёт">
<br>
<span title="Указать запчасти отправку которых необходимо проследить" Tag="">Запчасти выбранные для ремонта:</span> <span  onclick="GoodsForRep7()" id="Rep7TovarNames"  onmouseout="UnPaint(this)" onmouseover="Paint(this)" style="border:solid 1 black;cursor:hand" Tag="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep7" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report7" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>7
<table width=100% ><tr><td align=left>Список контрагентов которые не заказывали запчасти c <input type=text id="rep8dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep8dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">  
<sklad:LittleButton name="ok" id="okbut8" onclick="showReport8()" alt="Вывести отчёт">
<br>
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep8" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report8" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>8
<table width=100%><tr><td align=left>
Прогноз обнуления остатков <br>
<span id="Rep9Result"></span>
<table border=0 class="ta" cellspacing=0 ><tr>
<td class="td">
	<select id="Rep9Select" onchange="Rep9SelectFn()"><option value="term">Указать период</option><option value="winter">Зима</option><option value="summer">Лето</option><option value="year">Год</option></select>
	<span id="Rep9Term"> период c <input type=text id="rep9dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep9dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> </span>
</td>
<td class="td">
	Начальные буквы аббревиатуры <input type="text" id="Rep9abbr" style="width:40px">
</td>
<td class="td">
	<sklad:LittleButton name="ok" id="okbut9" onclick="showReport9()" alt="Вывести отчёт">
</td>
</tr></table>
<br>
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep9" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report9" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>9
<table width=100%><tr><td align=left>
Контроль сроков обработки заявки <sklad:LittleButton name="help2" id="help10" onclick="window.open('help/index.html?AnalyzSendTermControl.html')" alt="Помощь по отчёту"><br>
<table class="ta" cellspacing=0>
<tr>
	<td class="td">
		Период c <input type=text id="rep10dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar" title="Начальная дата для выборки заявок"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep10dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar" title="Конечная дата для выборки заявок"> 
	</td>
	<td class="td">
		Максимальный срок обработки: <input type=text value=5 id="rep10term" style="width:30px" title="Количество дней предусмотренное для отправки заявки."> 
	</td>
	<td rowspan=2 class="td">
		<sklad:LittleButton name="ok" id="okbut10" onclick="showReport10()" alt="Вывести отчёт">
	</td>
</tr>
<tr>
	<td class="td" title="Если указать какой либо тип оплаты, то иные заявки не попадут в выборку.">
		Тип оплаты заявки: <select id="Rep10Select">
			<script language="cache" runat="server">
 				w ##class(Docs.Action2).GetClassValuesOptions("","Common.Dictionary7")
			</script>
		</select>
	</td>
	<td class="td">
		Выводить все инструкции <input type="checkbox" id="Rep10checkbox" style="width:15px;border:none" title="Выводить все заявки, а не подходящие по сроку подсвечивать.">
	</td>
</tr>
</table>
<br>
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep10" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report10" style="display:none" onMethodComplite="this.style.display=''" /><br>
<span id="Rep10Legend" style="display:none">
<table>
<tr><td bgcolor="#ff0000">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>Отправленные с опозданием</td></tr>
<tr><td bgcolor="#7b0000">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>Не отправленные</td></tr>
</table>
</span>

<hr width=80%>10
<table width=100%><tr><td align=left>
Запчасти которые требовал клиент и которые не были отправлены<br>
Период c <input type=text id="rep11dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep11dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> 
<sklad:LittleButton name="ok" id="okbut11" onclick="showReport11()" alt="Вывести отчёт">
<br>
<td align="right" >скрыть <input type="checkbox" style="border:0;width:15" id="rep11" CHECKED onclick="showhide(this.id)">
</table>
<SKLADList:listview width=100% height=200 id="report11" style="display:none" onMethodComplite="this.style.display=''" /><br>

<hr width=80%>11 
Суммы отгрузок по брендам (MM,TL,VC)<br>
<table class="ta" cellspacing=0>
<tr><td class="td">Период c <input type=text id="rep12dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep12dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"></td><td class="td" rowspan="3"><sklad:LittleButton name="ok" id="okbut12" onclick="showReport12()" alt="Вывести отчёт"></td></tr>
<tr><td class="td">Выводить с помощью <select id="rep12select"><option value="application/x-msexcel">Excel</option><option value="text/html">Internet Explorer</option></select></td></tr>
<!-- <tr><td class="td">Показывать документ и дату продажи <input type="checkbox" id="rep12cb" checked style="width:15;border:none"></td></tr> -->
</table>

<hr width=80%>12 
Количество заявок в системе<br>
<table class="ta" cellspacing=0>
<tr><td class="td">Период c <input type=text id="rep13dat1" value="#($ZD($H-30,4))#" onmouseout="UnPaint(this)" onmouseover="Paint(this)" onclick="fnCalendar(this)" class="datar"> по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep13dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"></td><td class="td" rowspan="3"><sklad:LittleButton name="ok" id="okbut13" onclick="showReport13()" alt="Вывести отчёт"></td></tr>
<tr><td class="td">Выводить с помощью <select id="rep13select"><option value="application/x-msexcel">Excel</option><option value="text/html">Internet Explorer</option></select></td></tr>
<!-- <tr><td class="td">Показывать документ и дату продажи <input type="checkbox" id="rep12cb" checked style="width:15;border:none"></td></tr> -->
</table>

<hr width=80%>13 
Сумма остатка<br>
<table class="ta" cellspacing=0>
<tr>
	<td class="td">Классификатор: <select id="rep14CatalogueSelect">
<script language="cache" runat="server">
 w ##class(Docs.Action2).GetClassValuesOptions("","Goods.Catalogue")
</script>
</select> Учитывать резерв <input type="checkbox" id="rep14Rezerv" style="border:0;width:15">
	</td>
	<td class="td" rowspan="3"><sklad:LittleButton name="ok" id="okbut14" onclick="showReport14()" alt="Вывести отчёт"></td>
</tr>
<tr>
	<td class="td">Выводить с помощью <select id="rep14select"><option value="application/x-msexcel">Excel</option><option value="text/html">Internet Explorer</option></select></td>
</tr>
</table>

<hr width=80%>14 
Статистика ремонта изделий<br>
<table class="ta" cellspacing=0>
<tr>
	<td class="td">Округ: <select id="rep15Select">
<script language="cache" runat="server">
 w ##class(Docs.Action2).GetClassValuesOptions("","Common.Dictionary18")
</script>
</select> 
	с <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep15dat1" value="#(YearBeginDate)#" onclick="fnCalendar(this)" class="datar">
	по <input type=text onmouseout="UnPaint(this)" onmouseover="Paint(this)" id="rep15dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	</td>
	<td class="td" rowspan="3"><sklad:LittleButton name="ok" id="okbut15" onclick="showReport15()" alt="Вывести отчёт"></td>
</tr>
<tr>
	<td class="td">Выводить с помощью <select id="rep15select"><option value="excel">Excel</option><option value="html">Internet Explorer</option></select></td>
</tr>
</table>

<br><hr width=80%>15 <br>
<a href="csp.repSO.cls" target="_blank">Статистика отправки запчастей контрагентам</a><br>

<br><hr width=80%>16 <br>
<a href="reports/InOut.csp?sessionid=#(%session.SessionId)#" target="_blank">Движение товара</a><br>

<br><hr width=80%>17 <br>
<a href="reports/InnerInstrGoods.csp?sessionid=#(%session.SessionId)#" target="_blank">Отчёт по отправленным запчастям</a><br>
<!--
<a href="rrr.csp">расход по брендам</a>
-->
</body>
</html>]]></CSP>


<CSP name="appstat.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html><head></head><body onload='info();'><form id='data' name='data'>
<input type='hidden' id='nav' name='nav' />
</form>
<script type='text/javascript'>
function info(){
   // версия ie по глобальным объектам   
   var elem = document.getElementById('nav'); if (!elem) return;
   if (document.compatMode)  elem.value="6+"; 
   if (window.XMLHttpRequest) elem.value+="7+";     
   if (document.querySelector) elem.value+="8+";
   if (document.addEventListener) elem.value+="9+";
   if (window.atob) elem.value += "10+"; 
   
    #($S( $g(%request.Data("nav",1))="":"data.submit()",1:"" ))#
}
</script></body></html>
<script runat='server' language='cache' method='OnPreHTTP' returnType='%Boolean'>
   s nav = $g(%request.Data("nav",1)) 
   s:nav'="" ^appstat.navD($i(^appstat.navD))=nav
   Q 1
</script>
]]></CSP>


<CSP name="ArchiveBase.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="jscript">
function fnReload(){
SetCookie("ArchivePath", ArchivePath.value);
window.location.reload();
}

function startFun(){
if(ArchiveItSelf.value==""){alert("Не выбрана архивная база;");return}
if(!window.confirm("Подключить архивную базу "+ArchiveItSelf.value+" ?"))return;
#call(Common.Common.PlugArchiveBase(ArchiveItSelf.value))#
iTimerID = window.setInterval(LookUp, 2000)
}

function FillArchivePath(){
var ArchivePathvalue=GetCookie("ArchivePath");
if(typeof(ArchivePathvalue)=="undefined")var ArchivePathvalue="\\\\fileserver\\DISTRIB\\BackupCache";
ArchivePath.value=ArchivePathvalue;
}

function LookUp(){
var answer=#server(Common.Common.PlugArchiveBase())#
var command = answer.substr(0, 4);
if(command!="stop"){MethodResult.innerText=answer;}
else{
	window.clearInterval();
	MethodResult.innerText=answer.substr(4, answer.length);
	//if(OpenDatabase.checked)
	//	{
	//	window.open("../sklad/index.hta",null,"height=500,width=700,status=no,toolbar=no,menubar=no,location=no");
	//	}
	}
}
</script>

</head>

<body onload="FillArchivePath()">
<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=3><strong>Подключение к архивной базе данных</strong></TD></tr>
<tr>
</table>
<br><br>
Путь к архивным базам: <input type="text" id="ArchivePath" value=""> <sklad:LittleButton name="ok" id="savePath" onclick="fnReload()" alt="Запомнить и перечитать список архивных баз">
<br><br>
Ниже указаны копии базы данных сделанные на указанное число. Выберете одну из них и нажмите кнопку "Подключить".<br>
<script language="cache" runat="server">
 s ArchivePath=%request.GetCookie("ArchivePath")
 w "<SELECT ID=""ArchiveItSelf"" NAME=""Cars"" SIZE=""15"" style=""border:solid 1 grey;width:400px"">",!
 if ArchivePath'="" {
	//s str="Архивная папка "_ArchivePath
 	s qw=##class(%ResultSet).%New("%Library.File:FileSet")
 	//s ok=qw.Prepare(ArchivePath)
 	//if '+ok s str=ok
 	s ok=qw.Execute(ArchivePath)
 	if '+ok s str=ok
 	while qw.Next(.ok) {
	 	if $$$ISERR(ok) s str=ok
	 	if qw.Data("Type")="F" CONTINUE	//пропускаем файлы
  		w "<OPTION VALUE="""_$G(qw.Data("Name"))_""">"_$G(qw.Data("Name")),!
 		}
 	If $$$ISERR(ok) Do DisplayError^%apiOBJ(ok) Quit
  }
  else { s str="Не указана архивная папка"}
 w "</SELECT>",!
 w "<br>"_$G(str)_"<br>",!
</script>
<br>
<sklad:Button value="Подключить" onclick="startFun()"><br>
<!--
<input type="checkbox" id="OpenDatabase" checked style="border:none;width:15px"> Открыть архивную базу.
-->
<br><br>
<center><h4><span id="MethodResult"></span></h4></center>
</body>
</html>
]]></CSP>


<CSP name="Attach2Model.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,4) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>

<html XMLNS:SKLADz XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<title>	Cache Server Page </title>
<script language="javascript">
var CurrentProperty;
var Objvalue;
var InCard=false;
var FromTable="";
var FromTree="";
var Number=0;
ExpressType2="";
var ColCode="";
//если указано "@1" то в качестве цены будет указана закупочная цена
//см. Goods.GoodsAction.fromgroup()
var ShowBuyPrices="#(%request.Get("ShowBuyPrices"))#";
var depot="#($G(%session.Data("depot")))#"
var commongroups="#($G(%session.Data("commongroups")))#"

//вывод товаров принадлежащих группе
function GroupsTreeClick2(){
var where2="Groups='"+GroupsTree2.NodeID+"'"
Goods2.loadfrommethod("Goods.GoodsAction.fromgroup",where2,fields2,0+ShowBuyPrices)
}

//заполнить дерево товарами
function LoadTree2(){
GroupsTree2.AdditionalID=Catalogues2.value;
GroupsTree2.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+depot+'","'+Catalogues2.value+'"')	
}

// клик на таблице моделей
function GoodsModelClick(){
CurrentModelName.innerText = Goods2.ItemName;
Zapchasti.loadfrommethod("Reports.ShowTables.ZapchastiForModel",Goods2.ItemID);
}

function startAdding(){
	if(ReturnSpace(Goods2.ItemName)=="")
	{
		alert("Не указана модель.");
		return;
	}
	AddTovarBlock.style.display = "block";
	maintable.style.display = "none";
}

function RemoveFromModel(){
	var SelectedIDs = Zapchasti.ListViewGetItems("selected",1);
	var ok = #server(Goods.GoodsAction.SetTovarFieldForGoods(SelectedIDs))#
	if (isNaN(ok)){alert(ok)}
	else{GoodsModelClick();}
}

function CloseSelectBlock(){
maintable.style.display="block";
AddTovarBlock.style.display="none";
}

//!!!!!!!!!!!!!
//!!!!!!!!!!!!!
	//набор функций для скрытого блока, т.е. блока выбора товаров
//!!!!!!!!!!!!!
//!!!!!!!!!!!!!
function startFun(){
if(!TurnOnGoodsForDoc_checkbox.checked)
	{
	var ZapchastiId=TempGoods.ListViewGetItems("selected",1);
	}
else
	{
	var ZapchastiId=GoodsForDoc.ListViewGetItems("",1);
	}
var ModelId = Goods2.ItemID;
//alert("ModelId = " + ModelId + "\n" + "ZapchastiId = " + ZapchastiId);
	var ok = #server(Goods.GoodsAction.SetTovarFieldForGoods(ZapchastiId,ModelId))#
	if (isNaN(ok)){alert(ok)}
	else{GoodsModelClick();}
CloseSelectBlock();
}

function ReturnSelected(){
ResultArray=TempGoods.ListViewGetItems("selected");
returnValue=ResultArray;
window.close();	
}

function load(){
window.dialogWidth=screen.availWidth+"px";
//alert(screen.availWidth+"X"+screen.availHeight+"\n"+window.dialogWidth+"X"+window.dialogHeight)
//TempGoods.attachEvent("onAddColumns", addcol)
TempGoods.LoadHeaders("izdelie,Description,Composition");
Goods2.LoadHeaders("izdelie,Description,Composition");
GoodsForDoc.LoadHeaders("izdelie,Description,Composition");
Zapchasti.LoadHeaders("izdelie,Description,Composition");
//alert("depot\n"+depot+"commongroups\n"+commongroups);
//Catalogues.startDownload(strForGroups(depot,commongroups), putCatalogue);
LoadTree()
PropTable.DownLoadPairs("","");
LoadPropTree();
}

function addcol(){
TempGoods.detachEvent("onAddColumns", addcol)
fields=TempGoods.GetColumns("Goods->");
//alert("fields = "+fields)
//TempGoods.AddColumns("quant~Количество~~~@%String#@#")
}

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}

function LoadTree(){
GroupsTree.AdditionalID=Catalogues.value;
//alert('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+depot+'","'+Catalogues.value+'"')
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+depot+'","'+Catalogues.value+'"')	
}

function LoadPropTree(){
Group=ReturnSpace(GroupsTree.NodeCode);
LoadPropTree2("PropsTree","",Group,Catalogues.value)
}

// добавить товар в таблицу из текущей ветки
function AddFromGroup(){
var where="Groups='"+GroupsTree.NodeID+"'"
//alert(where+"\n"+TempGoodsfields);
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,TempGoodsfields)
}

// добавить товар в таблицу из всех подветок данной ветки
function AddFromWholeGroup(){
var where="Groups->Depot='"+depot+"' and Groups->Catalogue='"+Catalogues.value+"' and Groups->Code %STARTSWITH '"+GroupsTree.NodeCode+"'";
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,TempGoodsfields);
}

function AddFromSelect(){
if(ThisGroupOnly.checked){var GroupCondition="Groups->Depot='"+depot+"' and Groups->Catalogue='"+Catalogues.value+"' and Groups->Code %STARTSWITH '"+GroupsTree.NodeCode+"'";}
else{var GroupCondition="";}
var where=GroupCondition+FromTable;
if(cbShowQuantity.checked){ShowQuantityVar=1;}
else{ShowQuantityVar=0;}
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,TempGoodsfields,ShowQuantityVar+ShowBuyPrices)
}

function TableClick(){
	ExpressType="FromTable";
	CurrentProperty=PropTable.CurrentRowTag;
	Pname.innerText=PropTable.CurrentRowName;
	newObj=PropTable.CurrentRowElement.cloneNode(true);
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function AddExpress(){
	tagNamez=Pvalue.firstChild.tagName;
	if(tagNamez=="DIV"){
		Objvalue=Pvalue.firstChild.Tag;
		if(Objvalue.split("@")[0]==""){Objvalue=Pvalue.firstChild.innerText+Objvalue;}
		}
	if(tagNamez=="SELECT"){Objvalue=Pvalue.firstChild.options(Objec.selectedIndex).text+"@%String";}
	return Objvalue;
}

function TakeValue(){
FrstPart=AddExpress().split("@")[0]
ScndPart=AddExpress().split("@")[1]
//if(ScndPart!="%Date")return FrstPart
if(ScndPart!="%Date")return "'"+FrstPart+"'"
else {
	dateArr=FrstPart.split("/")
	Data=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	return "CAST('"+Data+"' AS DATE)"
}
}

function dork(concatenation){
if(Pname.innerText=="")return false
if(ExpressType2!=ExpressType){
	Express.innerHTML="";
	ExpressType2=ExpressType;
	}
newCaption=Pname.innerText;
newEqual=Pequal.options(Pequal.selectedIndex).text;
newValue=TakeVisibleValue();
newExpression=newCaption+newEqual+newValue;
value=TakeValue();
if(ExpressType=="FromTree"){
	//exp=(CurrentProperty+InnerSplitter+Pequal.value+InnerSplitter+value);
	if(FromTree==""){FromTreeconcatenation="";}
	else{FromTreeconcatenation=concatenation}
	Number++;
	field="t"+Number+".Gvalue"
	if((Pequal.value!="=")&(Pequal.value!="<>")){field="CAST(t"+Number+".Gvalue AS INTEGER)"}
	exp=" (t"+Number+".Param="+CurrentProperty+" and "+field+Pequal.value+value+") "
	FromTree=FromTree+FromTreeconcatenation+ exp;
	}
if(ExpressType=="FromTable"){
	if(FromTable==""){FromTableconcatenation="";}
	else{FromTableconcatenation=concatenation}
	exp=" Goods->"+CurrentProperty+Pequal.value+value+" "
	FromTable=FromTable+FromTableconcatenation + exp;
	}
if(Express.innerHTML=="")concatenation="";
if(concatenation=="AND"){concatenation="И"}
if(concatenation=="OR"){concatenation="ИЛИ"}
newString=Express.innerHTML+"<b> "+concatenation+" (</b>"+newExpression+"<b>)</b>"
Express.innerHTML=newString;
}

function TakeVisibleValue(){
	Objec=Pvalue.firstChild;
	if(Objec.tagName=="SELECT")return Objec.options(Objec.selectedIndex).text
	else{return Objec.innerText;}
}

function PropsTreeClick(){
	ExpressType="FromTree";
	CurrentProperty=PropsTree.NodeID;
	Pname.innerText=PropsTree.NodeCaption;
	newObj=CreateDiv("","dsd");
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function DelItems(element){
document.getElementById(element).DelItems();
}

function ClearSelect(){
Express.innerText='';
FromTree="";
FromTable="";
Number=0;
}

function showdictionary(where){
TempGoods.AddOnClear=true;
TempGoods.DownLoad(where);
TempGoods.AddOnClear="false";
}

//функция нужна для совместимости с table.htc
function cellaction(oo){
}

//функция нужна для совместимости с table.htc
function getDivChange(oo){
}

//открыть карточку товара
function OpenCard(ListViewObject){
GoodsId=SelectedItemProperty(ListViewObject,'Tag');
GoodsName=SelectedItemProperty(ListViewObject,'Text');
if(GoodsId=="")return
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath="+"",GoodsId+InnerSplitter+GoodsName,"center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
if(ok==1){ShowTovars()}
}

function GroupsTreeClick(){
	CurrentGroupName.innerText=GroupsTree.NodeCaption;
	LoadPropTree();
	AddFromGroup();
}

// показать/убрать промежуточную таблицу для выбора документов
function TurnOnGoodsForDoc(){
	if(TurnOnGoodsForDoc_checkbox.checked){
		GoodsForDoc_TR.style.display="inline";
		CopyGoodsAnotherTable_Btn.style.display="inline";
		}
	else{
		GoodsForDoc_TR.style.display="none";
		CopyGoodsAnotherTable_Btn.style.display="none";
		}
}

//Переместить
function CopyGoodsAnotherTable_Fn(){
var Strings=TempGoods.ListViewGetItems("selected").split(StringSplitter)
for(var i=0; i<Strings.length-1; i++)
	{
		var StringArray = Strings[i].split(InnerSplitter);
		GoodsForDoc.addrow(StringArray[0],StringArray)
	}
}
</script>
</head>

<body onload="load();">
<sklad:Button value="Назад" onclick="window.location.href='goods.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
	<TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=3><strong>Запчасти и их модели</strong></TD>
</TR>
</table>
<table border=0 width=100% id="maintable">
<tr >
<td width=30% valign=top>
	<fieldset ><legend>Группы</legend>
		Классификатор:<select id="Catalogues2" onchange="LoadTree2()">
<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions("","Goods.Catalogue")
</script>
		</select><br>
		<SKLADz:treeview id="GroupsTree2" width="200" height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="GroupsTreeClick2();"/>
	</fieldset>
</td>
<td width=70% valign=top>
	<fieldset ><legend>Товары в выбранной группе</legend>
		<SKLADList:listview ClassName="Goods.Goods" width=100% height=300 id="Goods2" onAddColumns="fields2=Goods2.GetColumns('Goods->');" zClick="GoodsModelClick()" /><br>
  	</fieldset>
</td>
</tr>
<tr><td colspan=2>
<fieldset><legend>Запчасти принадлежащие модели <span id="CurrentModelName"></span></legend>
<SKLADList:listview width=100% height=300 id="Zapchasti" /><br>
<sklad:Button value="Добавить запчасти" onclick="startAdding();" style="width:200">
<sklad:Button value="Убрать запчасти" onclick="RemoveFromModel();" style="width:200">
</fieldset>
</td>
</table>
<!--
		Отсюда идёт блок где расположены контролы для отбора товара из группы или по параметрам
-->
<span id="AddTovarBlock" style="display:none">
<table width=100% border=0>
<tr ><td width=50% valign="top">
<fieldset><legend>Отбор из группы</legend>
Классификатор:<select id="Catalogues" onchange="LoadTree()">
<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions("","Goods.Catalogue")
</script>
</select><br>
  <SKLADz:treeview id="GroupsTree" width="200" height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="GroupsTreeClick();" onDownloadCmpl="LoadPropTree()" />
  <br>
  <input type="button" id="SelectWholeGroup" value="выбрать всю ветку" onclick="AddFromWholeGroup()">
 </fieldset>
</td>
<td width=50% valign="top">

<fieldset><legend>Отбор по параметрам</legend>
<table><tr><td valign=top>
<SKLAD2:table id="PropTable" width=220 height=200 zonTableClick="TableClick()" DisplaySecondCol="none" />
</td>
<td valign=top>
  <SKLADz:treeview id="PropsTree" width=200 height=130 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="PropsTreeClick()" />
</td></tr>
<tr><td width=100% colspan=2 align=center>
	<span id="Pname"></span>&nbsp;&nbsp;
	<select id="Pequal" >
		<option value="=">=</option>
		<option value="<>">&#8800;</option>
		<option value="<">&lt;</option>
		<option value="<=">&lt;=</option>
		<option value=">">&gt;</option>
		<option value=">=">&gt;=</option>
	</select>&nbsp;&nbsp;
	<span id="Pvalue" style="background:#ddffff;width:150px;border:dotted 1 gray">&nbsp;&nbsp;&nbsp;</span></td>
</tr>
<tr><td colspan=2>
	<center>
	<input type="button" value="И" id="Pand" onclick="dork('AND')" style="width:50px">
	<input type="button" value="ИЛИ" id="Por" onclick="dork('OR')" style="width:50px"><sklad:LittleButton name="del" id="Clear" onclick="ClearSelect();" alt="Очистить поле 'Параметры'"></center>
<fieldset><legend>Параметры отбора</legend>
&nbsp;<span id="Express" style="font:Arial 13;color:#000033"></span>
</fieldset>
</td></tr>
<tr><td colspan=2 align="center">
		<input type="button" onclick="AddFromSelect()" value="Выбрать товары">
		<input type="checkbox" id="ThisGroupOnly" style="border:0;width:20px"> только в группе <span id="CurrentGroupName"></span>
	</td>
	</tr>
</table>
</fieldset>
</td>
</tr>
<tr><td valign="top"  colspan=2>
<fieldset id="SelectedGoods"><legend>Выбранные товары</legend>
 	<SKLADList:listview width=100% height=130 id="TempGoods"  ClassName="Goods.Goods" AddOnClear="false" zonDblClick="startFun();"  AddHeaders="true" onAddColumns="TempGoodsfields=TempGoods.GetColumns('Goods->');"/><br>
 	<!--   -->
<sklad:LittleButton name="del" id="addrtrr" onclick="TempGoods.DelItems()" alt="Убрать выделенные товары из списка">
<sklad:LittleButton name="down" id="CopyGoodsAnotherTable_Btn" onclick="CopyGoodsAnotherTable_Fn()" alt="Отобрать товары для документа" style="display:none">
<br><input type="checkbox" id="TurnOnGoodsForDoc_checkbox" onclick="TurnOnGoodsForDoc()" style="width:15;border:none" > Включить промежуточную таблицу для выбранных товаров
</fieldset>
</td></tr>
<tr id="GoodsForDoc_TR" style="display:none">
	<td colspan=2><SKLADList:listview width=100% height=130 id="GoodsForDoc"  ClassName="Goods.Goods" AddOnClear="false" zonDblClick="startFun();"  AddHeaders="true"/><br>
<sklad:LittleButton name="del" id="RemoveGoodsForDoc_Button" onclick="GoodsForDoc.DelItems()" alt="Убрать выделенные товары из списка">
</tr>
<tr><td valign=bottom  colspan=2>
<center><sklad:Button value="Добавить выбранные запчасти" onclick="startFun();" style="width:200"><sklad:Button onclick="CloseSelectBlock()" value="Отмена" style="width:300"></center>
</td></tr>
</table>
</span>
</body>
</html>
]]></CSP>


<CSP name="bank.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 s Access10func=##class(Common.Rights).getrights($G(login,0),10)
 if 'Access10func s Func10Refuse="return;"
Quit 1
</script>
<script language="cache" runat="server">
 s Kontr=%request.Get("Kontr")
 s kontragent=%request.Get("kontragent")
 d:kontragent'=""
 . s start="window.close()"
 . q:'Access10func
 . s k=##class(Common.Kontragent).%OpenId(kontragent)
 . d:$ISOBJECT(k)
 . . s k.bank.pbank=%request.Get("pbank")
 . . s k.bank.city=%request.Get("city")
 . . s k.bank.kpp=%request.Get("kpp")
 . . s k.bank.inn=%request.Get("inn")
 . . s k.bank.bik=%request.Get("bik")
 . . s k.bank.rsch=%request.Get("rsch")
 . . s k.bank.ksch=%request.Get("ksch")
 . . s k.bank.code=%request.Get("code")
 . . s k.bank.okpo=%request.Get("okpo")
 . . s k.bank.okud=%request.Get("okud")
 . . s k.bank.okdp=%request.Get("okdp")
 . . s k.bank.okonh=%request.Get("okonh")
 . . s k.bank.ogrn=%request.Get("ogrn")
 . . s k.bank.okato=%request.Get("okato")
 . . s k.bank.regnumber=%request.Get("regnumber")
 . . d k.%Save()
 s k=##class(Common.Kontragent).%OpenId(Kontr)
 d:$ISOBJECT(k)
 . s kname=k.Name
 . s bank=k.bank
 . d:$ISOBJECT(bank)
 . . s pbank=bank.pbank
 . . s city=bank.city
 . . s kpp=bank.kpp
 . . s inn=bank.inn
 . . s bik=bank.bik
 . . s rsch=bank.rsch
 . . s ksch=bank.ksch
 . . s code=bank.code
 . . s okpo=bank.okpo
 . . s okud=bank.okud
 . . s okdp=bank.okdp
 . . s okonh=bank.okonh
 . . s ogrn=bank.ogrn
 . . s okato=bank.okato
 . . s regnumber=bank.regnumber
</script>
<html XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">

function startFun(){
#($G(Func10Refuse))#
ss.submit();
window.close();
}

function load(){
#($G(start))#
}

</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >

<center><font size=+1 color="#334455">#($G(kname))#</font></center>
<form name="ss">
<table width="100%">
<input type="hidden" name="kontragent" value="#($G(Kontr))#">
<tr><td>Банк получателя</td><td><input type="text" value="#($G(pbank))#" name="pbank" style="width:400px"></td></tr>
<tr><td>Город банка получателя</td><td><input type="text" value="#($G(city))#" name="city"></td></tr>
<tr><td>КПП</td><td><input type="text" value="#($G(kpp))#" name="kpp"></td></tr>
<tr><td>ИНН</td><td><input type="text" value="#($G(inn))#" name="inn"></td></tr>
<tr><td>БИК</td><td><input type="text" value="#($G(bik))#" name="bik"></td></tr>
<tr><td>ОКПО</td><td><input type="text" value="#($G(okpo))#" name="okpo"></td></tr>
<tr><td>ОКУД</td><td><input type="text" value="#($G(okud))#" name="okud"></td></tr>
<tr><td>ОКДП</td><td><input type="text" value="#($G(okdp))#" name="okdp"></td></tr>
<tr><td>ОКОНХ</td><td><input type="text" value="#($G(okonh))#" name="okonh"></td></tr>
<tr><td>Расчетный счёт</td><td><input type="text" value="#($G(rsch))#" name="rsch"></td></tr>
<tr><td>Корреспондетский счёт</td><td><input type="text" value="#($G(ksch))#" name="ksch"></td></tr>
<tr><td>Код банка</td><td><input type="text" value="#($G(code))#" name="code"></td></tr>
<tr><td>ОГРН</td><td><input type="text" value="#($G(ogrn))#" name="ogrn"></td></tr>
<tr><td>ОКАТО</td><td><input type="text" value="#($G(okato))#" name="okato"></td></tr>
<tr><td>Свидетельство о регистрации</td><td><input type="text" value="#($G(regnumber))#" name="regnumber"></td></tr>
<input type="hidden" value="#($G(sessionid))#" name="sessionid">
</table></form>
<center>
<CSP:IF CONDITION="Access10func=1">	
	<sklad:Button value="Да" onclick="startFun();">
</CSP:IF>
<sklad:Button onclick="windowclose()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="Brak.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<title>	Cache Server Page </title>
<Script language="Jscript">
var ColCode="";
sessionid="#(%session.SessionId)#";

function gg(){
if(ColCode=="")return false;
var SearchProperty = ColCode;
var SearchValue = fldval.value;
if(SearchValue=="")SearchProperty="";
load(SearchProperty,SearchValue);
}

function colclick(){
	if(currentdict.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=currentdict.ColName;
	ColCode=currentdict.ColCode;
}


function load(SearchProperty,SearchValue){
currentdict.loadfrommethod("Reports.ShowTables.ShowBrak",SearchProperty,SearchValue,dat1.value+"@"+dat2.value);
}

function fnUtiliz(){
var StoreBrakIDs=currentdict.ListViewGetItems("selected",1);
var UtilizID=#server(Docs.Action2.CreateUtiliz(StoreBrakIDs))#
if(isNaN(UtilizID)){alert(UtilizID);return}

WinResult=window.showModalDialog("docutiliz.csp","Docs.Utiliz"+InnerSplitter+UtilizID+InnerSplitter+"Утилизация","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
if(WinResult!=null)
	{
		if(window.confirm("Обработать документ? (Нажмите 'отмена', если хотите внести изменения перед обработкой документа)")){processdoc(UtilizID+"@Docs.Utiliz")}
		else{alert("Документ успешно создан. Зайдите в раздел Документы, проверьте его и укажите системе обработать.")}
		load("","")
	}
}

function processdoc(doc)
{
	var ok=#server(Docs.Action.processdoc(doc))#
	if(isNaN(ok)){alert(ok)}
	else{alert("Документ успешно обработан");}
}


function fnSendToRemont(){
var StoreBrakIDs=currentdict.ListViewGetItems("selected",1);
var BrakremontID=#server(Docs.Action2.CreateBrakremont(StoreBrakIDs))#
if(isNaN(BrakremontID)){alert(BrakremontID);return}
if(window.confirm("Документ успешно создан. Открыть форму документа?")){
	WinResult=window.showModalDialog("document.csp","Docs.Brakremont"+InnerSplitter+BrakremontID+InnerSplitter+"Передача документа в ремонт","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;");
	}
if(window.confirm("Обработать документ? (Нажмите 'отмена', если хотите внести изменения перед обработкой документа)"))
	{
	processdoc(BrakremontID+"@Docs.Brakremont")
	load("","")
	}
else{alert("Документ успешно создан. Зайдите в раздел Документы, проверьте его и укажите системе обработать.")}
}

//переместить 
function fnSendToNormal(){
var StoreBrakIDs=currentdict.ListViewGetItems("selected",1);
var InstrId=#server(Docs.Action2.MakeBrakInstruction(StoreBrakIDs))#
if(isNaN(InstrId)){alert(InstrId);}
else{
	window.showModalDialog("createinstructIgrid.csp?source="+InstrId,"","center:yes;status:no;dialogHeight:600px;dialogWidth:720px;resizable:yes;")
	}
}

//нажали зелёную галочку справа от дат
function okbutFunc()
{
	var SearchValue = "";
	var SearchProperty = "";
	
	if((ColCode!="")&&(fldval.value!=""))
	{
		var SearchProperty = ColCode;
		var SearchValue = fldval.value;
	}
	load(SearchProperty,SearchValue);
}
</script>
</head>

<body onload="load('','')">
<sklad:Button value="Товары" onclick="window.location.href='goods.csp'"><br>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Некондиционные товары</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>
Период c <input type=text id="dat1" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<sklad:LittleButton name="ok" id="okbut" onclick="okbutFunc()" alt="Показать документы"><br>
<br>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
<SKLADList:listview width=100% height=150 id="currentdict" zonColumnClick="colclick()" /><br>
<sklad:Button value="Утилизировать" onclick="fnUtiliz()" style="width:150px" alt="Создать документ 'Утилизация'">
<sklad:Button value="Отправить в ремонт" onclick="fnSendToRemont()" style="width:150px" alt="Создать документ 'Передача брака в ремонт'">
<sklad:Button value="Инструкция 'Некондиция'" alt="Создать инструкцию руководителя по отправке некондиционного товара" onclick="fnSendToNormal()" style="width:160px"><br>
</body>
</html>]]></CSP>


<CSP name="BrakUtiliz.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s AddressId=%request.Get("AddressId")
 s KontragentId=%request.Get("KontragentId")
 s AddressPath = ##class(Store.Action).AddressPath(AddressId)
 if +KontragentId s KontrName = ##class(Common.Kontragent).GetPropertyValue(KontragentId,"Name")
</script>
<script language="Cache" method="ShowBrak" arguments="KontragentId,AddressId" returntype="%String">
 
 if AddressId="" q "Невозможно вывести остаток по браку. Не указан адрес"

 //найдём код этого места хранения	
 	&sql(select Code into :Code from Store.Address where id=:AddressId)
 	if SQLCODE q "Ошибка при проверке места хранения "_Address_" SQLCODE="_SQLCODE
 	 	
 	&sql(declare zzz cursor for
 		select ID,Goods->FullName,Address,Qnt,%external(SourceDoc->Dat),Kontr->Name
 		into :ID,:GoodsName,:Address,:Qnt,:Dat,:KontrName
 		FROM Store.Brak
 		WHERE 
 			( (Kontr=:KontragentId) OR (:KontragentId='') OR (:KontragentId IS NULL) ) AND 
 			(Address->Code %STARTSWITH :Code))
 	&sql(open zzz)
 	f  &sql(fetch zzz) q:SQLCODE  d
 	. w "<tr>"
 	. w "<td>"_$ZCVT(GoodsName,"O","HTML")
 	. w "<td>"_$ZCVT(##class(Store.Action).AddressPath(Address),"O","HTML")
 	. w "<td>"_$ZCVT(KontrName,"O","HTML")
 	. w "<td>"_Dat
	. s qntName="qnt_"_ID
 	. s utilizName="utiliz_"_ID
 	. s remontName="remont_"_ID
 	. s qntBrakName="qntBrak_"_ID
 	. s utilizChecked=$S($D(%request.Data(utilizName)):"CHECKED",1:"")
 	. s remontChecked=$S($D(%request.Data(remontName)):"CHECKED",1:"")
 	. s qntBrakValue=%request.Get(qntBrakName)
 	. w "<td><input class=""Txt"" type=""text"" value="""_Qnt_""" name="""_qntName_""" id="""_qntName_""">"
 	. w "<td><input class=""Txt"" type=""text"" value="""_qntBrakValue_""" name="""_qntBrakName_""" id="""_qntBrakName_""">"
 	. 	w "<input class=""ChkBox"" type=""checkbox"" onclick=""SetBrakQnt(this)"" name="""_utilizName_""" "_utilizChecked_">"
 	. //w "<td><input class=""ChkBox"" type=""checkbox"" name="""_remontName_""" "_remontChecked_">"
 	. w "</tr>",!
 	&sql(close zzz)
  q
</script>
<script language="cache" method="GetUtilizItemFromStoreBrakID" Arguments="ID" returntype="Docs.UtilizItems">
 if $G(ID)="" q "<font color=""red""> Извините. При попытке создания документа утилизации произошла ошибка: не указана ячейка брака </font>"
 s BrakObj=##class(Store.Brak).%OpenId(ID)
 if '$ISOBJECT(BrakObj) q "<font color=""red"">Извините. При попытке создания документа утилизации произошла ошибка: невозможно прочесть ячейку брака "_ID_"</font>"
 //
 s obj=##class(Docs.UtilizItems).%New()
 s obj.goodsdir=1
 s obj.addr=BrakObj.Address
 s obj.Goods=BrakObj.Goods
 s obj.SourceTbl=2
 s obj.Brak=BrakObj
 d obj.DocTypeSetObjectId("Docs.Utiliz")
 s obj.Quantity = 1
 if $ISOBJECT(BrakObj.Kontr) s obj.Client=BrakObj.Kontr
 	 
 q obj
</script>

<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 .  s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 
Quit 1
</script>

<html>
<head>

<!-- Put your page Title here -->
<title> #($G(%session.Data("systemname")))# </title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.ChkBox{border:none;width:20px}
.Txt{width:40px}
</style>
<script language="javascript" type="text/javascript" src="common.js" ></script>
<script language="javascript" type="text/javascript">
// вывести брак указанной ячейки и контрагента
function ShowBrak()
{
	if(Address.Tag=="")
	{
		alert("Не указан адрес ячейки.");
		return;
	}
	window.location.href="?KontragentId="+Kontr.Tag+"&AddressId="+Address.Tag
}

//выбрать адрес ячейки
function ChooseAddress(Obj,depot)
{
	var depot=ReturnSpace(depot);
	var newItem=window.showModalDialog("storemodal2.csp?depot="+depot,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;");
	if(newItem!=null){if(newItem.split("~")[0]=="changedepot"){DictClick(tr,newItem.split("~")[1])}}
	if(newItem==null){return false;}
	var newArr=newItem.split(InnerSplitter);
	
	Obj.innerText=newArr[1];
	Obj.Tag=newArr[0];
}

// поставить количество браку
function SetBrakQnt(obj)
{
	var objname=obj.name;
	var QntObjName="qnt_"+objname.split("_")[1];
	var QntBrakObjName="qntBrak_"+objname.split("_")[1];
	ObjQntBrak = document.getElementById(QntBrakObjName);
	ObjQnt = document.getElementById(QntObjName);

	if (obj.checked)
	{
		ObjQntBrak.value=ObjQnt.value;
		ObjQnt.value="0";
	}
	else
	{
		ObjQnt.value=ObjQntBrak.value;
		ObjQntBrak.value="0";		
	}
}
</script>
</head>

<body>

<sklad:Button value="Назад" onclick="window.location.href='emplight.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Утилизация брака</strong></TD>
<td  width=10% align=right>&nbsp;</td>
</tr>
</TABLE>
<script language="cache" runat="server">
 
//проверим передавали ли нам указание создать документ утилизации
 s StartUtilizName = "utiliz_"
 if $O(%request.Data(StartUtilizName))["utiliz"
 {
	 s docUtiliz = ##class(Docs.Utiliz).%New()
	 s docUtiliz.Name=##class(Docs.Action).getRashNumb("Docs.Utiliz")
	 s docUtiliz.SourceTbl=2
	 
	 while ($O(%request.Data(StartUtilizName))["utiliz")
	 {
		 
		 set StartUtilizName = $O(%request.Data(StartUtilizName))
		 s ID = $P(StartUtilizName,"_",2)
		 s brakQnt = "qntBrak_"_ID
		 
		 for i=1:1:+%request.Get(brakQnt)
		 {
			s ItemObj = ..GetUtilizItemFromStoreBrakID(ID)
		 	if '$ISOBJECT(ItemObj) 
		 	{
				w ItemObj
			 	CONTINUE
		 	}
		 	d docUtiliz.Items.Insert(ItemObj)
		 }
	 }
	 
	 s ok = docUtiliz.%Save()
	 w "<br><font color=""#006767""><b>"
	 if '+ok 
	 {
		 
		 w "Извините. Ошибка при сохранении документа утилизации. "
		 Do $system.OBJ.DisplayError(ok)
	 }
	 else
	 {
		 w "Создан и сохранён документ утилизации "_docUtiliz.Name
	 }
	 w "<b></font><br><br>",!
 }
 
 if $O(%request.Data("remont"))["remont" 
 {
	
 	w "Необходимо создать документ на ремонт /"_$O(%request.Data("remont_"))_"/<br>"
 }
</script>
<table cellpadding=13 border=1>
<tr>
	<td>Контрагент
	<td>Место на складе
	<td rowspan=2><sklad:Button value="Показать брак" onclick="javascript:ShowBrak()">
<tr>
	<td>
		<!-- <span style="width:200px;height:20px" onmouseout="UnPaint(this)" onmouseover="Paint(this)" class="Kontragent" onclick="ChooseKonragent(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Kontr" Tag="#($G(Kontr))#">#($G(KontrName))#</span> -->
		<span style="width:200px;height:20px" onmouseout="UnPaint(this)" onmouseover="Paint(this)" class="Kontragent" onclick="ChooseKonragent(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Kontr" Tag="#($G(KontragentId))#">#($G(KontrName))#</span>
	<td><span style="width:250px;height:20px" onmouseout="UnPaint(this)" onmouseover="Paint(this)" class="Kontragent" onclick="ChooseAddress(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Address" Tag="#($G(AddressId))#">#($G(AddressPath))#</span>
</table>
<Br>
<form METHOD="POST">
	<table border=1>
 		<tr bgcolor="#dedede">
 		<td>Товар
 		<td>Адрес
 		<td>Контрагент
 		<td>Дата
 		<td>Количество
 		<td>Утилизировать
 		<!-- <td>В ремонт -->
	<script language="cache" runat="server">
	 //показать брак по контрагенту и адресу
	 if AddressId d ..ShowBrak(KontragentId,AddressId)
	</script>
	</table>
	<input type="submit" value="ДА">
</form>
</body>
</html>

]]></CSP>


<CSP name="calendar.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 
</script>
<HTML XMLNS:IE>
<HEAD>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<STYLE>
@media all{
   IE\:Calendar{
      behavior: url(htc/calendar.htc) ;
      width : 33%;
   }}
</STYLE>
<script language="Jscript">
function startFun(){
window.returnValue=cal.value;
window.close();
}
</script>
</HEAD>
<BODY onkeypress="ManageWindow();">
<center>
<IE:Calendar ID = "cal" STYLE = "width: 300; height: 275; border: '1px solid black';" ></IE:Calendar>
<sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</BODY>
</HTML>]]></CSP>


<CSP name="CardData.csp" application="/csp/sklad2/" default="1"><![CDATA[
<Script language="cache" runat="server">
 s fields=%request.Get("fields")
 s ClassName=%request.Get("ClassName")
 s CardID=%request.Get("CardID")
 s XML=%request.Get("XML")
 s loadfrom=%request.Get("loadfrom")
 s zamena=%request.Get("zamena")
 s tovar=%request.Get("tovar")
 s kontr=%request.Get("kontr")
 
 i CardID="" d
  . s:+kontr IDS=##class(Goods.CardAction).GetGoods(kontr)
  . s:+tovar IDS=##class(Goods.CardAction).GetKontr(tovar)
  . s:loadfrom'="" IDS=@loadfrom
 e  d
  . s IDS=##class(Goods.CardAction).GetCard(CardID,ClassName)
 f i=1:1:$L(IDS,"~") d
 . s id=$P(IDS,"~",i)
 . q:id=""
 . s Objects(id)=1

 d ##class(Goods.GoodsAction).ShowObjects(ClassName,fields,.Objects,+XML,zamena)
 </script>
 
 ]]></CSP>


<CSP name="Cards.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
function load(){
	instr.LoadHeaders();
}

function ShowInstr(){
	instr.DownLoad();
}

function CardDel(){
	if(!window.confirm("Вы хотите удалить выбранный пункт?")){return false();}
	ok=#server(Common.Common.DeleteItem(instr.ClassName,instr.ItemID))#
	if(ok==1){ShowInstr();}
	else{alert(ok)}
}

function CardOpen(CardID){
	CardID=ReturnSpace(CardID);
	CardName=""
	if(CardID!="")CardName=instr.ItemName;
	ok=window.showModalDialog("addCard.csp",CardID+InnerSplitter+CardName,"cener:yes;status:no;dialogHeight:700px;dialogWidth:1000px;resizable:yes")
	if(ok==1){ShowInstr();}
}
</script>
</head>
<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR><TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Карточки товара</strong></TD></tr>
</TABLE>
<br>
<fieldset><legend>Текущие карточки</legend>
<SKLADList:listview width=100% height=150 id="instr" onAddColumns="ShowInstr()" ClassName="Goods.Card" zonDblClick="CardOpen(instr.ItemID)" /><br>
  <sklad:LittleButton name="new" id="newcard" onclick="CardOpen()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="editcard" onclick="CardOpen(instr.ItemID)" alt="Редактировать запись">
  <sklad:LittleButton name="del" id="delcard" onclick="CardDel()" alt="Удалить запись">
</fieldset>
</body>
</html>]]></CSP>


<CSP name="ChangeGoods.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 d:%session.NewSession 
 . s %session.EndSession=1
 . s ses=%request.Get("sessionid",1)
 . s %session=%session.GetSession(ses)
</script>
<html>
<head>
<title>     #($G(%session.Data("systemname")))# </title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<style>
input{border:0;width:20px}
.TD { border-right:1 solid black;border-bottom:1 solid black }
.TABLE { border-left:1 solid black;border-top:1 solid black;width:100% }
</style>
<script language="Jscript">
function startFun(){
var ItogString="";
for(var i=0;i<document.forms[0].elements.length; i++){
     var CurrentElement=document.forms[0].elements[i]
     var CurrentElementValue=CurrentElement.value;
     var CurrentElementTag=CurrentElement.Tag;
     if((CurrentElement.checked)&&(CurrentElementValue!=0))ItogString=ItogString+CurrentElementTag+"="+CurrentElementValue+";"
}
if(ItogString==""){alert("Ничего не выбрано для замены.");return}
if(window.confirm("Заменить указанные товары?")){
     var ok=#server(Docs.Action.ChangeGoodsInDoc(ItogString))#;
     if(isNaN(ok)){alert(ok)}
     else{
          alert("Товары успешно заменены.");
          window.returnValue=true;
          window.close();
          }
     }
}
</script>
</head>

<body onkeypress="ManageWindow();">
<form name="forma" id="forma">
<script language="cache" runat="server">
 n ID,GoodsFullName,Quantity,i,GoodsId,DocObj
 s DocId=%request.Get("DocId")
 s DocObj=##class(Docs.Rash).%OpenId(DocId)
 if '$ISOBJECT(DocObj) w "<P align=center style='font-size:14pt'><b>Ошибка</b> Невозможно извлечь информацию о документе "_DocId_"</p>" q
 s Name=DocObj.Name
 s KontrName=$S($ISOBJECT(DocObj.Kontr):DocObj.Kontr.Name,1:"")
 s Dat=$ZD(DocObj.Dat,4)
 s Tim=$ZT(DocObj.Tim)
 s DocStat=DocObj.Stat
 if DocStat=2 w "<P align=center style='font-size:14pt'><b>Внимание!</b> Документ уже закрыт. Замена товара невозможна</p>"
 &html<
 <table border=0 class=TABLE style="width:0" cellspacing=0>
 <tr><td class=TD>Номер<td class=TD>#(Name)#
 <tr><td class=TD>Контрагент<td class=TD>#(KontrName)#
 <tr><td class=TD>Дата<td class=TD>#(Dat)#
 <tr><td class=TD>Время<td class=TD>#(Tim)#
 </table>
 <Br>
 >
 s glob=$NA(^mtempTempGlob($I))
 k @glob
 w "<table width=100% class=TABLE cellspacing=0>"
 w "<tr><td class=TD>Исходный товар<td class=TD>Требуемое<br>количество<td class=TD>Количество<br>на складе<td class=TD>Замена"
 &sql(
      declare dfg cursor for 
      select ID,Goods->FullName,Quantity,Goods
      into :ID,:GoodsFullName,:Quantity,:GoodsId
      from Docs.DocItems 
      where Doc=:DocId
      )
 &sql(open dfg)
 f  &sql(fetch dfg) q:SQLCODE  d
 . s count=$I(count)
 . s @glob@(count,"GoodsFullName")=GoodsFullName
 . s @glob@(count,"Quantity")=Quantity
 . s @glob@(count,"ID")=ID
 . s Store=0
 . s ok=##class(Store.Action).GetQuantByGoods(ID,.Store)
 . s @glob@(count,"Store")=Store
 . s @glob@(count,"GoodsId")=GoodsId
 &sql(close dfg)
 
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . w "<tr>"
 . w "<td valign=top class=TD>"_$G(@glob@(i,"GoodsFullName"))     //имя оригинального товара
 . w "<td valign=top class=TD>"_$G(@glob@(i,"Quantity"))          //заказанное количество
 . w "<td valign=top class=TD>"_@glob@(i,"Store")                    //имеющееся количество на складе
 . s GoodsId=@glob@(i,"GoodsId")
 . s ID=@glob@(i,"ID")
 . s InputElementName="Goods"_ID
 . s InputElementId="InputElemId"_ID
 . w "<td style='padding:5' class=TD>"     //имеющиеся замены
 . w "<table class=TABLE cellspacing=0><tr style='color:gray'><td width=100% class=TD>Замена<td class=TD>Количество<br>на складе"
 . w "<tr>"
 . w "<td class=TD><input type=radio name='"_InputElementName_"' id='"_InputElementId_"' CHECKED value='0'><span style='cursor:hand' onclick='"_InputElementId_".checked=true'>Без замены</span><br>"
 . w "<td class=TD>&nbsp;"
 . &sql(declare gok cursor for select ID,Property6625,Property6625->FullName into :ZamenaID,:Property6625,:FullName from Common.Dictionary4 where Name=:GoodsId)
 . &sql(open gok)
 . f  &sql(fetch gok) q:SQLCODE  d
 . . s InputElementId="InputElemId"_ZamenaID_ID
 . . w "<tr>"
 . . w "<td class=TD><input type=radio name='"_InputElementName_"' id='"_InputElementId_"' value='"_Property6625_"' Tag='"_ID_"'><span style='cursor:hand' onclick='"_InputElementId_".checked=true'>"_FullName_"</span><br>"
 . . k Store 
 . . s ok=##class(Store.Action).GetQuantByGoods(ID,.Store)
 . . w "<td class=TD>"_+$G(Store)
 . w "</table>"
 . &sql(close gok)
 . w "</tr>",!
</script>
</table>
</form>

<csp:IF CONDITION='DocStat=2'>
<center><br><sklad:Button onclick="windowclose();" value="Отмена"></center>
<csp:ELSE>
<center><br><sklad:Button value="Заменить" onclick="startFun();"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</csp:IF>


</body>
</html>]]></CSP>


<CSP name="checkgarant.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
s instr=%request.Get("instr")
</script>
<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<style>
table{
	border-top:none;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	cellpadding:0;
	cellspacing:0;}
td{
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:none;
	border-left:.5pt solid windowtext;}
</style>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
sessionid="#(%session.SessionId)#";
window.dialogWidth=screen.availWidth+"px";

function load(){
//ddd.loadfrommethod("Docs.Action.ShowGarantHistory",1,2,3)
}

</script>
</head>
<body onload="load()" >
<table border=0 cellspacing=0 cellpadding=0 width=100%>
 <script language="cache" runat="server">
 s user=$G(%session.Data("user"),"undefined")
 s i="" f  s i=$O(^mtempCurrentRemDoc(user,"body",i)) q:i=""  d
 . s gar=$G(^mtempCurrentRemDoc(user,"body",i,"garant"))
 . q:gar=""
 . s garants(gar)=1
 s garant="" f  s garant=$O(garants(garant)) q:garant=""  d
 . i $I(i)
 . w "<tr><td colspan=99>&nbsp;</td></tr>"
 . w "<tr><td valign=top>"
 . w "<SKLAD2:table id=""PropTable"_i_""" width=""100%"" />"
 . w "</td>"
 . w "<td valign=top>"
 . w "<table cellspacing=0 cellpadding=0><tr><td>Дата ремонта<td>Запчасть<td>Количество<td>Описание поломки"
 . s gar=##class(Common.Dictionary2).%OpenId(garant)
 . if $ISOBJECT(gar) d
 . . s key=""
 . . d:$ISOBJECT(gar.remont1)
 . . . s dat=$S(gar.remont1.Dat'="":$ZD(gar.remont1.Dat,4),1:"")
 . . . s str="",ccc=1
 . . . f  Set itemobj = gar.remont1.Items.GetNext(.key) q:key=""  d
 . . . . q:itemobj.garant'=garant
 . . . . i $I(ccc)
 . . . . s str=str_"<tr><td>"_itemobj.Goods.Name_"<td>"_itemobj.Quantity_"<td>"_itemobj.Name
 . . . w "<tr><td rowspan="_ccc_">"_dat
 . . . w str
 . . s key=""
 . . d:$ISOBJECT(gar.remont2)
 . . . s dat=$S(gar.remont2.Dat'="":$ZD(gar.remont2.Dat,4),1:"")
 . . . s str="",ccc=1
 . . . f  Set itemobj = gar.remont2.Items.GetNext(.key) q:key=""  d
 . . . . q:itemobj.garant'=garant
 . . . . i $I(ccc)
 . . . . s str=str_"<tr><td>"_itemobj.Goods.Name_"<td>"_itemobj.Quantity_"<td>"_itemobj.Name
 . . . w "<tr><td rowspan="_ccc_">"_dat
 . . . w str
 . . s key=""
 . . d:$ISOBJECT(gar.remont3)
 . . . s dat=$S(gar.remont3.Dat'="":$ZD(gar.remont3.Dat,4),1:"")
 . . . s str="",ccc=1
 . . . f  Set itemobj = gar.remont3.Items.GetNext(.key) q:key=""  d
 . . . . q:itemobj.garant'=garant
 . . . . i $I(ccc)
 . . . . s str=str_"<tr><td>"_itemobj.Goods.Name_"<td>"_itemobj.Quantity_"<td>"_itemobj.Name
 . . . w "<tr><td rowspan="_ccc_">"_dat
 . . . w str
 . w "</table>"
 w "<script language=""Jscript"">"
 s i=0
 s garant="" f  s garant=$O(garants(garant)) q:garant=""  d
 . i $I(i)
 . w "PropTable"_i_".DownLoadPairs('Common.Dictionary2','"_garant_"','');"
 w "</"_"script>"
  </script>
</table>
</body>
</html>]]></CSP>


<CSP name="CheckRemontPrices.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,2) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<html XMLNS:SKLADList XMLNS:SKLADz>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var ColCodeKontr="";
var KontrId="";
var GoodsId="";
sessionid="#(%session.SessionId)#";
var where ="";
var depot="#($G(%session.Data("depot")))#";
var ShowBuyPrices="#(%request.Get("ShowBuyPrices"))#";

function load(){
currentdictKontr.LoadHeaders("City,Balance,Property831,Agree,CityCode,ContPers,EMail,Manager,Phones,WCalc,Address,Region,chief,glavbuh,fax,bank,region2,Postalcode,PostalcodeUr,Password,AddressUr,CityUr,ChangeDate,ChangeTime,ChangeUser,OtgruzPrincip");
LoadTree();
TempGoods.attachEvent("onAddColumns", addcol)
TempGoods.LoadHeaders("Property312,Property675,Property7053,Size1,Weight,codedetail,ModelNumber,EnglishName,Tovar,ChangeDate,ChangeTime,ChangeUser,Description,Composition,izdelie");
}

function addcol(){
TempGoods.detachEvent("onAddColumns", addcol)
fields=TempGoods.GetColumns("Goods->");
//TempGoods.AddColumns("quant~Количество~~~@%String#@#")
}


function LoadTree(){
CurrentClassifName.innerText = Catalogues.options(Catalogues.selectedIndex).text;
GroupsTree.AdditionalID=Catalogues.value;
//alert('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+depot+'","'+Catalogues.value+'"')
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&order=Name&params="'+depot+'","'+Catalogues.value+'"')	
}

function showdictionaryKontr(where){
var where=ReturnSpace(where);
currentdictKontr.DownLoad(where);
}

function ggKontr(){
if(ColCodeKontr=="")return false;
where = ColCodeKontr+" %STARTSWITH '"+fldvalKontr.value+"'";
if(fldvalKontr.value=="")where="";
showdictionaryKontr(where);
}

function colclickKontr(){
	if(currentdictKontr.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfldKontr.innerText=currentdictKontr.ColName;
	ColCodeKontr=currentdictKontr.ColCode;
}

function KontrClick(){
KontrName.innerText=currentdictKontr.ItemName;
KontrInstrPriceCateg.innerText=currentdictKontr.item("Property126->Name");
KontrBytPriceCateg.innerText=currentdictKontr.item("Property127->Name");
KontrId=currentdictKontr.ItemID;
if(GoodsId!="")
	{
		RemontPrice.innerText = #server(Common.Common.GetGoodRemontPriceForKontr(GoodsId,KontrId))#;
	}
}


function GroupsTreeClick(){
	CurrentGroupName.innerText=GroupsTree.NodeCaption;
	AddFromGroup();
}

function AddFromGroup(){
var whereTovar="Groups='"+GroupsTree.NodeID+"'"
var ShowQuantityVar=0;
//alert(fields)
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",whereTovar,fields,ShowQuantityVar+ShowBuyPrices)
}

//поиск товара по параметрам
function SearchByParams(){
var whereTovar = "";
var Abbr = AbbrField.value;
var Property3609 = Property3609Field.value;
var Name = NameField.value;

if(Abbr!="")
{
	whereTovar="Goods->Abbr %Startswith '" + Abbr + "'";
}

if(Property3609!="")
{
	if(whereTovar!=""){whereTovar=whereTovar+" and Goods->Property3609 %Startswith '" + Property3609 + "'";}
	else{whereTovar=" Goods->Property3609 %Startswith '" + Property3609 + "'";}
}

if(Name!="")
{
	if(whereTovar!=""){whereTovar=whereTovar+" and Goods->Name %Startswith '" + Name + "'";}
	else{whereTovar = " Goods->Name %Startswith '" + Name + "'";}
}

if(whereTovar=="")
{
	alert("Не указано ни одного параметра для отбора");
	return
}

var ShowQuantityVar=0;
var whereTovar=whereTovar+" and Groups->Depot='"+depot+"' and Groups->Catalogue = '"+Catalogues.value+"'";
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",whereTovar,fields,ShowQuantityVar+ShowBuyPrices)
}

function GoodsClick(){
GoodsId = TempGoods.ItemID;
CurrentGoodsName.innerText = TempGoods.item("FullName");
GoodsPriceCateg.innerText = #server(Goods.GoodsAction.GetGoodsPriceCateg(GoodsId))#;
if(KontrId!="")
	{
		RemontPrice.innerText = #server(Common.Common.GetGoodRemontPriceForKontr(GoodsId,KontrId))#;
	}
}
</script>
</head>
<body onload="load()">
<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Проверка цен за ремонт</strong></TD>
<td width=10% align=right><a href="help/Platej.html"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>
<br>
<Table width=100%>
<tr>
	<td valign="top">
		<fieldset><legend>Товары</legend>
		Классификатор:<select id="Catalogues" onchange="LoadTree()" >
		<script language="cache" runat="server">
			w ##class(Docs.Action2).GetClassValuesOptions(,"Goods.Catalogue",,,0)
		</script>
		</select><br>
  		<SKLADz:treeview id="GroupsTree" width="200" height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="GroupsTreeClick();" /><br>
		<fieldset><legend>Поиск</legend>
  			Аббревиатура: <input type="text" id="AbbrField" style="width:35px" title="Достаточно ввести начальные буквы аббревиатуры">  Модель: <input type="text" id="Property3609Field" style="width:40px" title="Достаточно ввести начальные цифры модели"> Наименование: <input type="text" id="NameField" style="width:100px" title="Достаточно ввести начальные буквы названия"> <input type="button" value="Найти" style="width:50px" title="Поиск ведётся только по тем полям которые заполнены" onclick="SearchByParams()">
  		</fieldset>
  		<SKLADList:listview width=100% height=130 id="TempGoods"  ClassName="Goods.Goods" AddOnClear="false" zonDblClick="ReturnSelected();"  AddHeaders="true" zClick="GoodsClick()"/><br>
		</fieldset>
	</td>
	<td valign="top">
		<fieldset><legend>Контрагенты</legend>
		Поиск:
		<span id="namfldKontr"></span>&nbsp;<input type="text" id="fldvalKontr" onkeyup="ggKontr();">
		<SKLADList:listview width=100% height=350 id="currentdictKontr" zClick="KontrClick()" zonColumnClick="colclickKontr()" onAddColumns="showdictionaryKontr()" ClassName="Common.Kontragent"/><br>
		</fieldset>
	</td>
</tr>
<tr>
	<td valign="top">
		<span  style="color:#001188" id="CurrentClassifName"></span>&nbsp; - <span style="color:#001188" id="CurrentGroupName">выберете группу</span>&nbsp; - <span style="color:#001188" id="CurrentGoodsName">выберете товар</span>
	<td valign="top" BGCOLOR ="#eeeeee">
		<span id="KontrName" style="color:#001188">Выберете контрагента</span>
</tr>
<tr>
	<td colspan=2 align=center><hr width="80%">
</td>
<tr>
	<td valign="top">
		<span style="color:#444444">Ценовая группа товара </span> <span id="GoodsPriceCateg" style="color:#001188"></span><br>
	<td valign="top" BGCOLOR ="#eeeeee">
		<span style="color:#444444">Категория цен электроинструмент </span> <span id="KontrInstrPriceCateg" style="color:#001188"></span><br>
		<center><hr width="80%"></center>
		<span style="color:#444444">Категория цен бытовая техника </span> <span id="KontrBytPriceCateg" style="color:#001188"></span><br>
	
</tr>
<tr>
	<td colspan=2 align=center><hr width="80%">Цена за ремонт: <font face="Arial" size="4" color="blue" id="RemontPrice"></font>
</td>
</table>
</body>
</html>
]]></CSP>


<CSP name="CheckSerial.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 d:%session.NewSession 
 . s %session.EndSession=1
 . s ses=%request.Get("sessionid",1)
 . s %session=%session.GetSession(ses)
 
 s ShowExcel= %request.Get("ShowExcel")
 s FormFilled = +%request.Get("FormFilled")
 
 if (FormFilled)&&(ShowExcel)
 {
 	set filename=$P($ZD($H,1),"/")_"_"_$P($ZD($H,9)," ")_"_"_(+$ZD($h,3))
 	set %response.ContentType = "application/msexcel"
 	do %response.SetHeader("Content-Disposition","attachment; filename="_filename_".xls")
 	set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 }
 
 q 1
</script>
<script language="Cache" method="ShowFileData" arguments="" returntype="%String">
 if %request.ContentType'="multipart/form-data" q ""
 s obj=$G(%request.MimeData("file1",1))
 q:'$ISOBJECT(obj) ""
 
 s glob=$NA(^Common.Dictionary2I("serialInd"))
 s ListIndex("Property9194") = ##class(Common.Dictionary2).GetPropertyListIndex("Property9194",.DataLocation)
 s ListIndex("Comment") = ##class(Common.Dictionary2).GetPropertyListIndex("Comment",.DataLocation)
 s ListIndex("tovar") = ##class(Common.Dictionary2).GetPropertyListIndex("tovar",.DataLocation)
 s ListIndex("remont1") = ##class(Common.Dictionary2).GetPropertyListIndex("remont1",.DataLocation)
 
 s cl="Common.Dictionary2||Property9194"
 d ##class(Docs.Action2).GetDisplayListArray(cl,.Property9194Array)

 w "<br><br><table border=1 cellpadding=6 cellspacing=0>",!
 w "<tr>"
 	_"<td>№ п/п"
 	_"<td>Серийный номер"
 	//_"<td>Гарантийный номер"
 	_"<td>Актуальность"
 	_"<td>Наличие заявки"
 	_"<td>Модель"
 	_"<td>Примечание"
 	_"<td>Дубль серийного номера"
 	_"</tr>"
 while ('obj.AtEnd)
 {
	s serial=obj.ReadLine(32000)
	if serial="" continue
	s (garantStr,actual,comment,Model,HasRequest)="Не найден"
	s ID=""
	s color="#FFFFFF"
	s SearchString = " "_$ZCVT(serial,"U")
	i $I(CountLines)     
	
 	//если данные есть
 	if $D(@glob@(SearchString))
 	{
 		s ID = $O(@glob@(SearchString,""))
 		if ID'=""
 		{
	 		s Property9194 = ##class(Common.Dictionary2).GetPropertyValue(ID,"Property9194",ListIndex("Property9194"),.DataLocation)
	 		s actual=$G(Property9194Array(Property9194))
	 		
	 		s garant=$LG(@glob@(SearchString,ID),2)
	 		s garantStr=$S('ShowExcel:"<a href=""javascript:s('"_ID_"')"">",1:"")
	 		s garantStr=garantStr_garant
	 		s garantStr=garantStr_$S('ShowExcel:"</a>",1:"")
	 		
	 		s comment=##class(Common.Dictionary2).GetPropertyValue(ID,"Comment",ListIndex("Comment"),.DataLocation)
	 		if Property9194=2 s color="#DEDEDE"
	 		s Model = ##class(Common.Dictionary2).GetPropertyValue(ID,"tovar",ListIndex("tovar"),.DataLocation)
	 		s remont1 = ##class(Common.Dictionary2).GetPropertyValue(ID,"remont1",ListIndex("remont1"),.DataLocation)
	 		if remont1'="" s HasRequest="есть"
	 		else  s HasRequest="нет"
 		}
 	}
 	w "<tr bgcolor="""_color_""">"
 	w "<td>"_CountLines
 	w "<td>"
 	if 'ShowExcel,$G(ID)'="" w $S('ShowExcel:"<a href=""javascript:s('"_$G(ID)_"')"">",1:"")
 	w serial
 	if 'ShowExcel,$G(ID)'="" w $S('ShowExcel:"</a>",1:"")
 	w "<td>"_actual
 	w "<td>"_HasRequest
 	w "<td>"_Model
 	w "<td>"_comment_"&nbsp;"
 	w "<td>"_$G(Serials(SearchString))_"&nbsp;"
 	w "</tr>"
 	
 	if '$D(Serials(SearchString)) s Serials(SearchString)=+$G(CountLines)
 }
 w "</table>",!
 Quit ""
</script>

<html>
<head>
<CSP:IF CONDITION="'ShowExcel">	
	<link href="style.css" type=text/css rel=stylesheet>
</CSP:IF>	
<!-- Put your page Title here -->
<title>	Проверка действительности серийных номеров </title>
<script language="javascript" type="text/javascript">

function s(currentrecord)
{
	ok=window.showModalDialog("garant.csp?GarantId="+currentrecord,currentrecord+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}
</script>
</head>

<body TOPMARGIN=25 LEFTMARGIN=25>
<CSP:IF CONDITION="'ShowExcel">
	<sklad:Button value="Товары" onclick="window.location.href='goods.csp'">
	<sklad:Button value="Управление серийными номерами" onclick="window.location.href='serials.csp'" style="width:250px"><br>
	<br><br>
	<TABLE cellSpacing=0 width="100%" celpadding="0" >
	<TR>
	<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
	<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Проверка серийных номеров в текстовом файле</strong></TD>
	<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
	</tr>
	</TABLE>
</CSP:IF>

<CSP:IF CONDITION="FormFilled=0">
	<form enctype="multipart/form-data" method="post">
	Укажите текстовый файл со списком серийных номеров <input type="file" name="file1">
	<input type="hidden" name="FormFilled" value="1">
	<br><font size="-1" size="Grey">* Каждый серийный номер должен располагаться на новой строке</font>
	<br>Открыть результат в Microsoft Excel <input type="checkbox" name="ShowExcel" value="1" style="border:none">
	<br><br> <input type="submit" value="Проверить указанный файл" style="width:200px">
	</form>
<CSP:ELSE>
	<script language="cache" runat="server">
	d ..ShowFileData()
	
	</script>
	 <CSP:IF CONDITION="'ShowExcel">	
		 <br><br>
		 <a href="?">Вернуться к выбору файла</a>
	 </CSP:IF>
</CSP:IF>
</body>
</html>
]]></CSP>


<CSP name="CheckSerial2.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 d:%session.NewSession 
 . s %session.EndSession=1
 . s ses=%request.Get("sessionid",1)
 . s %session=%session.GetSession(ses)
 
 s ShowExcel= +%request.Get("ShowExcel")
 s FormFilled = +%request.Get("FormFilled")
 
 if (FormFilled)&&(ShowExcel)
 {
 	set filename=$P($ZD($H,1),"/")_"_"_$P($ZD($H,9)," ")_"_"_(+$ZD($h,3))
 	set %response.ContentType = "application/msexcel"
 	do %response.SetHeader("Content-Disposition","attachment; filename="_filename_".xls")
 	set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 }
 
 q 1
</script>
<script language="Cache" method="ShowFileData" arguments="" returntype="%String">
 if %request.ContentType'="multipart/form-data" q ""
 s obj=$G(%request.MimeData("file1",1))
 q:'$ISOBJECT(obj) ""
 
 s glob=$NA(^Common.Dictionary2I("serialInd"))
 s ListIndex("Property9194") = ##class(Common.Dictionary2).GetPropertyListIndex("Property9194",.DataLocation)
 s ListIndex("Comment") = ##class(Common.Dictionary2).GetPropertyListIndex("Comment",.DataLocation)
 s ListIndex("tovar") = ##class(Common.Dictionary2).GetPropertyListIndex("tovar",.DataLocation)
 s ListIndex("remont1") = ##class(Common.Dictionary2).GetPropertyListIndex("remont1",.DataLocation)
 
 s cl="Common.Dictionary2||Property9194"
 d ##class(Docs.Action2).GetDisplayListArray(cl,.Property9194Array)

 w "<br><br><table border=1 cellpadding=6 cellspacing=0>",!
 w "<tr>"
 	_"<td>№ п/п"
 	_"<td>Серийный номер"
 	//_"<td>Гарантийный номер"
 	_"<td>Актуальность"
 	_"<td>Наличие заявки"
 	_"<td>Модель"
 	_"<td>Примечание"
 	_"<td>Дубль серийного номера"
 	_"</tr>"
 while ('obj.AtEnd)
 {
	s serial=obj.ReadLine(32000)
	if serial="" continue
	s (garantStr,actual,comment,Model,HasRequest)="Не найден"
	s ID=""
	s color="#FFFFFF"
	s SearchString = " "_$ZCVT(serial,"U")
	i $I(CountLines)     
	
 	//если данные есть
 	if $D(@glob@(SearchString))
 	{
 		
	 	s ID = $O(@glob@(SearchString,""))
		if ID'=""
		{	
	 		s Property9194 = ##class(Common.Dictionary2).GetPropertyValue(ID,"Property9194",ListIndex("Property9194"),.DataLocation)
	 		s actual=$G(Property9194Array(Property9194))
	 		
	 		s garant=$LG(@glob@(SearchString,ID),2)
	 		s garantStr=$S('ShowExcel:"<a href=""javascript:s('"_ID_"')"">",1:"")
	 		s garantStr=garantStr_garant
	 		s garantStr=garantStr_$S('ShowExcel:"</a>",1:"")
	 		
	 		s comment=##class(Common.Dictionary2).GetPropertyValue(ID,"Comment",ListIndex("Comment"),.DataLocation)
	 		if Property9194=2 s color="#DEDEDE"
	 		s Model = ##class(Common.Dictionary2).GetPropertyValue(ID,"tovar",ListIndex("tovar"),.DataLocation)
	 		s remont1 = ##class(Common.Dictionary2).GetPropertyValue(ID,"remont1",ListIndex("remont1"),.DataLocation)
	 		if remont1'="" s HasRequest="<b>есть</b>"
	 		else  s HasRequest="нет"
		}
 	}
 	w "<tr bgcolor="""_color_""">"
 	w "<td>"_CountLines
 	w "<td>"
 	if 'ShowExcel,$G(ID)'="" w $S('ShowExcel:"<a href=""javascript:s('"_$G(ID)_"')"">",1:"")
 	w serial
 	if 'ShowExcel,$G(ID)'="" w $S('ShowExcel:"</a>",1:"")
 	w "<td>"_actual
 	w "<td>"_HasRequest
 	w "<td>"_Model
 	w "<td>"_comment_"&nbsp;"
 	w "<td>"_$G(Serials(SearchString))_"&nbsp;"
 	w "</tr>"
 	
 	if '$D(Serials(SearchString)) s Serials(SearchString)=+$G(CountLines)
 }
 w "</table>",!
 Quit ""
</script>

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=windows-1251" />
<CSP:IF CONDITION="'ShowExcel">	
	<link href="style.css" type=text/css rel=stylesheet>
</CSP:IF>	
<title>	Проверка действительности серийных номеров </title>
<script language="javascript" type="text/javascript">
var sessionid="#(%session.SessionId)#";

function s(currentrecord)
{
	ok=window.showModalDialog("garant.csp?sessionid="+sessionid+"&GarantId="+currentrecord,currentrecord+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}
</script>
</head>

<body TOPMARGIN=25 LEFTMARGIN=25>
<script language="cache" runat="server">
	d ..ShowFileData()
</script>
</body>
</html>
]]></CSP>


<CSP name="chief.csp" application="/csp/sklad2/" default="1"><![CDATA[
<csp:class includes="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s DaysCount = $$$TunesVariableGlobal("ShowInstrReminder")
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,2) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<script language="Cache" method="WriteInstrField" arguments="ID:%String,Answer:%String,Field" returntype="%String">
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 if (Field="BrakCommentAnswer")
 {
	 s obj.BrakCommentAnswer = Answer
	 d:+$G(%session.Data("user")) obj.BrakCommentAnswerUserSetObjectId(%session.Data("user"))
	 s obj.BrakCommentAnswerDat = +$H
 }
 if (Field="RefuseReason")
 {
	 s obj.RefuseReason = Answer
	 d:+$G(%session.Data("user")) obj.RefuseReasonUserSetObjectId(%session.Data("user"))
	 s obj.RefuseReasonDat = +$H
 }
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
</script>
<html XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
input{border:none;width:15px}
</style>
<script language="jscript" src="common.js"></script>
<script language="javascript" type="text/javascript" src="js/jquery-1.8.2.min.js"></script>

<script language="Jscript">
var CardId=""; //условие для отбора товаров
sessionid="#(%session.SessionId)#";
var j = new Array();

//при загрузке страницы
function load()
{
	hideplan.checked=ReturnBoolean(GetCookie("hideplanchecked"));
	hideGoods.checked=ReturnBoolean(GetCookie("hideGoodschecked"));
		plan.LoadHeaders("Parent,Comment");
		instr.LoadHeaders("Doc,DocType,Tim,Dat,Summa,Stat,Operation");
	//docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,garant,sn,seller");
	
	var Captions = new Array(6);
	var Keys = new Array(6);
	var Tags = new Array(6);
	
	Captions[0]="Товар";
	Captions[1]="Количество";
	Captions[2]="Серийный номер";
	Captions[3]="Гарантийный талон";
	Captions[4]="Поломка";
	Captions[5]="Продавец";
	Captions[6]="Дата";
	Captions[7]="Комментарий";
	
	
	Tags[0]="Goods.Goods";
	Tags[1]="%Numeric";
	Tags[2]="%String";
	Tags[3]="%String";
	Tags[4]="%String";
	Tags[5]="%String";
	Tags[6]="%String";
	Tags[7]="%String";
	
	Keys[0]="Goods";
	Keys[1]="Quantity";
	Keys[3]="garant";
	Keys[2]="sn";
	Keys[4]="opispolomki";
	Keys[5]="seller";
	Keys[6]="SellDate2";
	Keys[7]="BrakComment";
	
	
	docstr.DrawHeaders(Captions,Keys,Tags);
	
	hideplanFn();
	hideGoodsFn();
	FillInstrReminder();	//проверить пропущенные инструкции
}

function ItemPlan(PlanID){
PlanID=ReturnSpace(PlanID)
WinResult=window.showModalDialog("PlanIgrid.csp?source="+PlanID,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
if(WinResult==1)ShowPlan();
}

function ShowPlan(){
var Data1=ConvertDateSql(dat1.value);
var Data2=ConvertDateSql(dat2.value);
plan.DownLoad("PlanDate2>=CAST('"+Data1+"' AS DATE) AND PlanDate<=CAST('"+Data2+"' AS DATE)");
}

function DelItem(){
	if(!window.confirm("Вы хотите удалить выбранный пункт?")){return false;}
	ok=#server(Docs.Action.deletedoc(plan.ClassName,plan.ItemID))#
	if(ok==1){ShowPlan();}
	else{alert(ok)}
}

function ShowInstr()
{
	var Data1=ConvertDateSql(dat11.value);
	var Data2=ConvertDateSql(dat21.value);
	var InstrCommentVar="";
	if(qwer.value!="")
	{
		var stat="and State="+qwer.value;
		if(qwer.value=="all")var stat="";
	}
	else
	{
		var stat="and State<9";
	}
	if(InstrComment.value!=""){var InstrCommentVar=" and Name %STARTSWITH '"+InstrComment.value+"'"}
	var variable="InstDate>=CAST('"+Data1+"' AS DATE) and InstDate<=CAST('"+Data2+"' AS DATE) "+stat+InstrCommentVar
	
	var currentKontragent=ChooseKontragent.value;
	if(currentKontragent!="all"){var variable=variable+" and Kontr="+currentKontragent}
	
	var varInstrSortField = InstrSortField.value;	//поле по которому сортируем
	variable = variable+ " order by Operation.Instructions."+varInstrSortField;
	
	instr.DownLoad(variable);
}

function ItemInstr(item,source){
	item=ReturnSpace(item)
	//source=ReturnSpace(source)
	//var CspFile="createinstruct.csp";
	//if(OpenIGrid.checked){}
	var CspFile="createinstructIgrid.csp";var source=item;
	mok=window.showModalDialog(CspFile+"?source="+source,item+";"+instr.ClassName,"center:yes;status:no;dialogHeight:600px;dialogWidth:720px;resizable:yes;")
	if(mok==1){ShowInstr()}
}

// удалить инструкцию
function DelItemInstr(){
	if(!window.confirm("Вы хотите удалить инструкцию '"+instr.ItemName+"'?")){return false;}
	DelInstrDocs();
	ok=#server(Docs.Action.deletedoc(instr.ClassName,instr.ItemID))#
	if(ok==1){ShowInstr();}
	else{alert(ok)}
}

//удалить документы инструкции 
function DelInstrDocs(){
	if(!window.confirm("Вы хотите удалить все документы инструкции руководителя "+instr.ItemName+"?")){return false;}
	var ok=#server(Operation.InstrActions.DeleteInstrChildren(instr.ItemID))#
	if(ok==1){alert("Все документы инструкции руководителя "+instr.ItemName+" успешно удалены.");}
	else{alert(ok)}
}

function showtovsins(){
	ItemID = instr.ItemID;
	CardId=ItemID+"@"+instr.ClassName;
	//tovars.LoadHeaders();
	docstr.Clear()
	loadgoods(ItemID);
	$.get("Commands.csp?command=InstrData&ID="+ItemID,function(data){$("#InstrData").text(data);});
}

function LoadGoodsFromCard(){
	tovars.GetFromCard(CardId);
}

//вывести на печать внутреннюю инструкцию
function lookinnerinstr(ItemID)
{
	window.open("PrintInnerFromChief.csp?super="+ItemID+"&sessionid="+sessionid)
}

function changestat(newstat){
	var HasBeenSent="";
	if(newstat==9)
	{
		var InstrType=#server(Operation.InstrActions.GetInstrType(instr.ItemID))#	
		if((InstrType==4)||(InstrType==10)||(InstrType==11))
		{
			var answer=window.confirm("Поставить инструкции "+instr.ItemName+" статус 'Отправлена'?")
			if(answer){var HasBeenSent=1;}
			else{var HasBeenSent=0;}
			
		}
	}
	ok=#server(Operation.InstrActions.changestat(instr.ItemID,newstat,HasBeenSent))#
	if(ok.split("@")[0]!=1){alert(ok)}
	else
	{
		//если требовали завершить и все успешно
		if(newstat==9)
		{
			instr.DelItems()
		}	
		
		if(newstat==2)
		{
			instr.ChangeCell("State",ok.split("@")[1])
			alert("Инструкция руководителя утверждена");
		}
		
		//отклонение заявки
		if(newstat==8.6)
		{
			SetInstrField(instr.ItemID,'RefuseReason','Пояснения контрагенту о причинах отклонения заявки','Причины отклонения сохранены');
		}
	}
}

function lookhist(instrItemID){
window.showModalDialog("instrhistory.csp?instr="+instrItemID,"","center:yes;status:no;dialogHeight:300px;dialogWidth:600px;resizable:yes;")
}

function loadgoods(DocID){
if(!hideGoods.checked){
	docstr.loadfrommethod("Docs.Action2.ChiefInstructStr",DocID);
	}
}

// создание дочерних документов от инструкции
function doc()
{
	ok=#server(Docs.Action.DocFromInstr(instr.ItemID))#
	if(isNaN(ok)){alert(ok)}
	else{alert("Документ успешно создан")}
}

// при закрытии окна
function unload(){
	//plan.saveColunmsSettings();
	//instr.saveColunmsSettings();
}

//Клонировать инструкцию
function CopyInstr(instrItemID){
if(ReturnSpace(instrItemID)==""){return }
var ok=#server(Docs.Action.CloneDoc(instrItemID))#
if(isNaN(ok)){alert(ok)}
else{ShowInstr()}
}

//Создать инструкцию на основе плана
function InstrFromPlan(){
//'',plan.ItemID+'@'+plan.ClassName
if(!window.confirm("Создать инструкцию на основе плана?"))return;
var InstrId=#server(Operation.InstrActions.InstrFromPlan(plan.ItemID))#
if(InstrId=="PlanIsClosed")
	{
	if(window.confirm("На основе плана уже была создана инструкция, вы хотите создать ещё одну?"))
		{
		var InstrId=#server(Operation.InstrActions.InstrFromPlan(plan.ItemID,1))#
		}
	else
		{
		return
		}
	}
if(isNaN(InstrId)){alert(InstrId);}
else{ItemInstr(InstrId);ShowPlan();}
}

//скрыть показать план руководителя
function hideplanFn(){
if(hideplan.checked){planfield.style.display="none";}
else{planfield.style.display="inline";}
SetCookie("hideplanchecked",hideplan.checked);
}

//скрыть показать товары инструкций
function hideGoodsFn(){
if(hideGoods.checked){GoodsField.style.display="none";}
else{GoodsField.style.display="inline";}
SetCookie("hideGoodschecked",hideGoods.checked);
}

function PrintPlanFn(){
if(ReturnSpace(plan.ItemID)=="")return
window.open("screen/ChiefPlanHtml.csp?docid="+plan.ItemID)
}

function PrintInstr(ItemID){
if(ReturnSpace(ItemID)=="")return
window.open("screen/ChiefInstr.csp?docid="+ItemID);
}

// Выбрать контрагента
function ChooseKontragentFunc()
{
	var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
	if(UsersSelection=="choose")
	{
		var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
		if(newKontragent==null){
			ChooseKontragent.selectedIndex=0;
			return false;}
		var ChooseKontragentLength = ChooseKontragent.options.length;
		ChooseKontragent.options.length= ChooseKontragentLength + 1;
		ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
		ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
		ChooseKontragent.selectedIndex=ChooseKontragentLength;
	}
}

function FillInstrReminder()
{
	var ButtonString = "<br><input type='button' style='width:300px' value='проверить пропущенные заявки' onclick='FillInstrReminder();'>"
	var count = #server(Operation.InstrActions.GetInstrReminderText(1))#;
	if (count==0)
	{
		InstrReminder.innerHTML = "Нет пропущенных заявок" + ButtonString;
		return;
	}
	var str = #server(Operation.InstrActions.GetInstrReminderText())#;
	if (str != "")
	{
		InstrReminder.innerHTML = "<p style='color:#de1111'>Внимание! Некоторые инструкции не завершены или не отклонены более #($G(DaysCount))# дней:</p>"
		+	str 
		+ ButtonString;
	}
}

//сервис менеджер отвечает на негативный отзыв контрагента
function SetInstrField(DocId,Field,Description,SuccessMessage)
{
	var Answer = window.prompt(Description,"");	
	if (Answer==null) return;
	ok = #server(..WriteInstrField(DocId,Answer,Field))#
	if (isNaN(ok)){alert(ok);}
	else{alert(SuccessMessage);}
}

//указанное поле документа в отдельном окне
function ShowFieldFn(DocId,Class,PropertyName)
{
	window.showModalDialog("Info.csp?docid="+DocId+"&class="+Class+"&property="+PropertyName,"","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}

function RefuseInstr(InstrId)
{
	if(!window.confirm("Отклонить заявку " + instr.ItemName + " ?"))return;
	changestat('8.6');
}

function ShowFoto()
{
	var ItemID = instr.ItemID;
	var DocId = #server(Operation.InstrActions.GetInnerInstr(ItemID))#;
	if(!isNaN(DocId)) window.open("DocImages.csp?DocId="+DocId);
}

/// показать гарантийные талоны данной заявки
function ShowGarantsFromRequest()
{
	var iid=instr.ItemID; if (!iid) { alert("Выберите инструкцию!"); return; } 
	//window.open("csp.ReqWar2.cls?id="+iid);
	window.showModelessDialog("csp.ReqWar2.cls?id="+iid
   	,iid+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:1000px;resizable:yes;");
}
</script>
<script language="VBScript">
Sub OpenExcel(docid)
if docid="" then Exit Sub
dim objXML,objExcel
set objXML = CreateObject("Msxml2.DOMDocument.3.0")
objXML.async = false
objXML.validateOnParse = false
If objXML.parseError.errorCode <> 0 Then msgbox("Ошибка анализа XML" & vbCr & objXML.parseError.reason)
res=objXML.load("screen/ChiefPlanXml.csp?docid="&docid)
If objXML.parseError.errorCode <> 0 Then
	msgbox("Ошибка XML" & vbCr & objXML.parseError.reason)
	Exit Sub
End If
'if(xmlobj.selectSingleNode("root/comment")!=null){
'	var xmlcomment=xmlobj.selectSingleNode("root/comment").text;
'	if(xmlcomment!="")alert(xmlcomment)}

Set objExcel = CreateObject("Excel.Application")
objExcel.Visible = True
Set objWorkbook = objExcel.Workbooks.Add
'SheetsCount=objWorkbook.Sheets.Count

set oNodeList = objXML.selectNodes("//AllObjects/*")
For i=0 To (oNodeList.length-1)
	CurrentSheetNumber = (i+1)
	if i>(objWorkbook.Sheets.Count-1) Then 
		objWorkbook.Sheets.Add
		CurrentSheetNumber = 3
	end if
	Set objWorksheet = objWorkbook.Worksheets(CurrentSheetNumber)
	set currentobj=oNodeList.item(i)
	ModelName = currentobj.selectSingleNode("Model/Name").text
	ModelCode = currentobj.selectSingleNode("Model/Code").text
	objWorksheet.Name = ModelCode
	objExcel.Workbooks(1).Sheets(CurrentSheetNumber).Select
	objWorksheet.Cells(1, 2).Value = ModelCode & " " & ModelName
	set Parts = currentobj.selectNodes("Parts/*")
	For z=0 To (Parts.length-1)
		set currentpart = Parts.item(z)
		objWorksheet.Cells((z+3), 1).Value = currentpart.selectSingleNode("Number").getAttribute("Text")
		objWorksheet.Cells((z+3), 2).Value = currentpart.selectSingleNode("Name").getAttribute("Text")
		objWorksheet.Cells((z+3), 3).Value = currentpart.selectSingleNode("Pos").getAttribute("Text")
		objWorksheet.Cells((z+3), 4).Value = currentpart.selectSingleNode("Quantity").getAttribute("Text")
	Next
	objWorksheet.Columns("A:A").ColumnWidth = 8.43
	objWorksheet.Columns("B:B").ColumnWidth = 35.71
	objWorksheet.Columns("C:C").ColumnWidth = 22.29
	objWorksheet.Columns("D:D").ColumnWidth = 15.29
	zRange="A2:D"&(z+2)
	objWorksheet.Range(zRange).Select
	for z=7 To 12
		objExcel.Selection.Borders(z).Weight = 2
	Next
	objWorksheet.Cells(2, 1).Value = "No"
	objWorksheet.Cells(2, 2).Value = "Part name"
	objWorksheet.Cells(2, 3).Value = "№"
	objWorksheet.Cells(2, 4).Value = "Quantity"
	objWorksheet.Range("A1:D2").Select
	objExcel.Selection.Font.Size=14
	objExcel.Selection.Font.Bold = True
Next
End Sub
</script>
</head>
<body onload="load()" onunload="unload()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Рабочее место сервис менеджера</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>
<br>


<!--  Таблица с планами   -->
<input type="checkbox" id="hideplan" onclick="hideplanFn()"> Скрыть план руководителя
<fieldset id="planfield"><legend>План</legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<sklad:LittleButton name="ok" id="okbut1" onclick="ShowPlan()" alt="Показать записи"><br>
 <SKLADList:listview width=100% height=100 id="plan" onAddColumns="ShowPlan()" ClassName="Operation.Plan" zonDblClick="ItemPlan(plan.ItemID)" /><br>
  <table width=100% ><tr><td width=100%>
  <sklad:LittleButton name="new" id="newtov1" onclick="ItemPlan()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="edititem" onclick="ItemPlan(plan.ItemID)" alt="Редактировать запись">
  <sklad:LittleButton name="down" id="deltov78" onclick="InstrFromPlan()" alt="Создать инструкцию">
  <sklad:LittleButton name="print" id="printpan" onclick="PrintPlanFn()" alt="Распечатать план">
  <sklad:LittleButton name="excel" id="btnOpenExcel" onclick="OpenExcel(plan.ItemID)" alt="Открыть в Excel">
  </td>
  <td>
  <sklad:LittleButton name="del" id="deltov1" onclick="DelItem()" alt="Удалить запись">
  </td>
  </tr>
  </table>
</fieldset>
<br>

<!--  Таблица с инструкциями   -->
<fieldset ><legend>Инструкции</legend>
<table>
<tr>
	<td><b>Период</b>
	<td><b>Статус</b>
	<td><b>Контрагент</b>
	<td><b>Номер</b>
	<td><b>Сортировка</b>
	<td>&nbsp;
</tr>
<tr>
	<td>c <input type=text id="dat11" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat21" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	<td>
		<script language="cache" runat="server">
		w "<select id=""qwer"">"
		w ##class(Docs.Action2).GetDisplaylistOptions("","Operation.Instructions||State")
		w "<option value=""all"">Все включая завершённые</option>"
		w "</select>"
		</script>
	<td>
		<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
			<option value="all">Все</option>
			<option value="choose">Выбрать контрагента...</option>
		</select>
	<td><input type=text id="InstrComment" name="InstrComment" style="border:solid 1 black;width:50px" title="Для поиска можно вводить лишь первые символы номера">
	<td>
	<select id="InstrSortField">
		<option value="Name">Номер</option>
		<option value="InstDate">Дата</option>
	</select>
	<td><sklad:LittleButton name="ok" id="okbut11" onclick="ShowInstr()" alt="Показать записи">
</tr>
</table>
<SKLADList:listview width=100% height=300 id="instr" onAddColumns="ShowInstr()" ClassName="Operation.Instructions" zonDblClick="ItemInstr(instr.ItemID)" zClick="showtovsins()" Skip="Source->Name,child->Name" SaveSort="false"/>
  <table width=100%><tr><td width=80%>
	  <sklad:LittleButton name="new" id="newtov" onclick="ItemInstr()" alt="Создать запись">
	  <sklad:LittleButton name="edit" id="edittov" onclick="ItemInstr(instr.ItemID)" alt="Редактировать запись">
	  <sklad:LittleButton name="ok2" id="approve" onclick="changestat('2')" alt="Утвердить">
	  <sklad:LittleButton name="calendar" id="eltov" onclick="lookinnerinstr(instr.ItemID)" alt="Просмотр внутренней инструкции">
	  <sklad:LittleButton name="history" id="lookhistory" onclick="lookhist(instr.ItemID)" alt="История инструкции">
	  <sklad:LittleButton name="ok" id="fin" onclick="if(window.confirm('Завершить заявку ?')){changestat('9')}" alt="Завершить">
	  <sklad:LittleButton name="txt" id="tx" onclick="doc()" alt="Создать документ на основании инструкции">
	  <sklad:LittleButton name="copy" id="copyInstr" onclick="CopyInstr(instr.ItemID)" alt="Копировать инстукцию">
	  <sklad:LittleButton name="print" id="printInstr" onclick="PrintInstr(instr.ItemID)" alt="Печать инстукции">
	  <sklad:LittleButton name="savestore" id="btnShowFoto" onclick="ShowFoto(instr.ItemID)" alt="Показать фотографии внутренней инструкции">
	  
	  <img src="images/VertDelimeter.gif">
	  	<sklad:LittleButton name="info" id="btnLookBrakComment" onclick="ShowFieldFn(instr.ItemID,'Operation.Instructions','BrakComment')" alt="Показать негативный отзыв контрагента">
		<sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetInstrField(instr.ItemID,'SetBrakAnswer','Ответ на негативный отзыв','Ответ на негативный отзыв сохранён')" alt="Ответить на негативный отзыв">
		<sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowFieldFn(instr.ItemID,'Operation.Instructions','BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
		<sklad:LittleButton name="search" id="btnShowGarantsFromRequest" onclick="ShowGarantsFromRequest()" alt="Проверить серийные номера" >
	  <img src="images/VertDelimeter.gif">
	  	<sklad:LittleButton name="stop" id="btnStop" onclick="RefuseInstr(instr.ItemID)" alt="Отклонить заявку">
  </td><td width=20% align=right>
  <sklad:LittleButton name="del" id="deltov" onclick="DelItemInstr()" alt="Удалить запись">
  <sklad:LittleButton name="del+" id="deltov2" onclick="DelInstrDocs()" alt="Удалить все документы инструкции руководителя">
  </td></tr></table>
  <!--
  <sklad:LittleButton name="ok" id="acceptinstr" onclick="changestat()" alt="Подтвердить завершение"><br>  
  -->
</fieldset>


<!--  Таблица с товарами   -->
<input type="checkbox" id="hideGoods" onclick="hideGoodsFn()"> Не выводить товары
<fieldset id="GoodsField"><legend>Товары инструкции <div id="InstrData" style="display:inline;color:darkblue"></div></legend>
<!--
<SKLADList:listview width=100% height=100 id="tovars" onAddColumns="LoadGoodsFromCard()" ClassName="Goods.Goods"/><br>
<SKLAD2:table id="docstr" width=100% height=100 ClassName="Operation.InstructionsItems" />
-->
<SKLADiGrid:iGrid id="docstr" width="100%" height="200" Enabled="true"/>
</fieldset>
<span id="InstrReminder"></span>
</body>
</html>]]></CSP>


<CSP name="chief_new.csp" application="/csp/sklad2/" default="1"><![CDATA[
<csp:class includes="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s DaysCount = $$$TunesVariableGlobal("ShowInstrReminder")
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,2) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<script language="Cache" method="WriteInstrField" arguments="ID:%String,Answer:%String,Field" returntype="%String">
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 if (Field="BrakCommentAnswer")
 {
	 s obj.BrakCommentAnswer = Answer
	 d:+$G(%session.Data("user")) obj.BrakCommentAnswerUserSetObjectId(%session.Data("user"))
	 s obj.BrakCommentAnswerDat = +$H
 }
 if (Field="RefuseReason")
 {
	 s obj.RefuseReason = Answer
	 d:+$G(%session.Data("user")) obj.RefuseReasonUserSetObjectId(%session.Data("user"))
	 s obj.RefuseReasonDat = +$H
 }
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
</script>
<html XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
input{border:none;width:15px}
</style>
<link rel="stylesheet" href="css/jquery-ui-1.9.1.custom.min.css" />
<script language="javascript" type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
<script language="javascript" type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var CardId=""; //условие для отбора товаров
sessionid="#(%session.SessionId)#";
var j = new Array();
var intervalID;				//id таймера
var currentJob = "#($J)#";	//уникальный номер этого процесса


//при загрузке страницы
function load()
{
	hideplan.checked=ReturnBoolean(GetCookie("hideplanchecked"));
	hideGoods.checked=ReturnBoolean(GetCookie("hideGoodschecked"));
		plan.LoadHeaders("Parent,Comment");
		instr.LoadHeaders("Doc,DocType,Tim,Dat,Summa,Stat,Operation");
	//docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,garant,sn,seller");
	
	var Captions = new Array(4);
	var Keys = new Array(4);
	var Tags = new Array(4);
	
	Captions[0]="Товар";
	Captions[1]="Количество";
	Captions[2]="Цена";
	Captions[3]="Сумма";
	
	Tags[0]="Goods.Goods";
	Tags[1]="%Numeric";
	Tags[2]="%Numeric";
	Tags[3]="%Numeric";
	
	Keys[0]="Goods";
	Keys[1]="Quantity";
	Keys[2]="Price";
	Keys[3]="Total";
	docstr.DrawHeaders(Captions,Keys,Tags);
	
	hideplanFn();
	hideGoodsFn();
	FillInstrReminder();	//проверить пропущенные инструкции
	$( "#dialog-confirm" ).dialog({ autoOpen: false });
}

//клик на кнопке всплывающего диалога
  function DialogClick(param)
  {
	  $.get("test2.csp?currentJob="+currentJob+"&command=answer&answer="+param);
	  $( "#dialog-confirm").dialog("close");
	  intervalID = window.setInterval(CheckAnswerDoc, 1000);
  }

function ItemPlan(PlanID){
PlanID=ReturnSpace(PlanID)
WinResult=window.showModalDialog("PlanIgrid.csp?source="+PlanID,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
if(WinResult==1)ShowPlan();
}

function ShowPlan(){
var Data1=ConvertDateSql(dat1.value);
var Data2=ConvertDateSql(dat2.value);
plan.DownLoad("PlanDate2>=CAST('"+Data1+"' AS DATE) AND PlanDate<=CAST('"+Data2+"' AS DATE)");
}

function DelItem(){
	if(!window.confirm("Вы хотите удалить выбранный пункт?")){return false;}
	ok=#server(Docs.Action.deletedoc(plan.ClassName,plan.ItemID))#
	if(ok==1){ShowPlan();}
	else{alert(ok)}
}

function ShowInstr()
{
	var Data1=ConvertDateSql(dat11.value);
	var Data2=ConvertDateSql(dat21.value);
	var InstrCommentVar="";
	if(qwer.value!="")
	{
		var stat="and State="+qwer.value;
		if(qwer.value=="all")var stat="";
	}
	else
	{
		var stat="and State<9";
	}
	if(InstrComment.value!=""){var InstrCommentVar=" and Name %STARTSWITH '"+InstrComment.value+"'"}
	var variable="InstDate>=CAST('"+Data1+"' AS DATE) and InstDate<=CAST('"+Data2+"' AS DATE) "+stat+InstrCommentVar
	
	var currentKontragent=ChooseKontragent.value;
	if(currentKontragent!="all"){var variable=variable+" and Kontr="+currentKontragent}
	
	var varInstrSortField = InstrSortField.value;	//поле по которому сортируем
	variable = variable+ " order by Operation.Instructions."+varInstrSortField;
	
	instr.DownLoad(variable);
}

function ItemInstr(item,source){
	item=ReturnSpace(item)
	//source=ReturnSpace(source)
	//var CspFile="createinstruct.csp";
	//if(OpenIGrid.checked){}
	var CspFile="createinstructIgrid.csp";var source=item;
	mok=window.showModalDialog(CspFile+"?source="+source,item+";"+instr.ClassName,"center:yes;status:no;dialogHeight:600px;dialogWidth:720px;resizable:yes;")
	if(mok==1){ShowInstr()}
}

// удалить инструкцию
function DelItemInstr(){
	if(!window.confirm("Вы хотите удалить инструкцию '"+instr.ItemName+"'?")){return false;}
	DelInstrDocs();
	ok=#server(Docs.Action.deletedoc(instr.ClassName,instr.ItemID))#
	if(ok==1){ShowInstr();}
	else{alert(ok)}
}

//удалить документы инструкции 
function DelInstrDocs(){
	if(!window.confirm("Вы хотите удалить все документы инструкции руководителя "+instr.ItemName+"?")){return false;}
	var ok=#server(Operation.InstrActions.DeleteInstrChildren(instr.ItemID))#
	if(ok==1){alert("Все документы инструкции руководителя "+instr.ItemName+" успешно удалены.");}
	else{alert(ok)}
}

function showtovsins(){
CardId=instr.ItemID+"@"+instr.ClassName;
//tovars.LoadHeaders();
docstr.Clear()
loadgoods(instr.ItemID);
}

function LoadGoodsFromCard(){
	tovars.GetFromCard(CardId);
}

//вывести на печать внутреннюю инструкцию
function lookinnerinstr(ItemID)
{
	window.open("PrintInnerFromChief.csp?super="+ItemID+"&sessionid="+sessionid)
}

function changestat(newstat){
	var HasBeenSent="";
	if(newstat==9)
	{
		var InstrType=#server(Operation.InstrActions.GetInstrType(instr.ItemID))#	
		if((InstrType==4)||(InstrType==10)||(InstrType==11))
		{
			var answer=window.confirm("Поставить инструкции "+instr.ItemName+" статус 'Отправлена'?")
			if(answer){var HasBeenSent=1;}
			else{var HasBeenSent=0;}
			
		}
	}
	ok=#server(Operation.InstrActions.changestat(instr.ItemID,newstat,HasBeenSent))#
	if(ok.split("@")[0]!=1){alert(ok)}
	else
	{
		//если требовали завершить и все успешно
		if(newstat==9)
		{
			instr.DelItems()
		}	
		
		if(newstat==2)
		{
			instr.ChangeCell("State",ok.split("@")[1])
			alert("Инструкция руководителя утверждена");
		}
		
		//отклонение заявки
		if(newstat==8.6)
		{
			SetInstrField(instr.ItemID,'RefuseReason','Пояснения контрагенту о причинах отклонения заявки','Причины отклонения сохранены');
		}
	}
}

function lookhist(instrItemID){
window.showModalDialog("instrhistory.csp?instr="+instrItemID,"","center:yes;status:no;dialogHeight:300px;dialogWidth:600px;resizable:yes;")
}

function loadgoods(DocID){
if(!hideGoods.checked){
	docstr.loadfrommethod("Docs.Action2.ChiefInstructStr",DocID);
	}
}

// создание дочерних документов от инструкции
function doc()
{
	#server(..CreateDocFromInstr(instr.ItemID,currentJob))#
	intervalID = window.setInterval(CheckAnswerDoc, 1000)	
//ok=#server(Docs.Action.DocFromInstr(instr.ItemID))#
//if(isNaN(ok)){alert(ok)}
//else{alert("Документ успешно создан")}
}

//проверить что вернула запущенная функция
function CheckAnswerDoc()
 {
	$.get("test2.csp?currentJob="+currentJob,
		function(ok)
		{
			var arr = ok.split("\t");
			
			if(arr.length==1)$("#result").text(ok);
			 
			if (arr[0] == "1")
			{
				clearInterval(intervalID);
				alert(arr[1]);
			}
			
			//если попросили показать окошко
			if (arr[0] == "0")
			{
				clearInterval(intervalID);
				var Buttons = new Array();
				
				var text = arr[1];

				for (var i=2; i<=arr.length-1; i++)
				{
					var ButtonDescription = arr[i].split("\b");
					var  btn={
						text:ButtonDescription[0]
						,tag: ButtonDescription[1]
						, click: function(evt){ 
							var $btn=$(evt.currentTarget);
							DialogClick($btn.attr("tag"));
						} 
					}
					Buttons.push(btn);
				}

				$("#WindowTxt").text(text);
				$( "#dialog-confirm").dialog( "option", "buttons", Buttons);
				$( "#dialog-confirm").dialog("open");
			}
		}
	);
 }

// при закрытии окна
function unload(){
	//plan.saveColunmsSettings();
	//instr.saveColunmsSettings();
}

//Клонировать инструкцию
function CopyInstr(instrItemID){
if(ReturnSpace(instrItemID)==""){return }
var ok=#server(Docs.Action.CloneDoc(instrItemID))#
if(isNaN(ok)){alert(ok)}
else{ShowInstr()}
}

//Создать инструкцию на основе плана
function InstrFromPlan(){
//'',plan.ItemID+'@'+plan.ClassName
if(!window.confirm("Создать инструкцию на основе плана?"))return;
var InstrId=#server(Operation.InstrActions.InstrFromPlan(plan.ItemID))#
if(InstrId=="PlanIsClosed")
	{
	if(window.confirm("На основе плана уже была создана инструкция, вы хотите создать ещё одну?"))
		{
		var InstrId=#server(Operation.InstrActions.InstrFromPlan(plan.ItemID,1))#
		}
	else
		{
		return
		}
	}
if(isNaN(InstrId)){alert(InstrId);}
else{ItemInstr(InstrId);ShowPlan();}
}

//скрыть показать план руководителя
function hideplanFn(){
if(hideplan.checked){planfield.style.display="none";}
else{planfield.style.display="inline";}
SetCookie("hideplanchecked",hideplan.checked);
}

//скрыть показать товары инструкций
function hideGoodsFn(){
if(hideGoods.checked){GoodsField.style.display="none";}
else{GoodsField.style.display="inline";}
SetCookie("hideGoodschecked",hideGoods.checked);
}

function PrintPlanFn(){
if(ReturnSpace(plan.ItemID)=="")return
window.open("screen/ChiefPlanHtml.csp?docid="+plan.ItemID)
}

function PrintInstr(ItemID){
if(ReturnSpace(ItemID)=="")return
window.open("screen/ChiefInstr.csp?docid="+ItemID);
}

// Выбрать контрагента
function ChooseKontragentFunc()
{
	var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
	if(UsersSelection=="choose")
	{
		var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
		if(newKontragent==null){
			ChooseKontragent.selectedIndex=0;
			return false;}
		var ChooseKontragentLength = ChooseKontragent.options.length;
		ChooseKontragent.options.length= ChooseKontragentLength + 1;
		ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
		ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
		ChooseKontragent.selectedIndex=ChooseKontragentLength;
	}
}

function FillInstrReminder()
{
	var ButtonString = "<br><input type='button' style='width:300px' value='проверить пропущенные заявки' onclick='FillInstrReminder();'>"
	var count = #server(Operation.InstrActions.GetInstrReminderText(1))#;
	if (count==0)
	{
		InstrReminder.innerHTML = "Нет пропущенных заявок" + ButtonString;
		return;
	}
	var str = #server(Operation.InstrActions.GetInstrReminderText())#;
	if (str != "")
	{
		InstrReminder.innerHTML = "<p style='color:#de1111'>Внимание! Некоторые инструкции не завершены или не отклонены более #($G(DaysCount))# дней:</p>"
		+	str 
		+ ButtonString;
	}
}

//сервис менеджер отвечает на негативный отзыв контрагента
function SetInstrField(DocId,Field,Description,SuccessMessage)
{
	var Answer = window.prompt(Description,"");	
	if (Answer==null) return;
	ok = #server(..WriteInstrField(DocId,Answer,Field))#
	if (isNaN(ok)){alert(ok);}
	else{alert(SuccessMessage);}
}

//указанное поле документа в отдельном окне
function ShowFieldFn(DocId,Class,PropertyName)
{
	window.showModalDialog("Info.csp?docid="+DocId+"&class="+Class+"&property="+PropertyName,"","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}

function RefuseInstr(InstrId)
{
	if(!window.confirm("Отклонить заявку " + instr.ItemName + " ?"))return;
	changestat('8.6');
}

function ShowFoto()
{
	var ItemID = instr.ItemID;
	var DocId = #server(Operation.InstrActions.GetInnerInstr(ItemID))#;
	if(!isNaN(DocId)) window.open("DocImages.csp?DocId="+DocId);
}

/// показать гарантийные талоны данной заявки
function ShowGarantsFromRequest()
{
	var iid=instr.ItemID; if (!iid) { alert("Выберите инструкцию!"); return; } 
	//window.open("csp.ReqWar2.cls?id="+iid);
	window.showModelessDialog("csp.ReqWar2.cls?id="+iid
   	,iid+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:1000px;resizable:yes;");
}
</script>
<script language="VBScript">
Sub OpenExcel(docid)
if docid="" then Exit Sub
dim objXML,objExcel
set objXML = CreateObject("Msxml2.DOMDocument.3.0")
objXML.async = false
objXML.validateOnParse = false
If objXML.parseError.errorCode <> 0 Then msgbox("Ошибка анализа XML" & vbCr & objXML.parseError.reason)
res=objXML.load("screen/ChiefPlanXml.csp?docid="&docid)
If objXML.parseError.errorCode <> 0 Then
	msgbox("Ошибка XML" & vbCr & objXML.parseError.reason)
	Exit Sub
End If
'if(xmlobj.selectSingleNode("root/comment")!=null){
'	var xmlcomment=xmlobj.selectSingleNode("root/comment").text;
'	if(xmlcomment!="")alert(xmlcomment)}

Set objExcel = CreateObject("Excel.Application")
objExcel.Visible = True
Set objWorkbook = objExcel.Workbooks.Add
'SheetsCount=objWorkbook.Sheets.Count

set oNodeList = objXML.selectNodes("//AllObjects/*")
For i=0 To (oNodeList.length-1)
	CurrentSheetNumber = (i+1)
	if i>(objWorkbook.Sheets.Count-1) Then 
		objWorkbook.Sheets.Add
		CurrentSheetNumber = 3
	end if
	Set objWorksheet = objWorkbook.Worksheets(CurrentSheetNumber)
	set currentobj=oNodeList.item(i)
	ModelName = currentobj.selectSingleNode("Model/Name").text
	ModelCode = currentobj.selectSingleNode("Model/Code").text
	objWorksheet.Name = ModelCode
	objExcel.Workbooks(1).Sheets(CurrentSheetNumber).Select
	objWorksheet.Cells(1, 2).Value = ModelCode & " " & ModelName
	set Parts = currentobj.selectNodes("Parts/*")
	For z=0 To (Parts.length-1)
		set currentpart = Parts.item(z)
		objWorksheet.Cells((z+3), 1).Value = currentpart.selectSingleNode("Number").getAttribute("Text")
		objWorksheet.Cells((z+3), 2).Value = currentpart.selectSingleNode("Name").getAttribute("Text")
		objWorksheet.Cells((z+3), 3).Value = currentpart.selectSingleNode("Pos").getAttribute("Text")
		objWorksheet.Cells((z+3), 4).Value = currentpart.selectSingleNode("Quantity").getAttribute("Text")
	Next
	objWorksheet.Columns("A:A").ColumnWidth = 8.43
	objWorksheet.Columns("B:B").ColumnWidth = 35.71
	objWorksheet.Columns("C:C").ColumnWidth = 22.29
	objWorksheet.Columns("D:D").ColumnWidth = 15.29
	zRange="A2:D"&(z+2)
	objWorksheet.Range(zRange).Select
	for z=7 To 12
		objExcel.Selection.Borders(z).Weight = 2
	Next
	objWorksheet.Cells(2, 1).Value = "No"
	objWorksheet.Cells(2, 2).Value = "Part name"
	objWorksheet.Cells(2, 3).Value = "№"
	objWorksheet.Cells(2, 4).Value = "Quantity"
	objWorksheet.Range("A1:D2").Select
	objExcel.Selection.Font.Size=14
	objExcel.Selection.Font.Bold = True
Next
End Sub
</script>
</head>
<body onload="load()" onunload="unload()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Рабочее место сервис менеджера</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>
<br>


<!--  Таблица с планами   -->
<input type="checkbox" id="hideplan" onclick="hideplanFn()"> Скрыть план руководителя
<fieldset id="planfield"><legend>План</legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<sklad:LittleButton name="ok" id="okbut1" onclick="ShowPlan()" alt="Показать записи"><br>
 <SKLADList:listview width=100% height=100 id="plan" onAddColumns="ShowPlan()" ClassName="Operation.Plan" zonDblClick="ItemPlan(plan.ItemID)" /><br>
  <table width=100% ><tr><td width=100%>
  <sklad:LittleButton name="new" id="newtov1" onclick="ItemPlan()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="edititem" onclick="ItemPlan(plan.ItemID)" alt="Редактировать запись">
  <sklad:LittleButton name="down" id="deltov78" onclick="InstrFromPlan()" alt="Создать инструкцию">
  <sklad:LittleButton name="print" id="printpan" onclick="PrintPlanFn()" alt="Распечатать план">
  <sklad:LittleButton name="excel" id="btnOpenExcel" onclick="OpenExcel(plan.ItemID)" alt="Открыть в Excel">
  </td>
  <td>
  <sklad:LittleButton name="del" id="deltov1" onclick="DelItem()" alt="Удалить запись">
  </td>
  </tr>
  </table>
</fieldset>
<br>

<!--  Таблица с инструкциями   -->
<fieldset ><legend>Инструкции</legend>
<table>
<tr>
	<td><b>Период</b>
	<td><b>Статус</b>
	<td><b>Контрагент</b>
	<td><b>Номер</b>
	<td><b>Сортировка</b>
	<td>&nbsp;
</tr>
<tr>
	<td>c <input type=text id="dat11" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat21" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	<td>
		<script language="cache" runat="server">
		w "<select id=""qwer"">"
		w ##class(Docs.Action2).GetDisplaylistOptions("","Operation.Instructions||State")
		w "<option value=""all"">Все включая завершённые</option>"
		w "</select>"
		</script>
	<td>
		<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
			<option value="all">Все</option>
			<option value="choose">Выбрать контрагента...</option>
		</select>
	<td><input type=text id="InstrComment" name="InstrComment" style="border:solid 1 black;width:50px" title="Для поиска можно вводить лишь первые символы номера">
	<td>
	<select id="InstrSortField">
		<option value="Name">Номер</option>
		<option value="InstDate">Дата</option>
	</select>
	<td><sklad:LittleButton name="ok" id="okbut11" onclick="ShowInstr()" alt="Показать записи">
</tr>
</table>
<SKLADList:listview width=100% height=100 id="instr" onAddColumns="ShowInstr()" ClassName="Operation.Instructions" zonDblClick="ItemInstr(instr.ItemID)" zClick="showtovsins()" Skip="Source->Name,child->Name" SaveSort="false"/>
  <table width=100%><tr><td width=80%>
	  <sklad:LittleButton name="new" id="newtov" onclick="ItemInstr()" alt="Создать запись">
	  <sklad:LittleButton name="edit" id="edittov" onclick="ItemInstr(instr.ItemID)" alt="Редактировать запись">
	  <sklad:LittleButton name="ok2" id="approve" onclick="changestat('2')" alt="Утвердить">
	  <sklad:LittleButton name="calendar" id="eltov" onclick="lookinnerinstr(instr.ItemID)" alt="Просмотр внутренней инструкции">
	  <sklad:LittleButton name="history" id="lookhistory" onclick="lookhist(instr.ItemID)" alt="История инструкции">
	  <sklad:LittleButton name="ok" id="fin" onclick="if(window.confirm('Завершить заявку ?')){changestat('9')}" alt="Завершить">
	  <sklad:LittleButton name="txt" id="tx" onclick="doc()" alt="Создать документ на основании инструкции">
	  <sklad:LittleButton name="copy" id="copyInstr" onclick="CopyInstr(instr.ItemID)" alt="Копировать инстукцию">
	  <sklad:LittleButton name="print" id="printInstr" onclick="PrintInstr(instr.ItemID)" alt="Печать инстукции">
	  <sklad:LittleButton name="savestore" id="btnShowFoto" onclick="ShowFoto(instr.ItemID)" alt="Показать фотографии внутренней инструкции">
	  
	  <img src="images/VertDelimeter.gif">
	  	<sklad:LittleButton name="info" id="btnLookBrakComment" onclick="ShowFieldFn(instr.ItemID,'Operation.Instructions','BrakComment')" alt="Показать негативный отзыв контрагента">
		<sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetInstrField(instr.ItemID,'SetBrakAnswer','Ответ на негативный отзыв','Ответ на негативный отзыв сохранён')" alt="Ответить на негативный отзыв">
		<sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowFieldFn(instr.ItemID,'Operation.Instructions','BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
		<sklad:LittleButton name="search" id="btnShowGarantsFromRequest" onclick="ShowGarantsFromRequest()" alt="Проверить серийные номера" >
	  <img src="images/VertDelimeter.gif">
	  	<sklad:LittleButton name="stop" id="btnStop" onclick="RefuseInstr(instr.ItemID)" alt="Отклонить заявку">
  </td><td width=20% align=right>
  <sklad:LittleButton name="del" id="deltov" onclick="DelItemInstr()" alt="Удалить запись">
  <sklad:LittleButton name="del+" id="deltov2" onclick="DelInstrDocs()" alt="Удалить все документы инструкции руководителя">
  </td></tr></table>
  <!--
  <sklad:LittleButton name="ok" id="acceptinstr" onclick="changestat()" alt="Подтвердить завершение"><br>  
  -->
</fieldset>


<!--  Таблица с товарами   -->
<input type="checkbox" id="hideGoods" onclick="hideGoodsFn()"> Не выводить товары
<fieldset id="GoodsField"><legend>Товары <span id="whostovar"></span></legend>
<!--
<SKLADList:listview width=100% height=100 id="tovars" onAddColumns="LoadGoodsFromCard()" ClassName="Goods.Goods"/><br>
<SKLAD2:table id="docstr" width=100% height=100 ClassName="Operation.InstructionsItems" />
-->
<SKLADiGrid:iGrid id="docstr" width="100%" height="200" Enabled="true"/>
</fieldset>
<span id="InstrReminder"></span>
<div id="dialog-confirm" style="display:none:width:500px">
    <p id="WindowTxt"></p>
</div>
</body>
</html>
<script language="Cache" method="CreateDocFromInstr" arguments="InstrId:%String,currentJob:%String" returntype="%String">
 k ^mtempArt
 s ^mtempArt("docfrominstr",1,"InstrId")=InstrId
 s ^mtempArt("docfrominstr",1,"currentJob")=currentJob
 job DocFromInstr^temp(InstrId,currentJob)
  //d ##class(Docs.Action).DocFromInstr(InstrId)
 Quit ""
</script>
]]></CSP>


<CSP name="classmethod.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s classmethod=%request.Get("classmethod")
 s param1=%request.Get("param1")
 s param2=%request.Get("param2")
 s param3=%request.Get("param3")
 s param3("currentpage")=%request.Get("currentpage")
 s param3("stroknastr")=%request.Get("stroknastr")
 s class=$P(classmethod,".",1,$L(classmethod,".")-1)
 s method=$P(classmethod,".",$L(classmethod,"."))
 //s ^mtempArt("class")=class
 //s ^mtempArt("method")=method
 //s ^mtempArt("param1")=param1
 //s ^mtempArt("param2")=param2
 //s ^mtempArt("param3")=param3
 d $ZOBJCLASSMETHOD(class,method,param1,param2,.param3)
</script>]]></CSP>


<CSP name="CloseSession.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s %session.EndSession = 1
 d ##class(Common.Rights).LogoutMethod()
</script>]]></CSP>


<CSP name="ComboBox.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<title>Система складского учёта</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
TD{font-family:'Arial';font-size:13pt;}
</style>
<script language="javascript">
function startFun(){
window.returnValue=ComboBox.value;
window.close();
}

function windowclose(){
if(window.confirm("Закрыть окно без сохранения изменений?")){
	window.close()	
	}
}

</script>
</head>
<body style="border:solid 1 black">
<table cellpadding=5 height=100% width=100% ><tr><td valign=top >
<select id="ComboBox">
<script language="cache" runat="server">
s ClassProperty=%request.Get("ClassProperty")
s CurrentSelection=%request.Get("CurrentSelection")
w ##class(Docs.Action2).GetDisplaylistOptions(CurrentSelection,ClassProperty)
</script>
</select>
</td></tr>
<tr><td valign=bottom>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="windowclose()" value="Отмена"></center>
</td></tr>
</table>

</body>
</html>]]></CSP>


<CSP name="Commands.csp" application="/csp/sklad2/" default="1"><![CDATA[
<server>
 s command=%request.Get("command")
 s depot=$G(%session.Data("depot"))
 s depot=1
 
 if command="CellStorage"
 {
	 s id=%request.Get("id")
	 
	 &sql(declare zz cursor for select
	 	Goods,Value1,Value2,Goods->FullName
	 	into :Goods,:Value1,:Value2,:GoodsFullName
	 	from Store.Quantity
	 	where Address=:id)
	 
	 &sql(open zz)
	 for  
	 {
		 &sql(fetch zz)
		 q:SQLCODE
		 w "<tr>"
		 	_"<td>"_GoodsFullName
		 	_"<td>"_(Value1+Value2)
		 _"</tr>"
	 }
 }
 
 if command="InstrData"
 {
	 s ID= %request.Get("ID")
	 
	 &sql(select Kontr->Name,%external(Dat),Name
	 	into :KontrName,:Dat,:Name
	 	from Operation.Instructions 
	 	where ID=:ID)
	 
	 w "№ "_Name_" "_KontrName_" от "_Dat
 }
</server>]]></CSP>


<CSP name="CreateAnalogs.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADz XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">

<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
//Arguments=window.dialogArguments.split(InnerSplitter);
CardId="";
DetailId="";
AnalogId="";
var CurrentProperty;
var Objvalue;
var InCard=false;
var FromTable="";
var FromTree="";
var Number=0;
ExpressType2="";
var ColCode="";
var depot="#($G(%session.Data("depot")))#"
var commongroups="#($G(%session.Data("commongroups")))#"

function startFun(){
if(DetailId==""){alert("Не установлена заменяемая деталь.");return false;}
if(AnalogId==""){alert("Не установлен аналог.");return false;}
var ok=#server(Common.Common.SetDetailAnalogRelation(DetailId,AnalogId))#
if(isNaN(ok)){alert(ok)}
else{
	alert("Пара взаимозаменяемых деталей установлена успешно.")
	DetailId="";
	AnalogId="";
	DetailName.innerText="";
	AnalogName.innerText="";
	}
}

function ReturnSelected(){
ResultArray=TempGoods.ListViewGetItems("selected");
returnValue=ResultArray;
window.close();	
}

function load(){
window.dialogWidth=screen.availWidth+"px";
//alert(screen.availWidth+"X"+screen.availHeight+"\n"+window.dialogWidth+"X"+window.dialogHeight)
TempGoods.attachEvent("onAddColumns", addcol)
TempGoods.LoadHeaders("izdelie,Description,Property312,Property675,Property9469,abbr,Composition");
Catalogues.startDownload(strForGroups(depot,commongroups), putCatalogue);
}

function addcol(){
TempGoods.detachEvent("onAddColumns", addcol)
fields=TempGoods.GetColumns("Goods->");
//TempGoods.AddColumns("quant~Количество~~~@%String#@#")
}

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}

function LoadTree(){
GroupsTree.AdditionalID=Catalogues.value;
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+depot+'","'+Catalogues.value+'"')	
}

// добавить товар в таблицу из текущей ветки
function AddFromGroup(){
var where="Groups='"+GroupsTree.NodeID+"'"
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,fields,0)
}

// добавить товар в таблицу из всех подветок данной ветки
function AddFromWholeGroup(){
var where="Groups->Depot='"+depot+"' and Groups->Catalogue='"+Catalogues.value+"' and Groups->Code %STARTSWITH '"+GroupsTree.NodeCode+"'";
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,fields);
}

function AddFromSelect(){
if(ThisGroupOnly.checked){var GroupCondition="Groups->Depot='"+depot+"' and Groups->Catalogue='"+Catalogues.value+"' and Groups->Code %STARTSWITH '"+GroupsTree.NodeCode+"'";}
else{var GroupCondition="";}
var where=GroupCondition+FromTable;
TempGoods.loadfrommethod("Goods.GoodsAction.fromgroup",where,fields)
}

function TableClick(){
	ExpressType="FromTable";
	CurrentProperty=PropTable.CurrentRowTag;
	Pname.innerText=PropTable.CurrentRowName;
	newObj=PropTable.CurrentRowElement.cloneNode(true);
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

//функция нужна для совместимости с table.htc
function cellaction(oo){
}

//функция нужна для совместимости с table.htc
function getDivChange(oo){
}

//открыть карточку товара
function OpenCard(){
GoodsId=SelectedItemProperty(GoodsListView,"Tag");
GoodsName=SelectedItemProperty(GoodsListView,'Text');
if(GoodsId=="")return
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath="+GroupsTree.ParentNames,GoodsId+InnerSplitter+GoodsName,"center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
if(ok==1){ShowTovars()}
}

function GroupsTreeClick(){
	AddFromGroup();
}

// Установить текущую позицию Листа как деталь
function SetAsDetail(){
var currentSelection=TempGoods.ListViewGetItems("selected");
DetailId=currentSelection.split(InnerSplitter)[0];
DetailName.innerText=currentSelection.split(InnerSplitter)[8];
}

// Установить текущую позицию Листа как аналог выбранной детали
function SetAsAnalog(){
var currentSelection=TempGoods.ListViewGetItems("selected");
var AnalogsArray=currentSelection.split(StringSplitter);
AnalogId="";
for(var i=0;i<AnalogsArray.length-1;i++){
	var CurrentAnalog=AnalogsArray[i];
	var CurrentAnalogArray=CurrentAnalog.split(InnerSplitter)
	AnalogId=AnalogId+CurrentAnalogArray[0]+InnerSplitter;
	AnalogName.innerHTML=AnalogName.innerHTML+"<br>"+CurrentAnalogArray[8];	
	}
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();">
<a href="#" onclick="window.location.href='tuneup.csp'" >Вернуться к настройкам</a>
<table height=100% width=100% border=0>
<tr ><td width=50% valign="top">
<fieldset><legend>Отбор из группы</legend>
Классификатор:<select id="Catalogues" onchange="LoadTree()" style="behavior:url('#default#download');"></select><br>
  <SKLADz:treeview id="GroupsTree" width="400" height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="GroupsTreeClick();" onDownloadCmpl="LoadPropTree()" />
  <br>
  <input type="button" id="SelectWholeGroup" value="выбрать всю ветку" onclick="AddFromWholeGroup()">
 </fieldset>
</td>
<td width=50% valign="top">
Деталь: <b><span id="DetailName"></span></b><br>
Аналог: <b><span id="AnalogName"></span></b>
<br><sklad:Button value="Установить связь детали и аналога" onclick="startFun();" style="width=100px">

</td></tr>

<tr><td valign="top"  colspan=2>
<!--
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
-->
<fieldset id="SelectedGoods"><legend>Выбранные товары</legend>
 	<SKLADList:listview width=100% height=130 id="TempGoods"  ClassName="Goods.Goods" AddOnClear="false" zonDblClick="ReturnSelected();"  AddHeaders="true"/><br>
<sklad:Button value="Это нужная деталь" onclick="SetAsDetail();"> 
<sklad:Button value="Это аналог" onclick="SetAsAnalog();">
</fieldset>
</td></tr>
</table>
</body>
</html>]]></CSP>


<CSP name="CreateHackInvent.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Cache Server Page </title>

</head>

<body>
<script language="cache" runat="server">
 s SourceDoc=%request.Get("SourceDoc")
 s DestinationDoc=%request.Get("DestinationDoc")
 s SourceDocObj=##class(Docs.Super).%OpenId(SourceDoc)
 s DestinationDocObj=##class(Docs.Super).%OpenId(DestinationDoc)
 s i="" f  s i=SourceDocObj.Items.Next(i) q:i=""  d
 . s ItremObj = SourceDocObj.Items.GetAt(i)
 . s GoodsId=ItremObj.Goods.%Id()
 . s Quantity=ItremObj.quantreal
 . if $ISOBJECT(ItremObj.addr) s addrId = ItremObj.addr.%Id()
 . else  s addrId = ""
 . s InventItem = ##class(Docs.InventItems).%New()
 . d InventItem.GoodsSetObjectId(GoodsId)
 . d:addrId InventItem.addrSetObjectId(addrId)
 . d InventItem.DocTypeSetObjectId(DestinationDocObj.%ClassName(1))
 . s InventItem.Quantity = Quantity
 . d DestinationDocObj.Items.Insert(InventItem)
 s ok=DestinationDocObj.%Save()
 if ok w "Документ "_DestinationDocObj.Name_"&nbsp;&nbsp;&nbsp;&nbsp;"_DestinationDocObj.Comment_" успешно сохранён используя данные "_SourceDocObj.Name
 else  w "Ошибка при сохранении "_DestinationDocObj.Name_"&nbsp;&nbsp;&nbsp;&nbsp;"_DestinationDocObj.Comment_"<br>"_$$GetOneErrorText^%apiOBJ(ok,1)
</script>
</body>
</html>
]]></CSP>


<CSP name="createinstruct.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s source=%request.Get("source")
</script>
<html XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var user="#($G(%session.Data("user")))#";
var argArr=window.dialogArguments.split(";");
var ClFromOper = new Array();
var ItemID=argArr[0];  //ID открываемого документа (или "" если новый документ)
var ClassName=argArr[1];  //класс документа Operation.Instructions
var OperationType="";  //тип операции (напр. заказ на поставку зап частей)

// Сохранение данных по кнопке СОХРАНИТЬ
function startFun(){
var OperationType=PropTable.item("Oper")
if(OperationType==""){alert("Выберете, пожалуйста, шаблон операции.");return}
ItemID=argArr[0];
	
	if(ReturnSpace(ItemID)==""){question="Создать запись?"}
	else{question="Изменить запись?"}

if(!window.confirm(question))return false;

var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();

if(OperationType==10){  //если выбрали комплектацию зап частей то вставим в xml способ оплаты
	var RashOplatTypeValue=RashOplatType.value;
	addnode(xmldoc,"RashOplatType",RashOplatTypeValue)
	}

var ItemID=SplitSendXml(ItemID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
	if(isNaN(ItemID)){alert(ItemID);}
	else{
		window.returnValue=1;
		window.close();
	}
}

function load(){
source="#(source)#";
if(ItemID!=""){
	PropTable.Silent="Oper";
	var showfields="postnumber,postdata,RashOplatType";
	}
else{var showfields="";}
PropTable.DownLoadPairs(ClassName,ItemID,"Doc,DocType,Tim,Dat,Summa,Stat,State,Source,innerinstr,Operation,User1,postnumber,postdata",source,showfields);
//instritems.LoadHeaders();
docstr.ClassName=ClassName+"Items";
docstr.attachEvent("onAddColumns",loadgoods2)
//docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,garant,sn");
docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,garant,sn,seller,opispolomki");
}

//товары взять из строк документа
function loadgoods2(){
if(ItemID!=""){
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",ItemID+"@"+docstr.ClassName,2,3)}
}

// функция открывает окошко со складами и записывает выбранный склад в текущую инструкцию
function lookstore(){
	mok=window.showModalDialog("storemodal.csp","","cener:yes;status:no;dialogHeight:500px;dialogWidth:600px;resizable:yes;");
	if(mok==null)return
	PropTable.setCellValue("Depot1",mok.split(InnerSplitter)[1],mok.split(InnerSplitter)[0])
}

//function addtovar(){
//	tovars=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
//	if(tovars==null)return
//	instritems.ListViewAddItems(tovars)
//}

function addtovar(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[4] + " " + onestr[8] + " " + onestr[1];
	FieldValue["Goods"]=onestr[0];
	FieldCaption["Price"]=getPrice(FieldValue["Goods"]);
	docstr.AddRow(FieldCaption,FieldValue);
}
}

function getPrice(tovid){
return #server(Goods.GoodsAction.getprice(tovid))#;
}


function deltovars(){
//	instritems.DelItems();
}

function LoadFromCard(){
//	instritems.GetFromCard(ItemID+"@"+ClassName);
}

function prchange(){
if(PropTable.ChangedProp=="Oper"){
	docstr.delrows("all");
	//alert(docstr.ClassName+"\n"+PropTable.item("Oper")+"\n"+PropTable.ChangedProp);
	ChangeInstructionType();
	
}
}

// смена типа инстрации 
function ChangeInstructionType(){
OperationType=PropTable.item("Oper");
if(ClFromOper[OperationType]==null){ClFromOper[OperationType]=#server(Docs.Action.GetPageFromOper(OperationType,'cl'))#}
classn=ClFromOper[OperationType];
if(classn=="Docs.Rash,Docs.Remont")docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,sn,Total");
if((classn=="Docs.Prih")||(classn=="Docs.Rash"))docstr.LoadHeadersXML("Doc,DocType,quantplan,addr,addr2,spravka,Client,goodsdir,garant,sn,seller,opispolomki");
if(classn=="Docs.Inner")docstr.LoadHeadersXML("Doc,DocType,spravka,Client,goodsdir,garant,sn,quantplan,seller,opispolomki");
if(classn=="Docs.Invent")docstr.LoadHeadersXML("Doc,DocType,addr2,spravka,Client,goodsdir,garant,sn,seller,opispolomki");
if(classn=="Docs.Utiliz")docstr.LoadHeadersXML("Doc,DocType,addr2,quantplan,seller,opispolomki");
if(classn=="Docs.DocBrak")docstr.LoadHeadersXML("Doc,DocType,addr2,quantplan,opispolomki,spravka,Client,goodsdir,garant,sn,seller,opispolomki,addr");

HideOrDisplaySelect()
}

// скрыть или показать выпадающий список с типом оплаты (гарантия/платно)
function HideOrDisplaySelect(){
var InstructionOper = PropTable.item("Oper");
if(InstructionOper==10){
	RashOplatType.startDownload('Data.csp?class=Common.Dictionary7&fields=ID,Name', put);
}
else{RashOplatTypeBlock.style.display="none";}
}

function put(textStr){
addOptions(textStr,"RashOplatType");
RashOplatTypeBlock.style.display="block";
}

function getstorecell(goods,addr){
var val=#server(Store.Action.getquantaddr(goods,addr))#
return val
}

function winclose(){
if(window.confirm("Закрыть окно?")){window.close();}
}

// обработчик события OnCellChange таблицы строк документов
function docstrPropChange(){
if(OperationType!=10){
	if(docstr.cellChange.colname=="Quantity"){
		var newQuantity=docstr.cellChange.value;
				
		var price = docstr.item("Price")
		
		var NewTotal=price*newQuantity;
		if(typeof(NewTotal)=="number"){var NewTotal=NewTotal.toFixed(2)}
		if(NewTotal=="NaN"){return}
		docstr.setCellValue("Total",NewTotal)
	}
}
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<fieldset style="width:100%;height:200"><legend>Основные свойства</legend>
<span id="RashOplatTypeBlock" style="display:none;">
Оплата: <select style="width:150px;behavior:url(#default#download)" name="RashOplatType" id="RashOplatType">
</select>
</span>
<SKLAD2:table id="PropTable" width="100%" onPropChange="prchange();"  />
</fieldset>
  <sklad:LittleButton name="new" id="newtov" onclick="lookstore()" alt="Просмотреть склады">
<fieldset><legend>Товары</legend>
<!--
 <SKLADList:listview width=100% height=100 id="instritems" ClassName="Goods.Goods" AddOnClear="false" onAddColumns="LoadFromCard()" /><br>
-->
<SKLAD2:table id="docstr" width=100% height=180 CountTotal="true" displaybar=true OnCellChange="docstrPropChange()" />
<sklad:LittleButton name="new+" id="newtov1" onclick="addtovar()" alt="Добавить товары" >
<sklad:LittleButton name="del" id="deltov1" onclick="deltovars()" alt="Удалить выбранные товары из списка" >
</fieldset>
<center><br><sklad:Button value="Сохранить" onclick="startFun();"><sklad:Button onclick="winclose();" value="Отмена"></center>
</table>
</body>
</html>]]></CSP>


<CSP name="createinstructIgrid.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 . s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId

 //s login=$G(%session.Data("user"))
 //i '+login s %response.ServerSideRedirect="norights.csp" 
 
Quit 1
</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV10.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:170px;cursor:hand;}
.ZakazInstr{display:inline;}
</style>
<script language="jscript" src="common.js"></script>
<title>Инструкция руководителя</title>


<script language="Jscript">
var DocId='#(%request.Get("source"))#';
var OriginalInstructionId=DocId;
var sessionid="#(sessionid)#";

//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj){
newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}

// Скрыть или показать 
function ShowHideRashOplatType(Obj){
if(Obj.value==10)
	{
	ZakazInstr1.style.display='inline';
	ZakazInstr2.style.display='inline';
	ZakazInstr3.style.display='inline';
	ZakazInstr4.style.display='inline';
	ZakazInstr5.style.display='inline';
	ZakazInstr6.style.display='inline';
	}
else
	{
	ZakazInstr1.style.display='none';
	ZakazInstr2.style.display='none';
	ZakazInstr3.style.display='none';
	ZakazInstr4.style.display='none';
	ZakazInstr5.style.display='none';
	ZakazInstr6.style.display='none';
	}
}

function load(){
ShowHideRashOplatType(document.getElementById('Oper'));
FillDocStr();
}

function FillDocStr(){
var Captions = new Array(6);
var Keys = new Array(6);
var Tags = new Array(6);
var Widths = new Array(6);

Captions[0]="Товар";
Captions[1]="Количество";
Captions[2]="Цена";
Captions[3]="Сумма";
Captions[4]="Отзыв клиента";
Captions[5]="Серийный н.";
Captions[6]="Гарантийный н.";


Tags[0]="Goods.Goods";
Tags[1]="%Numeric";
Tags[2]="%Numeric";
Tags[3]="%Numeric";
Tags[4]="%String";
Tags[5]="%String";
Tags[6]="%String";

Keys[0]="Goods";
Keys[1]="Quantity";
Keys[2]="Price";
Keys[3]="Total";
Keys[4]="BrakComment";
Keys[5]="sn";
Keys[6]="garant";

Widths[0]=400;
Widths[1]=80;
Widths[2]=80;
Widths[3]=80;
Widths[4]=80;
Widths[5]=140;
Widths[6]=140;

docstr.DrawHeaders(Captions,Keys,Tags, Widths);
if(DocId!="")
	{
	docstr.loadfrommethod("Docs.Action2.ChiefInstructStr",DocId);
	}
}

//проверить количество товаров в заявке
function CheckQuantity()
{
	var str = "";
	for (var y = 1; y <= docstr.RowCount; y++)
	{
		var CellValue = docstr.CellValue(2,y);
		if ( (CellValue == "0") || (CellValue=='')) str+="В строке "+y+" не указано количество товара \n";
	}
	return str;
}

// сохранить
function startFun(){
var CheckQuantityResult = CheckQuantity();
if (CheckQuantityResult != '')
{
	alert(CheckQuantityResult);
	return;
}
xmlDoc=docstr.GetXmlContentByRows();
InsertXmlHeader(xmlDoc,"Summa",docstr.GetTableSumma(),"%String")
InsertXmlHeader(xmlDoc,"Oper",Oper.value,"Operation.OperTemplate")
InsertXmlHeader(xmlDoc,"Name",Name.value,"%String")
InsertXmlHeader(xmlDoc,"Comment",Comment.value,"%String")
InsertXmlHeader(xmlDoc,"InstDate",InstDate.value,"%Date")
InsertXmlHeader(xmlDoc,"Kontr",Kontr.Tag,"Common.Kontragent")
InsertXmlHeader(xmlDoc,"imp",imp.value,"%String")
InsertXmlHeader(xmlDoc,"showcolor",showcolor.value,"%String")
InsertXmlHeader(xmlDoc,"Depot1",Depot1.value,"Store.Depot")
if(Oper.value==10){
	InsertXmlHeader(xmlDoc,"RashOplatType",RashOplatType.value,"Common.Dictionary7");
	InsertXmlHeader(xmlDoc,"dostavka",dostavka.value,"Common.Dictionary1");
	}

var DocID=SendXml(DocId,"Operation.Instructions",xmlDoc,sessionid);
if(isNaN(DocID)){alert(DocID)}
else{returnValue=1;window.close();}
}

function AddBrak(){
WinResult=window.showModalDialog("SelectBrak.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
var ok=#server(Docs.Action2.MakeBrakInstruction(WinResult,ReturnSpace(DocId)))#
if(isNaN(ok)){alert(ok)}
else{
	//alert('Надо перезагрузить таблицу строк');
	DocId=ok;
	docstr.Clear();
	docstr.loadfrommethod("Docs.Action2.ChiefInstructStr",DocId);
	}
}

// Добавить товар
function AddGood()
{
	if(Oper.value==11)
		{
		AddBrak();
		return;
		}
	WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;");
	if(WinResult==null)return;
	WinResult=WinResult.split(StringSplitter);
	docstr.AddRowsInstruct(WinResult);
}

// удалить строку
function RemoveRow(){
	docstr.RemoveSelectedRows();
}

// Очистить список
function ClearGrid(){
if(window.confirm("Удалить все товарные строки?"))docstr.Clear()	
}

function windowclose(){
if(window.confirm("Вы уверены?")){
	if((OriginalInstructionId=="")&&(DocId!=""))
		{
		#server(Docs.Action.deletedoc("Operation.Instructions",DocId))#
		}
	window.close();
}
}

</script>
</head>

<body onload="load()" onkeypress="ManageWindow();">
<table width=100%><tr><td>
<table class="LeftTop" cellspacing=0 width=100%>
<script language="cache" runat="server">
 s InstrID=%request.Get("source")
 i InstrID {
 	&sql(select Oper,Name,Comment,InstDate,Kontr,imp,showcolor,Depot1,dostavka,RashOplatType,Kontr->Name,CloseDate,CloseTime,CloseUser->Name,Stat,postnumber,postdata,Summa,%external(HasBeenSent),BrakComment,PhotoFile,User1 
 	into 
 	:Oper,:Name,:Comment,:InstDate,:Kontr,:imp,:showcolor,:Depot1,:dostavka,:RashOplatType,:KontrName,:CloseDate,:CloseTime,:CloseUserName,:Stat,:postnumber,:postdata,:Summa,:HasBeenSent,:BrakComment,:PhotoFile,:User1
 	from Operation.Instructions where ID=:InstrID)
 	i SQLCODE w "<tr><td colspan=4>Ошибка при выводе инструкции "_InstrID_"<br>SQLCODE="_SQLCODE_"</td></tr>"
 	i Stat=2 d
 	. s ClosedString=CloseUserName_" "_$S(CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(CloseTime:$ZT(CloseTime),1:"")
 	. s ClosedString=ClosedString_" "_HasBeenSent
 	. s SaveButtonStyle="display:none"
 	i postdata s postdata=$ZD(postdata,4)
 }

w "<tr>"
	w "<td class=RightBottom>Шаблон операции"
	w "<td class=RightBottom>"
	w "<select id='Oper' onchange='ShowHideRashOplatType(this)'>"
	w ##class(Docs.Action2).GetClassValuesOptions($G(Oper),"Operation.OperTemplate")
	w "</select>"
	w "<td class=RightBottom>Сумма"
	w "<td class=RightBottom>"_$G(Summa)_"&nbsp;"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Краткое описание (номер)<td class=RightBottom><input type=text id=Name MAXLENGTH=50 value='"_$G(Name)_"'>"
	w "<td class=RightBottom>Комментарий<td class=RightBottom><input type=text id=Comment MAXLENGTH=1000 Value='"_$G(Comment)_"'>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Дата<td class=RightBottom><input type=text id=""InstDate"" value='"_$ZD($G(InstDate,$H),4)_"' onclick=""fnCalendar(this)"" class=""datar"" onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"">"
	w "<td class=RightBottom>Контрагент<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseKonragent(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Kontr"" Tag='"_$G(Kontr)_"'>"_$G(KontrName)_"</span>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Важность"
	w "<td class=RightBottom>"
	w "<select id=""imp"">"
	w ##class(Docs.Action2).GetDisplaylistOptions($G(imp),"Operation.Instructions||imp")
	w "</select>&nbsp;",!
	w "<td class=RightBottom>Выделить цветом"
	w "<td class=RightBottom>"
	w "<select id=""showcolor"">"
	w ##class(Docs.Action2).GetDisplaylistOptions($G(showcolor),"Operation.Instructions||showcolor")
	w "</select>"

w "<tr>"
	w "<td class=RightBottom>Склад"
	w "<td class=RightBottom>"
	w "<select id='Depot1'>"
	w ##class(Docs.Action2).GetClassValuesOptions($G(Depot1),"Store.Depot")
	w "</select>"
	w "<td class=RightBottom><span id=ZakazInstr5 class=ZakazInstr>Почтовый документ</span>&nbsp;"
	w "<td class=RightBottom><span id=ZakazInstr6 class=ZakazInstr>"_$G(postnumber)_"&nbsp;"_$G(postdata)_"</span>&nbsp;"

w "<tr>"
	w "<td class=RightBottom><span id=ZakazInstr1 class=ZakazInstr>Способ оплаты</span>&nbsp;"
	w "<td class=RightBottom><span id=ZakazInstr2 class=ZakazInstr><select id='RashOplatType'>"
	w ##class(Docs.Action2).GetClassValuesOptions($G(RashOplatType),"Common.Dictionary7")
	w "</select></span>&nbsp;"
	w "<td class=RightBottom><span id=ZakazInstr3 class=ZakazInstr>Способ доставки</span>&nbsp;"
	w "<td class=RightBottom><span id=ZakazInstr4 class=ZakazInstr>"
	w "<select id='dostavka'>"
	w ##class(Docs.Action2).GetClassValuesOptions($G(dostavka),"Common.Dictionary1")
	w "</select></span>&nbsp;"
	w "</tr>"

if $G(BrakComment)'="" d
	. w "<tr>"
	. w "<td class=RightBottom>Комментарий клиента&nbsp;"
	. w "<td class=RightBottom colspan=""3"">"_$G(BrakComment)
	. w:$G(PhotoFile)'="" " <a href=""ClientImages\"_$G(PhotoFile)_""" target=_blank>фотоприложение</a>"

w:$G(ClosedString)'="" "<tr><td colspan=4 class=RightBottom>Инструкция завершена <i>"_ClosedString_"</i>"
</script>
</table>
<tr height=100%><td>
<SKLADiGrid:iGrid id="docstr" width="100%" height="300" Enabled="true" RowMode="true" /><br>
<CSP:IF CONDITION="(+$G(User1)||'+InstrID)">
	<sklad:Button value="Добавить товар" onclick="AddGood();" style="width:150px">
	<sklad:Button value="Удалить строку" onclick="RemoveRow();" style="width:150px">
	<sklad:Button value="Очистить строки" onclick="ClearGrid();" style="width:150px">
<CSP:ELSE>
	<sklad:Button value="Добавить товар" onclick="AddGood();" style="width:150px">
</CSP:IF>
<tr><td>
<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</table>

</body>
</html>]]></CSP>


<CSP name="CreateNewDict.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var argArr=window.dialogArguments.split(";");
var ItemID=argArr[0];
var ClassName=argArr[1];

function startFun(){
if(ReturnSpace(ItemID)==""){question="Создать запись?"}
else{question="Изменить запись?"}
if(!window.confirm(question))return false;
NamesStr=PropTable.names;
RowDataStr=PropTable.ColumnData(1);
TypesStr=PropTable.ColumnTypes(1);
ok=#server(Common.Common.CreateClass(ClassName,ItemID,NamesStr,RowDataStr,TypesStr))#
if(ok.split(".")[0]=="Common"){returnValue=1;window.close();}
else{alert(ok);}
}

function load(){
PropTable.DownLoadPairs(ClassName,ItemID);
}


</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<fieldset style="width:100%;height:200"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width="100%" />
</fieldset>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="createrole.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>

<script language="cache" runat="server">
	s sbor=""
	&sql(declare perscur Cursor for
	select ID,Name into IDname,Funcname 
	from Users.Functions)
	&sql(open perscur)
	f  &sql(fetch perscur) q:SQLCODE  d
	.i $I(i)
	.s iden(i)=IDname
	.s func(i)=Funcname
	&sql(close perscur)
s rolename=$G(%request.Data("rolename",1))
s zrolename=%request.Get("rolename")
f k=1:1:i d
 .s sbor=sbor_"if (myform.comp"_k_".checked==true){(func["_k_"]="_iden(k)_")};                                                           "
 
</script>
<html>
<head>
<script language="JScript">
	var func=new Array();
	function Saveroles(){
	qwe=#(i)#;
	for(l=1;l<=qwe;l++){
	 func[l]=0;}
	role=document.myform.rolename.value;
	#(sbor)#
	var str = func.join("~"); 
	if (role==""){alert("ведите название роли"); document.my.rolename.focus(); return false};
	if(!window.confirm("Создать роль"+" "+role))return false; 
	#server(Users.NameRoles.SaveRole(role))#;
	#server(Users.Roles.SaveRole(role,str))#;	
    window.close();
	}
</script>
<title>	Пользователи </title>
</head>
<body>
<table><tr><td>
<form name="myform">
Введите название роли:</td><td>
<input type="text" name="rolename" width=100 value=""></td></tr>
<tr><td>Функции роли:</td><td>
<script language="cache" runat="server">
f j=1:1:i w "<INPUT TYPE=checkbox NAME=""comp"_j,""" VALUE=""",j,""">",func(j),"</td></tr><tr><td></td><td>",!
</script>
<input type="button" value="Сохранить" onclick="Saveroles()"></td></tr>
</form>
</table>
</body>
</html>
]]></CSP>


<CSP name="createstorage.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s source=%request.Get("source")

 i source'=""
 {
	 s DocClass=##class(Docs.Action).GetClassFromSource(source)
	 s naklad=##class(Docs.Super).%OpenId(source)
	 s instrname=naklad.Name_$S(DocClass="Docs.StorageOut":"-о",DocClass="Docs.StorageIn":"-р")
 }
 
 s super=%request.Get("super")
 i super'="" 
 {
	 s superdoc=##class(Operation.Instructions).%OpenId(super)
	 s instr=superdoc.innerinstr
	 i $ISOBJECT(instr)
	 {
		 s doc=instr.%Id()
		 s DocClass=$P(instr,"@",2)
	 }
 }
 s:$G(DocClass)'="" DocType=##class(Docs.Action).GetDocNameFromClass(DocClass)
 k ^mtempAddress($G(%session.Data("user"),"undef"))
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
if(("#($G(doc))#"=="")&&("#($G(super))#"!="")){alert("Внутренняя инструкция ещё не привязана к данной инструкции");window.close();}
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=ReturnSpace(Arguments[0]);
var DocID=ReturnSpace(Arguments[1]);
var DocType=ReturnSpace(Arguments[2]);
var source="#(source)#";
if("#($G(DocClass))#"!=""){
	var ClassName="#($G(DocClass))#"
}
if("#($G(DocType))#"!=""){
	var DocType="#($G(DocType))#"
}
if("#($G(doc))#"!=""){
	var DocID="#($G(doc))#"
}
function load(){
if(ClassName!="Docs.StorageOut")docstr.runValidateAddress="true";
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,Summa,Kontr,User1");
docstr.ClassName=ClassName+"Items";
docstr.LoadHeadersXML("Doc,DocType,Quantity,Price,Total");
}

function startFun(){
DocID=ReturnSpace(Arguments[1]);
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var DocID=SplitSendXml(DocID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
if(isNaN(DocID)){alert(DocID);return}
if(source!=""){
	var ok=#server(Docs.Action.SetSourceDoc(ClassName,DocID,source))#;
	if(isNaN(ok)){alert(ok);return;}
}
var ok3=#server(Docs.Action.PrihNeedsDiff(DocID))#
if(isNaN(ok3)&&(ok3!="yes")){alert(ok3);return false;}
if(ok3=="yes"){
	okdiff=window.showModalDialog("docinnerdiff.csp?source="+DocID,"Docs.InnerDiff"+InnerSplitter+""+InnerSplitter+"","cener:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	if(okdiff!=1){
		if(okdiff!=null)alert(okdiff);
		return false;}
 	var ok2=#server(Docs.Action.SetSourceDoc("Docs.InnerDiff",okdiff,DocID))#
 	}	 
returnValue=1;
window.close();
}

function LoadTovars(){
if(source==""){var doc=DocID;}
else{var doc=source;}
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",doc,"",ClassName);
}

//function ValidateAddress(Goods, Address, Value){
function ValidateAddress(RowArray2){
var Address=RowArray2["addr"]
var Value=RowArray2["quantdefault"]
var Goods=RowArray2["Goods"]

var ret=#server(Store.Action.validate(Goods,Address,Value))#
if(ret==1) return true;
return ret;
}

function fillname(){
if(DocID==""){
PropTable.setCellValue("Name","#($G(instrname))#");}
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	//FieldCaption["Price"]=getPrice(FieldValue["Goods"]);
	docstr.AddRow(FieldCaption,FieldValue);
}
}

</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=320 height=200 onLoadComplete="fillname();" />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 Silent="Goods" onAddColumns="LoadTovars()" QuantityField="quantdefault"/>
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<!--
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
-->
</fieldset>
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</body>
</html>]]></CSP>


<CSP name="Data.csp" application="/csp/sklad2/" default="1"><![CDATA[
<Script language="cache" runat="server">
 s class=%request.Get("class") 
 s fields=%request.Get("fields")
 s params=%request.Get("params")
 s where=%request.Get("where")
 s param("order")=%request.Get("order")
 s xml=%request.Get("xml")
 s param("kolbasaddr")=+%request.Get("kolbasaddr")
 s param("currentpage")=+%request.Get("currentpage")
 s param("stroknastr")=+%request.Get("stroknastr")
  i $P(class,".",1)="User" s $P(class,".",1)="SQLUser"

 w ##class(Common.Common).showdata(class,fields,params,where,xml,"",.param)
 </script>
 
 ]]></CSP>


<CSP name="delGoodsProp.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADz XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
function startFun(){
if(!window.confirm("Внимание!\nУдаление свойства приведёт к потере данных хранящихся в этом свойстве у ВСЕХ товаров. На ВСЕХ складах.\nВы хотите удалить?"))return false;
ok=#server(Goods.GoodsAction.DeleteProperty(PropTable.CurrentRowTag))#
if(ok==1){returnValue=1;window.close();}
else{alert(ok);}
}

function load(){
PropTable.DownLoadPairs('','',"Weight,Size1,Name");
}

</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<center>
<fieldset style="width:250px"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width=220 height=200 DisplaySecondCol="none"  />
</fieldset><br><bR>
<sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()">
</center>
</body>
</html>
]]></CSP>


<CSP name="Dictionary.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
sessionid="#(%session.SessionId)#";

var ColCode="";
startwhere='#($G(%request.Data("where",1)))#';
function load(){
	Dictionary2.ClassName=window.dialogArguments;
	ClassName=window.dialogArguments;
	if(ClassName=="Common.Dictionary4"){
		Dictionary2.loadfrommethod("Reports.ShowTables.showanalogs",startwhere);
	}
	else{
		var SkipFields="";
		if(ClassName=="Users.Dates"){var SkipFields="Login,Password";}
		Dictionary2.LoadHeaders(SkipFields);
		}
}

function ItemPlan(PlanID){
PlanID=ReturnSpace(PlanID)
ok=window.showModalDialog("DictItem.csp",PlanID+";"+ClassName,"cener:yes;status:no;dialogHeight:350px;dialogWidth:400px;resizable:yes;")
if(ok==1){Show()}
}

function Show(where){
	var where=ReturnSpace(where);
	KontrGroup.style.display="none";
	if(ClassName=="Common.Dictionary4"){
		Dictionary2.loadfrommethod("Common.Common.showanalogs",startwhere+" and "+where);
	}
	else{
		if(ClassName=="Common.Kontragent"){
			KontrGroup.style.display="inline";
			var Add="";
			if(where!=""){var Add=" and ";}
			if(KontrGroupSel.value!=""){
				where=where+Add+"Property2506="+KontrGroupSel.value;
			}
		}
		Dictionary2.DownLoad(where);}
}

function startFun(){
	if(ClassName=="Common.Dictionary4"){var itemname=Dictionary2.item("Property6625--Property3609")+" "+Dictionary2.item("Property6625--Name");}
	else{var itemname=Dictionary2.ItemName;}
	window.returnValue=Dictionary2.ItemID+InnerSplitter+itemname;
	window.close();
}

function gg(){
if(ColCode=="")return false;
Show(ColCode+" %STARTSWITH '"+fldval.value+"'")
}

function colclick(){
	namfld.innerText=Dictionary2.ColName;
	ColCode=Dictionary2.ColCode;
}
</script>
</head>
<body onload="load()" >
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
<span id="KontrGroup" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	Вид деятельности: 
	<select id="KontrGroupSel" onchange="Show()">
	<script language="Cache" runat="server">
		w ##class(Docs.Action2).GetDisplaylistOptions(,"Common.Kontragent||Property2506")
	</script>
	</select>
</span>
<fieldset><legend></legend>
 <SKLADList:listview width=100% height=150 id="Dictionary2" onAddColumns="Show()" zonDblClick="startFun();" zonColumnClick="colclick()"/><br>
  <sklad:LittleButton name="new" id="newtov1" onclick="ItemPlan()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="edititem" onclick="ItemPlan(Dictionary2.ItemID)" alt="Редактировать запись">
  <!--
  <sklad:LittleButton name="del" id="deltov1" onclick="demo()" alt="Удалить запись">
  -->
</fieldset>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</body>
</html>]]></CSP>


<CSP name="DictItem.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s skip=%request.Get("skip")
 s show=%request.Get("show")
</script>
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var argArr=window.dialogArguments.split(";");
var ItemID=argArr[0];
var ClassName=argArr[1];

function startFun(){
if(ReturnSpace(ItemID)==""){question="Создать запись?"}
else{question="Изменить запись?"}
if(!window.confirm(question))return false;
NamesStr=PropTable.names;
RowDataStr=PropTable.ColumnData(1);
TypesStr=PropTable.ColumnTypes(1);
ok=#server(Common.Common.SaveItem(ClassName,ItemID,NamesStr,RowDataStr,TypesStr))#
//alert("первый"+isNaN(ok.substr(0, 1)) )
if(!isNaN(ok.substr(0, 1))){returnValue=1;window.close();}
else{alert(ok);}
}

function load(){
PropTable.DownLoadPairs(ClassName,ItemID,"#(skip)#","","#(show)#");
}


</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<fieldset style="width:100%;height:200"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width="100%" />
</fieldset>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="DictItem2.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var argArr=window.dialogArguments.split(";");
var ItemID=argArr[0];
var ClassName=argArr[1];
function startFun(){
if(ReturnSpace(ItemID)==""){question="Создать запись?"}
else{question="Изменить запись?"}
if(!window.confirm(question))return false;
NamesStr=PropTable.names;
RowDataStr=PropTable.ColumnData(1);
TypesStr=PropTable.ColumnTypes(1);
ok=#server(Common.Common.SaveItem(ClassName,ItemID,NamesStr,RowDataStr,TypesStr))#
if(!isNaN(ok.substr(0, 1))){returnValue=1;window.close();}
else{alert(ok);}
}

function load(){
PropTable.DownLoadPairs(ClassName,ItemID);
}

function lookstore(){
	mok=window.showModalDialog("storemodal.csp","","cener:yes;status:no;dialogHeight:500px;dialogWidth:600px;resizable:yes;");
	if(mok==null)return
	PropTable.setCellValue("Depot",mok.split(InnerSplitter)[1],mok.split(InnerSplitter)[0])
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<fieldset style="width:100%;height:200"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width="100%" />
</fieldset>
  <sklad:LittleButton name="new" id="newtov" onclick="lookstore()" alt="Просмотреть склады">
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="dicts.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,4) s %response.ServerSideRedirect="norights.csp" 
 s HaveRightsForGoods = ##class(Common.Rights).getrights(login,9)
 q 1
</script>

<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
 <link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>
<style>
 .ui-jqgrid {font-size:90%;}
 .ui-widget {font-size:1.2em;}
</style>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
GoodsWindow = "ok";
CurrentDictionaryID = "";
ColCode="";
sessionid="#(%session.SessionId)#";
var where="";
GoodsWindow = "";

function load()
{
	//currentdict.attachEvent("onAddColumns", showdictionary)
	//dictionary.LoadHeaders();
}

function Item()
{
	mok=window.showModalDialog("CreateNewDict.csp",CurrentDictionaryID+";Common.Dicts","center:yes;status:no;dialogHeight:400px;dialogWidth:400px;resizable:yes;")
	if(mok==null)return false
	if(mok==1){ShowList()}
}

function ShowList()
{
	//dictionary.DownLoad();
}

function AddProp()
{
	if(CurrentDictionaryID=="")return
	ok=window.showModalDialog("AddGoodsProp2.csp?ItemID="+CurrentDictionaryID,CurrentDictionaryID,"center:yes;status:no;dialogHeight:330px;resizable:yes")
	if(ok==1){ShowList();return false;}
	if(ok==null){return false;}
	alert(ok)
}

function ShowProps(ItemID,ItemName)
{
	//ItemID=ReturnSpace(dictionary.ItemID);
	//PropTable.ClearRows();
	//PropTable.DownLoadPairs(ItemID,'');	
	CurrentDictName.innerText=ItemName;
	currentdict.ClassName=ItemID;
	var made=false;
	if(ItemID=="Common.Dictionary4"){
		//товар и его аналоги
		currentdict.loadfrommethod("Reports.ShowTables.showanalogs","");
		var made=true;
		if(typeof btnDelete == "object"){btnDelete.style.display="inline";}
	}
	else{if(typeof btnDelete == "object"){btnDelete.style.display="none";}}
	if(ItemID=="Common.Dictionary2"){
		//гарантийные талоны
		currentdict.loadfrommethod("Reports.ShowTables.showgarants","");
		var made=true;
	}	
	var AdditionalFields="";  //добавочные поля
	if(ItemID=="Common.Dictionary10"){var AdditionalFields="Property7148->ModelNumber~Модель~~~@%String~~~~~#@#"}
	if(!made){currentdict.LoadHeaders("","",AdditionalFields);}
}

function showdictionary(where)
{
	if(!makeShowDict.checked)return
	where=ReturnSpace(where);
	var made=false;
	KontrGroup.style.display="none";
	EditList.style.display="none";
	if(currentdict.ClassName=="Common.Dictionary4"){
		currentdict.loadfrommethod("Reports.ShowTables.showanalogs",where);
		var made=true;
	}
	if(currentdict.ClassName=="Common.Dictionary2"){
		currentdict.loadfrommethod("Reports.ShowTables.showgarants",where);
		var made=true;
	} 
	if(currentdict.ClassName=="Common.Kontragent"){
		KontrGroup.style.display="inline";
		EditList.style.display="inline";
		var Add="";
		if(where!=""){var Add=" and ";}
		if(KontrGroupSel.value!=""){
			where=where+Add+"Property2506="+KontrGroupSel.value;
			}
	}
	if(!made)
	{
		//alert(where);
		currentdict.DownLoad(where);
	}
}

//создать новую запись
function addrecord(currentrecord)
{
	var currentrecord=ReturnSpace(currentrecord)
	var currentclass=currentdict.ClassName;
	var made=false;
	if((currentclass=="Common.Kontragent")&(currentrecord!=""))
	{
		ok=window.showModalDialog("kontragent.csp?KontrId="+currentrecord,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if((currentclass=="Common.Dictionary2")&(currentrecord!=""))
	{
		ok=window.showModalDialog("garant.csp?GarantId="+currentrecord,currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
		
	if((currentclass=="Common.Dictionary2")&(currentrecord==""))
	{
		ok=window.showModalDialog("ManyGarants.csp",currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if(currentclass=="Common.Dictionary4")
	{
		ok=window.showModalDialog("AnalogForm.csp?id="+currentrecord,currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if(!made){ok=window.showModalDialog("DictItem.csp",currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:350px;dialogWidth:400px;resizable:yes;")}
	if(ok!=null)showdictionary()
}

function gg()
{
	if(ColCode=="")return false;
	where = ColCode+" %STARTSWITH '"+fldval.value+"'";
	if(fldval.value=="")where="";
	showdictionary(where);
}

function colclick(){
	if(currentdict.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=currentdict.ColName;
	ColCode=currentdict.ColCode;
}

function fnKontrList(){
var ok=window.showModalDialog("KontragentsListEdit.csp?Where="+where,"","center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;")
if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}
}

function showReport8(){
var Dates=rep7dat1.value+"@"+rep7dat2.value;
report8.loadfrommethod("Reports.Analyzis.OtpravkaKontragentu",Dates,TovarIDs,KontrID)
}

function fnMeetingResult(){
var KontrId=currentdict.ItemID;
if(KontrId=="")return;
var ok=window.showModalDialog("KontrMeetingResult.csp?Kontr="+KontrId,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function fnDeleteItem(CurrentID)
{
 var ok = #server(Common.Common.DeleteItem(currentdict.ClassName,CurrentID))#;
 if(isNaN(ok)){alert(ok);}
 else{showdictionary(where);}
}

function TestFastGoods()
{
	alert(window.parent.GoodsWindow);
	return;
	
	if(typeof(frameElement.document.all.MainFrameSet.tag) == "object")
	{
		alert(frameElement.document.all.MainFrameSet.tag.tagName)	
		frameElement.document.all.MainFrameSet.tag.dialogTop = "100px";
	}
	else
	{
		frameElement.document.all.MainFrameSet.tag = showModelessDialog("selectgoods3.csp",document,"center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;");
	}
	alert(frameElement.document.all.MainFrameSet.tag);
}

</script>
</head>
<body onload="load()" >
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Справочники</strong></TD>
<td width=10% align=right><a href="help/dictshelp.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<br>
<fieldset><legend>Справочники</legend>
<!--
 <SKLADList:listview width=100% height=150 id="dictionary" onAddColumns="ShowList()" ClassName="Common.Dicts" zonDblClick="Item()" zClick="ShowProps(dictionary.ItemID,dictionary.ItemName)"/><br>
--> 
 <table id="grid"><tr><td></td></tr></table><div id="bar"></div><br>
  <sklad:LittleButton name="new" id="newtov1" onclick="Item()" alt="Создать справочник">
  <!--
  <sklad:LittleButton name="edit" id="edititem" onclick="Item(dictionary.ItemID)" alt="Редактировать справочник">
  -->
  <sklad:LittleButton name="new+" id="newprop" onclick="AddProp()" alt="Добавить поле справочника">
</fieldset>
<br>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
<span id="KontrGroup" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	Вид деятельности: 
	<select id="KontrGroupSel" onchange="showdictionary()">
	<script language="Cache" runat="server">
		w ##class(Docs.Action2).GetDisplaylistOptions(,"Common.Kontragent||Property2506")
	</script>
	</select>
</span>

<fieldset ><legend id="CurrentDictName"></legend>
<!--
<SKLAD2:table id="PropTable" width=400 height=200 DisplaySecondCol="none" />
-->
<SKLADList:listview width=100% height=150 id="currentdict" zonDblClick="addrecord(currentdict.ItemID);" zonColumnClick="colclick()" onAddColumns="showdictionary()" /><br>
<table width=100%><tr><td>
  <sklad:LittleButton name="new" id="newrec" onclick="addrecord()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="addrec" onclick="addrecord(currentdict.ItemID)" alt="Редактировать запись">
  <CSP:IF CONDITION="HaveRightsForGoods">
  	<sklad:LittleButton name="del" id="btnDelete" onclick="fnDeleteItem(currentdict.ItemID)" alt="Удалить запись" style="display:none">
  </CSP:IF> 
  <span id="EditList" style="display:none">
   <sklad:LittleButton name="history" id="btnKontrListEdit" onclick="fnKontrList()" alt="Редактировать список контрагентов">
  <sklad:LittleButton name="user" id="btnUser" onclick="fnMeetingResult()" alt="История общения с контрагентом">
</span>
</td>
<td align=right>
Поддерживать таблицу в актуальном состоянии
<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
</td>
</tr>
</fieldset>
		<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
		<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
		<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
		<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
		<script type='text/javascript'>
		
		
		$(function(){
				var GRID="#grid",BAR="#bar",URL="json.CommonDicts.cls";

				$(GRID).jqGrid({
						caption: 'Cправочники'
						,url: URL, editurl: URL
						,datatype: "json"
						,jsonReader : { repeatitems: false }
						,colModel: [
							{name:"gd",hidden: true}
							,{name:"nm",label:"Наименование",width:350
								, search:true
							}
							,{name:"cm",label:"Описание",width:250
								, search:true
							}
						]
						//,idPrefix:"kt"
					 ,pager:BAR 
					 ,viewrecords:true
					 ,height:300
					 ,hidegrid: false
					 ,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
					 ,/*scrollrows:true,*/hoverrows:true ,scroll:1
					 ,ondblClickRow: function(id){addrecord(id);}
					 ,onSelectRow: function(id) {ShowProps(id,$("#grid").getCell(id,2));CurrentDictionaryID=id;}
 		})
 		.jqGrid('navGrid',BAR, {
	       	add: false
       		, edit:false
       		, del:false 
       		, view:false
       		, search:false
       }
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{ //Параметры удаления
	       afterSubmit: function(resp){
		      var text=resp.responseText;
		      var arr=eval(text); 
		      return arr;
		   }
	   } 
   ).jqGrid('filterToolbar',{searchOnEnter:false})
   .jqGrid('gridResize',{});
 	$(BAR+"_center").remove(); //пагинатора не будет
 	$(BAR+"_left").css("width","70%"); //надпись о количестве записей на бОльшую часть футера
});


</script>
</body>
</html>]]></CSP>


<CSP name="dicts_old.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,4) s %response.ServerSideRedirect="norights.csp" 
 s HaveRightsForGoods = ##class(Common.Rights).getrights(login,9)
 q 1
</script>

<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
GoodsWindow = "ok";
ColCode="";
sessionid="#(%session.SessionId)#";
var where="";
GoodsWindow = "";

function load()
{
	//currentdict.attachEvent("onAddColumns", showdictionary)
	dictionary.LoadHeaders();
}

function Item(ItemID)
{
	ItemID=ReturnSpace(ItemID)
	mok=window.showModalDialog("CreateNewDict.csp",ItemID+";"+dictionary.ClassName,"center:yes;status:no;dialogHeight:400px;dialogWidth:400px;resizable:yes;")
	if(mok==null)return false
	if(mok==1){ShowList()}
}

function ShowList()
{
	dictionary.DownLoad();
}

function AddProp()
{
	ItemID=ReturnSpace(dictionary.ItemID)
	if(ItemID=="")return
	ok=window.showModalDialog("AddGoodsProp2.csp?ItemID="+ItemID,ItemID,"center:yes;status:no;dialogHeight:330px;resizable:yes")
	if(ok==1){ShowList();return false;}
	if(ok==null){return false;}
	alert(ok)
}

function ShowProps()
{
	ItemID=ReturnSpace(dictionary.ItemID);
	//PropTable.ClearRows();
	//PropTable.DownLoadPairs(ItemID,'');	
	CurrentDictName.innerText=dictionary.ItemName;
	currentdict.ClassName=ItemID;
	var made=false;
	if(ItemID=="Common.Dictionary4"){
		//товар и его аналоги
		currentdict.loadfrommethod("Reports.ShowTables.showanalogs","");
		var made=true;
		if(typeof btnDelete == "object"){btnDelete.style.display="inline";}
	}
	else{if(typeof btnDelete == "object"){btnDelete.style.display="none";}}
	if(ItemID=="Common.Dictionary2"){
		//гарантийные талоны
		currentdict.loadfrommethod("Reports.ShowTables.showgarants","");
		var made=true;
	}	
	var AdditionalFields="";  //добавочные поля
	if(ItemID=="Common.Dictionary10"){var AdditionalFields="Property7148->ModelNumber~Модель~~~@%String~~~~~#@#"}
	if(!made){currentdict.LoadHeaders("","",AdditionalFields);}
}

function showdictionary(where)
{
	if(!makeShowDict.checked)return
	where=ReturnSpace(where);
	var made=false;
	KontrGroup.style.display="none";
	EditList.style.display="none";
	if(currentdict.ClassName=="Common.Dictionary4"){
		currentdict.loadfrommethod("Reports.ShowTables.showanalogs",where);
		var made=true;
	}
	if(currentdict.ClassName=="Common.Dictionary2"){
		currentdict.loadfrommethod("Reports.ShowTables.showgarants",where);
		var made=true;
	} 
	if(currentdict.ClassName=="Common.Kontragent"){
		KontrGroup.style.display="inline";
		EditList.style.display="inline";
		var Add="";
		if(where!=""){var Add=" and ";}
		if(KontrGroupSel.value!=""){
			where=where+Add+"Property2506="+KontrGroupSel.value;
			}
	}
	if(!made)
	{
		//alert(where);
		currentdict.DownLoad(where);
	}
}

//создать новую запись
function addrecord(currentrecord)
{
	var currentrecord=ReturnSpace(currentrecord)
	var currentclass=currentdict.ClassName;
	var made=false;
	if((currentclass=="Common.Kontragent")&(currentrecord!=""))
	{
		ok=window.showModalDialog("kontragent.csp?KontrId="+currentrecord,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if((currentclass=="Common.Dictionary2")&(currentrecord!=""))
	{
		ok=window.showModalDialog("garant.csp?GarantId="+currentrecord,currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
		
	if((currentclass=="Common.Dictionary2")&(currentrecord==""))
	{
		ok=window.showModalDialog("ManyGarants.csp",currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if(currentclass=="Common.Dictionary4")
	{
		ok=window.showModalDialog("AnalogForm.csp?id="+currentrecord,currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
		var made=true;
	}
	
	if(!made){ok=window.showModalDialog("DictItem.csp",currentrecord+";"+currentclass,"center:yes;status:no;dialogHeight:350px;dialogWidth:400px;resizable:yes;")}
	if(ok!=null)showdictionary()
}

function gg()
{
	if(ColCode=="")return false;
	var ItemID=ReturnSpace(dictionary.ItemID);
	//if(ItemID=="Common.Dictionary2"){where = ColCode+" LIKE '%"+fldval.value+"%'";}
	//else{where = ColCode+" %STARTSWITH '"+fldval.value+"'";}
	where = ColCode+" %STARTSWITH '"+fldval.value+"'";
	//alert("where = " + where);
	if(fldval.value=="")where="";
	showdictionary(where);
}

function colclick(){
	if(currentdict.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=currentdict.ColName;
	ColCode=currentdict.ColCode;
}

function fnKontrList(){
var ok=window.showModalDialog("KontragentsListEdit.csp?Where="+where,"","center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;")
if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}
}

function showReport8(){
var Dates=rep7dat1.value+"@"+rep7dat2.value;
report8.loadfrommethod("Reports.Analyzis.OtpravkaKontragentu",Dates,TovarIDs,KontrID)
}

function fnMeetingResult(){
var KontrId=currentdict.ItemID;
if(KontrId=="")return;
var ok=window.showModalDialog("KontrMeetingResult.csp?Kontr="+KontrId,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function fnDeleteItem(CurrentID)
{
 var ok = #server(Common.Common.DeleteItem(currentdict.ClassName,CurrentID))#;
 if(isNaN(ok)){alert(ok);}
 else{showdictionary(where);}
}

function TestFastGoods()
{
	alert(window.parent.GoodsWindow);
	return;
	
	if(typeof(frameElement.document.all.MainFrameSet.tag) == "object")
	{
		alert(frameElement.document.all.MainFrameSet.tag.tagName)	
		frameElement.document.all.MainFrameSet.tag.dialogTop = "100px";
	}
	else
	{
		frameElement.document.all.MainFrameSet.tag = showModelessDialog("selectgoods3.csp",document,"center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;");
	}
	alert(frameElement.document.all.MainFrameSet.tag);
}

</script>
</head>
<body onload="load()" >

<CSP:IF CONDITION="login=7">
	<input type="text" id="EdtTest" style="width:300px"><input type="button" id="testBtn" value="Тест быстрого окошка с товарами" onclick="TestFastGoods();"><br><br>
	<input type="text" id="edtText" style="width:300px">
<input type="button" value="test" onclick="alert(eval(edtText.value));">
</CSP:IF>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Справочники</strong></TD>
<td width=10% align=right><a href="help/dictshelp.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<br>
<fieldset><legend>Справочники</legend>
 <SKLADList:listview width=100% height=150 id="dictionary" onAddColumns="ShowList()" ClassName="Common.Dicts" zonDblClick="Item()" zClick="ShowProps()"/><br>
  <sklad:LittleButton name="new" id="newtov1" onclick="Item()" alt="Создать справочник">
  <!--
  <sklad:LittleButton name="edit" id="edititem" onclick="Item(dictionary.ItemID)" alt="Редактировать справочник">
  -->
  <sklad:LittleButton name="new+" id="newprop" onclick="AddProp()" alt="Добавить поле справочника">
</fieldset>
<br>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
<span id="KontrGroup" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	Вид деятельности: 
	<select id="KontrGroupSel" onchange="showdictionary()">
	<script language="Cache" runat="server">
		w ##class(Docs.Action2).GetDisplaylistOptions(,"Common.Kontragent||Property2506")
	</script>
	</select>
</span>

<fieldset ><legend id="CurrentDictName"></legend>
<!--
<SKLAD2:table id="PropTable" width=400 height=200 DisplaySecondCol="none" />
-->
<SKLADList:listview width=100% height=150 id="currentdict" zonDblClick="addrecord(currentdict.ItemID);" zonColumnClick="colclick()" onAddColumns="showdictionary()" /><br>
<table width=100%><tr><td>
  <sklad:LittleButton name="new" id="newrec" onclick="addrecord()" alt="Создать запись">
  <sklad:LittleButton name="edit" id="addrec" onclick="addrecord(currentdict.ItemID)" alt="Редактировать запись">
  <CSP:IF CONDITION="HaveRightsForGoods">
  	<sklad:LittleButton name="del" id="btnDelete" onclick="fnDeleteItem(currentdict.ItemID)" alt="Удалить запись" style="display:none">
  </CSP:IF> 
  <span id="EditList" style="display:none">
   <sklad:LittleButton name="history" id="btnKontrListEdit" onclick="fnKontrList()" alt="Редактировать список контрагентов">
  <sklad:LittleButton name="user" id="btnUser" onclick="fnMeetingResult()" alt="История общения с контрагентом">
</span>
</td>
<td align=right>
Поддерживать таблицу в актуальном состоянии
<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
</td>
</tr>
</fieldset>
</body>
</html>]]></CSP>


<CSP name="DictVersions.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
w ##class(Common.Common).GetCurrentDictVersion("Goods.Goods")
w $C(9)
w ##class(Common.Common).GetCurrentDictVersion("Goods.Group")
</script>]]></CSP>


<CSP name="director.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 s Access13func=##class(Common.Rights).getrights(+login,13)
 i '+Access13func s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<html XMLNS:SKLADList >
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>

<title>	Рабочее место руководителя предприятия </title>
<script language="javascript">
sessionid="#(%session.SessionId)#";


function load()
{
	instr.LoadHeaders("Tim,Dat,Summa,Stat,Operation,showcolor,postnumber,postdata,PhotoFile,imp,innerinstr");
	var ActsExcludeFields = "Tim,Dat,Summa,SellerAddress,SellerDate,SellerPhone,ExpertDate,RemontDate,RemontDate,DefectEstimate,DefectClass,RepairRefuseReason,CustomerDoc,CustomerAddress,CustomerPhone,GoodsKeeping,SrvAddr,SrvPhone,Stat,CheckResult,ActType,PaidTime,PaidUser,CloseDate,CloseTime,CloseUser,DefectClassDescr,Goods";
	var ActsAdditionalFields = "Goods->FullName~Изделие~~~@%String~~~~~#@#";
	acts.LoadHeaders(ActsExcludeFields,"",ActsAdditionalFields);
	ShowZap();
}

// показать инструкции
function ShowInstr()
{
	var Data1=ConvertDateSql(dat11.value);
	var Data2=ConvertDateSql(dat21.value);
	var Federal=FedOkr0.value;
	instr.DownLoad("InstDate>=CAST('"+Data1+"' AS DATE) and InstDate<=CAST('"+Data2+"' AS DATE) and BrakComment<>'' and (Kontr->Federal='"+Federal+"' OR 'undefined'='"+Federal+"')"); 
}

// показать акты
function ShowActs()
{
	var Data1=ConvertDateSql(dat12.value);
	var Data2=ConvertDateSql(dat22.value);
	var Federal=FedOkr1.value;
	acts.DownLoad("Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE) and Stat=2 and (Kontr->Federal='"+Federal+"' OR 'undefined'='"+Federal+"')");
	
}

// показать заявки данного федерального округа
function ShowZap()
{
	zap.loadfrommethod("Reports.ShowTables.ShowDetailsSent",FedOkr.value,dat13.value,dat23.value)
}

// Печать инструкции
function PrintInstr(ItemID)
{
	if(ReturnSpace(ItemID)=="")return
	window.open("screen/ChiefInstr.csp?docid="+ItemID)
}

// Печать акта
function PrintAct(ItemID)
{
	if(ReturnSpace(ItemID)=="")return
	var url="print.csp?id="+ItemID+"&class="+acts.ClassName+"&sessionid="+sessionid
	window.open(url);
}

// Печать инструкции
function PrintZap(ItemID)
{
	if(ReturnSpace(ItemID)=="")return
	window.open("screen/ChiefInstr.csp?docid="+ItemID)
}

</script>
</head>

<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()" style="cursor:hand"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Рабочее место руководителя предприятия</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>

<!-- заявки с негативными отзывами -->
<br><br>
<fieldset><legend>Заявки на которые есть негативные отзывы</legend>

	Федеральный округ: <select id="FedOkr0">
	<option value="undefined">Все</option>
	<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions("","Common.Dictionary18",,,0)
	</script>
	</select>

	Период c <input type=text id="dat11" value="#("1/"_+$ZD($H,1)_"/"_+$ZD($H,3))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat21" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	<sklad:LittleButton name="ok" id="okbut11" onclick="ShowInstr()" alt="Показать записи"><br>
	<SKLADList:listview width=100% height=350 id="instr" onAddColumns="ShowInstr()" ClassName="Operation.Instructions" zonDblClick="PrintInstr(instr.ItemID)" Skip="Source->Name,child->Name" />
	<sklad:LittleButton name="print" id="printInstr" onclick="PrintInstr(instr.ItemID)" alt="Печать инстукции">
</fieldset>

<!-- акты -->
<br><br>
<fieldset><legend>Акты</legend>
	Федеральный округ: <select id="FedOkr1">
	<option value="undefined">Все</option>
	<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions("","Common.Dictionary18",,,0)
	</script>
	</select>
	Период c <input type=text id="dat12" value="#("1/"_+$ZD($H,1)_"/"_+$ZD($H,3))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat22" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	<sklad:LittleButton name="ok" id="okbut22" onclick="ShowActs()" alt="Показать записи"><br>
	<SKLADList:listview width=100% height=350 id="acts" onAddColumns="ShowActs()" ClassName="Docs.Act" zonDblClick="PrintAct(acts.ItemID)" Skip="Source->Name,child->Name" />
	<sklad:LittleButton name="print" id="printActBut" onclick="PrintAct(acts.ItemID)" alt="Печать акта">
</fieldset>

<!-- отправка запчастей по федеральным округам -->

<br><br>
<fieldset><legend>Отправка запчастей</legend>
	Федеральный округ: <select id="FedOkr">
	<option value="">Все</option>
	<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions("","Common.Dictionary18",,,0)
	</script>
	</select>
	<script language="javascript">
	//alert("#($ZD($H,4))#");
	</script>
	<!--
	Период c <input type=text id="dat13" value="#("1/"_+$ZD($H,1)_"/"_+$ZD($H,3))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat23" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	-->
	Период c <input type=text id="dat13" value="" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat23" value="" onclick="fnCalendar(this)" class="datar">
	<sklad:LittleButton name="ok" id="okbut33" onclick="ShowZap()" alt="Показать записи"><br>
	<SKLADList:listview width=100% height=350 id="zap" zonDblClick="PrintZap(zap.ItemID)" />
	<sklad:LittleButton name="print" id="printZapBut" onclick="PrintZap(zap.ItemID)" alt="Печать инструкции">
</fieldset>

</body>
</html>
]]></CSP>


<CSP name="docdiff.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s source=%request.Get("source")
 s:source'="" sourceClass=##class(Docs.Action).GetClassFromSource(source)
 s DocType=##class(Docs.Action).GetDocNameFromClass("Docs.Diff")
 s silent=%request.Get("silent")
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=Arguments[0];
var DocID=ReturnSpace(Arguments[1]);
var DocType="#(DocType)#";
//alert("ClassName="+ClassName+"\nDocID="+DocID+"\nDocType="+DocType)
var source="#(source)#";
var sourceClass="#($G(sourceClass))#";
if((source=="")&&(DocID=="")){
	alert("Акт расхождения не может быть создан отдельно.");
	window.close();}

function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
if(source!=""){var srcdoc=source+"@"+sourceClass;}
else{var srcdoc="";}
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,User1",srcdoc);
docstr.ClassName=ClassName+"Items";
docstr.attachEvent("onAddColumns",loadgoods2);
docstr.LoadHeadersXML("Doc,DocType");
}

function loadgoods2(){
if(source!=""){var doc=source}
else{var doc=DocID}
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",doc,2,ClassName)
}

function startFun(){
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var ok=SplitSendXml("",ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
//docstrData=docstr.GetData("rows");
//docstrTypes=docstr.GetDataProps("Type");
//docstrNames=docstr.GetDataProps("Name")+"~";
//PropTableData=PropTable.GetData("cols");
//PropTableTypes=PropTable.ColumnTypes(1);
//PropTableNames=PropTable.names;
//ok=#server(Docs.Action.CreateDoc(ClassName,"",PropTableData,PropTableNames,PropTableTypes,docstrData,docstrNames,docstrTypes))#
//создатель документа вернёт его ID
if(isNaN(ok)){
	alert(ok);
}
else{
 if(source!=""){
	var ok=#server(Docs.Action.SetSourceDoc(ClassName,ok,source))#
 	if(isNaN(ok))alert(ok)
 }
 returnValue=1;
 window.close();
}
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	docstr.AddRow(FieldCaption,FieldValue);
}
}
</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 Silent="Goods" CountTotal="true" displaybar=true />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
</fieldset>
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="DocImages.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Фотографии документа </title>
<script language="javascript" type="text/javascript">
function delimg(curimg){

if(isNaN(ok))alert(ok);
else{window.close();}
}

function prnt(){
window.print();
}

function printimg(curimg){
//window.open("PrintImage.csp?ImageSrc=GoodsImages"+curimg);
}
</script>
</head>

<body>
<script language="cache" runat="server">

 s DocId=%request.Get("DocId")
 q:DocId=""
 s docobj=##class(Docs.Super).%OpenId(DocId)
 s images=docobj.Images
 w "<center><font size=+2>"_docobj.Name_"</font></center>"
 
 f i=1:1:$L(images,"\") d
 . s currentimg=$P(images,"\",i)
 . d:$L(currentimg)>2 
 . . //w "<img src=""images/del.gif"" style='cursor:hand' onmouseover=""this.src='images/Ondel.gif'"" onmouseout=""this.src='images/del.gif'""  id=""delbut"_i_""" alt=""Удалить"" onclick=""delimg('/"_currentimg_"')"">"
 . . //w "<img src=""images/print.gif"" style='cursor:hand' onmouseover=""this.src='images/Onprint.gif'"" onmouseout=""this.src='images/print.gif'""  id=""printbut"_i_""" alt=""Печать"" onclick=""printimg('/"_currentimg_"')"">"
 . . //w "<br>"
 . . w "<img src=""SkladInstrImages/"_currentimg_""" ><hr width=80%>"

</script>
</body>
</html>
]]></CSP>


<CSP name="docinner.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s silent=%request.Get("silent")
 k ^mtempAddress($G(%session.Data("user"),"undef"))
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
sessionid="#(%session.SessionId)#";
var Arguments=window.dialogArguments.split(InnerSplitter);
//коль скоро страница для одного документа так и не грех класс втупую указать
var ClassName="Docs.Inner";
var DocID=Arguments[1];
var DocType="Внутреннее перемещение";

function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
PropTable.DownLoadPairs(ClassName,DocID,"Dat,Tim,Stat,Source,DocType,Kontr,Summa,User1");
docstr.ClassName=ClassName+"Items";
docstr.attachEvent("onAddColumns",loadgoods2)
docstr.LoadHeadersXML("Doc,DocType,Price,Total");
}

function loadgoods2(){
if(DocID!=""){
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",DocID,2,3)}
}

function startFun(){
DocID=Arguments[1];
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var DocID=SplitSendXml(DocID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
//создатель документа вернёт его ID
if(isNaN(DocID)){
	alert(DocID);
}
else{
 returnValue=1;
 window.close();
}
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	docstr.AddRow(FieldCaption,FieldValue);
}
}

function getstorecell(goods,addr){
var val=#server(Store.Action.getquantaddr(goods,addr))#
return val
}

function ValidateAddress(RowArray2){
var Address=RowArray2["addr"]
var Value=RowArray2["Quantity"]
var Goods=RowArray2["Goods"]

var ret=#server(Store.Action.validate(Goods,Address,Value))#
if(ret==1) return true;
return ret;
}

function prnt(){
window.open("print.csp?id="+DocID+"&class="+ClassName+"&sessionid="+sessionid)
}
</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 runValidateAddress="true" QuantityField="Quantity" displaybar=true />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<!--
<sklad:LittleButton name="print" id="apint" onclick="prnt()" alt="Распечатать документ">
-->
</fieldset>
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="docinnerdiff.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s silent=%request.Get("silent")
 s source=%request.Get("source")
 //s source="360"
 s:source'="" sourceClass=##class(Docs.Action).GetClassFromSource(source)
 s DocType=##class(Docs.Action).GetDocNameFromClass("Docs.InnerDiff")
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=Arguments[0];
var DocID=Arguments[1];
var DocType="#(DocType)#";
var source="#(source)#";
var sourceClass="#($G(sourceClass))#";

if((source=="")&&(DocID=="")){
	alert("Внутренний акт расхождения не может быть создан отдельно.");
	window.close();}


function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
if(source!=""){var srcdoc=source+"@Docs.StorageOut";}
else{var srcdoc="";}
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,Kontr",srcdoc);
docstr.ClassName=ClassName+"Items";
docstr.attachEvent("onAddColumns",loadgoods2)
docstr.LoadHeadersXML("Doc,DocType,Quantity");
}

function loadgoods2(){
if(source!=""){var doc=source}
else{var doc=DocID}
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",doc,2,ClassName)
}


function startFun(){
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var ok=SplitSendXml("",ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");

//создатель документа вернёт его ID
if(isNaN(ok)){
	alert("Ошибка \n"+ok);
}
else{
 var ok2=#server(Docs.Action.SetSourceDoc(ClassName,ok,source))#
 if(isNaN(ok2))alert("Ошибка \n" +ok2)
 returnValue=1;
 window.close();
}
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	docstr.AddRow(FieldCaption,FieldValue);
}
}

function getstorecell(goods,addr){
var val=#server(Store.Action.getquantaddr(goods,addr))#
return val
}

function setsumm(){
var val=docstr.Total;
var val=val.toFixed(2);
PropTable.setCellValue("Summa",val);
}
</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 Silent="Goods" CountTotal="true" QuantityField="quantreal" displaybar=true Totalchange="setsumm()" />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
</fieldset>
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="docinvent.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s silent=%request.Get("silent")
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=Arguments[0];
var DocID=Arguments[1];
var DocType=Arguments[2];

function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,Kontr,User1");
docstr.ClassName=ClassName+"Items";
docstr.attachEvent("onAddColumns",loadgoods2)
docstr.LoadHeadersXML("Doc,DocType");
}

function loadgoods2(){
if(DocID!=""){
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",DocID,2,3)}
}

function startFun(){
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var ok=SplitSendXml(DocID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
//создатель документа вернёт его ID
if(isNaN(ok)){
	alert(ok);
}
else{
 returnValue=1;
 window.close();
}
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter);
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[4] + " " + onestr[8] + " " + onestr[1];
	FieldValue["Goods"]=onestr[0];
	FieldCaption["Price"]=getPrice(FieldValue["Goods"]);
	docstr.AddRow(FieldCaption,FieldValue);
}
}

function getPrice(tovid){
return #server(Goods.GoodsAction.getprice(tovid))#;
}

function getstorecell(goods,addr){
var val=#server(Store.Action.getquantaddr(goods,addr))#
return val
}

function setsumm(){
var val=docstr.Total;
var val=val.toFixed(2);
PropTable.setCellValue("Summa",val);
}

function winclose(){
if(window.confirm("Вы уверены?")){window.close();}
}

// обработчик события OnCellChange таблицы строк документов
function docstrPropChange(){
	if(docstr.cellChange.colname=="Quantity"){
		var newQuantity=docstr.cellChange.value;
				
		var price = docstr.item("Price")
		
		var NewTotal=price*newQuantity;
		if(typeof(NewTotal)=="number"){var NewTotal=NewTotal.toFixed(2)}
		if(NewTotal=="NaN"){return}
		docstr.setCellValue("Total",NewTotal);
		setsumm();
}
}
</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 Silent="Goods" CountTotal="true" displaybar=true Totalchange="setsumm()" OnCellChange="docstrPropChange()"/>
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
</fieldset>
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="winclose()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="docplatej.csp" application="/csp/sklad2/" default="1"><![CDATA[
<CSP:CLASS INCLUDES="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 .  s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 s innerkurs=$$$TunesVariableGlobal("innerkurs")
Quit 1
</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:170px;cursor:hand;}
.ZakazInstr{display:inline;}
BODY{margin: 20px}
</style>
<script language="jscript" src="common.js"></script>
<title>Платёжное поручение</title>

<script language="Jscript">
var login='#(%session.Data("user"))#';
var DocId='#(%request.Get("DocId"))#';
var sessionid="#(sessionid)#";
var innerkurs=Number("#(innerkurs)#");

function load(){

}

// сохранить
function startFun()
{
	if(!HiddenCurrencyReculc())return;
	
	var xmlDoc = new ActiveXObject("Msxml2.DOMDocument.3.0");
	var RootElement = xmlDoc.createElement("RootElement");
	xmlDoc.documentElement=RootElement;
	InsertXmlHeader(xmlDoc,"Summa",Summa.value,"%String")
	InsertXmlHeader(xmlDoc,"Name",Name.value,"%String")
	InsertXmlHeader(xmlDoc,"Kurs",Number(innerkurs),"%Numeric")
	InsertXmlHeader(xmlDoc,"Comment",Comment.value,"%String")
	InsertXmlHeader(xmlDoc,"RubSumma",RubSumma.value,"%String")
	InsertXmlHeader(xmlDoc,"Poluh",Poluh.Tag,"Store.Address")
	InsertXmlHeader(xmlDoc,"Kontr",Kontr.Tag,"Store.Address")
	InsertXmlHeader(xmlDoc,"Typeplatej",Typeplatej.value,"Store.Address")
	InsertXmlHeader(xmlDoc,"PlatejDate",PlatejDate.value,"%Date")
	//Cумма по брендам
	InsertXmlHeader(xmlDoc,"ViconteSummRub",ViconteSummRub.value,"%Numeric")
	InsertXmlHeader(xmlDoc,"ViconteSummCurr",ViconteSummCurr.value,"%Numeric")
	InsertXmlHeader(xmlDoc,"MastermaxSummRub",MastermaxSummRub.value,"%Numeric")
	InsertXmlHeader(xmlDoc,"MastermaxSummCurr",MastermaxSummCurr.value,"%Numeric")
	InsertXmlHeader(xmlDoc,"TullSummRub",TullSummRub.value,"%Numeric")
	InsertXmlHeader(xmlDoc,"TullSummCurr",TullSummCurr.value,"%Numeric")
	
	InsertXmlHeader(xmlDoc,"ActNumber",ActNumber.value,"%String")
	InsertXmlHeader(xmlDoc,"ActDate",ActDate.value,"%Date")
	InsertXmlHeader(xmlDoc,"InvoiceNumber",InvoiceNumber.value,"%String")
	InsertXmlHeader(xmlDoc,"InvoiceDate",InvoiceDate.value,"%Date")
	
	//alert(xmlDoc.xml)
	//
	var DocID=SendXml(DocId,"Docs.Platejka",xmlDoc,sessionid);
	if(isNaN(DocID)){alert(DocID)}
	else{returnValue=1;window.close();}
}

//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj){
newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}

// Пересчитать рубли
function CalcRub(Summa,DestinationObjId)
{
	DestinationObj = document.getElementById(DestinationObjId);
	DestinationObj.value=RubValue(Summa);
}

function RubValue(SummVar)
{
	//var SummVar=Number(Summa.value);
	var result=innerkurs*SummVar;
	return result.toFixed(2);
}

// Пересчитать валюту
function CalcCurrency(Summa,DestinationObjId)
{
	DestinationObj = document.getElementById(DestinationObjId);
	DestinationObj.value=CurrencyValue(Summa);
}

function CurrencyValue(SummVar)
{
	//var SummVar=Number(RubSumma.value);
	var result=SummVar/innerkurs;
	return result.toFixed(2);
}

function HiddenCurrencyReculc(){
return true;
var RubSummaFieldValue=Number(RubSumma.value);

if(RubValue()!=RubSummaFieldValue.toFixed(2))
	{
	var ok=window.confirm("Поле рублёвой суммы не соответствует сумме в валюте. Пересчитать?");
	if(ok)CalcRub();
	return ok;
	}

var SummaFieldValue=Number(Summa.value);
if(CurrencyValue()!=SummaFieldValue.toFixed(2))
	{
	var ok=window.confirm("Поле суммы не соответствует рублёвой сумме. Пересчитать?");
	if(ok)CalcCurrency();
	return ok;
	}
return true;
}

function ItemsClear(){
if(DocId=="")return
if(!window.confirm("Очистить таблицу платежей?"))return;
var ok=#server(Docs.Action.ClearPlatejkaItems(DocId))#;
Items.style.display="none";
}
</script>
</head>

<body onload="load()" onkeypress="ManageWindow();">
<table width=100% border=0><tr><td>
<table class="LeftTop" cellspacing=0 cellpadding=5 width=100%>
<script language="cache" runat="server">
 s DocId=%request.Get("DocId")
 i DocId {
 	//&sql(select Name,Comment,CloseDate,CloseTime,CloseUser->Name,Stat,Summa,Address,Common.SqlProcs_AddrPath(Address) into 
 	//:Name,:Comment,:CloseDate,:CloseTime,:CloseUserName,:Stat,:Summa,:Address,:AddressPath
 	//from Docs.Platejka where ID=:DocId)
 	s doc=##class(Docs.Platejka).%OpenId(DocId)
 	if $ISOBJECT(doc) {
 		f i="Name","Comment","CloseDate","CloseTime","Stat","Summa","RubSumma","Typeplatej","ViconteSummRub","ViconteSummCurr","MastermaxSummRub","MastermaxSummCurr","TullSummRub","TullSummCurr","PlatejDate","ActNumber","ActDate","InvoiceNumber","InvoiceDate"
 		{
	 		s @i=$ZOBJPROPERTY(doc,i)
 		}
 		s CloseUserName=doc.ChangeUser.Name
 		i '$ISOBJECT(doc) w "<tr><td colspan=4>Ошибка при выводе платёжного поручения "_DocId_"</td></tr>"
 		i Stat=2 
 		{
 			s ClosedString=CloseUserName_" "_$S(CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(CloseTime:$ZT(CloseTime),1:"")
 			s SaveButtonStyle="display:none"
 		}
 		s Typeplatej=$S($ISOBJECT(doc.Typeplatej):doc.Typeplatej.%Id(),1:"")
 		s Poluh=$S($ISOBJECT(doc.Poluh):doc.Poluh.%Id(),1:"")
 		s PoluhName=$S($ISOBJECT(doc.Poluh):doc.Poluh.Name,1:"")
 		s Kontr=$S($ISOBJECT(doc.Kontr):doc.Kontr.%Id(),1:"")
 		s KontrName=$S($ISOBJECT(doc.Kontr):doc.Kontr.Name,1:"")
 		s:+ActDate ActDate = $ZD(ActDate,4)
 		s:+InvoiceDate InvoiceDate = $ZD(InvoiceDate,4)
 		
 	}
 }
 else {
	//создаём новый документ
 	s doc=##class(Docs.Platejka).%New()
 	s Typeplatej=$S($ISOBJECT(doc.Typeplatej):doc.Typeplatej.%Id(),1:"")
 	s Poluh=$S($ISOBJECT(doc.Poluh):doc.Poluh.%Id(),1:"")
 	s PoluhName=$S($ISOBJECT(doc.Poluh):doc.Poluh.Name,1:"")
 	k doc
 	}

w "<tr>"
	w "<td class=RightBottom>Номер<td class=RightBottom><input type=text id=Name MAXLENGTH=50 value='"_$G(Name)_"'>"
	w "<td class=RightBottom>Комментарий<td class=RightBottom><input type=text id=Comment MAXLENGTH=1000 Value='"_$G(Comment)_"'>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Рублёвая сумма"_"<td class=RightBottom><input type=text id=RubSumma MAXLENGTH=50 value='"_$G(RubSumma)_"' onkeyup=""CalcCurrency(this.value,'Summa')"">"
	//w "<br><input type=""button"" onclick=""CalcCurrency()"" value=""Пересчитать валюту"">"
	w "<td class=RightBottom>Сумма"_"<td class=RightBottom><input type=text id=Summa MAXLENGTH=50 value='"_$G(Summa)_"' onkeyup=""CalcRub(this.value,'RubSumma')"">"
	//w "<br><input type=""button"" onclick=""CalcRub()"" value=""Пересчитать рубли"">"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Контрагент<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseKonragent(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Kontr"" Tag='"_$G(Kontr)_"'>"_$G(KontrName)_"</span>"
	w "<td class=RightBottom>Получатель платежа<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseKonragent(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Poluh"" Tag='"_$G(Poluh)_"'>"_$G(PoluhName)_"</span>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Курс у.е.<td class=RightBottom><input type=""text"" id=""Kurs"" value="""_innerkurs_""" onkeyup=""innerkurs=Number(this.value)"">"
	w "<td class=RightBottom>Тип платежа<td class=RightBottom>"
	w "<select id='Typeplatej'>"
	w ##class(Docs.Action2).GetClassValuesOptions($G(Typeplatej),"Common.Dictionary13")
	w "</select></span>&nbsp;"
w "</tr>"


w "<tr>"
	w "<td class=RightBottom valign=top>Дата платёжного поручения"
	w "<td class=RightBottom valign=top><input type=text id=""PlatejDate"" value='"_$S(+$G(PlatejDate):$ZD(PlatejDate,4),1:"")_"' onclick=""fnCalendar(this)"" class=""datar"" onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" >"
	w "<td class=RightBottom colspan=2>"
	&html<
		<table>
			<tr>
				<td>&nbsp;<td>Номер<td>Дата
			<tr>
				<td>Акт
				<td><input type="text" id="ActNumber" value="#($G(ActNumber))#" style="width:90px">
				<td><input type="text" class="datar" value="#($G(ActDate))#" id="ActDate" onclick="fnCalendar(this)" onmouseout="UnPaint(this)" onmouseover="Paint(this)" >
			<tr>
				<td>Счёт
				<td><input type="text" id="InvoiceNumber" value="#($G(InvoiceNumber))#" style="width:90px">
				<td><input type="text" class="datar" id="InvoiceDate" value="#($G(InvoiceDate))#" onclick="fnCalendar(this)" onmouseout="UnPaint(this)" onmouseover="Paint(this)" >	
		</table>
		>
w "</tr>"

 w "<tr><td class=RightBottom colspan=4><br>Суммы по брендам"
 f i="Viconte","Tull","Mastermax" d
 . w "<tr>"
 . w "<td class=RightBottom colspan=2>"_i_"</td>"
 . s RubName=i_"SummRub"
 . s CurrName=i_"SummCurr"
 . w "<td class=RightBottom><input type=""text"" id="""_RubName_""" value="""_$G(@RubName)_""" onkeyup=""CalcCurrency(this.value,'"_CurrName_"')"" style=""width:90px""> руб.</td>"
 . w "<td class=RightBottom><input type=""text"" id="""_CurrName_""" value="""_$G(@CurrName)_""" onkeyup=""CalcRub(this.value,'"_RubName_"')"" style=""width:90px""> у.е.</td>"
 . w "</tr>",!


w:$G(ClosedString)'="" "<tr><td colspan=4 class=RightBottom>Документ закрыт <i>"_ClosedString_"</i>"
</script>
</table>
<br><br>Расходные накладные, которые оплачены данным платёжным поручением.
<br><sklad:Button value="Очистить таблицу" onclick="ItemsClear();" style="width:200px;#($G(SaveButtonStyle))#"><br>
<table border=0 class="LeftTop" cellspacing=0 id="Items"><tr>
	<td class=RightBottom>Расходная накладная
	<td class=RightBottom>Оплаченная сумма
<script language="cache" runat="server">
 d:$ISOBJECT($G(doc))
 . s next="" f  s next=doc.PlatejkaItems.Next(next) q:next=""  d
 . . s item=doc.PlatejkaItems.GetAt(next)
 . . q:'$ISOBJECT(item)
 . . s RashObj=item.Rash
 . . q:'$ISOBJECT(RashObj)
 . . s Summa=item.Summa
 . . s Name=RashObj.Name
 . . s Itog=$G(Itog)+Summa
 . . w "<tr><td class=RightBottom>"_Name_"<td class=RightBottom>"_Summa
 w "<tr><td class=RightBottom>Итого:<td class=RightBottom>"_$G(Itog)
</script>
</table>
<tr><td>
<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</table>

</body>
</html>]]></CSP>


<CSP name="docprihorder.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s source=%request.Get("source")
 s:source'="" DocClass=##class(Docs.Action).GetClassFromSource(source)
 s:source'="" DocType=##class(Docs.Action).GetDocNameFromClass(DocClass)
 s silent=%request.Get("silent")
</script>
<html XMLNS:SKLAD2 >
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=Arguments[0];
var DocID=ReturnSpace(Arguments[1]);
var DocID333=DocID;
var DocType=Arguments[2];
//alert("ClassName="+ClassName+"\nDocID="+DocID+"\nDocType="+DocType)
var source="#(source)#";
if(source!=""){
	var ClassName="#($G(DocClass))#"
	var DocType="#($G(DocType))#"
}

function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,User1",source);
//docstr.ClassName=ClassName+"Items";
//if(source!=""){docstr.attachEvent("onAddColumns",loadgoods)}
//else{docstr.attachEvent("onAddColumns",loadgoods2)}
//docstr.LoadHeadersXML("Doc,DocType");
}

function startFun(){
DocID=ReturnSpace(Arguments[1])
var xmldoc=PropTable.GetXmlContent();
//var xmldoc2=docstr.GetXmlContent();
var DocID=SplitSendXml(DocID,ClassName,xmldoc,"","#(%session.SessionId)#");
if(isNaN(DocID)){
	alert(DocID);
}
else{
 if(source!=""){
	var ok2=#server(Docs.Action.SetSourceDoc(ClassName,DocID,source))#
 	if(isNaN(ok2))alert(ok2)
 }
 if(ClassName=="Docs.Prih"){
 	var ok3=#server(Docs.Action.PrihNeedsDiff(DocID))#
 	if(isNaN(ok3)&&(ok3!="yes"))alert(ok3)
 	if(ok3=="yes"){
	 	okdiff=window.showModalDialog("docdiff.csp?source="+DocID,"Docs.Diff"+InnerSplitter+""+InnerSplitter+"","cener:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	 	if(okdiff!=1){alert(okdiff);return false;}
	 	var ok2=#server(Docs.Action.SetSourceDoc("Docs.Diff",okdiff,DocID))#
 	}	 
 }returnValue=1;
 window.close();
}
}


function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	FieldCaption["Price"]=getPrice(FieldValue["Goods"]);
	docstr.AddRow(FieldCaption,FieldValue);
}
}


function fillrash(){
if((ClassName=="Docs.Rash")&(DocID=="")){
var val=#server(Docs.Action.getRashNumb())#
PropTable.setCellValue("Name",val);
PropTable.Silent="Name";}
}

</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 onLoadComplete="fillrash()" />
<!--
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 CountTotal="true" Totalchange="setsumm()" displaybar=true />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
</fieldset>
-->
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="docs.csp" application="/csp/sklad2/" default="1"><![CDATA[
<CSP:PARAMETER name="DOMAIN" value="SKLAD2"/>
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,3) s %response.ServerSideRedirect="norights.csp" 
 s ActRights = ##class(Common.Rights).getrights(login,12)
  
  s SaveChoice=%request.Get("SaveChoice") 
  if %request.Get("SaveChoice") 
  {
	  d ##class(User.Settings).SetSettingValue("DocsPage",%request.PageName)
  }
  
 q 1
</script>
<script language="Cache" method="ShowDocItemsHeaders" arguments="Class:%String" returntype="%String">
 Quit ##class(Common.Common).showheaders(Class)
</script>
<script language="Cache" method="SetBrakAnswer" arguments="ID:%String,Answer:%String" returntype="%String">
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 s obj.BrakCommentAnswer = Answer
 s obj.BrakCommentAnswerUser = $G(%session.Data("user"))
 s obj.BrakCommentAnswerDat = +$H
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
</script>
<script language="Cache" method="ShowDocItems" arguments="Class:%String,DocId:%String" returntype="%String">
 n str,i,fields
 s str=##class(Common.Common).showheaders(Class,,,1)
 for i=1:1:$L(str,"#@#")
 {
	s header=$P(str,"#@#",i) 
	s headerKey = $P(header,"~")
	s fields=$G(fields)_headerKey_","
 }
 s fields=$E(fields,1,$L(fields)-2)

 q ##class(Common.Common).showdata(Class,fields,,"doc="_DocId,,1)
</script>

<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV8.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
#footer { position: absolute;	bottom: 0; width: 100%; }
.datar{width:70;border:none;cursor:hand}
</style>

<script language="Jscript" src="common.js"></script>
<script language="JavaScript" type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
<!-- Добавляет функционал проверки серийных номеров для отчета о ремонте -->
    <script src="js/pages/docs3.js"></script>
<script language="JScript">
var d1,d2;
var ActRights = #(ActRights)#;
var ItemsClassName;
//var IGridDocstrObj;

sessionid="#(%session.SessionId)#";
depot="#($G(%session.Data("depot")))#"
docssame="#($G(%session.Data("docssame")))#";

var login = '#($G(login))#';

function load(){
//IGridDocstrObj = document.getElementById("IGridDocstr");
doctypes.LoadHeaders();
docums.login=login;
docitems.login=login;
doctypes.login=login;
}

function show(){
doctypes.DownLoad();
}

function okfunc()
{
	var AdditionalFieldsDocs="";
	StorageOutField.style.display="none";
	TypDocument.innerText=doctypes.ItemName;
	var doctypesItemID=doctypes.ItemID	//название класса выбранного в списке типов документов
	docums.ClassName=doctypesItemID;
	//if(doctypesItemID=="Docs.Platejka")return
	if(doctypesItemID=="Docs.PrihKassOrder")return
	docitems.ClassName=doctypesItemID+"Items";
	var ExcludeFields="Goods,Doc,DocType,RequestItem";
	var AdditionalFields="";
	if(doctypesItemID!="Docs.Platejka")var AdditionalFields="Goods->FullName~Наименование~~~@%String~~~~~#@#";
	
	if(docitems.ClassName=="Docs.RashItems")
	{
		var ExcludeFields=ExcludeFields+",ZakazGoods";
		var AdditionalFields=AdditionalFields+"ZakazGoods->FullName~Заказанный товар~~~@%String~~~~~#@#";
	}
	
	if(doctypes.ItemID=="Docs.Rash"){okbwut3.style.display="inline";}
	else{okbwut3.style.display="none";}
	
	if(doctypesItemID=="Docs.Otchet")
	{
		OtchetSpecButton.style.display="inline";
	}
	else{OtchetSpecButton.style.display="none";}

	if(doctypesItemID=="Operation.Instructions")
	{
		InstrSpecButton.style.display="inline";
	}
	else{InstrSpecButton.style.display="none";}	
	
	if(ActRights==1)
	{
		if(doctypesItemID=="Docs.Act")
		{
			ActSpecButton.style.display="inline";
			ActAddFields.style.display="inline";
		}
		else
		{
			ActSpecButton.style.display="none";
			ActAddFields.style.display="none";
		}
	}
	if(doctypes.ItemID=="Docs.StorageOut"){StorageOutField.style.display="inline";}
	
	d1 = new Date();
	docums.LoadHeaders("ActType","",AdditionalFieldsDocs);
	docitems.LoadHeaders(ExcludeFields,"",AdditionalFields);

}

//показать документы
function showdocums()
{
	var order="";
	var DocClass = doctypes.ItemID;
	//if(doctypes.ItemID=="Docs.Otchet"){var order="NameSorted"}
	dateArr=dat1.value.split("/")
	Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	dateArr=dat2.value.split("/")
	Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
	if(docssame==0){var requst=request+" and Depot="+depot;} //если  показ всех документов для всех складов то
	var currentKontragent=ChooseKontragent.value;
	if(currentKontragent!="all" && DocClass!="Docs.Sluzap"){var request=request+" and Kontr="+currentKontragent}
	if(currentKontragent!="all" && DocClass=="Docs.Sluzap"){var request=request+" and Docs.Sluzap_IsKontrInDoc(ID  ,'"+currentKontragent+"')=1"}
	if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
	var ShowUnpaidObject = document.getElementById("ShowUnpaid");
	if(typeof(ShowUnpaid)=="object")
	{
		if(ShowUnpaidObject.checked)var request=request+" and Paid=0"
	}
	
	
	docums.DownLoad(request,"","",order)
	d2 = new Date();
	//alert("вывод документов\n" + (d2-d1) + "\n" + d1.toLocaleTimeString() + "\n" + d2.toLocaleTimeString());
	LoadIgridHeaders();
}

// загрузить заголовки iGrid
function LoadIgridHeaders()
{
	if(ItemsClassName==doctypes.ItemID+"Items")return;
	
	//IGridDocstrObj.Clear(true);
	ItemsClassName = doctypes.ItemID+"Items";
	
	headers=#server(..ShowDocItemsHeaders(ItemsClassName))#
	headersArray = headers.split("#@#");
	var headersArraylength = headersArray.length;
	
	var Captions = new Array(headersArraylength);
	var Keys = new Array(headersArraylength);
	var Tags = new Array(headersArraylength);
	var Widths = new Array(headersArraylength);
	
	for (var i = 0; i< headersArray.length-1; i++)
	{
		//здесь каждый отдельный заголовок
		var h = headersArray[i];
		var headerArray = h.split("~");
		Captions[i] = headerArray[1];
		Keys[i] = headerArray[0];
		Tags[i] = "";
		Widths[i] = 80;
	}
	
	//IGridDocstrObj.DrawHeaders(Captions,Keys,Tags);
}

//загрузить данные в iGrid
function LoadIgridData(DocId)
{
	var data = #server(..ShowDocItems(ItemsClassName,DocId))#

	IGridDocstrObj.Clear(false);
	IGridDocstrObj.LoadStringData(data);
}

function CreateDocument(ItemID)
{
	CurrentDocementClass=docums.ClassName
	if(CurrentDocementClass==""){alert("Не выбран тип документа");return}
	ItemID=ReturnSpace(ItemID)
	var doccsp="document.csp";
	//if (CurrentDocementClass=="Docs.DocBrak"){alert("Документы на приём брака создаются и редактируются на рабочем месте сервис менеджера. Инструкциями с типом \"Приём брака\"");return}
	if(CurrentDocementClass=="Docs.Rash"){var doccsp="DocsRash.csp?source="+ItemID;}
	if(CurrentDocementClass=="Docs.Utiliz")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="UtilizationDoc.csp?DocId="+ItemID}
		else{doccsp="docutiliz.csp"}
	}
	if(CurrentDocementClass=="Docs.PrihKassOrder")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Invent")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="InventarizationIgrid.csp?source="+ItemID}
		else{doccsp="docinvent.csp"}
	}
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	if(CurrentDocementClass=="Docs.InnerDiff")doccsp="docinnerdiff.csp"
	if(CurrentDocementClass=="Docs.Remont"){alert("Заявка на запчасти создается инструкцией руководителя\nили в карточке контрагента");return;}
	if(CurrentDocementClass=="Docs.Otchet")
	{
		if(ItemID==""){doccsp="Otchet.csp?docid="+ItemID;}
		else{alert("Отчёты редактировать запрещено.");return;}
	}
	if(CurrentDocementClass=="Docs.Act")
	{
		doccsp="ActFromClient.CSP?docid="+ItemID;
		//alert("Акты технического состояния создаются только в менеджере отчётов");return;
	}
	if((CurrentDocementClass=="Docs.StorageIn")||(CurrentDocementClass=="Docs.StorageOut")){alert("Внутренняя инструкция создается на рабочем месте кладовщика");return;}
	if(CurrentDocementClass=="Operation.Instructions"){doccsp="createinstructIgrid.csp?source="+ItemID}
	if(CurrentDocementClass=="Docs.Sluzap"){doccsp="screen/sluzap.csp?docid="+ItemID}
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"center:yes;status:no;dialogHeight:660px;dialogWidth:800px;resizable:yes;")
	if(WinResult==1)showdocums();
}
	
//показать строки документа
function showitems()
{
	var dd1 = new Date();
	var currentdoc=ReturnSpace(docums.ItemID);
	if(currentdoc=="")return
	docitems.DownLoad("Doc="+currentdoc,1)
	var dd2 = new Date();
	$("#CurrDocName").text(docums.ItemName);
	//LoadIgridData(currentdoc);
	//alert("вывод строк\n" + (dd2-dd1) + "\n" + dd1.toTimeString() + "\n" + dd2.toTimeString());	
}

function processdoc()
{
	if(docums.ItemID=="")return
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var ok=#server(Docs.Action.processdoc(doc))#
	//alert("код результата обработки документа: " + ok);
	if(isNaN(ok))
		{
			alert(ok)
			if(doctypes.ItemID=="Docs.Otchet")
			{
				ShowOtchetErrorsFn('Errors');
			}
		}
	else{
			showdocums();
		}
}

function printdoc()
{
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var doccsp="document.csp";
	if(CurrentDocementClass=="Docs.Utiliz")doccsp="docutiliz.csp"
	if(CurrentDocementClass=="Docs.Invent")doccsp="docinvent.csp"
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	//window.open("print.csp?doc="+doc);
}

//распечатать документ
function prnt(docid,docclass,param){
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;
if(param=="word")
{
	url=url+"&word=on"
}
if ((docclass=="Docs.Otchet")&&(param=="word"))
{
	if(window.confirm("Печатать все поля документа?")){url=url+"&AllColumns=1"}
	//window.prompt(url,url);
}

if (docclass=="Docs.Sluzap")
{
	url = "screen/sluzap.csp?docid="+docid;
}

window.open(url);
}

function makescet(cl){
var doc=docums.ItemID;
if(doc==""){alert("Не выбран документ - основание для формирования платежного поручения");return}
WinResult=window.showModalDialog("makescet.csp?docid="+doc+"&class="+cl,"","center:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")
}

function PrintTorg12FromOtchet()
{
	var OtchetID = docums.ItemID;
	//var url="print.csp?id="+doc+"&class=torg12fromotchet&sessionid="+sessionid;
	var NewDocId = #server(Docs.Action2.MakeRashFromOthet(OtchetID))#
	if (isNaN(NewDocId))
	{
		alert(NewDocId);
		return;
	}
	maketovnakl('tovnakladn',NewDocId);	
}

function maketovnakl(tovnakladn,doctov)
{
	if(doctov==""){alert("Не выбран документ - основание для формирования товарной накладной");return}
	//WinResult=window.showModalDialog("maketovnakl.csp?docid="+doctov+"&class="+tovnakladn,"","center:yes;status:no;dialogHeight:400px;dialogWidth:450px;resizable:yes;")
	var url = "csp.makeTovNaklV2.cls" //"maketovnakl.csp"
    WinResult=window.showModalDialog(url+"?docid="+doctov+"&class="+tovnakladn,""
    	,"dialogWidth:640px;dialogHeight:480px;center:yes;status:no;resizable:yes;")
}

function deldoc(){
if(!window.confirm("Удалить документ " + docums.ItemName + " ?"))return false;
var classname=docums.ClassName;
var itemid=docums.ItemID;
var ok1=#server(Docs.Action.deletedoc(classname,itemid))#
if(isNaN(ok1)){alert(ok1)}
else{okfunc();}
}

// Выбрать контрагента
function ChooseKontragentFunc(){
	var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
	if(UsersSelection=="choose")
	{
		var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
		if(newKontragent==null){
			ChooseKontragent.selectedIndex=0;
			return false;}
		var ChooseKontragentLength = ChooseKontragent.options.length;
		ChooseKontragent.options.length= ChooseKontragentLength + 1;
		ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
		ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
		ChooseKontragent.selectedIndex=ChooseKontragentLength;
	}
}

function EmailDocumentFn(ItemID,ItemClass){
	alert("Функция отключена");
	return;
	var MailSetup=window.showModalDialog("MailSetup.csp","","center:yes;status:no;dialogHeight:200px;dialogWidth:500px;resizable:yes;");
	//вернётся следующая строка
	//Формировать DOC файл (false/true);Открывать Email программу (false/true);принудительный адрес отправки;Файл-шаблон
	//например: "true;true;"
	//или: "false;true;artemu78@rambler.ru;first-template"
	if(MailSetup==null)return
	var values=MailSetup.split(";");
	
	if(ReturnBoolean(values[0])){
		//создать файл
		var WaitWindow=window.open("wait.csp","win2", "status=no,width=200,height=200");
		ok=#server(Kontragent.Action.MakeFile(ItemID,ItemClass,values[3]))#
		WaitWindow.close();
		if(isNaN(ok)){alert(ok);return}
		else{alert("Файл успешно создан")}
	}
	if(ReturnBoolean(values[1])){
		//открыть почтовую программу
		if(values[2]!="")
			{
			var MailAddress=values[2];		//
			}
		else
			{
			var MailValues=#server(Docs.Action.EmailFromDoc(ItemID,ItemClass))#			
			var MailValuesArray=MailValues.split(StringSplitter);
			var MailAddress=MailValuesArray[0];
			var KontrName=MailValuesArray[1];
			var DocTypeName=MailValuesArray[2];
			var DocName=MailValuesArray[3];
			if(MailValues==""){alert("Не удалось определить E-mail у контрагента записанного в документе.\nУкажите пожалуйста адрес вручную или заполните соответствующее поле контрагента.");return}
			
			}
	window.open("mailto:"+KontrName+" <"+MailAddress+">?subject="+OurName+"&body=Здравствуйте "+KontrName+"\n\n\n---------\n"+OurName)
	}
}

function ChangeTovInDocFn(){
var itemid=docums.ItemID;
var answer=window.showModalDialog("ChangeGoods.csp?DocId="+itemid+"&sessionid="+sessionid,"","center:yes;status:no;dialogHeight:550px;dialogWidth:800px;resizable:yes;");
if(answer)showitems()
}

function ShowLogOfCreation(){
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбрана инструкция по отгрузке.");return;}
window.open("LogOfCreation.csp?doc="+docums.ItemID);
}

//указанное поле документа в отдельном окне
function ShowOtchetErrorsFn(PropertyName)
{
	window.showModalDialog("Info.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property="+PropertyName,"","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}

//отклонить отчёт
function setOtchetFailed()
{
	if(!window.confirm("Отклонить отчёт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
	var Descr = window.prompt("Укажите причину","");
	if(Descr==null)return;
	var ok= #server(Docs.Otchet.SetOthcetStatFailed2(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setOtchetAccepted(){
if(!window.confirm("Поставить отчёту статус \"Принят\"?"))return;
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
var ok= #server(Docs.Otchet.SetOthcetStatAccepted(docid))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}


function setActFailed()
{
	if(!window.confirm("Отклонить акт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
	var Descr = window.prompt("Укажите причину","");
	var ok= #server(Docs.Act.SetActStatFailed(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setActAccepted(){
var docid=docums.ItemID;
var ActNumber = #server(Docs.Action.getRashNumb("Docs.Act"))#;
var ActSumma = #server(Docs.Act.GetActSumma(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать сумму акта.\n"+ActSumma);return;}
var ActType = #server(Docs.Act.GetActType(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать тип акта.\n"+ActType);return;}
var answer = window.confirm("Поставить акту статус \"Принят\"?\n"+
	"Будущий номер акта "+ActNumber + "\n" + 
	"Сумма акта " + ActSumma);
if(!answer)return;
if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
var ok= #server(Docs.Act.SetActStatAccepted(docid,ActNumber,ActSumma,ActType))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}

function ShowReqsFromActFn()
{
	window.showModalDialog("widetext.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property=CheckResult","","center:yes;status:no;dialogHeight:300px;dialogWidth:400px;resizable:yes;");
}

//сформировать служебную записку
function MakeActNote()
{
	var newItem = "";
	//var newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	//if(newItem==null)return;
	//var newItem=newItem.split("~")[0];
	var docids=escape(docums.ListViewGetItems('selected',1));
	var Comment = window.prompt("Введите комментарий к актам которые погасятся.","");
	
	var NoteId = #server(Docs.Action2.CreateActNote(docids,newItem,Comment))#
	if(isNaN(NoteId))
	{
		alert(NoteId);
	}
	else
	{
		alert("Акты погашены. Сформирована служебная записка.");
		okfunc();		
		//window.open('screen/actnote.csp?id='+NoteId+'&sessionid='+sessionid);
	}
}

//пришло бумажное подтверждение отчёта
function ProveOthet()
{
	if(!window.confirm("Указать, что бумажный отчёт проверен?"))return;
	var ok = #server(Docs.Otchet.SetParerProve(docums.ItemID))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc()}
}

//сервис менеджер отвечает на негативный отзыв контрагента
function SetBrakAnswer()
{
	var Answer = window.prompt("Укажите причину","");	
	if (Answer==null) return;
	var DocId = docums.ItemID;
	ok = #server(..SetBrakAnswer(DocId,Answer))#
	if (isNaN(ok)){alert(ok);}
	else{alert('Ответ на негативный отзыв сохранён');}
}
</script>
</head>
<body  onload="load()" >#(SaveChoice)#
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Документы</strong></TD>
<td width=10% align=right><a href="help/docs.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<td rowspan=99 valign=top>
<fieldset><legend><span onclick="alert('ID сессии #(%session.SessionId)#')">Типы</span> документов</legend>
 <SKLADList:listview width=200 height=300 id="doctypes" ClassName="Docs.Docs" onAddColumns="show()" zClick="okfunc()" zonDblClick="CreateDocument()"/><br>
</fieldset>
</td></tr>
<tr>
<td width=10>&nbsp;</td>
<td width=100% valign=top>
<fieldset><legend id="TypDocument"></legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
<option value="all">Все</option>
<option value="choose">Выбрать контрагента...</option>
</select> <input type="text" id="DocName" title="Начальные цифры номера" style="width:100px">
 <span id="ActAddFields" style="display:none;border:solid black 1">
 	Неоплаченные <input type="checkbox" style="border:none;width:15px" id="ShowUnpaid" title="Выводить только неоплаченные акты">
 </span>
<sklad:LittleButton name="ok" id="okbut" onclick="okfunc()" alt="Показать документы"><br>
<SKLADList:listview width=100% height=150 id="docums" onAddColumns="showdocums()" zClick="showitems()" zonDblClick="CreateDocument(docums.ItemID)" />
  <Table width=100%><tr><td width=100%>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('')" alt="Создать документ">
<sklad:LittleButton name="edit" id="editbut" onclick="CreateDocument(docums.ItemID)" alt="Редактировать документ">
<sklad:LittleButton name="ok" id="okbut2" onclick="processdoc()" alt="Обработать документ">
<sklad:LittleButton name="print" id="okbwut2" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
<sklad:LittleButton name="printword" id="PrntButWord" onclick="prnt(docums.ItemID,docums.ClassName,'word')" alt="Печать документа Word">
<!--
<sklad:LittleButton name="mail" id="EmailDocument" onclick="EmailDocumentFn(docums.ItemID,docums.ClassName)" alt="Отправить по почте">
-->

<!-- кнопки кнопки инструкции по отгрузке -->
<span style="display:none" id="StorageOutField">
	<sklad:LittleButton name="goinside" id="goinside" onclick="ShowLogOfCreation()" alt="Протокол сборки инструкции по отбору">
</span>

<!-- кнопки расходной накладной -->
<span style="display:none" id="okbwut3"> 
	<sklad:LittleButton name="change" id="ChangeTovInDoc" onclick="ChangeTovInDocFn()" alt="Заменить товар в расходной накладной">
	<sklad:LittleButton name="card" id="dkfi" onclick="makescet('Docs.Chet')" alt="Сформировать счет на оплату">
	<sklad:LittleButton name="card" id="okbwut4" onclick="makescet('factura')" alt="Сформировать счет-фактуру">
	<sklad:LittleButton name="card" id="hernya" onclick="maketovnakl('tovnakladn',docums.ItemID)" alt="Сформировать товарную накладную">
</span>

<!-- кнопки отчёта контрагента -->
<span style="display:none" id="OtchetSpecButton"> 
	<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Errors')" alt="Показать ошибки отчёта">
	<img src="images/red_stop.gif" alt="Отклонить отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetFailed()">
	<img src="images/green_butt.gif" alt="Принять отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetAccepted()">
	<sklad:LittleButton name="txtok" id="btnProveOthet" onclick="ProveOthet()" alt="Бумажный отчёт проверен">
<server>
#;Кнопка проверки серийных номеров для отчета о ремонте
k urlargs s urlargs("cls")="Docs.Otchet"
d ..wCheckSerialButton( "bCheckSerialOtchet"
    , ..Link("csp.CheckSerial3.cls",.urlargs,1)
    , $$$Text("Проверка серийных")
    , $$$Text("Перейти на страницу проверки серийных номеров")
)
</server>
  <sklad:LittleButton name="print" id="PrintTorg12" alt="Распечатать ТТН" onclick="PrintTorg12FromOtchet()">
</span>

<!-- кнопки инструкции руководителя -->
<span style="display:none" id="InstrSpecButton">
	<sklad:LittleButton name="txt" id="btnLookBrakComment" onclick="ShowOtchetErrorsFn('BrakComment')" alt="Показать негативный отзыв контрагента">
	<sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetBrakAnswer()" alt="Ответить на негативный отзыв">
	<sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowOtchetErrorsFn('BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
</span>

<!-- кнопки акта технического осмотра -->
<span style="display:none" id="ActSpecButton"> 
<script language="cache" runat="server">
 if  &html<
		<img src="images/txt.gif" onmouseover="btnShowReqsFromAct.src='images/Ontxt.gif'" onmouseout="btnShowReqsFromAct.src='images/txt.gif'"  id="btnShowReqsFromAct" name="btnShowReqsFromAct" alt="Показать заявки этого акта" onclick="ShowReqsFromActFn()">
		<img src="images/red_stop.gif" alt="Отклонить акт" width="20px" height="20px" style="cursor:hand" onclick="setActFailed()">
		<img src="images/green_butt.gif" alt="Принять акт" width="20px" height="20px" style="cursor:hand" onclick="setActAccepted()">
		<img src="images/print.gif" onmouseout="this.src='images/print.gif'" onmouseover="this.src='images/Onprint.gif'" alt="Сформировать служебную записку" width="20px" height="20px" style="cursor:hand" onclick="MakeActNote()">
	>
</script>
<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Comment')" alt="Показать комментарии к акту">
<server>
#; выводим кнопку проверки серийных для акта тех осмотра
k urlargs s urlargs("cls")="Docs.Act"
d ..wCheckSerialButton( "bCheckSerialAct"
    , ..Link("csp.CheckSerial3.cls",.urlargs,1)
    , $$$Text("Проверка серийных")
    , $$$Text("Перейти на страницу проверки серийных номеров")
)
</server>
</span>

</td><td>
<sklad:LittleButton name="del" id="dk2fi" onclick="deldoc()" alt="Удалить документ">
</td></tr></table>
<!--
<sklad:LittleButton name="ok" id="okbut3" onclick="printdoc()" alt="Распечатать документ">
-->
</fieldset>
<fieldset><legend>Строки документа <div id="CurrDocName"></div></legend>
<SKLADList:listview width=100% height=150 id="docitems" onAddColumns="showitems()"/><br>
</fieldset>
<!--
	<br><br><br>
	<SKLADiGrid:iGrid id="IGridDocstr" width="100%" height="300" Enabled="true" RowMode="true" /><br>
-->
</td></tr>
</table>
<br><br><br>
<div id="footer"><p align="right">
<a href="docs3.csp?SaveChoice=1" style="font-color:grey;font-size:12px">новая версия</a>
</p></div>
</body>
</html>
<script method="wCheckSerialButton" description="Выводит кнопку запуска проверки серийных"
    arguments="id:%String,url:%String,label:%String,title:%String" returntype="%String" 
    ProcedureBlock=1 language="Cache">
  
  &html<<button id='#(id)#' data-url='#(url)#' class='bCheckSerial btn' title='#(title)#' type='button'> #(label)# </button>>
  
  Q ""
</script>]]></CSP>


<CSP name="docs2.csp" application="/csp/sklad2/" default="1"><![CDATA[
 <script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 s ActRights = 1
 //i '+login s %response.ServerSideRedirect="norights.csp" 
 //i '##class(Common.Rights).getrights(login,3) s %response.ServerSideRedirect="norights.csp" 
 //s ActRights = ##class(Common.Rights).getrights(login,12)
 q 1
</script>
<script language="Cache" method="ShowDocItems" arguments="Class:%String,DocId:%String" returntype="%String">
 n str,i,fields
 s str=##class(Common.Common).showheaders(Class,,,1)
 for i=1:1:$L(str,"#@#")
 {
	s header=$P(str,"#@#",i) 
	s headerKey = $P(header,"~")
	s fields=$G(fields)_headerKey_","
 }
 s fields=$E(fields,1,$L(fields)-2)

 q str_$C(9)_##class(Common.Common).showdata(Class,fields,,"doc="_DocId,,1)
</script>
<script language="Cache" method="SaveLayout" arguments="TableName:%String,LayoutCol:%String,LayoutSort:%String">
 q:TableName=""
 s user=$G(%session.Data("user"),"undefined")
 s ^Layout("Layout",user,TableName,"LayoutCol")=LayoutCol
 s ^Layout("Layout",user,TableName,"LayoutSort")=LayoutSort
 q
</script>
<script language="Cache" method="GetLayout" arguments="TableName:%String" returntype="%String">
 
 if $ISOBJECT($G(%session)) s user=$G(%session.Data("user"),"undefined")
 else  s user="undefined"
 
 s ^mtempArt("TableName")=TableName
 s ^mtempArt("user")=user
 
 s LayoutCol =$G(^Layout("Layout",user,TableName,"LayoutCol"))
 s LayoutSort=$G(^Layout("Layout",user,TableName,"LayoutSort"))
 
 s ^mtempArt("layout")=LayoutCol_$C(9)_LayoutSort
 q LayoutCol_$C(9)_LayoutSort
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV8.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.datar{width:70;border:none;cursor:hand}
</style>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var d1,d2;
var ActRights = #(ActRights)#;
var ItemsClassName;	//название строк класса который кликнули в списке "Типы документов"
var LastLoadedHeadersClass;	//класс заголовки которого загружены в IGridDocstr
var IGridDocstrObj;

sessionid="#(%session.SessionId)#";
depot="#($G(%session.Data("depot")))#"
docssame="#($G(%session.Data("docssame")))#";
OurName="#($G(%session.Data("OurName")))#";
var login = '#($G(login))#';

function load()
{
	IGridDocstrObj = document.getElementById("IGridDocstr");
	doctypes.LoadHeaders();
}

function show()
{
	doctypes.DownLoad();
}

function okfunc()
{
	var AdditionalFieldsDocs="";
	StorageOutField.style.display="none";
	TypDocument.innerText=doctypes.ItemName;
	IGridDocstrObj.Clear(true);			//очистить таблицу строк
	var doctypesItemID=doctypes.ItemID	//название класса выбранного в списке типов документов
	ItemsClassName = doctypesItemID+"Items";
	docums.ClassName=doctypesItemID;
	//if(doctypesItemID=="Docs.Platejka")return
	if(doctypesItemID=="Docs.PrihKassOrder")return
	//docitems.ClassName=doctypesItemID+"Items";
	var ExcludeFields="Goods,Doc,DocType,RequestItem";
	var AdditionalFields="";
	if(doctypesItemID!="Docs.Platejka")var AdditionalFields="Goods->FullName~Наименование~~~@%String~~~~~#@#";
	
	//if(docitems.ClassName=="Docs.RashItems")
	//{
	//	var ExcludeFields=ExcludeFields+",ZakazGoods";
	//	var AdditionalFields=AdditionalFields+"ZakazGoods->FullName~Заказанный товар~~~@%String~~~~~#@#";
	//}
	
	if(doctypes.ItemID=="Docs.Rash"){okbwut3.style.display="inline";}
	else{okbwut3.style.display="none";}
	
	if(doctypesItemID=="Docs.Otchet")
	{
		OtchetSpecButton.style.display="inline";
	}
	else{OtchetSpecButton.style.display="none";}
	if(ActRights==1)
	{
		if(doctypesItemID=="Docs.Act")
		{
			ActSpecButton.style.display="inline";
			ActAddFields.style.display="inline";
		}
		else
		{
			ActSpecButton.style.display="none";
			ActAddFields.style.display="none";
		}
	}
	if(doctypes.ItemID=="Docs.StorageOut"){StorageOutField.style.display="inline";}
	
	d1 = new Date();
	docums.LoadHeaders("ActType","",AdditionalFieldsDocs);
	//docitems.LoadHeaders(ExcludeFields,"",AdditionalFields);

}

//показать документы
function showdocums()
{
	var order="";
	//if(doctypes.ItemID=="Docs.Otchet"){var order="NameSorted"}
	dateArr=dat1.value.split("/")
	Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	dateArr=dat2.value.split("/")
	Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
	if(docssame==0){var requst=request+" and Depot="+depot;} //если  показ всех документов для всех складов то
	var currentKontragent=ChooseKontragent.value;
	if(currentKontragent!="all"){var request=request+" and Kontr="+currentKontragent}
	if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
	var ShowUnpaidObject = document.getElementById("ShowUnpaid");
	if(typeof(ShowUnpaid)=="object")
	{
		if(ShowUnpaidObject.checked)var request=request+" and Paid=0"
	}
	
	
	docums.DownLoad(request,"","",order)
	//d2 = new Date();
	//alert("вывод документов\n" + (d2-d1) + "\n" + d1.toLocaleTimeString() + "\n" + d2.toLocaleTimeString());
}

//показать заголовки iGrid. headers формируется в ##class(Common.Common).showheaders
function ShowIgridHeaders(headers)
{
	if(LastLoadedHeadersClass == ItemsClassName) return;

	IGridDocstrObj.Clear(true);
	headersArray = headers.split("#@#");
	var headersArraylength = headersArray.length;
	
	var Captions = new Array(headersArraylength-1);
	var Keys = new Array(headersArraylength-1);
	var Tags = new Array(headersArraylength-1);
	var Widths = new Array(headersArraylength-1);
	//alert(headers )
	
	for (var i = 0; i< headersArray.length-1; i++)
	{
		//здесь каждый отдельный заголовок
		var h = headersArray[i];
		var headerArray = h.split("~");
		Captions[i] = headerArray[1];
		Keys[i] = headerArray[0];
		Tags[i] = "";
		Widths[i] = 80;
		//alert("headerArray[1]" + headerArray[1]);
	}
	
	//alert(Captions);
	LastLoadedHeadersClass = ItemsClassName;
	IGridDocstrObj.DrawHeaders(Captions,Keys,Tags);
	//GetDocstrLayout("IGridDocstr||" + ItemsClassName);	//восстановить размер и положение колонок
}

//загрузить данные в iGrid
function LoadIgridData(DocId)
{
	var AllData = #server(..ShowDocItems(ItemsClassName,DocId))#
	var headers=AllData.split("\t")[0];
	ShowIgridHeaders(headers);

	IGridDocstrObj.Clear(false);
	IGridDocstrObj.LoadStringData(AllData.split("\t")[1]);
}

function CreateDocument(ItemID)
{
	CurrentDocementClass=docums.ClassName
	if(CurrentDocementClass==""){alert("Не выбран тип документа");return}
	ItemID=ReturnSpace(ItemID)
	var doccsp="document.csp";
	//if (CurrentDocementClass=="Docs.DocBrak"){alert("Документы на приём брака создаются и редактируются на рабочем месте сервис менеджера. Инструкциями с типом \"Приём брака\"");return}
	if(CurrentDocementClass=="Docs.Rash"){var doccsp="DocsRash.csp?source="+ItemID;}
	if(CurrentDocementClass=="Docs.Utiliz")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="UtilizationDoc.csp?DocId="+ItemID}
		else{doccsp="docutiliz.csp"}
	}
	if(CurrentDocementClass=="Docs.PrihKassOrder")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Invent")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="InventarizationIgrid.csp?source="+ItemID}
		else{doccsp="docinvent.csp"}
	}
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	if(CurrentDocementClass=="Docs.InnerDiff")doccsp="docinnerdiff.csp"
	if(CurrentDocementClass=="Docs.Remont"){alert("Заявка на запчасти создается инструкцией руководителя\nили в карточке контрагента");return;}
	if(CurrentDocementClass=="Docs.Otchet")
	{
		if(ItemID==""){doccsp="Otchet.csp?docid="+ItemID;}
		else{alert("Отчёты редактировать запрещено.");return;}
	}
	if(CurrentDocementClass=="Docs.Act")
	{
		doccsp="ActFromClient.CSP?docid="+ItemID;
		//alert("Акты технического состояния создаются только в менеджере отчётов");return;
	}
	if((CurrentDocementClass=="Docs.StorageIn")||(CurrentDocementClass=="Docs.StorageOut")){alert("Внутренняя инструкция создается на рабочем месте кладовщика");return;}
	if(CurrentDocementClass=="Operation.Instructions"){doccsp="createinstructIgrid.csp?source="+ItemID}
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	if(WinResult==1)showdocums();
	}
	
//показать строки документа
function showitems()
{
	//var dd1 = new Date();
	var currentdoc=ReturnSpace(docums.ItemID);
	if(currentdoc=="")return
	//docitems.DownLoad("Doc="+currentdoc,1)
	//var dd2 = new Date();
	LoadIgridData(currentdoc);
	//alert("вывод строк\n" + (dd2-dd1) + "\n" + dd1.toTimeString() + "\n" + dd2.toTimeString());	
}


function processdoc()
{
	if(docums.ItemID=="")return
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var ok=#server(Docs.Action.processdoc(doc))#
	//alert("код результата обработки документа: " + ok);
	if(isNaN(ok))
		{
			alert(ok)
			if(doctypes.ItemID=="Docs.Otchet")
			{
				ShowOtchetErrorsFn();
			}
		}
	else{
			showdocums();
		}
}

function printdoc()
{
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var doccsp="document.csp";
	if(CurrentDocementClass=="Docs.Utiliz")doccsp="docutiliz.csp"
	if(CurrentDocementClass=="Docs.Invent")doccsp="docinvent.csp"
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"cener:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	//window.open("print.csp?doc="+doc);
}

//распечатать документ
function prnt(docid,docclass,param){
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;
if(param=="word")
{
	url=url+"&word=on"
}
if ((docclass=="Docs.Otchet")&&(param=="word"))
{
	if(window.confirm("Печатать все поля документа?")){url=url+"&AllColumns=1"}
	//window.prompt(url,url);
}
window.open(url);
}

function makescet(cl){
var doc=docums.ItemID;
if(doc==""){alert("Не выбран документ - основание для формирования платежного поручения");return}
WinResult=window.showModalDialog("makescet.csp?docid="+doc+"&class="+cl,"","cener:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")
}
function maketovnakl(tovnakladn){
var doctov=docums.ItemID;
if(doctov==""){alert("Не выбран документ - основание для формирования товарной накладной");return}
WinResult=window.showModalDialog("maketovnakl.csp?docid="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:300px;dialogWidth:450px;resizable:yes;")
}

function deldoc(){
if(!window.confirm("Удалить документ " + docums.ItemName + " ?"))return false;
var classname=docums.ClassName;
var itemid=docums.ItemID;
var ok1=#server(Docs.Action.deletedoc(classname,itemid))#
if(isNaN(ok1)){alert(ok1)}
else{okfunc();}
}

// Выбрать контрагента
function ChooseKontragentFunc(){
	var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
	if(UsersSelection=="choose")
	{
		var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
		if(newKontragent==null){
			ChooseKontragent.selectedIndex=0;
			return false;}
		var ChooseKontragentLength = ChooseKontragent.options.length;
		ChooseKontragent.options.length= ChooseKontragentLength + 1;
		ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
		ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
		ChooseKontragent.selectedIndex=ChooseKontragentLength;
	}
}

function EmailDocumentFn(ItemID,ItemClass){
	var MailSetup=window.showModalDialog("MailSetup.csp","","center:yes;status:no;dialogHeight:200px;dialogWidth:500px;resizable:yes;");
	//вернётся следующая строка
	//Формировать DOC файл (false/true);Открывать Email программу (false/true);принудительный адрес отправки;Файл-шаблон
	//например: "true;true;"
	//или: "false;true;artemu78@rambler.ru;first-template"
	if(MailSetup==null)return
	var values=MailSetup.split(";");
	
	if(ReturnBoolean(values[0])){
		//создать файл
		var WaitWindow=window.open("wait.csp","win2", "status=no,width=200,height=200");
		ok=#server(Kontragent.Action.MakeFile(ItemID,ItemClass,values[3]))#
		WaitWindow.close();
		if(isNaN(ok)){alert(ok);return}
		else{alert("Файл успешно создан")}
	}
	if(ReturnBoolean(values[1])){
		//открыть почтовую программу
		if(values[2]!="")
			{
			var MailAddress=values[2];		//
			}
		else
			{
			var MailValues=#server(Docs.Action.EmailFromDoc(ItemID,ItemClass))#			
			var MailValuesArray=MailValues.split(StringSplitter);
			var MailAddress=MailValuesArray[0];
			var KontrName=MailValuesArray[1];
			var DocTypeName=MailValuesArray[2];
			var DocName=MailValuesArray[3];
			if(MailValues==""){alert("Не удалось определить E-mail у контрагента записанного в документе.\nУкажите пожалуйста адрес вручную или заполните соответствующее поле контрагента.");return}
			
			}
	window.open("mailto:"+KontrName+" <"+MailAddress+">?subject="+OurName+"&body=Здравствуйте "+KontrName+"\n\n\n---------\n"+OurName)
	}
}

//заменить товар в документе
function ChangeTovInDocFn()
{
	var itemid=docums.ItemID;
	var answer=window.showModalDialog("ChangeGoods.csp?DocId="+itemid+"&sessionid="+sessionid,"","center:yes;status:no;dialogHeight:550px;dialogWidth:800px;resizable:yes;");
	if(answer)LoadIgridData(itemid)
}

//показать лог создания инструкции по отбору
function ShowLogOfCreation()
{
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбрана инструкция по отгрузке.");return;}
	window.open("LogOfCreation.csp?doc="+docums.ItemID);
}

//показать ошибки отчёта
function ShowOtchetErrorsFn()
{
	window.showModalDialog("Info.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property=Errors","","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}


function setOtchetFailed()
{
	if(!window.confirm("Отклонить отчёт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
	var Descr = window.prompt("Укажите причину","");
	if(Descr==null)return;
	var ok= #server(Docs.Otchet.SetOthcetStatFailed2(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setOtchetAccepted(){
if(!window.confirm("Поставить отчёту статус \"Принят\"?"))return;
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
var ok= #server(Docs.Otchet.SetOthcetStatAccepted(docid))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}


function setActFailed()
{
	if(!window.confirm("Отклонить акт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
	var Descr = window.prompt("Укажите причину","");
	var ok= #server(Docs.Act.SetActStatFailed(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setActAccepted(){
var docid=docums.ItemID;
var ActNumber = #server(Docs.Action.getRashNumb("Docs.Act"))#;
var ActSumma = #server(Docs.Act.GetActSumma(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать сумму акта.\n"+ActSumma);return;}
var ActType = #server(Docs.Act.GetActType(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать тип акта.\n"+ActType);return;}
var answer = window.confirm("Поставить акту статус \"Принят\"?\n"+
	"Будущий номер акта "+ActNumber + "\n" + 
	"Сумма акта " + ActSumma);
if(!answer)return;
if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
var ok= #server(Docs.Act.SetActStatAccepted(docid,ActNumber,ActSumma,ActType))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}

function ShowReqsFromActFn()
{
	window.showModalDialog("widetext.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property=CheckResult","","center:yes;status:no;dialogHeight:300px;dialogWidth:400px;resizable:yes;");
}

//сформировать служебную записку
function MakeActNote()
{
	var newItem = "";
	//var newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	//if(newItem==null)return;
	//var newItem=newItem.split("~")[0];
	var docids=escape(docums.ListViewGetItems('selected',1));
	
	var NoteId = #server(Docs.Action2.CreateActNote(docids,newItem))#
	if(isNaN(NoteId))
	{
		alert(NoteId);
	}
	else
	{
		alert("Акты погашены. Сформирована служебная записка.");
		//window.open('screen/actnote.csp?id='+NoteId+'&sessionid='+sessionid);
	}
}

//пришло бумажное подтверждение отчёта
function ProveOthet()
{
	if(!window.confirm("Указать, что к отчёту пришло бумажное подтверждение?"))return;
	var ok = #server(Docs.Otchet.SetParerProve(docums.ItemID))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc()}
}

//сохранить положение и размер колонок iGrid
function SaveDocstrLayout(Obj)
{
	var TableName="IGridDocstr||"+ItemsClassName;
	#call(..SaveLayout(TableName,Obj.LayoutCol,Obj.LayoutSort))#
}

//сохранить положение и размер колонок iGrid
function GetDocstrLayout()
{
	var TableName="IGridDocstr||"+ItemsClassName;
	var data = #server(..GetLayout(TableName))#;
	alert(data);
	Obj.LayoutCol = data.split("\t")[0];
	//Obj.LayoutSort =data.split("\t")[1]; 
}
</script>
</head>
<body  onload="load()" >
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Документы</strong></TD>
<td width=10% align=right><a href="help/docs.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<td rowspan=99 valign=top>
<fieldset><legend>Типы документов</legend>
 <SKLADList:listview width=200 height=300 id="doctypes" ClassName="Docs.Docs" onAddColumns="show()" zClick="okfunc()" zonDblClick="CreateDocument()"/><br>
</fieldset>
</td></tr>
<tr>
<td width=10>&nbsp;</td>
<td width=100% valign=top>
<fieldset><legend id="TypDocument"></legend>
Период c <input type=text id="dat1" value="#($ZD($H-2,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
<option value="all">Все</option>
<option value="choose">Выбрать контрагента...</option>
</select> <input type="text" id="DocName" title="Начальные цифры номера" style="width:30px">
 <span id="ActAddFields" style="display:none;border:solid black 1">
 	Неоплаченные <input type="checkbox" style="border:none;width:15px" id="ShowUnpaid" title="Выводить только неоплаченные акты">
 </span>
<sklad:LittleButton name="ok" id="okbut" onclick="okfunc()" alt="Показать документы"><br>
<SKLADList:listview width=100% height=150 id="docums" onAddColumns="showdocums()" zClick="showitems()" zonDblClick="CreateDocument(docums.ItemID)" />
  <Table width=100%><tr><td width=100%>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('')" alt="Создать документ">
<sklad:LittleButton name="edit" id="editbut" onclick="CreateDocument(docums.ItemID)" alt="Редактировать документ">
<sklad:LittleButton name="ok" id="okbut2" onclick="processdoc()" alt="Обработать документ">
<sklad:LittleButton name="print" id="okbwut2" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
<sklad:LittleButton name="printword" id="PrntButWord" onclick="prnt(docums.ItemID,docums.ClassName,'word')" alt="Печать документа Word">
<sklad:LittleButton name="mail" id="EmailDocument" onclick="EmailDocumentFn(docums.ItemID,docums.ClassName)" alt="Отправить по почте">
<span style="display:none" id="StorageOutField">
	<sklad:LittleButton name="goinside" id="goinside" onclick="ShowLogOfCreation()" alt="Протокол сборки инструкции по отбору">
</span>
<span style="display:none" id="okbwut3"> 
<sklad:LittleButton name="change" id="ChangeTovInDoc" onclick="ChangeTovInDocFn()" alt="Заменить товар в расходной накладной">
<sklad:LittleButton name="card" id="dkfi" onclick="makescet('Docs.Chet')" alt="Сформировать счет на оплату">
<sklad:LittleButton name="card" id="okbwut4" onclick="makescet('factura')" alt="Сформировать счет-фактуру">
<sklad:LittleButton name="card" id="hernya" onclick="maketovnakl('tovnakladn')" alt="Сформировать товарную накладную">
</span>

<span style="display:none" id="OtchetSpecButton"> 
<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn()" alt="Показать ошибки отчёта">
<img src="images/red_stop.gif" alt="Отклонить отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetFailed()">
<img src="images/green_butt.gif" alt="Принять отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetAccepted()">
<sklad:LittleButton name="txtok" id="btnProveOthet" onclick="ProveOthet()" alt="Пришло бумажное подтверждение отчёта">
</span>

<script language="cache" runat="server">
 if  &html<
	<span style="display:none" id="ActSpecButton"> 
		<img src="images/txt.gif" onmouseover="btnShowReqsFromAct.src='images/Ontxt.gif'" onmouseout="btnShowReqsFromAct.src='images/txt.gif'"  id="btnShowReqsFromAct" name="btnShowReqsFromAct" alt="Показать заявки этого акта" onclick="ShowReqsFromActFn()">
		<img src="images/red_stop.gif" alt="Отклонить акт" width="20px" height="20px" style="cursor:hand" onclick="setActFailed()">
		<img src="images/green_butt.gif" alt="Принять акт" width="20px" height="20px" style="cursor:hand" onclick="setActAccepted()">
		<img src="images/print.gif" onmouseout="this.src='images/print.gif'" onmouseover="this.src='images/Onprint.gif'" alt="Сформировать служебную записку" width="20px" height="20px" style="cursor:hand" onclick="MakeActNote()">
	</span>
	>
</script>
</td><td>
<sklad:LittleButton name="del" id="dk2fi" onclick="deldoc()" alt="Удалить документ">
</td></tr></table>
<!--
<sklad:LittleButton name="ok" id="okbut3" onclick="printdoc()" alt="Распечатать документ">
-->
</fieldset>
<fieldset><legend>Строки документа</legend>
<sklad:LittleButton name="mail" id="btnSaveDocstrLayout" onclick="SaveDocstrLayout(IGridDocstrObj)" alt="Удалить документ">
<input type="button" value="get" onclick="GetDocstrLayout()">
<SKLADiGrid:iGrid id="IGridDocstr" width="100%" height="300" Enabled="true" RowMode="true" />
<!--
	<SKLADList:listview width=100% height=150 id="docitems" onAddColumns="showitems()"/><br>
-->
</fieldset>


</td></tr>
</table>
</body>
</html>]]></CSP>


<CSP name="docs3.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList >
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
#footer { position: absolute;   bottom: 0; width: 100%; }
.datar{width:70;border:none;cursor:hand; }

/*маленькая функциональная кнопка на панели управления под гридом */ 
.btn { 
    overflow: visible; /*ie btn padding*/ 
} 

</style>
<link href="js/css/cupertino/jquery-ui-1.10.3.custom.css" rel="stylesheet">
<link href="js/css/ui.jqgrid.css" rel="stylesheet">

</head>
<body  onload="load()" >
<table cellSpacing=0 width="100%" celpadding="0" >
<tr>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Документы</strong></TD>
<td width=10% align=right><a href="help/docs.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</table>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<td rowspan=99 valign=top>
 <table id="DocTypesTable"></table>
</td></tr>
<tr>
<td width=10>&nbsp;</td>
<td width=100% valign=top>
<fieldset><legend id="TypDocument"></legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
<option value="all">Все</option>
<option value="choose">Выбрать контрагента...</option>
</select> <input type="text" id="DocName" title="Начальные цифры номера" style="width:100px">
 <span id="ActAddFields" style="display:none;border:solid black 1">
    Неоплаченные <input type="checkbox" style="border:none;width:15px" id="ShowUnpaid" title="Выводить только неоплаченные акты">
 </span>
<sklad:LittleButton name="ok" id="okbut" onclick="okfunc()" alt="Показать документы"><br>
<SKLADList:listview width=100% height=150 id="docums" onAddColumns="showdocums()" zClick="showitems()" zonDblClick="CreateDocument(docums.ItemID)" />
  <Table width=100%><tr><td width=100%>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('')" alt="Создать документ">
<sklad:LittleButton name="edit" id="editbut" onclick="CreateDocument(docums.ItemID)" alt="Редактировать документ">
<sklad:LittleButton name="ok" id="okbut2" onclick="processdoc()" alt="Обработать документ">
<sklad:LittleButton name="print" id="okbwut2" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
<sklad:LittleButton name="printword" id="PrntButWord" onclick="prnt(docums.ItemID,docums.ClassName,'word')" alt="Печать документа Word">
<!--
<sklad:LittleButton name="mail" id="EmailDocument" onclick="EmailDocumentFn(docums.ItemID,docums.ClassName)" alt="Отправить по почте">
-->

<!-- кнопки кнопки инструкции по отгрузке -->
<span style="display:none" id="StorageOutField">
    <sklad:LittleButton name="goinside" id="goinside" onclick="ShowLogOfCreation()" alt="Протокол сборки инструкции по отбору">
</span>

<!-- кнопки расходной накладной -->
<span style="display:none" id="okbwut3"> 
    <sklad:LittleButton name="change" id="ChangeTovInDoc" onclick="ChangeTovInDocFn()" alt="Заменить товар в расходной накладной">
    <sklad:LittleButton name="card" id="dkfi" onclick="makescet('Docs.Chet')" alt="Сформировать счет на оплату">
    <sklad:LittleButton name="card" id="okbwut4" onclick="makescet('factura')" alt="Сформировать счет-фактуру">
    <sklad:LittleButton name="card" id="hernya" onclick="maketovnakl('tovnakladn')" alt="Сформировать товарную накладную">
</span>

<!-- кнопки отчёта контрагента -->
<span style="display:none" id="OtchetSpecButton"> 
    <sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Errors')" alt="Показать ошибки отчёта">
    <img src="images/red_stop.gif" alt="Отклонить отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetFailed()">
    <img src="images/green_butt.gif" alt="Принять отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetAccepted()">
    <sklad:LittleButton name="txtok" id="btnProveOthet" onclick="ProveOthet()" alt="Бумажный отчёт проверен">
<server>
#;Кнопка ПРОВЕРКИ серийных номеров для отчета о ремонте
k urlargs s urlargs("cls")="Docs.Otchet"
d ..wCheckSerialButton( "bCheckSerialOtchet"
    , ..Link("csp.CheckSerial3.cls",.urlargs,1)
    , $$$Text("Проверка серийных")
    , $$$Text("Перейти на страницу проверки серийных номеров")
)
</server>
 
</span>

<!-- кнопки инструкции руководителя -->
<span style="display:none" id="InstrSpecButton">
    <sklad:LittleButton name="txt" id="btnLookBrakComment" onclick="ShowOtchetErrorsFn('BrakComment')" alt="Показать негативный отзыв контрагента">
    <sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetBrakAnswer()" alt="Ответить на негативный отзыв">
    <sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowOtchetErrorsFn('BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
</span>

<!-- кнопки АКТ ТЕХОСМОТРА -->
<span style="display:none" id="ActSpecButton"> 
    <img src="images/txt.gif" onmouseover="btnShowReqsFromAct.src='images/Ontxt.gif'" onmouseout="btnShowReqsFromAct.src='images/txt.gif'"  id="btnShowReqsFromAct" name="btnShowReqsFromAct" alt="Показать заявки этого акта" onclick="ShowReqsFromActFn()">
    <img src="images/red_stop.gif" alt="Отклонить акт" width="20px" height="20px" style="cursor:hand" onclick="setActFailed()">
    <img src="images/green_butt.gif" alt="Принять акт" width="20px" height="20px" style="cursor:hand" onclick="setActAccepted()">
    <img src="images/print.gif" onmouseout="this.src='images/print.gif'" onmouseover="this.src='images/Onprint.gif'" alt="Сформировать служебную записку" width="20px" height="20px" style="cursor:hand" onclick="MakeActNote()">
    <sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Comment')" alt="Показать комментарии к акту" />
<server>
#; выводим кнопку проверки серийных для акта тех осмотра
k urlargs s urlargs("cls")="Docs.Act"
d ..wCheckSerialButton( "bCheckSerialAct"
    , ..Link("csp.CheckSerial3.cls",.urlargs,1)
    , $$$Text("Проверка серийного")
    , $$$Text("Проверить серийный номер")
)

#; Кнопка ПРОСМОТРА серийного номера

s urlargs("sessionid")=%session.SessionId ;дополнительно нуждается в ид сессии
/*
&html<<button id='bOpenSerialAct' class='btn bOpenSerial' title='#($$$Text("Просмотр серийного номера"))#'
    data-url='#(..Link("garant.csp",.urlargs,1))#'
>#($$$Text("Открыть серийный"))#</button>>
*/
</server>

</span>
</td>
<td>
<sklad:LittleButton name="del" id="dk2fi" onclick="deldoc()" alt="Удалить документ">
</td></tr></table>

</fieldset>
<fieldset><legend>Строки документа <div id="CurrDocName"></div></legend>
<SKLADList:listview width=100% height=150 id="docitems" onAddColumns="showitems()"/><br>
</fieldset>

</td></tr>
</table>
<br/><br/><br/>
<div id="footer"><p align="right">
<a href="docs.csp?SaveChoice=1" style="font-color:grey;font-size:12px">старая версия</a>
</p></div>


<script src="common.js" type='text/javascript'></script>
<script src="js/js/jquery-1.9.1.js" type='text/javascript'></script>
<script src="js/js/jquery-ui-1.10.3.custom.js" type='text/javascript'></script>
<script src="js/js/grid.locale-ru.js"  type='text/javascript'></script>
<script src="js/js/jquery.jqGrid.min.js"  type='text/javascript'></script>
<!-- Добавляет функционал проверки серийных номеров для отчета о ремонте -->
<script src="js/pages/docs3.js"  type='text/javascript'></script>
<script language="JScript" type="text/javascript">
var d1,d2;
var ActRights = "#($G(ActRights))#";
var ItemsClassName;
var doctypesItemID = "";    //класс, текущего типа документов (например Docs.Rash)
var doctypesItemName = "";  //название текущего типа документов (например Расходная накладная)


sessionid="#(%session.SessionId)#";
depot="#($G(%session.Data("depot")))#"
docssame="#($G(%session.Data("docssame")))#";

var login = '#($G(login))#';

function load(){
    
    docums.login=login;
    docitems.login=login;

    $("#DocTypesTable").jqGrid({
        url:'JQGridData.csp?cl=Docs.Docs',
        datatype: "json",
        colNames:['Документы'],
        colModel:[{name:'Name'}],
        sortname: 'id', sortorder: "asc",
        height: 450, width:250,
        onSelectRow: function( RowId ){ 
            
            doctypesItemID = RowId; 
            var RowData = $(this).getRowData(RowId);
            doctypesItemName = RowData.Name;
            okfunc(); 
            
        }
    });

    $("#DocTypesTable").jqGrid('gridResize',{minWidth:30,maxWidth:800,minHeight:80, maxHeight:750});
    
}

/// выбран тип документа в списке типов
function okfunc() {
    
    var AdditionalFieldsDocs="";
    StorageOutField.style.display="none";
    TypDocument.innerText=doctypesItemName;
    docums.ClassName=doctypesItemID;
    if(doctypesItemID=="Docs.PrihKassOrder")return
    docitems.ClassName=doctypesItemID+"Items";
    var ExcludeFields="Goods,Doc,DocType,RequestItem";
    var AdditionalFields="";
    if(doctypesItemID!="Docs.Platejka")var AdditionalFields="Goods->FullName~Наименование~~~@%String~~~~~#@#";
    
    if(docitems.ClassName=="Docs.RashItems") {
        var ExcludeFields=ExcludeFields+",ZakazGoods";
        var AdditionalFields=AdditionalFields+"ZakazGoods->FullName~Заказанный товар~~~@%String~~~~~#@#";
    }
    
    if(doctypesItemID=="Docs.Rash"){okbwut3.style.display="inline";}
    else{okbwut3.style.display="none";}
    
    if(doctypesItemID=="Docs.Otchet") { //отчет о ремонте
        OtchetSpecButton.style.display="inline";
    } else {
        OtchetSpecButton.style.display="none";
    }

    if(doctypesItemID=="Operation.Instructions") {
        InstrSpecButton.style.display="inline";
    } else {
        InstrSpecButton.style.display="none";
    } 
    
    if ( ActRights==1 ) {
        
        if ( doctypesItemID=="Docs.Act" ) { //акт технического осмотра
            
            ActSpecButton.style.display="inline";
            ActAddFields.style.display="inline";
            
        } else {
            ActSpecButton.style.display="none";
            ActAddFields.style.display="none";
        }
        
    }
    
    if(doctypesItemID=="Docs.StorageOut"){StorageOutField.style.display="inline";}
    
    d1 = new Date();
    docums.LoadHeaders("ActType","",AdditionalFieldsDocs);
    docitems.LoadHeaders(ExcludeFields,"",AdditionalFields);

}

//показать документы
function showdocums()
{
    var order="";
    var DocClass = doctypesItemID;
    //if(doctypes.ItemID=="Docs.Otchet"){var order="NameSorted"}
    dateArr=dat1.value.split("/")
    Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    dateArr=dat2.value.split("/")
    Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
    if(docssame==0){var requst=request+" and Depot="+depot;} //если  показ всех документов для всех складов то
    var currentKontragent=ChooseKontragent.value;
    if(currentKontragent!="all" && DocClass!="Docs.Sluzap"){var request=request+" and Kontr="+currentKontragent}
    if(currentKontragent!="all" && DocClass=="Docs.Sluzap"){var request=request+" and Docs.Sluzap_IsKontrInDoc(ID  ,'"+currentKontragent+"')=1"}
    if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
    var ShowUnpaidObject = document.getElementById("ShowUnpaid");
    if(typeof(ShowUnpaid)=="object")
    {
        if(ShowUnpaidObject.checked)var request=request+" and Paid=0"
    }
    
    
    docums.DownLoad(request,"","",order)
    d2 = new Date();
    //alert("вывод документов\n" + (d2-d1) + "\n" + d1.toLocaleTimeString() + "\n" + d2.toLocaleTimeString());
}

function CreateDocument(ItemID)
{
    CurrentDocementClass=docums.ClassName
    if(CurrentDocementClass==""){alert("Не выбран тип документа");return}
    ItemID=ReturnSpace(ItemID)
    var doccsp="document.csp";
    //if (CurrentDocementClass=="Docs.DocBrak"){alert("Документы на приём брака создаются и редактируются на рабочем месте сервис менеджера. Инструкциями с типом \"Приём брака\"");return}
    if(CurrentDocementClass=="Docs.Rash"){var doccsp="DocsRash.csp?source="+ItemID;}
    if(CurrentDocementClass=="Docs.Utiliz")
    {
        if(window.confirm("Открывать в новой форме?")){var doccsp="UtilizationDoc.csp?DocId="+ItemID}
        else{doccsp="docutiliz.csp"}
    }
    if(CurrentDocementClass=="Docs.PrihKassOrder")doccsp="docplatej.csp?DocId="+ItemID;
    if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ItemID;
    if(CurrentDocementClass=="Docs.Invent")
    {
        if(window.confirm("Открывать в новой форме?")){var doccsp="InventarizationIgrid.csp?source="+ItemID}
        else{doccsp="docinvent.csp"}
    }
    if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
    if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
    if(CurrentDocementClass=="Docs.InnerDiff")doccsp="docinnerdiff.csp"
    if(CurrentDocementClass=="Docs.Remont"){alert("Заявка на запчасти создается инструкцией руководителя\nили в карточке контрагента");return;}
    if(CurrentDocementClass=="Docs.Otchet")
    {
        if(ItemID==""){doccsp="Otchet.csp?docid="+ItemID;}
        else{alert("Отчёты редактировать запрещено.");return;}
    }
    if(CurrentDocementClass=="Docs.Act")
    {
        doccsp="ActFromClient.CSP?docid="+ItemID;
        //alert("Акты технического состояния создаются только в менеджере отчётов");return;
    }
    if((CurrentDocementClass=="Docs.StorageIn")||(CurrentDocementClass=="Docs.StorageOut")){alert("Внутренняя инструкция создается на рабочем месте кладовщика");return;}
    if(CurrentDocementClass=="Operation.Instructions"){doccsp="createinstructIgrid.csp?source="+ItemID}
    if(CurrentDocementClass=="Docs.Sluzap"){doccsp="screen/sluzap.csp?docid="+ItemID}
    WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypesItemName,"center:yes;status:no;dialogHeight:660px;dialogWidth:800px;resizable:yes;")
    if(WinResult==1)showdocums();
}
    
//показать строки документа
function showitems()
{
    var dd1 = new Date();
    var currentdoc=ReturnSpace(docums.ItemID);
    if(currentdoc=="")return
    docitems.DownLoad("Doc="+currentdoc,1)
    var dd2 = new Date();
    $("#CurrDocName").text(docums.ItemName);
    //alert("вывод строк\n" + (dd2-dd1) + "\n" + dd1.toTimeString() + "\n" + dd2.toTimeString());   
}

function processdoc()
{
    if(docums.ItemID=="")return
    var doc=docums.ItemID+"@"+doctypesItemID;
    var ok=#server(Docs.Action.processdoc(doc))#
    //alert("код результата обработки документа: " + ok);
    if(isNaN(ok))
        {
            alert(ok)
            if(doctypesItemID=="Docs.Otchet")
            {
                ShowOtchetErrorsFn('Errors');
            }
        }
    else{
            showdocums();
        }
}

function printdoc()
{
    var doc=docums.ItemID+"@"+doctypesItemID;
    var doccsp="document.csp";
    if(CurrentDocementClass=="Docs.Utiliz")doccsp="docutiliz.csp"
    if(CurrentDocementClass=="Docs.Invent")doccsp="docinvent.csp"
    if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
    if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
    
    WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypesItemName,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
    //window.open("print.csp?doc="+doc);
}

//распечатать документ
function prnt(docid,docclass,param){
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;
if(param=="word")
{
    url=url+"&word=on"
}
if ((docclass=="Docs.Otchet")&&(param=="word"))
{
    if(window.confirm("Печатать все поля документа?")){url=url+"&AllColumns=1"}
    //window.prompt(url,url);
}

if (docclass=="Docs.Sluzap")
{
    url = "screen/sluzap.csp?docid="+docid;
}

window.open(url);
}

function makescet(cl){
    var doc=docums.ItemID;
    if(doc==""){alert("Не выбран документ - основание для формирования платежного поручения");return; }
    WinResult=window.showModalDialog("makescet.csp?docid="+doc+"&class="+cl,"","center:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")
}

function maketovnakl(tovnakladn){
    var doctov=docums.ItemID;
    if(doctov==""){alert("Не выбран документ - основание для формирования товарной накладной");return}
    
    var url = "csp.makeTovNaklV2.cls" //"maketovnakl.csp"
    WinResult=window.showModalDialog(url+"?docid="+doctov+"&class="+tovnakladn,""
        ,"dialogWidth:640px;dialogHeight:480px;center:yes;status:no;resizable:yes;")
    
}

function deldoc(){
if(!window.confirm("Удалить документ " + docums.ItemName + " ?"))return false;
var classname=docums.ClassName;
var itemid=docums.ItemID;
var ok1=#server(Docs.Action.deletedoc(classname,itemid))#
if(isNaN(ok1)){alert(ok1)}
else{okfunc();}
}

// Выбрать контрагента
function ChooseKontragentFunc(){
    var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
    if(UsersSelection=="choose")
    {
        var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
        if(newKontragent==null){
            ChooseKontragent.selectedIndex=0;
            return false;}
        var ChooseKontragentLength = ChooseKontragent.options.length;
        ChooseKontragent.options.length= ChooseKontragentLength + 1;
        ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
        ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
        ChooseKontragent.selectedIndex=ChooseKontragentLength;
    }
}

function EmailDocumentFn(ItemID,ItemClass){
    alert("Функция отключена");
    return;
    var MailSetup=window.showModalDialog("MailSetup.csp","","center:yes;status:no;dialogHeight:200px;dialogWidth:500px;resizable:yes;");
    //вернётся следующая строка
    //Формировать DOC файл (false/true);Открывать Email программу (false/true);принудительный адрес отправки;Файл-шаблон
    //например: "true;true;"
    //или: "false;true;artemu78@rambler.ru;first-template"
    if(MailSetup==null)return
    var values=MailSetup.split(";");
    
    if(ReturnBoolean(values[0])){
        //создать файл
        var WaitWindow=window.open("wait.csp","win2", "status=no,width=200,height=200");
        ok=#server(Kontragent.Action.MakeFile(ItemID,ItemClass,values[3]))#
        WaitWindow.close();
        if(isNaN(ok)){alert(ok);return}
        else{alert("Файл успешно создан")}
    }
    if(ReturnBoolean(values[1])){
        //открыть почтовую программу
        if(values[2]!="")
            {
            var MailAddress=values[2];      //
            }
        else
            {
            var MailValues=#server(Docs.Action.EmailFromDoc(ItemID,ItemClass))#         
            var MailValuesArray=MailValues.split(StringSplitter);
            var MailAddress=MailValuesArray[0];
            var KontrName=MailValuesArray[1];
            var DocTypeName=MailValuesArray[2];
            var DocName=MailValuesArray[3];
            if(MailValues==""){alert("Не удалось определить E-mail у контрагента записанного в документе.\nУкажите пожалуйста адрес вручную или заполните соответствующее поле контрагента.");return}
            
            }
    window.open("mailto:"+KontrName+" <"+MailAddress+">?subject="+OurName+"&body=Здравствуйте "+KontrName+"\n\n\n---------\n"+OurName)
    }
}

function ChangeTovInDocFn(){
var itemid=docums.ItemID;
var answer=window.showModalDialog("ChangeGoods.csp?DocId="+itemid+"&sessionid="+sessionid,"","center:yes;status:no;dialogHeight:550px;dialogWidth:800px;resizable:yes;");
if(answer)showitems()
}

function ShowLogOfCreation(){
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбрана инструкция по отгрузке.");return;}
window.open("LogOfCreation.csp?doc="+docums.ItemID);
}

//указанное поле документа в отдельном окне
function ShowOtchetErrorsFn(PropertyName)
{
    window.showModalDialog("Info.csp?docid="+docums.ItemID+"&class="+doctypesItemID+"&property="+PropertyName,"","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}

//отклонить отчёт
function setOtchetFailed()
{
    if(!window.confirm("Отклонить отчёт?"))return;
    var docid=docums.ItemID;
    if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
    var Descr = window.prompt("Укажите причину","");
    if(Descr==null)return;
    var ok= #server(Docs.Otchet.SetOthcetStatFailed2(docid,Descr))#
    if(isNaN(ok)){alert(ok)}
    else{okfunc();}
}

function setOtchetAccepted(){
if(!window.confirm("Поставить отчёту статус \"Принят\"?"))return;
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
var ok= #server(Docs.Otchet.SetOthcetStatAccepted(docid))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}


function setActFailed()
{
    if(!window.confirm("Отклонить акт?"))return;
    var docid=docums.ItemID;
    if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
    var Descr = window.prompt("Укажите причину","");
    var ok= #server(Docs.Act.SetActStatFailed(docid,Descr))#
    if(isNaN(ok)){alert(ok)}
    else{okfunc();}
}

function setActAccepted(){
var docid=docums.ItemID;
var ActNumber = #server(Docs.Action.getRashNumb("Docs.Act"))#;
var ActSumma = #server(Docs.Act.GetActSumma(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать сумму акта.\n"+ActSumma);return;}
var ActType = #server(Docs.Act.GetActType(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать тип акта.\n"+ActType);return;}
var answer = window.confirm("Поставить акту статус \"Принят\"?\n"+
    "Будущий номер акта "+ActNumber + "\n" + 
    "Сумма акта " + ActSumma);
if(!answer)return;
if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
var ok= #server(Docs.Act.SetActStatAccepted(docid,ActNumber,ActSumma,ActType))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}

function ShowReqsFromActFn()
{
    window.showModalDialog("widetext.csp?docid="+docums.ItemID+"&class="+doctypesItemID+"&property=CheckResult","","center:yes;status:no;dialogHeight:300px;dialogWidth:400px;resizable:yes;");
}

//сформировать служебную записку
function MakeActNote()
{
    var newItem = "";
    //var newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
    //if(newItem==null)return;
    //var newItem=newItem.split("~")[0];
    var docids=escape(docums.ListViewGetItems('selected',1));
    var Comment = window.prompt("Введите комментарий к актам которые погасятся.","");
    
    var NoteId = #server(Docs.Action2.CreateActNote(docids,newItem,Comment))#
    if(isNaN(NoteId))
    {
        alert(NoteId);
    }
    else
    {
        alert("Акты погашены. Сформирована служебная записка.");
        okfunc();       
        //window.open('screen/actnote.csp?id='+NoteId+'&sessionid='+sessionid);
    }
}

//пришло бумажное подтверждение отчёта
function ProveOthet()
{
    if(!window.confirm("Указать, что бумажный отчёт проверен?"))return;
    var ok = #server(Docs.Otchet.SetParerProve(docums.ItemID))#
    if(isNaN(ok)){alert(ok)}
    else{okfunc()}
}

//сервис менеджер отвечает на негативный отзыв контрагента
function SetBrakAnswer()
{
    var Answer = window.prompt("Укажите причину","");   
    if (Answer==null) return;
    var DocId = docums.ItemID;
    ok = #server(..SetBrakAnswer(DocId,Answer))#
    if (isNaN(ok)){alert(ok);}
    else{alert('Ответ на негативный отзыв сохранён');}
}
</script>


</body>
</html>

<!-- ******************* СЕРВЕР ****************** -->

<CSP:PARAMETER name="DOMAIN" value="SKLAD2"/>
<script method="OnPreHTTP" arguments="" returntype="%Boolean" language="Cache">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,3) s %response.ServerSideRedirect="norights.csp" 
 s ActRights = ##class(Common.Rights).getrights(login,12)

  s SaveChoice=%request.Get("SaveChoice") 
  if %request.Get("SaveChoice") 
  {
      d ##class(User.Settings).SetSettingValue("DocsPage",%request.PageName)
  }
  
 q 1
</script>
<script method="ShowDocItemsHeaders" arguments="Class:%String" returntype="%String" language="Cache" >
 Quit ##class(Common.Common).showheaders(Class)
</script>
<script method="SetBrakAnswer" arguments="ID:%String,Answer:%String" returntype="%String" language="Cache">
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 s obj.BrakCommentAnswer = Answer
 s obj.BrakCommentAnswerUser = $G(%session.Data("user"))
 s obj.BrakCommentAnswerDat = +$H
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
</script>
<script method="ShowDocItems" arguments="Class:%String,DocId:%String" returntype="%String" language="Cache">
 n str,i,fields
 s str=##class(Common.Common).showheaders(Class,,,1)
 for i=1:1:$L(str,"#@#")  {
    s header=$P(str,"#@#",i) 
    s headerKey = $P(header,"~")
    s fields=$G(fields)_headerKey_","
 }
 s fields=$E(fields,1,$L(fields)-2)

 q ##class(Common.Common).showdata(Class,fields,,"doc="_DocId,,1)
</script>
<script method="wCheckSerialButton" description="Выводит кнопку запуска проверки серийных"
    arguments="id:%String,url:%String,label:%String,title:%String" returntype="%String" 
    ProcedureBlock=1 language="Cache">
  #; особенность в классе кнопки "bCheckSerial" - по нему срабатывает обработчик js
  &html<<button id='#(id)#' data-url='#(url)#' class='bCheckSerial btn' title='#(title)#' type='button'> #(label)# </button>>
  
  Q ""
</script>
]]></CSP>


<CSP name="docsDebug.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,3) s %response.ServerSideRedirect="norights.csp" 
 s ActRights = ##class(Common.Rights).getrights(login,12)
 q 1
</script>

<script language="Cache" method="ShowDocItemsHeaders" arguments="Class:%String" returntype="%String">
 Quit ##class(Common.Common).showheaders(Class)
</script>

<script language="Cache" method="SetBrakAnswer" arguments="ID:%String,Answer:%String" returntype="%String">
 if ID="" q "Не указана инструкция."
 s obj = ##class(Operation.Instructions).%OpenId(ID)
 if '$ISOBJECT(obj) q "Невозможно найти инструкцию "_ID
 s obj.BrakCommentAnswer = Answer
 s obj.BrakCommentAnswerUser = $G(%session.Data("user"))
 s obj.BrakCommentAnswerDat = +$H
 s ok=obj.%Save()
 if ok q 1
 else  q "Извините. Ошибка при сохранении ответа."
</script>

<script language="Cache" method="ShowDocItems" arguments="Class:%String,DocId:%String" returntype="%String">
 n str,i,fields
 s str=##class(Common.Common).showheaders(Class,,,1)
 for i=1:1:$L(str,"#@#")
 {
	s header=$P(str,"#@#",i) 
	s headerKey = $P(header,"~")
	s fields=$G(fields)_headerKey_","
 }
 s fields=$E(fields,1,$L(fields)-2)

 q ##class(Common.Common).showdata(Class,fields,,"doc="_DocId,,1)
</script>

<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV8.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>

<title>#($G(%session.Data("systemname")))#</title>

<link href="style.css" type=text/css rel=stylesheet>
<style>
.datar{width:70;border:none;cursor:hand}
</style>

<script language="Jscript" src="common.js"></script>

<script language="JScript">
var d1,d2;
var ActRights = #(ActRights)#;
var ItemsClassName;
//var IGridDocstrObj;

sessionid="#(%session.SessionId)#";
depot="#($G(%session.Data("depot")))#"
docssame="#($G(%session.Data("docssame")))#";

var login = '#($G(login))#';

function load(){
//IGridDocstrObj = document.getElementById("IGridDocstr");
doctypes.LoadHeaders();
docums.login=login;
docitems.login=login;
doctypes.login=login;
}

function show(){
doctypes.DownLoad();
}

function okfunc()
{
	var AdditionalFieldsDocs="";
	StorageOutField.style.display="none";
	TypDocument.innerText=doctypes.ItemName;
	var doctypesItemID=doctypes.ItemID	//название класса выбранного в списке типов документов
	docums.ClassName=doctypesItemID;
	//if(doctypesItemID=="Docs.Platejka")return
	if(doctypesItemID=="Docs.PrihKassOrder")return
	docitems.ClassName=doctypesItemID+"Items";
	var ExcludeFields="Goods,Doc,DocType,RequestItem";
	var AdditionalFields="";
	if(doctypesItemID!="Docs.Platejka")var AdditionalFields="Goods->FullName~Наименование~~~@%String~~~~~#@#";
	
	if(docitems.ClassName=="Docs.RashItems")
	{
		var ExcludeFields=ExcludeFields+",ZakazGoods";
		var AdditionalFields=AdditionalFields+"ZakazGoods->FullName~Заказанный товар~~~@%String~~~~~#@#";
	}
	
	if(doctypes.ItemID=="Docs.Rash"){okbwut3.style.display="inline";}
	else{okbwut3.style.display="none";}
	
	if(doctypesItemID=="Docs.Otchet")
	{
		OtchetSpecButton.style.display="inline";
	}
	else{OtchetSpecButton.style.display="none";}

	if(doctypesItemID=="Operation.Instructions")
	{
		InstrSpecButton.style.display="inline";
	}
	else{InstrSpecButton.style.display="none";}	
	
	if(ActRights==1)
	{
		if(doctypesItemID=="Docs.Act")
		{
			ActSpecButton.style.display="inline";
			ActAddFields.style.display="inline";
		}
		else
		{
			ActSpecButton.style.display="none";
			ActAddFields.style.display="none";
		}
	}
	if(doctypes.ItemID=="Docs.StorageOut"){StorageOutField.style.display="inline";}
	
	d1 = new Date();
	docums.LoadHeaders("ActType","",AdditionalFieldsDocs);
	docitems.LoadHeaders(ExcludeFields,"",AdditionalFields);

}

//показать документы
function showdocums()
{
	var order="";
	//if(doctypes.ItemID=="Docs.Otchet"){var order="NameSorted"}
	dateArr=dat1.value.split("/")
	Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	dateArr=dat2.value.split("/")
	Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
	if(docssame==0){var requst=request+" and Depot="+depot;} //если  показ всех документов для всех складов то
	var currentKontragent=ChooseKontragent.value;
	if(currentKontragent!="all"){var request=request+" and Kontr="+currentKontragent}
	if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
	var ShowUnpaidObject = document.getElementById("ShowUnpaid");
	if(typeof(ShowUnpaid)=="object")
	{
		if(ShowUnpaidObject.checked)var request=request+" and Paid=0"
	}
	
	
	docums.DownLoad(request,"","",order)
	d2 = new Date();
	//alert("вывод документов\n" + (d2-d1) + "\n" + d1.toLocaleTimeString() + "\n" + d2.toLocaleTimeString());
	LoadIgridHeaders();
}

// загрузить заголовки iGrid
function LoadIgridHeaders()
{
	if(ItemsClassName==doctypes.ItemID+"Items")return;
	
	//IGridDocstrObj.Clear(true);
	ItemsClassName = doctypes.ItemID+"Items";
	
	headers=#server(..ShowDocItemsHeaders(ItemsClassName))#
	headersArray = headers.split("#@#");
	var headersArraylength = headersArray.length;
	
	var Captions = new Array(headersArraylength);
	var Keys = new Array(headersArraylength);
	var Tags = new Array(headersArraylength);
	var Widths = new Array(headersArraylength);
	
	for (var i = 0; i< headersArray.length-1; i++)
	{
		//здесь каждый отдельный заголовок
		var h = headersArray[i];
		var headerArray = h.split("~");
		Captions[i] = headerArray[1];
		Keys[i] = headerArray[0];
		Tags[i] = "";
		Widths[i] = 80;
	}
	
	//IGridDocstrObj.DrawHeaders(Captions,Keys,Tags);
}

//загрузить данные в iGrid
function LoadIgridData(DocId)
{
	var data = #server(..ShowDocItems(ItemsClassName,DocId))#

	IGridDocstrObj.Clear(false);
	IGridDocstrObj.LoadStringData(data);
}

function CreateDocument(ItemID)
{
	CurrentDocementClass=docums.ClassName
	if(CurrentDocementClass==""){alert("Не выбран тип документа");return}
	ItemID=ReturnSpace(ItemID)
	var doccsp="document.csp";
	//if (CurrentDocementClass=="Docs.DocBrak"){alert("Документы на приём брака создаются и редактируются на рабочем месте сервис менеджера. Инструкциями с типом \"Приём брака\"");return}
	if(CurrentDocementClass=="Docs.Rash"){var doccsp="DocsRash.csp?source="+ItemID;}
	if(CurrentDocementClass=="Docs.Utiliz")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="UtilizationDoc.csp?DocId="+ItemID}
		else{doccsp="docutiliz.csp"}
	}
	if(CurrentDocementClass=="Docs.PrihKassOrder")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ItemID;
	if(CurrentDocementClass=="Docs.Invent")
	{
		if(window.confirm("Открывать в новой форме?")){var doccsp="InventarizationIgrid.csp?source="+ItemID}
		else{doccsp="docinvent.csp"}
	}
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	if(CurrentDocementClass=="Docs.InnerDiff")doccsp="docinnerdiff.csp"
	if(CurrentDocementClass=="Docs.Remont"){alert("Заявка на запчасти создается инструкцией руководителя\nили в карточке контрагента");return;}
	if(CurrentDocementClass=="Docs.Otchet")
	{
		if(ItemID==""){doccsp="Otchet.csp?docid="+ItemID;}
		else{alert("Отчёты редактировать запрещено.");return;}
	}
	if(CurrentDocementClass=="Docs.Act")
	{
		doccsp="ActFromClient.CSP?docid="+ItemID;
		//alert("Акты технического состояния создаются только в менеджере отчётов");return;
	}
	if((CurrentDocementClass=="Docs.StorageIn")||(CurrentDocementClass=="Docs.StorageOut")){alert("Внутренняя инструкция создается на рабочем месте кладовщика");return;}
	if(CurrentDocementClass=="Operation.Instructions"){doccsp="createinstructIgrid.csp?source="+ItemID}
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	if(WinResult==1)showdocums();
}
	
//показать строки документа
function showitems()
{
	var dd1 = new Date();
	var currentdoc=ReturnSpace(docums.ItemID);
	if(currentdoc=="")return
	docitems.DownLoad("Doc="+currentdoc,1)
	var dd2 = new Date();
	//LoadIgridData(currentdoc);
	//alert("вывод строк\n" + (dd2-dd1) + "\n" + dd1.toTimeString() + "\n" + dd2.toTimeString());	
}

function processdoc()
{
	if(docums.ItemID=="")return
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var ok=#server(Docs.Action.processdoc(doc))#
	//alert("код результата обработки документа: " + ok);
	if(isNaN(ok))
		{
			alert(ok)
			if(doctypes.ItemID=="Docs.Otchet")
			{
				ShowOtchetErrorsFn('Errors');
			}
		}
	else{
			showdocums();
		}
}

function printdoc()
{
	var doc=docums.ItemID+"@"+doctypes.ItemID;
	var doccsp="document.csp";
	if(CurrentDocementClass=="Docs.Utiliz")doccsp="docutiliz.csp"
	if(CurrentDocementClass=="Docs.Invent")doccsp="docinvent.csp"
	if(CurrentDocementClass=="Docs.Inner")doccsp="docinner.csp"
	if(CurrentDocementClass=="Docs.Diff")doccsp="docdiff.csp"
	WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+doctypes.ItemName,"center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	//window.open("print.csp?doc="+doc);
}

//распечатать документ
function prnt(docid,docclass,param){
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;
if(param=="word")
{
	url=url+"&word=on"
}
if ((docclass=="Docs.Otchet")&&(param=="word"))
{
	if(window.confirm("Печатать все поля документа?")){url=url+"&AllColumns=1"}
	//window.prompt(url,url);
}
window.open(url);
}

function makescet(cl){
var doc=docums.ItemID;
if(doc==""){alert("Не выбран документ - основание для формирования платежного поручения");return}
WinResult=window.showModalDialog("makescet.csp?docid="+doc+"&class="+cl,"","cener:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")
}
function maketovnakl(tovnakladn){
var doctov=docums.ItemID;
if(doctov==""){alert("Не выбран документ - основание для формирования товарной накладной");return}
WinResult=window.showModalDialog("maketovnakl.csp?docid="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:300px;dialogWidth:450px;resizable:yes;")
}

function deldoc(){
if(!window.confirm("Удалить документ " + docums.ItemName + " ?"))return false;
var classname=docums.ClassName;
var itemid=docums.ItemID;
var ok1=#server(Docs.Action.deletedoc(classname,itemid))#
if(isNaN(ok1)){alert(ok1)}
else{okfunc();}
}

// Выбрать контрагента
function ChooseKontragentFunc(){
	var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
	if(UsersSelection=="choose")
	{
		var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
		if(newKontragent==null){
			ChooseKontragent.selectedIndex=0;
			return false;}
		var ChooseKontragentLength = ChooseKontragent.options.length;
		ChooseKontragent.options.length= ChooseKontragentLength + 1;
		ChooseKontragent.options(ChooseKontragentLength).value=newKontragent.split("~")[0];
		ChooseKontragent.options(ChooseKontragentLength).text=newKontragent.split("~")[1];
		ChooseKontragent.selectedIndex=ChooseKontragentLength;
	}
}

function EmailDocumentFn(ItemID,ItemClass){
	alert("Функция отключена");
	return;
	var MailSetup=window.showModalDialog("MailSetup.csp","","center:yes;status:no;dialogHeight:200px;dialogWidth:500px;resizable:yes;");
	//вернётся следующая строка
	//Формировать DOC файл (false/true);Открывать Email программу (false/true);принудительный адрес отправки;Файл-шаблон
	//например: "true;true;"
	//или: "false;true;artemu78@rambler.ru;first-template"
	if(MailSetup==null)return
	var values=MailSetup.split(";");
	
	if(ReturnBoolean(values[0])){
		//создать файл
		var WaitWindow=window.open("wait.csp","win2", "status=no,width=200,height=200");
		ok=#server(Kontragent.Action.MakeFile(ItemID,ItemClass,values[3]))#
		WaitWindow.close();
		if(isNaN(ok)){alert(ok);return}
		else{alert("Файл успешно создан")}
	}
	if(ReturnBoolean(values[1])){
		//открыть почтовую программу
		if(values[2]!="")
			{
			var MailAddress=values[2];		//
			}
		else
			{
			var MailValues=#server(Docs.Action.EmailFromDoc(ItemID,ItemClass))#			
			var MailValuesArray=MailValues.split(StringSplitter);
			var MailAddress=MailValuesArray[0];
			var KontrName=MailValuesArray[1];
			var DocTypeName=MailValuesArray[2];
			var DocName=MailValuesArray[3];
			if(MailValues==""){alert("Не удалось определить E-mail у контрагента записанного в документе.\nУкажите пожалуйста адрес вручную или заполните соответствующее поле контрагента.");return}
			
			}
	window.open("mailto:"+KontrName+" <"+MailAddress+">?subject="+OurName+"&body=Здравствуйте "+KontrName+"\n\n\n---------\n"+OurName)
	}
}

function ChangeTovInDocFn(){
var itemid=docums.ItemID;
var answer=window.showModalDialog("ChangeGoods.csp?DocId="+itemid+"&sessionid="+sessionid,"","center:yes;status:no;dialogHeight:550px;dialogWidth:800px;resizable:yes;");
if(answer)showitems()
}

function ShowLogOfCreation(){
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбрана инструкция по отгрузке.");return;}
window.open("LogOfCreation.csp?doc="+docums.ItemID);
}

//указанное поле документа в отдельном окне
function ShowOtchetErrorsFn(PropertyName)
{
	window.showModalDialog("Info.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property="+PropertyName,"","center:yes;status:no;dialogHeight:450px;dialogWidth:600px;resizable:yes;");
}

//отклонить отчёт
function setOtchetFailed()
{
	if(!window.confirm("Отклонить отчёт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
	var Descr = window.prompt("Укажите причину","");
	if(Descr==null)return;
	var ok= #server(Docs.Otchet.SetOthcetStatFailed2(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setOtchetAccepted(){
if(!window.confirm("Поставить отчёту статус \"Принят\"?"))return;
var docid=docums.ItemID;
if(ReturnSpace(docid)==""){alert("Не выбран отчёт.");return;}
var ok= #server(Docs.Otchet.SetOthcetStatAccepted(docid))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}


function setActFailed()
{
	if(!window.confirm("Отклонить акт?"))return;
	var docid=docums.ItemID;
	if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
	var Descr = window.prompt("Укажите причину","");
	var ok= #server(Docs.Act.SetActStatFailed(docid,Descr))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc();}
}

function setActAccepted(){
var docid=docums.ItemID;
var ActNumber = #server(Docs.Action.getRashNumb("Docs.Act"))#;
var ActSumma = #server(Docs.Act.GetActSumma(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать сумму акта.\n"+ActSumma);return;}
var ActType = #server(Docs.Act.GetActType(docid))#;
if(isNaN(ActSumma)){alert("Невозможно расчитать тип акта.\n"+ActType);return;}
var answer = window.confirm("Поставить акту статус \"Принят\"?\n"+
	"Будущий номер акта "+ActNumber + "\n" + 
	"Сумма акта " + ActSumma);
if(!answer)return;
if(ReturnSpace(docid)==""){alert("Не выбран акт.");return;}
var ok= #server(Docs.Act.SetActStatAccepted(docid,ActNumber,ActSumma,ActType))#
if(isNaN(ok)){alert(ok)}
else{okfunc();}
}

function ShowReqsFromActFn()
{
	window.showModalDialog("widetext.csp?docid="+docums.ItemID+"&class="+doctypes.ItemID+"&property=CheckResult","","center:yes;status:no;dialogHeight:300px;dialogWidth:400px;resizable:yes;");
}

//сформировать служебную записку
function MakeActNote()
{
	var newItem = "";
	//var newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	//if(newItem==null)return;
	//var newItem=newItem.split("~")[0];
	var docids=escape(docums.ListViewGetItems('selected',1));
	var Comment = window.prompt("Введите комментарий к актам которые погасятся.","");
	
	var NoteId = #server(Docs.Action2.CreateActNote(docids,newItem,Comment))#
	if(isNaN(NoteId))
	{
		alert(NoteId);
	}
	else
	{
		alert("Акты погашены. Сформирована служебная записка.");
		okfunc();		
		//window.open('screen/actnote.csp?id='+NoteId+'&sessionid='+sessionid);
	}
}

//пришло бумажное подтверждение отчёта
function ProveOthet()
{
	if(!window.confirm("Указать, что бумажный отчёт проверен?"))return;
	var ok = #server(Docs.Otchet.SetParerProve(docums.ItemID))#
	if(isNaN(ok)){alert(ok)}
	else{okfunc()}
}

//сервис менеджер отвечает на негативный отзыв контрагента
function SetBrakAnswer()
{
	var Answer = window.prompt("Укажите причину","");	
	if (Answer==null) return;
	var DocId = docums.ItemID;
	ok = #server(..SetBrakAnswer(DocId,Answer))#
	if (isNaN(ok)){alert(ok);}
	else{alert('Ответ на негативный отзыв сохранён');}
}
</script>
</head>
<body  onload="load()" >
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Документы</strong></TD>
<td width=10% align=right><a href="help/docs.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<td rowspan=99 valign=top>
<fieldset><legend>Типы документов</legend>
 <SKLADList:listview width=200 height=300 id="doctypes" ClassName="Docs.Docs" onAddColumns="show()" zClick="okfunc()" zonDblClick="CreateDocument()"/><br>
</fieldset>
</td></tr>
<tr>
<td width=10>&nbsp;</td>
<td width=100% valign=top>
<fieldset><legend id="TypDocument"></legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
<option value="all">Все</option>
<option value="choose">Выбрать контрагента...</option>
</select> <input type="text" id="DocName" title="Начальные цифры номера" style="width:30px">
 <span id="ActAddFields" style="display:none;border:solid black 1">
 	Неоплаченные <input type="checkbox" style="border:none;width:15px" id="ShowUnpaid" title="Выводить только неоплаченные акты">
 </span>
<sklad:LittleButton name="ok" id="okbut" onclick="okfunc()" alt="Показать документы"><br>
<SKLADList:listview width=100% height=150 id="docums" onAddColumns="showdocums()" zClick="showitems()" zonDblClick="CreateDocument(docums.ItemID)" />
  <Table width=100%><tr><td width=100%>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('')" alt="Создать документ">
<sklad:LittleButton name="edit" id="editbut" onclick="CreateDocument(docums.ItemID)" alt="Редактировать документ">
<sklad:LittleButton name="ok" id="okbut2" onclick="processdoc()" alt="Обработать документ">
<sklad:LittleButton name="print" id="okbwut2" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
<sklad:LittleButton name="printword" id="PrntButWord" onclick="prnt(docums.ItemID,docums.ClassName,'word')" alt="Печать документа Word">
<!--
<sklad:LittleButton name="mail" id="EmailDocument" onclick="EmailDocumentFn(docums.ItemID,docums.ClassName)" alt="Отправить по почте">
-->

<!-- кнопки кнопки инструкции по отгрузке -->
<span style="display:none" id="StorageOutField">
	<sklad:LittleButton name="goinside" id="goinside" onclick="ShowLogOfCreation()" alt="Протокол сборки инструкции по отбору">
</span>

<!-- кнопки расходной накладной -->
<span style="display:none" id="okbwut3"> 
	<sklad:LittleButton name="change" id="ChangeTovInDoc" onclick="ChangeTovInDocFn()" alt="Заменить товар в расходной накладной">
	<sklad:LittleButton name="card" id="dkfi" onclick="makescet('Docs.Chet')" alt="Сформировать счет на оплату">
	<sklad:LittleButton name="card" id="okbwut4" onclick="makescet('factura')" alt="Сформировать счет-фактуру">
	<sklad:LittleButton name="card" id="hernya" onclick="maketovnakl('tovnakladn')" alt="Сформировать товарную накладную">
</span>

<!-- кнопки отчёта контрагента -->
<span style="display:none" id="OtchetSpecButton"> 
	<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Errors')" alt="Показать ошибки отчёта">
	<img src="images/red_stop.gif" alt="Отклонить отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetFailed()">
	<img src="images/green_butt.gif" alt="Принять отчёт" width="20px" height="20px" style="cursor:hand" onclick="setOtchetAccepted()">
	<sklad:LittleButton name="txtok" id="btnProveOthet" onclick="ProveOthet()" alt="Бумажный отчёт проверен">
</span>

<!-- кнопки инструкции руководителя -->
<span style="display:none" id="InstrSpecButton">
	<sklad:LittleButton name="txt" id="btnLookBrakComment" onclick="ShowOtchetErrorsFn('BrakComment')" alt="Показать негативный отзыв контрагента">
	<sklad:LittleButton name="txt" id="btnSetBrakAnswer" onclick="SetBrakAnswer()" alt="Ответить на негативный отзыв">
	<sklad:LittleButton name="txt" id="btnLookBrakCommentAnsw" onclick="ShowOtchetErrorsFn('BrakCommentAnswer')" alt="Показать ответ на негативный отзыв контрагента">
</span>

<!-- кнопки акта технического осмотра -->
<span style="display:none" id="ActSpecButton"> 
<script language="cache" runat="server">
 if  &html<
		<img src="images/txt.gif" onmouseover="btnShowReqsFromAct.src='images/Ontxt.gif'" onmouseout="btnShowReqsFromAct.src='images/txt.gif'"  id="btnShowReqsFromAct" name="btnShowReqsFromAct" alt="Показать заявки этого акта" onclick="ShowReqsFromActFn()">
		<img src="images/red_stop.gif" alt="Отклонить акт" width="20px" height="20px" style="cursor:hand" onclick="setActFailed()">
		<img src="images/green_butt.gif" alt="Принять акт" width="20px" height="20px" style="cursor:hand" onclick="setActAccepted()">
		<img src="images/print.gif" onmouseout="this.src='images/print.gif'" onmouseover="this.src='images/Onprint.gif'" alt="Сформировать служебную записку" width="20px" height="20px" style="cursor:hand" onclick="MakeActNote()">
	>
</script>
<sklad:LittleButton name="txt" id="btnShowOtchetErrors" onclick="ShowOtchetErrorsFn('Comment')" alt="Показать комментарии к акту">
</span>
</td><td>
<sklad:LittleButton name="del" id="dk2fi" onclick="deldoc()" alt="Удалить документ">
</td></tr></table>
<!--
<sklad:LittleButton name="ok" id="okbut3" onclick="printdoc()" alt="Распечатать документ">
-->
</fieldset>
<fieldset><legend>Строки документа</legend>
<SKLADList:listview width=100% height=150 id="docitems" onAddColumns="showitems()"/><br>
</fieldset>
<!--
	<br><br><br>
	<SKLADiGrid:iGrid id="IGridDocstr" width="100%" height="300" Enabled="true" RowMode="true" /><br>
-->
</td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="DocsExportImport.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s ok=""
 d:%request.ContentType="multipart/form-data"
 . s obj=$G(%request.MimeData("oFile1",1))
 . q:'$ISOBJECT(obj)
 . s filepath="c:\"_$P(obj.FileName,"\",$L(obj.FileName,"\"))
 . s file=##class(%File).%New(filepath)
 . Do file.Open("WSN")
 . d file.CopyFrom(obj)
 . s ok=file.%Save()
 . d file.Close()
 . i '+ok d
 . . Do DecomposeStatus^%apiOBJ(ok,.Err)
 . . s ok="Ошибка при сохранении отправленного файла "_filepath_" <br> "_Err(Err)
 . e  d
 . . s ok=##class(Docs.Action2).ImportDocsGlobal(filepath)
</script>
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<title></title>
<script language="jscript">
function ExportDocs(){
var ok=#server(Docs.Action2.ExportDocsGlobal(dat1.value,dat2.value))#;
alert(ok);
}

</script>
</head>

<body>
<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=3><strong>Выгрузка и загрузка документов</strong></TD></tr>
<tr>
</table>
<br><br>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<sklad:Button value="Выгрузить" onclick="ExportDocs();"><br>
<br>
<hr widht=80%>
<h1>#($G(ok))#</h1>
<form enctype="multipart/form-data" method="post" >
Загрузить документы<br>
<input name="oFile1" id="oFile1" size=30 type=file style="width:300px"><br>
<input type="submit" value="ок" style="width:60px">
</form>
</body>
</html>
]]></CSP>


<CSP name="DocsList.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Список документов </title>
<link href="style.css" type=text/css rel=stylesheet>
</head>


<body leftmargin="20px" topmargin="20px" rightmargin="20px" bottommargin="20px">
<table border=1>
	<tr>
		<th>Документ
		<th>Номер
		<th>Дата
		<th>Контрагент
	</tr>
<script language="cache" runat="server">
 s docs=%request.Get("docs")
 f i=1:1:$L(docs,";")
 {
	 s docId = $P(docs,";",i)
	 CONTINUE:docId=""
	 s DocObj = ##class(Docs.Super).%OpenId(docId)
	 CONTINUE:'$ISOBJECT(DocObj)
	 w "<tr>"
	 w "<td>"_DocObj.DocumentClass.Name
	 w "<td>"_DocObj.Name
	 w "<td>"_$ZD(DocObj.Dat,4)
	 w "<td>"_DocObj.Kontr.Name
	 w "<td><a href=""print.csp?id="_docId_"&class="_DocObj.DocumentClass.%Id()_"&sessionid="_%session.SessionId_""">"_"<img src=""images/print.gif"">"_"</a>"
 }
</script>
</table>
</body>
</html>
]]></CSP>


<CSP name="DocsRash.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 .  s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
Quit 1
</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:170px;cursor:hand;}
.ZakazInstr{display:inline;}
</style>
<script language="jscript" src="common.js"></script>
<title>Расходная накладная</title>

<script language="Jscript">
var DocId='#(%request.Get("source"))#';
var sessionid="#(sessionid)#";

function load(){
FillDocStr();
}

function FillDocStr(){
var Captions = new Array(6);
var Keys = new Array(6);
var Tags = new Array(6);
var Widths = new Array(6);

Captions[0]="Товар";
Captions[1]="Цена";
Captions[2]="Кол-во";
Captions[3]="Сумма";
Captions[4]="Заказанный товар";
Captions[5]="Заказ (кол-во)";
//Captions[6]="Дата замены";
//Captions[7]="Время замены";
//Captions[8]="Оператор";

Tags[0]="Goods.Goods";
Tags[1]="%Numeric";
Tags[2]="%Numeric";
Tags[3]="%Numeric";
Tags[4]="Goods.Goods";
Tags[5]="%String";
//Tags[6]="%Date";
//Tags[7]="%Time";
//Tags[8]="Users.Dates";

Keys[0]="Goods";
Keys[1]="Price";
Keys[2]="Quantity";
Keys[3]="Total";
Keys[4]="ZakazGoods";
Keys[5]="Zakaz";
//Keys[6]="ZakazDat";
//Keys[7]="ZakazTim";
//Keys[8]="ZakazUser1";

Widths[0]=200;
Widths[1]=60;
Widths[2]=60;
Widths[3]=60;
Widths[4]=200;
Widths[5]=80;
//Widths[6]=80;
//Widths[7]=80;
//Widths[8]=110;
docstr.DrawHeaders(Captions,Keys,Tags, Widths);
if(DocId!="")
	{
	docstr.loadfrommethod("Docs.Action2.RashStr",DocId);
	}
}

// сохранить
function startFun(){
xmlDoc=docstr.GetXmlContentByRows();
InsertXmlHeader(xmlDoc,"Summa",docstr.GetTableSumma(),"%String");
InsertXmlHeader(xmlDoc,"Name",Name.value,"%String");
InsertXmlHeader(xmlDoc,"Comment",Comment.value,"%String");
InsertXmlHeader(xmlDoc,"Kontr",Kontr.Tag,"Common.Kontragent");
InsertXmlHeader(xmlDoc,"opl",opl.value,"Common.Dictionary7");
InsertXmlHeader(xmlDoc,"OplatStatus",OplatStatus.value,"%String");
InsertXmlHeader(xmlDoc,"OplSumma",OplSumma.value,"%String");
InsertXmlHeader(xmlDoc,"Platej",Platej.Tag,"Docs.Platejka");
InsertXmlHeader(xmlDoc,"RubSumma",RubSumma.value,"%String");
var DocID=SendXml(DocId,"Docs.Rash",xmlDoc,sessionid);
if(isNaN(DocID)){alert(DocID)}
else{returnValue=1;window.close();}
}

//Добавить товар
function AddGood(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
docstr.AddRowsInstruct(WinResult)
}

// удалить строку
function RemoveRow(){
docstr.RemoveSelectedRows()
}

// Очистить список
function ClearGrid(){
if(window.confirm("Удалить все товарные строки?"))docstr.Clear()	
}

function ChooseKonragent(Obj){
var newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}

function ChoosePlatej(Obj){
var newItem=window.showModalDialog("Dictionary.csp","Docs.Platejka","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
if(newItem==null){return false;}
var newArr=newItem.split(InnerSplitter);
Obj.innerText=newArr[1];
Obj.Tag=newArr[0];
}
</script>
</head>

<body onload="load()" onkeypress="ManageWindow();">
<table width=100%><tr><td>
<table class="LeftTop" cellspacing=0 width=100%>
<script language="cache" runat="server">
 s DocId=%request.Get("source")
 i DocId {
 	&sql(select Name,Comment,CloseDate,CloseTime,CloseUser->Name,Stat,Summa,Kontr,Kontr->Name,opl,OplatStatus,OplSumma,Platej,Platej->Name,RubSumma into 
 	:Name,:Comment,:CloseDate,:CloseTime,:CloseUserName,:Stat,:Summa,:Kontr,:KontrName,:opl,:OplatStatus,:OplSumma,:Platej,:PlatejName,:RubSumma
 	from Docs.Rash where ID=:DocId)
 	i SQLCODE w "<tr><td colspan=4>Ошибка при выводе накладной "_DocId_"<br>SQLCODE="_SQLCODE_"</td></tr>"
 	i Stat=2 d
 	. s ClosedString=CloseUserName_" "_$S(CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(CloseTime:$ZT(CloseTime),1:"")
 	. s SaveButtonStyle="display:none"
 }

w "<tr>"
	w "<td class=RightBottom>Номер<td class=RightBottom><input type=text id=Name MAXLENGTH=50 value='"_$G(Name)_"'>"
	w "<td class=RightBottom>Комментарий<td class=RightBottom><input type=text id=Comment MAXLENGTH=1000 Value='"_$G(Comment)_"'>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Контрагент<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseKonragent(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Kontr"" Tag='"_$G(Kontr)_"'>"_$G(KontrName)_"</span>"
	w "<td class=RightBottom>Сумма"
	w "<td class=RightBottom><input type=""text"" id=""Summa"" Value="""_$G(Summa)_""">"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Оплата"
	w "<td class=RightBottom><select id=""opl"">"
		w ##class(Docs.Action2).GetClassValuesOptions($G(opl),"Common.Dictionary7")_"</select>"
	w "<td class=RightBottom>Статус оплаты"
	w "<td class=RightBottom><select id=""OplatStatus"">"
		w ##class(Docs.Action2).GetDisplaylistOptions($G(OplatStatus),"Docs.Rash||OplatStatus")_"</select>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Оплаченная сумма<td class=RightBottom><input type=""text"" id=""OplSumma"" Value="""_$G(OplSumma)_""">"
	w "<td class=RightBottom>Платёжный документ"
	w "<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChoosePlatej(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Platej"" Tag='"_$G(Platej)_"'>"_$G(PlatejName)_"</span>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Рублёвая сумма<td class=RightBottom><input type=""text"" id=""RubSumma"" Value="""_$G(RubSumma)_""">"
	w "<td class=RightBottom colspan=2>&nbsp;"
w "</tr>"

w:$G(ClosedString)'="" "<tr><td colspan=4 class=RightBottom>Накладная закрыта <i>"_ClosedString_"</i>"
</script>
</table>
<tr height=100%><td>
<SKLADiGrid:iGrid id="docstr" width="100%" height="300" Enabled="true"  /><br>
<sklad:Button value="Добавить товар" onclick="AddGood();" style="width:150px">
<sklad:Button value="Удалить строку" onclick="RemoveRow();" style="width:150px">
<sklad:Button value="Очистить строки" onclick="ClearGrid();" style="width:150px">
<tr><td>
<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</table>

</body>
</html>]]></CSP>


<CSP name="docssuper.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Cache Server Page </title>

</head>

<body>
пройдемся по Docs.Super курсором и так<br>
<script language="cache" runat="server">
w $I_"<BR>"
k ^mtempUmaKura
s max=^Docs.SuperD
// идем курсором по Docs.Super
&sql(declare alldocs cursor for 
select id,DocumentClass into :id,:DocumentClass from Docs.Super)
&sql(open alldocs)
s count=0
f  &sql(fetch alldocs) q:SQLCODE  d
 . i $I(count)
 . i DocumentClass="" w "пустой DocumentClass "_id_"<br>" q
 . s ^mtempUmaKura("without",id)=DocumentClass
&sql(close alldocs)
 w "<br>count="_count
 s count=0
 w "<br>// просто пошли по Docs.Super<br>"
 s i="" f  s i=$O(^Docs.SuperD(i)) q:i=""  d
 . i $I(count)
 . w "<b>"_i_"</b><br>"
 . q:$D(^mtempUmaKura("without",i))
 . s cl=$G(^Docs.SuperD(i))
 . s kk=$S(cl'="":$LIST(cl,7),1:"")
 . w i_" "_kk_"<br>"
 w "<br>count="_count
</script>
</body>
</html>
]]></CSP>


<CSP name="document.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s source=%request.Get("source")
 s:source'="" DocClass=##class(Docs.Action).GetClassFromSource(source)
 s:source'="" DocType=##class(Docs.Action).GetDocNameFromClass(DocClass)
 s silent=%request.Get("silent")
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var ClassName=Arguments[0];
var DocID=ReturnSpace(Arguments[1]);
var DocID333=DocID;
var DocType=Arguments[2];
//alert("ClassName="+ClassName+"\nDocID="+DocID+"\nDocType="+DocType)
var source="#(source)#";
if(source!=""){
	var ClassName="#($G(DocClass))#"
	var DocType="#($G(DocType))#"
}

function load(){
PropTable.ClassName=ClassName;
if(ClassName=="Docs.Rash"){
	PropTable.Silent="Name";
	PropTable.setsilent();}
TypDocument.innerText=DocType;
var HideFields="CloseDate,CloseTime,CloseUser,Dat,Tim,Stat,Source,DocType,User1";
if(ClassName=="Docs.Brakremont"){var HideFields=HideFields+",Kontr,Summa";}
PropTable.DownLoadPairs("",DocID,HideFields,source);
docstr.ClassName=ClassName+"Items";
if(source!=""){docstr.attachEvent("onAddColumns",loadgoods)}
else{docstr.attachEvent("onAddColumns",loadgoods2)}
var HideFieldsString="Doc,DocType";
if(ClassName=="Docs.Brakremont"){var HideFieldsString=HideFieldsString+",Total,Price";}
docstr.LoadHeadersXML(HideFieldsString);
}

//товары взять из инструкции
function loadgoods(){
docstr.GetFromCard(source,"Goods.Goods","Name,Price","AllDocuments")
}

//товары взять из строк документа
function loadgoods2(){
if(DocID!=""){
docstr.loadfrommethod("Docs.Action.GetStrFromDoc",DocID,2,3)}
}

function startFun(){
if(!window.confirm("Сохранить?"))return
DocID=ReturnSpace(Arguments[1])
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var DocID=SplitSendXml(DocID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
if(isNaN(DocID)){
	alert(DocID);
}
else{
 if(source!=""){
	var ok2=#server(Docs.Action.SetSourceDoc(ClassName,DocID,source))#
 	if(isNaN(ok2))alert(ok2)
 }
 if(ClassName=="Docs.Prih"){
 	var ok3=#server(Docs.Action.PrihNeedsDiff(DocID))#
 	if(isNaN(ok3)&&(ok3!="yes"))alert(ok3)
 	if(ok3=="yes"){
	 	okdiff=window.showModalDialog("docdiff.csp?source="+DocID,"Docs.Diff"+InnerSplitter+""+InnerSplitter+"","cener:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
	 	if(okdiff!=1){alert(okdiff);return false;}
	 	var ok2=#server(Docs.Action.SetSourceDoc("Docs.Diff",okdiff,DocID))#
 	}	 
 }returnValue=1;
 window.close();
}
}


function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[4] + " " + onestr[8] + " " + onestr[1];
	FieldValue["Goods"]=onestr[0];
	FieldCaption["Price"]=getPrice(FieldValue["Goods"]);
	docstr.AddRow(FieldCaption,FieldValue);
}
}

function getPrice(tovid){
return #server(Goods.GoodsAction.getprice(tovid))#;
}

function fillrash(){
if((ClassName=="Docs.Rash")&(DocID=="")){
var val=#server(Docs.Action.getRashNumb())#
PropTable.setCellValue("Name",val);
PropTable.Silent="Name";}
}

function setsumm(){
var val=docstr.Total;
var val=val.toFixed(2);
PropTable.setCellValue("Summa",val);
}

// закрытие окна с подтверждением
function windowclose(){
if(window.confirm("Вы уверены?"))window.close();
}

// обработчик события OnCellChange таблицы строк документов
function docstrPropChange(){
	if(docstr.cellChange.colname=="Quantity"){
		var newQuantity=docstr.cellChange.value;
		var price = docstr.item("Price")
		var NewTotal=price*newQuantity;
		if(typeof(NewTotal)=="number"){var NewTotal=NewTotal.toFixed(2)}
		if(NewTotal=="NaN"){return}
		docstr.setCellValue("Total",NewTotal)
		setsumm()
}
}
</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=400 height=200 onLoadComplete="fillrash()" />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 CountTotal="true" Totalchange="setsumm()" displaybar=true OnCellChange="docstrPropChange()" />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">
</fieldset>
<csp:IF CONDITION=silent'="true">
<center><sklad:Button value="Сохранить" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="windowclose()"></center>
</csp:IF>
</body>
</html>]]></CSP>


<CSP name="docutiliz.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 k ^mtempAddress($G(%session.Data("user"),"undef"))
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>

<script language="Jscript" src="common.js"></script>
<script language="JScript">
var Arguments=window.dialogArguments.split(InnerSplitter);
var DocID=Arguments[1];
var DocType=Arguments[2];
var ClassName=Arguments[0];

function load(){
PropTable.ClassName=ClassName;
TypDocument.innerText=DocType;
PropTable.DownLoadPairs("",DocID,"Dat,Tim,Stat,Source,DocType,Summa,User1");
docstr.ClassName=ClassName+"Items";
docstr.LoadHeadersXML("Doc,DocType,Price,Total");
}

function loadgoods2(){
if(DocID!=""){
	docstr.loadfrommethod("Docs.Action.GetStrFromDoc",DocID,2,3);
	}
}


function startFun(){
if(!window.confirm("Сохранить?"))return;
var xmldoc=PropTable.GetXmlContent();
var xmldoc2=docstr.GetXmlContent();
var ok=SplitSendXml(DocID,ClassName,xmldoc,xmldoc2,"#(%session.SessionId)#");
//создатель документа вернёт его ID
if(isNaN(ok)){
	alert(ok);
	return
}
 returnValue=1;
 window.close();
}

function addtovars(){
WinResult=window.showModalDialog("selectgoods2.csp","","cener:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
var FieldCaption = new Array();
var FieldValue = new Array();
for(i=0 ; i<WinResult.length-1 ; i++){
	var onestr=WinResult[i].split(InnerSplitter);
	FieldCaption["Goods"]=onestr[1];
	FieldValue["Goods"]=onestr[0];
	docstr.AddRow(FieldCaption,FieldValue);
}
}
//Goods, Address, Value
function ValidateAddress(RowArray2){
var Address=RowArray2["addr"]
var Value=RowArray2["Quantity"]
var Goods=RowArray2["Goods"]
var ret=#server(Store.Action.validate(Goods,Address,Value))#
if(ret==1) return true;
return ret;
}
function curse(cur,RowArray2){
if((cur=="Client")&(RowArray2["addr"]!="")){
	alert("Операция может проводиться либо на складе либо на клиенте")
	return false;}
if((RowArray2["Client"]!="")&(cur=="addr")){
	alert("Операция может проводиться либо на складе либо на клиенте")
	return false;}
return true;
}

// закрытие окна с подтверждением
function windowclose(){
if(window.confirm("Вы уверены?"))window.close();
}

</script>
</head>
<body  onload="load()" onkeypress="ManageWindow()">
<center id="TypDocument" style="font-size:14pt;font:Arial;color:#112255"></center>
<SKLAD2:table id="PropTable" width=350 height=200 />
<fieldset><legend>Строки документа</legend>
<SKLAD2:table id="docstr" width=100% height=200 Silent="Goods" CountTotal="true" onAddColumns="loadgoods2()" runValidateAddress="true" displaybar=true />
<sklad:LittleButton name="new+" id="add2" onclick="addtovars()" alt="Вставить товары">
<sklad:LittleButton name="print" id="apint" onclick="prntdoc()" alt="Распечатать документ">

</fieldset>
<center><sklad:Button value="Сохранить" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="windowclose()"></center>
</body>
</html>]]></CSP>


<CSP name="emplight.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,5) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script><script language="cache" runat="server" method="wDocuments" arguments="depot:%String">
 n sql s sql="select Oper->cl as mustbe,ID as DocId,Name,Kontr as KontrID,Kontr->Name as Kontr,User1->Name as User1,InstDate as InstDateHorolog"
 s sql=sql_",%external(State) as State,dostavka->Name as dostavka,showcolor as showcolor,Oper as oper,Oper->Name as opername,postnumber,postdata,State as StateNumb,RashOplatType->Name as RashOplatTypeName"
 s sql=sql_" from Operation.Instructions where (State Between 2 and 8) and (Depot1=?) "
 s kontr1=$P(kontr,"~") if (kontr1'="all")&(kontr1'="") s sql=sql_" and Kontr="_kontr1
 s instrtype1=$P(instrtype,"~")	i (instrtype1'="all")&(instrtype1'="") s sql=sql_" and Oper="_instrtype1
 
 n rs s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql) i '+ok q "Ошибка при формировании списка инструкций"
 s ok=rs.Execute(depot) i '+ok q "Ошибка при формировании списка инструкций"
 while rs.Next(){
	 
 	f i="mustbe","DocId","Name","KontrID","Kontr","User1","InstDateHorolog","State","dostavka","showcolor","oper","opername","postnumber","postdata","StateNumb","RashOplatTypeName" d
	. s @i=$G(rs.Data(i)) s:@i="" @i="&nbsp;"
	 
	s InstDate=$ZD(InstDateHorolog,4)
 	s innerbutton=""
 	s mustbe=$P($G(mustbe),",",1),NameRash=""
 	s (innerdoc,DocumentClass)=""
 	
 	#; найдем документы созданные от текущей инструкции
 	s ok=..wChildrenDocs(mustbe,DocId,.innerbutton) if 'ok continue
	
 	s:StateNumb=8 innerbutton=innerbutton_"<img src=""images/post.gif"" onmouseover=""this.src='images/Onpost.gif'"" onmouseout=""this.src='images/post.gif'""  onclick=""post('"_DocId_"')"" alt=""Указать реквизиты почтового документа"" >"
 	s style="" s:showcolor'="" style="style=""color:"_showcolor_""""
 	w "<tr ",style,">"
 	w "<td>",Name," (",NameRash,") ",RashOplatTypeName,"</td>"
 	w "<td>",InstDate,"</td>"
 	w "<td style='cursor:hand' onclick=""ShowKontr('",KontrID,"')"">",Kontr,"</td>"
 	w "<td>",User1,"</td>"
 	w "<td id=""Instr",DocId,"Stat"">",State
 	s:oper'=10 dostavka=opername
 	w "<td>",dostavka,"</td>"
 	w "<td><nobr>"
 		,"<img src=""images/ok.gif"" onmouseover=""this.src='images/Onok.gif'"" onmouseout=""this.src='images/ok.gif'"" "
 		," onclick=""chstat(this.Tag,'",innerdoc,"')"" alt=""Изменить статус"" Tag=""",DocId,"""> "
 		,"<img src=""images/print.gif"" onmouseover=""this.src='images/Onprint.gif'"" onmouseout=""this.src='images/print.gif'"" "
 		," onclick=""prnt('",$G(childdoc),"@",$G(mustbe),"')"" alt=""Распечатать накладную"" Tag="""">"
 		,innerbutton
 		,"</nobr></td>"
 	w "</tr>"	
 }
 d rs.Close(), rs.%Close() k rs
</script><script language="cache" method="wChildrenDocs" arguments="mustbe:%String,DocId:%String,&innerbutton:%String" returntype="%Status">
	n AdditionalFields s AdditionalFields="" s:mustbe="Docs.Rash" AdditionalFields=",opl->Name as RashOplatTypeName"
    n sqlDocsRash s sqlDocsRash="select id as childdoc,Name as NameRash"_AdditionalFields_" from "_mustbe_" where Source=?"
    w "<!-- sqlDocsRash "_sqlDocsRash_"-->"
 	n rs s rs=##class(%ResultSet).%New()
 	n ok s ok=rs.Prepare(sqlDocsRash) if '+ok w "<tr><td colspan=7>Ошибка при формировании списка инструкций</td>" Q ok
 	s ok=rs.Execute(DocId) if '+ok w "<tr><td colspan=7>Ошибка при формировании списка инструкций</td>" Q ok
	n RashOplatTypeName
	while rs.Next() {
		s childdoc=$G(rs.Data("childdoc")), NameRash=$G(rs.Data("NameRash")), RashOplatTypeName=$G(rs.Data("RashOplatTypeName"))
 		// есть документы  от инструкции, посмотрим есть ли внутренние инструкции от этих потомков
 		&sql(select id,DocumentClass,Name,stat into :innerdoc,:DocumentClass,:NameInner,:stat 
 			 From Docs.Super where Source=:childdoc
 		)
 		if SQLCODE {
 			s innerbutton="<img src=""images/new.gif"" onmouseover=""this.src='images/Onnew.gif'"" onmouseout=""this.src='images/new.gif'""  onclick=""create('"_mustbe_"','"_childdoc_"')"" alt=""Создать внутреннюю инструкцию"" >"
 		} else {
 			s innerbutton="<img src=""images/edit.gif"" onmouseover=""this.src='images/Onedit.gif'"" onmouseout=""this.src='images/edit.gif'""  onclick=""lookinnerinstr('"_innerdoc_"@"_DocumentClass_"')"" alt=""Редактировать внутреннюю инструкцию"" >"
 			s innerbutton=innerbutton_"<img src=""images/print.gif"" onmouseover=""this.src='images/Onprint.gif'"" onmouseout=""this.src='images/print.gif'""  onclick=""prnt('"_innerdoc_"@"_DocumentClass_"')"" alt=""Распечатать внутреннюю инструкцию"" >"
 			i stat=1 s innerbutton=innerbutton_"<img src=""images/ok.gif"" onmouseover=""this.src='images/Onok.gif'"" onmouseout=""this.src='images/ok.gif'""  onclick=""savestore(this.Tag,'"_NameInner_"')"" alt=""Обработать документ"" Tag="""_innerdoc_""">"
 			e  s innerbutton=innerbutton_"<img src=""images/Disabledok.gif"" alt=""Документ уже обработан"" style='cursor:no-drop'>"
 		}
	}
	d rs.Close(), rs.%Close() k rs
	Q $$$OK
</script><script language="cache" runat="server">
 s kontr=%request.Get("kontr")
 s instrtype=%request.Get("instrtype")
</script>
<html>
<head>
<title>Рабочее место кладовщика</title>
<style>
img{cursor:hand}
a:visited {color:#002277;text-decoration:none;}
a:link {color:#002277;text-decoration:none;} 
a:hover {color:#0044cc;text-decoration:underline;} 
a:active {color:#CC3300;text-decoration:none;}
.hover {background-color:#99bbdd}
#tblInstructions {
	border-collapse:collapse;
	border:solid 1px silver;
}
#tblInstructions td, #tblInstructions th {
	border-collapse:collapse;
	border:solid 1px silver;
	padding: 0px 2px;
}
</STYLE>
<script type='text/javascript' src='js/m.js'></script>
<script language="javascript">
var sessionid="#(%session.SessionId)#";

var InnerSplitter="~";
var kontr='#($G(kontr))#';
var instrtype='#($G(instrtype))#';
var d1=new Date();
// функция вызываемся автоматически послезагрузки документа
function load(){
var kontrArray=kontr.split("~");
var instrtypeArray=instrtype.split("~");
if((kontrArray[0]!="all")&(kontrArray[0]!="")){SetSelectData("ChooseKontragent",kontr)}
if((instrtypeArray[0]!="all")&(instrtypeArray[0]!="")){SetSelectData("ChooseInstrType",instrtype)}
var d2=new Date();

}

// печать документа созданного инструкцией
function prnt(idclass){
var docid=idclass.split("@")[0]
var docclass=idclass.split("@")[1]
window.open("print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid)
 }
 
//изменить состояние инструкции
function chstat(docid,innerdoc){
 var newstat=window.showModalDialog("instrstates.csp","","center:yes;status:no;dialogHeight:300px;dialogWidth:300px;resizable:yes;")
 if(newstat!=null){
	 var ok=#server(Operation.InstrActions.changestat(docid,newstat))#
	 if(ok.split("@")[0]!=1){alert(ok)}
	 else{
		 document.getElementById("Instr"+docid+"Stat").innerText=ok.split("@")[1];
		 }
	 //location.href="emplight.csp?instr="+docid+"&newstat="+newstat;
	 }
 }
 
 //открыть внутреннюю инструкцию
function lookinnerinstr(idclass){
var docclass=idclass.split("@")[1]
var docid=idclass.split("@")[0]
var ok=window.showModalDialog("InnerInstructNew.csp?DocId="+docid+"&ClassName="+docclass+"&sessionid="+sessionid,"","center:yes;status:no;dialogHeight:600px;dialogWidth:600px;resizable:yes;");
#server(Store.Action.KillTempAddress())#
}

// создать внутреннюю инструкцию
function create(cl,docid){
	//создать дочерний документ основываясь на текущем
	var ok=#server(Docs.Action.CreateChildDoc(docid,cl))#
	if(!isNaN(ok)){window.location.reload();}
	else{alert(ok)}
}

// указать реквизиты почтового документа
function post(docid){
var ok=window.showModalDialog("DictItem.csp?skip=InstDate,Name,Comment,Depot1,State,Oper,Operation,innerinstr,dostavka,imp,showcolor,Kontr,Dat,Tim,User1,Summa,Stat,Source,CloseDate,CloseTime,CloseUser&show=postnumber,postdata",docid+";Operation.Instructions","cener:yes;status:no;dialogHeight:350px;dialogWidth:400px;resizable:yes;")
}

// обработать внутреннюю инструкцию
function savestore(InstrID,NameInner){
if(window.confirm("Занести данные документа "+NameInner+" в остатки?")){
ok=#server(Store.Action.SaveQuantFromInstr(InstrID))#
if(isNaN(ok)){alert(ok)}
else{alert("Запись об остатках товаров успешно занесена в базу.");}
}
}

function ShowKontr(KontrID){
	ok=window.showModalDialog("kontragent.csp?KontrId="+KontrID,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function SetSelectData(SelectObjID,newData){
	if($g(SelectObjID).options.length==2){
		$g(SelectObjID).options.length=3
	}
	$g(SelectObjID).options(2).value=newData.split("~")[0];
	$g(SelectObjID).options(2).text=newData.split("~")[1];
	$g(SelectObjID).selectedIndex=2;
}

// Выбрать контрагента
function ChooseKontragentFunc(){
var UsersSelection=ChooseKontragent.options(ChooseKontragent.selectedIndex).value;
if(UsersSelection=="choose"){
	var newKontragent=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	if(newKontragent==null){
		ChooseKontragent.selectedIndex=0;
		return false;}
	SetSelectData("ChooseKontragent",newKontragent);
	ReloadWithParams();
}
if(UsersSelection=="all"){
	ReloadWithParams();
}
}

function ReloadWithParams(){
	var AdditionalParams="";
	var AdditionalParams=AdditionalParams+"kontr="+ChooseKontragent.options(ChooseKontragent.selectedIndex).value+"~"+ChooseKontragent.options(ChooseKontragent.selectedIndex).text
	var AdditionalParams=AdditionalParams+"&instrtype="+ChooseInstrType.options(ChooseInstrType.selectedIndex).value+"~"+ChooseInstrType.options(ChooseInstrType.selectedIndex).text
	window.location.href="emplight.csp?"+AdditionalParams;
}

function ChangeFn(DocId){
if(DocId=="")return
var answer=window.showModalDialog("ChangeGoods.csp?DocId="+DocId,"","center:yes;status:no;dialogHeight:550px;dialogWidth:800px;resizable:yes;");
}
</script>
<link href="style.css" type=text/css rel=stylesheet>
</head>
<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Рабочее место на складе</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>
<sklad:Button style="width:200px" value="Списание брака" onclick="window.location.href='BrakUtiliz.csp'">
<table width=100%><tr>
<Td align="left">
	<fieldset><legend>Тип инструкции</legend>
	
	<select id="ChooseInstrType" onchange="ReloadWithParams()">
	<option value="all">Все</option>
	<script language="cache" runat="server">
	w ##class(Docs.Action2).GetClassValuesOptions(,"Operation.OperTemplate",,,0)
	//
	//<option value="choose">Выбрать тип инструкции...</option>
	</script>
	</select>
	
	</fieldset>
<Td align="left">
	<fieldset><legend>Контрагент</legend>
	<select id="ChooseKontragent" onchange="ChooseKontragentFunc()">
	<option value="all">Все</option>
	<option value="choose">Выбрать контрагента...</option>
	</select>
	</fieldset>
<td align="right" width=100%>
</table>
<fieldset><legend>Инструкции</legend>

<table border=1 id="tblInstructions">
<script language="cache" runat="Server">
s SignCode(-1)="&#9650;"
s SignCode(1)="&#9660;"

s NumberOrder=1
s NumberSign=""
s DateOrder=1
s DateSign=""
s KontrOrder=1
s OperOrder=1
s StateOrder=1
s TaskOrder=1
s KontrSign=""
s OperSign=""
s StateSign=""
s TaskSign=""

s dir=%request.Get("dir")
i dir="" s dir=1
s order=%request.Get("order")
i order="" s order="NameRash"

i (order="NameRash") s NumberOrder=dir*-1,NumberSign=SignCode(dir)
i order="InstDateHorolog" s DateOrder=dir*-1,DateSign=SignCode(dir)
i order="Kontr" s KontrOrder=dir*-1,KontrSign=SignCode(dir)
i order="opername" s OperOrder=dir*-1,OperSign=SignCode(dir)
i order="State" s StateOrder=dir*-1,StateSign=SignCode(dir)
i order="dostavka" s TaskOrder=dir*-1,TaskSign=SignCode(dir)
w "<thead><tr>"
w "<th><a href=""emplight.csp?order=NameRash&dir=",NumberOrder,""">Номер ",NumberSign,"</a></th>"
w "<th><a href=""emplight.csp?order=InstDateHorolog&dir=",DateOrder,""">Дата ",DateSign,"</a></th>"
w "<th><a href=""emplight.csp?order=Kontr&dir=",KontrOrder,""">Контрагент ",KontrSign,"</a></th>"
w "<th><a href=""emplight.csp?order=opername&dir=",OperOrder,""">Оператор ",OperSign,"</a></th>"
w "<th><a href=""emplight.csp?order=State&dir=",StateOrder,""">Состояние ",StateSign,"</a></th>"
w "<th><a href=""emplight.csp?order=dostavka&dir=",TaskOrder,""">Задача<br>(Способ<br>отправки) ",TaskSign,"</a></th>"
w "<th style='font-weight:normal;font-size:12px;font-family:Arial'>Действия</th>"
w "</thead></tbody>"
 s sess=%request.Get("sessionid")
 s depot=$G(%session.Data("depot"))
 s userid=$G(%session.Data("user"))
 s instr=%request.Get("instr")
 s newstat=%request.Get("newstat")
 
 i newstat'="" d
 . s ok=##class(Operation.InstrActions).changestat(instr,newstat)
 . i '+ok d
 . . w "<script language=""javascript"">alert('",ok,"')</script",">"
 
 d ..wDocuments(depot)
 
  
 
</script>
</tbody>
</table>
</fieldset>
<!--
<fieldset><legend>Протокол формирования страницы</legend>
</b>
<span id="joi"></span>
</fieldset>
-->
<div id="debug"></div>
<script type="text/javascript">
	$bind(window,"load",function(){
		var fr=function(o){ //ищем строку
			var tr=null;
			for (;o.tagName!=="TABLE";o=o.parentElement){
				if (o.parentElement.tagName==="THEAD") break;
				if (o.tagName==="TR"){ tr=o; break; }
			}
			return tr;
		}
		$bind($g("tblInstructions"),"mouseover",function(e){
			if (!e) e=window.event; var tr=fr(e.srcElement); if (tr) tr.className="hover";
		});
		$bind($g("tblInstructions"),"mouseout",function(e){
			if (!e) e=window.event; var tr=fr(e.srcElement); if (tr) tr.className="";
		});
	});
</script>

</body>
</html>]]></CSP>


<CSP name="empty.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>

</head>
<body>
<TABLE cellSpacing=0 width="100%" celpadding="0" >

<TR>
<TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>модуль не работает</strong></TD></tr>
</TABLE>
</body>
</html>]]></CSP>


<CSP name="errors.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
s data=$G(%request.Data("data",1))

</script>
<html>
<head>
<title>Ошибки</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
body{font-face: arial; font-size: 14}
</style>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
function DateClick(){
newDate=window.showModalDialog("calendar.csp","","center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;");
if(ReturnSpace(newDate)!=""){document.all.data.value=newDate;}
}
function subm(){
if(document.all.data.value==""){
	DateClick()
}
else{
	forma.submit();
}
}
</script>
</head>

<body>

<csp:IF CONDITION='data=""'>
<center><h2>Ошибки</h2></center>
<form name="forma">Дата <input type=text value=#($ZD(+$H,4))# name=data id=data onclick="DateClick()"> <input type=button onclick="subm()" value="ok" style="width:30"></form>
<csp:ELSE>
<a href="errors.csp">выбрать дату</a><br>
ошибки на дату #(data)#
<table border=1><tr><td>Дата, время<td>Содержание ошибки<td>Уточнение
<script language="cache" runat="server">
 s datah=$ZDH(data,4)
 s i="" f  s i=$O(^Errors(i)) q:i=""  d
 . q:+i'=datah
 . s f="" f  s f=$O(^Errors(i,f)) q:f=""  d
 . . s value=$G(^Errors(i,f))
 . . //s value=$TR(value,"<","(")
 . . //s value=$TR(value,">",")")
 . . w "<tr><td>"_$ZDT(i,4)_"<td>"_$ZCVT(value,"O","HTML")_"<td>"_$ZCVT(f,"O","HTML")
 
</script>
</table>
</csp:IF>
</body>
</html>
]]></CSP>


<CSP name="excel.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 set %response.ContentType = "application/x-msexcel"
 do %response.SetHeader("Content-Disposition","attachment;excel.xls")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 Quit 1
</script>

<!--
такой метод должен поприсутствовать
ClassMethod OnPreHTTP() As %Boolean
{
            set %response.ContentType = "application/x-msexcel"
            do %response.SetHeader("Content-Disposition","attachment;excel.xls")
            set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
            quit 1
}
<csp:class super="csp.excelfile"> 
-->
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
</head>
<body>
<script language="cache" runat="server">
	Write !
	s xmlobj=%request.Content
	w "<table border=1>"
	s i=0
	s sess=%request.Get("sessionid")
	s act=%request.Get("act")
	s %session=%session.GetSession(sess)
	s usr=$G(%session.Data("user"),"undef")
	s glob=$NA(^mtempReport(usr))
	i act="put" d
	. s:$ISOBJECT(xmlobj) ok=##class(Docs.Action).parsexml(xmlobj,1,"",.t,glob,1)
	i act="get" d
	. s i="" f  s i=$O(@glob@("head",i)) q:i=""  d
	. . s heads(@glob@("head",i,"number"))=i
	. w "<tr>"
	. s i="" f  s i=$O(heads(i)) q:i=""  d
	. . w "<td bgcolor='#dedede'>"
	. . w $G(@glob@("head",heads(i)))
	. . w "</td>"
	. w "</tr>"
	. s y="" f  s y=$O(@glob@("body",y)) q:y=""  d
	. . w "<tr>"
	. . s i="" f  s i=$O(heads(i)) q:i=""  d
	. . . w "<td>"
	. . . w $TR($G(@glob@("body",y,heads(i))),".",",")
	. . . w "</td>"
	. . w "</tr>"
	w "</table>"
</script>
</body>
</html>
]]></CSP>


<CSP name="excelfile.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>


<title> </title>

</head>

<body>


</body>
</html>
]]></CSP>


<CSP name="FillInnerStorage.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>Дополнить внутренние инструкции недостающими строками</title>

</head>

<body>

<form>
Пароль <input type="text" name="dfg"><br>
Введите номер расходной накладной<br>
<input type=text name="zzz" value="#(%request.Get("zzz"))#"><input type=submit value="Отправить">
</form>
<script language="cache" runat="server">
 s dfg=%request.Get("dfg")
 s zzz=%request.Get("zzz")
 i (dfg'="mahmah")&(zzz'="") w "Пароль неверный."
 i (dfg="mahmah")&(zzz'="") d
 . s Name=%request.Get("dfg")
 . &sql(select ID into :DocId from Docs.Rash where Name=:zzz)
 . &sql(select ID,Name,Dat into :StoreId,:StName,:StDat from Docs.StorageOut where Source=:DocId)
 . i SQLCODE w "Не найдено внутренних инструкций от расходной "_zzz_" ("_DocId_")" q
 . w "Обработана внутренняя инструкция №"_StName_" ("_StoreId_") от "_$ZD(StDat,4)_"<br>"
 . &sql(declare h1 cursor for select Goods->FullName,ID,Goods,Price,Quantity,Total,Zakaz into :GoodsFullName,:ID,:Goods,:Price,:Quantity,:Total,:Zakaz  from Docs.RashItems where doc=:DocId)
 . &sql(OPEN h1)
 . F  &SQL(fetch h1) q:SQLCODE  d
 . . &sql(select id from Docs.StorageOutItems where doc=:StoreId and Goods=:Goods)
 . . d:SQLCODE
 . . . //если не нашли внутреннюю строку с таким же товаров как у расходной строки
 . . . &sql(insert into Docs.StorageOutItems (DocType,doc,Goods,quantdefault,Price,Total) VALUES ('Docs.StorageOut',:StoreId,:Goods,:Quantity,:Price,:Total))
 . . . i SQLCODE w "SQLCODE="_SQLCODE_"<br>"
 . . . e  w "Добавлена строка с товаром "_GoodsFullName_"<br>"
 . &sql(close h1)
</script>
</body>
</html>
]]></CSP>


<CSP name="finance.csp" application="/csp/sklad2/" default="1"><![CDATA[
<CSP:CLASS INCLUDES="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,14) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>

<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var ColCode="";
sessionid="#(%session.SessionId)#";
var where ="";

function load(){
currentdict.LoadHeaders();
//dfdf.attachEvent("onAddColumns", showgoods)
//dfdf.LoadHeaders("izdelie");
docums0.LoadHeaders();
docums.LoadHeaders();
docums2.LoadHeaders();
docums3.LoadHeaders();
}

function showdictionary(where){
parent.statusFR.WriteStatus("Идёт вывод списка контрагентов...")
var where=ReturnSpace(where);
var made=false;
currentdict.DownLoad(where);
parent.statusFR.WriteStatus("")
}

function gg(){
if(ColCode=="")return false;
where = ColCode+" %STARTSWITH '"+fldval.value+"'";
if(fldval.value=="")where="";
showdictionary(where);
}

function colclick(){
	if(currentdict.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=currentdict.ColName;
	ColCode=currentdict.ColCode;
}

function KontrClick(){
KontrName.innerText=currentdict.ItemName
KontrBalance.innerText=currentdict.item("Balance")
}

function addrecord(currentrecord){
var currentrecord=ReturnSpace(currentrecord)
ok=window.showModalDialog("kontragent.csp?KontrId="+currentrecord,"","center:yes;status:no;dialogHeight:708px;dialogWidth:800px;resizable:yes;")
if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}
}

function CreateDocument(ItemID,CurrentDocementClass){
var doccsp="document.csp";
if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ReturnSpace(ItemID)
WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

// показать отгрузки и все платежи
function ShowKontrData()
{
	ShowDocums();
	ShowInPays();
	ShowOutPays()
}

// показать отгрузки
function ShowDocums0()
{
	var currentKontragent=currentdict.ItemID;
	if(currentKontragent=="")return
	var Date1=ConvertDateSql(dat01.value);
	var Date2=ConvertDateSql(dat02.value);
	var request="Dat>=CAST('"+Date1+"' AS DATE) and Dat<=CAST('"+Date2+"' AS DATE) and Kontr="+currentKontragent+" and opl=2";
	docums0.DownLoad(request);	
}

// показать отчеты
function ShowDocums()
{
	var currentKontragent=currentdict.ItemID;
	if(currentKontragent=="")return
	var Date1=ConvertDateSql(dat1.value);
	var Date2=ConvertDateSql(dat2.value);
	var request="Dat>=CAST('"+Date1+"' AS DATE) and Dat<=CAST('"+Date2+"' AS DATE) and Kontr="+currentKontragent;
	docums.DownLoad(request);	
}

// показать платежи нам
function ShowInPays()
{
	var currentKontragent=currentdict.ItemID;
	if(currentKontragent=="")return
	var Date1=ConvertDateSql(dat11.value);
	var Date2=ConvertDateSql(dat22.value);
	var request="Dat>=CAST('"+Date1+"' AS DATE) and Dat<=CAST('"+Date2+"' AS DATE) and Kontr="+currentKontragent;
	docums2.DownLoad(request);		
}

// показать платежи нам
function ShowOutPays()
{
	var currentKontragent=currentdict.ItemID;
	if(currentKontragent=="")return
	var Date1=ConvertDateSql(dat31.value);
	var Date2=ConvertDateSql(dat32.value);
	var request="Dat>=CAST('"+Date1+"' AS DATE) and Dat<=CAST('"+Date2+"' AS DATE) and Poluh="+currentKontragent;
	docums3.DownLoad(request);	
}

// распечатать акт сверки
function Sverka()
{
	var currentKontragent=currentdict.ItemID;
	if(currentKontragent=="")return

	var WinResult=window.showModalDialog("SverkaParams.csp?KontrId="+currentKontragent,"","center:yes;status:no;dialogHeight:200px;dialogWidth:400px;resizable:yes;")
	if(WinResult==null){return;}

	var kontr1id=WinResult.split("@")[2];
	var kontr2id=currentKontragent;
	
	var dat1=WinResult.split("@")[0];
	var dat2=WinResult.split("@")[1];
	
	window.open("screen/ActSverki.csp?kontr="+kontr2id+"&dat1="+dat1+"&dat2="+dat2+"&OurCompany="+kontr1id);
}

//распечатать документ
function prnt(docid,docclass){
var url="print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid;
window.open(url);
}

//обработать документ
function processdoc(docid){
	if(docid=="")return
	if(!window.confirm("Обработать платёжный документ ?"))return
	var doc=docid+"@Docs.Platejka";
	var ok=#server(Docs.Action.processdoc(doc))#
	if(isNaN(ok))
	{
		alert(ok)
	}
	else
	{
		ShowInPays();
		ShowOutPays();
		alert("Документ успешно обработан");
	}
}

//открыть окно для разноски платёжки по расходным накладным
function OpenPlatejWindow(ItemID){
if(ReturnSpace(ItemID)=="")return
WinResult=window.showModalDialog("PlatejRash.csp?DocId="+ItemID,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}


// распечатать акт сверки
function Sverka2()
{
	var currentKontragent=222
	if(currentKontragent=="")return

	var kontr1id=100;
	var kontr2id=currentKontragent;
	
	var dat1=#($ZD($H,4))#;
	var dat2=#($ZD($H,4))#;
	
	window.open("screen/ActSverki.csp?kontr="+kontr2id+"&dat1="+dat1+"&dat2="+dat2+"&OurCompany="+kontr1id);
}
</script>
</head>

<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()" style="cursor:hand"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Управление финансами</strong></TD>
<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
</tr>
</TABLE>

<fieldset><legend>Контрагенты</legend>

<table>
	<tr>
		<td>
			<img src="images/big/Money.gif" onmouseover="this.src='images/big/OnMoney.gif'" onmouseout="this.src='images/big/Money.gif'" alt="Взаиморасчёт" onclick="showdictionary('WCalc2=2');">
			<img src="images/big/Book.gif" onmouseover="this.src='images/big/OnBook.gif'" onmouseout="this.src='images/big/Book.gif'" alt="Безналичные расчёты" onclick="showdictionary('WCalc2=1');">
		<td>
<span onclick="Sverka2()">Поиск</span>:
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
</table>

<SKLADList:listview width=100% height=150 id="currentdict" zClick="KontrClick()" zonDblClick="addrecord(currentdict.ItemID);" zonColumnClick="colclick()" onAddColumns="showdictionary()" ClassName="Common.Kontragent"/><br>
<table width=100%><tr><td>
  <sklad:LittleButton name="edit" id="addrec" onclick="addrecord(currentdict.ItemID)" alt="Редактировать данные контрагента">
  <sklad:LittleButton name="down" id="showdata" onclick="ShowKontrData()" alt="Вывести информацию по контрагенту">
  <sklad:LittleButton name="price" id="showact" onclick="Sverka()" alt="Вывести акт сверки">
  
</td><td align=right>
	Поддерживать таблицу в актуальном состоянии
	<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
</td>
</tr>
</table>
</fieldset><br>


<span style="FONT-size: 15px ; font-family: arial; COLOR: rgb(0,0,102);">&nbsp;<span id="KontrName"></span> <span style="font-family: Times" id="KontrBalance" title="Общий баланс контрагента складывается из суммы отгрузок и оплаченных платёжных поручений"></span></span>
<br><br>
<table width=100%>
<tr>
	<td width=50% valign=top>
	<fieldset><legend>Платные отгрузки</legend>
	Период c <input type=text id="dat01" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat02" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	 <!--
	 <input type="text" id="DocName"> 
	<select id="RashTypes">
		<option value=0>Все</option>
		<option value=1>Полностью оплаченные</option>
		<option value=2>Частично оплаченные</option>
		<option value=3>Не оплаченные</option>
	</select>
	-->
	<sklad:LittleButton name="ok" id="okbut0" onclick="ShowDocums0()" alt="Показать документы"><br>
	<!-- Таблица отгрузок -->
	<SKLADList:listview width=100% height=200 id="docums0" ClassName="Docs.Rash" /><br>
	<sklad:LittleButton name="print" id="printbut0" onclick="prnt(docums0.ItemID,docums0.ClassName,'')" alt="Печать документа">
	<!--
	<sklad:LittleButton name="edit" id="editrash" onclick="CreateDocument(docums.ItemID,'Docs.Rash')" alt="Редактировать документ">
	<sklad:LittleButton name="card" id="PayRashButton" onclick="PayRashFn(docums.ItemID)" alt="Оплатить расходную накладную">
	-->
	</fieldset>
	
	<td width=50% valign=top>
	<fieldset><legend>Отчёты</legend>
	Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	 <!--
	 <input type="text" id="DocName"> 
	<select id="RashTypes">
		<option value=0>Все</option>
		<option value=1>Полностью оплаченные</option>
		<option value=2>Частично оплаченные</option>
		<option value=3>Не оплаченные</option>
	</select>
	-->
	<sklad:LittleButton name="ok" id="okbut" onclick="ShowDocums()" alt="Показать документы"><br>
	<!-- Таблица отгрузок -->
	<SKLADList:listview width=100% height=200 id="docums" ClassName="Docs.Otchet" /><br>
	<sklad:LittleButton name="print" id="printbut1" onclick="prnt(docums.ItemID,docums.ClassName,'')" alt="Печать документа">
	<!--
	<sklad:LittleButton name="edit" id="editrash" onclick="CreateDocument(docums.ItemID,'Docs.Rash')" alt="Редактировать документ">
	<sklad:LittleButton name="card" id="PayRashButton" onclick="PayRashFn(docums.ItemID)" alt="Оплатить расходную накладную">
	-->
	</fieldset>
</td>
</tr>
</table>


<br><br>
<table width=100%>
<tr>
<td width=50% valign=top>
	<fieldset><legend>Платежи нам</legend>
	Период c <input type=text id="dat11" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat22" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	 <!--
	 <input type="text" id="DocName2"> 
	<select id="PlatejTypes">
		<option value=0>Все</option>
		<option value=1>Зачисленные</option>
		<option value=2>Не зачисленные</option>
	</select>
	-->
	<sklad:LittleButton name="ok" id="okbut2" onclick="ShowInPays()" alt="Показать документы"><br>
	<!-- Таблица платежей -->
	<SKLADList:listview width=100% height=200 id="docums2" ClassName="Docs.Platejka" /><br>
	<sklad:LittleButton name="new" id="newbut1" onclick="CreateDocument('','Docs.Platejka')" alt="Внести платёж">
	<sklad:LittleButton name="edit" id="editbutDocums2" onclick="CreateDocument(docums2.ItemID,'Docs.Platejka')" alt="Редактировать документ">
	<sklad:LittleButton name="print" id="printbut2" onclick="prnt(docums2.ItemID,docums2.ClassName,'')" alt="Печать документа">
	<sklad:LittleButton name="price" id="pricebut" onclick="OpenPlatejWindow(docums2.ItemID)" alt="Разнести платёжный документ по расходным накладным">
	<sklad:LittleButton name="ok" id="okbutDocums2" onclick="processdoc(docums2.ItemID)" alt="Обработать документ">
	</fieldset>
</td>
<td width=50% valign=top>
	<fieldset><legend>Платежи контрагенту</legend>
	Период c <input type=text id="dat31" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat32" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
	<!--
	 <input type="text" id="DocName2"> 
	<select id="PlatejTypes">
		<option value=0>Все</option>
		<option value=1>Зачисленные</option>
		<option value=2>Не зачисленные</option>
	</select>
	-->
	<sklad:LittleButton name="ok" id="okbut3" onclick="" alt="Показать документы" onclick="ShowOutPays()"><br>
	<!-- Таблица платежей -->
	<SKLADList:listview width=100% height=200 id="docums3" ClassName="Docs.Platejka" /><br>
	<sklad:LittleButton name="new" id="newbut2" onclick="CreateDocument('','Docs.Platejka')" alt="Внести платёж">
	<sklad:LittleButton name="edit" id="editbutDocums3" onclick="CreateDocument(docums3.ItemID,'Docs.Platejka')" alt="Редактировать документ">
	<sklad:LittleButton name="print" id="printbut3" onclick="prnt(docums3.ItemID,docums3.ClassName,'')" alt="Печать документа">
	<sklad:LittleButton name="ok" id="okbutDocums3" onclick="processdoc(docums3.ItemID)" alt="Обработать документ">
	<!--
	<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('','Docs.Platejka')" alt="Внести платёж">
	<sklad:LittleButton name="edit" id="editplatej" onclick="CreateDocument(docums2.ItemID,'Docs.Platejka')" alt="Редактировать документ">
	<sklad:LittleButton name="del+" id="delplatejkaitems" onclick="ClearPlatejkaItems()" alt="Очистить оплачиваемые расходные накладные">
	<sklad:LittleButton name="price" id="pricebut" onclick="OpenPlatejWindow(docums2.ItemID)" alt="Разнести платёжный документ по расходным накладным">
	<sklad:LittleButton name="ok" id="okbut22" onclick="processdoc(docums2.ItemID)" alt="Обработать документ">
	-->
	</fieldset>
</td>


</tr>
</table>

</body>
</html>
]]></CSP>


<CSP name="FindGood.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>

<title>	Поиск товаров </title>
<script language="javascript">
sessionid="#(%session.SessionId)#";

function fnFindGood(){
var varabbr=abbr.value;
var varProperty3609 = Property3609.value;
var varName = Name.value;
if((varabbr=="")&&(varProperty3609=="")&&(varName=="")){alert("Необходимо указать хотя бы один признак по которому следует искать товары.");return}
goods.loadfrommethod("Reports.ShowTables.FindGoods",varabbr,varProperty3609,varName)
}

</script>
</head>

<body>
<br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%>&nbsp;</td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Поиск товаров</strong></TD>
<td width=10%>&nbsp;</td>
</TABLE>

<table>
<tr><td>Аббревиатура</td><td><input type="text" id="abbr" title="Первые буквы полного наименование модели, например MAG или VC"></td><td rowspan=3><input type="button" value="Найти" onclick="fnFindGood();" title="Начать поиск по заданным аттрибутам"></td></tr>
<tr><td>Модель</td><td><input type="text" id="Property3609" title="Номер модели, например 1101 или 9907"></td></tr>
<tr><td>Наименование</td><td><input type="text" id="Name" title="Начало названия например шестерня, или корпус. Полностью название указывать необязательно."></td></tr>
</table>
<SKLADList:listview width=100% height=300 id="goods" /><br>

</body>
</html>
]]></CSP>


<CSP name="FixReserves.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Cache Server Page </title>

</head>

<body>
<table border=1>
<script language="Cache" runat="server">
 if %request.Get("password")="mamuka" d ^FixReserves
 else  w "не указан пароль, фиксация остатков невозможна"
</script>
</table>
</body>
</html>
]]></CSP>


<CSP name="ForceFilesCreation.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 n Client,ok
 s Client=%request.Get("number")
 i Client="" w "Не указан уникальный номер клиента"
 e  d
 . s ok=##class(Common.Common).SaveGoodsDictionary(Client)
 . i '+ok w ok q
 . s ok=##class(Common.Common).SaveGroupsDictionary(Client)
 . i '+ok w ok q
 . w 1
</script>
<html>
<head>
</head>

<body>
</body>
</html>
]]></CSP>


<CSP name="garant.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"))
 //i '+login s %response.ServerSideRedirect="norights.csp" 
Quit 1
</script>
<script language="cache" runat="server">
 
 #; 2014-01-12
 #; если передан ид документа и класс - переход по кнопке с doc3.csp, обработчик в docs3.js
 if $d(%request.Data("doc")) && $d(%request.Data("cls"))  {
   s cls=$g(%request.Data("cls",1)) //ожидаем Docs.Act
   if cls="Docs.Act" {
    s doc=$g(%request.Data("doc",1)) // id 
    s serial = $zobjclassmethod(cls,"SerialGetStored",doc) ; возможна ошибка
    s garantId = ##class(Common.Dictionary2).DirectGetIdBySerial( serial )
    s %request.Data("GarantId",1) = garantId ;для стандартной обработки
   }
 }
 
 s GarantId=%request.Get("GarantId")
 s GarantName=%request.Get("GarantName")
 s DeleteStyleDisplay="none"
 
 if (GarantId="")&&(GarantName'="")
 {
     s GarantId = $O(^Common.Dictionary2I("garantInd"," "_GarantName,""))
 }
 
 if (GarantId="") 
 {
    s displaycheckbox="block"
    s displaycheckboxCHECKED="CHECKED"
 }
 else
 {
    s displaycheckbox="none"
    s displaycheckboxCHECKED=""
 }
 
 //s Property9194 = 2   //по умолчанию гар талон недействительный
 if $G(GarantId)'=""
 {
    // s ID = $O(^Common.Dictionary2I("garantInd"," "_GarantId,""))
     s ID=GarantId
     s GarantObj = ##class(Common.Dictionary2).%OpenId(ID)
     if $ISOBJECT(GarantObj)
     {
         
        i GarantObj.Property9194=2 
        {
            if (GarantObj.CloseUser) s CloseUserName=GarantObj.CloseUser.Name
            e  s CloseUserName=""
            
            s ClosedString=CloseUserName_" "_$S(GarantObj.CloseDat:$ZD(GarantObj.CloseDat,4),1:"")_" "_$S(GarantObj.CloseTime:$ZT(GarantObj.CloseTime),1:"")
            s SaveButtonStyle="display:none"
        }
         
         s Name=GarantObj.Name
         if $ISOBJECT(GarantObj.Property5330)
         {
            s Kontr=GarantObj.Property5330.%Id()
            s KontrName=GarantObj.Property5330.Name
         }
         s:+GarantObj.Dat Dat=$ZD(GarantObj.Dat,4)
         s:+GarantObj.Property8550 Property8550=$ZD(GarantObj.Property8550,4)
         s:+GarantObj.SaleDate SaleDate=$ZD(GarantObj.SaleDate,4)
         
         s serial=GarantObj.serial
         s tovar=GarantObj.tovar
         s Property9194=GarantObj.Property9194
         s Comment=GarantObj.Comment
         
         s Tim = $ZT(GarantObj.Tim)
         if $ISOBJECT(GarantObj.remont1),$ISOBJECT(GarantObj.remont1.Source) s remont1="<a href=""screen/ChiefInstr.csp?docid="_GarantObj.remont1.Source.%Id()_""">"_GarantObj.remont1.Source.Name_"</a>"
         if $ISOBJECT(GarantObj.remont2),$ISOBJECT(GarantObj.remont2.Source) s remont2="<a href=""screen/ChiefInstr.csp?docid="_GarantObj.remont2.Source.%Id()_""">"_GarantObj.remont2.Source.Name_"</a>"
         if $ISOBJECT(GarantObj.remont3),$ISOBJECT(GarantObj.remont3.Source) s remont3="<a href=""screen/ChiefInstr.csp?docid="_GarantObj.remont3.Source.%Id()_""">"_GarantObj.remont3.Source.Name_"</a>"
         if $ISOBJECT(GarantObj.remont1otch) s remont1="<a href=""screen/otchet2.csp?id="_GarantObj.remont1otch.%Id()_""">"_GarantObj.remont1otch.Name_"</a>"
         if $ISOBJECT(GarantObj.remont2otch) s remont2="<a href=""screen/otchet2.csp?id="_GarantObj.remont2otch.%Id()_""">"_GarantObj.remont2otch.Name_"</a>"
         if $ISOBJECT(GarantObj.remont3otch) s remont3="<a href=""screen/otchet2.csp?id="_GarantObj.remont3otch.%Id()_""">"_GarantObj.remont3otch.Name_"</a>"
         if $ISOBJECT(GarantObj.remont4otch) s remont4="<a href=""screen/otchet2.csp?id="_GarantObj.remont4otch.%Id()_""">"_GarantObj.remont4otch.Name_"</a>"
         
         if $ISOBJECT(GarantObj.Act) s Act="<a href=""print.csp?id="_GarantObj.Act.%Id()_"&class=Docs.Act"">"_GarantObj.Act.Name_"</a>"
         if $ISOBJECT(GarantObj.Utiliz) s Utiliz="<a href=""print.csp?id="_GarantObj.Utiliz.%Id()_"&class=Docs.Utiliz"">"_GarantObj.Utiliz.Name_"</a>"
         
         //Включаем видимость кнопки УДАЛИТЬ если нет ни заявок ни отчётов
         if '$ISOBJECT(GarantObj.remont1),'(GarantObj.remont1otch) s DeleteStyleDisplay="inline"
     }
 }
 
 
</script>
<html>
<head>
<title> Гарантийный талон </title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="jscript">

var DocId="#($G(ID))#";
var sessionid="#(sessionid)#";

function windowclose(KontrId)
{
    if(window.confirm("Вы уверены?"))window.close();
}

function ChooseKonragent(Obj)
{
    newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
    if(newItem==null){return false;}
    var newArr=newItem.split(InnerSplitter);
    Obj.innerText=newArr[1];
    Obj.Tag=newArr[0];
}

function Save()
{
    var xmlDoc = new ActiveXObject("Msxml2.DOMDocument.3.0");
    xmlDoc.documentElement= xmlDoc.createElement("RootElement");
    
    InsertXmlHeader(xmlDoc,"serial",serial.value,"%String")
    InsertXmlHeader(xmlDoc,"Dat",Dat.value,"%Date")
    InsertXmlHeader(xmlDoc,"SaleDate",SaleDate.value,"%Date")
    InsertXmlHeader(xmlDoc,"Property8550",Property8550.value,"%Date")
    InsertXmlHeader(xmlDoc,"Property5330",Kontr.Tag,"Common.Kontragent")
    InsertXmlHeader(xmlDoc,"tovar",tovar.value,"%String")
    InsertXmlHeader(xmlDoc,"Property9194",Property9194.value,"%String")
    InsertXmlHeader(xmlDoc,"Comment",Comment.value,"%String")
    InsertXmlHeader(xmlDoc,"Name",Name.value,"%String")
    
    var Answer=SendXml(DocId,"Common.Dictionary2",xmlDoc,sessionid);
    
    if((isNaN(Answer))||(Answer==""))
    {
        if (Answer=="") var Answer="Ошибка при сохранении гарантийного талона. Но ошибка не указана."
        alert(Answer)
    }
    else
    {
        window.close();
    }
}

function SerialKeyPress()
{
    if(cbNumbersEqual.checked)Name.value = serial.value;
}

function NameKeyPress()
{
    if(cbNumbersEqual.checked)serial.value = Name.value;
}

// Удалить эту запись
function Delete()
{
    if(!window.confirm("Вы действительно ходите удалить этот серийный номер?","Удаление серийного номера"))return;
    var ok = #server(Common.Dictionary2.Delete(DocId))#
    if(ok=="1")
    {
        alert("Запись успешно удалена.");
        window.close();
    }
    else
    {
        alert(ok);
    }
}
</script>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:100%;cursor:hand;}
</style>


</head>

<body>
<table width=100% class="LeftTop" cellspacing=0>
<tr>
    <td class=RightBottom colspan=4>
    <table cellspacing=0><tr>
        <td width="23%" class=RightBottom>Серийный номер</td>
        <td width="23%" class=RightBottom><input type=text id="serial" value="#($G(serial))#" onkeyup="SerialKeyPress()"></td>
        <td width="8%" class=RightBottom>&nbsp;<span style="display:#(displaycheckbox)#">
            <input type="checkbox" id="cbNumbersEqual" style="border:none;width:15px" #(displaycheckboxCHECKED)#> номера идентичны</span></td>
        <td width="23%" class=RightBottom>Гарантийный номер</td>
        <td width="23%" class=RightBottom><input type=text id=Name MAXLENGTH=50 value="#($G(Name))#" onkeyup="NameKeyPress()"></td>
    </table>
<tr>
    <td class=RightBottom>Дата создания</td>
    <td class=RightBottom><input type=text id="Dat" value="#($G(Dat,$ZD($H,4)))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)"> #($G(Tim))#</td>
    <td class=RightBottom>Дата выдачи</td>
    <td class=RightBottom><input type=text id="Property8550" value="#($G(Property8550))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)"></td>
<tr>
    <td class=RightBottom>Дата продажи</td>
    <td class=RightBottom><input type=text id="SaleDate" value="#($G(SaleDate))#" onclick="fnCalendar(this)" class="datar" onmouseout="UnPaint(this)" onmouseover="Paint(this)"> </td>
    <td class=RightBottom>&nbsp;</td>
    <td class=RightBottom>&nbsp;</td>
<tr>
    <td class=RightBottom>Контрагент</td>
    <td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class=Kontragent onclick="ChooseKonragent(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Kontr" Tag='#($G(Kontr))#'>#($G(KontrName))#</span></td>
    <td class=RightBottom>Модель изделия</td>
    <td class=RightBottom><input type=text id="tovar" value="#($G(tovar))#" ></td>
<tr>
    <td class=RightBottom>Актуальность</td>
    <td class=RightBottom colspan=3>
        <script language="cache" runat="server">
        w "<select id=""Property9194"">"
        w ##class(Docs.Action2).GetDisplaylistOptions($G(Property9194,2),"Common.Dictionary2||Property9194")
        w "</select>&nbsp;",!
        </script>
        </td>
<tr>
    <td class=RightBottom>Акт утилизации</td>
    <td class=RightBottom>#($G(Utiliz))#&nbsp;</td>
    <td class=RightBottom>Акт технического состояния</td>
    <td class=RightBottom>#($G(Act))#&nbsp;</td>
<tr>
    <td class=RightBottom>1 заявка</td>
    <td class=RightBottom>#($G(remont1))#&nbsp;</td>
    <td class=RightBottom>1 отчет</td>
    <td class=RightBottom>#($G(remont1otch))#&nbsp;</td>
<tr>
    <td class=RightBottom>2 заявка</td>
    <td class=RightBottom>#($G(remont2))#&nbsp;</td>
    <td class=RightBottom>2 отчет</td>
    <td class=RightBottom>#($G(remont2otch))#&nbsp;</td>
<tr>
    <td class=RightBottom>3 заявка</td>
    <td class=RightBottom>#($G(remont3))#&nbsp;</td>
    <td class=RightBottom>3 отчет</td>
    <td class=RightBottom>#($G(remont3otch))#&nbsp;</td>
<tr>
    <td class=RightBottom colspan=2>&nbsp;</td>
    <td class=RightBottom>4 отчет</td>
    <td class=RightBottom>#($G(remont4otch))#&nbsp;</td>
<tr><td colspan=4>Примечание к гарантийному талону:<br> <textarea id="Comment" rows=4 cols=80>#($G(Comment))#</textarea><br><br>
<script language="cache" runat="server">
w:$G(ClosedString)'="" "<tr><td colspan=4 class=RightBottom>Документ закрыт <i>"_ClosedString_"</i>"
</script>
</table>

<Table border=0 width="100%">
<tr>
    <td width="20%"></td>
    <td width="60%" align="center">
        <sklad:Button onclick="Save();" value="Сохранить" alt="Сохранить в базе результаты редактирования">
        <sklad:Button onclick="windowclose();" value="Отмена" alt="Отменить все изменения и закрыть окно">
    </td>
    <td width="20%" align="right">
        <sklad:Button onclick="Delete();" style="display:#(DeleteStyleDisplay)#" value="Удалить" alt="Удалить этот серийный номер">
    </td>
</tr>
</table>

</body>
</html>
]]></CSP>


<CSP name="GetFile.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 
 s file=%request.Get("file")
 s pwd =%request.Get("pwd")
 s FileAsHeader =%request.Get("FileAsHeader")
 
 if file'=""
 {
	 s fileExists=##class(%File).Exists(file)
 }
 
 if $G(fileExists),FileAsHeader
 {
 	set filename=$P(file,"\",$L(file,"\"))
 	set %response.ContentType = "application/text"
 	do %response.SetHeader("Content-Disposition","attachment; filename="_filename)
 	set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 }
 q 1
</script><script language="cache" runat="server">
 s Dat=$TR($ZD($H,3),"-",".")
 if (file="")||('fileExists)
 {
	s showForm=1
 }
 else
 {
	s showForm=0
 }
</script><CSP:IF Condition="showForm">
<html>
<head>
	 <script language="javascript" type="text/javascript">
	 function MakeFileName()
	 {
		 var FileFieldObj = document.getElementById("fileField");
		 var FolderFieldObj = document.getElementById("FolderField");
		 var DateFieldObj = document.getElementById("DateField");
		 var LogTypeObj = document.getElementById("LogType");
		 
		 FileFieldObj.value = FolderFieldObj.value + "Term-TERMINAL---" + DateFieldObj.value + "---" + LogTypeObj.value + "-.log";
		 //Term-TERMINAL---2011.12.01---CL-.log
	 }
	 </script>
</head>
<body>
	<h1>Терминал #($G(^RTSPR(1,"From")))#</h1>
	 <form>
	 Папка <input type="text" value="D:\BPS_FR_110502_R\Logs\" id="FolderField" size=30 onkeyup="MakeFileName()"> 
	 	дата <input type="text" value="#(Dat)#" id="DateField" onkeyup="MakeFileName()"> 
	 	устройство <select id="LogType" onchange="MakeFileName()">
	 		<option value="CL">Cache (CL)</option>
	 		<option value="CR">Card reader (CR)</option>
	 		<option value="FR">Фискальник (FR)</option>
	 		<option value="KS">Купюроприёмник (KS)</option>
	 		</select><br><br>
	 Файл <input type="text" name="file" id="fileField" size=100><br>
	 <input type="hidden" name="FileAsHeader" value="1">	
	 <input type="submit" value="Получить файл"> 
	 </form>
</body>
</html>
<CSP:ELSE><script language="cache" runat="server">
	 s len=30000
	 Set oFile = ##class(%File).%New(file)
	 Do oFile.Open("R")
	 f i=1:1 d  q:len<0
	 . s len=30000,str=oFile.Read(.len) 
	 . q:len<0
	 . w str,!
	 d oFile.Close()
</script></CSP:IF>]]></CSP>


<CSP name="GetGoodsImagesNames.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="Server">
 s id=%request.Get("id")
 if +id
 {
	 &sql(select Images into :images from Goods.Goods where id=:id)
	 if SQLCODE=100 w "Извините, указанный товар не найден." q
	 w "OK"_$C(9)_images
 }
 q
</script>]]></CSP>


<CSP name="Globalreuse.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<script language="JScript">
var znachen="";
var listItemText;
function globvalue(){
	var list = document.Globform.Glob;
	listItemText =list.options[list.selectedIndex].text; //получаю выбранный текст из select
	document.Globform.nameglob.value=listItemText;
	znachen="";
	ok=#server(Users.RenameGlobal.Rename(listItemText,znachen))#; // получаю значение глобальки
	document.Globform.globval.value=ok; //получаю значение переменной
}
function saveglob(){
	znachen=document.Globform.globval.value;
	listItemText=document.Globform.nameglob.value;
	ok=#server(Users.RenameGlobal.Rename(listItemText,znachen))#; // записываю ее	
	alert('ok');
		}
</script>
</head>
<body>
<form name="Globform" id="Globform">
<table><tr><td>
<script language="cache" runat="server">
w "<select name=""","Glob"""," ","ID=""","Glob""","onChange=""","globvalue()""",">"
s qwer=$Q(^UnRequiredFields("")),i=1  w "<option name=""",i,"""",">",qwer,"</OPTION>"
s i=i+1
f  s qwer=$Q(@qwer) q:qwer=""  d
 .w "<option name=""",i,"""",">",qwer,"</option>"
 .s i=i+1
w "</select>"
</script>
</td><td></td></tr>
<tr><td>название глобали:</td><td>&nbsp значение:</td></tr>
<tr><td>
<input type="text" name="nameglob" value="" size=59></td><td>=<input type="text" name="globval" size=10></td></tr>
<tr><td>
<input type="button" value="сохранить" onclick="saveglob()"></td><td></td></tr>
</form>
</body>
</html>
]]></CSP>


<CSP name="GoodCard.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 
 s login=$G(%session.Data("user"),0)
 i '+login s %response.ServerSideRedirect="norights.csp" 
 s Access9func=##class(Common.Rights).getrights($G(login,0),9)
 if 'Access9func s Func9Refuse="return;"
 
Quit 1
</script>
<script language="Cache" method="SetPermission" arguments="Goods:%String,Ban:%String" returntype="%String">
 d ##class(Docs.Action).BanGoodsForAll(Goods, Ban)
</script>
<script language="cache" runat="server">
 s GoodId=%request.Get("GoodId")
</script>
<html>
<head>

<title>Товар #(GoodId)#</title>

<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var GoodId="#(GoodId)#";
var GroupId="#(%request.Get("GroupId"))#";
if((GoodId=="")&&(GroupId==""))
	{
	alert("Создаётся новый товар, однако не указана товарная группа. Создание товара невозможно.");
	window.close()
	}
var sessionid="#($G(sessionid))#";

function ChooseTovar(Obj){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
var newArr=WinResult.split(InnerSplitter)
Obj.innerText=newArr[8];
Obj.Tag=newArr[0];
}

function startFun(){
#($G(Func9Refuse))#
var xmlDoc = new ActiveXObject("Msxml2.DOMDocument.3.0");
var RootElement = xmlDoc.createElement("RootElement");
xmlDoc.documentElement=RootElement;
var Properties= new Array("Name","Property5300","abbr","Property3609","EnglishName","codedetail","Size1","Weight","Property9469","Comment","Composition","Description","MaterialEng","CodeOKVED");
for(var i=0;i<Properties.length;i++){
	var elementValue=document.getElementById(Properties[i]).value;
	
	InsertXmlHeader(xmlDoc,Properties[i],elementValue,"%String");
}

var AllowToSendValue=document.getElementById("AllowToSend").checked ? "1":"0";	//значение чекбокса "отправлять контрагенту" 1-да, 2-нет
InsertXmlHeader(xmlDoc,"AllowToSend",AllowToSendValue,"%String")
InsertXmlHeader(xmlDoc,"Tovar",Tovar.Tag,"Goods.Goods")
var DocID=SendXml(GoodId,"Goods.Goods",xmlDoc,sessionid,"Docs.Action.SaveSingleGood");
if(isNaN(DocID)){alert(DocID)}
else{
	if(GoodId=="")
		{
		#server(Goods.GoodsAction.AddGoodToGroup(DocID,GroupId))#
		}
	returnValue=1;
	window.close();
	}
}

function SetPermission(Obj)
{
	if(GoodId=="")
	{
		alert("Пожалуйста, сохраните товар перед установкой ограничений");
		return;
	}
	
	if(Obj.checked) question="Установить всем контрагентам разрешение на использование ?";
	else question="Установить всем контрагентам запрет на использование ?";
	
	if(!window.confirm(question)) 
	{
		Obj.checked = !Obj.checked;
		return;
	}
	
	if(Obj.checked)
	{
		#call(..SetPermission(GoodId,0))#
	}
	else
	{
		#call(..SetPermission(GoodId,1))#
	}
}

</script>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:100%;cursor:hand;}
</style>

</head>

<body onkeypress="ManageWindow();">
<Table width=100% height=100%><tr valign=top><td>
<table width=100% class="LeftTop" cellspacing=0>
<script language="cache" runat="server">
 //значения по умолчанию
 s AllowToSend=1
 s GroupId = %request.Get("GroupId")
 
 //если указан ID товара
 if GoodId do
 . s GoodObj=##class(Goods.Goods).%OpenId(GoodId)
 . q:'$ISOBJECT(GoodObj)
 . f i="Name","Property5300","abbr","Property3609","EnglishName","codedetail","Size1","Weight","Property9469","Comment","ChangeDate","ChangeTime","Composition","Description","MaterialEng","CodeOKVED","AllowToSend" d
 . . s @i=$ZOBJPROPERTY(GoodObj,i)
 . d:$ISOBJECT(GoodObj.Tovar)
 . . s Tovar=GoodObj.Tovar.%Id()
 . . s TovarName=GoodObj.Tovar.FullName
 . if $ISOBJECT(GoodObj.ChangeUser) s ChangeUser=GoodObj.ChangeUser.Name
 . if ChangeDate s ChangeDate=$ZD(ChangeDate,4)
 . if ChangeTime s ChangeTime=$ZT(ChangeTime)
 else  do
 . &sql(select top 1 Goods->abbr , Goods->Property3609 into :Goodsabbr,:GoodsProperty3609 from Goods.GoodsGroup where Groups=:GroupId )
 . IF SQLCODE s (Goodsabbr,GoodsProperty3609)=""
 . ELSE  s Property3609=GoodsProperty3609, abbr=Goodsabbr
 
 if GoodId s LastSaveString= "<tr><td colspan=4 class=RightBottom>Последнее сохранение: <i>"_$G(ChangeUser)_" "_$G(ChangeDate)_" "_$G(ChangeTime)_"</i></td></tr>"
</script>
<tr>
	<td class=RightBottom>Наименование</td>
	<td class=RightBottom><input type=text id=Name MAXLENGTH=200 value="#($G(Name))#"></td>
	<td class=RightBottom>Номер по схеме</td>
	<td class=RightBottom><input type=text id=Property5300 MAXLENGTH=50 value="#($G(Property5300))#"></td>
	
</tr>

<tr>
	<td class=RightBottom>Аббревиатура модели</td>
	<td class=RightBottom><input type=text id=abbr MAXLENGTH=50 value="#($G(abbr))#"></td>
	<td class=RightBottom>Номер модели</td>
	<td class=RightBottom><input type=text id=Property3609 MAXLENGTH=50 value="#($G(Property3609))#"></td>
</tr>

<tr>
	<td class=RightBottom>Английское наименование</td>
	<td class=RightBottom><input type=text id=EnglishName MAXLENGTH=50 value="#($G(EnglishName))#"></td>
	<td class=RightBottom>Код детали</td>
	<td class=RightBottom><input type=text id=codedetail MAXLENGTH=50 value="#($G(codedetail))#"></td>
</tr>

<tr>
	<td class=RightBottom>Объем</td>
	<td class=RightBottom><input type=text id=Size1 MAXLENGTH=50 value="#($G(Size1))#"></td>
	<td class=RightBottom>Вес</td>
	<td class=RightBottom><input type=text id=Weight MAXLENGTH=50 value="#($G(Weight))#"></td>
</tr>

<tr>
	<td class=RightBottom>Категория</td>
	<td class=RightBottom><select name="Property9469" id=Property9469>
		#(##class(Docs.Action2).GetDisplaylistOptions($G(Property9469),"Goods.Goods||Property9469"))#
	</select></td>
	<td class=RightBottom>Код ТНВЭД</td>
	<td class=RightBottom><input type=text id="CodeOKVED" MAXLENGTH=50 value="#($G(CodeOKVED))#"></td>
</tr>
<tr>
	<td class=RightBottom>Товар которому принадлежит запчасть</td>
	<td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class=Kontragent onclick="ChooseTovar(this)" oncontextmenu="this.innerText='';this.Tag=''" id="Tovar" Tag="#($G(Tovar))#">#($G(TovarName))#</span></td>
	<td class=RightBottom>Материал (англ.)</td>
	<td class=RightBottom><input type=text id="MaterialEng" MAXLENGTH=50 value="#($G(MaterialEng))#"></td>
</tr>

<!--
<tr>
	<td class=RightBottom colspan=4>8
		<sklad:Button onclick="windowclose();" value="Отмена">
		<sklad:ButtonDiv onclick="windowclose();" value="Отмена">
	</td>
</tr>
-->

<tr>
	<td class=RightBottom>Разрешено использовать в заявках</td>
	<td class=RightBottom><input type="checkbox" id="AllowToSend" #($S(+AllowToSend:"CHECKED",1:""))# style="border:none" onclick="SetPermission(this)"> </td>
	<td class=RightBottom colspan=2><font color="darkgrey" size=-1>Внимание! Товар который запрещён к использованию, может быть разрешён в разделе "Ограничение использования запчастей контрагентами".</font></td>
</tr>

<tr>
	<td class=RightBottom>Комментарий</td>
	<td class=RightBottom colspan=3>
		<textarea name=Comment id=Comment style="width:100%">#($G(Comment))#</textarea>
	</td>
</tr>
<tr>
	<td class=RightBottom>Состав</td>
	<td class=RightBottom colspan=3>
		<textarea name="Composition" id="Composition" style="width:100%">#($G(Composition))#</textarea>
	</td>
</tr>
<tr>
	<td class=RightBottom>Подробное описание</td>
	<td class=RightBottom colspan=3>
		<textarea name="Description" id="Description" style="width:100%">#($G(Description))#</textarea>
	</td>
</tr>
#($G(LastSaveString))#

</table>
<input type="button" value="Изображения товара" onclick="showtovar('#(GoodId)#')">
</td></tr>
<tr valign=bottom><td align=center>

<CSP:IF CONDITION="Access9func=1">
	<sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#">
</CSP:IF>
<sklad:Button onclick="windowclose();" value="Отмена">
</td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="goods.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
 s Access9func=##class(Common.Rights).getrights(login,9)
 s GoodsGoodsVersion = ##class(Common.Common).GetCurrentDictVersion("Goods.Goods")
 q 1
</script><script runat="server" language="cache" method="wCatalogueOptions" arguments="commonGroup:%String,depot:%String" returnType="%String">
 s sql="Select ID,Name From Goods.Catalogue order by Main desc"
 s:commonGroup=0 sql="Select ID,Name From Goods.Catalogue Where depot=? order by Main desc"	
 
 s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
 d rs.Prepare(sql)
 if commonGroup=0 {
	 d rs.Execute(depot)
 } else {
	 d rs.Execute()
 }
 while rs.Next(){
	s id=$G(rs.Data("ID")),name=$G(rs.Data("Name"))
	w "<option value='",id,"'>",name,"</option>"
 }
 d rs.Close(),rs.%Close() k rs
 Q ""

</script><script language="Cache" method="StopGroupSend" arguments="GroupId:%String,AllowToSendValue:%String" returntype="%String">
 
 //запретить отправку этой группы контрагентам
 if $G(GroupId)="" q "Укажите, пожалуйста, товарную группу"
 
 s AllowToSendValue=+$g(AllowToSendValue)
 , ban='AllowToSendValue ;бан имеет ПРОТИВОПОЛОЖНОЕ по смыслу значение
 
 &sql( UPDATE Goods.Goods SET AllowToSend=:AllowToSendValue
	WHERE ID IN (SELECT Goods FROM Goods.GoodsGroup WHERE Groups=:GroupId) )
 
 #; для каждого товара в группе
 &sql(Declare ggrs Cursor For 
 	Select Goods Into :goods 
 	FROM Goods.GoodsGroup 
 	WHERE Groups=:GroupId
 ) 
 &sql(Open ggrs)
 for { 
 	&sql(FETCH ggrs) Q:SQLCODE'=0
 	d ##class(Docs.Action).BanGoodsForAll(goods, ban)
 } 
 &sql(Close ggrs)
 
 Quit 1
</script><html XMLNS:SKLADz XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<head><title>Склад :: Товары</title>
	<link href="js/css/cupertino/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="js/js/jquery-1.9.1.js"></script>
	<script src="js/js/jquery-ui-1.10.3.custom.js"></script>
	<script src="js/jquery.hotkeys.js"></script>

    
<link href="style.css" type="text/css" rel="stylesheet" />
<style type="text/css">
html {margin:0px;padding:0px;}
body {margin:0px;padding:2px 1px;}
* html button { overflow: visible; } /*тупой padding в кнопках IE*/
.pageTitle {width:100%;border-collapse:collapse;border:0px;padding:0px;margin:0px;border:0px;}
.pageTitle tr {background: #e9f3ff;}
.pageTitle tr td {border-bottom:1px #000066;}
.actions a { display:inline-block; padding:10px; margin: 1px; 
	border:1px solid #ccc; background:#eee; cursor:cross;
}
.actions a:hover { text-decoration:none;background:#fcfcfc;cursor:cross;}
.actions a:visited {}
label {color:#333;}

    .ui-autocomplete {
        max-height: 60px;
        overflow-y: auto;
        border: 1 solid black;
        /* prevent horizontal scrollbar */
        overflow-x: hidden;
    }
</style></head><body style="margin:8px">
<IE:DOWNLOAD id="downloader" STYLE="behavior:url(#default#download)" />
<!-- <TABLE cellSpacing=0 width="100%" celpadding="0">
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Товары</strong></TD>
<td style="width:80px;text-align:right;font-size:11px;color: #6e6e6e;" title="Текущая версия справочника товаров">v #(GoodsGoodsVersion)#</td>
</TABLE> -->

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Товары</strong></TD>
<td style="width:80px;text-align:right;font-size:11px;color: #6e6e6e;" title="Текущая версия справочника товаров">v #(GoodsGoodsVersion)#</td>
</TABLE>

<br><br>
<div class="actions">
		<a href="PriceGroups.csp">Ценовые группы товаров</a>
		<a href="Reserves2.csp">Резервы</a>
		<a href="Brak.csp">Некондиция</a>
		<a title="Привязать запчасть к модели" href="Attach2Model.csp">Запчасти и их модели</a>
		<a href="Serials.csp" title="Открыть страницу управления серийными номерами">Cерийные номера</a>
		<a href="csp.GoodsRights.cls" title="Страница позволяющая установить ограничение в использовании запчастей контрагентами в заявках">Ограничение использования запчастей контрагентами</a>
</div>

<table style="width:100%" id="TopTable" ><tr>
 <td style="vertical-align:top;width:50%"> 
   <table cellpadding=3 cellspacing=0><tr><td>
  <label for="Catalogues" >Классификатор:</label><br>
  <select id="Catalogues" onchange="LoadTree()">
	  <server>
	  s depot=$G(%session.Data("depot"))
	  s commonGroups=$G(%session.Data("commongroups"))
	  d ..wCatalogueOptions(commonGroups,depot)
	  </server>
  </select>
  <td valign="bottom">
  	Поиск<br>
  	<input id="tags" />
<tr>
  	<td valign="top">
  		<SKLADz:treeview id="GroupsTree" width=300 height=160 ImagesPath="#(%session.Data("ImagesPath"))#" onDownloadCmpl="GroupsTreeDnldCmpl()" /> 
  	<td valign="top">
  		&nbsp;
  </table>
  <table width="350"><tr><td>
  <sklad:LittleButton name="new" id="newgrup" onclick="addGroup(0)" alt="Новая группа">
  <sklad:LittleButton name="new+" id="newSubgrup" onclick="addGroup(1)" alt="Новая подгруппа">
  <sklad:LittleButton name="edit" id="EditGroupName" onclick="EditGroupNameFn()" alt="Редактирование названия группы">
  <sklad:LittleButton name="del+" id="del22" onclick="cleargrup()" alt="Очистить группу">
  <sklad:LittleButton name="history" id="hist22" onclick="fillgrup()" alt="Заполнить группу">
  <sklad:LittleButton name="PrintPrice" id="PrintPriceImg" onclick="PrintPriceFunc('')" alt="Вывести прайслист">
  <sklad:LittleButton name="PrintPriceColor" id="PrintPriceImg2" onclick="PrintPriceFunc('Images')" alt="Вывести прайслист c изображениями">
  <sklad:LittleButton name="ostatki" id="PrintStorage" onclick="PrintStorageFn()" alt="Вывести остатки">
  <sklad:LittleButton name="StopSend" id="StopAllowToSend" onclick="AllowToSendFn(0,'Группа больше не будет использоваться в заявках')" alt="Не использовать группу в заявках">
  <sklad:LittleButton name="OkSend" id="OkAllowToSend" onclick="AllowToSendFn(1,'Группа будет использоваться в заявках')" alt="Использовать группу в заявках">
  </td><td>
  <sklad:LittleButton name="del" id="delgrup" onclick="delGroup()" alt="Удалить группу"><br>
  </td></tr></table>
 </td>
 <td valign=top width=50% valign="middle" align="center">
<!-- диалог установки новой цены -->
<div id="NewGoodsPriceDialog" title="Установка новой цены" style="display:none;border:1 solid gray;margin:10px;margin-top:40px;padding:15px">
	<p align="left"><b>Установка новой цены</b></p>
	<Table>
		<tr><td colspan=2 id="NewGoodsPriceName">
		</tr>
		<tr>
			<Td>Цена
			<td><input type="text" size=5 id="GoodsPriceValue">
		</tr>
		<tr>
			<td>Тип цены
			<td><select id="GoodsPriceType">#(##class(Docs.Action2).GetClassValuesOptions("1","Common.Dictionary6",,,0))#</select>
		</tr>
		<tr>
			<td colspan=2 aligh="right">
				<button onclick="SaveGoodsPrice()">Сохранить</button>
				<button onclick="CloseGoodsPriceDialog()">Отмена</button>
				
		</tr>
	</table>
</div>
  </td>
</tr>
<tr>
 <td colspan=2>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
   <fieldset style=""><legend>Товары</legend>
  <!--
  <sklad:ListView id="LV" style="width:100%;height:200;"  >
  -->
 <OBJECT id="LV" classid=clsid:BDD1F04B-858B-11D1-B16A-00C0F0283628 style="width:100%;height:200;behavior:url('#default#download')" codebase="Cab\MSComCtl.CAB" >
<PARAM NAME="View" VALUE="3">
<PARAM NAME="Appearance" VALUE="1">
<PARAM NAME="FullRowSelect" VALUE="True">
<PARAM NAME="MultiSelect" VALUE="True">
<PARAM NAME="GridLines" VALUE="True">
<PARAM NAME="LabelEdit" VALUE="1">
</OBJECT>

  <Table width=100%><tr><td width="60%" >
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="new" id="newtov" onclick="addTovar()" alt="Новый товар">
  <sklad:LittleButton name="edit" id="edittov" onclick="editTovar()" alt="Редактировать товар">
  <sklad:LittleButton name="edit" id="edittov2" onclick="editTovar2()" alt="Редактировать товар в новой форме ( CTRL+q )">
</CSP:IF>
  <sklad:LittleButton name="card" id="cardtov" onclick="OpenCard()" alt="Карточка товара">
  <sklad:LittleButton name="new+" id="newGprop" onclick="AddProp2()" alt="Новое основное свойство">
  <sklad:LittleButton name="del+" id="delGprop" onclick="DelProp()" alt="Удалить основное свойство">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="copy" id="copy" onclick="cuttov()" alt="Пометить для копирования">
  <sklad:LittleButton name="paste" id="paste" onclick="pastetov()" alt="Вставить товары из буфера">
  <sklad:LittleButton name="history" id="buf" onclick="tovbuf()" alt="Товары в буфере обмена">
</CSP:IF>
  <sklad:LittleButton name="price" id="price" onclick="tovprice()" alt="Цены товара">
  <sklad:LittleButton name="pricePlus" id="price2" onclick="OpenGoodsPriceDialog()" alt="Установить цену товара">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="goinside" id="btnMuiltipleEdit" onclick="fnMuiltipleEdit()" alt="Редактировать список товаров">
</CSP:IF>
  <sklad:LittleButton name="find" id="btnFindGood" onclick="fnFindGood()" alt="Поиск товаров">
  </td>
  <td align=right width="40%">
  
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="del" id="deltov" onclick="DelTovar()" alt="Удалить товар">
</CSP:IF>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <span title="Обновление таблицы после каждого сохранения товара (если отключить, то редактировать товары можно будет быстрее)">
  	<label for="makeShowDict">Поддерживать таблицу в актуальном состоянии</label>
  	<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
  </span>
  </td></tr></table>
</fieldset></td>
</tr>
</table>
<script language="jscript" src="common.js"></script>
<script language="javascript" type="text/javascript" src="js/pages/goods.js"></script>
<script language="jscript">
//var $=function(id){ return document.getElementById(id); }

var depot="#($G(%session.Data("depot")))#"
;var commongroups="#($G(%session.Data("commongroups")))#"
var sessionid="#(%session.SessionId)#";
var SelectedGroupCode="";
var GoodsListView="LV";  //id элемента ListView с товарами
var ColCode="";
var where="";
var CurrentDate = "#($ZD($H,4))#";

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}

function LoadTree()
{
	var CurrentCatalogueId = $("#Catalogues").val();
	GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+#(%session.Data("depot"))#+'","'+CurrentCatalogueId+'"');
	$( "#tags" ).autocomplete( "option", "source", "JQGoods.csp?Command=Groups&Cat="+CurrentCatalogueId );
}

//Показать товары в ListView
function ShowTovars(where1){
if(!makeShowDict.checked)return
LV.Sorted =false;

//wind=window.open("wait.csp","null","height=100,width=200,toolbar=no,menubar=no,location=no,titlebar=no")
fields=ShowColHeads(GoodsListView,"Goods->")
where="Groups='"+GroupsTree.NodeID+"'";
if(ReturnSpace(where1)!="")where=where+" and "+where1
LV.startDownload('Data.csp?class=Goods.GoodsGroup&fields=Goods->ID,'+fields+"&where="+where, ShowTovars1);
}
function ShowTovars1(text){
ListViewAddItems(GoodsListView,text);

//wind.close();
}

//Обработка клика на ListView
function LVItemClick(Item){
}

//Обработка клика на узле дерева товарных групп
function Click(){
ShowTovars();
}

//Загрузка колонок ListView
function LoadList1(){
downloader.startDownload('ListData.csp', LoadList);
}

function LoadList(text){
LVAddColumns(text,GoodsListView);
ShowTovars();
}


//Добавить группу
function addGroup(Sub){
//Sub=1 означает что желаем создать подгруппу
Code=GroupsTree.NodeCode;
if(Code==""&Sub==1){alert("Не выбрана группа для создания подгруппы");return}
Catalogue=Catalogues.value;
Name=window.showModalDialog("AddGoodsProp.csp","Наименование группы","center:yes;status:no;dialogHeight:200px")
if(Name==null)return false;
ok=#server(Goods.GroupAction.createGroup(Catalogue,Name,Code,Sub))#
if (!isNaN(ok)){LoadTree();}
else {alert(ok);}
}

//Удалить группу
function delGroup(){
Code=GroupsTree.NodeCode;
if(Code==""){alert("Не выбрана группа");return false;}
GroupId=GroupsTree.NodeID;
ok=window.confirm("Удалить группу ?")
if(ok==false)return false;
ok=#server(Goods.GroupAction.DelGroup(Catalogues.value,Code,GroupId))#
if (ok!=1){alert(ok);return false;}
LoadTree();
}

//Создать основное свойство
function AddProp2(){
ok=window.showModalDialog("AddGoodsProp2.csp","","cener:yes;status:no;dialogHeight:300px;resizable:yes")
if(ok==1){LoadList1();return false;}
if(ok==null){return false;}
alert(ok)
}

//Удалить основное свойство
function DelProp(){
ok=window.showModalDialog("DelGoodsProp.csp","","cener:yes;status:no;dialogHeight:350px;dialogWidth:300px;resizable:yes")
if(ok==1){LoadList1();return false;}
if(ok==null){return false;}
alert(ok)
}

//Добавить товар
function addTovar(Goods,CspFile)
{
	//установим переменные
	Goods=ReturnSpace(Goods);
	GroupId=GroupsTree.NodeID;
	GroupCode=GroupsTree.NodeCode;
	if(GroupId==""){alert("Не выбрана группа");return false;}
	Name=GroupsTree.NodeCaption;
	var dialogHeight=600;
	
	//проверим логическую возможность создавать товар	
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа содержит подгруппы, она не может содержать товары. Выберете группу, которая не содержит подгрупп."); return; }
	
	//если это создание нового товара
	if(ReturnSpace(Goods)=="")
	{
		if(window.confirm("Использовать новую форму?")){var CspFile="GoodCard.csp?GroupId="+GroupId;var dialogHeight=400;}
		else{var CspFile="AddTovar.csp"}
	}
	
	ok=window.showModalDialog(CspFile,Catalogues.value+InnerSplitter+GroupId+InnerSplitter+GroupCode+InnerSplitter+Goods+InnerSplitter+Name,"center:yes;status:no;dialogHeight:"+dialogHeight+"px;dialogWidth:800px;resizable:yes")
	if(ok==1){ShowTovars()}
}

//Удалить товар
function DelTovar()
{
	GoodsId=SelectedItemProperty(GoodsListView,"Tag")
	if(GoodsId==""){alert("Не выбран товар");return false;}
	if(!window.confirm("Удалить "+document.getElementById(GoodsListView).SelectedItem+"?"))return false;
	ok=#server(Goods.GoodsAction.DeleteGoods(GoodsId))#
	if(ok==1){ShowTovars()}
	else{alert(ok)}
}

//Редактировать товар
function editTovar()
{
	GoodsId=SelectedItemProperty(GoodsListView,'Tag');
	addTovar(GoodsId,"AddTovar.csp");
}

//Редактировать товар в новой форме
function editTovar2(){
var GoodsId=SelectedItemProperty(GoodsListView,'Tag');
addTovar(GoodsId,"GoodCard.csp?GoodId="+GoodsId);
}


//Открыть карточку товара
function OpenCard(){
GoodsId=SelectedItemProperty(GoodsListView,"Tag");
GoodsName=SelectedItemProperty(GoodsListView,'Text');
if(GoodsId=="")return

ok=window.showModelessDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath="+GroupsTree.ParentNames,GoodsId+InnerSplitter+GoodsName,"center:yes;status:no;dialogHeight:600px;dialogWidth:"+($(document).width())+"px;dialogLeft:0;resizable:yes");



if(ok==1){ShowTovars()}
}

function gg(){
if(ColCode=="")return false;
var where = ColCode+" %STARTSWITH '"+fldval.value+"'";
if(fldval.value=="")where="";
ShowTovars(where);
}

function colclick(qq){
	namfld.innerText=qq.Text;
	ColCode="Goods->"+qq.Key;
	if(LV.SortOrder==0){LV.SortOrder=1;}
	else{LV.SortOrder=0;}
	LV.SortKey = qq.Index - 1;
	LV.Sorted =true;

}

function cuttov(){
var tovs=getselected();
//alert(tovs)
if(tovs==""){alert("Ничего не выбрано");return false;}
ok=#server(Goods.CardAction.SaveCard2('#(%session.Data("user"))#',tovs,"Goods.Goods"))#
if(isNaN(ok))alert(ok);
else(alert("Выбранные товары помечены для перемещения"))
}

function pastetov(){
if(!window.confirm("Вставить товары из буфера в группу "+GroupsTree.NodeCaption+"?"))return false;
ok=#server(Goods.GoodsAction.FromCardInGroup('#(%session.Data("user"))#',GroupsTree.NodeID))#
if(isNaN(ok)){alert(ok)}
else{ShowTovars();}
}

//получить ID и (опционально) текст выбранных строк
function getselected(Text)
{
	var textString=""
	var count=LV.ListItems.Count;
	var subitemsCount=LV.ListItems.Item(1).ListSubItems.Count;
	var SubItemsString="";	//текст в SubItems
	
	for (i = 1; i <= count; i++){
	string = "";
	if(LV.ListItems.Item(i).selected)
	{
		SubItemsString = "";
		
		
		if (Text && (subitemsCount>1))
		{
			for (z = 1; z <= subitemsCount; z++)
			{
				SubItemsString = SubItemsString + LV.ListItems.Item(i).ListSubItems.Item(z).Text+InnerSplitter;
			}
		}

		
		string=LV.ListItems.Item(i).Tag;
		textString=textString+string+InnerSplitter + SubItemsString;
	}}
return textString;
}

//открыть окно с товарами в буфере обмена
function tovbuf(){
window.showModalDialog("tovbuf.csp","","center:yes;status:no;dialogHeight:430px;dialogWidth:700px;resizable:yes")
}

$(document).ready(function () {
	
	$("#GoodsPriceValue").bind('keydown', 'return',function (evt){ SaveGoodsPrice(); return false; });
    $("#GoodsPriceValue").bind('keydown', 'esc',function (evt){ CloseGoodsPriceDialog(); return false; });

	$("#GoodsPriceType").bind('keydown', 'return',function (evt){ SaveGoodsPrice(); return false; });
    $("#GoodsPriceType").bind('keydown', 'esc',function (evt){ CloseGoodsPriceDialog(); return false; });
	
	Init();
});

// запретить отправку этой группы контрагенту
function AllowToSendFn(Allow,message)
{	
	var GroupName=GroupsTree.NodeCaption;	//название текущей группы
	var GroupId=GroupsTree.NodeID;			//код текущей группы
	
	if (!window.confirm(GroupName + "\n" + message + " ?"))return;
	if(GroupId==""){ alert("Выберете, пожалуйста группу"); return;}
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа не содержит товары/запчасти, выберете группу, которая содержит товары/запчасти"); return; }
	var ok=#server(..StopGroupSend(GroupId,Allow))#
	if (isNaN(ok)) { alert(ok); }
	else { alert(message); }
}

//очистить группу
function cleargrup(){
if(window.confirm("Вы уверены?")){
	var GroupId=GroupsTree.NodeID;
	//var ok=#server(Goods.GoodsAction.cleargrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{ShowTovars();}
}
}
 
//вставить в группу все бесхозные товары
function fillgrup(){
	var GroupId=GroupsTree.NodeID;
	//var ok=#server(Goods.GoodsAction.fillgrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{ShowTovars();}	
}

function EditGroupNameFn()
{
	var GroupId=GroupsTree.NodeID;
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var NewName=window.prompt("Введите новое название группы",GroupsTree.NodeCaption);
	if(!NewName)return;
	if(NewName==""){alert("Пустные имена группа не допустимы.");return false;}
	var ok=#server(Goods.GroupAction.RenameGroup(GroupId,NewName))#
	if(isNaN(ok)){alert(ok)}
	else{LoadTree();SelectedGroupCode=GroupCode;}
}

</script>

</body>
</html>
]]></CSP>


<CSP name="goodsBackupTask23.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
 s Access9func=##class(Common.Rights).getrights(login,9)
 s GoodsGoodsVersion = ##class(Common.Common).GetCurrentDictVersion("Goods.Goods")
 q 1
</script><script runat="server" language="cache" method="wCatalogueOptions" arguments="commonGroup:%String,depot:%String" returnType="%String">
 s sql="Select ID,Name From Goods.Catalogue order by Main desc"
 s:commonGroup=0 sql="Select ID,Name From Goods.Catalogue Where depot=? order by Main desc"	
 
 s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
 d rs.Prepare(sql)
 if commonGroup=0 {
	 d rs.Execute(depot)
 } else {
	 d rs.Execute()
 }
 while rs.Next(){
	s id=$G(rs.Data("ID")),name=$G(rs.Data("Name"))
	w "<option value='",id,"'>",name,"</option>"
 }
 d rs.Close(),rs.%Close() k rs
 Q ""

</script>
<script language="Cache" method="StopGroupSend" arguments="GroupId:%String,AllowToSendValue:%String" returntype="%String">
 //запретить отправку этой группы контрагентам
 if $G(GroupId)="" q "Укажите, пожалуйста, товарную группу"
 &sql( UPDATE Goods.Goods SET AllowToSend=:AllowToSendValue
WHERE ID IN (SELECT Goods FROM Goods.GoodsGroup WHERE Groups=:GroupId) )
 IF SQLCODE q "Извините. Ошибка при выполнении запроса SQLCODE="_SQLCODE
 Quit 1
</script><html XMLNS:SKLADz XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<head><title>Склад :: Товары</title>
<link href="style.css" type="text/css" rel="stylesheet" />
<style type="text/css">
html {margin:0px;padding:0px;}
body {margin:0px;padding:2px 1px;}
* html button { overflow: visible; } /*тупой padding в кнопках IE*/
.pageTitle {width:100%;border-collapse:collapse;border:0px;padding:0px;margin:0px;border:0px;}
.pageTitle tr {background: #e9f3ff;}
.pageTitle tr td {border-bottom:1px #000066;}
.actions a { display:inline-block; padding:10px; margin: 1px; 
	border:1px solid #ccc; background:#eee; 
}
.actions a:hover { text-decoration:none;background:#fcfcfc;}
.actions a:visited {}
label {color:#333;}

</style></head><body>
<IE:DOWNLOAD id="downloader" STYLE="behavior:url(#default#download)" />
<table class="pageTitle" style=""><tr>
<td style="width:20px;"><img alt="Обновить раздел" src="images/refresh.png" onclick="window.location.reload()"></td>
<td style="text-indent:40px;font:16px Arial;" >Товары</td>
<td style="width:80px;text-align:right;font-size:11px;color: #6e6e6e;" title="Текущая версия справочника товаров">v #(GoodsGoodsVersion)#</td>
</table>
<div class="actions">
		<a href="PriceGroups.csp">Ценовые группы товаров</a>
		<a href="Reserves2.csp">Резервы</a>
		<a href="Brak.csp">Некондиция</a>
		<a title="Привязать запчасть к модели" href="Attach2Model.csp">Запчасти и их модели</a>
		<a href="Serials.csp" title="Открыть страницу управления серийными номерами">Cерийные номера</a>
		<a href="csp.GoodsRights.cls" title="Страница позволяющая установить ограничение в использовании запчастей контрагентами в заявках">Ограничение использования запчастей контрагентами</a>
</div>

<table style="width:100%"><tr>
 <td style="vertical-align:top;width:50%"> 
  <label for="Catalogues" >Классификатор:</label>
  <select id="Catalogues" onchange="LoadTree()">
  <server>
  s depot=$G(%session.Data("depot"))
  s commonGroups=$G(%session.Data("commongroups"))
  d ..wCatalogueOptions(commonGroups,depot)
  </server>
  
  </select>
  <br/>
  <SKLADz:treeview id="GroupsTree" width=300 height=160 ImagesPath="#(%session.Data("ImagesPath"))#" onDownloadCmpl="GroupsTreeDnldCmpl()" />
  <table width="350"><tr><td>
  <sklad:LittleButton name="new" id="newgrup" onclick="addGroup(0)" alt="Новая группа">
  <sklad:LittleButton name="new+" id="newSubgrup" onclick="addGroup(1)" alt="Новая подгруппа">
  <sklad:LittleButton name="edit" id="EditGroupName" onclick="EditGroupNameFn()" alt="Редактирование названия группы">
  <sklad:LittleButton name="del+" id="del22" onclick="cleargrup()" alt="Очистить группу">
  <sklad:LittleButton name="history" id="hist22" onclick="fillgrup()" alt="Заполнить группу">
  <sklad:LittleButton name="PrintPrice" id="PrintPriceImg" onclick="PrintPriceFunc('')" alt="Вывести прайслист">
  <sklad:LittleButton name="PrintPriceColor" id="PrintPriceImg2" onclick="PrintPriceFunc('Images')" alt="Вывести прайслист c изображениями">
  <sklad:LittleButton name="ostatki" id="PrintStorage" onclick="PrintStorageFn()" alt="Вывести остатки">
  <sklad:LittleButton name="StopSend" id="StopAllowToSend" onclick="AllowToSendFn(0,'Группа больше не будет использоваться в заявках')" alt="Не использовать группу в заявках">
  <sklad:LittleButton name="OkSend" id="OkAllowToSend" onclick="AllowToSendFn(1,'Группа будет использоваться в заявках')" alt="Использовать группу в заявках">
  </td><td>
  <sklad:LittleButton name="del" id="delgrup" onclick="delGroup()" alt="Удалить группу"><br>
  </td></tr></table>
 </td>
 <td valign=top width=50%>
  <fieldset style="width:200;"><legend id="TovarName"></legend>
  <SKLADz:treeview id="PropsTree" width=300 height=160 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" />
  </fieldset>
  <table width="350"><tr><td>
  <sklad:LittleButton name="new" id="newprop" onclick="AddProp(0)" alt="Новое свойство">
  <sklad:LittleButton name="new+" id="newSubprop" onclick="AddProp(1)" alt="Новое свойство в существующей группе">
  </td><td>
  <sklad:LittleButton name="del" id="delprop" onclick="DelDopProp();" alt="Удалить свойство">
  </td></tr>
  </table>
  </td>
</tr>
<tr>
 <td colspan=2>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
   <fieldset style=""><legend>Товары</legend>
  <!--
  <sklad:ListView id="LV" style="width:100%;height:200;"  >
  -->
 <OBJECT id="LV" classid=clsid:BDD1F04B-858B-11D1-B16A-00C0F0283628 style="width:100%;height:200;behavior:url('#default#download')" codebase="Cab\MSComCtl.CAB" >
<PARAM NAME="View" VALUE="3">
<PARAM NAME="Appearance" VALUE="1">
<PARAM NAME="FullRowSelect" VALUE="True">
<PARAM NAME="MultiSelect" VALUE="True">
<PARAM NAME="GridLines" VALUE="True">
<PARAM NAME="LabelEdit" VALUE="1">
</OBJECT>

  <Table width=100%><tr><td width="60%" >
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="new" id="newtov" onclick="addTovar()" alt="Новый товар">
  <sklad:LittleButton name="edit" id="edittov" onclick="editTovar()" alt="Редактировать товар">
  <sklad:LittleButton name="edit" id="edittov2" onclick="editTovar2()" alt="Редактировать товар в новой форме ( CTRL+q )">
</CSP:IF>
  <sklad:LittleButton name="card" id="cardtov" onclick="OpenCard()" alt="Карточка товара">
  <sklad:LittleButton name="new+" id="newGprop" onclick="AddProp2()" alt="Новое основное свойство">
  <sklad:LittleButton name="del+" id="delGprop" onclick="DelProp()" alt="Удалить основное свойство">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="copy" id="copy" onclick="cuttov()" alt="Пометить для копирования">
  <sklad:LittleButton name="paste" id="paste" onclick="pastetov()" alt="Вставить товары из буфера">
  <sklad:LittleButton name="history" id="buf" onclick="tovbuf()" alt="Товары в буфере обмена">
</CSP:IF>
  <sklad:LittleButton name="price" id="price" onclick="tovprice()" alt="Цены товара">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="goinside" id="btnMuiltipleEdit" onclick="fnMuiltipleEdit()" alt="Редактировать список товаров">
</CSP:IF>
  <sklad:LittleButton name="find" id="btnFindGood" onclick="fnFindGood()" alt="Поиск товаров">
  </td>
  <td align=right width="40%">
  
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="del" id="deltov" onclick="DelTovar()" alt="Удалить товар">
</CSP:IF>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <span title="Обновление таблицы после каждого сохранения товара (если отключить, то редактировать товары можно будет быстрее)">
  	<label for="makeShowDict">Поддерживать таблицу в актуальном состоянии</label>
  	<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
  </span>
  </td></tr></table>
</fieldset></td>
</tr>
</table>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var $=function(id){return document.getElementById(id);}
var $bind=("v"=="\v")?function(o,e,h){o.attachEvent("on"+e,h);}:function(o,e,h){o.addEventListener(e,h,false);}

var depot="#($G(%session.Data("depot")))#"
;var commongroups="#($G(%session.Data("commongroups")))#"
;var sessionid="#(%session.SessionId)#";
var SelectedGroupCode="";
var GoodsListView="LV";  //id элемента ListView с товарами
var ColCode="";
var where="";

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}

function LoadTree(){
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+#(%session.Data("depot"))#+'","'+Catalogues.value+'"')	
}

//Показать товары в ListView
function ShowTovars(where1){
if(!makeShowDict.checked)return
LV.Sorted =false;

//wind=window.open("wait.csp","null","height=100,width=200,toolbar=no,menubar=no,location=no,titlebar=no")
fields=ShowColHeads(GoodsListView,"Goods->")
where="Groups='"+GroupsTree.NodeID+"'";
if(ReturnSpace(where1)!="")where=where+" and "+where1
LV.startDownload('Data.csp?class=Goods.GoodsGroup&fields=Goods->ID,'+fields+"&where="+where, ShowTovars1);
}
function ShowTovars1(text){
ListViewAddItems(GoodsListView,text);
LoadPropTree();
//wind.close();
}

//Обработка клика на ListView
function LVItemClick(Item){
LoadPropTree();
}

//Обработка клика на узле дерева товарных групп
function Click(){
ShowTovars();
}

//Загрузка колонок ListView
function LoadList1(){
downloader.startDownload('ListData.csp', LoadList);
}

function LoadList(text){
LVAddColumns(text,GoodsListView);
ShowTovars();
}

//Заполнить дерево дополнительных свойств товара
function LoadPropTree(){
TovarName.innerText=SelectedItemProperty(GoodsListView,'Text')
Goods=SelectedItemProperty(GoodsListView,'Tag')
Group=GroupsTree.NodeCode;
LoadPropTree2("PropsTree",Goods,Group,Catalogues.value)
}

//Добавить группу
function addGroup(Sub){
//Sub=1 означает что желаем создать подгруппу
Code=GroupsTree.NodeCode;
if(Code==""&Sub==1){alert("Не выбрана группа для создания подгруппы");return}
Catalogue=Catalogues.value;
Name=window.showModalDialog("AddGoodsProp.csp","Наименование группы","center:yes;status:no;dialogHeight:200px")
if(Name==null)return false;
ok=#server(Goods.GroupAction.createGroup(Catalogue,Name,Code,Sub))#
if (!isNaN(ok)){LoadTree();}
else {alert(ok);}
}

//Удалить группу
function delGroup(){
Code=GroupsTree.NodeCode;
if(Code==""){alert("Не выбрана группа");return false;}
GroupId=GroupsTree.NodeID;
ok=window.confirm("Удалить группу ?")
if(ok==false)return false;
ok=#server(Goods.GroupAction.DelGroup(Catalogues.value,Code,GroupId))#
if (ok!=1){alert(ok);return false;}
LoadTree();
}

//Добавить свойство к дереву дополнительных свойств
function AddProp(Sub){
PropName=window.showModalDialog("AddGoodsProp.csp","Наименование свойства","cener:yes;status:no;dialogHeight:200px")
if(PropName==null)return false;
Code=PropsTree.NodeCode;
if((Sub==1)&(Code=="")){alert("Не указано свойство-родитель");return false;}
  if(window.confirm("Общее свойство")){GroupCode=""}
  else{
     GroupCode=GroupsTree.NodeCode;
     if(GroupCode==""){alert("Не выбрана группа");return false;}
  }
ok=#server(Goods.GoodsAction.CreateProp(Catalogues.value,GroupCode,PropName,Code,Sub))#
if (ok==1){LoadPropTree();}
else {alert(ok);}
}

//Удалить дополнительное свойство
function DelDopProp(){
	ParamID=PropsTree.NodeID;
	if(ParamID=="")return false;
	if(!window.confirm("Внимание!\nУдаление свойства приведёт к потере данных хранящихся в этом свойстве у ВСЕХ товаров склада #(%session.Data("depotName"))#. \nВы хотите удалить?"))return false;
	ok=#server(Goods.GoodsAction.DeleteGoodsParam(ParamID))#
	if (ok==1){LoadPropTree();}
	else {alert(ok);}
}

//Создать основное свойство
function AddProp2(){
ok=window.showModalDialog("AddGoodsProp2.csp","","cener:yes;status:no;dialogHeight:300px;resizable:yes")
if(ok==1){LoadList1();return false;}
if(ok==null){return false;}
alert(ok)
}

//Удалить основное свойство
function DelProp(){
ok=window.showModalDialog("DelGoodsProp.csp","","cener:yes;status:no;dialogHeight:350px;dialogWidth:300px;resizable:yes")
if(ok==1){LoadList1();return false;}
if(ok==null){return false;}
alert(ok)
}

//Добавить товар
function addTovar(Goods,CspFile)
{
	//установим переменные
	Goods=ReturnSpace(Goods);
	GroupId=GroupsTree.NodeID;
	GroupCode=GroupsTree.NodeCode;
	if(GroupId==""){alert("Не выбрана группа");return false;}
	Name=GroupsTree.NodeCaption;
	var dialogHeight=600;
	
	//проверим логическую возможность создавать товар	
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа содержит подгруппы, она не может содержать товары. Выберете группу, которая не содержит подгрупп."); return; }
	
	//если это создание нового товара
	if(ReturnSpace(Goods)=="")
	{
		if(window.confirm("Использовать новую форму?")){var CspFile="GoodCard.csp?GroupId="+GroupId;var dialogHeight=400;}
		else{var CspFile="AddTovar.csp"}
	}
	
	ok=window.showModalDialog(CspFile,Catalogues.value+InnerSplitter+GroupId+InnerSplitter+GroupCode+InnerSplitter+Goods+InnerSplitter+Name,"center:yes;status:no;dialogHeight:"+dialogHeight+"px;dialogWidth:800px;resizable:yes")
	if(ok==1){ShowTovars()}
}

//Удалить товар
function DelTovar(){
GoodsId=SelectedItemProperty(GoodsListView,"Tag")
if(GoodsId==""){alert("Не выбран товар");return false;}
if(!window.confirm("Удалить "+document.getElementById(GoodsListView).SelectedItem+"?"))return false;
ok=#server(Goods.GoodsAction.DeleteGoods(GoodsId))#
if(ok==1){ShowTovars()}
else{alert(ok)}
}

//Редактировать товар
function editTovar(){
GoodsId=SelectedItemProperty(GoodsListView,'Tag');
addTovar(GoodsId,"AddTovar.csp");
}

//Редактировать товар в новой форме
function editTovar2(){
var GoodsId=SelectedItemProperty(GoodsListView,'Tag');
addTovar(GoodsId,"GoodCard.csp?GoodId="+GoodsId);
}


//Открыть карточку товара
function OpenCard(){
GoodsId=SelectedItemProperty(GoodsListView,"Tag");
GoodsName=SelectedItemProperty(GoodsListView,'Text');
if(GoodsId=="")return
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath="+GroupsTree.ParentNames,GoodsId+InnerSplitter+GoodsName,"center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
if(ok==1){ShowTovars()}
}

function gg(){
if(ColCode=="")return false;
var where = ColCode+" %STARTSWITH '"+fldval.value+"'";
if(fldval.value=="")where="";
ShowTovars(where);
}

function colclick(qq){
	namfld.innerText=qq.Text;
	ColCode="Goods->"+qq.Key;
	if(LV.SortOrder==0){LV.SortOrder=1;}
	else{LV.SortOrder=0;}
	LV.SortKey = qq.Index - 1;
	LV.Sorted =true;

}

function cuttov(){
var tovs=getselected();
//alert(tovs)
if(tovs==""){alert("Ничего не выбрано");return false;}
ok=#server(Goods.CardAction.SaveCard2('#(%session.Data("user"))#',tovs,"Goods.Goods"))#
if(isNaN(ok))alert(ok);
else(alert("Выбранные товары помечены для перемещения"))
}

function pastetov(){
if(!window.confirm("Вставить товары из буфера в группу "+GroupsTree.NodeCaption+"?"))return false;
ok=#server(Goods.GoodsAction.FromCardInGroup('#(%session.Data("user"))#',GroupsTree.NodeID))#
if(isNaN(ok)){alert(ok)}
else{ShowTovars();}
}

function getselected(){
textString=""
count=LV.ListItems.Count;
	for (i = 1; i <= count; i++){
	string = "";
	if(LV.ListItems.Item(i).selected){
	string=LV.ListItems.Item(i).Tag;
	textString=textString+string+InnerSplitter;
}}
return textString;
}

//открыть окно с товарами в буфере обмена
function tovbuf(){
window.showModalDialog("tovbuf.csp","","center:yes;status:no;dialogHeight:430px;dialogWidth:700px;resizable:yes")
}

//Открыть окно с ценами товара
function tovprice(){
var goodsid=SelectedItemProperty(GoodsListView,"Tag");
if(goodsid=="")return
window.showModalDialog("tovprice.csp?goodsid="+goodsid,"","center:yes;status:no;dialogHeight:520px;dialogWidth:700px;resizable:yes")
}

//очистить группу
function cleargrup(){
if(window.confirm("Вы уверены?")){
	var GroupId=GroupsTree.NodeID;
	var ok=#server(Goods.GoodsAction.cleargrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{ShowTovars();}
}
}
 
//вставить в группу все бесхозные товары
function fillgrup(){
	var GroupId=GroupsTree.NodeID;
	var ok=#server(Goods.GoodsAction.fillgrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{ShowTovars();}	
}

// распечатать прайслист
function PrintPriceFunc(Suffix){
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var CatalogueID=Catalogues.value;
	var GroupName=GroupsTree.NodeCaption;
	var url = "pricelist"+Suffix+".csp?GroupCode="+GroupCode+"&CatalogueID="+CatalogueID+"&GroupName="+GroupName+"&sessionid="+sessionid;
	window.open(url);
}

function EditGroupNameFn()
{
	var GroupId=GroupsTree.NodeID;
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var NewName=window.prompt("Введите новое название группы",GroupsTree.NodeCaption);
	if(!NewName)return;
	if(NewName==""){alert("Пустные имена группа не допустимы.");return false;}
	var ok=#server(Goods.GroupAction.RenameGroup(GroupId,NewName))#
	if(isNaN(ok)){alert(ok)}
	else{LoadTree();SelectedGroupCode=GroupCode;}
}

// функция после полной загрузки дерева товарных групп
function GroupsTreeDnldCmpl()
{
	GroupsTree.SelectedItem=SelectedGroupCode;
}

/// Вывести остатки
function PrintStorageFn()
{
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var CatalogueID=Catalogues.value;
	var GroupName=GroupsTree.NodeCaption;
	window.open("screen/OstatkiExcel.csp?excel=1&GroupCode="+GroupCode+"&CatalogueID="+CatalogueID+"&GroupName="+GroupName)	
}

function KeyPress(Obj){
var KeyCode=Obj.toString();
if(KeyCode==17)editTovar2();
}

function fnMuiltipleEdit(){
var ok=window.showModalDialog("GoodsListEdit.csp?Where="+where,"","center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;")
if(ok!=null)ShowTovars();
}

function fnFindGood(){
var ok=window.showModalDialog("FindGood.csp","","center:yes;status:no;dialogHeight:650px;dialogWidth:800px;resizable:yes;")
}

$bind(window,"load",function(){ //при загрузке заполнить комбобокс Каталогов
	LV.AllowColumnReorder=true;
	//downloader.startDownload(strForGroups(depot,commongroups), putCatalogue);
	LoadTree(); //инициализация дерева выбранного пункта каталога
	LoadList1();
	document.getElementById(GoodsListView).attachEvent("ItemClick",LVItemClick);
	GroupsTree.onClick="Click()";
	LV.attachEvent("DblClick",OpenCard);
	LV.attachEvent("ColumnClick",colclick);
	LV.attachEvent("KeyPress",KeyPress);
	LV.Sorted =false;
});

// запретить отправку этой группы контрагенту
function AllowToSendFn(AllowToSendParam,message)
{	
	var GroupName=GroupsTree.NodeCaption;	//название текущей группы
	var GroupId=GroupsTree.NodeID;			//код текущей группы
	
	if (!window.confirm(GroupName + "\n" + message + " ?"))return;
	if(GroupId==""){ alert("Выберете, пожалуйста группу"); return;}
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа не содержит товары/запчасти, выберете группу, которая содержит товары/запчасти"); return; }

	var ok=#server(..StopGroupSend(GroupId,AllowToSendParam))#
	if (isNaN(ok)) { alert(ok); }
	else { alert(message); }
}
</script>
</body>
</html>
]]></CSP>


<CSP name="GoodsCard.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"),0)
 i '+login s %response.ServerSideRedirect="norights.csp" 

Quit 1
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.sved.TD{border-left : 1 solid grey;border-top : 1 solid grey;}
.sved{border-right : 1 solid grey;border-bottom : 1 solid grey;}
.btn{font-family: tahoma; }
</style>
<script src="js/jquery-1.6.4.min.js" type="text/javascript"></script>
<script language="Javascript" src="common.js"></script>
<script language="JavaScript" type="text/javascript">
var NodeData = new Array();
sessionid="#(%session.SessionId)#";

Arguments=window.dialogArguments.split(InnerSplitter);
GoodsId=ReturnSpace(Arguments[0]);
GoodsName=ReturnSpace(Arguments[1]);
function startFun(){
window.close();
}

function load(){
TovName.innerText=GoodsName;
//Movement.AddColumns("docdata~Дата~~~@%String#@#doctype~Тип документа~~~@%String#@#Kontr~Контрагент~~~@%String#@#doc~Документ~~~@%String#@#prih~Приход~~~@%String#@#rash~Расход~~~@%String#@#kol~Количество~~~@%String#@#cena~Цена~~~@%String#@#");
kontra.LoadHeaders();
PropTable.DownLoadPairs('',GoodsId);
//GetDocsByTovar();
tovaddress.loadfrommethod("Store.Action.GetAddrByTovar",GoodsId,1,1)
}

function LoadFromCard(){
kontra.GetFromCard("","",GoodsId)
}

function GetDocsByTovar(){
if(selkont.value==1)var kont="";
if(selkont.value==2)var kont=kontra.ItemID;
Movement.loadfrommethod("Common.Common.GetDocsByTovar",GoodsId,dat1.value+"~"+dat2.value,kont)
}

function RemoveFromGroup(Groups,Goods){
	if(!window.confirm("Удалить товар из группы?"))return
	var ok=#server(Goods.GoodsAction.RemoveFromGroup(Goods,Groups))#
	if(isNaN(ok)){alert(ok);}
	else{document.getElementById("li"+Groups).style.display="none";}
}

//скрыть/показать таблицу свойств товара
function ShowHideProps()
{
	if ( $("#PropTable").css("display")=="block" )
	{
		$("#PropTable").css("display","none");
		$("#btnShowHide").val("показать");
	}
	else
	{
		$("#PropTable").css("display","block");
		$("#btnShowHide").val("скрыть");
	}
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();">
<table cellpadding=0 cellspacing=0 width=100% height=100% border=0>
<tr><td colspan=2 ><center><font size=+1><b><span id="TovName" style="color:#002044"></span></b></font></center>
<script language="cache" runat="server">
 s GoodsId=%request.Get("GoodsId")
 s groupspath=%request.Get("groupspath")
 w "<fieldset><legend>Группы в которые входит товар</legend>"
 w "<ul>"
 &sql(declare rt cursor for select Groups,Groups->Name,Common.SqlProcs_GroupFullName(Groups) into Groups,GroupsName,GroupFullName from Goods.GoodsGroup where Goods=:GoodsId)
 &sql(open rt)
 f  &sql(fetch rt) q:SQLCODE  d
 . w "<li id=""li"_Groups_"""> <img src=""images/del+.gif"" onclick=""RemoveFromGroup('"_Groups_"','"_GoodsId_"')"" onmouseover=""del"_Groups_".src='images/Ondel+.gif'"" onmouseout=""del"_Groups_".src='images/del+.gif'""  id=""del"_Groups_""" name=""del"_Groups_""" alt=""Убрать из группы""> "_GroupFullName
 &sql(close rt)
 w "</ul></fieldset>"
 
 //f i=1:1:$L(groupspath,"~") d
 //. s res=$G(res)_$P(groupspath,"~",i)_" -> "
 //w $E(res,1,$L(res)-4)
 
 &html<
<hr width=70%></td></tr>
<tr><td valign=top>
<table class="sved" cellspacing=0 ><tr bgcolor="#eeffff"><td class="TD">&nbsp;<td class="TD">Количество<td class="TD">Продажная цена<td>
>
 s depots=##class(Common.Common).showdata("Store.Depot","ID,Name","","","",1)
 s ok=##class(Store.Action).GetQuantByGoods(GoodsId,.store)
 f i=1:1:$L(depots,"#@#")-1 d
 . s depot=$P($P(depots,"#@#",i),"~",1)
 . s g=##class(Goods.Goods).%OpenId(GoodsId)
 . s price=g.Price
 . w "<tr><td class=""TD"">"_$P($P(depots,"#@#",i),"~",2)_"<td class=""td"">"_+$G(store(depot))_"<td class=""td"">"_$J(price,".",2)
</script>
</table><br>
<SKLADList:listview width=100% height=100 id="tovaddress" />
<br>
<input type="button" value="Изображения товара" onclick="showtovar('#(GoodsId)#')"><br><br>
<input type="button" value="Движение товара" onclick="window.open('Reports/InOut.csp?GoodsId=#(GoodsId)#&sessionid=#(%session.SessionId)#')">
</td><td valign="top">
<fieldset><legend>Сведения о товаре <input type="button" value="скрыть" id="btnShowHide" onclick="ShowHideProps()"></legend>
<SKLAD2:table id="PropTable" width=450 style="display:block;margin:5px"/>
</fieldset>
</td></tr>

<tr><td width=100% align=center colspan=2 valign=top>
<!--
<fieldset><legend>Движение товара c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<select id="selkont"><option value=1>Все контрагенты</option><option value=2>Выбранный контрагент</option></select>
<sklad:LittleButton name="ok" id="okbut" onclick="GetDocsByTovar()" alt="Показать документы"><br>
</legend>
	<SKLADList:listview width=100% height=100 id="Movement" />
</fieldset>
-->

</td></tr>
<tr height=100%><td valign="top" colspan=2>
<fieldset><legend>Контрагенты товара</legend>
 <SKLADList:listview width=100% height=100 id="kontra" ClassName="Common.Kontragent" onAddColumns="LoadFromCard()" /><br>
<!--
Поставщики: <input type="checkbox" style="border:none;width:15px"><br>
Покупатели: <input type="checkbox" style="border:none;width:15px"><br>
-->
</fieldset>
</td></tr>
<tr><td align=center valign=bottom colspan=3><sklad:Button value="Да" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="goodsJQ.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
 s Access9func=##class(Common.Rights).getrights(login,9)
 s GoodsGoodsVersion = ##class(Common.Common).GetCurrentDictVersion("Goods.Goods")
 s GoodsCatalogue = ##class(Docs.Action2).GetClassValuesOptions("","Goods.Catalogue",,,0,"Main desc")
 q 1
</script>
<script language="Cache" method="StopGroupSend" arguments="GroupId:%String,AllowToSendValue:%String" returntype="%String">
 //запретить отправку этой группы контрагентам
 if $G(GroupId)="" q "Укажите, пожалуйста, товарную группу"
 &sql( UPDATE Goods.Goods SET AllowToSend=:AllowToSendValue
WHERE ID IN (SELECT Goods FROM Goods.GoodsGroup WHERE Groups=:GroupId) )
 IF SQLCODE q "Извините. Ошибка при выполнении запроса SQLCODE="_SQLCODE
 Quit 1
</script><html XMLNS:SKLADz XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<head><title>Склад :: Товары</title>
<link href="style.css" type="text/css" rel="stylesheet" />
 <link rel='stylesheet' type='text/css' href='css/redmond/jquery-ui-1.8.16.custom.css'/>
 <link rel='stylesheet' type='text/css' href='css/ui.jqgrid.css'/>

<style type="text/css">
html {margin:0px;padding:0px;}
body {margin:0px;padding:2px 1px;}
* html button { overflow: visible; } /*тупой padding в кнопках IE*/
.pageTitle {width:100%;border-collapse:collapse;border:0px;padding:0px;margin:0px;border:0px;}
.pageTitle tr {background: #e9f3ff;}
.pageTitle tr td {border-bottom:1px #000066;}
.actions a { display:inline-block; padding:10px; margin: 1px; 
	border:1px solid #ccc; background:#eee; 
}
.actions a:hover { text-decoration:none;background:#fcfcfc;}
.actions a:visited {}
label {color:#333;}
 	.ui-jqgrid {font-size:90%;}
 	.ui-widget {font-size:1.2em;}
</style></head><body>

<table class="pageTitle" style=""><tr>
<td style="width:20px;"><img alt="Обновить раздел" src="images/refresh.png" onclick="window.location.reload()"></td>
<td style="text-indent:40px;font:16px Arial;" >Товары</td>
<td style="width:80px;text-align:right;font-size:11px;color: #6e6e6e;" title="Текущая версия справочника товаров">v #(GoodsGoodsVersion)#</td>
</table>
<div class="actions">
		<a href="PriceGroups.csp">Ценовые группы товаров</a>
		<a href="Reserves2.csp">Резервы</a>
		<a href="Brak.csp">Некондиция</a>
		<a title="Привязать запчасть к модели" href="Attach2Model.csp">Запчасти и их модели</a>
		<a href="Serials.csp" title="Открыть страницу управления серийными номерами">Cерийные номера</a>
		<a href="csp.GoodsRights.cls" title="Страница позволяющая установить ограничение в использовании запчастей контрагентами в заявках">Ограничение использования запчастей контрагентами</a>
</div>

<table style="width:100%"><tr>
 <td style="vertical-align:top;width:50%"> 
  <label for="Catalogues" >Классификатор:</label>
  <select id="Catalogues" onchange="LoadTree()">#(GoodsCatalogue)#</select>
  <br/>
  <SKLADz:treeview id="GroupsTree" width=300 height=160 ImagesPath="#(%session.Data("ImagesPath"))#" onDownloadCmpl="GroupsTreeDnldCmpl()" />
  <table width="350"><tr><td>
  <sklad:LittleButton name="new" id="newgrup" onclick="addGroup(0)" alt="Новая группа">
  <sklad:LittleButton name="new+" id="newSubgrup" onclick="addGroup(1)" alt="Новая подгруппа">
  <sklad:LittleButton name="edit" id="EditGroupName" onclick="EditGroupNameFn()" alt="Редактирование названия группы">
  <sklad:LittleButton name="del+" id="del22" onclick="cleargrup()" alt="Очистить группу">
  <sklad:LittleButton name="history" id="hist22" onclick="fillgrup()" alt="Заполнить группу">
  <sklad:LittleButton name="PrintPrice" id="PrintPriceImg" onclick="PrintPriceFunc('')" alt="Вывести прайслист">
  <sklad:LittleButton name="PrintPriceColor" id="PrintPriceImg2" onclick="PrintPriceFunc('Images')" alt="Вывести прайслист c изображениями">
  <sklad:LittleButton name="ostatki" id="PrintStorage" onclick="PrintStorageFn()" alt="Вывести остатки">
  <sklad:LittleButton name="StopSend" id="StopAllowToSend" onclick="AllowToSendFn(0,'Группа больше не будет использоваться в заявках')" alt="Не использовать группу в заявках">
  <sklad:LittleButton name="OkSend" id="OkAllowToSend" onclick="AllowToSendFn(1,'Группа будет использоваться в заявках')" alt="Использовать группу в заявках">
  </td><td>
  <sklad:LittleButton name="del" id="delgrup" onclick="delGroup()" alt="Удалить группу"><br>
  </td></tr></table>
 </td>
 <td valign=top width=50%>
 <!--
  <fieldset style="width:200;"><legend id="TovarName"></legend>
  <SKLADz:treeview id="PropsTree" width=300 height=160 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" />
  </fieldset>
  <table width="350"><tr><td>
  <sklad:LittleButton name="new" id="newprop" onclick="AddProp(0)" alt="Новое свойство">
  <sklad:LittleButton name="new+" id="newSubprop" onclick="AddProp(1)" alt="Новое свойство в существующей группе">
  </td><td>
  <sklad:LittleButton name="del" id="delprop" onclick="DelDopProp();" alt="Удалить свойство">
  </td></tr>
  </table>
-->
  </td>
</tr>
  <!--
<tr>
 <td colspan=2>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
   <fieldset style=""><legend>Товары</legend>
  <sklad:ListView id="LV" style="width:100%;height:200;"  >

 <OBJECT id="LV" classid=clsid:BDD1F04B-858B-11D1-B16A-00C0F0283628 style="width:100%;height:200;behavior:url('#default#download')" codebase="Cab\MSComCtl.CAB" >
<PARAM NAME="View" VALUE="3">
<PARAM NAME="Appearance" VALUE="1">
<PARAM NAME="FullRowSelect" VALUE="True">
<PARAM NAME="MultiSelect" VALUE="True">
<PARAM NAME="GridLines" VALUE="True">
<PARAM NAME="LabelEdit" VALUE="1">
</OBJECT>

</fieldset></td>
</tr>   -->

</table>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var $=function(id){return document.getElementById(id);}
var $bind=("v"=="\v")?function(o,e,h){o.attachEvent("on"+e,h);}:function(o,e,h){o.addEventListener(e,h,false);}

var depot="#($G(%session.Data("depot")))#"
;var commongroups="#($G(%session.Data("commongroups")))#"
;var sessionid="#(%session.SessionId)#";
var SelectedGroupCode="";
var GoodsListView="LV";  //id элемента ListView с товарами
var ColCode="";
var where="";
var CurrentGoodsID = "";	//id выбранного товара в таблице товаров

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}

function LoadTree(){
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+#(%session.Data("depot"))#+'","'+Catalogues.value+'"')	
}

//Обработка клика на узле дерева товарных групп
function Click(){
test();
}

//Добавить группу
function addGroup(Sub){
//Sub=1 означает что желаем создать подгруппу
Code=GroupsTree.NodeCode;
if(Code==""&Sub==1){alert("Не выбрана группа для создания подгруппы");return}
Catalogue=Catalogues.value;
Name=window.showModalDialog("AddGoodsProp.csp","Наименование группы","center:yes;status:no;dialogHeight:200px")
if(Name==null)return false;
ok=#server(Goods.GroupAction.createGroup(Catalogue,Name,Code,Sub))#
if (!isNaN(ok)){LoadTree();}
else {alert(ok);}
}

//Удалить группу
function delGroup(){
Code=GroupsTree.NodeCode;
if(Code==""){alert("Не выбрана группа");return false;}
GroupId=GroupsTree.NodeID;
ok=window.confirm("Удалить группу ?")
if(ok==false)return false;
ok=#server(Goods.GroupAction.DelGroup(Catalogues.value,Code,GroupId))#
if (ok!=1){alert(ok);return false;}
LoadTree();
}

//Добавить товар
function addTovar(Goods,CspFile)
{
	//установим переменные
	Goods=ReturnSpace(Goods);
	GroupId=GroupsTree.NodeID;
	GroupCode=GroupsTree.NodeCode;
	if(GroupId==""){alert("Не выбрана группа");return false;}
	Name=GroupsTree.NodeCaption;
	var dialogHeight=600;
	
	//проверим логическую возможность создавать товар	
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа содержит подгруппы, она не может содержать товары. Выберете группу, которая не содержит подгрупп."); return; }
	
	//если это создание нового товара
	if(ReturnSpace(Goods)=="")
	{
		if(window.confirm("Использовать новую форму?")){var CspFile="GoodCard.csp?GroupId="+GroupId;var dialogHeight=400;}
		else{var CspFile="AddTovar.csp"}
	}
	
	ok=window.showModalDialog(CspFile,Catalogues.value+InnerSplitter+GroupId+InnerSplitter+GroupCode+InnerSplitter+Goods+InnerSplitter+Name,"center:yes;status:no;dialogHeight:"+dialogHeight+"px;dialogWidth:800px;resizable:yes")
	if(ok==1){test()}
}

//Удалить товар
function DelTovar()
{
	GoodsId=CurrentGoodsID;
	if(GoodsId==""){alert("Не выбран товар");return false;}
	if(!window.confirm("Удалить "+$("#grid").getCell(GoodsId,2)+"?"))return false;
	ok=#server(Goods.GoodsAction.DeleteGoods(GoodsId))#
	if(ok==1){test()}
	else{alert(ok)}
}

//Редактировать товар
function editTovar(){
GoodsId=CurrentGoodsID;
addTovar(GoodsId,"AddTovar.csp");
}

//Редактировать товар в новой форме
function editTovar2(){
var GoodsId=CurrentGoodsID;
addTovar(GoodsId,"GoodCard.csp?GoodId="+GoodsId);
}


//Открыть карточку товара
function OpenCard(){
//GoodsId=CurrentGoodsID;
GoodsName=SelectedItemProperty(GoodsListView,'Text');
if(CurrentGoodsID=="")return
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+CurrentGoodsID+"&groupspath="+GroupsTree.ParentNames,GoodsId+InnerSplitter+GoodsName,"center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
if(ok==1){test()}
}

// вырезать товары в буфер обмена
function cuttov(){
var tovs=getselected();
//alert(tovs)
if(tovs==""){alert("Ничего не выбрано");return false;}
ok=#server(Goods.CardAction.SaveCard2('#(%session.Data("user"))#',tovs,"Goods.Goods"))#
if(isNaN(ok))alert(ok);
else(alert("Выбранные товары помечены для перемещения"))
}

 // вставить товары из буфера обмена
function pastetov(){
if(!window.confirm("Вставить товары из буфера в группу "+GroupsTree.NodeCaption+"?"))return false;
ok=#server(Goods.GoodsAction.FromCardInGroup('#(%session.Data("user"))#',GroupsTree.NodeID))#
if(isNaN(ok)){alert(ok)}
else{test();}
}

//открыть окно с товарами в буфере обмена
function tovbuf(){
window.showModalDialog("tovbuf.csp","","center:yes;status:no;dialogHeight:430px;dialogWidth:700px;resizable:yes")
}

//Открыть окно с ценами товара
function tovprice(){
var goodsid=CurrentGoodsID;
if(goodsid=="")return
window.showModalDialog("tovprice.csp?goodsid="+goodsid,"","center:yes;status:no;dialogHeight:520px;dialogWidth:700px;resizable:yes")
}

//очистить группу
function cleargrup(){
if(window.confirm("Вы уверены?")){
	var GroupId=GroupsTree.NodeID;
	var ok=#server(Goods.GoodsAction.cleargrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{test();}
}
}
 
//вставить в группу все бесхозные товары
function fillgrup(){
	var GroupId=GroupsTree.NodeID;
	var ok=#server(Goods.GoodsAction.fillgrup(GroupId))#;
	if(isNaN(ok)){alert(ok);}
	else{test();}	
}

// распечатать прайслист
function PrintPriceFunc(Suffix){
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var CatalogueID=Catalogues.value;
	var GroupName=GroupsTree.NodeCaption;
	var url = "pricelist"+Suffix+".csp?GroupCode="+GroupCode+"&CatalogueID="+CatalogueID+"&GroupName="+GroupName+"&sessionid="+sessionid;
	window.open(url);
}

// редактировать название группы товаров
function EditGroupNameFn()
{
	var GroupId=GroupsTree.NodeID;
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var NewName=window.prompt("Введите новое название группы",GroupsTree.NodeCaption);
	if(!NewName)return;
	if(NewName==""){alert("Пустные имена группа не допустимы.");return false;}
	var ok=#server(Goods.GroupAction.RenameGroup(GroupId,NewName))#
	if(isNaN(ok)){alert(ok)}
	else{LoadTree();SelectedGroupCode=GroupCode;}
}

// функция после полной загрузки дерева товарных групп
function GroupsTreeDnldCmpl()
{
	GroupsTree.SelectedItem=SelectedGroupCode;
}

/// Вывести остатки
function PrintStorageFn()
{
	var GroupCode=GroupsTree.NodeCode;
	if(GroupCode==""){alert("Выберете пожалуйста товарную группу");return;}
	var CatalogueID=Catalogues.value;
	var GroupName=GroupsTree.NodeCaption;
	window.open("screen/OstatkiExcel.csp?excel=1&GroupCode="+GroupCode+"&CatalogueID="+CatalogueID+"&GroupName="+GroupName)	
}

function KeyPress(Obj){
var KeyCode=Obj.toString();
if(KeyCode==17)editTovar2();
}

// клик на кнопку "множественное редактирование"
function fnMuiltipleEdit(){
var ok=window.showModalDialog("GoodsListEdit.csp?Where="+where,"","center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;")
if(ok!=null)test();
}

// клик на кнопку "найти товары"
function fnFindGood(){
var ok=window.showModalDialog("FindGood.csp","","center:yes;status:no;dialogHeight:650px;dialogWidth:800px;resizable:yes;")
}

$bind(window,"load",function(){ //при загрузке заполнить комбобокс Каталогов
	//downloader.startDownload(strForGroups(depot,commongroups), putCatalogue);
	LoadTree(); //инициализация дерева выбранного пункта каталога
	GroupsTree.onClick="Click()";
});

// запретить отправку этой группы контрагенту
function AllowToSendFn(AllowToSendParam,message)
{	
	var GroupName=GroupsTree.NodeCaption;	//название текущей группы
	var GroupId=GroupsTree.NodeID;			//код текущей группы
	
	if (!window.confirm(GroupName + "\n" + message + " ?"))return;
	if(GroupId==""){ alert("Выберете, пожалуйста группу"); return;}
	if(GroupsTree.ChildIDs!=""){ alert("Данная группа не содержит товары/запчасти, выберете группу, которая содержит товары/запчасти"); return; }

	var ok=#server(..StopGroupSend(GroupId,AllowToSendParam))#
	if (isNaN(ok)) { alert(ok); }
	else { alert(message); }
}

function test()
{
	var GroupId = GroupsTree.NodeID;
	
	/// Получить отправляемые на сервер дополнительные данные
	var postData=$("#grid").jqGrid("getGridParam","postData");
	/// Дополнить их своими параметрами
	$.extend(postData,{ Groups: GroupId }); //добавляем свойство со значением
	/// Устанавливаем новые доп.данные
	$("#grid").jqGrid("setGridParam","postData",postData);
	/// Обновляем таблицу
	$("#grid").trigger("reloadGrid");
}
</script>

<table id="grid"><tr><td></td></tr></table><div id="bar"></div>
 <Table width=100%><tr><td width="60%" >
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="new" id="newtov" onclick="addTovar()" alt="Новый товар">
  <sklad:LittleButton name="edit" id="edittov" onclick="editTovar()" alt="Редактировать товар">
  <sklad:LittleButton name="edit" id="edittov2" onclick="editTovar2()" alt="Редактировать товар в новой форме ( CTRL+q )">
</CSP:IF>
  <sklad:LittleButton name="card" id="cardtov" onclick="OpenCard()" alt="Карточка товара">
  <sklad:LittleButton name="new+" id="newGprop" onclick="AddProp2()" alt="Новое основное свойство">
  <sklad:LittleButton name="del+" id="delGprop" onclick="DelProp()" alt="Удалить основное свойство">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="copy" id="copy" onclick="cuttov()" alt="Пометить для копирования">
  <sklad:LittleButton name="paste" id="paste" onclick="pastetov()" alt="Вставить товары из буфера">
  <sklad:LittleButton name="history" id="buf" onclick="tovbuf()" alt="Товары в буфере обмена">
</CSP:IF>
  <sklad:LittleButton name="price" id="price" onclick="tovprice()" alt="Цены товара">
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="goinside" id="btnMuiltipleEdit" onclick="fnMuiltipleEdit()" alt="Редактировать список товаров">
</CSP:IF>
  <sklad:LittleButton name="find" id="btnFindGood" onclick="fnFindGood()" alt="Поиск товаров">
  </td>
  <td align=right width="40%">
  
<CSP:IF CONDITION="Access9func=1">
  <sklad:LittleButton name="del" id="deltov" onclick="DelTovar()" alt="Удалить товар">
</CSP:IF>
  <!--
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <span title="Обновление таблицы после каждого сохранения товара (если отключить, то редактировать товары можно будет быстрее)">
  	<label for="makeShowDict">Поддерживать таблицу в актуальном состоянии</label>
  	<input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
  </span>
  -->
  </td></tr></table>
		<script type='text/javascript' src='js/jquery-1.6.4.min.js'></script>
		<script type='text/javascript' src='js/jquery-ui-1.8.16.custom.min.js'></script>
		<script type='text/javascript' src='js/i18n/grid.locale-ru_win1251.js'></script>
		<script type='text/javascript' src='js/jquery.jqGrid-4.1.2.min.js'></script>
		<script type='text/javascript'>
		
		
		$(function(){
				var GRID="#grid",BAR="#bar",URL="json.GoodsJQ.cls";

				$(GRID).jqGrid({
						caption: 'Товары / запчасти'
						,url: URL, editurl: URL
						,datatype: "json"
						,jsonReader : { repeatitems: false }
						,colModel: [
							{name:"gd",hidden: true}
							,{name:"nm",label:"Наименование",width:350
								, search:true
							}
							,{name:"P5300",label:"Номер по схеме",width:150
								, search:true
							}
							,{name:"EN",label:"Английское наименование",width:210
								, search:true
							}
							,{name:"ats",label:"Использовать в заявках",width:200
								, search:true
							}	
						]
						//,idPrefix:"kt"
					 ,pager:BAR 
					 ,viewrecords:true
					 ,height:300
					 ,hidegrid: false
					 ,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
					 ,/*scrollrows:true,*/hoverrows:true ,scroll:1
					 ,ondblClickRow: function(id){editTovar2();}
					 ,onSelectRow: function(id) {CurrentGoodsID = id;}
 		})
 		.jqGrid('navGrid',BAR, {
	       	add: false
       		, edit:false
       		, del:false 
       		, view:false
       		, search:false
       }
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{ //Параметры удаления
	       afterSubmit: function(resp){
		      var text=resp.responseText;
		      var arr=eval(text); 
		      return arr;
		   }
	   } 
   ).jqGrid('filterToolbar',{searchOnEnter:false})
   .jqGrid('gridResize',{});
 	$(BAR+"_center").remove(); //пагинатора не будет
 	$(BAR+"_left").css("width","70%"); //надпись о количестве записей на бОльшую часть футера
});


</script>

</body>
</html>
]]></CSP>


<CSP name="GoodsListEdit.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 . s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 s Where=%request.Get("Where")
Quit 1
</script>

<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<title>Редактирование списка товаров</title>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var sessionid="#(sessionid)#";
var Where="#(Where)#";

function FillDocStr(){
var Captions = new Array(8);
var Keys = new Array(8);
var Tags = new Array(8);
var Widths = new Array(8);

Captions[0]="Аббревиатура";
Captions[1]="Модель";
Captions[2]="Наименование";
Captions[3]="Английское наименование";
Captions[4]="Вес";
Captions[5]="Объём";
Captions[6]="Код детали";
Captions[7]="Номер по схеме";

Tags[0]="%String";
Tags[1]="%String";
Tags[2]="%String";
Tags[3]="%String";
Tags[4]="%String";
Tags[5]="%String";
Tags[6]="%String";
Tags[7]="%String";

Keys[0]="abbr";
Keys[1]="Property3609";
Keys[2]="Name";
Keys[3]="EnglishName";
Keys[4]="Weight";
Keys[5]="Size1";
Keys[6]="codedetail";
Keys[7]="Property5300";

Widths[0]=70;
Widths[1]=70;
Widths[2]=230;
Widths[3]=230;
Widths[4]=60;
Widths[5]=60;
Widths[6]=100;
Widths[7]=100;
docstr.DrawHeaders(Captions,Keys,Tags, Widths);
docstr.loadfrommethod("Goods.GoodsAction.GoodsList",Where);
}

function startFun(){
xmlDoc=docstr.GetXmlContentByRows();
var ok=SendXml(1,"Goods.Goods",xmlDoc,sessionid);
if(isNaN(ok)){alert(ok)}
else{returnValue=1;window.close();}
}
</script>
</head>

<body onload="FillDocStr();" onkeypress="ManageWindow();">
<table width=100% height=100%>
<tr height=95% valign=top><td>
	<SKLADiGrid:iGrid id="docstr" width="100%" height="550" Enabled="true"  /><br>
</td></tr>
<tr height=5% valign=bottom><td>
	<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</tr></td>
</table>
</body>
</html>
]]></CSP>


<CSP name="GoodsParams.csp" application="/csp/sklad2/" default="1"><![CDATA[
<Script language="cache" runat="server">
 s class=%request.Get("class") 
 i class="" w "Error=Не указан класс" q
 s fields=%request.Get("fields")
 i fields="" w "Error=Не указаны поля" q
 s Goods=%request.Get("Goods")
 s where=%request.Get("where")
 s Groups=%request.Get("Groups")
 s Catalogue=%request.Get("Catalogue")
 
 //Разложим код группы на коды родителей
 if Groups'="" d
 . f i=2:1:$L(Groups,"*") d
 . . s parents=$G(parents)_" or Groups='"_$P(Groups,"*",1,i)_"'"
 
 s result = ##class(%ResultSet).%New()
 s sql="SELECT "_fields_" FROM "_class_" where (Groups is null "_$G(parents)_") and Catalogue='"_Catalogue_"' "
 if where'="" s sql=sql_where
 s sql=sql_" order by Code"
 d result.Prepare(sql)
 //s result.RuntimeMode=2
 s ok=result.Execute()
 q:'+ok ok
 While result.Next() {
 f i=1:1:$L(fields,",") d
 . s val=$G(result.Data($P(fields,",",i)))
 . s $P(OutString,"~",i)=val
 s value=""
 i (Goods'="") {
	s ParamId=$G(result.Data("ID"))
 	&sql(select Gvalue into :value from Goods.GoodsParams where goods=:Goods and Param=:ParamId)
 	s:('%ROWCOUNT)&(SQLCODE) value=""
 }
 //Последним в строке пойдёт значение свойства для данного товара
 s res=$G(res)_OutString_"~"_value_"#@#"
  }
 w $G(res)
 </script>
 
 ]]></CSP>


<CSP name="GoodsParams2.csp" application="/csp/sklad2/" default="1"><![CDATA[
<Script language="cache" runat="server">
 s class=%request.Get("class") 
 i class="" w "Error=Не указан класс" q
 s fields=%request.Get("fields")
 i fields="" w "Error=Не указаны поля" q
 s Goods=%request.Get("Goods")
 s where=%request.Get("where")
 s Groups=%request.Get("Groups")
 s Catalogue=%request.Get("Catalogue")
 
 //Разложим код группы на коды родителей
 if Groups'="" d
 . f i=2:1:$L(Groups,"*") d
 . . s parents=$G(parents)_" or Groups='"_$P(Groups,"*",1,i)_"'"
 
  s result = ##class(%ResultSet).%New()
  s sql="SELECT "_fields_" FROM "_class_" where (Groups is null "_$G(parents)_") and Catalogue='"_Catalogue_"' "
 if where'="" s sql=sql_where
 s sql=sql_" order by Code"
 d result.Prepare(sql)
 //s result.RuntimeMode=2
 s ok=result.Execute()
 q:'+ok ok
 &html<<html><head><TITLE>untitled</TITLE><META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso-8859-1"></head><body>>
 While result.Next() {
 s somethg=1
 f i=1:1:$L(fields,",") d
 . s field=$P(fields,",",i)
 . s val=$G(result.Data(field))
 . //s $P(OutString,"~",i)=val
 . w "<span id="""_field_""">"_val_"</span>"
 s value=""
 i (Goods'="") {
	s ParamId=$G(result.Data("ID"))
 	&sql(select Gvalue into :value from Goods.GoodsParams where goods=:Goods and Param=:ParamId)
 	s:('%ROWCOUNT)&(SQLCODE) value=""
 }
 //Последним в строке пойдёт значение свойства для данного товара
 w "<span id=""Gvalue"">"_value_"</span>"
  }
 &html<</body></html>>
 </script>
 
 ]]></CSP>


<CSP name="Gps.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<title>	 </title>

</head>

<body>
<script language="cache" runat="server">
 s lat= +%request.Get("latitude")
 s long = +%request.Get("longitude")
 s timeClient = %request.Get("timeClient")
 s Device = %request.Get("Device")
 
 if (lat>0) && (long>0)
 {
	 s last=+$O(^GpsGlobal(""),-1)+1
	 //s last=0
	 s ^GpsGlobal(last,"latitude")=lat
	 s ^GpsGlobal(last,"longitude")=long
	 s ^GpsGlobal(last,"timeServer")=$ZDT($H)
	 s ^GpsGlobal(last,"timeClient")=timeClient
	 s ^GpsGlobal(last,"Device")=Device
	 w "OK</body></html>"
	 q
 }

 s last=+$O(^GpsGlobal(""),-1)
 //s last=0
 s lat= +$G(^GpsGlobal(last,"latitude"))
 s long = +$G(^GpsGlobal(last,"longitude"))
 s timeServer = $G(^GpsGlobal(last,"timeServer"))
 s timeClient = $G(^GpsGlobal(last,"timeClient"))
 s Device = $G(^GpsGlobal(last,"Device"))
 
 if (lat>0) && (long>0) && ('+%request.Get("latitude"))
 {
	 s (i,addPT)=""
	 f 
	 {
		 s i = $O(^GpsGlobal(i))
		 q:i=""
		 q:i=last
 		s latI = +$G(^GpsGlobal(i,"latitude"))
 		s longI = +$G(^GpsGlobal(i,"longitude"))		 
		 s addPT=addPT_"~"_longI_","_latI_",pmwts"_(+i+1)
		 i $I(zamerCount)
	 }
	 w "<table border=0><tr><td valign=top>"
	 w "Всего замеров "_+$G(zamerCount)_"<br>",!

	 s l=%request.Get("l")
	 if l="" s l="map"

	 s z=%request.Get("z")
	 if z="" s z=15
	 
	 s newzMinus=z-1
	 s newzPlus=z+1
	 
	 if newzPlus>17 s newzPlus=17
	 if newzMinus<0 s newzMinus=0

	 
	 if (l="sat")
	 {
		 s newl="map"
		 s lName="карта"
	 }
	 else
	 {
		 s newl="sat"
		 s lName="спутник"
	 }
	 
	 s url = "http://static-maps.yandex.ru/1.x/?ll="_long_","_lat_
	 	"&pt="_long_","_lat_",pmgrm"_addPT_
	 	"&size=640,450"_
	 	"&z="_z_
	 	"&l="_l_
	 	"&key=AIYoGkwBAAAAPEg8BgMAsOCw8UxY2pohmNWaAsI4RrFmMesAAAAAAAAAAADKhm4DSmfL3ExhkpR7d2Xfes0A_A=="
	 
	 w "<table><tr>",!
	 w "<td>"_
	 	"<input type=""button"" value="" - "" onclick=""window.location.href='?z="_newzMinus_"&l="_l_"'""> "_
	 	"<input type=""button"" value="" + "" onclick=""window.location.href='?z="_newzPlus_"&l="_l_"'"">"
	 w "<td align=""right""><a href=""?l="_newl_"&z="_z_""">"_lName_"</a>"
	 w "<tr><td colspan=2><img src="""_url_""">",!
	 w "</table>",!
	 w "</td><td width=100% valign=top>"
	 w "<table border=1>"
	 s (i,addPT)=""
	 f 
	 {
		 s i = $O(^GpsGlobal(i))
		 q:i=""
 		s latI = +$G(^GpsGlobal(i,"latitude"))
 		s longI = +$G(^GpsGlobal(i,"longitude"))		 
 		s DeviceI = $G(^GpsGlobal(i,"Device"))
 		s timeClientI = $G(^GpsGlobal(i,"timeClient"))
 		s timeServerI = $G(^GpsGlobal(i,"timeServer"))
 		
 		w "<tr><td valign=top><b>"_(i+1)_"</b></td><td>"
		w "Устройство "_DeviceI_"<br>",!
	 	w "Долгота "_longI_"<br>",!
	 	w "Широта "_latI_"<br>",!
	 	w "Время замера "_timeClientI_"<br>",!
	 	w "Время фиксации "_timeServerI_"<br>",!
	 }
	 w "</table>"
	 w "</td></tr></table>"
 }
 else
 {
	 w "Ни одной координаты ещё не зафиксировано"
 }
</script>
</body>
</html>
]]></CSP>


<CSP name="index.csp" application="/csp/sklad2/" default="1"><![CDATA[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv=Content-Type content="text/html;charset=windows-1251">
<title>Система складского учёта</title>
<style type="text/css">
* {border:0px;margin:0px;padding:0px;}
frameset * {margin:0px;padding:0px;border:0px none;}
frame {margin:0px;padding:0px;border:0px none;outline:0px none;}
</style>
<script language="javascript" type="text/javascript">
GoodsWindow = "undef";
StoreWindow = "undef";

fso = new ActiveXObject("Scripting.FileSystemObject");
SystemDrive=fso.GetSpecialFolder(0).Drive;
var FilesChecked=false;

function InsertValues(){
if(FilesChecked)return false;
login.document.all.SystemDrive.value=SystemDrive;
//Здесь лежат названия файлов которые должны быть на локальном диске
s=login.MustExist.innerText;
filenames=s.split("/");
NotAllFiles=false;
for(z = 0; z < filenames.length-1; z++)
 {
 if(!fso.FileExists(SystemDrive+"\\SKLAD\\"+filenames[z]))
  {
  NotAllFiles=true;
  break;
  }
 }
if(NotAllFiles){window.showModalDialog("zz.htm","","center:yes;status:no;dialogHeight:100px;dialogWidth:250px");}
FilesChecked=true;
}

// посылает сигнал на сервер о завершении сессии
function sendclose(){
return
var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
try
 {
 xmlhttp.open("POST","CloseSession.csp", false);
 xmlhttp.send();
 }
catch(e)
 {
 }
}
</script>
</head>
<frameset rows="35,0,0,0,0,0,0,0,0,0,0,0,*,0,20" cols="*" border="0" framespacing="0" frameborder="0" noresize id="MainFrameSet" onunload="sendclose()">
<frame src="close.htm" name="topFR" id="topFR" scrolling=no noresize border="0" framespacing="0" frameborder="0"  APPLICATION="yes" >
<frame src="select.htm" name="goods" id="goods" scrolling=auto border="0" framespacing="0" frameborder="0" noresize  >
<frame src="select.htm" name="docs" id="docs"   scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="dicts" id="dicts"  scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="store" id="store"  scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="tuneup" id="tuneup"   scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="chief" id="chief"   scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="emplight" id="emplight"  scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="analyzis" id="analyzis"  scrolling=auto border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="kontr" id="kontr"   scrolling=auto APPLICATION="yes" border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="finance" id="finance"   scrolling=auto APPLICATION="yes" border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="director" id="director"  scrolling=auto APPLICATION="yes" border="0" framespacing="0" frameborder="0" noresize>
<frame src="login.csp" name="login" id="login" onload="InsertValues();" APPLICATION="yes" border="0" framespacing="0" frameborder="0" noresize>
<frame src="select.htm" name="select" id="select"  scrolling=no border="0" framespacing="0" frameborder="0" noresize >
<frame name="statusFR" id="statusFR" scrolling=no APPLICATION="yes" border="0" framespacing="0" frameborder="0" noresize >
<IE:DOWNLOAD id="downloader" STYLE="behavior:url(#default#download)">
</frameset>

</html>]]></CSP>


<CSP name="Info.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<title>Система складского учёта</title>
<link href="style.css" type=text/css rel=stylesheet>
<style>
TD{font-family:'Arial';font-size:13pt;}
SPAN{font-family:'Arial';font-size:13pt;color:#0022aa;cursor:hand}
</style>
<script language="javascript">

function load(){
if(window.dialogArguments!=""){
	maintext.value=window.dialogArguments;
}

}

function wopen(url,params)
{
	if(typeof(params) == "undefined"){var params=""}
	window.showModalDialog(url,params,"center:yes;status:no;dialogHeight:400px;dialogWidth:800px;resizable:yes")
}


function CopyInClipBoard()
{
   var TextAreaObj = document.getElementById("TextAreaText");
   var TextCellObj = document.getElementById("TextCell");
	TextAreaObj.value = TextCellObj.innerText;
	TextAreaObj.style.display="block";
   TextAreaObj.focus()
   TextAreaObj.style.display="none";
   TextAreaObj.select()
   therange = TextAreaObj.createTextRange()
   therange.execCommand("Copy")
   alert("Данные успешно скопированы")
}

</script>
</head>
<body onload="load()" style="border:solid 1 black">
<table cellpadding=5 height=100% width=100% border=1><tr ><td valign=top id="TextCell">

<script language="cache" runat="server">
 s docid=%request.Get("docid")
 s class=%request.Get("class")
 s property=%request.Get("property")
 if docid,class'="",property'="" d
 . s obj=$ZOBJCLASSMETHOD(class,"%OpenId",docid)
 . d:$ISOBJECT(obj) 
 . . s String=$ZOBJPROPERTY(obj,property)
 . . f i=1:1:$L(String,$C(13)) d
 . . . w $P(String,$C(13),i)_"<br>",!
</script>
</td></tr>
<tr height="20px"><td valign=bottom>
<center><br>
<sklad:Button onclick="CopyInClipBoard()" style="width:200px" value="Скопировать в буфер">
<sklad:Button onclick="window.close()" value="Закрыть"></center>
</td></tr>
</table>
<textarea id="TextAreaText" cols=20 rows=5 style="display:none"></textarea>
</body>
</html>]]></CSP>


<CSP name="InnerInstructNew.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 . s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 
 s login=$G(%session.Data("user"))
 
 
Quit 1
</script>
<script language="cache" runat="server">
 s DocId=%request.Get("DocId")
 s ClassName=%request.Get("ClassName")

 s joiu=$TR($G(f),"\","?")
 d:%request.ContentType="multipart/form-data"
 . s obj=$G(%request.MimeData("oFile1",1))
 . q:'$ISOBJECT(obj)
 . //s f=$P(f,"\",1,$L(f,"\")-1)_"\GoodsImages\"
 . s f=$P($ZU(86),"\",1,$L($ZU(86),"\")-1)_"\CSP\sklad2\SkladInstrImages\"
 . s filename=DocId_"-"_$P(obj.FileName,"\",$L(obj.FileName,"\"))
 . s filepath=f_filename
 . s file=##class(%File).%New(filepath)
 . Do file.Open("WSN")
 . d file.CopyFrom(obj)
 . s ok=file.%Save()
 . i '+ok d
 . . Do DecomposeStatus^%apiOBJ(ok,.Err)
 . . s ^Errors($H,"err")=Err(Err)
 . e  d
 . . d ##class(Common.Common).SaveDocsImage(DocId,filename)
 . . s d="window.close();"
 . . d file.Close()
 . . s cmd = "c:\progra~1\IrfanView\i_view32.exe "_filepath_" /resize_long=800 /aspectratio /resample /convert="_filename
 . . if %request.Get("resize") d $ZF(-1,cmd)
 . . //d $ZF(-1,cmd)

</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="JScript">
#($G(d))#;
var DocId="#($G(DocId))#";
var ClassName="#($G(ClassName))#";
var sessionid="#($G(sessionid))#";
var login = "#($G(login))#";

function load(){
var Captions = new Array(5);
var Keys = new Array(5);
var Tags = new Array(5);

Captions[0]="Место";
Captions[1]="Товар";
Captions[2]="Количество по накладной";
Captions[3]="Фактическое количество";
Captions[4]="Изображение";

Tags[0]="Store.Address";
Tags[1]="Goods.Goods";
Tags[2]="%Numeric";
Tags[3]="%Numeric";
Tags[4]="%String";

Keys[0]="addr";
Keys[1]="Goods";
Keys[2]="quantdefault";
Keys[3]="quantreal";
Keys[4]="image";
docstr.DrawHeaders(Captions,Keys,Tags);
docstr.loadfrommethod("Docs.Action2.InnerInstructNewStr",DocId,"",ClassName+"Items");
}

function startFun() {
 var InnerSplitter="~";
 xmlDoc=docstr.GetXmlContentByRows();
 if (login=7)
 {
	 //alert(xmlDoc.xml);
	 CheckForEmptyCells();
 }
 InsertXmlHeader(xmlDoc,"storeman",storeman.Tag,"Common.Dictionary5")
 var DocID=SendXml(DocId,ClassName,xmlDoc,sessionid);
 if(isNaN(DocID)){alert(DocID);return}
 
 /*
 //отключаем внутренние акты расхождения и проверку на необходимость создания актов
 var ok3=#server(Docs.Action.PrihNeedsDiff(DocID))#
 if(isNaN(ok3)&&(ok3!="yes")){alert(ok3);return false;}
 
 if(ok3=="yes")  {
  okdiff=window.showModalDialog("docinnerdiff.csp?source="+DocID,"Docs.InnerDiff"+InnerSplitter+""+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
  if(okdiff!=1)
  {
   if(okdiff!=null)alert(okdiff);
   return false;
  }
   var ok2=#server(Docs.Action.SetSourceDoc("Docs.InnerDiff",okdiff,DocID))#
 } 
 */ 
 
 returnValue=1;
 window.close();
}

function CheckForEmptyCells()
{
	oNodeList = xmlDoc.selectNodes("//AllObjects/OneObject/*")
	for (i=0;i<oNodeList.length;i++)
	{
		OneObject = oNodeList.item(i);		//Текущий узел (строка из базы)
		//alert(oNodeList.item(i).text + " \n" +
		//	"Name = " + OneObject.Name + "\n" + 
		//	"LocalName = " + OneObject.LocalName + "\n" +
		//	"Value = " + OneObject.Value + "\n" +
		//	"BaseURI = " + OneObject.BaseURI + "\n" +
		//	"NodeType = " + OneObject.NodeType + "\n" +
		//	"className = " + OneObject.className + "\n" +
		//	+ OneObject.selectSingleNode("text").text);
		//RowId = OneObject.selectSingleNode("//text/*").text;		//ID строки в базе
		//alert(RowId);
	}
}

function SendXml(DocID,ClassName,xmlDoc,sessionid)
{
 var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
 xmlhttp.open("POST","xmlmethod.csp?classmethod=Docs.Action.SaveStorageDoc&id="+DocID+"&documentclass="+ClassName+"&sessionid="+sessionid, false);
 xmlhttp.send(xmlDoc)
 var ok=xmlhttp.responseText;
 return ok;
}

 function winclose(){
 if(window.confirm("Вы уверены?"))window.close();
 }
 
function ChangeStoreMan(TdObject)
{
 var newItem=window.showModalDialog("Dictionary.csp","Common.Dictionary5","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
 if(newItem==null){return false;}
 newArr=newItem.split("~");
 TdObject.Tag=newArr[0];
 TdObject.innerText=newArr[1];
}

function myOnSubmitEventHandler()
{
 if(!window.confirm("Сохранить выбранную картинку?"))return false;
}

function ShowFoto()
{
 window.open("DocImages.csp?DocId="+DocId);
}


</script>
<title>#($G(%session.Data("systemname")))#</title>
<style>
td{
font-family:Arial;
font-size:14px;
}
</style>
</head>

<body onload="load()">
<table border=0 width=100% height=100%>
<tr><td>
<script language="cache" runat="server">
 s DocObj=$ZOBJCLASSMETHOD(ClassName,"%OpenId",DocId)
 s Stat=""
 d:$ISOBJECT(DocObj)
 . s DocName=DocObj.Name
 . s DocComment=DocObj.Comment
 . s Stat=DocObj.Stat
 . i (ClassName="Docs.StorageIn")||(ClassName="Docs.StorageOut") d
 . . s Storeman=$S($ISOBJECT(DocObj.storeman):DocObj.storeman.Name,1:"")
 . . s StoremanId=$S($ISOBJECT(DocObj.storeman):DocObj.storeman.%Id(),1:"")
 . . if ClassName="Docs.StorageOut" s Brak=DocObj.Brak
 . . if ClassName="Docs.StorageIn" s Brak=DocObj.PrihodType
 . s DatClose=$S(DocObj.CloseDate?5N:$ZD(DocObj.CloseDate,4),1:"")
 . s TimClose=$S(DocObj.CloseTime?5N:$ZT(DocObj.CloseTime),1:"")
 . s UserClose=$S($ISOBJECT(DocObj.CloseUser):DocObj.CloseUser.Name,1:"")
 s ClassNameName=##class(Docs.Action).GetDocNameFromClass(ClassName)
 
 w "<table width=100%><tr><td width=10%>&nbsp;<td width=80% align=center><h3>"_ClassNameName_"</h3><td width=10% align=""center"">&nbsp;"
 if $G(Brak) w " <font size=4 color=""red"">некондиционные<br>товары</font>"
 w "</table>"
 w "<table border=0>"
 w "<tr><td><b>Номер<td>"_$G(DocName)_"<td width=50>&nbsp;<td><b>Дата закрытия<td>"_$G(DatClose)
 w "<tr><td><b>Комментарий<td>"_$G(DocComment)_"<td width=50>&nbsp;<td><b>Время закрытия<td>"_$G(TimClose)
 w "<tr><td><b>Ответственный<br>за погрузку<td id=""storeman"" onmouseout=""this.style.backgroundColor='#ffffff'"" onmouseover=""this.style.backgroundColor='#ddeeee'"" style='cursor:hand' Tag="""_$G(StoremanId)_""" onclick=""ChangeStoreMan(this)"">"_$G(Storeman)_"<td width=50>&nbsp;<td><b>Ответственный<br>за закрытие<td>"_$G(UserClose)
 w "</table>"
</script>
<tr><td>
 <form enctype="multipart/form-data" method="post" onsubmit="return(myOnSubmitEventHandler());">
 
  <input type="hidden" name="DocId" value="#(DocId)#" >
  Добавить изображение товара<br>
  <input name="oFile1" id="oFile1" size=30 type=file style="width:200px">
  <input type="submit" value="загрузить" style="width:80px"><br>
  Сжимать картинку до размера 800px по широкой стороне <input type="checkbox" name="resize" value="1" style="width:15px;border:none">
 </form>
 <input type="button" value="Фотографии" onclick="ShowFoto()">
<tr height=100%><td>
<SKLADiGrid:iGrid id="docstr" width="100%" height="300" Enabled="true"/>
<tr><td>
<center><br>
<CSP:IF CONDITION="Stat'=2">
<sklad:Button value="Сохранить" onclick="startFun();">
</CSP:IF>
<sklad:Button onclick="winclose();" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="instrhistory.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
s instr=%request.Get("instr")
</script>
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
sessionid="#(%session.SessionId)#";

function load(){
ddd.loadfrommethod("Operation.InstrActions.InstructHist","#(instr)#",2,3)
}

</script>
</head>
<body onload="load()" >
 <SKLADList:listview width=100% height=200 id="ddd" /><br>
</body>
</html>]]></CSP>


<CSP name="instrstates.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Система складского учёта </title>

</head>
<body>
<table width=100% height=100%><tr><td width=100% height=100% align="center" valign="middle">
<Script language="cache" runat="server">

 s cl=##class(%Dictionary.PropertyDefinition).%OpenId("Operation.Instructions||State")
 s DISPLAYLIST=cl.Parameters.GetAt("DISPLAYLIST")
 s VALUELIST=cl.Parameters.GetAt("VALUELIST")
 f i=4:1:$L(DISPLAYLIST,",")-1 d
 . w "<input style=""border:solid 1;width=250"" type=button value="""_$P(DISPLAYLIST,",",i)_""" Tag="""_$P(VALUELIST,",",i)_""" onclick=""returnValue=this.Tag;window.close();""><br>"

</script>
</td></tr></table>
</body>
</html>


]]></CSP>


<CSP name="InventarizationIgrid.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 .  s login=$G(%session.Data("user"))
 . i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 
Quit 1
</script>
<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV9.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:170px;cursor:hand;}
.ZakazInstr{display:inline;}
</style>
<script language="jscript" src="common.js"></script>
<title>Инвентаризация</title>

<script language="Jscript">
var DocId='#(%request.Get("source"))#';
var sessionid="#(sessionid)#";

function ChooseAddress(Obj,depot)
{
	//alert(1);
	if(!window.confirm("Операция изменит все строки данной инвентаризации (если они есть). Продолжить?")){return }
	//alert(2);
	//docstr.Clear();
	//alert(3);
	var depot=ReturnSpace(depot);
	//alert(4);
	var newItem=window.showModalDialog("storemodal2.csp?depot="+depot,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;");
	//alert(5);
	if(newItem!=null){if(newItem.split("~")[0]=="changedepot"){DictClick(tr,newItem.split("~")[1])}}
	if(newItem==null){return false;}
	var newArr=newItem.split(InnerSplitter);
	Obj.innerText=newArr[1];
	Obj.Tag=newArr[0];
	docstr.loadfrommethod("Docs.Action2.BlockAndShowCells",Obj.Tag);
}

function load(){
FillDocStr();
}

function FillDocStr(){
var Captions = new Array(6);
var Keys = new Array(6);
var Tags = new Array(6);
var Widths = new Array(6);

Captions[0]="Ячейка";
Captions[1]="Товар";
Captions[2]="Количество по плану";
Captions[3]="Количество фактическое";
Captions[4]="Цена";
Captions[5]="Сумма";

Tags[0]="Store.Address";
Tags[1]="Goods.Goods";
Tags[2]="%Numeric";
Tags[3]="%Numeric";
Tags[4]="%Numeric";
Tags[5]="%Numeric";

Keys[0]="addr";
Keys[1]="Goods";
Keys[2]="quantplan";
Keys[3]="Quantity";
Keys[4]="Price";
Keys[5]="Total";

Widths[0]=200;
Widths[1]=240;
Widths[2]=90;
Widths[3]=90;
Widths[4]=60;
Widths[5]=60;
docstr.DrawHeaders(Captions,Keys,Tags, Widths);
if(DocId!="")
	{
	docstr.loadfrommethod("Docs.Action2.InventStr",DocId);
	}
}

// сохранить
function startFun(){
xmlDoc=docstr.GetXmlContentByRows();
InsertXmlHeader(xmlDoc,"Summa",docstr.GetTableSumma(),"%String")
InsertXmlHeader(xmlDoc,"Name",Name.value,"%String")
InsertXmlHeader(xmlDoc,"Comment",Comment.value,"%String")
InsertXmlHeader(xmlDoc,"Address",Address.Tag,"Store.Address")

var DocID=SendXml(DocId,"Docs.Invent",xmlDoc,sessionid);
if(isNaN(DocID)){alert(DocID)}
else{returnValue=1;window.close();}
}

//Добавить товар
function AddGood(){
WinResult=window.showModalDialog("selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
if(WinResult==null)return
WinResult=WinResult.split(StringSplitter)
docstr.AddRowsInstruct(WinResult)
}

// удалить строку
function RemoveRow(){
docstr.RemoveSelectedRows()
}

// Очистить список
function ClearGrid(){
if(window.confirm("Удалить все товарные строки?"))docstr.Clear()	
}
</script>
</head>

<body onload="load()" onkeypress="ManageWindow();">
<table width=100%><tr><td>
<table class="LeftTop" cellspacing=0 width=100%>
<script language="cache" runat="server">
 s DocId=%request.Get("source")
 i DocId {
 	&sql(select Name,Comment,CloseDate,CloseTime,CloseUser->Name,Stat,Summa,Address,Common.SqlProcs_AddrPath(Address) into 
 	:Name,:Comment,:CloseDate,:CloseTime,:CloseUserName,:Stat,:Summa,:Address,:AddressPath
 	from Docs.Invent where ID=:DocId)
 	i SQLCODE w "<tr><td colspan=4>Ошибка при выводе инструкции "_DocId_"<br>SQLCODE="_SQLCODE_"</td></tr>"
 	i Stat=2 d
 	. s ClosedString=CloseUserName_" "_$S(CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(CloseTime:$ZT(CloseTime),1:"")
 	. s SaveButtonStyle="display:none"
 }

w "<tr>"
	w "<td class=RightBottom>Краткое описание (номер)<td class=RightBottom><input type=text id=Name MAXLENGTH=50 value='"_$G(Name)_"'>"
	w "<td class=RightBottom>Комментарий<td class=RightBottom><input type=text id=Comment MAXLENGTH=1000 Value='"_$G(Comment)_"'>"
w "</tr>"

w "<tr>"
	w "<td class=RightBottom>Блокировать<td class=RightBottom><span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseAddress(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""Address"" Tag='"_$G(Address)_"'>"_$G(AddressPath)_"</span>"
	w "<td class=RightBottom>Сумма"
	w "<td class=RightBottom>"_$G(Summa)_"&nbsp;"
w "</tr>"

w:$G(ClosedString)'="" "<tr><td colspan=4 class=RightBottom>Инструкция завершена <i>"_ClosedString_"</i>"
</script>
</table>
<tr height=100%><td>
<SKLADiGrid:iGrid id="docstr" width="100%" height="300" Enabled="true"  /><br>
<sklad:Button value="Добавить товар" onclick="AddGood();" style="width:150px">
<sklad:Button value="Удалить строку" onclick="RemoveRow();" style="width:150px">
<sklad:Button value="Очистить строки" onclick="ClearGrid();" style="width:150px">
<tr><td>
<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</table>

</body>
</html>]]></CSP>


<CSP name="JQGoods.csp" application="/csp/sklad2/" default="1"><![CDATA[
<server>
 s Command=%request.Get("Command")

 if Command="Groups"
 {
	 s count=0
	 s Catalogue=%request.Get("Cat")
	 s term = $Zcvt(%request.Get("term"),"i","UTF8")
	
	 s term = "%"_$ZCVT(term,"U")_"%"

	 &sql(select count(ID) into :RowsCount from Goods.Group 
	 	where Catalogue=:Catalogue
	 	and 
	 	{fn UCASE(Name)} Like :term
	 	)
	 
	 &sql(declare gr cursor for 
	 	select ID,Name,Code
	 	into :ID,:Name,:Code
	 	from Goods.Group
	 	where Catalogue=:Catalogue
	 	and 
	 	{fn UCASE(Name)} Like :term
		)
	 	
	 &sql(open gr)
	 w "["
	 for  
	 {
		 &sql(fetch gr)
		 Q:SQLCODE
		 i $I(count)
		 w "{""label"":"""_Name_""",""id"":"""_Code_"""}"
		 if (count<RowsCount) w ","
	 }
	 w "]"
	 &sql(close gr)
 }
</server>		 
]]></CSP>


<CSP name="JQGridData.csp" application="/csp/sklad2/" default="1"><![CDATA[
<server>

//операции поиска
 s Operations("bw")=" %STARTSWITH "
 s Operations("eq")="="
 s Operations("ne")="<>"
 s Operations("lt")="<"
 s Operations("le")="<="
 s Operations("gt")=">"
 s Operations("ge")=">="
 s Operations("ew")=" LIKE "
 s Operations("cn")=" LIKE "
 /*
 bw - begins with ( LIKE val% )
eq - equal ( = )
ne - not equal ( <> )
lt - little ( < )
le - little or equal ( <= )
gt - greater ( > )
ge - greater or equal ( >= )
ew - ends with (LIKE %val )
cn - contain (LIKE %val% )
 */
 
 //временный глобал в котором будет лежать результат выборки
 s glob = $NA(^TempGlob($J))
 k @glob
 
// параметры запроса 	
 s page = %request.Get("page")
 s rows = %request.Get("rows")
 s sidx = %request.Get("sidx")
 s sord = %request.Get("sord")
 s cl = %request.Get("cl")
 
 //запишем в glob значения объектов
 d ..SelectClassData(cl,glob)
	
 s TotalPages = +$G(@glob@("TotalPages"))
 s TotalCount = +$G(@glob@("TotalCount"))
 
 //выведем в формате JSON
 //
 //заголовок справочника
 &html<{"page":"#(page)#","total":#(TotalPages)#,"records":"#(TotalCount)#","rows":[
	>
 
 //тело
 d ..Show(glob)
 w "]}"
 
k @glob
</server>

<script language="Cache" method="SelectClassData" arguments="ClassName:%String,glob:%String" returntype="%String">
 //выбрать данные класса ClassName, записать в глобал glob
 	
 n Description,Array,i,rs,ok,obj,ID,rownumber,PropertyName,PropertyType,SqlRequest,Properties,count
 	
 s $ZT="error^error"
 	
 
 s SqlRequest = "select TOP "_(page*rows)_" ID from "_ClassName
 s CountSqlRequest = "select count(*) as countRows from "_ClassName
 
 //если был затребован поиск
	if %request.Get("_search")="true"
	{
		s Operation = Operations(%request.Get("searchOper"))
		s value=$ZCVT(%request.Get("searchString"),"U")
		if %request.Get("searchOper")="ew" s value=value_"%"
		if %request.Get("searchOper")="cn" s value="%"_value_"%"
		
		s SearchField = %request.Get("searchField")
		
		//если был WHERE, добавим его
		s SqlRequest=SqlRequest_" where {fn UCASE("_SearchField_")} "_Operation_"'"_value_"'"
		s CountSqlRequest=CountSqlRequest_" where {fn UCASE("_SearchField_")} "_Operation_"'"_value_"'"
	}
 s SqlRequest=SqlRequest_" order by "_sidx_" "_sord	
 
 //количество строк
 s @glob@("TotalCount") = +$LG(..SingleRowSqlRequest(CountSqlRequest))
 //количество страниц
 s:rows>0 @glob@("TotalPages") = $NORMALIZE(@glob@("TotalCount")/rows,0)
 
 //получить метаданные (список полей)	
 d ..GetClassMetadata(ClassName,.Description,.Array)
 	
    //запрос
	s rs = ##class(%ResultSet).%New()
	s ok=rs.Prepare(SqlRequest)
	s LastNumber = $O(Array(""),-1)
	s ok=rs.Execute()
	
	//бежим по указанному справочнику, извлекаем ID
	while rs.Next()
	{
		if $i(count)
		if count<(((page-1)*rows)+1) continue
		
		s ID = rs.Data("ID")
	   //для каждого ID открываем объект и пишем в глобальку, в формате JSON
		s obj = $ZOBJCLASSMETHOD(cl,"%OpenId",ID)
		s rownumber = $I(@glob)
		
		s @glob@("data",rownumber) = "{""id"":"""_ID_""","
	   //бежим по свойствам объекта и выводим их в формате JSON
		s i=""
		for  
		{
			s i = $O(Array(i))
			q:i=""
			s PropertyName = $G(Array(i,"Name"))	//название свойства объекта
			s PropertyType = $G(Array(i,"Type"))	//тип свойства объекта
			
			s PropertyValue = ..GetPropertyValue(obj,PropertyName,PropertyType)
			
			s @glob@("data",rownumber) = @glob@("data",rownumber)_""""_PropertyName_""":"_""""_$ZCVT(PropertyValue,"O","JS")_""""
			
			//если это не последнее, добавим запятую
			if i'=LastNumber s @glob@("data",rownumber) = @glob@("data",rownumber)_","
		}
		s @glob@("data",rownumber) = @glob@("data",rownumber)_"}"
	}
	
	q
</script>
<script language="Cache" method="GetPropertyValue" arguments="obj:%String,PropertyName:%String,PropertyType:%String" returntype="%String">
 //получить значение свойства объекта
 
 n (obj,PropertyName,PropertyType)
 s $ZT="error^error"
 
 s PropertyValue = $ZOBJPROPERTY(obj,PropertyName)	//значение этого свойства
			
//если значение свойства - объект (небольшая условность, каждый справочник имеет поле Name)
if $ISOBJECT(PropertyValue) s PropertyValue = $ZOBJPROPERTY(PropertyValue,"Name")
if PropertyType="%Date" s PropertyValue=$P($ZD(PropertyValue,4),"/",1,2)_"/"_+$ZD(PropertyValue,3)
 
Quit PropertyValue
</script>
<script language="Cache" method="Show" arguments="glob:%String" returntype="%String">
//выводим строки справочника
 s i="" for  
 {
	 s i = $O(@glob@("data",i),1,data)
	 q:i=""
	 
	 w data
	 
	 //если это не последний 
	 if $O(@glob@("data",i))'="" w ","
 }

 Quit ""
</script>
<script language="Cache" method="SingleRowSqlRequest" arguments="SqlRequest:%String" returntype="%String">
 // выполнить единичный запрос к базе

 n rs,ok,i,result
 
 s $ZT="error^error" 
 
 s rs = ##class(%ResultSet).%New()
 s ok=rs.Prepare(SqlRequest)
 s ok=rs.Execute()
 d rs.Next()
 
 s result=$LB("")
 for i=1:1:rs.GetColumnCount() 
 {
	 s $LIST(result,i)=rs.GetData(i)
 }
 
 Quit result
</script>
<script language="Cache" method="GetClassMetadata" arguments="ClassName:%String,Description:%String,Array:%String" returntype="%String">
 n Number,i,PropertiesCount,classobj,PropertyObj
 k Array
 
 q:$G(ClassName)=""
 s classobj = ##class(%Dictionary.ClassDefinition).%OpenId(ClassName)
 q:'$ISOBJECT(classobj)
 
 s Description = classobj.Description
 s PropertiesCount = classobj.Properties.Count()
 
 for i=1:1:PropertiesCount
 {
	 s Array=i
	 s PropertyObj = classobj.Properties.GetAt(i)
	 
	 s Array(i,"Name") = PropertyObj.Name
	 s Array(i,"Description") = PropertyObj.Description
	 s Array(i,"Type") = PropertyObj.Type
 } 
 Quit ""
</script>
]]></CSP>


<CSP name="JQserials.csp" application="/csp/sklad2/" default="1"><![CDATA[
<server>
 s Command=%request.Get("Command")
 
 if Command="Search"
 {
	 s indexName=%request.Get("SMode")
	 s SearchString=%request.Get("term")

	 s glob=$NA(^Common.Dictionary2I(indexName)) ; по какой глобали будем искать 
 	 , SearchString = " "_$ZCVT(SearchString,"U") ;приводим к индексному виду 
	 s i=SearchString s i=$O(^Common.Dictionary2I(indexName,i),-1) ;шаг назад
	 s count=0
	 w "["
		 
 	for { 
 		s i=$O(^Common.Dictionary2I(indexName,i)) 
 		Q:(i="")||($f(i,SearchString)=0)||(count>10) 
  		i $i(count)
  		w """"_$E(i,2,$L(i))_""""
  		s next=$O(^Common.Dictionary2I(indexName,i)) 
  		if '(next=""),'($f(next,SearchString)=0),'(count>10) w ","
 	}
 	
	 w "]"
 }
</server>]]></CSP>


<CSP name="justempty.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 //эту страницу вызывает страница toolbar.csp для поддержания сессии
 s ses=%request.Get("sessionid",1)
 s %session=%session.GetSession(ses)
</script>
]]></CSP>


<CSP name="kontr.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,2) s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type='text/css' rel=stylesheet />
<link rel='stylesheet' type='text/css' 
    href='css/redmond/jquery-ui-1.8.16.custom.css'
    class='ui-theme'
/>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var ColCode="";
sessionid="#(%session.SessionId)#";
var where =""
var CurrentKontrShown = false;
var currentKontragent="";

function load()
{
    currentdict.LoadHeaders();
    dfdf.attachEvent("onAddColumns", showgoods)
    dfdf.LoadHeaders("izdelie");
    docums.LoadHeaders();
    docums2.LoadHeaders();
    Otchets.LoadHeaders();
}

//работа в режиме одной страницы 
function wStatus( msg ){
    if (parent && (parent.statusFR)){
         parent.statusFR.WriteStatus( msg );
    }
}

//вывод отчетов
function showOtchet(where)
{
    wStatus("Идёт вывод списка отчётов...");
    var where=ReturnSpace(where);
    Otchets.DownLoad(where);
    wStatus("");
}

//вывод контрагентов
function showdictionary(where)
{
    wStatus("Идёт вывод списка контрагентов...");
    var where=ReturnSpace(where);
    var made=false;
    currentdict.DownLoad(where);
    wStatus("");
}

function gg()
{
    if(ColCode=="")return false;
    where = ColCode+" %STARTSWITH '"+fldval.value+"'";
    if(fldval.value=="")where="";
    showdictionary(where);
}

//клик на колонке в таблице контрагентов
function colclick()
{
    if(currentdict.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
    namfld.innerText=currentdict.ColName;
    ColCode=currentdict.ColCode;
}

// 
function addrecord(currentrecord)
{
    var currentrecord=ReturnSpace(currentrecord)
    ok=window.showModalDialog("kontragent.csp?KontrId="+currentrecord,"","status:no;dialogHeight:708px;dialogWidth:800px;resizable:yes;")
    if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}
}

//показать запчасти на балансе контрагента
function showgoods()
{
    dfdf.detachEvent("onAddColumns", showgoods);
    if(currentKontragent=="")return;
    parent.statusFR.WriteStatus("Идёт вывод списка запчастей на балансе...");
    dfdf.loadfrommethod("Reports.Analyzis.GoodsOnKontr",currentKontragent);
    parent.statusFR.WriteStatus("");
    KontrNameSpan.innerText=currentdict.ItemName
}

function showdocums()
{
    currentKontragent=currentdict.ItemID;
    if(currentKontragent=="")return
    wStatus("Идёт вывод списка поставок...");
    dateArr=dat1.value.split("/")
    Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    dateArr=dat2.value.split("/")
    Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
    if(currentKontragent!="all"){var request=request+" and Kontr="+currentKontragent}
    if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
    if(RashTypes.value!=0)
    {
        if(RashTypes.value==1)var request=request+" and Summa=OplSumma"
        if(RashTypes.value==2)var request=request+" and (Summa<>OplSumma and OplSumma>0)"
        if(RashTypes.value==3)var request=request+" and (OplSumma=0 or OplSumma='' or OplSumma is Null)"
    }
    docums.DownLoad(request);
    wStatus("");
}

function showdocums2()
{
    var currentKontragent=currentdict.ItemID;
    if(currentKontragent=="")return
    wStatus("Идёт вывод списка платежей...");
    dateArr=dat11.value.split("/")
    Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    dateArr=dat22.value.split("/")
    Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
    var request="Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE)";
    if(currentKontragent!="all"){var request=request+" and Kontr="+currentKontragent}
    if(DocName.value!=""){var request=request+" and Name %STARTSWITH '"+DocName.value+"'";}
    if(PlatejTypes.value!=0)
    {
        if(PlatejTypes.value==1)var request=request+" and (not Rash is null or Rash<>'')";
        if(PlatejTypes.value==2)var request=request+" and (Rash is null or Rash='')";
    }
    docums2.DownLoad(request);
    wStatus("");
}

//показать данные по контрагенту
function ShowKontrData()
{
    currentKontragent=currentdict.ItemID;
    showdocums();
    showdocums2();
    showgoods();
    CurrentKontrShown = true;
    showOtchet("Kontr="+currentKontragent+" and GotPaperProve=1");
}

//клик по контрагенту
function KontrClick()
{
    CurrentKontrShown = false;
    KontrName.innerText=currentdict.ItemName
    KontrBalance.innerText=currentdict.item("Balance")
}

function processdoc(ItemID)
{
    if(ReturnSpace(ItemID)=="")return
    var doc=ItemID+"@Docs.Platejka";
    var ok=#server(Docs.Action.processdoc(doc))#
    if(isNaN(ok))
    {
        alert(ok);
    }
    else
    {
        showdocums2();
        if(KontrBalance.innerText!=""){var OldBalance=parseInt(KontrBalance.innerText);}
        else{var OldBalance=0;}
        var NewBalance=parseInt(docums2.item("Summa"));
        KontrBalance.innerText=OldBalance+NewBalance;
        alert("Документ успешно обработан");
    }
    return ok;
}

function CreateDocument(ItemID,CurrentDocementClass)
{
    var doccsp="document.csp";
    if(CurrentDocementClass=="Docs.Platejka")doccsp="docplatej.csp?DocId="+ReturnSpace(ItemID)
    WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
    if(WinResult==1)
    {
        if(CurrentDocementClass=="Docs.Rash")showdocums();
        if(CurrentDocementClass=="Docs.Platejka")showdocums2();
    }
}

//открыть окно для разноски платёжки по расходным накладным
function OpenPlatejWindow(ItemID)
{
    if(ReturnSpace(ItemID)=="")return
    WinResult=window.showModalDialog("PlatejRash.csp?DocId="+ItemID,"","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function ClearPlatejkaItems()
{
    if(!window.confirm("Очистить привязку платёжного поручения к отгрузкам?"))return
    var ok=#server(Docs.Action.ClearPlatejkaItems(docums2.ItemID))#
    if(isNaN(ok)){alert(ok)}
    else{alert("Привязка платёжного поручения к отгрузкам очищена. Укажите на какие отгрузки следует разнести платёж.")}
}

function PayRashFn(DocId)
{
    if(ReturnSpace(DocId)=="")return;
    var DocId=#server(Docs.Action.CreatePlatejForRash(DocId))#
    if(isNaN(DocId)){ alert(DocId); }
    else
    {
        if(window.confirm(("Платёжный документ успешно создан. Открыть для редактирования?")))CreateDocument(DocId,'Docs.Platejka')
        if(window.confirm(("Обработать документ?")))
        {
            var ok=processdoc(DocId);
            if(isNaN(ok))
            {
                alert(ok);
            }
            else
            {
                showdocums2();
                showdocums();
            }
        }
    }
}

function fnMeetingResult()
{
    var KontrId=currentdict.ItemID;
    if(KontrId=="")return;
    var ok=window.showModalDialog("KontrMeetingResult.csp?Kontr="+KontrId,"","status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}

function fnKontrList()
{
    var ok=window.showModalDialog("KontragentsListEdit.csp?Where="+where,"","center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;")
    if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}
}

// добавить запчасть на баланс контрагенту
function AddGoodsToKontr()
{
    if(!CurrentKontrShown)
    {
        alert("Что бы зачислить товары или запчасти на баланс контрагента, пожалуйста выберете контрагента и нажмите кнопку 'Вывести информацию по контрагенту'");
        return;
    }
    WinResult=window.showModalDialog("selectgoods2.csp?OnlyID=1","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
    if(WinResult==null)return
    var quant=window.prompt("Укажите количество для каждой запчасти","1");
    if (quant==null) return;
    ok = #server(Common.Common.AddGoodsToKontr(currentKontragent,WinResult,quant))#
    if(isNaN(ok)){alert(ok);}
    else{showgoods();}
}

// снять запчасти с баланса контрагента
function MoveGoodsFromKontr()
{
    var quant=0;
    if(!CurrentKontrShown)
    {
        alert("Что бы снять товары или запчасти с баланса контрагента, пожалуйста выберете контрагента и нажмите кнопку 'Вывести информацию по контрагенту'");
        return;
    }
    if(!window.confirm("Снять отмеченные запчасти с баланса контрагента?"))return;
    ResultArray=dfdf.ListViewGetItems("selected",1);
    if(ResultArray.split("#@#").length==2)
    {
        quant = window.prompt("Введите количество которое спишется с контрагента",1);
        if (quant==null) return
    }
    else
    {
        if(!window.confirm("Внимание! Указано несколько строк. Все указанные позиции спишутся с контрагента полностью. Чтобы списывать поштучно, указывайте только одну строку. Продолжить списание позиций полностью?"))return;    
    }

    ok = #server(Common.Common.RemoveGoodsFromKontr(currentKontragent,ResultArray,quant))#
    if(isNaN(ok)){alert(ok);}
    else{showgoods();}  
}

/// Открыть акт сверки
function ActSverki()
{
    var SelectedKontr = currentdict.ItemID
    if(SelectedKontr=="")
    {
        alert("Выберете, пожалуйста, контрагента.");
        return;
    }
    
    var WinResult=window.showModalDialog("SverkaParams.csp?KontrId="+SelectedKontr,"","center:yes;status:no;dialogHeight:200px;dialogWidth:400px;resizable:yes;")
    if(WinResult==null){return;}

    var kontr1id=WinResult.split("@")[2];
    
    var dat1=WinResult.split("@")[0];
    var dat2=WinResult.split("@")[1];
    
    //window.open("screen/Sverka.csp?Kontr1Id="+kontr1id+"&Kontr2Id="+kontr2id+"&dat1="+dat1+"&dat2="+dat2);
    
    window.open("screen/ActSverki.csp?kontr="+SelectedKontr+"&dat1="+dat1+"&dat2="+dat2+"&OurCompany="+kontr1id);
}
</script>
</head>
<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Учёт отгрузок и платежей</strong></TD>
<td width=10% align=right><a href="help/Platej.html"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>
<br>
<fieldset><legend>Контрагенты</legend>

<table>
    <tr>
        <td>
            <img src="images/big/Money.gif" onmouseover="this.src='images/big/OnMoney.gif'" onmouseout="this.src='images/big/Money.gif'" alt="Взаиморасчёт" onclick="showdictionary('WCalc2=2');">
            <img src="images/big/Book.gif" onmouseover="this.src='images/big/OnBook.gif'" onmouseout="this.src='images/big/Book.gif'" alt="Безналичные расчёты" onclick="showdictionary('WCalc2=1');">
        <td>
Поиск:
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
</table>

<SKLADList:listview width=100% height=150 id="currentdict" zClick="KontrClick()" zonDblClick="addrecord(currentdict.ItemID);" zonColumnClick="colclick()" onAddColumns="showdictionary()" ClassName="Common.Kontragent"/><br>
<table width=100%><tr><td>
  <sklad:LittleButton name="new" id="newrec" onclick="addrecord()" alt="Создать контрагента">
  <sklad:LittleButton name="edit" id="addrec" onclick="addrecord(currentdict.ItemID)" alt="Редактировать данные контрагента">
  <sklad:LittleButton name="down" id="showdata" onclick="ShowKontrData()" alt="Вывести информацию по контрагенту">
  <sklad:LittleButton name="history" id="btnKontrListEdit" onclick="fnKontrList()" alt="Редактировать список контрагентов">
  <sklad:LittleButton name="user" id="btnUser" onclick="fnMeetingResult()" alt="История общения с контрагентом">
  
  <button id="bUser2" class="ui-button">
     <span class='ui-icon ui-icon-comment'>провести</span>
  </button>
  
  <sklad:LittleButton name="price" id="btnActSver" onclick="ActSverki()" alt="Акт сверки">
  <sklad:LittleButton name="goinside" id="btnBalance" onclick="window.open('csp.KontragentAccount.cls?id='+currentdict.ItemID)" alt="История баланса">
</td><td align=right>
    Поддерживать таблицу в актуальном состоянии
    <input type=checkbox id="makeShowDict" checked style="width:20pt;border:none;">
</td>
</tr>
</table>
</fieldset><br>
<span style="FONT-size: 15px ; font-family: arial; COLOR: rgb(0,0,102);">&nbsp;<span id="KontrName"></span> <span style="font-family: Times" id="KontrBalance"></span></span>


<br><br>
<fieldset><legend>Отчёты</legend>
<SKLADList:listview width=100% height=150 id="Otchets" ClassName="Docs.Otchet"/><br>
</fieldset>


<br><br>
<table width=100%>
<tr><td width=50% valign=top>
<fieldset><legend>Отгрузки</legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
 <input type="text" id="DocName"> 
<select id="RashTypes">
    <option value=0>Все</option>
    <option value=1>Полностью оплаченные</option>
    <option value=2>Частично оплаченные</option>
    <option value=3>Не оплаченные</option>
</select>
<sklad:LittleButton name="ok" id="okbut" onclick="showdocums()" alt="Показать документы"><br>
<!-- Таблица отгрузок -->
<SKLADList:listview width=100% height=200 id="docums" ClassName="Docs.Rash" /><br>
<sklad:LittleButton name="edit" id="editrash" onclick="CreateDocument(docums.ItemID,'Docs.Rash')" alt="Редактировать документ">
<sklad:LittleButton name="card" id="PayRashButton" onclick="PayRashFn(docums.ItemID)" alt="Оплатить расходную накладную">
</fieldset>
</td>
<td width=50% valign=top>
<fieldset><legend>Платежи</legend>
Период c <input type=text id="dat11" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat22" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
 <input type="text" id="DocName2"> 
<select id="PlatejTypes">
    <option value=0>Все</option>
    <option value=1>Зачисленные</option>
    <option value=2>Не зачисленные</option>
</select>
<sklad:LittleButton name="ok" id="okbut2" onclick="showdocums2()" alt="Показать документы"><br>
<!-- Таблица платежей -->
<SKLADList:listview width=100% height=200 id="docums2" ClassName="Docs.Platejka" /><br>
<sklad:LittleButton name="new" id="newbut" onclick="CreateDocument('','Docs.Platejka')" alt="Внести платёж">
<sklad:LittleButton name="edit" id="editplatej" onclick="CreateDocument(docums2.ItemID,'Docs.Platejka')" alt="Редактировать документ">
<sklad:LittleButton name="del+" id="delplatejkaitems" onclick="ClearPlatejkaItems()" alt="Очистить оплачиваемые расходные накладные">
<sklad:LittleButton name="price" id="pricebut" onclick="OpenPlatejWindow(docums2.ItemID)" alt="Разнести платёжный документ по расходным накладным">
<sklad:LittleButton name="ok" id="okbut22" onclick="processdoc(docums2.ItemID)" alt="Обработать документ">
</fieldset>
</td>
</tr>
</table>
<fieldset><legend>Запчасти на балансе <span id="KontrNameSpan"></span></legend>
 <SKLADList:listview width=100% height=200 id="dfdf"  ClassName="Goods.Goods" /><br>
<sklad:LittleButton name="new+" id="AddDetail" onclick="AddGoodsToKontr()" alt="Добавить деталь на баланс контрагента">
<sklad:LittleButton name="del" id="RemoveDetail" onclick="MoveGoodsFromKontr()" alt="Убрать деталь с баланса контрагента">
<sklad:LittleButton name="history" id="HistoryDetail" onclick="alert('Функция не реализована')" alt="История этой детали на балансе контрагента">
</fieldset>
<script type="text/javascript">
    var $on=("v"=="\v")?function(o,e,h){
        o.attachEvent("on"+e,h);
                      }:function(o,e,h){
        o.addEventListener(e,h,false);                
    }; 
    
    $on(window,"load",function(){
        var $g=function(id){return document.getElementById(id);};
        var bUser2=$g("bUser2");  
        bUser2.setAttribute("title","*New: Переписка с контрагентом+отправка файла");
        $on(bUser2,"click",function(){
            var k=currentdict.ItemID; if(k=="")return;

            var ok= window.showModalDialog( 
                "csp.Chat2Ka.cls?Kontr="+k
                ,""
                ,"center:yes;status:no;dialogWidth:800px;dialogHeight:600px;resizable:yes;"
            ); 

        });
    });


</script>
</body>
</html>]]></CSP>


<CSP name="kontragent.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"),0)
 //i '+login s %response.ServerSideRedirect="norights.csp" 
 s Access10func=##class(Common.Rights).getrights(+login,10)
 s Access11func=##class(Common.Rights).getrights(+login,11)
 if 'Access10func s Func10Refuse="return;"
Quit 1
</script>
<script language="cache" runat="server">
 s KontrId=%request.Get("KontrId")
</script>
<html>
<head>

<title>Контрагент #(KontrId)#</title>

<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var KontrId="#(KontrId)#";
var sessionid="#(sessionid)#";

function ChooseRegion2(Obj,ClassName)
{
	newItem=window.showModalDialog("Dictionary.csp",ClassName,"center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	if(newItem==null){return false;}
	var newArr=newItem.split(InnerSplitter);
	Obj.innerText=newArr[1];
	Obj.Tag=newArr[0];
}

function startFun()
{
	#($G(Func10Refuse))#
	var xmlDoc = new ActiveXObject("Msxml2.DOMDocument.3.0");
	var RootElement = xmlDoc.createElement("RootElement");
	xmlDoc.documentElement=RootElement;
	
	//"Region",
	var Properties= new Array("Name","Status","Address","AddressUr","City","CityUr","Postalcode","PostalcodeUr","chief","ContPers","glavbuh","Agree","CityCode","EMail","Phones","fax","Code","Password","Activity","Property2506","Koeff","Manager","OtgruzPrincip","Property126","Property127","Property831","WCalc","Currency","Comment","Discount","NDSPayment","NotifyEmails","IsWe","AdPhone","Pseudonym","Holding");
	
	for(var i=0;i<Properties.length;i++)
	{
		var elementObject = document.getElementById(Properties[i])
		if(elementObject==null)continue;
		var elementValue=elementObject.value;
		InsertXmlHeader(xmlDoc,Properties[i],elementValue,"%String");
	}
	
	InsertXmlHeader(xmlDoc,"region2",region2.Tag,"Users.REGION")
	InsertXmlHeader(xmlDoc,"Federal",Federal.Tag,"Common.Dictionary18")
	InsertXmlHeader(xmlDoc,"OurCompany",OurCompany.Tag,"Common.Kontragent")
	var DocID=SendXml(KontrId,"Common.Kontragent",xmlDoc,sessionid,"Docs.Action.SaveSingleGood");
	
	if(isNaN(DocID))
	{
		alert(DocID)
	}
	else
	{
		returnValue=1;
		window.close();
	}
}

function showbank(){
window.showModalDialog("bank.csp?Kontr="+KontrId,"","center:yes;status:no;dialogHeight:550px;dialogWidth:600px;resizable:yes;");
}

function windowclose(KontrId)
{
	if(NewObject)
	{
		var ok=#server(Common.Common.DeleteItem("Common.Kontragent",KontrId))#;
		if(isNaN(ok))alert("Ошибка удаления временного объекта\n"+ok);
	}
	if(window.confirm("Вы уверены?"))window.close();
}

function GeneratePassword() 
{
	 if(window.confirm("Сгенерировать новый пароль?")) 
	 {
	   var passw = #server(Common.Common.GeneratePassword())#;
	   Password.value = passw;
	 }
}

//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj)
{
	newItem=window.showModalDialog("Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	if(newItem==null){return false;}
	var newArr=newItem.split(InnerSplitter);
	Obj.innerText=newArr[1];
	Obj.Tag=newArr[0];
}

</script>
<style>
.LeftTop{border-left : 1 solid black;border-top : 1 solid black;}
.RightBottom{font-family:Arial;font-size:14px;border-right : 1 solid black;border-bottom : 1 solid black;}
SELECT{width:170px}
.Kontragent{width:100%;cursor:hand;border:solid 1 black}
</style>

</head>

<body onkeypress="ManageWindow();"><Table width=100% height=100%><tr valign=top><td>
<table width=100% class="LeftTop" cellspacing=0>
<script language="cache" runat="server">
 
 d:KontrId
 . s KontrObj=##class(Common.Kontragent).%OpenId(KontrId)
 . s NewObject="var NewObject=false;"
 if (KontrId="")&(Access10func) d
 . s KontrObj=##class(Common.Kontragent).%New()
 . d KontrObj.%Save()
 . s KontrId=KontrObj.%Id()
 . w "<script language=""jscript"">"
 . w "var KontrId='"_KontrId_"';"
 . w "</"_"script>"
 . s NewObject="var NewObject=true;"
 if $ISOBJECT($G(KontrObj)) d
 . //"Region",
 . f i="Name","Status","Address","AddressUr","City","CityUr","Postalcode","PostalcodeUr","chief","ContPers","glavbuh","Agree","CityCode","EMail","Phones","fax","Code","Password","Activity","Property2506","Koeff","Manager","OtgruzPrincip","Property831","WCalc","Comment","Balance","ChangeDate","ChangeTime","NotifyEmails","Currency","Discount","NDSPayment","IsWe","AdPhone","Pseudonym" d
 . . s @i=$ZCVT($ZOBJPROPERTY(KontrObj,i),"O","HTML")
 . s Property126=$S($ISOBJECT(KontrObj.Property126):KontrObj.Property126.%Id(),1:"")
 . s Property127=$S($ISOBJECT(KontrObj.Property127):KontrObj.Property127.%Id(),1:"")
 . s ChangeUser = KontrObj.ChangeUser
 . d:$ISOBJECT(KontrObj.region2)
 . . s region2=KontrObj.region2.%Id()
 . . s region2Name=KontrObj.region2.Name
 . d:$ISOBJECT(KontrObj.Federal)
 . . s Federal=KontrObj.Federal.%Id()
 . . s FederalName=KontrObj.Federal.Name
 . if $ISOBJECT(ChangeUser) s ChangeUser=ChangeUser.Name
 . if $ISOBJECT(KontrObj.OurCompany) d
 . . s OurCompany=KontrObj.OurCompany.%Id()
 . . s OurCompanyName=KontrObj.OurCompany.Name
 . if $ISOBJECT(KontrObj.Holding) d
 . . s Holding=KontrObj.Holding.%Id()
 . if +ChangeDate s ChangeDate=$ZD(ChangeDate,4) 
 . if +ChangeTime s ChangeTime=$ZT(ChangeTime) 
 . s CloseString=ChangeUser_" "_ChangeDate_" "_ChangeTime
 . if $ISOBJECT(KontrObj.Property831) s Property831ID=KontrObj.Property831.%Id()

 s KontragentOtgruzPrincip = ##class(Docs.Action2).GetDisplaylistOptions($G(OtgruzPrincip),"Common.Kontragent||OtgruzPrincip")
 s CommonDictionary1 = ##class(Docs.Action2).GetClassValuesOptions($G(Property831ID),"Common.Dictionary1")
 s KontragentCurrency = ##class(Docs.Action2).GetDisplaylistOptions($G(Currency),"Common.Kontragent||Currency")
 s KontragentStatus = ##class(Docs.Action2).GetDisplaylistOptions($G(Status),"Common.Kontragent||Status")
 s KontragentActivity = ##class(Docs.Action2).GetDisplaylistOptions($G(Activity),"Common.Kontragent||Activity")
 s KontragentProperty2506 = ##class(Docs.Action2).GetDisplaylistOptions($G(Property2506),"Common.Kontragent||Property2506") 
&html<
<tr>
 <td class=RightBottom>Наименование</td>
 <td class=RightBottom><input type=text id=Name MAXLENGTH=50 value="#($G(Name))#"></td>
 <td class=RightBottom>Псевдоним
 <td class=RightBottom><input type="text" name="Pseudonym" id="Pseudonym" value="#($G(Pseudonym))#">

</tr>

<tr>
 <td class=RightBottom>Адрес факт.</td>
 <td class=RightBottom><input type=text id=Address MAXLENGTH=50 value="#($G(Address))#"></td>
 <td class=RightBottom>Адрес юр.</td>
 <td class=RightBottom><input type=text id=AddressUr MAXLENGTH=50 value="#($G(AddressUr))#"></td>
</tr>

<tr>
 <td class=RightBottom>Город факт.</td>
 <td class=RightBottom><input type=text id=City MAXLENGTH=50 value="#($G(City))#"></td>
 <td class=RightBottom>Город юр.</td>
 <td class=RightBottom><input type=text id=CityUr MAXLENGTH=50 value="#($G(CityUr))#"></td>
</tr>

<tr>
 <td class=RightBottom>Индекс факт.</td>
 <td class=RightBottom><input type=text id=Postalcode MAXLENGTH=50 value="#($G(Postalcode))#"></td>
 <td class=RightBottom>Индекс юр.</td>
 <td class=RightBottom><input type=text id=PostalcodeUr MAXLENGTH=50 value="#($G(PostalcodeUr))#"></td>
</tr>

<tr>
 <td class=RightBottom>Федеральный округ</td>
 <td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class=Kontragent onclick="ChooseRegion2(this,'Common.Dictionary18')" oncontextmenu="this.innerText='';this.Tag=''" id="Federal" Tag="#($G(Federal))#">#($G(FederalName))#</span></td>
 <td class=RightBottom>Регион</td>
 <td class=RightBottom><span onmouseout="UnPaint(this)" onmouseover="Paint(this)" class=Kontragent onclick="ChooseRegion2(this,'User.REGION')" oncontextmenu="this.innerText='';this.Tag=''" id="region2" Tag="#($G(region2))#">#($G(region2Name))#</span></td>
</tr>

<tr>
 <td class=RightBottom>Директор</td>
 <td class=RightBottom><input type=text id=chief MAXLENGTH=50 value="#($G(chief))#"></td>
 <td class=RightBottom>Контактные лица</td>
 <td class=RightBottom><input type=text id=ContPers MAXLENGTH=50 value="#($G(ContPers))#"></td>
</tr>

<tr>
 <td class=RightBottom>Главбух</td>
 <td class=RightBottom><input type=text id=glavbuh MAXLENGTH=50 value="#($G(glavbuh))#"></td>
 <td class=RightBottom>№ Договора</td>
 <td class=RightBottom><input type=text id=Agree MAXLENGTH=50 value="#($G(Agree))#"></td>
</tr>

<tr>
 <td class=RightBottom>Код города</td>
 <td class=RightBottom><input type=text id=CityCode MAXLENGTH=50 value="#($G(CityCode))#"></td>
 <td class=RightBottom>E-mail</td>
 <td class=RightBottom><input type=text id=EMail MAXLENGTH=200 value="#($G(EMail))#"></td>
</tr>

<tr>
 <td class=RightBottom>Телефон</td>
 <td class=RightBottom><input type=text id=Phones MAXLENGTH=50 value="#($G(Phones))#"></td>
 <td class=RightBottom>Факс</td>
 <td class=RightBottom><input type=text id=fax MAXLENGTH=50 value="#($G(fax))#"></td>
</tr>

<tr>
 <td class=RightBottom>Телефон указанный<br>в рекламе</td>
 <td class=RightBottom><input type=text id="AdPhone" MAXLENGTH=50 value="#($G(AdPhone))#"></td>
 <td class=RightBottom>Статус</td>
 <td class=RightBottom><select name="Status" id=Status>#(KontragentStatus)#</select></td>
</tr>

<!-- разделитель -->
<tr>
 <td class=RightBottom colspan=4><br><br><br>
</tr>


<tr>
 <td class=RightBottom>Уник. номер</td>
 <td class=RightBottom><input type=text id=Code MAXLENGTH=50 value="#($G(Code))#"></td>
 <td class=RightBottom>Пароль</td>
 <td class=RightBottom><input type=text id="Password" MAXLENGTH=50 value="#($G(Password))#">&nbsp;&nbsp;<input type="button" onclick="GeneratePassword()" value="..." style="width:30px" title="Сгенерировать новый пароль"></td>
</tr>

<tr>
 <td class=RightBottom>Активность</td>
 <td class=RightBottom><select name="Activity" id=Activity>#(KontragentActivity)#</select></td>
 <td class=RightBottom>Вид деятельности</td>
 <td class=RightBottom><select name="Property2506" id=Property2506>#(KontragentProperty2506)#</select></td>
</tr>

<tr>
 <td class=RightBottom>Работает (коэф. 1-3)</td>
 <td class=RightBottom><input type=text id=Koeff MAXLENGTH=50 value="#($G(Koeff))#"></td>
 <td class=RightBottom>Менеджер</td>
 <td class=RightBottom><input type=text id=Manager MAXLENGTH=50 value="#($G(Manager))#"></td>
</tr>

<tr>
 <td class=RightBottom>Категория цен<br>электроинструмент</td>
 <td class=RightBottom><select name="Property126" id=Property126>> w ##class(Docs.Action2).GetClassValuesOptions($G(Property126),"Common.Dictionary9") &html<</select>
 <td class=RightBottom>Категория цен<br>бытовая техника</td>
 <td class=RightBottom><select name="Property127" id=Property127>> w ##class(Docs.Action2).GetClassValuesOptions($G(Property127),"Common.Dictionary9") &html<</select>
 </td>
</tr>

<tr>
 <td class=RightBottom>Принцип отгрузки</td>
 <td class=RightBottom><select name="OtgruzPrincip" id=OtgruzPrincip>#(KontragentOtgruzPrincip)#</select></td>
 <td class=RightBottom>Уведомлять при поступлении сообщений</td>
 <td class=RightBottom><input type=text id="NotifyEmails" MAXLENGTH=50 value="#($G(NotifyEmails))#"></td>
</tr> 

<tr>
 <td class=RightBottom>Способ доставки</td>
 <td class=RightBottom><select name="Property831" id=Property831>#(CommonDictionary1)#</select></td>
 <td class=RightBottom>Как рассчитываемся</td>
 <td class=RightBottom><input type=text id=WCalc MAXLENGTH=50 value="#($G(WCalc))#"></td>
</tr>

<tr>
 <td class=RightBottom>Валюта расчётов</td>
 <td class=RightBottom><select name="Currency" id="Currency">#(KontragentCurrency)#</select></td>
>

if Access11func=1 d
 . w "<td class=RightBottom>Скидка (%)</td>"
 . w "<td class=RightBottom><input type=text id=""Discount"" MAXLENGTH=10 value="""_$G(Discount)_"""></td>"
else  d
 . w "<td class=RightBottom colspan=2>Недостаточно прав для редактирования скидки</td>"
&html<
 <tr>
  <td class=RightBottom>Оплата по договору
  <td class=RightBottom><select name="NDSPayment" id="NDSPayment">
>
w ##class(Docs.Action2).GetDisplaylistOptions($G(NDSPayment),"Common.Kontragent||NDSPayment")
w "</select>",!
w "<td class=RightBottom>Наше юр. лицо с которым работает контрагент",!
w "<td class=RightBottom>",!
w "<span onmouseout=""UnPaint(this)"" onmouseover=""Paint(this)"" class=Kontragent onclick=""ChooseKonragent(this)"" oncontextmenu=""this.innerText='';this.Tag=''"" id=""OurCompany"" Tag='"_$G(OurCompany)_"'>"_$G(OurCompanyName)_"</span>"
w "</td>",!
&html<
 <tr>
  <td class=RightBottom>Кому принадлежит юр.лицо
  <td class=RightBottom><select name="IsWe" id="IsWe">
>
w ##class(Docs.Action2).GetDisplaylistOptions($G(IsWe),"Common.Kontragent||IsWe")
w "</select></td>",!
&html<
  <td class=RightBottom>Холдинг, которому принадлежит контрагент</td>
  <td class=RightBottom>
  	<select name="Holding" id="Holding">
 >
	w ##class(Docs.Action2).GetClassValuesOptions($G(Holding),"Common.Dictionary20")
 &html<
  	</select>
 </tr>
 
 <tr>
  <td class=RightBottom>Комментарий</td>
  <td class=RightBottom colspan=3>
   <textarea name=Comment id=Comment style="width:100%" ROWS=5>#($G(Comment))#</textarea>
  </td>
 </tr>
 
 <tr>
  <td class=RightBottom colspan=3>Баланс: 
   <a target="_blank" style="text-decoration: underline;" 
      href="csp.KontragentAccount.cls?id=#($G(KontrId))#"
      title="Просмотр истории баланса"
    >#(+$G(Balance))#</a> руб.
   <br>Последнее сохранение: <i>#($G(CloseString))#</i>
  </td>
  <td class=RightBottom align=center valign=middle><input type="button" style="width:250;border:0" onclick="showbank()" value="Просмотреть банковские реквизиты"></td>
 </tr>
>
</script>
</table>
</td></tr>
<tr valign=bottom><td align=center>
<CSP:IF CONDITION="Access10func=1">
 <sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#">
</CSP:IF>
<sklad:Button onclick="windowclose(#(KontrId)#);" value="Отмена">
</td></tr>
</table>
<script language="jscript">
#(NewObject)#;
</script>
</body>
</html>]]></CSP>


<CSP name="KontragentsListEdit.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 . s login=$G(%session.Data("user"))
 . //i '+login s %response.ServerSideRedirect="norights.csp" 
 e  s sessionid=%session.SessionId
 s Where=%request.Get("Where")
Quit 1
</script>

<html XMLNS:SKLADiGrid>
<IMPORT NAMESPACE="SKLADiGrid" IMPLEMENTATION="htc/iGridV7.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<title>Редактирование списка контрагентов</title>
<script language="jscript" src="common.js"></script>
 <script language="cache" runat="server">
 w "<script language=""jscript"">",!
 w "function InitFieldsArrays(){"
 s Fields="Name,Code,Address,EMail,Agree,chief,Status,Property2506,Activity,Region,City,Phones,ContPers,Federal"
 d ##class(Docs.Action2).ShowHeaders("Common.Kontragent",Fields,"docstr")
 w "}",!
 w "</"_"script>",!
 </script>
<script language="jscript">
var sessionid="#(sessionid)#";
var Where="#(Where)#";

function FillDocStr(){
InitFieldsArrays();
docstr.DrawHeaders(Captions,Keys,Tags, Widths, Combos);
docstr.loadfrommethod("Docs.Action2.KontragentsList",Where);
}

function startFun(){
xmlDoc=docstr.GetXmlContentByRows();
var ok=SendXml(1,"Common.Kontragent",xmlDoc,sessionid);
if(isNaN(ok)){alert(ok)}
else{returnValue=1;window.close();}
}
</script>
</head>

<body onload="FillDocStr();" onkeypress="ManageWindow();">
<table width=100% height=100%>
<tr height=95% valign=top><td>
	<SKLADiGrid:iGrid id="docstr" width="100%" height="550" Enabled="true"  /><br>
</td></tr>
<tr height=5% valign=bottom><td>
	<center><br><sklad:Button value="Сохранить" onclick="startFun();" style="#($G(SaveButtonStyle))#"><sklad:Button onclick="windowclose();" value="Отмена"></center>
</tr></td>
</table>
</body>
</html>
]]></CSP>


<CSP name="KontrDetailHistory.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	История детали на балансе контрагента </title>
<style>
TABLE {border-left : solid 1 black; border-top : solid 1 black;}
TD {border-right : solid 1 black; border-bottom : solid 1 black}

</style>
</head>

<body>
<script language="cache" runat="server">
 s KontrId=+%request.Get("KontrId")
 s GoodsId=+%request.Get("GoodsId")
 s user = +$G(%session.Data("user"))
 
 if '+KontrId w "Невозможно вывести историю, так как не указан контрагент.<br>" q
 if '+GoodsId w "Невозможно вывести историю, так как не указан товар.<br>" q
 
 s glob = $NA(^mtempRep(user,"KontrDetailHistory"))
 k @glob
 
 
 //цикл по основной глобали
 s i="" f  s i = $O(^t(KontrId,GoodsId,i)) q:i=""  d
 . q:'+i
 . s datetime=$G(^t(KontrId,GoodsId,i,"datetime"))
 . s user = $G(^t(KontrId,GoodsId,i,"user"))
 . s quantity = $G(^t(KontrId,GoodsId))
 . s date=$P(datetime,",",1)
 . s time=$P(datetime,",",2)
 . s counter=$i(@glob)
 . s @glob@(+date,+time,counter,"quantity")= quantity
 . s @glob@(+date,+time,counter,"user")=user
 . s @glob@(+date,+time,counter,"type")="Добавление"

 //цикл по глобали c историей
 s i="" f  s i = $O(^tHistory(KontrId,GoodsId,i)) q:i=""  d
 . q:'+i
 . s z="" f  s z = $O(^tHistory(KontrId,GoodsId,i,"history",z)) q:z=""  d
 . . q:'+z
 . . s datetime=$G(^tHistory(KontrId,GoodsId,i,"history",z,"datetime"))
 . . s user = $G(^tHistory(KontrId,GoodsId,i,"history",z,"user"))
 . . s date=$P(datetime,",",1)
 . . s time=$P(datetime,",",2)
 . . s counter=$i(@glob)
 . . s @glob@(+date,+time,counter,"user")=user
 . . s @glob@(+date,+time,counter,"type")="Добавление"
 . s datetime=$G(^tHistory(KontrId,GoodsId,i,"datetime"))
 . s user = $G(^tHistory(KontrId,GoodsId,i,"user"))
 . s date=$P(datetime,",",1)
 . s time=$P(datetime,",",2)
 . s counter=$i(@glob)
 . s @glob@(+date,+time,counter,"user")=user
 . s @glob@(+date,+time,counter,"type")="Удаление"

 //zw @glob

 s date=""
 w "<table cellpadding=8 cellspacing=0 >"
 for
 {
	 s date=$O(@glob@(date))
	 QUIT:date=""
	 
	 s time=""
	 for
	 {
		s time=$O(@glob@(date,time))
	 	QUIT:time=""
	 	
	 	s counter=""
	 	for
	 	{
		 	s counter=$O(@glob@(date,time,counter))
		 	QUIT:counter=""
		 	continue:'+counter
		 	
		 	s user=$G(@glob@(date,time,counter,"user"))
		 	s type=$G(@glob@(date,time,counter,"type"))
		 	
		 	s DateString = $S(+date:$ZD(date,4),1:"")
		 	s TimeString = $S(+time:$ZT(time),1:"")
		 	s UserString = $S(+user:##class(Users.Dates).GetPropertyValue(user,"Name"),1:"")
		 	
		 	w "<tr>"
		 		w "<td>"_type
		 		w "<td>"_DateString
		 		w "<td>"_TimeString
		 		w "<td>"_UserString
		 	w "</tr>"
	 	}
	 }
 }
 w "</table>"

 
 k @glob
</script>
</body>
</html>
]]></CSP>


<CSP name="KontrMeetingResult.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 
 #;s %response.Redirect="csp.Chat2Ka.cls" Q 1
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 i '##class(Common.Rights).getrights(login,3) s %response.ServerSideRedirect="norights.csp" 
 s HaveRightToWrite = ##class(Common.Rights).getrights(login,19)
 q 1
</script>
<html lang="ru"><head>
<link href="style.css" type=text/css rel=stylesheet>
<!-- Put your page Title here -->
<title>Результаты общений с контрагентом</title>
<script type="text/javascript"> 
//добавить результат
function AddResult(MessageType) {
	var KontrId="#(%request.Get("Kontr"))#"
		, Result=NewResult.value
		, Dat=dat.value, Tim=tim.value
	;
	
	var ok=#server(Kontragent.Action.AddMeetingResult(Result,Dat,Tim,KontrId,MessageType))#
	if(isNaN(ok)){
		alert(ok)
	} else {
		var trObject=ResTable.insertRow();
		if(MessageType==3)trObject.style.backgroundColor="#deefef";
		var tdObject=trObject.insertCell();
		tdObject.innerText=Dat+" "+Tim;
		var tdObject=trObject.insertCell();
		tdObject.innerText=Result;
	}
}

//вывести на печать
function PrintHistory() {
	AddMessageRow.style.display="none";
	ButtonsRow.style.display="none";
	MainTable.height="1%";
	window.print();
	MainTable.height="100%";
	AddMessageRow.style.display="block";
	ButtonsRow.style.display="block";
}

//копировать в буфер обмена
function CopyInClipBoard(TextCellId) {
   var TextAreaObj = document.getElementById("TextAreaText");
   var TextCellObj = document.getElementById(TextCellId);
	TextAreaObj.value = TextCellObj.innerText;
	TextAreaObj.style.display="block";
   TextAreaObj.focus()
   TextAreaObj.style.display="none";
   TextAreaObj.select()
   therange = TextAreaObj.createTextRange()
   therange.execCommand("Copy")
   alert("Данные успешно скопированы")
}

function load() {
	var id = setInterval(UpdateTime, 1000);
}

function UpdateTime() {
	var dateObj = new Date();
	var m = TwoDigits(dateObj.getMinutes());
	var h = TwoDigits(dateObj.getHours()); // + dateObj.getTimezoneOffset() / 60;
	var s = TwoDigits(dateObj.getSeconds());
	tim.value = h + ":" + m + ":" + s;
}

function TwoDigits(variable) {
	//if (variable.length==1) variable="0"+variable;
	varStr=variable.toString();
	if(varStr.length==1)varStr="0"+varStr;
	return varStr;
}
</script>
</head>

<body style="fontface:Arial" onload="load();">
<script language="cache" runat="server">
 s KontrId=%request.Get("Kontr")
 s KontrObj=##class(Common.Kontragent).%OpenId(KontrId)
 w "<table width=100% height=100% border=0 id=""MainTable"">",!
 d:$ISOBJECT(KontrObj) 
 . w "<tr height=1%><td>"
 . w "<p align=center>"_KontrObj.Name_"</p>",!
 . w "Город: "_KontrObj.City_"<br>",!
 . w "Директор: "_KontrObj.chief_" Контактные лица:"_KontrObj.ContPers_"<br>",!
 . w "Контакты: "_KontrObj.Phones_" <a href=""mailto:"_$ZCVT(KontrObj.Name,"O","HTML")_" <"_KontrObj.EMail_">"_""">"_KontrObj.EMail_"</a><br>",!
 . w "</td></tr>",!
 w "<tr height=96%><td valign=top>"
 w "<table width=100% border=1 id=""ResTable"">",!
 w "<tr><td width=1%>Дата, время</td><td width=98%>Результат разговора</td><td width=1%>&nbsp;</td></tr>"
 &sql(declare zz cursor for 
 	select ID,Dat,Tim,Result,User1->Name,MessageType,%external(MessageType),SendMailLog->Result,SendMailLog,SendMailLog->ResultCode
 	into :ID,:Dat,:Tim,:Result,:User1,:MessageType,:MessageTypeText,:SendMailLogResult,:SendMailLog,:SendMailLogResultCode
 	from Kontragent.Meeting where Kontr=:KontrId)
 &sql(open zz)
 f  &sql(fetch zz) q:SQLCODE  d
 . if MessageType=2 s color="#defefe"
 . else  if MessageType=3 s color="#deefef"
 . else  s color="#ffffff"
 . w "<tr bgcolor="""_color_""">"
 . w "<td>"_$ZDT(Dat_","_Tim,4)_"</td>"
 . w "<td><b><font size=-1>"_MessageTypeText_"</font></b> <div style=""display:inline"" id="""_ID_""" onclick=""CopyInClipBoard('"_ID_"')"">"_Result_"</div>"
 . w "<img src=""images/txt.gif"" onmouseover=""this.src='images/Ontxt.gif'"" onmouseout=""this.src='images/txt.gif'""  alt=""Копировать в буфер обмена"" onclick=""CopyInClipBoard('"_ID_"')"" style=""cursor:hand;float:right;"">"
 . if SendMailLog do
 . . if SendMailLogResultCode s ImgPath = "images/okay.png",alt="Сообщение успешно доставлено"
 . . else  s ImgPath = "images/fail.png",alt=SendMailLogResult
 . . w "<img src="""_ImgPath_""" alt="""_alt_""" style=""cursor:arrow;float:right;"">"
 . w "</td>"
 . w "<td>"_User1_"</td>"
 . w "</tr>",!
 &sql(close zz)
 w "</table>",!
 w "</td></tr>"
</script>
<tr height=1% id="AddMessageRow"><td>
	<input type="text" class="datar" id="dat" value="#($ZD(+$H,4))#"> 
	<input type="text" id="tim" style="width:70px;border:none" value="#($ZT($P($H,",",2)))#"><br>
	<Textarea id="NewResult" cols=60 rows=5></textarea><br>
	<sklad:Button value="Добавить защищённую запись" onclick="AddResult(0);" title="title" alt="Эту запись контрагент не увидит, такая запись видна только сервис менеджеру.">
	<CSP:IF Condition="HaveRightToWrite=1">	
	<sklad:Button value="Добавить ответ клиенту" onclick="AddResult(3);" title="title" alt="Эту запись контрагент может увидеть в МО в пункте Справка\Обратиться в офис">
	</CSP:IF>
</td></tr>
<tr height=1% id="ButtonsRow"><td align=right><sklad:Button value="Печать" onclick="PrintHistory();">&nbsp;&nbsp;<sklad:Button value="Закрыть" onclick="window.close();"></td></tr>
</table>
<textarea id="TextAreaText" cols="1" rows="1" style="display:none"></textarea>
</body>
</html>
]]></CSP>


<CSP name="launch.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<body>
<script language="cache" runat="server">
w "^mtempArt(""i"")="_$G(^mtempArt("i"))_"<br>"
w "^mtempArt(""isobj"")="_$G(^mtempArt("isobj"))_"<br>"
w "^mtempArt(""have"")="_$G(^mtempArt("have"))_"<br>"
w "^mtempArt(""DocClass"")="_$G(^mtempArt("DocClass"))_"<br>"

</script>
</body>
</html>]]></CSP>


<CSP name="ListData.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s ID=$G(%request.Data("ID",1))
 s Class=$G(%request.Data("Class",1))
 s skip=$G(%request.Data("skip",1))
 s show=$G(%request.Data("show",1))
 s AddArrow=+$G(%request.Data("AddArrow",1))
 s xml=$G(%request.Data("xml",1))
 s zse=$G(%request.Data("zse",1))
 if Class="" s Class="Goods.Goods"
 s str=##class(Common.Common).showheaders(Class,ID,skip,AddArrow,xml,.j,zse,show)
 w str
 q

</script>
]]></CSP>


<CSP name="ListDataxml.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s ID=%request.Get("ID")
 s Class=%request.Get("Class")
 s skip=%request.Get("skip")

 s AddArrow=+%request.Get("AddArrow")
 if Class="" s Class="Goods.Goods"
 //разобьём строку skip на глобал
 d:skip'=""
 . f i=1:1:$L(skip,",") d
 . . s skipField=$P(skip,",",i)
 . . s:skipField'="" SkipGlob(skipField)=1
 s glob=$NA(^GoodsPropOrder(Class))  //здесь лежит порядок отображения свойств
 s ExistTov=0
 d:ID]""
 . s tov=$ZOBJCLASSMETHOD(Class,"%OpenId",ID)
 . s ExistTov=1
 s cl=##class(%Dictionary.ClassDefinition).%OpenId(Class)
 s output="<?xml version=""1.0"" ?>"
 s output=output_"<AllObjects>"
 s count=cl.Properties.Count()
 f i=1:1:count d
 . q:cl.Properties.GetAt(i).Relationship
 . s output=output_"<OneObject>"
 . s Type=cl.Properties.GetAt(i).Type
 . s Name=cl.Properties.GetAt(i).Name
 . q:$D(SkipGlob(Name))
 . s:(Type'["%")&('ExistTov)&(AddArrow) Name=Name_"->Name"
 . s str=Name_"~"_cl.Properties.GetAt(i).Description
 . s DISPLAYLIST=cl.Properties.GetAt(i).Parameters.GetAt("DISPLAYLIST")
 . s VALUELIST=cl.Properties.GetAt(i).Parameters.GetAt("VALUELIST")
 . s str=str_"~"
 . i (DISPLAYLIST'="")&(VALUELIST'="") d
 . . s str=str_"DISPLAYLIST="_DISPLAYLIST_";VALUELIST="_VALUELIST
 . s str=str_"~"
 . s ObjID=""
 . d:ExistTov
 . . s Value=$ZOBJPROPERTY(tov,Name)
 . . //s:(Type="%Date")&(Value]"") Value=$ZD(Value,4)
 . . s:(Type'["%")&(Value'="") ObjID=Value.%Id(),Value=$ZOBJPROPERTY(Value,"Name")  //Если свойство объектная ссылка то извлекаем поле Name у ссылки
 . . s str=str_Value
 . . s output=output_"<"_Name_" Type="""_Type_""">"_Value_"</"_Name_">"
 . s str=str_"~"_ObjID_"@"_Type
 . s str=str_"#@#"
 . s order=$G(@glob@(Name),$P(str,"~",1))
 . s output=output_"</OneObject>"
 . //s:order="Name" order=0
 . //s Props(order)=str
 s output=output_"</AllObjects>"

 w output
 //s i="" f  s i=$O(Props(i)) q:i=""  d
 //. w Props(i)
 q 1

</script>
]]></CSP>


<CSP name="login.csp" application="/csp/sklad2/" default="1"><![CDATA[
 <server>
 s user=$G(%request.Data("user",1))
 s useres="" s ^passworders=""
  s password=$G(%request.Data("password",1))
 s depot=$G(%request.Data("depot",1))
 s SystDisk=$G(%request.Data("SystemDrive",1))
 s result=""
 i $D(%request.Data("user",1)) d
 . s:%request.IsDefinedCgiEnv("REMOTE_ADDR") REMOTEADDR=%request.GetCgiEnv("REMOTE_ADDR")
 . s LoginRight=##class(Common.Rights).login(user,password,depot,SystDisk,$G(REMOTEADDR))
 . i +$G(LoginRight) d
 . . s result="hui();"
 . e  s result="alert('"_LoginRight_"');"_result
 s login=$G(%session.Data("user"))
 
 s Goods="goods.csp"
 s DocsPage = ##class(User.Settings).GetSettingValue("DocsPage")
 if DocsPage = "" s DocsPage="docs3.csp"
 //if (user="val") s Goods="goodsJQ.csp"
</server>
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>
<style type="text/css">
 .caption {background-color:#e9f9ff;height:24px;text-align:center;vertical-align:center;margin-bottom:5px;}
 #forma {margin-top:10%;width:400px;border:1px solid #aaa;}
 .btn { border: 1px solid #676767;}
</style>
<script language="jscript" src="common.js"></script>
</head>
<body onload="onload()" onkeypress="ManageWindow(this)" >
<table width="100%"><tr><td align="center">

<form name="forma" id="forma"><input type="hidden" id="SystemDrive" name="SystemDrive">
<div class='caption'>Регистрация</div>
<table><tr><td>Склад:</td><td><select style="width:150px" name="depot">
<server>
 w ##class(Docs.Action2).GetClassValuesOptions(,"Store.Depot",,,0)
</server>
</select>
</td></tr>
<tr><td>Пользователь:</td><td width=50%><input type="text" name="user" value=#($G(%session.Data("login")))#></td></tr>
<tr><td>Пароль:</td><td><input type="password" name="password" value=#($G(%session.Data("passworders")))#></td></tr>
<tr><td colspan=2 align=center>
<button type='button' onclick="startFun()" class='btn'>Войти</button></td></tr>
</table>
</form>


</td></tr></table>

</TABLE>

<!--Собираем статистику по браузерам пользователя-->
<iframe src='#(..Link("appstat.csp"))#' frameborder='no'></iframe>

<span id="MustExist" name="MustExist" style="display:none">
<script language="cache" runat="server">
 //Здесь лежат названия файлов которые должны быть на локальном диске
 s i="" f  s i=$O(^MustExist(i)) q:i=""  d
 . w i_"/"
</script>
</span>
<CSP:IF CONDITION="login=7">
    <!--input type="text" id="edtText" style="width:300px">
<input type="button" value="test" onclick="alert(eval(edtText.value));"-->
</CSP:IF>
<script language="jscript">
// #(login)#

 function startFun() { forma.submit(); }
         
function onload(){
#(result)#
}

function hui() {
    frameElement.document.all.MainFrameSet.rows="35px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,0px,*,20px";
    frameElement.document.all.statusFR.src='csp.StatusBar.cls';
    frameElement.document.all.topFR.src='toolbar.csp';
    frameElement.document.all.goods.src="#(Goods)#";
    frameElement.document.all.docs.src="#(DocsPage)#";
    frameElement.document.all.dicts.src="dicts.csp";
    frameElement.document.all.store.src="store.csp";
    frameElement.document.all.tuneup.src="tuneup.csp";
    frameElement.document.all.chief.src="chief.csp";
    frameElement.document.all.emplight.src="csp.EmpLight3.cls";
    frameElement.document.all.analyzis.src="analyzis.csp";
    frameElement.document.all.kontr.src="kontr.csp";
    frameElement.document.all.finance.src="finance.csp";
    frameElement.document.all.director.src="director.csp";
    
}

</script>



</body>
</html>]]></CSP>


<CSP name="LogJournal.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>

<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<title>Журнал доступа к системе</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="jscript">
var ColCode="";

function gg(){
if(ColCode=="")return false;
start();
#server(Common.Rights.CloseDeadLogins())#
Show(ColCode+" %STARTSWITH '"+fldval.value+"'")
}

function colclick(){
	if(Dictionary2.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=Dictionary2.ColName;
	ColCode=Dictionary2.ColCode;
}

function load(){
start();
Dictionary2.LoadHeaders();
}

function Show(where){
where=ReturnSpace(where);
Dictionary2.DownLoad(where,"","","Dat desc,Tim desc");
end()
}

function start(){
MainNameCellText=MainNameCell.innerText;
MainNameCell.innerText="...минуточку...";
}

function end(){
MainNameCell.innerText=MainNameCellText;
}
</script>

</head>
<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%></td>
<TD width=80% id="MainNameCell" align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Журнал работы с системой</strong></TD>
<td  width=10% align=right></td>
</tr>
</table><br>
<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>
<span id="namfld"></span>&nbsp;<input type="text" id="fldval" onkeyup="gg();">
 <SKLADList:listview width=100% height=150 id="Dictionary2" zonColumnClick="colclick()" onAddColumns="Show('');" ClassName="Users.Journal" /><br>
</body>
</html>
]]></CSP>


<CSP name="LogOfCreation.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<title>Журнал сборки инструкции по отбору</title>
</head>
<body>
 <font face=Arial>
<script language="cache" runat="server">
 s doc=%request.Get("doc")
 s docObject=##class(Docs.StorageOut).%OpenId(doc)
 q:'$ISobject(docObject) 1
 s DocName=docObject.Name
 s DocDate=docObject.Dat
 s:DocDate DocDate=$ZD(DocDate,4)
 &html<
 <center>Протокол сборки инструкции по отгрузке №<b>#(DocName)#</b> от #(DocDate)#</center>
 <br><br>
 >
 s g=$NA(^LogOfCreation(doc))
 f  s g=$Q(@g) q:(g="")||($QS(g,1)'=doc)  d
 . if $QL(g)>=2,$G(OldGood)'=$QS(g,2) w "<hr width=80%>",!
 . f i=2:1:$QL(g) d
 . . w $QS(g,i)_" "
 . w $G(@g)_"<br>",!
 . s:$QL(g)>=2 OldGood=$QS(g,2)
</script>

</font>
</body>
</html>
]]></CSP>


<CSP name="LookCard.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADz XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">

<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
Arguments=window.dialogArguments.split(InnerSplitter);
CardId=Arguments[0];
var CurrentProperty;
var Objvalue;
var InCard=false;
var FromTable="";
var FromTree="";
var Number=0;
ExpressType2=""

function startFun(){
name=CardName.value;
if(name==""){alert("Не указано название карточки");return false;}
AllItems=Goods.GetAllItems();
ok=#server(Goods.CardAction.SaveCard(CardId,AllItems,name,Goods.ClassName))#
if(ok==1){returnValue=1;window.close();}
else{alert(ok)}
}

function CopyToGoods(){
	old=TempGoods.ListViewGetItems()
	Goods.ListViewAddItems(old);
}

function load(){
CardName.value=Arguments[1];
Goods.LoadHeaders();
TempGoods.LoadHeaders();
Catalogues.startDownload('Data.csp?class=Goods.Catalogue&fields=ID,Name', putCatalogue);
PropTable.DownLoadPairs("","");
LoadPropTree();
AddGoodsClick(AddGoods.checked);
}

function LoadFromCard(){
if(CardId!=""){
	Goods.GetFromCard(CardId);
	}
}

function putCatalogue(text){
addOptions(text,"Catalogues");
LoadTree();
}
function AddGoodsClick(show){
if(!show){TemGoodsFld.style.display="block";InCard=false;}
else{TemGoodsFld.style.display="none";InCard=true;}
}

function LoadTree(){
GroupsTree.DownLoad('Data.csp?class=Goods.Group&fields=Parent,Code,Name,ID&params="'+#(%session.Data("depot"))#+'","'+Catalogues.value+'"')	
}

function LoadPropTree(){
Group=ReturnSpace(GroupsTree.NodeCode);
LoadPropTree2("PropsTree","",Group,Catalogues.value)
}

function AddFromGroup(){
TargetElement=SelectTarget();
document.getElementById(TargetElement).GoodsFromGroup(GroupsTree.NodeID);
}

function AddFromSelect(){
TargetElement=SelectTarget();
document.getElementById(TargetElement).LoadGoods(FromTable,FromTree,Number);
}

function TableClick(){
	ExpressType="FromTable";
	CurrentProperty=PropTable.CurrentRowTag;
	Pname.innerText=PropTable.CurrentRowName;
	newObj=PropTable.CurrentRowElement.cloneNode(true);
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function AddExpress(){
	tagNamez=Pvalue.firstChild.tagName;
	if(tagNamez=="DIV"){
		Objvalue=Pvalue.firstChild.Tag;
		if(Objvalue.split("@")[0]==""){Objvalue=Pvalue.firstChild.innerText+Objvalue;}
		}
	if(tagNamez=="SELECT"){Objvalue=Pvalue.firstChild.options(Objec.selectedIndex).text+"@%String";}
	return Objvalue;
}

function TakeValue(){
FrstPart=AddExpress().split("@")[0]
ScndPart=AddExpress().split("@")[1]
//if(ScndPart!="%Date")return FrstPart
if(ScndPart!="%Date")return "'"+FrstPart+"'"
else {
	dateArr=FrstPart.split("/")
	Data=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
	return "CAST('"+Data+"' AS DATE)"
}
}

function dork(concatenation){
if(Pname.innerText=="")return false
if(ExpressType2!=ExpressType){
	Express.innerHTML="";
	ExpressType2=ExpressType;
	}
newCaption=Pname.innerText;
newEqual=Pequal.options(Pequal.selectedIndex).text;
newValue=TakeVisibleValue();
newExpression=newCaption+newEqual+newValue;
value=TakeValue();
if(ExpressType=="FromTree"){
	//exp=(CurrentProperty+InnerSplitter+Pequal.value+InnerSplitter+value);
	if(FromTree==""){FromTreeconcatenation="";}
	else{FromTreeconcatenation=concatenation}
	Number++;
	field="t"+Number+".Gvalue"
	if((Pequal.value!="=")&(Pequal.value!="<>")){field="CAST(t"+Number+".Gvalue AS INTEGER)"}
	exp=" (t"+Number+".Param="+CurrentProperty+" and "+field+Pequal.value+value+") "
	FromTree=FromTree+FromTreeconcatenation+ exp;
	}
if(ExpressType=="FromTable"){
	if(FromTable==""){FromTableconcatenation="";}
	else{FromTableconcatenation=concatenation}
	exp=" "+CurrentProperty+Pequal.value+value+" "
	FromTable=FromTable+FromTableconcatenation + exp;
	}
if(Express.innerHTML=="")concatenation="";
if(concatenation=="AND"){concatenation="И"}
if(concatenation=="OR"){concatenation="ИЛИ"}
newString=Express.innerHTML+"<b> "+concatenation+" (</b>"+newExpression+"<b>)</b>"
Express.innerHTML=newString;
}

function TakeVisibleValue(){
	Objec=Pvalue.firstChild;
	if(Objec.tagName=="SELECT")return Objec.options(Objec.selectedIndex).text
	else{return Objec.innerText;}
}

function PropsTreeClick(){
	ExpressType="FromTree";
	CurrentProperty=PropsTree.NodeID;
	Pname.innerText=PropsTree.NodeCaption;
	newObj=CreateDiv("","dsd");
	Pvalue.innerHTML="";
	Pvalue.appendChild(newObj);
}

function SelectTarget(){
if(InCard){lokky="Goods"}
else{lokky="TempGoods"}
return lokky
}

function DelItems(element){
document.getElementById(element).DelItems();
}

function ClearSelect(){
Express.innerText='';
FromTree="";
FromTable="";
Number=0;
}
</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();">
<table height=100% width=100% border=0>
<tr><td colspan=2>
Наименование карточки: <input type=text id=CardName><br>
Добавлять товары сразу в карточку<input type="checkbox" id="AddGoods" onclick="AddGoodsClick(this.checked)" style="border:none;width:15px" checked></td></tr>
<tr ><td width=50% valign="top">
<fieldset><legend>Отбор из группы</legend>
Классификатор:<select id="Catalogues" onchange="LoadTree()" style="behavior:url('#default#download');"></select><br>
  <SKLADz:treeview id="GroupsTree" width=200 height=170 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="LoadPropTree()" onDownloadCmpl="LoadPropTree()" />
<center><sklad:LittleButton name="v2" id="add" onclick="AddFromGroup()" alt="Добавить выделенную группу"></center>
 </fieldset>
</td>
<td width=50% valign="top">
<fieldset><legend>Отбор по параметрам</legend>
<table><tr><td valign=top>
<SKLAD2:table id="PropTable" width=220 height=200 zonTableClick="TableClick()" DisplaySecondCol="none" />
</td>
<td valign=top>
  <SKLADz:treeview id="PropsTree" width=200 height=200 ShowImages=0 ImagesPath="#(%session.Data("ImagesPath"))#" zonClick="PropsTreeClick()" />
</td></tr>
<tr><td width=100% colspan=2 align=center>
	<span id="Pname"></span>&nbsp;&nbsp;
	<select id="Pequal" >
		<option value="=">=</option>
		<option value="<>">&#8800;</option>
		<option value="<">&lt;</option>
		<option value="<=">&lt;=</option>
		<option value=">">&gt;</option>
		<option value=">=">&gt;=</option>
	</select>&nbsp;&nbsp;
	<span id="Pvalue" style="background:#ddffff;width:150px;border:dotted 1 gray">&nbsp;&nbsp;&nbsp;</span></td>
</tr>
<tr><td colspan=2>
	<center><input type="button" value="И" id="Pand" onclick="dork('AND')" style="width:50px"><input type="button" value="ИЛИ" id="Por" onclick="dork('OR')" style="width:50px"><sklad:LittleButton name="del" id="Clear" onclick="ClearSelect();" alt="Очистить поле 'Параметры'"></center>
<fieldset><legend>Параметры отбора</legend>
&nbsp;<span id="Express" style="font:Arial 13;color:#000033"></span>
</fieldset>
</td></tr>
<tr><td colspan=2 align="center"><sklad:LittleButton name="v2" id="add2" onclick="AddFromSelect()" alt="Выбрать товары соответствующие параметрам"></td></tr>
</table>
</fieldset>
</td>
</tr>
<tr><td valign="top"  colspan=2>
<fieldset id="TemGoodsFld"><legend>Выбранные товары</legend>
 <table><tr><td valign=top>
 	<sklad:LittleButton name="del" id="del2" onclick="DelItems('TempGoods')" alt="Удалить выбранные товары">
 	<sklad:LittleButton name="down" id="copy2" onclick="CopyToGoods()" alt="Скопировать список в карточку">
 </td><td width=100%>
 	<SKLADList:listview width=100% height=130 id="TempGoods"  ClassName="Goods.Goods" AddOnClear="false" />
 </td></tr></table>
</fieldset>
<fieldset><legend>Товары в текущей карточке</legend>
 <table><tr><td valign=top>
 	<sklad:LittleButton name="del" id="del1" onclick="DelItems('Goods')" alt="Удалить выбранные товары">
 </td><td width=100%>
	<SKLADList:listview width=100% height=130 id="Goods" ClassName="Goods.Goods" AddOnClear="false" onAddColumns="LoadFromCard()"/>
 </td></tr></table>
</fieldset>
</td></tr>
<tr><td valign=bottom  colspan=2>
<center><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</td></tr>
</table>
</body>
</html>
]]></CSP>


<CSP name="MailSetup.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var MailAddress="";

function ManageHandMadeAddrFn(){
if(UseKontrAddress.checked){HandMadeAddress.style.display='none';}
else{HandMadeAddress.style.display='block';}
}

function startFun(){
if(!window.confirm("Сохранить изменения?"))return;
SetCookie("OpenMailProg",OpenMailProg.checked);
SetCookie("MakeDoc",MakeDoc.checked);
if(!UseKontrAddress.checked)MailAddress=MailAddr.value;
returnValue = MakeDoc.checked+";"+OpenMailProg.checked+";"+MailAddress+";"+TemplateFile.value;
window.close();
}

function load(){
MakeDoc.checked=ReturnBoolean(GetCookie("MakeDoc"));
OpenMailProg.checked=ReturnBoolean(GetCookie("OpenMailProg"));
TemplateFile.startDownload('Data.csp?class=Common.Dictionary14&fields=Property3212,Name', FillTemplatesFn);
}

function FillTemplatesFn(textStr){
addOptions(textStr,"TemplateFile");
}
</script>
</head>
<body onload="load()">
<table>
<tr>
	<td>
		<Select id="TemplateFile" style="behavior:url(#default#download)">
		</select>
	<td>
		Шаблон
<tr>
	<td>
		<input type=checkbox id="OpenMailProg">
	<td>
		Открыть почтовую программу
<tr>
	<td>
		<input type=checkbox id="MakeDoc">
	<td>
		Создать Word файл
<tr>
	<td>
		<input type=checkbox id="UseKontrAddress" onclick="ManageHandMadeAddrFn()" checked>
	<td>
		Использовать почтовый адрес контрагента
<tr>
	<td colspan="2"><span id="HandMadeAddress" style="display='none'">
		Введите E-mail адрес <Input type=text name="MailAddr"> 
	</span>
</table>
<center><sklad:Button value="Сохранить" onclick="startFun()">&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></center>
</body>
</html>]]></CSP>


<CSP name="makescet.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s docid=%request.Get("docid")
 s class=%request.Get("class")

 // Получатель платежа
 s SelfKontragentID=%request.GetCookie("SelfKontragentID")
 d:SelfKontragentID'=""
 . s SelfKontragentObj=##class(Common.Kontragent).%OpenId(SelfKontragentID)
 . q:'$ISOBJECT(SelfKontragentObj)
 . s SelfKontragentName=$ZCVT(SelfKontragentObj.Name,"O","JS")
 
 s formirovanie=$S(class="Docs.Chet":"счета на оплату",class="factura":"счет-фактуры",1:"")
 s DocObject=##class(Docs.Super).%OpenId(docid)
 d:$ISOBJECT(DocObject)
 . s DocDate=$ZD(DocObject.Dat,4)
 . s KontrID=DocObject.Kontr.%Id()
 . s KontrName=$ZCVT(DocObject.Kontr.Name,"O","JS")
 . s DocName=DocObject.Name
</script>
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var sessionid="#(%session.SessionId)#";
var docid="#($G(docid))#";
var clas="#($G(class))#";
var DocDate="#($G(DocDate))#";
var KontrID="#($G(KontrID))#";
var KontrName="#($G(KontrName))#";
var SelfKontragentID="#($G(SelfKontragentID))#";
var SelfKontragentName="#($G(SelfKontragentName))#";
window.dialogHeight="275px";
window.dialogWidth="600px";

function startFun(){
var k1=PropTable1.item("Kontr")
var k2=PropTable2.item("Kontr")
SetCookie("SelfKontragentID",k2);
if(k1==""){alert("Не заполнено поле ПЛАТЕЛЬЩИК");return}
if(k2==""){alert("Не заполнено поле ПОЛУЧАТЕЛЬ ПЛАТЕЖА");return}
window.open("print.csp?id="+docid+"&class="+clas+"&kontr="+k2+"&kontr2="+k1+"&cv1="+cv1.value+"&NDSinside="+NDSinside.checked+"&DocDate="+Dat.innerText+"&sessionid="+sessionid+"&CalculateInRubles="+CalculateInRubles.checked);
}

function load(){
Dat.innerText=DocDate;
//SelfKontragentID=ReturnSpace(GetCookie("SelfKontragentID"));
PropTable1.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
PropTable2.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
}

function OpenCalendar(InputObj){
var newDate=window.showModalDialog("calendar.csp","","center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;");
if(ReturnSpace(newDate)!=""){InputObj.innerText=newDate;}
}

function LoadProp1Complite(){
	PropTable1.setCellValue("Kontr",KontrName,KontrID);
}

function LoadProp2Complite(){
	if(SelfKontragentID!="")
	{
	PropTable2.setCellValue("Kontr",SelfKontragentName,SelfKontragentID);
	}
}

</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<b><center>Формирование #($G(formirovanie))#</center></b>
<table>
<tr><td>Дата документа</td><td><div onclick="OpenCalendar(this)" name="Dat" id="Dat" style="border:solid 1 grey;width:150px;cursor:hand"></div></td></tr>
<tr><td>Плательщик</td><td><SKLAD2:table id="PropTable1" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp1Complite()"/></td></tr>
<tr><td>Получатель платежа</td><td><SKLAD2:table id="PropTable2" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp2Complite()"/></td></tr>

<tr>
	<td>К платежно расчетному документу №</td><td> <input type="text" name="cv1" size="20" value="#($G(DocName))#"></td>
</tr>

<tr>
	<td>НДС включён в цену товара</td><td> <input type="checkbox" name="NDSinside" CHECKED style="width:15px;border:none"></td>
</tr>
<tr>
	<td>Пересчитывать в рубли</td><td> <input type="checkbox" name="CalculateInRubles" CHECKED style="width:15px;border:none"></td>
</tr>

<!-- <tr><td>Рассчитывать рублёвую сумму на дату документа</td><td> <input type="checkbox" name="KursFromDoc" id="KursFromDoc" CHECKED ></td></tr> -->
</table>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</body>
</html>
]]></CSP>


<CSP name="MakeSerial.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="ShowFileData" arguments="" returntype="%String">
 if %request.ContentType'="multipart/form-data" q ""
 s obj=$G(%request.MimeData("file1",1))
 q:'$ISOBJECT(obj) ""
 
 s glob=$NA(^Common.Dictionary2I("serialInd"))
 s ListIndex("Property9194") = ##class(Common.Dictionary2).GetPropertyListIndex("Property9194",.DataLocation)
 s ListIndex("Comment") = ##class(Common.Dictionary2).GetPropertyListIndex("Comment",.DataLocation)
 s cl="Common.Dictionary2||Property9194"
 d ##class(Docs.Action2).GetDisplayListArray(cl,.Property9194Array)

 w "<table border=1>",!
 w "<tr><td>Серийный номер<td>Гарантийный номер<td>Актуальность<td>Примечание</tr>"
 while ('obj.AtEnd)
 {
	s serial=obj.ReadLine(32000)
	s (garantStr,actual,comment)="Не найден"
	s color="#FFFFFF"
	s SearchString = " "_$ZCVT(serial,"U")
     
 	//если данные есть
 	if $D(@glob@(SearchString))
 	{
 		s ID = $O(@glob@(SearchString,""))
 		s Property9194 = ##class(Common.Dictionary2).GetPropertyValue(ID,"Property9194",ListIndex("Property9194"),.DataLocation)
 		s actual=$G(Property9194Array(Property9194))
 		s garant=$LG(@glob@(SearchString,ID),2)
 		s garantStr=$S('ShowExcel:"<a href=""javascript:s('"_ID_"')"">",1:"")
 		s garantStr=garantStr_garant
 		s garantStr=garantStr_$S('ShowExcel:"</a>",1:"")
 		s comment=##class(Common.Dictionary2).GetPropertyValue(ID,"Comment",ListIndex("Comment"),.DataLocation)
 		if Property9194=2 s color="#DEDEDE"
 	}
	
 	w "<tr bgcolor="""_color_""">"
 	w "<td>"_serial
 	w "<td>"_garantStr
 	w "<td>"_actual
 	w "<td>"_comment
 	w "</tr>"
 }
 w "</table>",!
 Quit ""
</script>

<html>
<head>
<CSP:IF CONDITION="'ShowExcel">	
	<link href="style.css" type=text/css rel=stylesheet>
</CSP:IF>	
<!-- Put your page Title here -->
<title>	Проверка действительности серийных номеров </title>
<script language="javascript" type="text/javascript">

function s(currentrecord)
{
	ok=window.showModalDialog("garant.csp?GarantId="+currentrecord,currentrecord+";Common.Dictionary2","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
}
</script>
</head>

<body TOPMARGIN=25 LEFTMARGIN=25>
<CSP:IF CONDITION="'ShowExcel">
	<sklad:Button value="Товары" onclick="window.location.href='goods.csp'">
	<sklad:Button value="Управление серийными номерами" onclick="window.location.href='serials.csp'" style="width:250px"><br>
	<br><br>
	<TABLE cellSpacing=0 width="100%" celpadding="0" >
	<TR>
	<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
	<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Проверка серийных номеров в текстовом файле</strong></TD>
	<td  width=10% align=right><!--<a href="talk.csp" ><img src="images/BIGProp.gif" width="20" height=25 border=0></a>--></td>
	</tr>
	</TABLE>
</CSP:IF>

<CSP:IF CONDITION="FormFilled=0">
	<form enctype="multipart/form-data" method="post">
	Укажите текстовый файл со списком серийных номеров <input type="file" name="file1">
	<input type="hidden" name="FormFilled" value="1">
	<br><font size="-1" size="Grey">* Каждый серийный номер должен располагаться на новой строке</font>
	<br>Открыть результат в Microsoft Excel <input type="checkbox" name="ShowExcel" value="1" style="border:none">
	<br><br> <input type="submit" value="Проверить указанный файл" style="width:200px">
	</form>
<CSP:ELSE>
	<script language="cache" runat="server">
	d ..ShowFileData()
	
	</script>
	 <CSP:IF CONDITION="'ShowExcel">	
		 <br><br>
		 <a href="?">Вернуться к выбору файла</a>
	 </CSP:IF>
</CSP:IF>
</body>
</html>
]]></CSP>


<CSP name="maketovnakl.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s docid=%request.Get("docid")
 s class=%request.Get("class")
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name
 . s DocDate=$ZD(doc.Dat,4)
 . s KontrID=doc.Kontr.%Id()
 . s KontrName=$ZCVT(doc.Kontr.Name,"O","JS")

 // Грузоотправитель
 s GruzootpravitelID=%request.GetCookie("GruzootpravitelID")
 d:GruzootpravitelID'=""
 . s GruzootpravitelObj=##class(Common.Kontragent).%OpenId(GruzootpravitelID)
 . q:'$ISOBJECT(GruzootpravitelObj)
 . s GruzootpravitelName=$ZCVT(GruzootpravitelObj.Name,"O","JS")

 // Грузоотправитель
 s PostavchikID=%request.GetCookie("PostavchikID")
 d:PostavchikID'=""
 . s PostavchikObj=##class(Common.Kontragent).%OpenId(PostavchikID)
 . q:'$ISOBJECT(PostavchikObj)
 . s PostavchikName=$ZCVT(PostavchikObj.Name,"O","JS")
</script>
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var sessionid="#(%session.SessionId)#";
var docid="#($G(docid))#";
var clas="#($G(class))#";
var KontrID="#($G(KontrID))#";
var KontrName="#($G(KontrName))#";
var DocDate="#($G(DocDate))#";
var GruzootpravitelID="#($G(GruzootpravitelID))#";
var GruzootpravitelName="#($G(GruzootpravitelName))#";
var PostavchikID="#($G(PostavchikID))#";
var PostavchikName="#($G(PostavchikName))#";

window.dialogHeight='440px';

function startFun(){
var k1=PropTable1.item("Kontr")
var k2=PropTable2.item("Kontr")
var k3=PropTable3.item("Kontr")
var k4=PropTable4.item("Kontr")
SetCookie("GruzootpravitelID",k1);
SetCookie("PostavchikID",k3);
var nomnakl=document.myform.nomnakl.value;
var DoverennNumber = document.myform.Doverenn.value;
var DoverennDatValue = DoverennDat.innerText;
var OpenWithValue = document.getElementById("OpenWith").value;
if(k1==""){alert("Не заполнено поле Грузоотправитель");return}
if(k2==""){alert("Не заполнено поле Грузополучатель");return}
if(k3==""){alert("Не заполнено поле Поставщик");return}
if(k4==""){alert("Не заполнено поле Плательщик");return}
if(nomnakl==""){alert("Не заполнен номер товарной накладной");return}
window.open("print.csp?id="+docid+"&class="+clas+"&kontr="+k1+"&kontr2="+k2+"&kontr3="+k3+"&kontr4="+k4
	+"&nomernakl="+nomnakl+"&DoverennNumber="+DoverennNumber+"&DoverennDatValue="+DoverennDatValue
	+"&NDSinside="+document.all.NDSinside.checked+"&DocDate="+Dat.innerText
	+"&sessionid="+sessionid+"&OpenWith="+OpenWithValue);
}

function load(){
Dat.innerText=DocDate;
PropTable1.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
PropTable2.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
PropTable3.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
PropTable4.DownLoadPairs("","","Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser");
document.myform.nomnakl.value='#(docname)#'
}

function OpenCalendar(InputObj){
var newDate=window.showModalDialog("calendar.csp","","center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;");
if(ReturnSpace(newDate)!=""){InputObj.innerText=newDate;}
}

function LoadProp24Complite(){
	PropTable2.setCellValue("Kontr",KontrName,KontrID);
	PropTable4.setCellValue("Kontr",KontrName,KontrID);

}

function LoadProp1Complite(){
	if(GruzootpravitelID!="")
	{
	PropTable1.setCellValue("Kontr",GruzootpravitelName,GruzootpravitelID);
	}
}

function LoadProp3Complite(){
	if(PostavchikID!="")
	{
	PropTable3.setCellValue("Kontr",PostavchikName,PostavchikID);
	}
}
</script>
</head>
<body onload="load();" onkeypress="ManageWindow();" >
<form name="myform" id="myform">
<b><center>Формирование товарной накладной</center></b>
<table>
<tr><td>Номер товарной накладной</td><td><input type="text" name="nomnakl" id="nomnakl"></td></tr>
<tr><td>Дата документа</td><td><div onclick="OpenCalendar(this)" name="Dat" id="Dat" style="border:solid 1 grey;width:150px;cursor:hand"></div></td></tr>
<tr><td>Номер доверенности</td><td><input type="text" name="Doverenn" id="Doverenn" style="border:solid 1 grey;width:150px;cursor:hand"></td></tr>
<tr><td>Дата доверенности</td><td><div onclick="OpenCalendar(this)" name="DoverennDat" id="DoverennDat" style="border:solid 1 grey;width:150px;cursor:hand">05/09/2013</div></td></tr>
<tr><td>Грузоотправитель</td><td><SKLAD2:table id="PropTable1" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp1Complite()"/></td></tr>
<tr><td>Грузополучатель</td><td><SKLAD2:table id="PropTable2" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp24Complite()"/></td></tr>
<tr><td>Поставщик</td><td><SKLAD2:table id="PropTable3" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp3Complite()"/></td></tr>
<tr><td>Плательщик</td><td><SKLAD2:table id="PropTable4" width=260 ClassName="Docs.Super" onLoadComplete="LoadProp24Complite()"/></td></tr>
<tr>
	<td>НДС включён в цену товара</td><td> <input type="checkbox" name="NDSinside" id="NDSinside" CHECKED ></td>
</tr>
<tr>
	<td>Открыть с помощью</td><td> <select name="OpenWith" id="OpenWith"><option value="excel">Microsoft Excel</option><option value="word">Microsoft Word</option><option value="browser">В браузере</option></select> </td>
</tr>
<!-- <tr><td>Рассчитывать рублёвую сумму на дату документа</td><td> <input type="checkbox" name="KursFromDoc" id="KursFromDoc" CHECKED ></td></tr> -->
</table>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</form>
</body>
</html>]]></CSP>


<CSP name="ManyGarants.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s skip=%request.Get("skip")
</script>
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var argArr=window.dialogArguments.split(";");
var ItemID=argArr[0];
var ClassName=argArr[1];

function startFun()
{
	var model = PropTable.GetCellValue(1,6);
	if (model=="")
	{
		alert("Укажите, пожалуйста, модель.");
		return;
	}
	if(ReturnSpace(ItemID)==""){question="Создать запись?"}
	else{question="Изменить запись?"}
	if(!window.confirm(question))return false;
	var xmldoc=PropTable.GetXmlContent();
	xmldoc=addnode(xmldoc,"startnumb",startnumb.value)
	xmldoc=addnode(xmldoc,"koli4est",koli4est.value)
	xmldoc=addnode(xmldoc,"prefix",prefix.value)
	xmldoc=addnode(xmldoc,"leng",leng.value)
	xmldoc=addnode(xmldoc,"comment",comment.value)
	if (SerialAsGarant.checked){ var SerialAsGarantValue = "1"; }
	else{ var SerialAsGarantValue = "0"; }
	xmldoc=addnode(xmldoc,"SerialAsGarant",SerialAsGarantValue)
	
	//var xmldoc2=docstr.GetXmlContent();
	var ok=SplitSendXml("",ClassName,xmldoc,"","#(%session.SessionId)#","Docs.Action.makealotgarants");

	//alert("первый"+isNaN(ok.substr(0, 1)) )
	if(!isNaN(ok.substr(0, 1))){returnValue=1;window.close();}
	else{alert(ok);}
}

function load()
{
	PropTable.DownLoadPairs(ClassName,ItemID,"remont1,remont2,remont3,remont1otch,remont2otch,remont3otch,Name,Dat,Comment");
}

</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<p style="font-face:Arial" align=center>Множественный ввод номеров гарантийных талонов
<fieldset ><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width="100%" />
</fieldset>
<table>
<tr><td colspan=2>Примечание к гарантийному талону:<br> <textarea id="comment" rows=4 cols=50></textarea><br><br>
<tr><td>Префикс номера гарантийного талона <td><input id="prefix" type=text>
<tr><td>Начальная цифра <td><input id="startnumb" type=text> количество разрядов номера <input type=text id="leng" style="width:40">
<tr><td colspan=2>Серийный и гарантийный номера идентичны <input type="checkbox" value="1" id="SerialAsGarant" style="border:none;width:15" CHECKED>
<tr><td>Количество гарантийных талонов <td><input id="koli4est" type=text value=1>
</table>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="MestoOpera.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var ColCode="";
sessionid="#(%session.SessionId)#";
depot="#($G(%session.Data("depot")))#"
function load(){
listdocs.LoadHeaders("Comment,DocumentClass,Source,Tim");
}    
function showdocums(){ //показывает заявки
dateArr=dat1.value.split("/")
Data1=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
dateArr=dat2.value.split("/")
Data2=dateArr[2]+"-"+dateArr[1]+"-"+dateArr[0]
listdocs.DownLoad("Dat>=CAST('"+Data1+"' AS DATE) and Dat<=CAST('"+Data2+"' AS DATE) and Depot="+depot);
}

function showdictionary(where){
var where=ReturnSpace(where);
var made=false;
listdocs.DownLoad(where);
}

function showcreateddoc(docclID){ // показывает созданные от заявки документы 
	qqq=1
	docID=listdocs.ItemID;
	createddocs.loadfrommethod("Docs.ActionZayav.Showcreateddoc",docID,qqq)
	}


// товарная накладная и инструкция грузчику
function maketovnakl(cl,instrcl){
var	kot=1;
var doctov=listdocs.ItemID;
if(doctov==""){alert("Не выбран документ - основание для формирования документа");return}
WinResult=window.showModalDialog("RashIStorage.csp?docid="+doctov,"","cener:yes;status:no;dialogHeight:300px;dialogWidth:400px;resizable:yes;")

}

//счет-фактура
function makeschet(cl){
var doc=listdocs.ItemID;
if(doc==""){alert("Не выбран документ - основание для формирования платежного поручения");return}
//WinResult=window.showModalDialog("makescet.csp?docid="+doc+"&class="+cl,"","cener:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")
ok=#server(Docs.ActionZayav.SaveDocFromZayav(doc,cl))#
if (ok){alert("Документ успешно создан")}
else {alert(ok)};
showcreateddoc();
}

function colclick(){
	if(listdocs.ColType=="%Date"){alert("Поля с датами не обрабатываются");return false;}
	namfld.innerText=listdocs.ColName;
	ColCode=listdocs.ColCode;
	}

function ShowInstr(){
showdocums();
docclass="";}

//печать документов
function printdoc(){
	var doctov=createddocs.ItemID;
	if(doctov==""){alert("Не выбран документ - основание для печати");return}
	var ClassName="";
	var ItemName=createddocs.ItemName;
	if (ItemName=='Товарная накладная'){tovnakladn="tovnakladn";WinResult=window.showModalDialog("maketovnakl.csp?docid="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:300px;dialogWidth:450px;resizable:yes;")}
	else if (ItemName=='Счет-фактура'){tovnakladn='factura';WinResult=window.showModalDialog("makescet.csp?docid="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")} 
	else if (ItemName=='Инструкция грузчику'){tovnakladn='Docs.StorageOut';WinResult=window.showModalDialog("print.csp?id="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:250px;dialogWidth:400px;resizable:yes;")}
	}
function printtovnakl(){
	var doctov=listdocs.ItemID;
	tovnakladn="tovnakladn";
	WinResult=window.showModalDialog("maketovnakl.csp?docid="+doctov+"&class="+tovnakladn,"","cener:yes;status:no;dialogHeight:300px;dialogWidth:450px;resizable:yes;")
	}

function CreateDocument(){
ItemID=createddocs.ItemID;	
createddocs.ItemName;
if(ItemID==""){alert("Не выбран тип документа");return};
if(createddocs.ItemName=="Товарная накладная"){CurrentDocementClass='Docs.Rash'} else 
if(createddocs.ItemName=="Инструкция грузчику"){CurrentDocementClass='Docs.StorageOut'}
else if(createddocs.ItemName=="Счет-фактура"){CurrentDocementClass='Docs.Factura'}
ItemID=ReturnSpace(ItemID)
var doccsp="ShowRash.CSP";
WinResult=window.showModalDialog(doccsp,CurrentDocementClass+InnerSplitter+ItemID+InnerSplitter+createddocs.ItemName,"cener:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")

}
function processdoc(){
if(createddocs.ItemID==""){alert("Не выбран тип документа");return};
if(createddocs.ItemName=="Товарная накладная"){CurrentDocementClass='Docs.Rash'} else 
if(createddocs.ItemName=="Инструкция грузчику"){CurrentDocementClass='Docs.StorageOut'}
else if(createddocs.ItemName=="Счет-фактура"){CurrentDocementClass='Docs.Factura'}
var doc=createddocs.ItemID+"@"+CurrentDocementClass;
var ok=#server(Docs.ActionZayav.processdoc(doc))#
if(isNaN(ok)){alert(ok)}
else{showcreateddoc();alert("Документ успешно обработан");}
}	
</script>
</head>
<body onload="load()">
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR><TD align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Автоматическое рабочее место оператора</strong></TD></tr>
</TABLE>
<br>
<table width=100%><tr>
<td width=50%>
<fieldset><legend id="listDocument">Cписок заявок</legend>
Период c <input type=text id="dat1" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar" onchange="alert(99)"> по <input type=text id="dat2" value="#($ZD($H,4))#" onclick="fnCalendar(this)" class="datar">
<sklad:LittleButton name="ok" id="okbut" onclick="showdocums()" alt="Показать документы"><br>

<SKLADList:listview width=100% height=200 id="listdocs" zonColumnClick="colclick()" zClick="showcreateddoc(listdocs.ItemID)" onAddColumns="showdocums()"  ClassName="Docs.Zayav" zonDblClick="CreateDocument(listdocs.ItemID)" /><br>
  <sklad:LittleButton name="new" id="newrec1" onclick="maketovnakl('Docs.Rash')" alt="Создание товарной накладной от заявки">
   <sklad:LittleButton name="new+" id="addschetfakt" onclick="makeschet('Docs.Factura')" alt="Создание счета-фактуры">
  <sklad:LittleButton name="print" id="addinstr" onclick="printtovnakl()" alt="Создание инструкции грузчику ">
 </fieldset>
</td>
<td width=50%>
<fieldset><legend>Резервы</legend>
<SKLADList:listview width=100% height=200 id="reserves" /><br>
<sklad:LittleButton name="new" id="newrec" onclick="" alt="">
</fieldset>
</td>
</tr></table>
<table width=100%> <tr><td width=100%>
<fieldset><legend>Список созданных документов</legend>
<SKLADList:listview width=100% height=200 id="createddocs" onAddColumns="showdocums()"  zonDblClick="CreateDocument(createddocs.ItemID)" /><br>
<sklad:LittleButton name="edit" id="edit" onclick="lookdoc()" onclick="CreateDocument()"alt="Просмотр документа">
<sklad:LittleButton name="print" id="print" onclick="printdoc()" alt="печатать документ">
<sklad:LittleButton name="ok" id="vozvrat" onclick="processdoc()" alt="обработать документ">
</fieldset>
</td></tr></table>
</body>
</html>]]></CSP>


<CSP name="multichange.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s skip=%request.Get("skip")
 s addrpath=%request.Get("addrpath")
</script>
<html XMLNS:SKLAD2>
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc" >
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
var argArr=window.dialogArguments.split(";");
var ItemID=argArr[0];
var ClassName=argArr[1];

function startFun(){
if(!window.confirm("Применить все указанные параметры к #(addrpath)#"))return false;
xmldoc=PropTable.GetXmlContent();
ok=SplitSendXml(ItemID,ClassName,xmldoc,"","#(%session.SessionId)#","Store.Action.CellsMultiChange")
if(isNaN(ok)){alert(ok)}
else{returnValue=1;window.close();}
}

function load(){
PropTable.DownLoadPairs(ClassName,"","#(skip)#");
}


</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();" >
<fieldset style="width:100%;height:200"><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width="100%" />
</fieldset>
<center><br><sklad:Button value="Да" onclick="startFun();"><sklad:Button onclick="window.close()" value="Отмена"></center>
</table>
</body>
</html>
]]></CSP>


<CSP name="NegativeQnt.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="ZeroInvent" arguments="GoodIds" returntype="%String">
 n DocObj,DocItemObj,addr,ok,Good,quantplan,GoodsId,addrID,i
 s DocObj=##class(Docs.Invent).%New()
 s DocObj.Name=##class(Docs.Action).getRashNumb("Docs.Invent")
 s DocObj.Comment="Создано автоматически при проверке отрицательных остатков "_$ZDT($H,4)
 f i=1:1:$L(GoodIds,";") d
 . s Good=$P(GoodIds,";",i)
 . q:Good=""
 . s DocItemObj=##class(Docs.InventItems).%New()
 . s GoodsId=$P(Good,"@",1)
 . d DocItemObj.GoodsSetObjectId(GoodsId)
 . s addrID=$P(Good,"@",2)
 . d DocItemObj.addrSetObjectId(addrID)
 . &sql(select Value1 into :quantplan from Store.Quantity where Goods=:GoodsId and Address=:addrID)
 . s:SQLCODE=0 DocItemObj.quantplan=quantplan
 . s DocItemObj.Quantity=0
 . d DocItemObj.DocTypeSetObjectId("Docs.Invent")
 . d DocObj.Items.Insert(DocItemObj)
 s ok=DocObj.%Save()
 if ok q DocObj.%Id()
 JOB saveobjerror^saveerror(ok,$ZNAME)
 q "Извините. Ошибка при сохранении документа."
</script>

<script language="Cache" method="CreateMovementDoc" arguments="GoodIds" returntype="%String">
 n DocObj,DocItemObj,addr,ok,Good,quantplan,GoodsId,addrID,i
 //if SQLCODE=100 q "Не найдено никаких других мест с данным товаром и количеством "_Value1_", документ перемещения не создан."
 s DocObj=##class(Docs.Inner).%New()
 s DocObj.Name=##class(Docs.Action).getRashNumb("Docs.Inner")
 s DocObj.Comment="Создано автоматически при проверке отрицательных остатков "_$ZDT($H,4)
 f i=1:1:$L(GoodIds,";") d
 . s Good=$P(GoodIds,";",i)
 . q:Good=""
 . s GoodsId=$P(Good,"@",1)
 . s addrID=$P(Good,"@",2)
 . s Value1=$P(Good,"@",3)
 . s DocItemObj=##class(Docs.InnerItems).%New()
 . d DocItemObj.GoodsSetObjectId(GoodsId)
 . &sql(select Address into :addr from Store.Quantity where Goods=:GoodsId and Address<>:addrID and Value1>=:Value1)
 . if SQLCODE=100 q
 . d DocItemObj.addrSetObjectId(addrID)
 . d DocItemObj.addr2SetObjectId(addr)
 . s DocItemObj.Quantity=-Value1
 . d DocItemObj.DocTypeSetObjectId("Docs.Inner")
 . d DocObj.Items.Insert(DocItemObj)
 s ok=DocObj.%Save()
 if ok q DocObj.%Id()
 JOB saveobjerror^saveerror(ok,$ZNAME)
 q "Извините. Ошибка при сохранении документа."
</script>

<script language="Cache" method="gobo" arguments="DocsArray,GoodId,AddrId" returntype="%Boolean">
 n ID,CloseDate,CloseTime,docname,quantreal,doc,docdat,doctim,docclose,
 doccreate,DocumentClassName,DocumentClass
 k DocsArray
 // and doc->DocumentClass in ('Docs.StorageIn','Docs.StorageOut','Docs.Invent','Docs.Utiliz')

 ; инструкции по отгрузке
 &sql(declare gobo cursor for 
 	select ID,doc->CloseDate as CloseDate,doc->CloseTime as CloseTime,doc->name as docname,doc,doc->dat,doc->tim,Common.SqlProcs_DocQuant(ID,doc->DocumentClass)
 	into :ID,:CloseDate,:CloseTime,:docname,:doc,:docdat,:doctim,:quant
 	from Docs.StorageOutItems 
 	where Goods=:GoodId and Doc->stat=2 and addr=:AddrId
 	order by doc->dat,doc->tim )
 &sql(open gobo)
 f  &sql(fetch gobo) q:SQLCODE  d
 . s docclose=$S(+CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(+CloseTime:$ZT(CloseTime),1:"")
 . s doccreate=$S(+docdat:$ZD(docdat,4),1:"")_" "_$S(+doctim:$ZT(doctim),1:"")
 . if $TR(docclose," ","")="" s docclose="Документ закрыт, но дата не установлена."
 . s DocsArray(ID,"docclose")=docclose
 . s DocsArray(ID,"quant")=quant
 . s DocsArray(ID,"docname")=docname
 . s DocsArray(ID,"doc")=doc
 . s DocsArray(ID,"docdat")=doccreate
 . s DocsArray(ID,"DocumentClassName")="Инструкция по отгрузке"
 . s DocsArray(ID,"DocumentClass")="Docs.StorageOut"
 &sql(close gobo)
 
  ; инструкции по приёму
 &sql(declare gobo1 cursor for 
 	select ID,doc->CloseDate as CloseDate,doc->CloseTime as CloseTime,doc->name as docname,doc,doc->dat,doc->tim,Common.SqlProcs_DocQuant(ID,doc->DocumentClass)
 	into :ID,:CloseDate,:CloseTime,:docname,:doc,:docdat,:doctim,:quant
 	from Docs.StorageInItems 
 	where Goods=:GoodId and Doc->stat=2 and addr=:AddrId
 	order by doc->dat,doc->tim )
 &sql(open gobo1)
 f  &sql(fetch gobo1) q:SQLCODE  d
 . s docclose=$S(+CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(+CloseTime:$ZT(CloseTime),1:"")
 . s doccreate=$S(+docdat:$ZD(docdat,4),1:"")_" "_$S(+doctim:$ZT(doctim),1:"")
 . s DocsArray(ID,"docclose")=docclose
 . s DocsArray(ID,"quant")=quant
 . s DocsArray(ID,"docname")=docname
 . s DocsArray(ID,"doc")=doc
 . s DocsArray(ID,"docdat")=doccreate
 . s DocsArray(ID,"DocumentClassName")="Инструкция по приёму"
 . s DocsArray(ID,"DocumentClass")="Docs.StorageIn"
 &sql(close gobo1)
 
  ; инвентаризации
 &sql(declare gobo2 cursor for 
 	select ID,doc->CloseDate as CloseDate,doc->CloseTime as CloseTime,doc->name as docname,doc,doc->dat,doc->tim,Common.SqlProcs_DocQuant(ID,doc->DocumentClass)
 	into :ID,:CloseDate,:CloseTime,:docname,:doc,:docdat,:doctim,:quant
 	from Docs.InventItems 
 	where Goods=:GoodId and Doc->stat=2 and addr=:AddrId
 	order by doc->dat,doc->tim )
 &sql(open gobo2)
 f  &sql(fetch gobo2) q:SQLCODE  d
 . s docclose=$S(+CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(+CloseTime:$ZT(CloseTime),1:"")
 . s doccreate=$S(+docdat:$ZD(docdat,4),1:"")_" "_$S(+doctim:$ZT(doctim),1:"")
 . s DocsArray(ID,"docclose")=docclose
 . s DocsArray(ID,"quant")=quant
 . s DocsArray(ID,"docname")=docname
 . s DocsArray(ID,"doc")=doc
 . s DocsArray(ID,"docdat")=doccreate
 . s DocsArray(ID,"DocumentClassName")="Инвентаризация"
 . s DocsArray(ID,"DocumentClass")="Docs.Invent"
 &sql(close gobo2)
 
   ; утилизации
 &sql(declare gobo3 cursor for 
 	select ID,doc->CloseDate as CloseDate,doc->CloseTime as CloseTime,doc->name as docname,doc,doc->dat,doc->tim,Common.SqlProcs_DocQuant(ID,doc->DocumentClass)
 	into :ID,:CloseDate,:CloseTime,:docname,:doc,:docdat,:doctim,:quant
 	from Docs.UtilizItems 
 	where Goods=:GoodId and Doc->stat=2 and addr=:AddrId and SourceTbl=1
 	order by doc->dat,doc->tim )
 &sql(open gobo3)
 f  &sql(fetch gobo3) q:SQLCODE  d
 . s docclose=$S(+CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(+CloseTime:$ZT(CloseTime),1:"")
 . s doccreate=$S(+docdat:$ZD(docdat,4),1:"")_" "_$S(+doctim:$ZT(doctim),1:"")
 . s DocsArray(ID,"docclose")=docclose
 . s DocsArray(ID,"quant")=quant
 . s DocsArray(ID,"docname")=docname
 . s DocsArray(ID,"doc")=doc
 . s DocsArray(ID,"docdat")=doccreate
 . s DocsArray(ID,"DocumentClassName")="Утилизация"
 . s DocsArray(ID,"DocumentClass")="Docs.UtilizItems"
 &sql(close gobo3)
 
    ; внутреннее перемещение
 &sql(declare gobo4 cursor for 
 	select ID,doc->CloseDate as CloseDate,doc->CloseTime as CloseTime,doc->name as docname,doc,doc->dat,doc->tim,Common.SqlProcs_DocQuant(ID,doc->DocumentClass),addr,addr2
 	into :ID,:CloseDate,:CloseTime,:docname,:doc,:docdat,:doctim,:quant,:addr,:addr2
 	from Docs.InnerItems 
 	where Goods=:GoodId and Doc->stat=2 and (addr=:AddrId or addr2=:AddrId)
 	order by doc->dat,doc->tim )
 &sql(open gobo4)
 f  &sql(fetch gobo4) q:SQLCODE  d
 . s docclose=$S(+CloseDate:$ZD(CloseDate,4),1:"")_" "_$S(+CloseTime:$ZT(CloseTime),1:"")
 . s doccreate=$S(+docdat:$ZD(docdat,4),1:"")_" "_$S(+doctim:$ZT(doctim),1:"")
 . s DocsArray(ID,"docclose")=docclose
 . s DocsArray(ID,"quant")=quant
 . s DocsArray(ID,"docname")=docname
 . s DocsArray(ID,"doc")=doc
 . s DocsArray(ID,"docdat")=doccreate
 . s DocsArray(ID,"DocumentClassName")="Внутреннее перемещение "_$S(addr=AddrId:"(приход)",addr2=AddrId:"(расход)",1:"Ошибка!!!")
 . s DocsArray(ID,"DocumentClass")="Docs.InnerItems"
 &sql(close gobo4)
 
 q
</script>
<html>
<head>
<title>	Отрицательные остатки </title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript">
 var InnerSplitter="~";
 sessionid="#(%session.SessionId)#";
 var checkall=true;
 var checkall2=true;
 function ShowHide(ID){
	if(window.event.srcElement.tagName=="IMG")return
	if(window.event.srcElement.tagName=="A")return
	if(window.event.srcElement.tagName=="INPUT")return
  obj=document.getElementById(ID+"docs");
  if(obj.style.display=="none"){obj.style.display="block";}
  else{obj.style.display="none";}
 }
 
 function GoodCard(GoodsId){
	InnerSplitter="~";
	ok=window.showModalDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath=",GoodsId+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
 }
 
 function print(docid,docclass){
 window.open("print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid)
 }
 
 function LogOfCreation(docid){
 window.open("LogOfCreation.csp?doc="+docid);
 }
 
 function StoragePlaceCard(StoreId){
 ok=window.showModalDialog("StorePlace.csp?StoreId="+StoreId,"","center:yes;status:no;dialogHeight:500px;dialogWidth:740px;resizable:yes")
 } 
 
 function CheckAll(){
	if(AllCheckBox=='')return;
	CheckBoxArray=AllCheckBox.split(";");
	for(i=1; i<CheckBoxArray.length; i++){
		obj=document.getElementById(CheckBoxArray[i]);
		obj.checked=checkall;
		//alert('i='+i+'\n'+'CheckBoxArray[i]='+CheckBoxArray[i]+'\nobj='+obj);
		}
	checkall=!checkall;
	if(checkall){cbCheckAll.title='Отметить все товары для инвентаризации';}
	else{cbCheckAll.title='Снять отметку со всех товаров для инвентаризации';}
 }
 
  function CheckAll2(){
	if(AllCheckBox2=='')return;
	CheckBoxArray2=AllCheckBox2.split(";");
	for(i=1; i<CheckBoxArray2.length; i++){
		obj=document.getElementById(CheckBoxArray2[i]);
		obj.checked=checkall2;
		//alert('i='+i+'\n'+'CheckBoxArray[i]='+CheckBoxArray[i]+'\nobj='+obj);
		}
	checkall2=!checkall2;
	if(checkall2){cbCheckAll2.title='Отметить все товары для перемещения';}
	else{cbCheckAll2.title='Снять отметку со всех товаров для перемещения';}
 }

 
 function CreateInvent(AddressId){
	InventGoods="";
	CheckBoxArray=AllCheckBox.split(";");
	for(i=1; i<CheckBoxArray.length; i++){
		obj=document.getElementById(CheckBoxArray[i]);
		if(obj.checked){InventGoods=InventGoods+obj.id+";"};
		}
var InventId=#server(..ZeroInvent(InventGoods))#
 if(isNaN(InventId)){alert(InventId);}
 else{
	doccsp="InventarizationIgrid.csp?source="+InventId;
	WinResult=window.showModalDialog(doccsp,"Docs.Invent"+InnerSplitter+InventId+InnerSplitter+"Инвентаризация","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
 	if(WinResult==null){
	 	
	 	deldoc("Docs.Invent",InventId);
		 }
 	else{
 		processdoc("Docs.Invent",InventId);
 		}
 	}
	
 }
 
 function CreateInner(){
	Goods="";
	CheckBoxArray2=AllCheckBox2.split(";");
	for(i=1; i<CheckBoxArray2.length; i++){
		obj=document.getElementById(CheckBoxArray2[i]);
		if(obj.checked){Goods=Goods+obj.id+";"};
		}
 var MovementDocId=#server(..CreateMovementDoc(Goods))#
 if(isNaN(MovementDocId)){alert(MovementDocId);}
 else{
 	var doccsp="docinner.csp";
 	WinResult=window.showModalDialog(doccsp,"Docs.Inner"+InnerSplitter+MovementDocId+InnerSplitter+"Внутреннее перемещение","center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;")
 	if(WinResult==null){
	 	deldoc("Docs.Inner",MovementDocId);
		 }
 	else{
 		processdoc("Docs.Inner",MovementDocId);
 		}
 	}
 }
 
function processdoc(classname,itemid){
var doc=itemid+"@"+classname;
if(!window.confirm("Провести документ?"))return false;
var ok=#server(Docs.Action.processdoc(doc))#
if(isNaN(ok)){alert(ok)}
else{alert("Документ успешно обработан");window.location.reload();}
}

function deldoc(classname,itemid){
if(!window.confirm("Удалить документ?"))return false;
var ok1=#server(Docs.Action.deletedoc(classname,itemid))#
if(isNaN(ok1)){alert(ok1)}
}
</script>
</head>
<body>
<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Отрицательные остатки</strong></TD>
<td width=10% align=right>&nbsp;</td>
</TABLE>
<br><br>
<table>
<thead bgcolor="#dedede">
	<td><b>Товар</b></td>
	<td><b>Ячейка</b></td>
	<td><b>Количество</b></td>
	<td><b>Резерв</b></td>
	<td>Инв.<br><input type="checkbox" style="width:17px;border:none" onclick="CheckAll()" id="cbCheckAll" title="Отметить все товары для инвентаризации"></td>
	<td>Перемещ<br><input type="checkbox" style="width:17px;border:none" onclick="CheckAll2()" id="cbCheckAll2" title="Отметить все товары для перемещения"></td>
</thead>
<script language="cache" runat="server">
 n ID,GoodsFullName,AddrPath,Value1,Value2,Goods,Address,DepotName
  &sql(declare zzz cursor for select 
  ID,Goods->FullName as GoodsFullName,Common.SqlProcs_AddrPath(Address) as AddrPath,Value1,Value2,Goods,Address,Address->Depot->Name
  into :ID,:GoodsFullName,:AddrPath,:Value1,:Value2,:Goods,:Address,:DepotName
  from Store.Quantity
  where Value1<0)
  &sql(open zzz)
  f  &sql(fetch zzz) q:SQLCODE  d
  . w "<tr bgcolor=""#effafa"" title=""открыть/скрыть список документов товара"" onclick=""ShowHide('"_ID_"')"" id="""_ID_""" style=""cursor:hand"" onmouseover=""this.style.backgroundColor='#efefee'"" onmouseout=""this.style.backgroundColor='#effafa'"">"
  . w "<td><a href=""#"" style=""text-decoration:none;color:black"" title=""Открыть карточку товара"" onclick=""GoodCard('"_Goods_"')"" onmouseover=""this.style.color='blue'"" onmouseout=""this.style.color='black'"">"_GoodsFullName_"</a></td>"
  . w "<td><a href=""#"" style=""text-decoration:none;color:black"" title=""Открыть карточку ячейки"" onclick=""StoragePlaceCard('"_Address_"')"" onmouseover=""this.style.color='blue'"" onmouseout=""this.style.color='black'"">"_DepotName_" "_AddrPath_"</a></td>"
  . w "<td>"_Value1_"</td>"
  . w "<td>"_Value2_"</td>"
  . w "<td><input type=""checkbox"" id="""_Goods_"@"_Address_"@checkbox"" title=""Отметить для создания обнуляющей инвентаризации"" style=""width:17px;border:none""></td>"
  . w "<td><input type=""checkbox"" id="""_Goods_"@"_Address_"@"_Value1_"@checkbox2"" title=""Отметить для создания док. перемещения"" style=""width:17px;border:none""></td>"
  . w "</td>"
  . s AllCheckBox=$G(AllCheckBox)_";"_Goods_"@"_Address_"@checkbox"
  . s AllCheckBox2=$G(AllCheckBox2)_";"_Goods_"@"_Address_"@"_Value1_"@checkbox2"
  . w "</tr>",!
  . w "<tr id="""_ID_"docs"" style=""display:none""><td colspan=4>",!
  . w "<table width=100% cellpaddind=3 cellspacing=4><tr bgcolor=""#efeeef""><td bgcolor='white'>&nbsp;</td><td>Документ</td><td>Дата создания</td><td>Дата закрытия</td><td>Кол-во</td><td>&nbsp;</td></tr>",!
  . d ..gobo(.DocsArray,Goods,Address)
  . if $D(DocsArray)<=1 d  q
  . . w "<td colspan=5 align=center>нет документов</td>"
  . . w "</table></td></tr>",!
  . s i="" f  s i=$O(DocsArray(i)) d  q:i=""
  . . if i="" q
  . . w "<tr bgcolor=""#efeeef"" onmouseover=""this.style.backgroundColor='#dddddd'"" onmouseout=""this.style.backgroundColor='#efeeef'""><td bgcolor='white'><img src=""images/brace.gif"" width=""10""></td>"
  . . w "<td>"_$G(DocsArray(i,"docname"))_" ("_DocsArray(i,"DocumentClassName")_")</td>"
  . . w "<td>"_$G(DocsArray(i,"docdat"))_"</td>"
  . . w "<td>"_$G(DocsArray(i,"docclose"))_"</td>"
  . . w "<td>"_$G(DocsArray(i,"quant"))_"</td>",!
  . . w "<td><img src=""images/print.gif"" alt=""Распечатать инструкцию по отгрузке"" onclick=""print('"_$G(DocsArray(i,"doc"))_"','"_DocsArray(i,"DocumentClass")_"')"">"
  . . w:$G(DocsArray(i,"DocumentClass"))="Docs.StorageOut" "<img src=""images/goinside.gif"" alt=""Журнал формирования инструкции"" onclick=""LogOfCreation('"_$G(DocsArray(i,"doc"))_"')""></td></tr>",!
  . w "</table></td></tr>",!
  w "<script language=""jscript"">",!
  w "var AllCheckBox='"_$G(AllCheckBox)_"';",!
  w "var AllCheckBox2='"_$G(AllCheckBox2)_"';",!
  w "</"_"script>",!
  &sql(close zzz)
</script>
</table>
<sklad:Button onclick="CreateInvent();" value="Создать обнуляющую инвентаризацию" alt="Инвентаризация включит в себя все отмеченные товары">
<sklad:Button onclick="CreateInner();" value="Создать документ перемещения" alt="Документ перемещения включит в себя все отмеченные товары с указанного места на место где такой товар уже присутствует">
<br>
Данная страница предназначена для обработки отрицательного остатка в базе.<br>
Предусмотрено две возможности избавиться от отрицательного остатка: <br>
&nbsp;&nbsp;&nbsp;&nbsp;1 Создать обнуляющую инвентаризацию. Для этого необходимо отметить выбранные товары и нажать кнопку "создать обнуляющую инвентаризацию" под таблицей. Программа создаст и покажет документ. После просмотра и сохранения программа спросит подтверждение провести документ, если ответить "да" то остаток обнулится и таблица отрицательных остатков обновится. Если документ не сохранять, то по выходу из формы документа программа спросит подверждение на удаление документа.<br>
&nbsp;&nbsp;&nbsp;&nbsp;2 Создать документ перемещения, таким образом что бы из ячейки, где такой товар присутствует перенести в ячейку с отрицательным количеством недостающее до нуля количество. Поведение документа аналогично поведению описанному выше, то есть после создания программа спросит подтверждение на проведение или подтверждение на удаление (если документ не стали сохранять).<br>
<br><p font-color=gray font-face=Arial>Для того что бы посмотреть <b>список документов</b> по данному товару необходимо кликнуть на строку товара<br>
Что бы открыть <b>карточку товара</b> необходимо кликнуть на сам товар<br>
Что бы открыть <b>карточку ячейки</b> необходимо кликнуть на ячейку<br>
Выводятся <b>только</b> те типы документов, которые непосредственно могут <b>влиять на остатки</b>: Инструкция по размещению, Инструкция по отбору, Инвентаризация, Утилизация, Внутреннее перемещение<br>
Документы выводятся только те, которые работали <b>с данной ячейкой</b><br>
Справа от каждого документа расположена <b>кнопка для печати документа</b><br>
Справа от каждого инструкции по отгрузке расположена <B>кнопка для печати журнала формирования инструкции</b><br>
<br></p>
</body>
</html>
]]></CSP>


<CSP name="norights.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
</head>

<body>
<center style="FONT-size: 18px ; font-family: arial; COLOR: rgb(252,0,0);">У вас нет прав доступа. Обратитесь к руководителю или зайдите под другим именем.</center>
</body>
</html>]]></CSP>


<CSP name="oldtovars.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>

<!-- Put your page Title here -->
<title>	Cache Server Page </title>

</head>

<body>
<a href="\\pups\Мои документы\Товар.xls">файл</a><br>
всего строк #($O(^tovar(""),-1))#
<table border=1><tr><td>обработано строк<td>#($G(^result(3,"обработано")))#
<tr><td>пропущено строк<td>#($G(^result(4,"пропущено")))#
</table>
<input type="button" onclick="window.location.href='oldtovars.csp?dd=1'" value="не обработанные">
<input type="button" onclick="window.location.href='oldtovars.csp?dd=2'" value="обработанные">
<script language="cache" runat="server">
 s d=%request.Get("dd")
 s n=$S(d="1":"не обработанные",d="2":"обработанные",1:"не обработанные")
 w "<center>"_n_"</center>"
 s tovar=$NA(^tovar)
 s wh=1
 i d=2 s wh=0
 &html<<table border=1><tr><td>наименование<td>товар<td>склад<td>количество>
 s i=1 f  s i=$O(@tovar@(i)) q:i=""  d
 . q:+$G(@tovar@(i))=wh
 . w "<tr><td>"_$G(@tovar@(i,1))
 . w "<td>"_$G(@tovar@(i,2))
 . w "<td>"_$G(@tovar@(i,3))
 . w "<td>"_$G(@tovar@(i,4))
</script>
</body>
</html>
]]></CSP>


<CSP name="Operations.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
</head>
<body>

<table width=100% border=0 height=100%><tr><td width=20% valign="top">
<br>
<div class=ButtonDivHover >Текущие операции</div><br>
<div class=ButtonDiv style="cursor:hand" onmouseover="this.className='ButtonDivHover'" onmouseout="this.className='ButtonDiv'" onclick="demo()">Шаблоны операций</div><br>
<div class=ButtonDiv style="cursor:hand" onmouseover="this.className='ButtonDivHover'" onmouseout="this.className='ButtonDiv'" onclick="demo()">История операций</div><br>
<div class=ButtonDiv style="cursor:hand" onmouseover="this.className='ButtonDivHover'" onmouseout="this.className='ButtonDiv'" onclick="demo()">Расписание</div><br>
</td>
<td width=80%  valign="top">
<iframe src="OperationsRight.csp" style="width:100%;height:100%;" frameborder="0"></iframe></body>
</td>
</tr></table>
</html>]]></CSP>


<CSP name="Operations2.CSP" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s Dat1=%request.Get("Dat1")
 s Dat2=%request.Get("Dat2")
 if '+Dat1 s Dat1=$ZD(+$H,4)
 if '+Dat2 s Dat2=$ZD(+$H,4)
 s Abbr=%request.Get("abbr")
 s Property3609=%request.Get("Property3609")
 s Gname=%request.Get("Gname")
 s GoodsId=%request.Get("GoodsId")
 s OperationType=%request.Get("OperationType")
</script>
<html>
<head>
<title>	Операции </title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript">
 sessionid="#(%session.SessionId)#";
 
 function GoodCard(GoodsId){
	InnerSplitter="~";
	ok=window.showModalDialog("GoodsCard.csp?GoodsId="+GoodsId+"&groupspath=",GoodsId+InnerSplitter+"","center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
 }
 
 function print(docid,docclass){
 window.open("print.csp?id="+docid+"&class="+docclass+"&sessionid="+sessionid)
 }

 function StoragePlaceCard(StoreId){
 ok=window.showModalDialog("StorePlace.csp?StoreId="+StoreId,"","center:yes;status:no;dialogHeight:500px;dialogWidth:740px;resizable:yes")
 } 
 
 function fnCalendar(cal){
var newDate=window.showModalDialog("calendar1.htm","","center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;");
if(ReturnSpace(newDate)!=""){cal.value=newDate;}
}

function startFun(){
 var Dat1=dat1z.value;
 var Dat2=dat2z.value;
 var abbr=abbrz.value;
 var Property3609=Property3609z.value;
 var Gname=gnamez.value;
 var OperationType=OperationTypez.value;
 window.location.href="Operations2.csp?Dat1="+Dat1+"&Dat2="+Dat2+"&abbr="+abbr+"&Property3609="+Property3609+"&Gname="+Gname+"&OperationType="+OperationType;
}

function ReturnSpace(Txt){
if(Txt==null)return "";
return Txt;
}
</script>
</head>
<body>
<CSP:IF CONDITION='GoodsId=""'>

<sklad:Button value="Назад" onclick="window.location.href='tuneup.csp'"><br>
<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" ><strong>Операции</strong></TD>
<td width=10% align=right>&nbsp;</td>
</TABLE>
<br>
<fieldset><legend>Параметры отбора</legend>
<table width="100%">
<tR><td>
	<b>Товар</b>&nbsp;&nbsp;аббревиатура: <input type="text" id="abbrz" style="width:40px;" value="#($G(Abbr))#">&nbsp;&nbsp;номер модели: <input type="text" id="Property3609z" style="width:40px;" value="#($G(Property3609))#">&nbsp;&nbsp;наименование: <input type="text" id="gnamez" style="width:200px;" value="#($G(Gname))#"> <br>
	<b>Период</b> c <input type=text id="dat1z" value="#($G(Dat1,$ZD($H,4)))#" onclick="fnCalendar(this)" class="datar"> по <input type=text id="dat2z" value="#($G(Dat2,$ZD($H,4)))#" onclick="fnCalendar(this)" class="datar"><br>
	<b>Тип операции</b> 
		<select id="OperationTypez">
			<script language="cache" runat="server">
			w ##class(Docs.Action2).GetDisplaylistOptions($G(OperationType),"Operation.Operation||OperationType")
			</script>
		</select><br>
<sklad:Button value="Выбрать" onclick="startFun();">
</td>
<td align="right" valign="top">
<img src="images/BIGHelp.bmp" onclick="divSelectHelp.style.display='block'" width="20" height="25" id="imgHelp" onmouseout="divSelectHelp.style.display='none';">
<div id="divSelectHelp" style="background:yellow;display:none;position:absolute;top:40px;left:500px;width:200px;height:70px;" onmouseout="this.style.display='none';"><table cellpadding=5><tr><td>Наименование или аббревиатуру товара не обязательно вводить полностью, достаточно ввести начальные буквы.<br>Тип операции можно не указывать.<br></td></tr></table></div>
</td>
</table>
</fieldset>

</CSP:IF>

<br>
<table>
<thead bgcolor="#dedede">
	<td><b>Тип операции</b></td><td><b>Товар</b></td><td><b>Ячейка</b></td><td><b>Документ</b></td><td><b>Количество</b></td><td><b>Остаток<br>после операции</b></td><td><b>Дата, время</b></td><td><b>Оператор</b></td>
</thead>
<script language="cache" runat="server">
 n ID,GoodsFullName,AddrPath,Goods,Address
   s select="select ID,Goods->FullName as GoodsFullName,Common.SqlProcs_AddrPath(Address) as AddrPath,Quantity,Ostatok,Goods,Address,Dat,Tim,User1->Name as User1Name,%external(OperationType) as OperationTypeName,DocStr->doc->name as docname,DocStr->doc as doc,DocStr->doc->DocumentClass as DocumentClass"_
  " from Operation.Operation Where Dat>='"_$ZDH(Dat1,4)_"' and Dat<='"_$ZDH(Dat2,4)_"'"
  if Abbr'="" s select=select_" and Goods->abbr %STARTSWITH '"_Abbr_"'"
  if Property3609'="" s select=select_" and Goods->Property3609 %STARTSWITH '"_Property3609_"'"
  if Gname'="" s select=select_" and Goods->Name %STARTSWITH '"_Gname_"'"
  if GoodsId'="" s select=select_" and Goods = '"_GoodsId_"'"
  if +OperationType s select=select_" and OperationType = '"_OperationType_"'"
  //&sql(declare zzz cursor for select 
  //ID,Goods->FullName as GoodsFullName,Common.SqlProcs_AddrPath(Address) as AddrPath,Quantity,Ostatok,Goods,Address,Dat,Tim,User1->Name,%external(OperationType),DocStr->doc->name,DocStr->doc,DocStr->doc->DocumentClass
  //into :ID,:GoodsFullName,:AddrPath,:Quantity,:Ostatok,:Goods,:Address,:Dat,:Tim,:User1,:OperationType,:Document,:DocId,:DocumentClass
  //from Operation.Operation)
  //&sql(open zzz)
  //f  &sql(fetch zzz) q:SQLCODE  d
  s rs=##class(%ResultSet).%New()
  s ok=rs.Prepare(select)
  s ok=rs.Execute()
  while rs.Next(){
   f i="ID","GoodsFullName","AddrPath","Quantity","Ostatok","Goods","Address","Dat","Tim","User1Name","DocumentClass","doc","docname","OperationTypeName" d
   . s @i=rs.Data(i)   
   s Datetime=$S(+Dat:$ZD(Dat,4),1:"")_" "_$S(+Tim:$ZT(Tim),1:"")
   w "<tr bgcolor=""#effafa"" id="""_ID_""" onmouseover=""this.style.backgroundColor='#efefee'"" onmouseout=""this.style.backgroundColor='#effafa'"">"
   w "<td>"_OperationTypeName_"</td>"
   w "<td><a href=""#"" style=""text-decoration:none;color:black"" title=""Открыть карточку товара"" onclick=""GoodCard('"_Goods_"')"" onmouseover=""this.style.color='blue'"" onmouseout=""this.style.color='black'"">"_GoodsFullName_"</a></td>"
   w "<td><a href=""#"" style=""text-decoration:none;color:black"" title=""Открыть карточку ячейки"" onclick=""StoragePlaceCard('"_Address_"')"" onmouseover=""this.style.color='blue'"" onmouseout=""this.style.color='black'"">"_AddrPath_"</a></td>"
   if +doc s DocumentString="<a href=""#"" style=""text-decoration:none;color:black"" title=""Просмотреть документ"" onclick=""print('"_doc_"','"_DocumentClass_"')"" onmouseover=""this.style.color='blue'"" onmouseout=""this.style.color='black'"">"_docname_"</a>"   
   else  s DocumentString="&nbsp;"
   w "<td>"_DocumentString_"</td>"
   w "<td>"_Quantity_"</td>"
   w "<td>"_Ostatok_"</td>"
   w "<td>"_Datetime_"</td>"
   w "<td>"_User1Name_"</td>"
   w "</tr>",!
  }
  //&sql(close zzz)
</script>
</table>
<br><p font-color=gray font-face=Arial>
Что бы открыть карточку товара необходимо кликнуть на сам товар<br>
Что бы открыть карточку ячейки необходимо кликнуть на ячейку<br>
<br></p>
</body>
</html>
]]></CSP>


<CSP name="OperationsRight.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<link href="style.css" type=text/css rel=stylesheet>
<SCRIPT Language="VBScript">

Sub Window_onLoad()

Set o1=LV.ColumnHeaders.Add(,,"Шаблон")
o1.Width=120
Set o1=LV.ColumnHeaders.Add(,,"Наименование")
o1.Width=220
Set o1=LV.ColumnHeaders.Add(,,"Начало")
o1.Width=110
o1=LV.ColumnHeaders.Add(,,"Прошло времени")
o1=LV.ColumnHeaders.Add(,,"Статус")
o1=LV.ListItems.Add(,,"Подбор товара")
d=LV.ListItems.Item(1).ListSubItems.Add(,,"Игрушки для ООО Детский мир") //Наименование
d=LV.ListItems.Item(1).ListSubItems.Add(,,"22/02/06 11:30")  //Начало
d=LV.ListItems.Item(1).ListSubItems.Add(,,"0 дней 3 ч. 45 мин.")  //С начала прошло
d=LV.ListItems.Item(1).ListSubItems.Add(,,"В процессе")  //Статус

o1=LV.ListItems.Add(,,"Маркировка")
d=LV.ListItems.Item(2).ListSubItems.Add(,,"Маркировка электропроводов") //Наименование
d=LV.ListItems.Item(2).ListSubItems.Add(,,"22/02/06 12:45")  //Начало
d=LV.ListItems.Item(2).ListSubItems.Add(,,"0 дн. 2 ч. 05 мин.")  //С начала прошло
d=LV.ListItems.Item(2).ListSubItems.Add(,,"В процессе")  //Статус
End Sub


</SCRIPT>
<script language="jscript" src="common.js"></script>
</head>
<body>
<TABLE cellSpacing=0 width="100%" celpadding="0" border=0>
<TBODY>
<TR>
<TD style="BACKGROUND: rgb(233,243,255); FONT: bold 18px Tahoma; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid">&nbsp;&nbsp;&nbsp;Текущие операции</TD></tr>
<tr>
<td valign=top>
<br>
<sklad:ListView id="LV" style="width:100%;height:300;font:regular Arial 10" >
<img src="images/new.gif" onmouseover="newgr.src='images/Onnew.gif'" onmouseout="newgr.src='images/new.gif'"  ig="newgr" name="newgr" alt="Новая операция" onclick="demo()">
<img src="images/pause.gif" onmouseover="pausop.src='images/Onpause.gif'" onmouseout="pausop.src='images/pause.gif'"  ig="pausop" name="pausop" alt="Приостановить операцию" onclick="demo()">
<img src="images/del.gif" onmouseover="delgr.src='images/Ondel.gif'" onmouseout="delgr.src='images/del.gif'"  ig="delgr" name="delgr" alt="Завершить операцию" onclick="demo()">
</td>
</tr>
</TABLE>
</body>
</html>]]></CSP>


<CSP name="Reports/InnerInstrGoods.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"),0)
 
Quit 1
</script>
<server>
	s now=$zd(+$h,4)
	s d1=$g(Args("d1",1),now), d2=$g(Args("d2",1),now)

 if %request.Get("fromform")
 {
	 s kontr = %request.Get("kontr")
	 if kontr=""  s colspan=3
	 s d1= %request.Get("d1")
	 s d2= %request.Get("d2")
	 
	 s d1Cache=+$H-30
	 s d2Cache=+$H
	 if d1?2N1"/"2N1"/"4N s d1Cache=$ZDH(d1,4)
	 if d2?2N1"/"2N1"/"4N s d2Cache=$ZDH(d2,4)
 }
</server>
<html>
<head>
<title>	Отгрузка запчастей за период </title>

<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link type="text/css" href="../css/redmond/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
<script src="../js/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
<script src="../js/i18n/jquery-ui.datepicker-ru.min.js" type="text/javascript"></script>
<style>
 BODY {margin: 20px;font-family:Arial}
   	
  	table.report {border:collapse;border:1px solid #6e6e6e;}
  	table.report th {font-weight:normal}
  	table.report td,table.report th {border:1px solid #6e6e6e;}
</style>
<script language="javascript" type="text/javascript">
    $(document).ready(function()
    {
       	$.datepicker.setDefaults( $.datepicker.regional[ "ru" ] );
       	$(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', duration: 0 });
     });
</script>
</head>

<body>
<h2>Движение товара</h2>
<fieldset><legend>Параметры отчета</legend>
<form method="post"><input type="hidden" value="1" name="fromform">
	<table>
	<tr><td>Период <label for="d1">с:</label></td>
		<td><input type="text" id="d1" name="d1" maxlength="10" class='datepicker' title="Начало диапазона" value="#(d1)#" />
			<label for="d2">по:</label>
			<input type="text" id="d2" name="d2" maxlength="10" class='datepicker' title="Конец диапазона" value="#(d2)#" />
		</td></tr>
	<!--
	<tr><td><label for="kontr">Контрагент:</label></td>
		<td><select type="text" id="kontr" name="kontr" title="Контрагенты">
<server>
  d ..wKontrOptions($G(kontr))	
</server>
		</select></td></tr>
	-->
	</table>
	<input type="submit" id="btnRun" value="Сформировать" title="Запустить формирование отчета" />
	</form>
	</fieldset>
<server>
  if %request.Get("fromform")=1
 {
	&html<
	<br><br>
	<Table id="maintable" class='report' cellpadding=7 cellspacing=0>
		<tr>
			<th>Дата внутр. инструкции
			<th>Внутрн. инструкция
			<th>Заявка
			<th>гарантия/платно
			<th>Серийный номер
			<th>Количество
			<th>Товар
			<th>Контрагент
			<th>Состояние заявки
		</tr>
	>	

	&sql(declare zz cursor for
		SELECT Doc,id,%external(Doc->Dat),Doc->Kontr->Name,Doc->Name,Goods->FullName,serial,quantreal
		INTO :doc,:id,:DocDat,:DocKontr,:DocName,:GoodsFullName,:serial,:quantreal
		FROM Docs.StorageOutItems
		WHERE doc->dat>=:d1Cache and doc->dat<=:d2Cache and doc->stat=2)
	&sql(OPEN zz)
	for
	{
		&sql(FETCH zz)
		q:SQLCODE
		
		&sql(select Name,RashOplatType->Name,%external(State)
			INTO :Name,:RashOplatType,:State 
			FROM Operation.Instructions
			WHERE innerinstr=:doc)
		
		&html<
		 <tr>
		 	<td>#(DocDat)#
		 	<td><a href="../print.csp?class=Docs.StorageOut&id=#(doc)#" target=_blank>#(DocName)#</a>
		 	<td>#(Name)#
		 	<td>#(RashOplatType)#
		 	<td>#(serial)#
		 	<td>#(quantreal)#
		 	<td>#(GoodsFullName)#
		 	<td>#(DocKontr)#
		 	<td>#(State)#
		 </tr>
		>
	}
	&sql(CLOSE zz)
	
	w "</table>"
 }
 </server>
</body>
</html>

]]></CSP>


<CSP name="Reports/InOut.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 i %session.NewSession d
 . s %session.EndSession=1
 . s sessionid=%request.Get("sessionid",1)
 . s %session=%session.GetSession(sessionid)
 e  s sessionid=%session.SessionId
 s login=$G(%session.Data("user"),0)
 
Quit 1
</script>
<server>
	s now=$zd(+$h,4)
	s d1=$g(Args("d1",1),now), d2=$g(Args("d2",1),now)
	s GoodsId = %request.Get("GoodsId")
	if GoodsId &sql(select FullName into :FullName from Goods.Goods where id=:GoodsId)
	s colspan = 2
 if %request.Get("fromform")
 {
	 s kontr = %request.Get("kontr")
	 if kontr=""  s colspan=3
	 s d1= %request.Get("d1")
	 s d2= %request.Get("d2")

	 s d1Cache=+$H-30
	 s d2Cache=+$H
	 if d1?2N1"/"2N1"/"4N s d1Cache=$ZDH(d1,4)
	 if d2?2N1"/"2N1"/"4N s d2Cache=$ZDH(d2,4)
 }
</server>
<html>
<head>

<title>	Движение товара </title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link type="text/css" href="../css/redmond/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
<script src="../js/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
<script src="../js/i18n/jquery-ui.datepicker-ru.min.js" type="text/javascript"></script>
<style>
 BODY {margin: 20px;font-family:Arial}
   	
  	table.report {border:collapse;border:1px solid #6e6e6e;}
  	table.report th {font-weight:normal}
  	table.report td,table.report th {border:1px solid #6e6e6e;}
</style>
<script language="javascript" type="text/javascript">
//разделитель строк
var StringSplitter="#@#";
//разделитель элементов внутри строки
var InnerSplitter="~";

    $(document).ready(function()
    {
       	$.datepicker.setDefaults( $.datepicker.regional[ "ru" ] );
       	$(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', duration: 0 });
     });

function ChooseGoods()
{
	WinResult=window.showModalDialog("../selectgoods2.csp","","center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;")
	if(WinResult==null)return
	var TovarsString="";
	var IDsString="";
	var TovarsArray=WinResult.split(InnerSplitter);
		var IDsString=TovarsArray[0];
		var TovarsString=TovarsArray[10];
	$("#GoodsName").text(TovarsString);
	$("#GoodsId").val(IDsString);
}
</script>
</head>

<body>
<h2>Движение товара</h2>
	<fieldset><legend>Параметры отчета</legend>
	<form method="post"><input type="hidden" value="1" name="fromform">
	<server>
	if '+GoodsId
	{
		w "<input type=""button"" value=""выбрать товар"" onclick=""ChooseGoods()"">"
	}
	</server>
	<input type="hidden" name="GoodsId" id="GoodsId" value="#(GoodsId)#"><b id="GoodsName">#($G(FullName))#</b>
	<table>
	<tr><td>Период <label for="d1">с:</label></td>
		<td><input type="text" id="d1" name="d1" maxlength="10" class='datepicker' title="Начало диапазона" value="#(d1)#" />
			<label for="d2">по:</label>
			<input type="text" id="d2" name="d2" maxlength="10" class='datepicker' title="Конец диапазона" value="#(d2)#" />
		</td></tr>
	<tr><td><label for="kontr">Контрагент:</label></td>
		<td><select type="text" id="kontr" name="kontr" title="Контрагенты">
<server>
  d ..wKontrOptions($G(kontr))	
</server>
		</select></td></tr>
	
	</table>
	<input type="submit" id="btnRun" value="Сформировать" title="Запустить формирование отчета" />
	</form>
	</fieldset>
<server>
  if %request.Get("fromform")=1
 {
	&html<
	<br><br>
	<Table id="maintable" class='report' cellpadding=7 cellspacing=0>
		<tr>
			<th>Документ
			<th>Дата
			#($S(kontr="":"<th>Контрагент",1:""))#
			<th>Приход
			<th>Расход
		</tr>
	
	>	 
	
	&sql(declare docs cursor for 
		select Doc,id,DocType,Doc->Dat,Quantity,Doc->Kontr,Doc->Name
		into :doc,:id,:DocType,:DocDat,:prih,:DocKontr,:DocName
		from Docs.DocItems
		where Goods=:GoodsId and doc->dat>=:d1Cache and doc->dat<=:d2Cache
			and DocType in ('Docs.StorageOut','Docs.Invent','Docs.StorageIn')
			and (Doc->Kontr=:kontr or :kontr=null) 
			and doc->stat=2
		 )
	&sql(open docs)
	for  
	{
		&sql(fetch docs)
		q:SQLCODE
		
		s rash=0
		
		if $D(DocNames(DocType))
		{
			s DocTypeName = $G(DocNames(DocType))
		}
		else
		{
			s DocTypeName = ##class(Docs.Action).GetDocNameFromClass(DocType)
			s DocNames(DocType) = DocTypeName
		}
		s KontrName = ""
		if kontr=""
		{
			if $D(KontrNames(+DocKontr))
			{
				s KontrName = $g(KontrNames(+DocKontr))
			}
			else
			{
				&sql(select Pseudonym into :KontrName 
					from Common.Kontragent
					where ID=:DocKontr)
				s KontrNames(+DocKontr)=KontrName
			}
		}
		
		s quantplan=""
		if DocType = "Docs.Invent"
		{
			&sql(select quantplan into :quantplan from Docs.InventItems where id=:id)
			if quantplan=rash continue
		}

		if DocType = "Docs.StorageOut"
		{
			&sql(select quantreal into :quantreal from Docs.Docs.StorageOutItems where id=:id)
			s rash = quantreal
			s prih = 0
		}		
		
		if DocType = "Docs.StorageIn"
		{
			&sql(select quantreal into :quantreal from Docs.Docs.StorageInItems where id=:id)
			s rash = 0
			s prih = quantreal
		}		
		
		s rashItog = $G(rashItog) + rash
		s prihItog = $G(prihItog) + prih
		
		//s Itog = $G(Itog) + Quantity
		w "<tr id="""_id_""">"
			w "<td>"
			w "<a href=""../print.csp?class="_DocType_"&id="_doc_""" target=_blank>"
			w DocTypeName_" "_DocName
			w "</a>"
			w "<td>"_$ZD(DocDat,4)
			if kontr="" 
			{
				w "<td>"
				w "<a href=""../Kontragent.csp?KontrId="_DocKontr_""" target=_blank>"
				w KontrName
				w "</a>"
			}
			w "<td>"_prih
			w "<td>"_rash
		w "</tr>"
	}
	w "<tr>"
		w "<td colspan="_colspan_">Итого"
		w "<td>"_$G(prihItog)
		w "<td>"_$G(rashItog)
	w "</tr>"
	&sql(close docs)
	w "</table>"
 }
</server>
</body>
</html>
<script language="Cache" method="wKontrOptions" arguments="kontr:%String" returntype="%String">

	w "<option value=''>&nbsp;&nbsp;Все контрагенты</option>"
	&sql(Declare krs Cursor For
		Select ID,Pseudonym Into :id,:Pseudonym
		From Common.Kontragent
		Order By Pseudonym
	) &sql(Open krs)
	for { &sql(FETCH krs) Q:SQLCODE'=0
		if $TR(Pseudonym," ","")="" continue
		w "<option value='",id,"' "
		w:id=kontr "selected='selected' "
		w ">",Pseudonym,"</option>"
	} &sql(Close krs)
	Q ""
</script>
]]></CSP>


<CSP name="screen/Act.csp" application="/csp/sklad2/" default="1"><![CDATA[
<CSP:CLASS includes="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s DocId=%request.Get("id")
 s:DocId DocObj = ##class(Docs.Act).%OpenId(DocId)
 d:$ISOBJECT($G(DocObj))
 . d:$ISOBJECT(DocObj.Kontr)
 . . s KontrName=DocObj.Kontr.Name
 . . s KontrAddress=DocObj.Kontr.Address
 . . s KontrId=DocObj.Kontr.%Id()
 . f i="Name","Goods","Serial","Garant","SellerName","SellerAddress","SellerPhone","RepairsQnt","DefectDescription","DefectEstimate","DefectClass","RepairRefuseReason","CustomerName","CustomerAddress","CustomerDoc","CustomerPhone","DefectClassDescr","GoodsKeeping","SrvName","SrvAddr","SrvPhone","SrvFIO","NumbersHistory" d
 . . s @i=$ZOBJPROPERTY(DocObj,i)
 . s DefectClass=##class(Docs.Act).DefectClassLogicalToDisplay(DefectClass)
 . s GoodsKeeping=##class(Docs.Act).GoodsKeepingLogicalToDisplay(GoodsKeeping)
 . f i="ExpertDate","ExpertDate","RemontDate","ActDate","SellerDate" d
 . . s @i=$ZOBJPROPERTY(DocObj,i)
 . . if @i?5N s @i=$ZD(@i,4)
 . if $ISOBJECT(Goods) d
 . . s GoodsName=Goods.Name
 . . s GoodsId = Goods.%Id()
 . . s GoodsModel=Goods.ModelNumber
 . . s GoodsAbbr=Goods.abbr
 . e  s (GoodsName,GoodsModel)="не указано"
 . s RequestRows=""
 . q:'$ISOBJECT(DocObj.Items)
 . s i="" f  s i=DocObj.Items.Next(i) q:i=""  d
 . . s item=DocObj.Items.GetAt(i)
 . . //q:'$ISOBJECT(item.Request)
 . . s RequestRows=RequestRows_item.Request.Name_" "_$ZD(item.Request.Dat,4)_" "_item.RequestItem.Goods.FullName_"; "
 . s MM=$$$TunesVariableGlobal("MM")	//список аббревиатур мастермакс через запятую
 . s VC=$$$TunesVariableGlobal("VC")
 . s TL=$$$TunesVariableGlobal("TL")
 . f brandname="MM","VC","TL" d
 . . f i=1:1:$L(@brandname,",") d
 . . . //обрезаем пробелы
 . . . s abbr=$TR($P(@brandname,",",i)," ","")
 . . . q:abbr=""
 . . . s @brandname@(abbr)=""
 . s BrandName=$S($D(MM(GoodsAbbr)):"Mastermax",$D(VC(GoodsAbbr)):"Viconte",$D(TL(GoodsAbbr)):"Tull",1:"")
</script>

<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>Акт технической экспертизы #($G(Name))#</title>
<style>
.ClickSpan{cursor:hand;}
.ClickSpan:hover{
font-family:Arial;
font-size:14px;
color:rgb(90,0,0);
text-decoration : underline;
}
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Обычный;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:14.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Arial Unicode MS";
	mso-font-kerning:0pt;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{mso-style-noshow:yes;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	background:navy;
	font-size:12.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-type:hybrid;}
@list l0:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
<script language="javascript" type="text/javascript">
function wopen(url,params)
{
	if(typeof(params) == "undefined"){var params=""}
	//window.showModalDialog(url,params,"center:yes;status:no;dialogHeight:400px;dialogWidth:800px;resizable:yes")
	window.open(url);
}
</script>
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-family:Arial'>АКТ ТЕХНИЧЕСКОГО ОСМОТРА № <u>#($G(Name))#</u></span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=1 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Наименование фирмы производителя <span
     class=SpellE>изделия<span class=GramE>: <u>#($G(BrandName))#</u></span></span><span
     class=GramE>;</span></span></li>
</ol>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=2 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     class=SpellE><span style='font-family:Arial'>Изделие<span class=GramE>: <u>#($G(GoodsName))#</u></span></span></span><span
     class=GramE><span style='font-family:Arial'>; </span></span><span
     class=SpellE><span style='font-family:Arial'>Модель <u><span class="ClickSpan" style="cursor:hand" onclick="wopen('GoodCard.csp?GoodId=#($G(GoodsId))#')" >#($G(GoodsModel))#</span></u></span></span><span
     style='font-family:Arial'>; </span></li>
</ol>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=3 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Заводской<span class=GramE>
     №: <u>#($G(Serial))#</u>; </span>Гарантийный талон №: <u>#($G(Garant))#</u>;</span><br>
 	<span style='font-family:Arial'>История изменения номеров: #($G(NumbersHistory))#;</span></li>
</ol>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=4 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Наименование продавца,<span
     style='mso-spacerun:yes'> <u>#($G(SellerName))#</u> </span><span class=SpellE>адрес<span
     class=GramE>:<u>#($G(SellerAddress))#</u></span></span><span
     class=GramE>; </span><span class=SpellE>Телефон:<u>#($G(SellerPhone))#</u></span>;
     Дата продажи:<span style='mso-spacerun:yes'> 
     </span><u>#($G(SellerDate))#</u>;</span></li>
</ol>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=5 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span style='font-family:Arial'>Наименование
     сервисного центра<span class=GramE>: <u><span onclick="wopen('kontragent.csp?KontrId=#($G(KontrId))#')">#($G(SrvName))#</span></u></span><span
     class=GramE>; <br></span>Адрес: <u>#($G(SrvAddr))#</u>;</span>
</li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=6 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span style='font-family:Arial'>     Дата осмотра: <span class=SpellE>#($G(ExpertDate))#</span>; Дата поступления в
     ремонт: <span class=SpellE>#($G(RemontDate))#</span>; <span class=SpellE>
	 <br>Телефон: <u>#($G(SrvPhone))#</u></span>; Ф.И.О. директора: <span class=SpellE><u>#($G(SrvFIO))#</u></span>;</span>
</li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=7 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span style='font-family:Arial'>Количество
     проведенных ремонтов данного изделия <u>#($G(RepairsQnt))#</u></span></li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=8 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span style='font-family:Arial'>Подробное описание неисправности: <u>#($G(DefectDescription))#</u>;</span></li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=9 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span style='font-family:Arial'>Предполагаемая
     причина возникновения неисправности<span class=GramE>: <u>#($G(DefectEstimate))#</u>;</span></span></li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=10 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span class=GramE><span style='font-family:Arial'>Классификация
     происхождения дефекта: <u>#($G(DefectClass))# #($G(DefectClassDescr))#</u>;</span></span><span
     style='font-family:Arial'></span></li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=11 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Причина отказа в проведении гарантийного ремонта<span
     class=GramE> :<u>#($G(RepairRefuseReason))#</u></span></span></li>;
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=12 type=1>
 <li class=MsoNormal style='text-align:justify;mso-list:l0 level1 lfo1;
     tab-stops:list 36.0pt'><span class=GramE><span style='font-family:Arial'>Заявка</span></span><span
     style='font-family:Arial'> по которой были заказаны запчасти и не
     поступили (номер, дата, заявленные запчасти): <u>#($G(RequestRows))#</u>
     
     </span></li>
</ol>

<p class=MsoNormal style='text-align:justify'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=13 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Ф.И.О. потребителя, его паспортные данные, адрес
     и контактный телефон: <u>#($G(CustomerName))# #($G(CustomerDoc))# #($G(CustomerAddress))# #($G(CustomerPhone))#</u></span></li>
</ol>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=14 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Товар оставлен в сервисном центре на
     ответственное хранение <u>#($G(GoodsKeeping))#</u>;</span></li>
</ol>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<ol style='margin-top:0cm' start=15 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'><span
     style='font-family:Arial'>Дата выписывания акта: #($G(ActDate))#</span></li>
</ol>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'>Подпись
директора<span style='mso-tab-count:6'>                                                                </span>Подпись
потребителя:</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'>Сервисного
центра:</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><span
style='mso-tab-count:9'>                                                                                                    </span>___________________</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><span
style='mso-tab-count:9'>                                                                                                    </span></span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'>________________<span
style='mso-tab-count:2'>                 </span><b>М.П.</b><span
style='mso-tab-count:2'>               </span></span><span lang=EN-US
style='font-family:Arial;mso-ansi-language:EN-US'><span style='mso-tab-count:
1'>            </span></span><span style='font-family:Arial'><span
style='mso-tab-count:1'>            </span>___________________</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span style='font-family:Arial'><span
style='mso-tab-count:9'>                                                                                                    </span>фамилия
потребителя</span></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/actnote.csp" application="/csp/sklad2/" default="1"><![CDATA[
<csp:class includes="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 d:%session.NewSession 
 . s %session.EndSession=1
 . s ses=%request.Get("sessionid",1)
 . s %session=%session.GetSession(ses)
 q 1
</script>
<script language="cache" runat="server">
 s MM=$$$TunesVariableGlobal("MM")	//список аббревиатур мастермакс через запятую
 s VC=$$$TunesVariableGlobal("VC")
 s TL=$$$TunesVariableGlobal("TL")
 s (ZD,SC)=""
 //s ZD=$$$TunesVariableGlobal("ZD")
 //s SC=$$$TunesVariableGlobal("SC")
 
 //списки которые через запятую перегоним в массивы, и вырежем пробелы
 f brandname="MM","VC","TL","ZD","SC" d
 . f i=1:1:$L(@brandname,",") d
 . . //обрезаем пробелы
 . . s abbr=$TR($P(@brandname,",",i)," ","")
 . . q:abbr=""
 . . s @brandname@(abbr)=""

 s glob=$NA(^mtempReport($J))
 k @glob
 s docid = %request.Get("id")
 s ActNoteObj = ##class(Docs.ActNote).%OpenId(docid)
 if $ISOBJECT(ActNoteObj)
 {
	s Name=ActNoteObj.Name
	s Manager=ActNoteObj.Manager
	if $ISOBJECT(ActNoteObj.Kontr) s KontrName=ActNoteObj.Kontr.Name
	if $ISOBJECT(ActNoteObj.PaymentPoluh) s KontrName=ActNoteObj.PaymentPoluh.Name
	if $ISOBJECT(ActNoteObj.Chief) s ManName=ActNoteObj.Chief.Name
	s i="" 
	f  
	{
		s i=ActNoteObj.Items.Next(i) 
		q:i=""
		s item=ActNoteObj.Items.GetAt(i)
		if $ISOBJECT(item.Act) s ActName=item.Act.Name
		else  s ActName=""
		if $ISOBJECT(item.Goods)
		{
			s GoodsName=item.Goods.Name
			s GoodsAbbr=item.Goods.abbr
			s GoodsModel=item.Goods.Property3609
			
			s var=$S($D(MM(GoodsAbbr)):"MM",$D(VC(GoodsAbbr)):"VC",$D(TL(GoodsAbbr)):"TL",1:"untitled")
 			s @var=+$G(@var)+item.Price
		}
		else
		{
			s (GoodsName,GoodsAbbr,GoodsModel)=""
		}
		s price = item.Price
		s @glob@($I(@glob))="<tr class=xl27 height=20 style='height:15.0pt'>"_
		  "<td height=20 class=xl33 style='height:15.0pt;border-top:none'>1</td>"_
		  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsName)_"</td>"_
		  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsAbbr)_"</td>"_
		  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsModel)_"</td>"_
		  "<td class=xl33 style='border-top:none;border-left:none'>1</td>"_
		  "<td class=xl37 style='border-top:none'>"_price_"</td>"_
		  "<td class=xl36 width=120 style='border-top:none;width:90pt'>Принимаем</td>"_
		  "<td class=xl34 width=151 style='border-top:none;border-left:none;width:113pt'>Акт "_$G(ActName)_"</td>"_
		  "<td class=xl27></td>"_
		 "</tr>"
	}
	
	s ScarlettMoney=+$G(SC)
	s ZeidanMoney=+$G(ZD)
	s ViconteMoney=+$G(VC)
	s MastermaxMoney=+$G(MM)
	s TullMoney=+$G(TL)
 }
 /*
 s ManName = $$$SessionData("userName")
 s Seller=%request.Get("Seller")
 if +Seller
 {
	 &sql(select Name into :SellerName from Common.Kontragent where id=:Seller)
	 if SQLCODE s SellerName=""
 }

 s docids=%request.Get("docid")
 f i=1:1:$L(docids,"#@#")-1
 {
	 s docid=$P(docids,"#@#",i)
	 s DocObj = ##class(Docs.Act).%OpenId(docid)
	 if $ISOBJECT(DocObj)
	 {
		s ActName=DocObj.Name
		if $ISOBJECT(DocObj.Kontr) 
		{
			s KontrName=DocObj.Kontr.Name
			s Manager=DocObj.Kontr.Manager
		}
		if $ISOBJECT(DocObj.Goods)
		{
			s GoodsName=DocObj.Goods.Name
			s GoodsAbbr=DocObj.Goods.abbr
			s GoodsModel=DocObj.Goods.Property3609
		}
	 }
	s @glob@($I(@glob))="<tr class=xl27 height=20 style='height:15.0pt'>"_
	  "<td height=20 class=xl33 style='height:15.0pt;border-top:none'>1</td>"_
	  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsName)_"</td>"_
	  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsAbbr)_"</td>"_
	  "<td class=xl33 style='border-top:none;border-left:none'>"_$G(GoodsModel)_"</td>"_
	  "<td class=xl33 style='border-top:none;border-left:none'>1</td>"_
	  "<td class=xl37 style='border-top:none'>&nbsp;</td>"_
	  "<td class=xl36 width=120 style='border-top:none;width:90pt'>Принимаем</td>"_
	  "<td class=xl34 width=151 style='border-top:none;border-left:none;width:113pt'>Акт "_$G(ActName)_"</td>"_
	  "<td class=xl27></td>"_
	 "</tr>"
 }
 */
</script>
<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>.</o:Author>
  <o:LastAuthor>Student1</o:LastAuthor>
  <o:LastPrinted>2009-09-15T07:32:07Z</o:LastPrinted>
  <o:Created>2006-08-03T11:54:01Z</o:Created>
  <o:LastSaved>2009-09-15T07:37:04Z</o:LastSaved>
  <o:Company>.</o:Company>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--table
	{mso-displayed-decimal-separator:"\.";
	mso-displayed-thousand-separator:" ";}
@page
	{margin:.39in .79in .39in .79in;
	mso-header-margin:.51in;
	mso-footer-margin:.51in;
	mso-page-orientation:landscape;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
.style0
	{mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	white-space:nowrap;
	mso-rotate:0;
	mso-background-source:auto;
	mso-pattern:auto;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	border:none;
	mso-protection:locked visible;
	mso-style-name:Обычный;
	mso-style-id:0;}
td
	{mso-style-parent:style0;
	padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
.xl24
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl25
	{mso-style-parent:style0;
	text-align:left;}
.xl26
	{mso-style-parent:style0;
	text-align:right;}
.xl27
	{mso-style-parent:style0;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;}
.xl28
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;}
.xl29
	{mso-style-parent:style0;
	text-align:center;
	vertical-align:middle;}
.xl30
	{mso-style-parent:style0;
	font-weight:700;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl31
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl32
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl33
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;}
.xl34
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	white-space:normal;}
.xl35
	{mso-style-parent:style0;
	mso-number-format:"Short Date";
	text-align:left;}
.xl36
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	white-space:normal;}
.xl37
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl38
	{mso-style-parent:style0;
	text-align:right;
	white-space:normal;}
.xl39
	{mso-style-parent:style0;
	white-space:normal;}
.xl40
	{mso-style-parent:style0;
	font-weight:700;
	border-top:1.0pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	white-space:normal;}
.xl41
	{mso-style-parent:style0;
	font-weight:700;
	border-top:.5pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	white-space:normal;}
.xl42
	{mso-style-parent:style0;
	font-weight:700;
	border-top:.5pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	white-space:normal;}
.xl43
	{mso-style-parent:style0;
	font-weight:700;}
.xl44
	{mso-style-parent:style0;
	text-align:right;
	border-top:1.0pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:1.0pt solid windowtext;}
.xl45
	{mso-style-parent:style0;
	text-align:right;
	border-top:.5pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:1.0pt solid windowtext;}
.xl46
	{mso-style-parent:style0;
	mso-number-format:"\@";
	text-align:right;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:1.0pt solid windowtext;
	border-left:1.0pt solid windowtext;}
.xl47
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;}
.xl48
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	vertical-align:middle;}
.xl49
	{mso-style-parent:style0;
	text-align:right;
	vertical-align:middle;}
.xl50
	{mso-style-parent:style0;
	font-size:11.0pt;
	font-weight:700;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:left;
	vertical-align:middle;}
.xl51
	{mso-style-parent:style0;
	font-size:12.0pt;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:none;
	border-left:none;
	white-space:normal;}
-->
</style>
<!--[if gte mso 9]><xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
    <x:Name>Лист1</x:Name>
    <x:WorksheetOptions>
     <x:Print>
      <x:ValidPrinterInfo/>
      <x:PaperSizeIndex>9</x:PaperSizeIndex>
      <x:HorizontalResolution>600</x:HorizontalResolution>
      <x:VerticalResolution>600</x:VerticalResolution>
     </x:Print>
     <x:Selected/>
     <x:Panes>
      <x:Pane>
       <x:Number>3</x:Number>
       <x:ActiveRow>7</x:ActiveRow>
       <x:ActiveCol>3</x:ActiveCol>
       <x:RangeSelection>$D$8:$F$8</x:RangeSelection>
      </x:Pane>
     </x:Panes>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
    <x:Sorting>
     <x:Sort>Столбец 3</x:Sort>
    </x:Sorting>
   </x:ExcelWorksheet>
   <x:ExcelWorksheet>
    <x:Name>Лист2</x:Name>
    <x:WorksheetOptions>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
   <x:ExcelWorksheet>
    <x:Name>Лист3</x:Name>
    <x:WorksheetOptions>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
  <x:WindowHeight>8580</x:WindowHeight>
  <x:WindowWidth>15180</x:WindowWidth>
  <x:WindowTopX>120</x:WindowTopX>
  <x:WindowTopY>45</x:WindowTopY>
  <x:ProtectStructure>False</x:ProtectStructure>
  <x:ProtectWindows>False</x:ProtectWindows>
 </x:ExcelWorkbook>
</xml><![endif]-->
</head>

<body link=blue vlink=purple>

<table x:str border=0 cellpadding=0 cellspacing=0 width=1059 style='border-collapse:
 collapse;table-layout:fixed;width:795pt'>
 <col width=47 style='mso-width-source:userset;mso-width-alt:1718;width:35pt'>
 <col class=xl25 width=194 style='mso-width-source:userset;mso-width-alt:7094;
 width:146pt'>
 <col class=xl29 width=61 style='mso-width-source:userset;mso-width-alt:2230;
 width:46pt'>
 <col class=xl27 width=82 style='mso-width-source:userset;mso-width-alt:2998;
 width:62pt'>
 <col class=xl29 width=62 style='mso-width-source:userset;mso-width-alt:2267;
 width:47pt'>
 <col class=xl29 width=175 style='mso-width-source:userset;mso-width-alt:6400;
 width:131pt'>
 <col width=120 style='mso-width-source:userset;mso-width-alt:4388;width:90pt'>
 <col class=xl39 width=151 style='mso-width-source:userset;mso-width-alt:5522;
 width:113pt'>
 <col width=167 style='mso-width-source:userset;mso-width-alt:6107;width:125pt'>
 <tr height=17 style='height:12.75pt'>
  <td height=17 width=47 style='height:12.75pt;width:35pt'></td>
  <td class=xl35 width=194 style='width:146pt' x:num="40060">04.09.2009</td>
  <td class=xl29 width=61 style='width:46pt'></td>
  <td class=xl27 width=82 style='width:62pt'></td>
  <td class=xl29 width=62 style='width:47pt'></td>
  <td class=xl29 width=175 style='width:131pt'></td>
  <td colspan=2 class=xl26 width=271 style='width:203pt'>Директору по продажам</td>
  <td width=167 style='width:125pt'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td class=xl26><span style='mso-spacerun:yes'> </span></td>
  <td class=xl38 width=151 style='width:113pt'>Латышевой О.В.</td>
  <td></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 style='height:13.5pt'></td>
  <td class=xl25></td>
  <td class=xl30 colspan=4>Служебная записка № #($G(Name))#</td>
  <td class=xl43>Указать сумму:</td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td class=xl44>Mastermax</td>
  <td class=xl40 width=151 style='width:113pt'>#($G(MastermaxMoney))#</td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=6 style='height:12.75pt;mso-ignore:colspan'>Прошу
  внести уточнение при взаиморасчетах между ASKA elc. и #($G(KontrName))#</td>
  <td class=xl45 style='border-top:none'>Tull</td>
  <td class=xl41 width=151 style='border-top:none;width:113pt'>#($G(TullMoney))#</td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=5 style='height:12.75pt;mso-ignore:colspan'>Метка/Скидка
  ________/_______ на основании Договора поставки</td>
  <td class=xl29></td>
  <td class=xl45 style='border-top:none'>Viconte</td>
  <td class=xl41 width=151 style='border-top:none;width:113pt'>#($G(ViconteMoney))#</td>
  <td></td>
 </tr>
 
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=3 style='height:12.75pt;mso-ignore:colspan'>изделий не подлежащих восстановлению.</td>
  <td class=xl27></td>
  <td class=xl29></td>
  <td class=xl29></td>
  <td class=xl45 style='border-top:none'>Zeidan</td>
  <td class=xl41 width=151 style='border-top:none;width:113pt'>#($G(ZeidanMoney))#</td>
  <td></td>
 </tr>
 
 <tr height=21 style='height:15.75pt'>
  <td height=21 style='height:15.75pt'></td>
  <td colspan=2 class=xl49 ><!-- Ведущий специалист --></td>
  <td colspan=3 class=xl50><!-- #($G(Manager))# --></td>
  <td class=xl46 style='border-top:none'>Scarlett</td>
  <td class=xl42 width=151 style='border-top:none;width:113pt'>#($G(ScarlettMoney))#</td>
  <td></td>
 </tr>
 
 
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr class=xl27 height=20 style='height:15.0pt'>
  <td height=20 class=xl33 style='height:15.0pt'>№ п/п</td>
  <td class=xl33 style='border-left:none'>Наименование</td>
  <td class=xl33 style='border-left:none'>Модель</td>
  <td class=xl33 style='border-left:none'>№ модели</td>
  <td class=xl33 style='border-left:none'>Кол-во</td>
  <td class=xl33 style='border-left:none'>Цена</td>
  <td class=xl34 width=120 style='border-left:none;width:90pt'>Рекомендации</td>
  <td class=xl34 width=151 style='border-left:none;width:113pt'><span
  style='mso-spacerun:yes'> </span>Примечания</td>
  <td class=xl27></td>
 </tr>
<script language="cache" runat="server">
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . w @glob@(i)
</script>
 <tr class=xl27 height=80 style='mso-height-source:userset;height:60.0pt'>
  <td height=80 class=xl47 style='height:60.0pt'></td>
  <td colspan=7 class=xl51 width=845 style='width:635pt'><span
  style='mso-spacerun:yes'> </span></td>
  <td class=xl27></td>
 </tr>
 <tr height=61 style='mso-height-source:userset;height:45.75pt'>
  <td height=61 style='height:45.75pt'></td>
  <td class=xl24 colspan=8 style='mso-ignore:colspan'>Начальник сервисного
  отдела ______________________<span style='mso-spacerun:yes'>  </span>#($G(ManName))#</td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 style='height:15.0pt'></td>
  <td class=xl24>Дата списания:</td>
  <td class=xl31><span style='mso-spacerun:yes'> </span></td>
  <td class=xl28><span style='mso-spacerun:yes'> </span></td>
  <td class=xl32><span style='mso-spacerun:yes'> </span></td>
  <td class=xl32></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=21 style='mso-height-source:userset;height:15.75pt'>
  <td height=21 style='height:15.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=19 style='mso-height-source:userset;height:14.25pt'>
  <td height=19 style='height:14.25pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=22 style='mso-height-source:userset;height:16.5pt'>
  <td height=22 style='height:16.5pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=103 style='mso-height-source:userset;height:77.25pt'>
  <td height=103 style='height:77.25pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=65 style='mso-height-source:userset;height:48.75pt'>
  <td height=65 style='height:48.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 style='height:12.75pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <tr height=34 style='mso-height-source:userset;height:25.5pt'>
  <td height=34 style='height:25.5pt'></td>
  <td class=xl25></td>
  <td class=xl29></td>
  <td class=xl27></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td></td>
  <td class=xl39></td>
  <td></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=47 style='width:35pt'></td>
  <td width=194 style='width:146pt'></td>
  <td width=61 style='width:46pt'></td>
  <td width=82 style='width:62pt'></td>
  <td width=62 style='width:47pt'></td>
  <td width=175 style='width:131pt'></td>
  <td width=120 style='width:90pt'></td>
  <td width=151 style='width:113pt'></td>
  <td width=167 style='width:125pt'></td>
 </tr>
 <![endif]>
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/ActSverki.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script runat="server" language="cache" method="OnPreHTTP" returnType="%Boolean" >
	s %response.ServerSideRedirect="Reports.ActSverki.cls"
	Q 1
</script>]]></CSP>


<CSP name="screen/actutil.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Utiliz).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s numb=obj.Name
 . s Komissia=obj.Komissia
 . d:$ISOBJECT(obj.Kontr)
 . . s serv=obj.Kontr.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=mn(+$P($ZD(obj.Dat,4),"/",2))
 . s year=$P($ZD(obj.Dat,4),"/",3)
 s docname=##class(Docs.Action).GetDocNameFromClass("Docs.Utiliz")
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">
<head>
<title>#(docname)#</title>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>.</o:Author>
  <o:LastAuthor>Полиграф</o:LastAuthor>
  <o:LastPrinted>2006-06-01T21:14:55Z</o:LastPrinted>
  <o:Created>2006-03-14T12:33:11Z</o:Created>
  <o:LastSaved>2006-06-01T21:21:35Z</o:LastSaved>
  <o:Company>.</o:Company>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:DownloadComponents/>
  <o:LocationOfComponents HRef="file:D:\msowc.cab"/>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<style>
<!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
@page
	{margin:.98in .79in .98in .79in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
.style0
	{mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	white-space:nowrap;
	mso-rotate:0;
	mso-background-source:auto;
	mso-pattern:auto;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	border:none;
	mso-protection:locked visible;
	mso-style-name:Обычный;
	mso-style-id:0;}
td
	{mso-style-parent:style0;
	padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
.xl24
	{mso-style-parent:style0;
	background:white;
	mso-pattern:auto none;}
.xl25
	{mso-style-parent:style0;
	font-size:8.0pt;
	font-family:"Arial CYR", sans-serif;
	mso-font-charset:204;
	text-align:center;
	background:white;
	mso-pattern:auto none;}
.xl26
	{mso-style-parent:style0;
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl27
	{mso-style-parent:style0;
	mso-number-format:"\@";
	text-align:left;}
.xl28
	{mso-style-parent:style0;
	mso-number-format:"\@";
	text-align:left;
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl29
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;}
.xl30
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl31
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl32
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl33
	{mso-style-parent:style0;
	color:blue;
	font-weight:700;
	font-family:"Courier New", monospace;
	mso-font-charset:0;}
.xl34
	{mso-style-parent:style0;
	color:blue;
	font-weight:700;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl35
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:0;}
.xl36
	{mso-style-parent:style0;
	font-weight:700;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl37
	{mso-style-parent:style0;
	color:blue;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;}
.xl38
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:left;}
.xl39
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;}
.xl40
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	white-space:normal;}
.xl41
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	border:.5pt solid windowtext;}
.xl42
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"d\0022 \0022mmmm\\\,\0022 \0022yyyy";
	text-align:left;
	border:.5pt solid windowtext;}
.xl43
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	border:.5pt solid windowtext;}
.xl44
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:left;
	border:.5pt solid windowtext;}
.xl45
	{mso-style-parent:style0;
	mso-number-format:"\@";
	border:.5pt solid windowtext;}
.xl46
	{mso-style-parent:style0;
	border:.5pt solid windowtext;}
.xl47
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:left;}
.xl48
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\#\0022 \0022\#\#0\.00\0022 \0022";}
.xl49
	{mso-style-parent:style0;
	mso-number-format:"\#\0022 \0022\#\#0\.00\0022 \0022";}
.xl50
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:none;
	border-left:none;}
.xl51
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:right;}
.xl52
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:left;
	vertical-align:top;}
.xl53
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:top;}
.xl54
	{mso-style-parent:style0;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	white-space:normal;}
.xl55
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;}
.xl56
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-weight:700;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:left;}
.xl57
	{mso-style-parent:style0;
	mso-number-format:"d\0022 \0022mmmm\\\,\0022 \0022yyyy";
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl58
	{mso-style-parent:style0;
	mso-number-format:"\@";
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl59
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;}
.xl60
	{mso-style-parent:style0;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl61
	{mso-style-parent:style0;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl62
	{mso-style-parent:style0;
	text-align:center;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:none;
	border-left:none;}
.xl63
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:justify;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;}
.xl64
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:justify;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl65
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:center;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;}
.xl66
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:center;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl67
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;
	white-space:normal;}
.xl68
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	white-space:normal;}
.xl69
	{mso-style-parent:style0;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\#\0022 \0022\#\#0\.00\0022 \0022";
	border:.5pt solid windowtext;}
-->
</style>
<!--[if gte mso 9]><xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
    <x:Name>Лист1</x:Name>
    <x:WorksheetOptions>
     <x:Print>
      <x:ValidPrinterInfo/>
      <x:PaperSizeIndex>9</x:PaperSizeIndex>
      <x:HorizontalResolution>600</x:HorizontalResolution>
      <x:VerticalResolution>600</x:VerticalResolution>
     </x:Print>
     <x:Selected/>
     <x:TopRowVisible>10</x:TopRowVisible>
     <x:Panes>
      <x:Pane>
       <x:Number>3</x:Number>
       <x:ActiveRow>30</x:ActiveRow>
       <x:ActiveCol>7</x:ActiveCol>
      </x:Pane>
     </x:Panes>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
    <x:PublishObjects>
     <x:PublishObject>
      <x:Id>32034</x:Id>
      <x:DivID>7 Акт утил_32034</x:DivID>
      <x:SourceType>SourceSheet</x:SourceType>
      <x:HtmlType>HtmlStatic</x:HtmlType>
      <x:Location HRef="C:\CacheSys\CSP\Sklad\screen\actutil.htm"/>
     </x:PublishObject>
    </x:PublishObjects>
   </x:ExcelWorksheet>
   <x:ExcelWorksheet>
    <x:Name>Лист2</x:Name>
    <x:WorksheetOptions>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
   <x:ExcelWorksheet>
    <x:Name>Лист3</x:Name>
    <x:WorksheetOptions>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
  <x:WindowHeight>8835</x:WindowHeight>
  <x:WindowWidth>15180</x:WindowWidth>
  <x:WindowTopX>120</x:WindowTopX>
  <x:WindowTopY>120</x:WindowTopY>
  <x:RefModeR1C1/>
  <x:ProtectStructure>False</x:ProtectStructure>
  <x:ProtectWindows>False</x:ProtectWindows>
 </x:ExcelWorkbook>
</xml><![endif]-->
</head>

<body link=blue vlink=purple>

<table x:str border=0 cellpadding=0 cellspacing=0 width=605 style='border-collapse:
 collapse;table-layout:fixed;width:454pt'>
 <col width=64 span=8 style='mso-width-source:userset;mso-width-alt:2340;
 width:48pt'>
 <col width=93 style='mso-width-source:userset;mso-width-alt:3401;width:70pt'>
 <tr height=17 style='height:12.75pt'>
  <td height=17 width=64 style='height:12.75pt;width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=93 style='width:70pt'></td>
 </tr>
 <tr height=21 style='height:15.75pt'>
  <td height=21 style='height:15.75pt'></td>
  <td colspan=7 class=xl56>Акт об утилизации Неремонтопригодной Продукции</td>
  <td class=xl26>№ #($G(numb))#</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=9 style='height:12.75pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td colspan=2 height=17 style='height:12.75pt'>Дата выписки</td>
  <td colspan=2 class=xl57>«#($g(day))#» #($G(month))# #($g(year))# г.</td>
  <td></td>
  <td colspan=2>Сервисный Центр</td>
  <td colspan=2 class=xl58>#($g(serv))#</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=9 style='height:12.75pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=2 style='height:12.75pt;mso-ignore:colspan'>Комиссия, в
  составе</td>
  <td class=xl28 colspan=7>#($g(Komissia))#</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td colspan=9 height=17 class=xl61 style='height:12.75pt'>&nbsp;</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=8 style='height:12.75pt;mso-ignore:colspan'>(в том
  числе и главный бухгалтер) осмотрела изделия принятые за период</td>
  <td></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 class=xl29 style='height:15.0pt'>с</td>
  <td class=xl30>&nbsp;</td>
  <td class=xl29>200_ г.</td>
  <td class=xl29>по</td>
  <td class=xl30>&nbsp;</td>
  <td class=xl31>200_ г.,</td>
  <td></td>
  <td class=xl32></td>
  <td class=xl31></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 colspan=9 style='height:13.5pt;mso-ignore:colspan'>оставленными
  Клиентами в Сервисном Центре на ответственное хранение, и признала их</td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl31 colspan=6 style='height:13.5pt;mso-ignore:colspan'>пришедшими
  в негодность и подлежащими утилизации.</td>
  <td colspan=3 class=xl36 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=3 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl37 style='mso-ignore:colspan'></td>
  <td colspan=4 class=xl31 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl31 colspan=2 style='height:12.75pt;mso-ignore:colspan'>Список
  изделий</td>
  <td class=xl38></td>
  <td colspan=3 class=xl31 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl38 style='mso-ignore:colspan'></td>
  <td class=xl31></td>
 </tr>
 <tr height=68 style='height:51.0pt'>
  <td height=68 class=xl39 style='height:51.0pt'>№</td>
  <td colspan=2 class=xl63 style='border-right:.5pt solid black;border-left:
  none'>Модель изделия, заводской номер</td>
  <td class=xl40 width=64 style='border-left:none;width:48pt'>Количество
  изделий, шт.</td>
  <td colspan=2 class=xl40 width=128 style='border-left:none;width:96pt'>Наименование
  Клиента</td>
  <td colspan=2 class=xl67 width=128 style='border-right:.5pt solid black;
  border-left:none;width:96pt'>Место на складе</td>
  <td class=xl54 width=93 style='border-left:none;width:70pt'>№ и дата выписки
  Акта</td>
 </tr>
 <script language="cache" runat="server">
 d:$ISOBJECT(obj.Items)
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . s goodsdir=obj.Items.GetAt(i).goodsdir
 . . s Quantity=obj.Items.GetAt(i).Quantity
 . . s spravka=obj.Items.GetAt(i).spravka
 . . s Client=obj.Items.GetAt(i).Client
 . . if $ISOBJECT(Client) s Client=Client.Name
 . . s addr=obj.Items.GetAt(i).addr
 . . d:$ISOBJECT(addr) 
 . . . s addr=addr.%Id()
 . . . s addr=##class(Store.Action).AddressPath(addr)
 . . s sn=obj.Items.GetAt(i).sn
 . . d:$ISOBJECT(obj.Items.GetAt(i).Goods) 
 . . . s z4=obj.Items.GetAt(i).Goods.FullName
 . . d:goodsdir=1 
 . . . i $i(count)
 . . . w "<tr>"
 . . . w "<td class=x141 style='border:.5pt solid black'>"_count_"</td>"
 . . . w "<td colspan=2 class=x159  style='border:.5pt solid black'>"_$g(z4)_", "_sn_"</td>"
 . . . w "<td class=xl42 style='border-left:none'>"_Quantity_"</td>"
 . . . w "<td colspan=2 class=xl59 style='border-right:.5pt solid black;border-left:none'>"_Client_"</td>"
 . . . w "<td colspan=2 class=xl65 style='border-left:none'>"_addr_"</td>"
 . . . w "<td class=xl46>"_spravka_"</td>"
 . . . w "</tr>"
</script>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl31 colspan=9 style='height:12.75pt;mso-ignore:colspan'>Вышеперечисленные
  изделия не могут быть восстановлены ремонтом и подлежат утилизации.</td>
 </tr>
  <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=9 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
 </tr>

 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl31 colspan=9 style='height:12.75pt;mso-ignore:colspan'>Из
  перечисленных в Акте изделий получены Запасные Части, которые подлежат учету:</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl39 style='height:12.75pt'>№</td>
  <td colspan=2 class=xl55 style='border-left:none'>Наименование</td>
  <td colspan=2 class=xl55 style='border-left:none'>Количество, шт.</td>
  <td colspan=2 class=xl55 style='border-left:none'>Код ЗЧ</td>
  <td colspan=2 class=xl55 style='border-left:none'>Оприходовать на</td>
 </tr>
 <script language="cache" runat="server">
 s count=0
 d:$ISOBJECT(obj.Items)
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . s goodsdir=obj.Items.GetAt(i).goodsdir
 . . s Quantity=obj.Items.GetAt(i).Quantity
 . . s spravka=obj.Items.GetAt(i).spravka
 . . s Client=obj.Items.GetAt(i).Client
 . . s addr=obj.Items.GetAt(i).addr
 . . d:$ISOBJECT(addr) 
 . . . s addr=addr.%Id()
 . . . s addr=##class(Store.Action).AddressPath(addr)
 . . d:$ISOBJECT(obj.Items.GetAt(i).Goods) 
 . . . s z4=obj.Items.GetAt(i).Goods.Name
 . . . i $ISOBJECT(obj.Items.GetAt(i).Goods.izdelie) s z4tov=obj.Items.GetAt(i).Goods.izdelie.Name
 . . . e  s z4tov=""
 . . i Client'="" s src=Client
 . . e  s src=addr
 . . d:goodsdir=2 
 . . . i $i(count)
 . . . w "<tr>"
 . . . w "<td class=x141 style='border:.5pt solid black'>"_count_"</td>"
 . . . w "<td colspan=2 class=x141  style='border:.5pt solid black'>"_z4tov_" "_z4_"</td>"
 . . . w "<td colspan=2 class=xl41 style='border-left:none'>"_Quantity_"</td>"
 . . . w "<td colspan=2 class=xl41 style='border-right:.5pt solid black;border-left:none'>"_Client_"</td>"
 . . . w "<td colspan=2 class=xl41 style='border-left:none'>"_src_"</td>"
 . . . w "</tr>"
</script>
 <!--
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl41 style='height:12.75pt'>&nbsp;</td>
  <td colspan=2 class=xl41 style='border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl41 style='border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl41 style='border-left:none'>&nbsp;</td>
  <td class=xl41 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl31></td>
 </tr>
 -->
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=7 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl49 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=4 style='height:12.75pt;mso-ignore:colspan'>Утиль, не
  подлежащий учету, уничтожен.</td>
  <td colspan=3 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl49 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=7 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl49 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl31 colspan=2 style='height:12.75pt;mso-ignore:colspan'>Председатель</td>
  <td colspan=5 class=xl31 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl48 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl31 style='height:12.75pt'>комиссии</td>
  <td colspan=6 class=xl31 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl48 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=2 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl50>(должность)</td>
  <td></td>
  <td class=xl50>(подпись)</td>
  <td class=xl31></td>
  <td colspan=2 class=xl50>(Ф.И.О.)</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=4 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
  <td></td>
  <td class=xl51></td>
  <td colspan=2 class=xl31 style='mso-ignore:colspan'></td>
  <td class=xl48></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl52 colspan=2 style='height:12.75pt;mso-ignore:colspan'>Члены
  комиссии</td>
  <td colspan=6 style='mso-ignore:colspan'></td>
  <td class=xl53></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=2 class=xl53 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl50>(должность)</td>
  <td></td>
  <td class=xl50>(подпись)</td>
  <td class=xl31></td>
  <td colspan=2 class=xl50>(Ф.И.О.)</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=4 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
  <td></td>
  <td colspan=4 class=xl53 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=4 class=xl31 style='height:12.75pt;mso-ignore:colspan'></td>
  <td></td>
  <td colspan=2 class=xl31 style='mso-ignore:colspan'></td>
  <td class=xl51></td>
  <td class=xl48></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 colspan=2 class=xl29 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl50>(должность)</td>
  <td></td>
  <td class=xl50>(подпись)</td>
  <td class=xl31></td>
  <td colspan=2 class=xl50>(Ф.И.О.)</td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl29 style='height:12.75pt'>МП</td>
  <td colspan=5 class=xl31 style='mso-ignore:colspan'></td>
  <td colspan=3 class=xl53 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl24 style='height:12.75pt'>&nbsp;</td>
  <td class=xl25>&nbsp;</td>
  <td colspan=7 class=xl24 style='mso-ignore:colspan'>&nbsp;</td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=64 style='width:48pt'></td>
  <td width=93 style='width:70pt'></td>
 </tr>
 <![endif]>
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/Brakremont.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s DocObj=##class(Docs.Brakremont).%OpenId(id)
 if $ISOBJECT(DocObj) do
 . s Name=DocObj.Name
 . s Dat=$ZD(DocObj.Dat,4)_" "_$ZT(DocObj.Tim)
 . s:DocObj.CloseDate CloseDat=$ZD(DocObj.CloseDate,4)_" "_$ZT(DocObj.CloseTime)
 . s:$ISOBJECT(DocObj.CloseUser) CloseUser=DocObj.CloseUser.Name
 . s:$ISOBJECT(DocObj.User1) User1=DocObj.User1.Name
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="invent.files/filelist.xml">
<title>Передача брака в ремонт № #(Name)#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Арт</o:Author>
  <o:LastAuthor>Арт</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>26</o:TotalTime>
  <o:Created>2008-02-21T19:41:00Z</o:Created>
  <o:LastSaved>2008-02-21T19:41:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>18</o:Words>
  <o:Characters>104</o:Characters>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>121</o:CharactersWithSpaces>
  <o:Version>10.6714</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Передача брака в ремонт</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:Arial;mso-ansi-language:
EN-US'> </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'>№ </span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#(Name)#</span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Дата создания:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(Dat))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:0'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Дата закрытия:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(CloseDat))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Оператор создавший:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(User1))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Оператор закрывший:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(CloseUser))#</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0'>
  <td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Ячейка</span></p>
  </td>
  <td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Товар</span></p>
  </td>
  <td width=110 valign=top style='width:82.3pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Количество</span></p>
  </td>
 </tr>
 <script language="cache" runat="server">
 d:$ISOBJECT(DocObj.Items)
 . s i="" f  s i=DocObj.Items.Next(i) q:i=""  d
 . . s item=DocObj.Items.GetAt(i)
 . . s AddrId=$S($ISOBJECT(item.addr):item.addr.%Id(),1:"")
 . . if AddrId s Addr=##class(Store.Action).AddressPath(AddrId)
 . . else  s Addr=""
 . . s Goods=item.Goods.FullName
 . . s Qnt=item.Quantity
 . . w "<tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>"
 . . w "<td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Addr_"</span></p></td>"
 . . w "<td width=274 valign=top style='width:205.2pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Goods_"</span></p></td>"
 . . w "<td width=110 valign=top style='width:82.3pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Qnt_"</span></p></td>"
 . . w "</tr>"
 </script>
</table>
<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>
<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>
<table width=100%><tr>
	<td width=50%><font size=5>Сдал _____________</font>
	<td width=50%><font size=5>Принял _____________</font>
</table>
</div>

</body>

</html>
]]></CSP>


<CSP name="screen/chet.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
/* СТРАНИЦА УСТАРЕЛА
*
*  ВМЕСТО НЕЕ ИСПОЛЬЗУЕТСЯ КЛАСС csp.screen.chet2
*
*/

if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s docid=%request.Get("id")
 s DocDate=%request.Get("DocDate")
 s docname="Платежное поручение"
 s NDSinside=%request.Get("NDSinside")
 s CalculateInRubles=%request.Get("CalculateInRubles")
 

 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 . s kurs=doc.kurs
 . if '+kurs s kurs=doc.RubSumma/doc.Summa
 

 // Поставщик и Получатель
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s ppname=k.Name
 . s ppadress=k.Address
 . s bank=k.bank
 . d:$ISOBJECT(bank)
 . . s ppbankname=bank.pbank
 . . s ppbankcity=bank.city
 . . s ppkpp=bank.kpp
 . . s ppinn=bank.inn
 . . s ppbik=bank.bik
 . . s pprsch=bank.rsch
 . . s ppksch=bank.ksch
 . . s ppcode=bank.code
 . . s ppokpo=bank.okpo

 // Заказчик и плательщик
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s zpname=k.Name
 . s zpadress=k.Address
 . s bank=k.bank
 . d:$ISOBJECT(bank)
 . . s zpbankname=bank.pbank
 . . s zpbankcity=bank.city
 . . s zpkpp=bank.kpp
 . . s zpinn=bank.inn
 . . s zpbik=bank.bik
 . . s zprsch=bank.rsch
 . . s zpksch=bank.ksch
 . . s zpcode=bank.code
 . . s zpokpo=bank.okpo
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 
 //если указали не пересчитывать в рубли, то курс - единица, то есть оставляем те цифры, которые в документе
 if CalculateInRubles="false" s kurs=1
 
 
 s nds=+$G(other("nds"))/100
 
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 
 i NDSinside="true" s NdsDescription="НДС включен в цену товара"
 i NDSinside="false" s NdsDescription="НДС не включен в цену товара"
</script>

<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
        <meta http-equiv="Content-Language" content="ru">
        <style>
            .xlsFont { font-family: Arial; font-size: 9pt }
            td { font-family: Arial; font-size: 9pt }
        </style>
    <title>Счёт #($G(docname))#</title>
    </head>
    
    <body>
    <p class="xlsFont">
        <b>ПОСТАВЩИК #($G(ppname))#<br />
        Адрес: #($G(ppadress))# 
    </b>    
    </p>
    <p style="margin: 40px">
    <table><tr><td>
    <p align="center" style="margin: 2px"><b>Образец заполнения платежного поручения</b></p>
    <table cellpadding="2" cellspacing="0" border="1" style="border-collapse: collapse" bordercolor="#000000">
        <tr>
            <td style="border-bottom: 0px;"><b>Получатель:</b></td>
            <td style="border-bottom: 0px;" width="80">&nbsp;</td>
            <td style="border-bottom: 0px;">&nbsp;</td>
        </tr>
        <tr>
            <td style="border-top: 0px"><b>#($G(ppname))# ИНН #($G(ppinn))# КПП #($G(ppkpp))#</b></td>
            <td style="border-top: 0px"><b>Сч</b></td>
            <td style="border-top: 0px"><b>
            #($G(pprsch))#</b></td>
        </tr>
        <tr>
            <td style="border-bottom: 0px">
            <b>Банк получателя</b></td>
            <td><b><span lang="ru">БИК</span></b></td>
            <td style="border-bottom: 0px"><b>#($G(ppbik))#</b></td>
        </tr>
        <tr>
            <td style="border-top: 0px"><b>#($G(ppbankname))# #($G(ppbankcity))#</b><br /><br /></td>
            <td valign="top"><b><span lang="ru">Сч</span></b></td>
            <td valign="top" style="border-top: 0px"><b>#($G(ppksch))#</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </table>
    </td>
    </tr></table>
    </p>
    
    <p style="margin: 40px" class="xlsFont">
        <b>Счет No #($G(docname))# ОТ #($G(docdate))#.</b>
    </p>    

    <p class="xlsFont">
        <b>Заказчик: #($G(zpname))# АДРЕС: #($G(zpadress))#<br />
        Плательщик: #($G(zpname))# АДРЕС: #($G(zpadress))#<br /><br />  
        Договор N_______________от__________________<br /></b>  
    </p>    
        
    <table cellpadding="2" style="border-collapse: collapse" border="1" bordercolor="#000000">
        <tr>
            <td><b>N п/п</b></td>
            <td width="323"><b>Наименование</b></td>
            <td><b>Ед.изм</b></td>
            <td><b>Кол-во</b></td>
            <td><b>Цена</b></td>
            <td><b>Цена с НДС</b></td>
            <td><b>Сумма</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>(<span lang="ru">руб</span>)</b></td>
            <td><b>(<span lang="ru">руб</span>)</b></td>
            <td><b>(<span lang="ru">руб</span>)</b></td>
        </tr>

 <script language="cache" runat="server">
 s (summaotnds,summabeznds,price,NdsDescription)=""
 d:$ISOBJECT(doc.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . s quant=item.Quantity
 . . Q:quant=0  //ПРОПУСКАЕМ строки с нулевым количеством
 . . i $I(count)
 . . s itempr=item.Price
 . . if NDSinside="false" d  //если НДС НЕ включён в цену товара
 . . . s price=$J(kurs*itempr,".",2)
 . . . s summabeznds=$J(price*quant,".",2)
 . . . s summaotnds=$J(summabeznds-(summabeznds*antinds),".",2)
 . . . s pricends=summaotnds+summabeznds
 . . if NDSinside="true" d                    //если НДС включён в цену товара
 . . . s price=$J(kurs*itempr*antinds,".",2)
 . . . s summabeznds=$J(price*quant,".",2)
 . . . s summaotnds=$J(summabeznds*nds,".",2)
 . . . s pricends=summaotnds+summabeznds
 . . //s price=$J(kurs*itempr*antinds,".",2)
 . . //s pricends=$J(kurs*itempr,".",2)
 . . //s total=$J(item.Total*kurs,".",2) до 24 04 07
 . . s total=summaotnds+summabeznds
 . . s pricends=$J(total/quant,".",2)
 . . s tot=tot+total
 . . w "<tr>"
 . . w "<td>"_count_"</td>"
 . . w "<td style='mso-height-source:userset'>"_$G(goods)_"</td>"
 . . w "<td></td>"
 . . w "<td>"_quant_"</td>"
 . . w "<td>"_price_"</td>"
 . . w "<td>"_pricends_"</td>"
 . . w "<td>"_total_"</td>" 
 . . w "</tr>"
 s VsegoKOplate=tot
 i NDSinside="false" s ItogoBezNDS=$J(VsegoKOplate*antinds,".",2),ItogoNDS=VsegoKOplate-ItogoBezNDS
</script>
        <tr>
            <td colspan="6" align="right"><b>Итого без НДС:</b></td>
            <td><b>#($G(ItogoBezNDS))#</b></td>
        </tr>
        <tr>
            <td colspan="6" align="right"><b>Итого НДС:</b></td>
            <td><b>#($G(ItogoNDS))#</b></td>
        </tr>
        <tr>
            <td colspan="6" align="right"><b>Всего к оплате:</b></td>
            <td><b>#($G(VsegoKOplate))#</b></td>
        </tr>
    </table>
    
    <p>#(NdsDescription)#</p>
    <p class="xlsFont"><b>К оплате: 
            <script src="./screen/ru_convert_moneyvalue.js" language="javascript"></script>
            <script language="javascript">
                document.write("<b>"+ru_convert_moneyvalue("#(+$G(VsegoKOplate))#")+"</b>");
            </script>   
    
<script language="cache" runat="server">
    if +$G(ItogoNDS)
    {
        w "<br>В том числе НДС: "
        w "<script language=""javascript"">",!
        w "document.write('<b>'+ru_convert_moneyvalue('"_ItogoNDS_"')+'</b>');",!
        w "</"_"script>",!
    }

</script>
    </b></p>
    <p class="xlsFont" style="margin: 40px;"><b>
    Руководитель предприятия_____________________<br /><br />   
    Главный бухгалтер____________________________
    </b>
    </p>    
    </body>
</html>]]></CSP>


<CSP name="screen/ChiefInstr.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s InstrId=%request.Get("docid")
 i InstrId d
 . s InstrObj=##class(Operation.Instructions).%OpenId(InstrId)
 . q:'$ISOBJECT(InstrObj)
 . s Name=InstrObj.Name
 . if $ISOBJECT(InstrObj.Kontr) s Kontr=InstrObj.Kontr.Name
 . s State=InstrObj.StateLogicalToDisplay(InstrObj.State)
 . s Oper=InstrObj.Oper.Name
 . s Comment=InstrObj.Comment
 . s BrakComment=InstrObj.BrakComment
 . s BrakCommentDat=InstrObj.BrakCommentDat
 . if BrakCommentDat?5N s BrakCommentDat=$ZD(BrakCommentDat,4)
 . s BrakCommentAnswer=InstrObj.BrakCommentAnswer
 . s BrakCommentAnswerDat=InstrObj.BrakCommentAnswerDat
 . if BrakCommentAnswerDat?5N s BrakCommentAnswerDat=$ZD(BrakCommentAnswerDat,4)
 . s BrakCommentAnswerUser=InstrObj.BrakCommentAnswerUser
 . if $ISOBJECT(BrakCommentAnswerUser) s BrakCommentAnswerUser=BrakCommentAnswerUser.Name
 . s PhotoFile=InstrObj.PhotoFile
 . if BrakComment'="" s Brak="Негативный отзыв клиента: "_BrakComment_" <i>"_BrakCommentDat_"</i>"
 . if BrakCommentAnswer'="" s Brak=$G(Brak)_"<br>Ответ сервис менеджера <b>"_BrakCommentAnswerUser_"</b> "_BrakCommentAnswer_" <i>"_BrakCommentAnswerDat_"</i>"
 . if PhotoFile'="" s Brak=$G(Brak)_" <a href=""..\ClientImages\"_$G(PhotoFile)_""" target=_blank>фотоприложение</a><br><br>"
 . s Creator=InstrObj.User1.Name_" "_$ZD(InstrObj.Dat,4)_" "_$ZT(InstrObj.Tim)
 . if InstrObj.Oper.%Id()=10 d
 . . s:$ISOBJECT(InstrObj.dostavka) dostavka=InstrObj.dostavka.Name
 . . s:$ISOBJECT(InstrObj.RashOplatType) RashOplatType=InstrObj.RashOplatType.Name
 . . s postnumber=InstrObj.postnumber
 . . s postdata=InstrObj.postdata
 . . if +postdata s postdata=$ZD(postdata,4)
 . . s Additional="Доставка: "_$G(dostavka)_" "_$G(RashOplatType)_" <i>"_postnumber_" "_$G(postdata)_"</i>"
 . if $ISOBJECT(InstrObj.innerinstr) s InnerInstrNumber=InstrObj.innerinstr.Name
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="ChiefInstr.files/filelist.xml">
<title>Инструкция руководителя #($G(Name))#;</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Art</o:Author>
  <o:LastAuthor>Art</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>10</o:TotalTime>
  <o:Created>2008-07-22T16:58:00Z</o:Created>
  <o:LastSaved>2008-07-22T16:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>23</o:Words>
  <o:Characters>132</o:Characters>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>154</o:CharactersWithSpaces>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>Инструкция руководителя </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:Arial;
mso-ansi-language:EN-US'>#($G(Name))#</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span style='font-family:Arial'>Контрагент<span
style='mso-tab-count:1'>   </span><span style='mso-tab-count:1'>            </span></span><span
class=SpellE><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(Kontr))#</span></span><span
style='font-family:Arial'></span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span style='font-family:Arial;'>Состояние<span
style='mso-tab-count:1'>    </span><span style='mso-tab-count:1'>            </span></span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(State))#</span><span
style='font-family:Arial'></span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span style='font-family:Arial'>Шаблон<span
style='mso-tab-count:1'>          </span><span style='mso-tab-count:1'>            </span></span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(Oper))#</span><span
style='font-family:Arial'></span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span style='font-family:Arial'>Комментарий</span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>           </span>#($G(Comment))#</span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span style='font-family:Arial'>Внутренняя инструкция</span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>           </span><a href="../PrintInnerFromChief.csp?super=#(InstrId)#" target="_blank">#($G(InnerInstrNumber))#</a></span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span style='font-family:Arial'>Создал</span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'><span
style='mso-tab-count:2'>                      </span>#($G(Creator))#</span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(Additional))#</span></p>

<p class=MsoNormal style="padding-top:5.4pt"><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(Brak))#</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=662
 style='width:496.15pt;border-collapse:collapse;border:none;mso-border-alt:
 solid windowtext .5pt;mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
 mso-border-insideh:.5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Товар</span></p>
  </td>
  <td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Гарантийный номер</span></p>
  </td>
  <td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Серийный номер</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Количество</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Цена</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Сумма</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Описание поломки</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Продавец</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Дата продажи</span></p>
  </td>
  <td width=113 valign=top style='width:3.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Комментарий</span></p>
  </td>
 </tr>
 <script language="cache" runat="server">
 d:$ISOBJECT(InstrObj.Items)
 . s i="" f  s i=InstrObj.Items.Next(i) q:i=""  d
 . . s item=InstrObj.Items.GetAt(i)
 . . if $ISOBJECT(item.Goods) s Goods=item.Goods.FullName
 . . else  s Goods=""
 . . s Price=item.Price
 . . s Quantity=item.Quantity
 . . s Total=item.Total
 . . s garant=item.garant
 . . s sn=item.sn
 . . s opispolomki=item.opispolomki
 . . s Seller=item.seller
 . . //s SellDate=$S(+item.SellDate:$ZD(item.SellDate,4),1:"")
 . . s SellDate=item.SellDate2
 . . if item.SellDate2?5N s SellDate=$ZD(item.SellDate2,4)
 . . s Comment=item.BrakComment
 . . w "<tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>"
 . . w "<td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Goods_"</o:p></span></p></td>"
 . . w "<td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_garant_"</o:p></span></p></td>"
 . . w "<td width=378 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_sn_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Quantity_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Price_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Total_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_opispolomki_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Seller_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_SellDate_"</o:p></span></p></td>"
 . . w "<td width=113 valign=top style='width:3.0cm;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'><o:p>"_Comment_"</o:p></span></p></td>"
 . . w "</tr>"
</script>
</table>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/ChiefPlanHtml.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<html>
<head>
<style id="th3-06_24542_Styles">
<!--table
	{mso-displayed-decimal-separator:"\.";
	mso-displayed-thousand-separator:" ";}
.xl1524542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2424542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2524542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial CYR", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2624542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2724542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2824542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2924542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3024542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3124542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3224542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3324542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3424542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
-->
</style>
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=848 style='border-collapse:
 collapse;table-layout:fixed;width:636pt'>
 <col class=xl2824542 width=64 style='width:48pt'>
 <col width=255 style='mso-width-source:userset;mso-width-alt:9325;width:191pt'>
 <col width=161 style='mso-width-source:userset;mso-width-alt:5888;width:121pt'>
 <col class=xl2824542 width=112 style='mso-width-source:userset;mso-width-alt:
 4096;width:84pt'>
 <col width=64 span=4 style='width:48pt'>
 <script language="cache" runat="server">
 n tempGlob,docid,docobj,DocLanguage,i,Quantity,DocString,count,abbr,digits,Name,TovarName,
 EnglishTovarName,o
 s docid=%request.Get("docid")
 s:docid ok=##class(Reports.ShowTables).MakeGlobForCheifPlan(docid,.tempGlob)
 s i="" f  s i=$O(@tempGlob@(i)) q:i=""  d
 . s TovarName=@tempGlob@(i,"Name")
 . w "<tr height=24 style='height:18.0pt'><td></td></tr>"
 . w "<tr height=24 style='height:18.0pt'><td height=24 class=xl2824542 width=64 style='height:18.0pt;width:48pt'></td><td class=xl2424542 colspan=3 width=528 style='width:396pt'>Spare parts order for "_i_" "_TovarName_"</td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td></tr>"
 . w "<tr height=24 style='height:18.0pt'><td height=24 class=xl2924542 style='height:18.0pt'>No</td><td class=xl3024542 style='border-left:none'>PART NAME</td><td class=xl3024542 style='border-left:none'>№ pos.</td><td class=xl3024542 style='border-left:none'>QUANTITY</td><td class=xl2624542></td><td class=xl3424542></td><td class=xl2624542></td><td class=xl2624542></td></tr>"
 . s count=0
 . s o="" f  s o=$O(@tempGlob@(i,"Name",o)) q:o=""  d
 . . i $i(count)
 . . s Quantity=@tempGlob@(i,"Name",o,"Quantity")
 . . s Name=@tempGlob@(i,"Name",o,"Name")
 . . s SchemaNumber=@tempGlob@(i,"Name",o,"SchemaNumber")
 . . w "<tr height=20 style='height:15.0pt'>"
 . . w "<td height=20 class=xl3324542 style='height:15.0pt;border-top:none' x:num>"_count_"</td>"
 . . w "<td class=xl2724542 style='border-top:none;border-left:none'>"_Name_"</td>"
 . . w "<td class=xl3224542 style='border-top:none;border-left:none' x:num>"_SchemaNumber_"</td>"
 . . w "<td class=xl3224542 style='border-top:none;border-left:none' x:num>"_Quantity_"</td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "</tr>"
 k @tempGlob
</script>
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/ChiefPlanXml.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 set %response.ContentType = "text/xml"
 Quit 1</script><?xml version="1.0" encoding="windows-1251" ?><root><AllObjects><script language="cache" runat="server">
 s docid=%request.Get("docid")
 s ok=##class(Reports.ShowTables).MakeGlobForCheifPlan(docid,.tempGlob)
 i '+ok w "</AllObjects><comment>"_ok_"</comment></root>" q
 s i="" f  s i=$O(@tempGlob@(i)) q:i=""  d
 . s Code=i
 . s TovarName=$G(@tempGlob@(i,"Name"))
 . w "<OneObject>"
 . w "<Model>"
 . w "<Code>"_i_"</Code>"
 . w "<Name>"_TovarName_"</Name>"
 . w "</Model>"
 . w "<Parts>"
 . s o="" f  s o=$O(@tempGlob@(i,"Name",o)) q:o=""  d
 . . i $i(count)
 . . s Quantity=@tempGlob@(i,"Name",o,"Quantity")
 . . s Name=@tempGlob@(i,"Name",o,"Name")
 . . s SchemaNumber=@tempGlob@(i,"Name",o,"SchemaNumber")
 . . w "<Part>"
 . . w "<Number Text="""_count_""" />"
 . . w "<Name Text="""_Name_""" />"
 . . w "<Pos Text="""_SchemaNumber_""" />"
 . . w "<Quantity Text="""_Quantity_""" />"
 . . w "</Part>"
 . w "</Parts>"
 . w "</OneObject>"
 k @tempGlob
</script></AllObjects></root>]]></CSP>


<CSP name="screen/factura.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s docid=%request.Get("id")
 s cv1=%request.Get("cv1")
 s DocDate=%request.Get("DocDate")
 s NDSinside=%request.Get("NDSinside")
 
 s docname2="Счет-фактура"
 s docdate=$ZD(+$H,4)
 s docdate2=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 
 
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 . s kurs=doc.kurs
 . if '+kurs s kurs=doc.RubSumma/doc.Summa

 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s kname1=k.Name
 . s Address1=k.Address
 . s Address1Ur=k.AddressUr
 . s bank1=k.bank
 . s city1=k.City
 . s postalcode1=k.Postalcode
 . s city1Ur=k.CityUr
 . s postalcode1Ur=k.PostalcodeUr
 . d:$ISOBJECT(bank1)
 . . s kpp1=bank1.kpp
 . . s inn1=bank1.inn

 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s kname=k.Name
 . s Address=k.Address
 . s city=k.City
 . s bank=k.bank
 . s chief=k.chief
 . s buh=k.glavbuh
 . if chief="" s chief="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
 . if buh="" s buh="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
 . s postalcode=k.Postalcode
 . d:$ISOBJECT(bank)
 . . s kpp=bank.kpp
 . . s inn=bank.inn

 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 s antinsp=1/(1+nsp)
</script>

<html>
<head>
<style>
	td { font-family: Arial; font-size: 11px; }
	.norm { font-family: Arial; font-size: 12px; }
	.sml { font-family: Arial; font-size: 9px; }
</style>

<title>#(docname2)# #(docname)#</title>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">

</head>

<body>

<table cellspacing="0" width="100%">
	<tr>
		<td align="right" colspan="3">
<pre style="font-family=Arial" class="sml">
Приложение N 1
К правилам ведения журналов учета полученных и выставленных счетов-фактур
книг покупок и книг продаж при расчетах по налог на добавленную стоимость,
утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000г. N914 
(в редакции постановления Правительства Российской Федерации от 15.03.2001г. N189,
от 27.07.2002 N 575,от 16.02.2004 N 84,от 11.05.2006 N 283)</pre>
		</td>
	</tr>
	<tr>
		<td nowrap>
		<p style="margin-left: 100px; word-spacing:50px"><b><font size="3">
		Счет-фактура №<font color="#FFFFFF">_</font><u>#($G(docname))#</u> от <u style="word-spacing:5px">
		#($G(docdate))#</u></font></b></td>
		<td class="norm">(1)</td>
		<td class="norm" width="5%">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Продавец: #($G(kname))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(2)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Адрес: #(postalcode)# #($G(city))# #($G(Address))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(2a)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap >
				<p class="norm">ИНН/КПП продавца: #($G(inn))# / #($G(kpp))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(2б)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Грузоотправитель и его адрес: #($G(kname))#, #(postalcode)#, 
				#($G(city))# #($G(Address))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(3)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Грузополучатель и его адрес: #($G(kname1))#, 
				#(postalcode1)# #($G(city1))# #($G(Address1))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(4)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">к платежно расчетному документу № #($G(cv1))#
				<!--
				#($G(docname))# 
				от #($G(docdate))#
				-->
				</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(5)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Покупатель: #($G(kname1))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(6)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">Адрес: #(postalcode1Ur)# #($G(city1Ur))# #($G(Address1Ur))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(6а)</td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<table cellpadding="0" cellspacing="0" width="90%" bordercolor="#000000">
			<tr>
				<td width="0" nowrap>
				<p class="norm">ИНН/КПП покупателя: #($G(inn1))# / #($G(kpp1))#</td>
				<td style="border-bottom-style: solid; border-bottom-width: 1px" width="100%">
				&nbsp;</td>
			</tr>
		</table>
		</td>
		<td class="norm">(6б)</td>
		<td class="norm">&nbsp;</td>
	</tr>
</table>
<br>
<table style="border-collapse: collapse" border="1" bordercolor="#000000" width="100%">
	<tr>
		<td align="center" width="325">Наименование товара(описание выполненных 
		работ, оказанных услуг), имущественного права</td>
		<td align="center" width="58">Единица. измерения.</td>
		<td align="center" width="40">Кол-во</td>
		<td align="center" width="70">Цена (тариф) за единицу измерения.</td>
		<td align="center" width="154">Стоимость товаров(услуг)имущественных прав всего без налога</td>
		<td align="center" width="50">В т.ч. акциз</td>
		<td align="center" width="50">Налого-вая ставка</td>
		<td align="center" width="122">Сумма налога </td>
		<td align="center" width="138">Стоимость товаров (услуг, имущественных 
		прав, всего с учетом налога</td>
		<td align="center" width="80">Страна происхождения</td>
		<td align="center" width="121">Номер таможенной декларации</td>
	</tr>
	<tr>
		<td align="center" width="325">1</td>
		<td align="center">2</td>
		<td align="center">3</td>
		<td align="center">4</td>
		<td align="center">5</td>
		<td align="center">6</td>
		<td align="center">7</td>
		<td align="center">8</td>
		<td align="center">9</td>
		<td align="center">10</td>
		<td align="center" width="121">11</td>
	</tr>
	


<script language="cache" runat="server">
 s ndsPercent=+$G(other("nds"))
 s summpricevsegebeznal=""
 s summsummnalog=""
 s summpricewithnalog=""

 d:$ISOBJECT(doc.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . d:$ISOBJECT(item.Goods) 
 . . . s goods=item.Goods.FullName
 . . . s edizm=item.Goods.Property675
 . . s quant=item.Quantity
 . . s itempr=item.Price
 . . if NDSinside="false" d  //если НДС НЕ включён в цену товара
 . . . s price=$J(kurs*itempr,".",2)
 . . . s pricevsegebeznal=$J(quant*price,".",2)
 . . . s summnalog=$J(pricevsegebeznal-(pricevsegebeznal*antinds),".",2)
 . . e  d                    //если НДС включён в цену товара
 . . . s price=$J(kurs*itempr*antinds,".",2)
 . . . s pricevsegebeznal=$J(quant*price,".",2)
 . . . s summnalog=$J(pricevsegebeznal*nds,".",2)
 . . s pricewithnalog=pricevsegebeznal+summnalog
 . . s summpricevsegebeznal=$J(summpricevsegebeznal+pricevsegebeznal,".",2)
 . . s summsummnalog=summsummnalog+summnalog
  . .w "<tr>"
  . .w "<td align='left'>"_$G(goods)_"</td>"
  . .w "<td align='center'>"_$G(edizm)_"</td>"
  . .w "<td align='center'>"_$G(quant)_"</td>"
  . .w "<td align='right'>"_$G(price)_"</td>"
  . .w "<td align='right'>"_$G(pricevsegebeznal)_"</td>"
  . .w "<td>&nbsp;</td>"
  . .w "<td align='center'>"_$G(ndsPercent)_"%</td>"
  . .w "<td align='right'>"_$G(summnalog)_"</td>"
  . .w "<td align='right'>"_$G(pricewithnalog)_"</td>"
  . .w "<td align='center'>Россия</td>"
  . .w "<td align='center'></td>"
  . .w "</tr>"
  s summpricewithnalog=summpricevsegebeznal+summsummnalog
</script>
	
	<tr>
		<td width="324"><b>Всего к оплате</b></td>
		<td width="57">&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td align='right'><b>#(summpricevsegebeznal)#</b></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td align='right'><b>#(summsummnalog)#</b></td>
		<td align='right'><b>#(summpricewithnalog)#</b></td>
		<td>&nbsp;</td>
	</tr>
	
</table>

<br>
<table cellpadding="0" cellspacing="0" style="width:90%" id="table1">
	<tr>
		<td class="norm">
		<p align="right"><b><font face="Arial">Руководитель предприятия</font></b></td>
		<td align="center" class="norm"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</u></td>
		<td align="center" class="norm"><u><font face="Arial">/#($G(chief))#/</font></u></td>
		<td class="norm">&nbsp;</td>
		<td class="norm">
		<p align="right"><font face="Arial"><b>Главный бухгалтер</b> </font></td>
		<td align="center" class="norm"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</u></td>
		<td align="center" class="norm"><u><font face="Arial">/#($G(buh))#/</font></u></td>
		<td class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">&nbsp;</td>
		<td align="center" class="norm">
		<p align="center" class="sml"><font face="Arial"><span
  style="mso-spacerun:
  yes">&nbsp;</span>(подпись)</font></td>
		<td align="center" class="norm">
		<p align="center" class="sml"><font face="Arial">(ф.и.о.)</font></td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td align="center" class="sml">
		<p align="center"><font face="Arial"><span
  style="mso-spacerun:
  yes">&nbsp;</span>(подпись)</font></td>
		<td align="center" class="sml">
		<p align="center"><font face="Arial">(ф.и.о.)</font></td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">
		<p align="right"><b><font face="Arial">Индивидуальный предприниматель</font></b></td>
		<td align="center" class="norm"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</u></td>
		<td align="center" class="norm"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</u></td>
		<td class="norm">&nbsp;</td>
		<td colspan="3" class="norm">
		<p align="center"><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</u></td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td class="norm">&nbsp;</td>
		<td align="center" class="norm">
		<p align="center" class="sml"><font face="Arial"><span
  style="mso-spacerun:
  yes">&nbsp;</span>(подпись)</font></td>
		<td align="center" class="norm">
		<p align="center" class="sml"><font face="Arial">(ф.и.о.)</font></td>
		<td class="norm">&nbsp;</td>
		<td colspan="3" align="center" class="norm"><font face="Arial">
		(реквизиты свидетельства о государственной регистрации</font></td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td colspan="2" class="norm"><span
  style="mso-spacerun: yes"><font face="Arial">&nbsp;&nbsp; &nbsp;</font></span></td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td colspan="3" align="center" class="norm"><font face="Arial">
		индивидуального предпринимателя)</font></td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
	<tr>
		<td colspan="2" class="norm">
		<p align="right"><font face="Arial">Примечание. Первый 
		экземпляр-покупателю, второй экземпляр-продавцу</font></td>
		<td class="norm">&nbsp;</td>
		<td class="norm">&nbsp;</td>
		<td colspan="3" class="norm">&nbsp;</td>
		<td width="8" class="norm">&nbsp;</td>
	</tr>
</table>

  

<p>&nbsp;</p>

  

</body>

</html>]]></CSP>


<CSP name="screen/inner.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Inner).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s numb=obj.Name
 . s:$ISOBJECT(obj.User1) usr1=obj.User1.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=mn(+$P($ZD(obj.Dat,4),"/",2))
 . s year=$P($ZD(obj.Dat,4),"/",3)
 . s dat=day_" "_month_" "_year_" г."
 . s:obj.Tim'="" tim=$ZT(obj.Tim)
 . 
  s docname2=##class(Docs.Action).GetDocNameFromClass("Docs.Inner")

</script>

<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./Inner.files/filelist.xml">
<title>#(docname2)#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>artem</o:Author>
  <o:LastAuthor>artem</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>53</o:TotalTime>
  <o:Created>2006-06-18T08:21:00Z</o:Created>
  <o:LastSaved>2006-06-18T08:21:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Company> аава</o:Company>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DrawingGridHorizontalSpacing>2,85 пт</w:DrawingGridHorizontalSpacing>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
style='font-size:16.0pt;mso-bidi-font-size:12.0pt;mso-ansi-language:EN-US'>#($G(docname2))#<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=0 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr>
  <td width=144 valign=top style='width:108.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Номер</p>
  </td>
  <td width=513 valign=top style='width:384.7pt;border:none;border-bottom:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#($G(numb))#<o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Дата</p>
  </td>
  <td width=513 valign=top style='width:384.7pt;border:none;border-bottom:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#($G(dat))#<o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Время</p>
  </td>
  <td width=513 valign=top style='width:384.7pt;border:none;border-bottom:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#($G(tim))#<o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Должностное лицо</p>
  </td>
  <td width=513 valign=top style='width:384.7pt;border:none;border-bottom:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#($G(usr1))#<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<table border=1 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 border:none;mso-border-alt:solid windowtext .5pt;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr>
  <td width=186 valign=top style='width:139.55pt;border:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Товар</p>
  </td>
  <td width=186 valign=top style='width:139.55pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Текущее место</p>
  </td>
  <td width=186 valign=top style='width:139.55pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Место назначения</p>
  </td>
  <td width=99 valign=top style='width:74.05pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal>Количество</p>
  </td>
 </tr>
 <script language="cache" runat="server">
 d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 .. i $I(count)
 .. s item=obj.Items.GetAt(i)
 .. s:$ISOBJECT(item.addr) addr=##class(Store.Action).AddressPath(item.addr.%Id())
 .. s:$ISOBJECT(item.addr2) addr2=##class(Store.Action).AddressPath(item.addr2.%Id())
 .. s Quantity=item.Quantity
 .. s:$ISOBJECT(item.Goods) Goods=item.Goods.FullName
 .. w "<tr>"
  .. w "<td width=186 valign=top style='width:139.55pt;border:solid windowtext .5pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
  .. w "<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>"_$G(Goods)_"<o:p></o:p></span></p>"
  .. w "</td>"
  .. w "<td width=186 valign=top style='width:139.55pt;border-top:none;border-left:none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
  .. w "<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>"_$G(addr2)_"<o:p></o:p></span></p>"
  .. w "</td>"
  .. w "<td width=186 valign=top style='width:139.55pt;border-top:none;border-left:none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
  .. w "<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>"_$G(addr)_"<o:p></o:p></span></p>"
  .. w "</td>"
  .. w "<td width=99 valign=top style='width:74.05pt;border-top:none;border-left:none;border-bottom:solid windowtext .5pt;border-right:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
  .. w "<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>"_$G(Quantity)_"<o:p></o:p></span></p>"
  .. w "</td>"
 .. w "</tr>"
 </script>
</table>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/InnerDiff.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s class=%request.Get("class")
 
 s obj=$ZOBJCLASSMETHOD(class,"%OpenId",id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s numb=obj.Name
 . s dat=obj.Dat
 . s tim=obj.Tim
 . s:$ISOBJECT(obj.storeman) storeman=obj.storeman.Name
 . s:$ISOBJECT(obj.User1) user1=obj.User1.Name
 . s day=$P($ZD(dat,4),"/",1)
 . s month=$G(mn(+$P($ZD(dat,4),"/",2)))
 . s year=$P($ZD(dat,4),"/",3)
 . s dat=day_" "_month_" "_year_" г."
 . s tim=$ZT(obj.Tim)
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="InnerDiff.files/filelist.xml">
<title>Внутренний акт расхождения № #($G(numb))#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>NB-FUJ</o:Author>
  <o:LastAuthor>Артем</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>5</o:TotalTime>
  <o:Created>2007-04-28T17:18:00Z</o:Created>
  <o:LastSaved>2007-04-28T17:18:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>43</o:Words>
  <o:Characters>248</o:Characters>
  <o:Company>IBT</o:Company>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>290</o:CharactersWithSpaces>
  <o:Version>11.6360</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:16.0pt;font-family:Arial'>Внутренний акт расхождения № #($G(numb))#</span></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Дата<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(dat))# #($G(tim))#</span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Грузчик<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(storeman))#</span></b><b
  style='mso-bidi-font-weight:normal'><span style='font-family:Arial'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Выписал<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(user1))#</span></b><b
  style='mso-bidi-font-weight:normal'><span style='font-family:Arial'><o:p></o:p></span></b></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=36 valign=top style='width:27.15pt;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>№<o:p></o:p></span></p>
  <p class=MsoNormal><span class=GramE>п</span><span
  lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>/</span><span style='font-family:Arial'>п<o:p></o:p></span></p>
  </td>
  <td width=255 valign=top style='width:191.45pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Товар<o:p></o:p></span></p>
  </td>
  <td width=122 valign=top style='width:91.35pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Количество по документу<o:p></o:p></span></p>
  </td>
  <td width=122 valign=top style='width:91.35pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Количество фактическое<o:p></o:p></span></p>
  </td>
  <td width=122 valign=top style='width:91.4pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Расхождение количества<o:p></o:p></span></p>
  </td>
 </tr>
<script language="cache" runat="server">
 d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 .. s item=obj.Items.GetAt(i)
 .. i $i(number)
 .. s kol=item.quantdefault
 .. s kolfact=item.quantreal
 .. s diff=kol-kolfact
 .. s goods=$S($ISOBJECT(item.Goods):item.Goods.FullName,1:"")
 .. w !,"<tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>"
 .. w !,"<td width=36 valign=top style='width:27.15pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
 .. w !,"<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'><o:p>"_number_"</o:p></span></p>"
 .. w !,"</td>"
 .. w !,"<td width=255 valign=top style='width:191.45pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
 .. w !,"<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_$G(goods)_"<o:p></o:p></span></p>"
 .. w !,"</td>"
 .. w !,"<td width=122 valign=top style='width:91.35pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
 .. w !,"<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_$G(kol)_"<o:p></o:p></span></p>"
 .. w !,"</td>"
 .. w !,"<td width=122 valign=top style='width:91.35pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
 .. w !,"<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_$G(kolfact)_"<o:p></o:p></span></p>"
 .. w !,"</td>"
 .. w !,"<td width=122 valign=top style='width:91.4pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>"
 .. w !,"<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_$G(diff)_"<o:p></o:p></span></p>"
 .. w !,"</td>"
 .. w !,"</tr>"
</script>
</table>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'>Собрал _______________ </span><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(storeman))#</span><span style='font-family:Arial'><o:p></o:p></span></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/instrotbor.csp" application="/csp/sklad2/" default="1"><![CDATA[
<CSP:CLASS INCLUDES="xmlmacros">
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
s Start = $P($H,",",2)
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s class=%request.Get("class")
 s instr="Тип документа неизвестен"
 &sql(select Name into :instr from Docs.Docs where id=:class)
 s obj=$ZOBJCLASSMETHOD(class,"%OpenId",id)
 d:$ISOBJECT(obj)
 . if class="Docs.StorageOut" d
 . . if obj.Brak s Brak="<br>Некондиционные товары"
 . if obj.Images '= "" do
 . . for i=1:1:$L(obj.Images,"\") do
 . . . s:$P(obj.Images,"\",i)'="" ImagesString = $G(ImagesString)_"<a href=""SkladInstrImages/"_$P(obj.Images,"\",i)_""" target=_blank>***</a> "
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s numb=obj.Name
 . s dat=obj.Dat
 . s tim=obj.Tim
 . s:$ISOBJECT(obj.storeman) storeman=obj.storeman.Name
 . s:$ISOBJECT(obj.User1) user1=obj.User1.Name
 . s day=$P($ZD(dat,4),"/",1)
 . s month=$G(mn(+$P($ZD(dat,4),"/",2)))
 . s year=$P($ZD(dat,4),"/",3)
 . s dat=day_" "_month_" "_year_" г."
 . s tim=$ZT(obj.Tim)
 . d:$ISOBJECT(obj.Source)
 . . d:$ISOBJECT(obj.Source.Kontr)
 . . . s kontr=obj.Source.Kontr.Name	//это имя контрагента из расходной накладной
 . . if $ISOBJECT(obj.Source.Source) do
 . . . s ChiefInstrId = obj.Source.Source.%Id()
 . . . s ChiefInstrName = obj.Source.Source.Name
 . . . s ChiefInstrDat = $ZD(obj.Source.Source.Dat,4)
</script>

<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="instrotbor.files/filelist.xml">
<title>#($G(instr))# № #($G(numb))#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>NB-FUJ</o:Author>
  <o:LastAuthor>NB-FUJ</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>34</o:TotalTime>
  <o:Created>2006-07-15T08:05:00Z</o:Created>
  <o:LastSaved>2006-07-15T08:05:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>39</o:Words>
  <o:Characters>228</o:Characters>
  <o:Company>IBT</o:Company>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>266</o:CharactersWithSpaces>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
<script language="jscript" type="text/javascript">
 var dateObj = new Date();
 var StartDtString = dateObj.getHours() + ":" + dateObj.getMinutes() + ":" + dateObj.getSeconds() + "." + dateObj.getMilliseconds();
 
function loaded()
{
	//alert("Форма печати успешно завершена");
	var dateObj2 = new Date();
 	var StartDtString2 = dateObj2.getHours() + ":" + dateObj2.getMinutes() + ":" + dateObj2.getSeconds() + "." + dateObj2.getMilliseconds();
 
	StartEnd.innerHTML = "<u>Время начала отрисовки " + StartDtString + "</u> <u>Время окончания отрисовки" + StartDtString2 + "</u>";
}
</script>
</head>

<body lang=RU style='tab-interval:35.4pt' onload="loaded()">
<table height=100%>
<tr><td valign=top>
<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'>
<span style='font-size:16.0pt;font-family:Arial'>#($G(instr))# № #($G(numb))# #($G(Brak))#</span></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
  <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'><o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(kontr))#</span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Дата<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(dat))# #($G(tim))#</span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Грузчик<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(storeman))#</span></b><b
  style='mso-bidi-font-weight:normal'><span style='font-family:Arial'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Выписал<o:p></o:p></span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(user1))#</span></b><b
  style='mso-bidi-font-weight:normal'><span style='font-family:Arial'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td width=103 valign=top style='width:77.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Arial'>Номер заявки</span></p>
  </td>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><a href="screen/ChiefInstr.csp?docid=#($G(ChiefInstrId))#" target="_blank"><span lang=EN-US
  style='font-family:Arial;mso-ansi-language:EN-US'>#($G(ChiefInstrName))# от #($G(ChiefInstrDat))#</span></a></b><b
  style='mso-bidi-font-weight:normal'><span style='font-family:Arial'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <server>
 if $G(ImagesString)'=""
 {
	 w "<tr>"
	 w "<td colspan=2>"_ImagesString_"</td>"
	 w "</tr>",!
 }
 </server>
 
</table>

<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>


<script language="cache" runat="server">
 s glob=$NA(^mtempArt("print",$I))
 k @glob
 d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . s item=obj.Items.GetAt(i)
 . . i $ISOBJECT(item.addr) d
 . . . s addr=##class(Store.Action).AddressPath(item.addr.%Id())
 . . . d:$ISOBJECT(item.addr.Depot)
 . . . . s skl=item.addr.Depot.%Id()
 . . . . s sklname=item.addr.Depot.Name
 . . e  d
 . . . s skl="-"
 . . . s addr=""
 . . . s sklname=""
 . . s kol=item.quantdefault
 . . s kolfact=item.quantreal
 . . if $ISOBJECT(item.Goods) d
 . . . s tov=item.Goods.FullName
 . . . s itemGoods = item.Goods.%Id()
 . . e  s (itemGoods,tov)=""
 . . &sql(select Groups->Name into :GroupsName from Goods.GoodsGroup where Goods=:itemGoods)
 . . if SQLCODE s GroupsName=""
 . . s @glob@($G(skl))=$G(sklname)
 . . s @glob@($G(skl),i,"kol")=kol
 . . s @glob@($G(skl),i,"addr")=$G(addr)
 . . s @glob@($G(skl),i,"kolfact")=kolfact
 . . s @glob@($G(skl),i,"tov")=$G(tov)_" ("_GroupsName_")"
 . . s:class="Docs.StorageOut" @glob@($G(skl),i,"serial")=item.serial
 . . s:class="Docs.StorageOut" @glob@($G(skl),i,"comment")=item.comment
 
 s skl="" f  s skl=$O(@glob@(skl)) q:skl=""  d
 . w "<br><p class=MsoNormal><span style='font-family:Arial'><b>"_$G(@glob@(+$G(skl)))_"</b></span></p>"
 . w "<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:.5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>"
 . w "<tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>"
 . w "<td width=196 valign=top style='width:146.7pt;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Адрес ячейки<o:p></o:p></span></p></td>"
 . w "<td width=196 valign=top style='width:146.7pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Товар</span></p></td>"
 . w "<td width=133 valign=top style='width:99.65pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Количество по документу</span></p></td>"
 . w "<td width=133 valign=top style='width:99.65pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Количество фактическое</span></p></td>"
 . w:class="Docs.StorageOut" "<td width=133 valign=top style='width:99.65pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Серийный номер</span></p></td>"
 . w:class="Docs.StorageOut" "<td width=133 valign=top style='width:99.65pt;border:solid windowtext 1.0pt;border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span style='font-family:Arial'>Комментарий клиента</span></p></td>"
 . w "</tr>"
 . s i="" f  s i=$O(@glob@(skl,i)) q:i=""  d
 .. s kol=$G(@glob@($G(skl),i,"kol"))
 .. s addr=@glob@($G(skl),i,"addr")
 .. s kolfact=@glob@($G(skl),i,"kolfact")
 .. s tov=@glob@($G(skl),i,"tov")
 .. s serial=$G(@glob@($G(skl),i,"serial"))
 .. s comment=$G(@glob@($G(skl),i,"comment"))
 .. w "<tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>"
 .. w "<td width=196 valign=top style='width:146.7pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_skl_" "_addr_"<o:p></o:p></span></p></td>"
 .. w "<td width=196 valign=top style='width:146.7pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_tov_"</span></p></td>"
 .. w "<td width=133 valign=top style='width:99.65pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_kol_"</span></p></td>"
 .. w "<td width=133 valign=top style='width:99.65pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_kolfact_"</span></p></td>"
 .. w:class="Docs.StorageOut" "<td width=133 valign=top style='width:99.65pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_serial_"</span></p></td>"
 .. w:class="Docs.StorageOut" "<td width=133 valign=top style='width:99.65pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_comment_"</span></p></td>"
 .. w "</tr>"
 . w "</table>"
 . w "<br><p class=MsoNormal><span style='font-family:Arial'>Собрал _______________ </span></p>"
 k @glob
 </script>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<!--
<p class=MsoNormal><span style='font-family:Arial'>Собрал _______________ </span><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#($G(storeman))#</span><span style='font-family:Arial'><o:p></o:p></span></p>
-->

</div>
<tr><td valign=bottom align=right>
<script language="cache" runat="Server">
 s ClientTimeStart = %request.Get("TimeStart")
 s Finish = $P($H,",",2)
 if $$$TunesVariableGlobal("ShowCreationTimes")
 {
	 s StyleDisplay="block"
 }
 else
 {
	 s StyleDisplay="none"
 }
 
	 w "<font face=""Arial"" size=2 color=""Grey"" style=""display:"_StyleDisplay_""">"
	 w "<span><b>Сервер:</b> Сформировано (по часам сервера) "_$ZT(Finish)_" Время формирования страницы на сервере "_$ZT(Finish-Start)_"</span>"
	 w "<br><b>Клиент:</b> <u>Время старта "_ClientTimeStart_"</u> <span id=""StartEnd""></span>"
	 w "</font>"
 
</script>
</table>
</body>

</html>
]]></CSP>


<CSP name="screen/invent.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s DocObj=##class(Docs.Invent).%OpenId(id)
 if $ISOBJECT(DocObj) do
 . s Name=DocObj.Name
 . s Dat=$ZD(DocObj.Dat,4)_" "_$ZT(DocObj.Tim)
 . s:DocObj.CloseDate CloseDat=$ZD(DocObj.CloseDate,4)_" "_$ZT(DocObj.CloseTime)
 . s:$ISOBJECT(DocObj.CloseUser) CloseUser=DocObj.CloseUser.Name
 . s:$ISOBJECT(DocObj.User1) User1=DocObj.User1.Name
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="invent.files/filelist.xml">
<title>АКТ ИНВЕНТАРИЗАЦИИ № #(Name)#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Арт</o:Author>
  <o:LastAuthor>Арт</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>26</o:TotalTime>
  <o:Created>2008-02-21T19:41:00Z</o:Created>
  <o:LastSaved>2008-02-21T19:41:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>18</o:Words>
  <o:Characters>104</o:Characters>
  <o:Lines>1</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>121</o:CharactersWithSpaces>
  <o:Version>10.6714</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'>АКТ ИНВЕНТАРИЗАЦИИ</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:Arial;mso-ansi-language:
EN-US'> </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'>№ </span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>#(Name)#</span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Дата создания:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(Dat))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:0'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Дата закрытия:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(CloseDat))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Оператор создавший:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(User1))#</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=139 valign=top style='width:154.4pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-family:Arial'>Оператор закрывший:</span></b></p>
  </td>
  <td width=228 valign=top style='width:171.0pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
  EN-US'>#($G(CloseUser))#</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0'>
  <td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Ячейка</span></p>
  </td>
  <td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Товар</span></p>
  </td>
  <td width=110 valign=top style='width:82.3pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Количество</span></p>
  </td>
 </tr>
 <script language="cache" runat="server">
 d:$ISOBJECT(DocObj.Items)
 . s i="" f  s i=DocObj.Items.Next(i) q:i=""  d
 . . s item=DocObj.Items.GetAt(i)
 . . s AddrId=$S($ISOBJECT(item.addr):item.addr.%Id(),1:"")
 . . if AddrId s Addr=##class(Store.Action).AddressPath(AddrId)
 . . else  s Addr=""
 . . s Goods=item.Goods.FullName
 . . s Qnt=item.Quantity
 . . w "<tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>"
 . . w "<td width=274 valign=top style='width:205.2pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Addr_"</span></p></td>"
 . . w "<td width=274 valign=top style='width:205.2pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Goods_"</span></p></td>"
 . . w "<td width=110 valign=top style='width:82.3pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_Qnt_"</span></p></td>"
 . . w "</tr>"
 </script>
</table>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/OLDchet.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s docid=%request.Get("id")
 s DocDate=%request.Get("DocDate")
 s docname="Платежное поручение"
 
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 
 // Поставщик и Получатель
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s ppname=k.Name
 . s ppadress=k.Address
 . s bank=k.bank
 . d:$ISOBJECT(bank)
 . . s ppbankname=bank.pbank
 . . s ppbankcity=bank.city
 . . s ppkpp=bank.kpp
 . . s ppinn=bank.inn
 . . s ppbik=bank.bik
 . . s pprsch=bank.rsch
 . . s ppksch=bank.ksch
 . . s ppcode=bank.code
 . . s ppokpo=bank.okpo

 // Заказчик и плательщик
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s zpname=k.Name
 . s zpadress=k.Address
 . s bank=k.bank
 . d:$ISOBJECT(bank)
 . . s zpbankname=bank.pbank
 . . s zpbankcity=bank.city
 . . s zpkpp=bank.kpp
 . . s zpinn=bank.inn
 . . s zpbik=bank.bik
 . . s zprsch=bank.rsch
 . . s zpksch=bank.ksch
 . . s zpcode=bank.code
 . . s zpokpo=bank.okpo
 
 s kurs=##class(Goods.GoodsAction).kurs(.other)
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 
</script>

<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
		<meta http-equiv="Content-Language" content="ru">
		<style>
			.xlsFont { font-family: Arial; font-size: 9pt }
			td { font-family: Arial; font-size: 9pt }
		</style>
	<title>Счёт #($G(docname))#</title>
	</head>
	
	<body>
	<p class="xlsFont">
		<b>ПОСТАВЩИК #($G(ppname))#<br />
		Адрес: #($G(ppadress))#	
	</b>	
	</p>
	<p style="margin: 40px">
	<table><tr><td>
	<p align="center" style="margin: 2px"><b>Образец заполнения платежного поручения</b></p>
	<table cellpadding="2" cellspacing="0" border="1" style="border-collapse: collapse" bordercolor="#000000">
		<tr>
			<td style="border-bottom: 0px;"><b>Получатель:</b></td>
			<td style="border-bottom: 0px;" width="80">&nbsp;</td>
			<td style="border-bottom: 0px;">&nbsp;</td>
		</tr>
		<tr>
			<td style="border-top: 0px"><b>#($G(ppname))# ИНН #($G(ppinn))# КПП #($G(ppkpp))#</b></td>
			<td style="border-top: 0px"><b>Сч</b></td>
			<td style="border-top: 0px"><b>
			#($G(pprsch))#</b></td>
		</tr>
		<tr>
			<td style="border-bottom: 0px">
			<b>Банк получателя</b></td>
			<td><b><span lang="ru">БИК</span></b></td>
			<td style="border-bottom: 0px"><b>#($G(ppbik))#</b></td>
		</tr>
		<tr>
			<td style="border-top: 0px"><b>#($G(ppbankname))# #($G(ppbankcity))#</b><br /><br /></td>
			<td valign="top"><b><span lang="ru">Сч</span></b></td>
			<td valign="top" style="border-top: 0px"><b>#($G(ppksch))#</b></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
	</table>
	</td>
	</tr></table>
	</p>
	
	<p style="margin: 40px" class="xlsFont">
		<b>Счет No #($G(docname))# ОТ #($G(docdate))#.</b>
	</p>	

	<p class="xlsFont">
		<b>Заказчик: #($G(zpname))# АДРЕС: #($G(zpadress))#<br />
		Плательщик: #($G(zpname))# АДРЕС: #($G(zpadress))#<br /><br />	
		Договор N_______________от__________________<br /></b>	
	</p>	
		
	<table cellpadding="2" style="border-collapse: collapse" border="1" bordercolor="#000000">
		<tr>
			<td><b>N п/п</b></td>
			<td width="323"><b>Наименование</b></td>
			<td><b>Ед.изм</b></td>
			<td><b>Кол-во</b></td>
			<td><b>Цена</b></td>
			<td><b>Цена с НДС</b></td>
			<td><b>Сумма</b></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td></td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td><b>(<span lang="ru">руб</span>)</b></td>
			<td><b>(<span lang="ru">руб</span>)</b></td>
			<td><b>(<span lang="ru">руб</span>)</b></td>
		</tr>

 <script language="cache" runat="server">
 d:$ISOBJECT(doc.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.Property3609_" "_item.Goods.Name
 . . s quant=item.Quantity
 . . s itempr=item.Price
 . . s price=$J(kurs*itempr*antinds,".",2)
 . . s pricends=$J(kurs*itempr,".",2)
 . . s total=$J(item.Total*kurs,".",2)
 . . //s totquant=totquant+quant
 . . s tot=tot+total
 . . //s pricechanged=$J(price*kurs,".",2)
 . . w "	<tr>"
 . . w "		<td>"_count_"</td>"
 . . w "		<td style='mso-height-source:userset'>"_$G(goods)_"</td>"
 . . w "		<td></td>"
 . . w "		<td>"_quant_"</td>"
 . . w "		<td>"_price_"</td>"
 . . w "		<td>"_pricends_"</td>"
 . . w "		<td>"_total_"</td>" 
 . . w "	</tr>"
 
 s totnds=$J((tot-(tot*antinds)),".",2)
 s tot=$J(tot,".",2)
 s totantinsp=tot
 s totnsp=$J(tot*nsp,".",2)
 s totlast=$J(totantinsp+totnsp,".",2)
</script>
		<tr>
			<td colspan="6" align="right"><b>Итого без НДС:</b></td>
			<td><b>#(tot)#</b></td>
		</tr>
		<tr>
			<td colspan="6" align="right"><b>Итого НДС:</b></td>
			<td><b>#(totnds)#</b></td>
		</tr>
		<tr>
			<td colspan="6" align="right"><b>Всего к оплате:</b></td>
			<td><b>#(tot+totnds)#</b></td>
		</tr>
	</table>
	
		
	<p class="xlsFont"><b>К оплате: 
			<script src="./screen/ru_convert_moneyvalue.js" language="javascript"></script>
			<script language="javascript">
				document.write("<b>"+ru_convert_moneyvalue("#(tot+totnds)#")+"</b>");
			</script>	
	</b></p>
	<p class="xlsFont" style="margin: 40px;"><b>
	Руководитель предприятия_____________________<br /><br />	
	Главный бухгалтер____________________________
	</b>
	</p>	
	</body>
</html>]]></CSP>


<CSP name="screen/OstatkiExcel.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 d:%request.Get("excel")
 . set %response.ContentType = "application/x-msexcel"
 . do %response.SetHeader("Content-Disposition","attachment;excel.xls")
 . set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"

if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1

</script>
<csp:class includes="xmlmacros">

<script language="cache" runat="server">
 s GroupCode=%request.Get("GroupCode")
 s CatalogueID=%request.Get("CatalogueID")
 s GroupName=%request.Get("GroupName")
</script>

<html >

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">

<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<title>Прайс лист #($G(GroupName))#</title>

<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Arial CYR";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 233.85pt right 467.75pt;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 233.85pt right 467.75pt;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
	{mso-mirror-margins:yes;
	mso-footnote-separator:url("Прайс.files/header.htm") fs;
	mso-footnote-continuation-separator:url("Прайс.files/header.htm") fcs;
	mso-endnote-separator:url("Прайс.files/header.htm") es;
	mso-endnote-continuation-separator:url("Прайс.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:17.0pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=627
 style='width:470.2pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt;border-right:solid windowtext 1.0pt;'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:21.0pt'>
  <td width=627 nowrap colspan=7 style='width:470.2pt;border:solid windowtext 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:21.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:16.0pt;font-family:"Arial CYR"'>Остатки на складе</span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:13.5pt'>
  <td width=627 nowrap colspan=7 style='width:470.2pt;border-top:none;
  border-left:solid windowtext 1.0pt;border-bottom:solid windowtext 1.0pt;
  border-right:solid black 1.0pt;mso-border-top-alt:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal><span style='font-size:8.0pt;font-family:"Arial CYR"'>Цены
  указаны в у.е. с учетом НДС<span style='mso-spacerun:yes'>        
  </span>#($ZD(+$H,4))#<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:13.5pt'>
  <td width=627 nowrap colspan=7 style='width:470.2pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-left-alt:solid windowtext 1.0pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext 1.0pt;padding:
  0cm 5.4pt 0cm 5.4pt;height:20pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:16.0pt;font-family:"Arial CYR"'>#($G(GroupName))#</span></b><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:13.5pt'>
  <td width=43 nowrap style='width:32.45pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>№ П/П<o:p></o:p></span></b></p>
  </td>
  <td width=177 nowrap style='width:132.7pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Изделие<o:p></o:p></span></b></p>
  </td>
  <td width=119 nowrap style='width:89.25pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Модель<o:p></o:p></span></b></p>
  </td>
  <td width=160 nowrap style='width:119.7pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Наименование запчасти<o:p></o:p></span></b></p>
  </td>
  <td width=69 nowrap style='width:52.1pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Код запчасти<o:p></o:p></span></b></p>
  </td>
  <td width=59 nowrap style='width:44.0pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Количество</span></b></p>
  </td>
  <td width=59 nowrap style='width:44.0pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:13.5pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:8.0pt;font-family:"Arial CYR"'>Сумма</span></b></p>
  </td>
 </tr>
 
 <script language="cache" runat="Server">
 s glob=$NA(^mtempReport("GetGoodsFromGroup",$I))
 s DigitsDelimeter = $$$TunesVariableGlobal("DigitsDelimeter")
 
 s ok=##class(Reports.Analyzis).GetGoodsFromGroup(GroupCode,CatalogueID,glob)
 s GroupCode="" f  s GroupCode=$O(@glob@(GroupCode)) q:GroupCode=""  d
 . s GroupName=$G(@glob@(GroupCode,"GroupName"))
 . w "<tr style='mso-yfti-irow:4;mso-yfti-lastrow:yes;height:16pt'><td colspan=7 style=""border-left:solid windowtext 1.0pt;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;""><p class=MsoNormal ><b><span style='font-size:13.0pt;font-family:Arial CYR'>"_GroupName_"</b></span></td></tr>"
 . s GoodsID="" f  s GoodsID=$O(@glob@(GroupCode,"Goods",GoodsID)) q:GoodsID=""  d
 . . i $I(count)
 . . s GroupID=$G(@glob@(GroupCode,"Goods",GoodsID,"GroupID"))
 . . s GoodsName=$G(@glob@(GroupCode,"Goods",GoodsID,"GoodsName"))
 . . s Goodsizdelie=$G(@glob@(GroupCode,"Goods",GoodsID,"Goodsizdelie"))
 . . s Goodsabbr=$G(@glob@(GroupCode,"Goods",GoodsID,"Goodsabbr"))
 . . s GoodsModel=$G(@glob@(GroupCode,"Goods",GoodsID,"GoodsModel"))
 . . s GoodsShemNumber=$G(@glob@(GroupCode,"Goods",GoodsID,"GoodsShemNumber"))
 . . s Quantity=0
 . . s ok=##class(Store.Action).GetQuantByGoods(GoodsID,.Quantity)
 . . i '+ok s Quantity=ok
 . . s LastCena = ##class(Store.Action).getlastcena(GoodsID)
 . . s SummaZ = LastCena*Quantity
 . . s Summa = $TR(SummaZ,".",DigitsDelimeter)
 . . &html<<tr style='mso-yfti-irow:4;mso-yfti-lastrow:yes;height:12.75pt;'>
  <td width=43 nowrap valign=bottom style='width:32.45pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
    <p class=MsoNormal align=center style='text-align:center'><span  style='font-size:10.0pt;font-family:"Arial CYR"'>#(count)#<o:p></o:p></span></p>
  </td>
  <td width=177 nowrap valign=bottom style='width:132.7pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
    <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>#(Goodsizdelie)#</span></p>
  </td>
  <td width=119 nowrap valign=bottom style='width:89.25pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
    <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>#(Goodsabbr)#-#(GoodsModel)#<o:p></o:p></span></p>
  </td>
  <td width=160 nowrap valign=bottom style='width:119.7pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
    <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>#(GoodsName)#<o:p></o:p></span></p>
  </td>
  <td width=69 nowrap valign=bottom style='width:52.1pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
    <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>#(GoodsShemNumber)#<o:p></o:p></span></p>
  </td>
  <td valign=bottom style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;height:12.75pt' >
    <p class=MsoNormal align=right style='text-align:right'><span style='font-size:10.0pt;font-family:"Arial CYR"'>#(+$G(Quantity))#</span></p>
  </td>
  <td valign=bottom style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;height:12.75pt' x:num="#(SummaZ)#">
    <p class=MsoNormal align=right style='text-align:right'><span style='font-size:10.0pt;font-family:"Arial CYR"'>#($G(Summa))#</span></p>
  </td>
 </tr>
 >
 </script>

</table>


</body>

</html>
]]></CSP>


<CSP name="screen/otchet.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Otchet).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s:$ISOBJECT(obj.User1) usr=obj.User1.Name
 . d:$ISOBJECT(obj.Kontr)
 . . s Name=obj.Kontr.Name
 . . s Address=obj.Kontr.Address
 . . s Tel=obj.Kontr.Phones
 . . s email=obj.Kontr.EMail
 . . s chief=obj.Kontr.chief
 . s Numb=obj.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=$G(mn(+$P($ZD(obj.Dat,4),"/",2)))
 . s year=$P($ZD(obj.Dat,4),"/",3)
 . s Date=day_" "_month_" "_year
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="otchet.files/filelist.xml">
<title>Технический отчет </title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
<o:Author>NB-FUJ</o:Author>
<o:LastAuthor>NB-FUJ</o:LastAuthor>
<o:Revision>2</o:Revision>
<o:TotalTime>22</o:TotalTime>
<o:Created>2006-07-03T11:05:00Z</o:Created>
<o:LastSaved>2006-07-03T11:05:00Z</o:LastSaved>
<o:Pages>1</o:Pages>
<o:Words>80</o:Words>
<o:Characters>459</o:Characters>
<o:Company>IBT</o:Company>
<o:Lines>3</o:Lines>
<o:Paragraphs>1</o:Paragraphs>
<o:CharactersWithSpaces>538</o:CharactersWithSpaces>
<o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
<w:SpellingState>Clean</w:SpellingState>
<w:GrammarState>Clean</w:GrammarState>
<w:PunctuationKerning/>
<w:ValidateAgainstSchemas/>
<w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
<w:IgnoreMixedContent>false</w:IgnoreMixedContent>
<w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
<w:Compatibility>
 <w:BreakWrappedTables/>
 <w:SnapToGridInCell/>
 <w:WrapTextWithPunct/>
 <w:UseAsianBreakRules/>
 <w:DontGrowAutofit/>
</w:Compatibility>
<w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
.ss{border-left:solid windowtext 1.0pt;border-top:solid windowtext 1.0pt;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:841.9pt 595.3pt;
	mso-page-orientation:landscape;
	margin:2.0cm 2.0cm 2.0cm 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
table.MsoTableGrid
	{mso-style-name:"Сетка таблицы";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'>Технический отчет <span style='mso-tab-count:1'>        </span></span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:Arial;
mso-ansi-language:EN-US'>№#($G(Numb))# от #($G(Date))#<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
<td width=283 valign=top style='width:212.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span style='font-family:Arial'>Наименование сервисного
центра<o:p></o:p></span></p>
</td>
<td width=703 valign=top style='width:526.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>#($G(Name))#<o:p></o:p></span></p>
</td>
 </tr>
 <tr style='mso-yfti-irow:1'>
<td width=283 valign=top style='width:212.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span style='font-family:Arial'>Адрес<o:p></o:p></span></p>
</td>
<td width=703 valign=top style='width:526.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>#($G(Address))#<o:p></o:p></span></p>
</td>
 </tr>
 <tr style='mso-yfti-irow:2'>
<td width=283 valign=top style='width:212.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span style='font-family:Arial'>Телефон<o:p></o:p></span></p>
</td>
<td width=703 valign=top style='width:526.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>#($G(Tel))#<o:p></o:p></span></p>
</td>
 </tr>
 <tr style='mso-yfti-irow:3'>
<td width=283 valign=top style='width:212.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>E-mail<o:p></o:p></span></p>
</td>
<td width=703 valign=top style='width:526.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>#($G(email))#<o:p></o:p></span></p>
</td>
 </tr>
 <tr style='mso-yfti-irow:4;mso-yfti-lastrow:yes'>
<td width=283 valign=top style='width:212.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span style='font-family:Arial'>Ф.И.О. Директора<o:p></o:p></span></p>
</td>
<td width=703 valign=top style='width:526.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>#($G(chief))#<o:p></o:p></span></p>
</td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 
 style='width:731pt;border-collapse:collapse;border:none;mso-border-alt:
 solid windowtext .5pt;mso-yfti-tbllook:480;mso-padding-alt:0cm 1.4pt 0cm 1.4pt;
 mso-border-insideh:.5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
<td width=37 valign=top style='width:28.05pt;border:solid windowtext 1.0pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>№<o:p></o:p></span></p>
<p class=MsoNormal align=center style='text-align:center'><span class=SpellE><span
class=GramE><span style='font-family:Arial'>п</span></span></span><span
lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>/</span><span
class=SpellE><span style='font-family:Arial'>п</span></span><span
style='font-family:Arial'><o:p></o:p></span></p>
</td>
<td width=129 valign=top style='width:97.1pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Наименование изделия<o:p></o:p></span></p>
</td>
<td width=80 valign=top style='width:60.25pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Модель<o:p></o:p></span></p>
</td>
<td width=84 valign=top style='width:63.1pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Заводской №<o:p></o:p></span></p>
</td>
<td width=113 valign=top style='width:84.5pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Гарантийный талон №<o:p></o:p></span></p>
</td>
<td width=89 valign=top style='width:67.1pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Отрывной талон (А/</span><span lang=EN-US
style='font-family:Arial;mso-ansi-language:EN-US'>B</span><span
style='font-family:Arial'>/</span><span lang=EN-US style='font-family:Arial;
mso-ansi-language:EN-US'>C</span><span style='font-family:Arial'>)<o:p></o:p></span></p>
</td>
<td width=105 valign=top style='width:78.75pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Наименование детали<o:p></o:p></span></p>
</td>
<td width=47 valign=top style='width:35.55pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Код<o:p></o:p></span></p>
</td>
<td width=73 valign=top style='width:54.8pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Количество<o:p></o:p></span></p>
</td>
<td width=67 valign=top style='width:50.2pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Цена детали<o:p></o:p></span></p>
</td>
<td width=77 valign=top style='width:57.7pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Цена ремонта<o:p></o:p></span></p>
</td>
<td width=83 valign=top style='width:62.2pt;border:solid windowtext 1.0pt;
border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:Arial'>Источник детали<o:p></o:p></span></p>
</td>
 </tr>
 <script language="cache" runat="server">
  d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=obj.Items.GetAt(i)
 . . d:$ISOBJECT(item.Goods) 
 . . . s izdelie=item.Goods.izdelie
 . . . i $ISOBJECT(izdelie) s izdelie=izdelie.Name
 . . . e  s izdelie=""
 . . . s Property3609=item.Goods.Property3609
 . . . s gname=item.Goods.Name
 . . . s Property5300=item.Goods.Property5300
 . . s serial=item.serial
 . . s garant=item.garant
 . . s talon=item.talon
 . . s Price=item.Price
 . . //s remcost=item.remcost
 . . s Quantity=item.Quantity
 . . s gsource=item.goodssource
 . . s srcname=item.goodssourceLogicalToDisplay(item.goodssource)
 . . //s sum(gsource)=$G(sum(gsource))+(Quantity*Price)
 . . //s qtotal=$G(qtotal)+Quantity
 . . //s qtotal(gsource)=$G(qtotal(gsource))+Quantity
 . . //s total=$G(total)+remcost
 . . //s total(gsource)=$G(total(gsource))+remcost
 . . //s total(gsource,"srcname")=srcname
 . . w "<tr style='mso-yfti-irow:1'>"
 . . w "<td width=37 valign=top style='width:28.05pt;border:solid windowtext 1.0pt;border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'><p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:EN-US'>"_count_"<o:p></o:p></span></p></td>"
 . . w "<td width=129 valign=top style='width:97.1pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(izdelie)_"</td>"
 . . w "<td width=80 valign=top style='width:60.25pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'><p class=MsoNormal>"_$G(Property3609)_"<o:p></o:p></span></p></td>"
 . . w "<td width=84 valign=top style='width:63.1pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(serial)_"</td>"
 . . w "<td width=113 valign=top style='width:84.5pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(garant)_"</td>"
 . . w "<td width=89 valign=top style='width:67.1pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(talon)_"</td>"
 . . w "<td width=105 valign=top style='width:78.75pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(gname)_"</td>"
 . . w "<td width=47 valign=top style='width:35.55pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(Property5300)_"</td>"
 . . w "<td width=73 valign=top style='width:54.8pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(Quantity)_"</td>"
 . . w "<td width=67 valign=top style='width:50.2pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(Price)_"</td>"
 . . w "<td width=77 valign=top style='width:57.7pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(remcost)_"</td>"
 . . w "<td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>"_$G(srcname)_"</td>"
 . . w "</tr>"
 </script>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
<td width=37 valign=top style='width:28.05pt;border:solid windowtext 1.0pt;
border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=129 valign=top style='width:97.1pt;border-top:none;border-left:
none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-family:Arial'>Итого<o:p></o:p></span></b></p>
</td>
<td width=80 valign=top style='width:60.25pt;border-top:none;border-left:
none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=84 valign=top style='width:63.1pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=113 valign=top style='width:84.5pt;border-top:none;border-left:
none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=89 valign=top style='width:67.1pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'>&nbsp;<o:p></o:p></span></p>
</td>
<td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=47 valign=top style='width:35.55pt;border-top:none;border-left:
none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=73 valign=top style='width:54.8pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal>#($G(qtotal))#</p>
</td>
<td width=67 valign=top style='width:50.2pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
<td width=77 valign=top style='width:57.7pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'>#($J(+$G(total),".",2))#<o:p>&nbsp;</o:p></span></p>
</td>
<td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;
border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
</td>
 </tr>
</table>
<p align=right>
<script language="cache" runat="server">
//w "<table cellspacing=0 style='border-right:solid windowtext 1.0pt;border-bottom:solid windowtext 1.0pt;'><tr><td class=ss>&nbsp;<td class=ss>Количество<td class=ss>Стоимость<br>ремонта<td class=ss>Стоимость<br>деталей<td class=ss>Итого"
 s i="" f  s i=$O(total(i)) q:i=""  d
 . s detal=$J(+$G(sum(i)),".",2)
 . s remo=$J(+$G(total(i)),".",2)
 . s iiu=$J(detal+remo,".",2)
 . s bednyiyorik=$G(bednyiyorik)+iiu
 . //w "<tr><td class=ss><i>"_$G(total(i,"srcname"))_"</i><td class=ss>"_+$G(qtotal(i))_"<td class=ss>"_remo_"<td class=ss>"_detal_"<td class=ss>"_iiu
 //w "<tr><td class=ss colspan=4><b>Итого</b><td class=ss>"_$J(bednyiyorik,".",2)
 //w "</table>"
 w "<span style='font-family:Arial'>Итого к оплате: <b>"_$J(+$G(total)+$G(sum(2)),".",2)_"</b></span>"
 </script>
<br>


<p class=MsoNormal><span style='font-family:Arial'>Директор сервисного центра
_________________ #($G(chief))#<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'>Дата<span style='mso-tab-count:
4'>                                      </span>М.П.<o:p></o:p></span></p>
</td></tr>
</table>
</div>

</body>

</html>
]]></CSP>


<CSP name="screen/otchet2.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 d:%session.NewSession 
 . s %session.EndSession=1
 . s ses=%request.Get("sessionid",1)
 . s %session=%session.GetSession(ses)


s AllColumns = %request.Get("AllColumns")

if %request.Get("word")="on"
{
	 set %response.ContentType = "application/msword"
	 do %response.SetHeader("Content-Disposition","attachment;word.doc")
	 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
	 s WordFormat=1
}
else
{
	s WordFormat=0
}
 q 1
</script>
<script language="cache" runat="server">
 n id,obj
 s mn(1)="Январь",mn(2)="Февраль",mn(3)="Март",mn(4)="Апрель",mn(5)="Май",mn(6)="Июнь",mn(7)="Июль",mn(8)="Август",mn(9)="Сентябрь",mn(10)="Октябрь",mn(11)="Ноябрь",mn(12)="Декабрь"
 s id=%request.Get("id")
 s obj=##class(Docs.Otchet).%OpenId(id)
 d:$ISOBJECT(obj)
 . s OtchetMonth=$G(mn(+obj.Name))
 . s OtchetYear=$P(obj.Name,"\",2)
 . d:$ISOBJECT(obj.Kontr)
 . . s KontragentName=obj.Kontr.Name
 . . s Address=obj.Kontr.Address
 . . s City=obj.Kontr.City
 . . s Phones=obj.Kontr.Phones
 . . s EMail=obj.Kontr.EMail
 . . s chief=obj.Kontr.chief
 . . s CurrencyName = ##class(Common.Kontragent).CurrencyLogicalToDisplay(obj.Kontr.Currency)
 . s summa = $J(obj.Summa,".",2)
 . s DocKurs = obj.Kurs
 . s SluzapObj=obj.Sluzap	//документ "служебная записка"
 . if $ISOBJECT(SluzapObj) d
 . . s SluzapName=SluzapObj.Name
 . . s SluzapId=SluzapObj.%Id()
 . . s SluzapPrintUrl="screen/sluzap.csp?docid="_SluzapId_"&class=Docs.Sluzap"
 
</script>
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1251">
	<TITLE>№ </TITLE>
</HEAD>
<BODY LANG="ru-RU" TEXT="#000000" LINK="#000080" VLINK="#800000" DIR="LTR">
<H1><FONT SIZE=3><U>ПРИЛОЖЕНИЕ 3. </U></FONT>
</H1>
<DL>
	<DT><BR>
	<DT><FONT FACE="Arial">К <span onclick="alert('ID сессии #(%session.SessionId)#')">ДОГОВОРУ</span> НА ПРОВЕДЕНИЕ СЕРВИСНОГО
	ОБСЛУЖИВАНИЯ  №_____   от ______________20__ г.      </FONT>
	<DT><BR>
	<DT><FONT FACE="Arial"><B>Технический отчет за #($G(OtchetMonth))# #($G(OtchetYear))# г.</B></FONT><DT>
	<BR>
	<DT><FONT FACE="Arial">Наименование сервисного	центра: #($G(KontragentName))#;
	Адрес: #($G(City))# #($G(Address))#; </FONT>
	<DT><FONT FACE="Arial">Телефон: #($G(Phones))#;
	Факс: #($G(fax))#; </FONT>
	<DT>E-mail<FONT FACE="Arial">: #($G(EMail))#;</FONT><DT>
	<FONT FACE="Arial">Ф.И.О. директора: #($G(chief))#</FONT><DT>
	<FONT FACE="Arial">Служебная записка: <a href="#($G(SluzapPrintUrl))#" target=_blank>#($G(SluzapName))#</a></FONT><DT>
	<BR>
	<DT><BR>
	<DT><FONT FACE="Arial">(Форма и образец заполнения</FONT>)<DT>
	<BR>
</DL>
<TABLE BORDER=1 CELLPADDING=7 CELLSPACING=0>
<!--
	<COL WIDTH=21>
	<COL WIDTH=101>
	<COL WIDTH=58>
	<COL WIDTH=106>
	<COL WIDTH=70>
	<COL WIDTH=46>
	<COL WIDTH=118>
	<COL WIDTH=82>
	<COL WIDTH=34>
	<COL WIDTH=70>
	<COL WIDTH=58>
	-->
	<TR VALIGN=TOP>
		<TD WIDTH=21>
			<P ALIGN=CENTER>№<P ALIGN=CENTER>
			<FONT FACE="Arial"><FONT SIZE=2>п/п</FONT></FONT></TD>
		<TD WIDTH=101  >
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Наименование </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>изделия</FONT></FONT>
		</TD>
		<TD WIDTH=58>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Модель</FONT></FONT></TD>
		<TD WIDTH=106>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Заводской №</FONT></FONT></TD>
		<TD WIDTH=70>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Гарант. </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>талон №</FONT></FONT></TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Отр. </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>талон (</FONT></FONT><FONT FACE="Arial"><FONT SIZE=2><SPAN LANG="en-US">A</SPAN></FONT></FONT><FONT FACE="Arial"><FONT SIZE=2>/</FONT></FONT><FONT FACE="Arial"><FONT SIZE=2><SPAN LANG="en-US">B</SPAN></FONT></FONT><FONT FACE="Arial"><FONT SIZE=2>/</FONT></FONT><FONT FACE="Arial"><FONT SIZE=2><SPAN LANG="en-US">C</SPAN></FONT></FONT><FONT FACE="Arial"><FONT SIZE=2>)</FONT></FONT></TD>
		<TD WIDTH=118>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Наименование</FONT></FONT><P ALIGN=CENTER>
			<FONT FACE="Arial"><FONT SIZE=2>детали</FONT></FONT></TD>
		<TD WIDTH=82>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Марка </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>детали</FONT></FONT></TD>
		<TD WIDTH=34>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Кол-во</FONT></FONT></TD>
		<TD WIDTH=70>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Цена </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>детали</FONT></FONT></TD>
		<TD WIDTH=58>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>Цена </FONT></FONT>
			<P ALIGN=CENTER><FONT FACE="Arial"><FONT SIZE=2>ремонта</FONT></FONT></TD>
	
<script language="cache" runat="server">
if AllColumns,WordFormat
{
	w "<td>Примечание"
	w "<td>Дата"
	//w "<td>Источник товара"
	w "<td>Тип ремонта"
	//w "<td>Сумма"
	
}

/*
//s ^mtempArt("AllColumns")=AllColumns
if (AllColumns)
{
	s SkipFields = "RemTovar,serial,garant,talon,Quantity,remcost,Price,Goods,DocType"
	s headers=##class(Common.Common).showheaders("Docs.OtchetItems","",SkipFields)
	
	s ^mtempArt("headers")=headers
	for i=1:1:($L(headers,"#@#")-1)
	{
		s fieldStr = $P(headers,"#@#",i)
		s FieldDescr = $P(fieldStr,"~",2)
		w "<TD>"_FieldDescr
	}
}
*/

w "</TR>",!
#include xmlmacros

 //соберём в одну глобаль все модели и запчасти
 n glob,i,count,item,z
 
 s MM=$$$TunesVariableGlobal("MM")	//список аббревиатур мастермакс через запятую
 s VC=$$$TunesVariableGlobal("VC")
 s TL=$$$TunesVariableGlobal("TL")
 //списки которые через запятую перегоним в массивы, и вырежем пробелы
 f brandname="MM","VC","TL" d
 . f i=1:1:$L(@brandname,",") d
 . . //обрезаем пробелы
 . . s abbr=$TR($P(@brandname,",",i)," ","")
 . . q:abbr=""
 . . s @brandname@(abbr)=""

 s glob=$NA(^mtempOthcet($J))
 k @glob
 
 d:$ISOBJECT(obj.Items)
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . s item=obj.Items.GetAt(i)
 . . q:'$ISOBJECT(item.Goods)
 . . s groups=+item.Groups
 . . s GoodsId = item.Goods.%Id()
 . . &sql(select Groups->Catalogue->Name into :CatalogueName from Goods.GoodsGroup where Goods=:GoodsId)
 . . else  s CatalogueName="Каталог не найден"
 . . if SQLCODE s CatalogueName="Каталог не найден"
 . . s Summa=item.CalculatedStringRubSumma()
 . . s SumsArray(CatalogueName)=$G(SumsArray(CatalogueName))+Summa
 . . if $ISOBJECT(item.RemTovar) d
 . . . //это модель
 . . . s @glob@(groups,"ModelName")=item.RemTovar.Name
 . . . s @glob@(groups,"AbbrNumber")=item.RemTovar.ModelNumber
 . . . s Abbr=item.RemTovar.abbr
 . . . s @glob@(groups,"Serial")=item.serial
 . . . s @glob@(groups,"Garant")=item.garant
 . . . s @glob@(groups,"Talon")=item.talonLogicalToDisplay(item.talon)
 . . . s @glob@(groups,"Quantity")=item.Quantity
 . . . s @glob@(groups,"RemontCost")=$J(item.remcost,"",2)
 . . . s @glob@(groups,"RemType")=item.RemType
 . . . s @glob@(groups,"ActNumber")=item.ActNumber
 . . . s @glob@(groups,"Number")= item.Number
 . . . s:AllColumns&WordFormat @glob@(groups,"Comment")=item.Comment
 . . . s:AllColumns&WordFormat @glob@(groups,"Dat")=$S(+item.Dat:$ZD(item.Dat,4),1:"")
 . . . //s:AllColumns&WordFormat @glob@(groups,"goodssource")= ##class(Docs.OtchetItems).goodssourceLogicalToDisplay(item.goodssource)
 . . . s:AllColumns&WordFormat @glob@(groups,"RemType")=##class(Docs.OtchetItems).RemTypeLogicalToDisplay(item.RemType)
 . . . //s @glob@(groups,"Total")=item.Total
 . . . s @glob@(groups,"Summa")=$J(Summa,"",2)
 . . else  d
 . . . //это запчасть
 . . . i $I(DetailCount)
 . . . s @glob@(groups,DetailCount,"DetailName")=item.Goods.Name
 . . . s @glob@(groups,DetailCount,"DetailBrand")=item.Goods.abbr_"-"_item.Goods.Property3609
 . . . s Abbr=item.Goods.abbr
 . . . s @glob@(groups,DetailCount,"Quantity")=item.Quantity
 . . . s @glob@(groups,DetailCount,"DetailPrice")=item.Price
 . . . s:WordFormat @glob@(groups,DetailCount,"Comment")=item.Comment
 . . . s @glob@(groups,DetailCount,"Dat")=$S(+item.Dat:$ZD(item.Dat,4),1:"")
 . . . s @glob@(groups,DetailCount,"goodssource")= ##class(Docs.OtchetItems).goodssourceLogicalToDisplay(item.goodssource)
 . . . s @glob@(groups,DetailCount,"RemType")=##class(Docs.OtchetItems).RemTypeLogicalToDisplay(item.RemType)
 . . . s @glob@(groups,DetailCount,"Summa")=Summa
 . . . //s @glob@(groups,DetailCount,"Total")=item.Total
 . . s Serials(item.serial_" ")=$I(Serials(item.serial_" "))
 . . s var=$S($D(MM(Abbr)):"MM",$D(VC(Abbr)):"VC",$D(TL(Abbr)):"TL",1:"untitled")
 . . s @var=+$G(@var)+Summa
 
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s ModelName=$G(@glob@(i,"ModelName"))
 . s AbbrNumber=$G(@glob@(i,"AbbrNumber"))
 . s Serial=$G(@glob@(i,"Serial"))
 . s GarantId = $G(@glob@(i,"Garant"))
 . s Garant= GarantId
 . //s:GarantId'="" Garant=Garant_"/"_##class(Common.Dictionary2).GetPropertyValue(GarantId,"Property9194")
 . s Talon=$G(@glob@(i,"Talon"))
 . s Quantity=$G(@glob@(i,"Quantity"))
 . s RemontCost=$G(@glob@(i,"RemontCost"))
 . s Comment=$G(@glob@(i,"Comment"))
 . s Dat=$G(@glob@(i,"Dat"))
 . s goodssource=$G(@glob@(i,"goodssource"))
 . s RemType=$G(@glob@(i,"RemType"))
 . s ActNumber=$G(@glob@(i,"ActNumber"))
 . s ActNumberName=$S(ActNumber="":"",1:" Акт "_ActNumber)
 . s RemTypeName = ##class(Docs.OtchetItems).RemTypeLogicalToDisplay(RemType)
 . s LineNumber = $G(@glob@(i,"Number"))
 . //s Total=$G(@glob@(i,"Total"))
 . s (DetailPrice,DetailName)="&nbsp;"
 . i $I(count)
 . if '+RemontCost s color="red"
 . else  s color="black"
 . w "<TR VALIGN=TOP>"
 . w "<TD WIDTH=21><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2 title="""_Comment_""">"_$G(LineNumber)_"&nbsp;</FONT></FONT></TD>"
 . w "<TD WIDTH=101 style=""word-break:break-all""><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(ModelName)_"</FONT></FONT></TD>"
 . w "<TD WIDTH=58><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(AbbrNumber)_"</FONT></FONT></TD>"
 . w "<TD WIDTH=106><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(Serial)_"</FONT></TD>"
 . w "<TD WIDTH=70><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(Garant)_"</FONT></FONT></TD>"
 . w "<TD WIDTH=46><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_ActNumberName_" "_$G(Talon)_" ("_RemTypeName_")"_"</FONT></FONT></TD>"
 . w "<TD WIDTH=118><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(DetailName)_"</FONT></FONT></TD>"
 . w "<TD WIDTH=82><P ALIGN=JUSTIFY><BR></TD>"
 . w "<TD WIDTH=34><P ALIGN=JUSTIFY><FONT FACE=""Arial"">"_$G(Quantity)_"</FONT></TD>"
 . w "<TD WIDTH=70><P ALIGN=JUSTIFY><FONT FACE=""Arial"">-</FONT></TD>"
 . w "<TD WIDTH=58 style=""color:"_color_""">"_$G(RemontCost)_"</TD>"
 . if WordFormat&AllColumns w "<td>"_$G(Comment)	//примечание
 . if WordFormat&AllColumns w "<td>"_$G(Dat)	//дата
 . if WordFormat&AllColumns w "<td>"_$G(goodssource)	//источник товара
 . if WordFormat&AllColumns w "<td>"_$G(RemType)	//тип ремонта
 . //if WordFormat w "<td>"_$G(Total)	//сумма
 . w "</TR>",!
 . s z="" f  s z=$O(@glob@(i,z)) q:z=""  d
 . . q:'+z
 . . i $I(count)
 . . s DetailName=@glob@(i,z,"DetailName")
 . . s DetailBrand=@glob@(i,z,"DetailBrand")
 . . s Quantity=@glob@(i,z,"Quantity")
 . . s DetailPrice=@glob@(i,z,"DetailPrice")
 . . s Comment=$G(@glob@(i,"Comment"))
 . . s Dat=$G(@glob@(i,"Dat"))
 . . s goodssource=$G(@glob@(i,"goodssource"))
 . . s RemType=$G(@glob@(i,"RemType"))
 . . s ActNumber=$G(@glob@(i,"ActNumber"))
 . . //s Total=$G(@glob@(i,"Total"))
 . . s (ModelName,AbbrNumber,Serial,Garant,Talon,RemontCost)="&nbsp;"
 . . if Quantity="" s Quantity="&nbsp;"
 . . if DetailPrice="" s DetailPrice="&nbsp;"
 . . if DetailName="" s DetailName="&nbsp;"
 . . s Summa = $G(@glob@(i,z,"Summa"))
 . . if '+Summa s Summa="&nbsp;"
 . . w "<TR VALIGN=TOP>"
 . . // c 1.12.2012 нумеруем строки согласно полю Number в базе $G(count)
 . . w "<TD WIDTH=21><P ALIGN=JUSTIFY><FONT FACE=""Arial"" SIZE=2>"_"&nbsp;</FONT></TD>"	//номер строки с деталью
 . . w "<TD WIDTH=101 style=""word-break:break-all""><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(ModelName)_"</FONT></FONT></TD>"
 . . w "<TD WIDTH=58><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(AbbrNumber)_"</FONT></FONT></TD>"
 . . w "<TD WIDTH=106><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(Serial)_"</FONT></TD>"
 . . w "<TD WIDTH=70><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(Garant)_"</FONT></FONT></TD>"
 . . w "<TD WIDTH=46><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(Talon)_"</FONT></FONT></TD>"
 . . w "<TD WIDTH=118><P ALIGN=JUSTIFY><FONT FACE=""Arial""><FONT SIZE=2>"_$G(DetailName)_"</FONT></FONT></TD>"
 . . w "<TD WIDTH=82><P ALIGN=JUSTIFY>"_$G(DetailBrand)_"</TD>"
 . . w "<TD WIDTH=34><P ALIGN=JUSTIFY><FONT FACE=""Arial"">"_$G(Quantity)_"</FONT></TD>"
 . . w "<TD WIDTH=70 style=""color:red""><P ALIGN=JUSTIFY><FONT FACE=""Arial"">"_$G(Summa)_"</FONT></TD>"
 . . w "<TD WIDTH=58>"_$G(RemontCost)_"</TD>"
 . . if WordFormat&AllColumns w "<td>"_$G(Comment)	//примечание
 . . if WordFormat&AllColumns w "<td>"_$G(Dat)	//дата
 . . if WordFormat&AllColumns w "<td>"_$G(goodssource)	//источник товара
 . . if WordFormat&AllColumns w "<td>"_$G(RemType)	//тип ремонта
 . . //if WordFormat w "<td>"_$G(Total)	//сумма
 . . w "</TR>"
 k @glob
&html<
	</TABLE><br>
	<FONT FACE="Arial">Сумма отчёта #($G(summa))#
>
 if +$G(DocKurs) w "Курс "_$G(DocKurs)
 
 if ($G(%session.Data("login"))'="")
 {
	 w "<br><br>Сумма сгруппированная по классификаторам<table>"
	 f i="" f  s i=$O(SumsArray(i)) q:i=""  d
	 . w "<tr><td>"_i_"<td>"_$J($G(SumsArray(i)),"",2)
	 w "</table>"
	 
	 w "<br>Сумма сгруппированная по брендам<table>"
	 w "<tr><td>Mastermax<td>"_$J($G(MM),"",2)
	 w "<tr><td>Viconte<td>"_$J($G(VC),"",2)
	 w "<tr><td>Tull<td>"_$J($G(TL),"",2)
	 w:+$G(untitled) "<tr><td>Товары с неизвестным брендом<td>"_$J($G(untitled),"",2)
	 w "</table>",!
 }
 w "<br>" 
 w "Валюта расчётов с клиентом: "_$G(CurrencyName)
 w "<br>"
 w "Дублированные серийные номера: "
 s serial=""
 for  
 {
	 s serial = $O(Serials(serial))
	 q:serial=""
	 continue:+$G(Serials(serial))<=1
	 w serial
 }
</script>
</font>
<DL>
	<DT>			<DT>
	<BR>
	<DT><BR>
	<DT><FONT FACE="Arial">Директор сервисного
	центра					/______________/</FONT><DT>
	<BR>
	<DT><FONT FACE="Arial">&laquo;___&raquo;________________200</FONT>_<FONT FACE="Arial">г.												М.П.</FONT><DT>
												</DL>
</BODY>
</HTML>

]]></CSP>


<CSP name="screen/OtchetSerialTake.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html>
<head>
<title>	Проверка дубликатов серийных номеров в отчёте контрагента </title>
<style>
BODY { font-family: Arial;margin: 30px }
</style>
</head>

<body>
<server>
 s docObj = ##class(Docs.Otchet).%OpenId(%request.Get("id"))
 
 if $ISOBJECT(docObj),$ISOBJECT(docObj.Items)
 {
	 w "<h2>Отчёт "_docObj.Name_" от "_$ZD(docObj.Dat,1)_"</h2>"
	 w "<br><br>"
	 W "<table cellpadding=7 cellspacing=0 border=1>"
	 w "<tR>"
	 	w "<th>№ п/п"
	 	w "<th>Товар"
	 	w "<th>Серийный номер"
	 	w "<th>Копия"
	 w "</tr>"
	  s i=""
	  for  
	  {
		    s i=docObj.Items.Next(i) 
		    q:i=""
		    i $i(CountLines)
		    w "<tr>"
		    s item=docObj.Items.GetAt(i)
		    w "<td>"_CountLines
		    w "<td>"_item.Goods.FullName_" "
		    w "<td>"_item.serial_" "
		    w "<td> "
		    if ($D(Serials(item.serial_" "))) w $G(Serials(item.serial_" "))
		    w "</tr>"
		    
		    if '$D(Serials(item.serial_" ")) s Serials(item.serial_" ")=CountLines
	  }
	 w "</table>"
 }

</server>
</body>
</html>
]]></CSP>


<CSP name="screen/PlanExcel.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 set %response.ContentType = "application/x-msexcel"
 do %response.SetHeader("Content-Disposition","attachment;excel.xls")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"

if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1

</script>
<html>

<head>
<style id="th3-06_24542_Styles">
<!--table
	{mso-displayed-decimal-separator:"\.";
	mso-displayed-thousand-separator:" ";}
.xl1524542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2424542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2524542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial CYR", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2624542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2724542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2824542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2924542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:"\@";
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3024542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:14.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3124542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3224542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3324542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3424542
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
-->
</style>
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=848 style='border-collapse:
 collapse;table-layout:fixed;width:636pt'>
 <col class=xl2824542 width=64 style='width:48pt'>
 <col width=255 style='mso-width-source:userset;mso-width-alt:9325;width:191pt'>
 <col width=161 style='mso-width-source:userset;mso-width-alt:5888;width:121pt'>
 <col class=xl2824542 width=112 style='mso-width-source:userset;mso-width-alt:
 4096;width:84pt'>
 <col width=64 span=4 style='width:48pt'>
 <script language="cache" runat="server">
 n tempGlob,docid,docobj,DocLanguage,i,Quantity,DocString,count,abbr,digits,Name,TovarName,
 EnglishTovarName,o
 s docid=%request.Get("docid")
 s:docid ok=##class(Reports.ShowTables).MakeGlobForCheifPlan(docid,.tempGlob)
 s i="" f  s i=$O(@tempGlob@(i)) q:i=""  d
 . s TovarName=@tempGlob@(i,"Name")
 . w "<tr height=24 style='height:18.0pt'><td></td></tr>"
 . w "<tr height=24 style='height:18.0pt'><td height=24 class=xl2824542 width=64 style='height:18.0pt;width:48pt'></td><td class=xl2424542 colspan=3 width=528 style='width:396pt'>Spare parts order for "_i_" "_TovarName_"</td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td><td class=xl2624542 width=64 style='width:48pt'></td></tr>"
 . w "<tr height=24 style='height:18.0pt'><td height=24 class=xl2924542 style='height:18.0pt'>No</td><td class=xl3024542 style='border-left:none'>PART NAME</td><td class=xl3024542 style='border-left:none'>№ pos.</td><td class=xl3024542 style='border-left:none'>QUANTITY</td><td class=xl2624542></td><td class=xl3424542></td><td class=xl2624542></td><td class=xl2624542></td></tr>"
 . s count=0
 . s o="" f  s o=$O(@tempGlob@(i,"Name",o)) q:o=""  d
 . . i $i(count)
 . . s Quantity=@tempGlob@(i,"Name",o,"Quantity")
 . . s Name=@tempGlob@(i,"Name",o,"Name")
 . . s SchemaNumber=@tempGlob@(i,"Name",o,"SchemaNumber")
 . . w "<tr height=20 style='height:15.0pt'>"
 . . w "<td height=20 class=xl3324542 style='height:15.0pt;border-top:none' x:num>"_count_"</td>"
 . . w "<td class=xl2724542 style='border-top:none;border-left:none'>"_Name_"</td>"
 . . w "<td class=xl3224542 style='border-top:none;border-left:none' x:num>"_SchemaNumber_"</td>"
 . . w "<td class=xl3224542 style='border-top:none;border-left:none' x:num>"_Quantity_"</td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "<td class=xl2624542></td>"
 . . w "</tr>"
 k @tempGlob
</script>
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/plat-por.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s id=%request.Get("id")
 
 s (DocNumber,DocDate)=""
 
 s DocObj = ##class(Docs.Platejka).%OpenId(id)
 if $ISOBJECT(DocObj)
 {
	 s DocNumber=DocObj.Name
	 s DocDate=$ZD(DocObj.Dat,4)
	 s RubSumm = $J(DocObj.RubSumma,".",2)
	 
	 s Platelchik=DocObj.Kontr
	 if $ISOBJECT(Platelchik)
	 {
		 
	 }
	 
	 s Poluch=DocObj.Poluh
	 if $ISOBJECT(Poluch)
	 {
		 
	 }
 }
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="plat-por.files/filelist.xml">
<title>0401060</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>mvf</o:Author>
  <o:LastAuthor>Art</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:LastPrinted>2003-05-28T12:52:00Z</o:LastPrinted>
  <o:Created>2011-09-19T05:51:00Z</o:Created>
  <o:LastSaved>2011-09-19T05:51:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>61</o:Words>
  <o:Characters>354</o:Characters>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>414</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DoNotHyphenateCaps/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 пт</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 пт</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:Compatibility>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
  <w:LsdException Locked="true" Name="Normal"/>
  <w:LsdException Locked="true" Name="heading 1"/>
  <w:LsdException Locked="true" Name="heading 2"/>
  <w:LsdException Locked="true" Name="heading 3"/>
  <w:LsdException Locked="true" Name="heading 4"/>
  <w:LsdException Locked="true" Name="heading 5"/>
  <w:LsdException Locked="true" Name="heading 6"/>
  <w:LsdException Locked="true" Name="heading 7"/>
  <w:LsdException Locked="true" Name="heading 8"/>
  <w:LsdException Locked="true" Name="heading 9"/>
  <w:LsdException Locked="true" Name="toc 1"/>
  <w:LsdException Locked="true" Name="toc 2"/>
  <w:LsdException Locked="true" Name="toc 3"/>
  <w:LsdException Locked="true" Name="toc 4"/>
  <w:LsdException Locked="true" Name="toc 5"/>
  <w:LsdException Locked="true" Name="toc 6"/>
  <w:LsdException Locked="true" Name="toc 7"/>
  <w:LsdException Locked="true" Name="toc 8"/>
  <w:LsdException Locked="true" Name="toc 9"/>
  <w:LsdException Locked="true" Name="header"/>
  <w:LsdException Locked="true" Name="footer"/>
  <w:LsdException Locked="true" Name="caption"/>
  <w:LsdException Locked="true" Name="Title"/>
  <w:LsdException Locked="true" Name="Body Text"/>
  <w:LsdException Locked="true" Name="Subtitle"/>
  <w:LsdException Locked="true" Name="Hyperlink"/>
  <w:LsdException Locked="true" Name="Strong"/>
  <w:LsdException Locked="true" Name="Emphasis"/>
  <w:LsdException Locked="true" Name="Table Grid"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1073750139 0 0 159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Верхний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Нижний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{mso-style-link:"Основной текст Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:14.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
span.a
	{mso-style-name:"Верхний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Верхний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a0
	{mso-style-name:"Нижний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Нижний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a1
	{mso-style-name:"Основной текст Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Основной текст";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
	{mso-footnote-separator:url("plat-por.files/header.htm") fs;
	mso-footnote-continuation-separator:url("plat-por.files/header.htm") fcs;
	mso-endnote-separator:url("plat-por.files/header.htm") es;
	mso-endnote-continuation-separator:url("plat-por.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:34.0pt 1.0cm 1.0cm 2.0cm;
	mso-header-margin:19.85pt;
	mso-footer-margin:35.45pt;
	mso-header:url("plat-por.files/header.htm") h1;
	mso-footer:url("plat-por.files/header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:Calibri;
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU link=blue vlink=purple style='tab-interval:36.0pt;text-justify-trim:
punctuation'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 style='width:42.5pt;border:solid windowtext 1.0pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>0401060</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Поступ. в банк плат.<o:p></o:p></span></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Списано со сч. плат.<o:p></o:p></span></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=57 valign=bottom style='width:42.5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:18.0pt'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal style='tab-stops:center 205.55pt'><b><span
  style='font-size:12.0pt'>ПЛАТЕЖНОЕ ПОРУЧЕНИЕ № <span style='mso-tab-count:
  1'>          </span><o:p></o:p></span></b></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=28 valign=bottom style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=26 valign=bottom style='width:19.85pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Дата<o:p></o:p></span></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Вид платежа<o:p></o:p></span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=26 valign=top style='width:19.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;border:none;mso-border-left-alt:
 solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:
 solid windowtext .5pt;mso-padding-alt:0cm 1.4pt 0cm 1.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:41.0pt'>
  <td width=76 valign=top style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal>Сумма</p>
  <p class=MsoNormal>прописью</p>
  </td>
  <td width=605 colspan=12 valign=top style='width:16.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:41.0pt;border:none' width=0 height=55></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сумма</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:2;page-break-inside:avoid;height:28.5pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  border-right:solid windowtext 1.0pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.5pt;border:none' width=0 height=38></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:3;page-break-inside:avoid;height:28.0pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;mso-border-top-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:4;page-break-inside:avoid;height:14.1pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.1pt'>
  <p class=MsoNormal>Плательщик</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.1pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:5;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:6;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:7;page-break-inside:avoid;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Банк плательщика</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:8;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:9;page-break-inside:avoid;height:14.65pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:solid windowtext 1.0pt;border-bottom:none;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.65pt;border:none' width=0 height=20></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:10;page-break-inside:avoid;height:14.6pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.6pt'>
  <p class=MsoNormal>Банк получателя</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.6pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:11;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:solid windowtext 1.0pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:12;page-break-inside:avoid;height:28.0pt'>
  <td width=378 colspan=6 rowspan=3 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:13;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Вид оп.</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:solid windowtext 1.0pt;border-left:
  none;border-bottom:none;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Срок плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;mso-border-top-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:14;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Наз. пл.</p>
  </td>
  <td width=76 style='width:2.0cm;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Очер. плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:15;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Получатель</p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Код</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Рез. поле</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:16;height:13.0pt'>
  <td width=170 colspan=2 valign=bottom style='width:127.6pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=113 colspan=2 valign=bottom style='width:3.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 colspan=3 valign=bottom style='width:99.25pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:17;height:69.55pt'>
  <td width=680 colspan=13 valign=top style='width:18.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:69.55pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:69.55pt;border:none' width=0 height=93></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:18;mso-yfti-lastrow:yes;height:13.65pt'>
  <td width=680 colspan=13 valign=bottom style='width:18.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.65pt'>
  <p class=MsoNormal>Назначение платежа</p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.65pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <![if !supportMisalignedColumns]>
 <tr height=0>
  <td width=76 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=76 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td style='border:none' width=0><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <![endif]>
</table>

<p class=MsoNormal style='margin-bottom:18.0pt;tab-stops:center 9.0cm left 14.0cm'><span
style='mso-tab-count:1'>                                                                                                         </span>Подписи<span
style='mso-tab-count:1'>                                                       </span>Отметки
банка</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=227 valign=bottom style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 rowspan=2 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:41.0pt'>
  <td width=227 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt;
  height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'>М.П.</p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/platejnoe.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s id=%request.Get("id")
 
 s (DocNumber,DocDate)=""
 
 s DocObj = ##class(Docs.Platejka).%OpenId(id)
 if $ISOBJECT(DocObj)
 {
	 s DocNumber=DocObj.Name
	 s DocDate=$ZD(DocObj.Dat,4)
	 s RubSumm = $J(DocObj.RubSumma,".",2)
	 
	 s Platelchik=DocObj.Kontr
	 if $ISOBJECT(Platelchik)
	 {
		 s PlatelchikName = Platelchik.Name
	 }
	 
	 s Poluch=DocObj.Poluh
	 if $ISOBJECT(Poluch)
	 {
		 s PoluchName = Poluch.Name
	 }
 }
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="plat-por.files/filelist.xml">
<title>Платёжное поручение #(DocNumber)#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>mvf</o:Author>
  <o:LastAuthor>Art</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:LastPrinted>2003-05-28T12:52:00Z</o:LastPrinted>
  <o:Created>2011-09-19T05:51:00Z</o:Created>
  <o:LastSaved>2011-09-19T05:51:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>61</o:Words>
  <o:Characters>354</o:Characters>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>414</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DoNotHyphenateCaps/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 пт</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 пт</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:Compatibility>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
  <w:LsdException Locked="true" Name="Normal"/>
  <w:LsdException Locked="true" Name="heading 1"/>
  <w:LsdException Locked="true" Name="heading 2"/>
  <w:LsdException Locked="true" Name="heading 3"/>
  <w:LsdException Locked="true" Name="heading 4"/>
  <w:LsdException Locked="true" Name="heading 5"/>
  <w:LsdException Locked="true" Name="heading 6"/>
  <w:LsdException Locked="true" Name="heading 7"/>
  <w:LsdException Locked="true" Name="heading 8"/>
  <w:LsdException Locked="true" Name="heading 9"/>
  <w:LsdException Locked="true" Name="toc 1"/>
  <w:LsdException Locked="true" Name="toc 2"/>
  <w:LsdException Locked="true" Name="toc 3"/>
  <w:LsdException Locked="true" Name="toc 4"/>
  <w:LsdException Locked="true" Name="toc 5"/>
  <w:LsdException Locked="true" Name="toc 6"/>
  <w:LsdException Locked="true" Name="toc 7"/>
  <w:LsdException Locked="true" Name="toc 8"/>
  <w:LsdException Locked="true" Name="toc 9"/>
  <w:LsdException Locked="true" Name="header"/>
  <w:LsdException Locked="true" Name="footer"/>
  <w:LsdException Locked="true" Name="caption"/>
  <w:LsdException Locked="true" Name="Title"/>
  <w:LsdException Locked="true" Name="Body Text"/>
  <w:LsdException Locked="true" Name="Subtitle"/>
  <w:LsdException Locked="true" Name="Hyperlink"/>
  <w:LsdException Locked="true" Name="Strong"/>
  <w:LsdException Locked="true" Name="Emphasis"/>
  <w:LsdException Locked="true" Name="Table Grid"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1073750139 0 0 159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Верхний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Нижний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{mso-style-link:"Основной текст Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:14.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
span.a
	{mso-style-name:"Верхний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Верхний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a0
	{mso-style-name:"Нижний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Нижний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a1
	{mso-style-name:"Основной текст Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Основной текст";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
	{mso-footnote-separator:url("plat-por.files/header.htm") fs;
	mso-footnote-continuation-separator:url("plat-por.files/header.htm") fcs;
	mso-endnote-separator:url("plat-por.files/header.htm") es;
	mso-endnote-continuation-separator:url("plat-por.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:34.0pt 1.0cm 1.0cm 2.0cm;
	mso-header-margin:19.85pt;
	mso-footer-margin:35.45pt;
	mso-header:url("plat-por.files/header.htm") h1;
	mso-footer:url("plat-por.files/header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:Calibri;
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU link=blue vlink=purple style='tab-interval:36.0pt;text-justify-trim:
punctuation'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 style='width:42.5pt;border:solid windowtext 1.0pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>0401060</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Поступ. в банк плат.<o:p></o:p></span></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Списано со сч. плат.<o:p></o:p></span></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=57 valign=bottom style='width:42.5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:18.0pt'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal style='tab-stops:center 205.55pt'><b><span
  style='font-size:12.0pt'>ПЛАТЕЖНОЕ ПОРУЧЕНИЕ № <span style='mso-tab-count:
  1'> #(DocNumber)#</span><o:p></o:p></span></b></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>#(DocDate)#</o:p></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>электронно</o:p></p>
  </td>
  <td width=28 valign=bottom style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=26 valign=bottom style='width:19.85pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Дата<o:p></o:p></span></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Вид платежа<o:p></o:p></span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=26 valign=top style='width:19.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;border:none;mso-border-left-alt:
 solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:
 solid windowtext .5pt;mso-padding-alt:0cm 1.4pt 0cm 1.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:41.0pt'>
  <td width=76 valign=top style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal>Сумма</p>
  <p class=MsoNormal>прописью</p>
  </td>
  <td width=605 colspan=12 valign=top style='width:16.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:41.0pt;border:none' width=0 height=55></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сумма</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>#(RubSumm)#</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:2;page-break-inside:avoid;height:28.5pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  border-right:solid windowtext 1.0pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.5pt;border:none' width=0 height=38></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:3;page-break-inside:avoid;height:28.0pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;mso-border-top-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:4;page-break-inside:avoid;height:14.1pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.1pt'>
  <p class=MsoNormal>Плательщик</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.1pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:5;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:6;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:7;page-break-inside:avoid;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Банк плательщика</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:8;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:9;page-break-inside:avoid;height:14.65pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:solid windowtext 1.0pt;border-bottom:none;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.65pt;border:none' width=0 height=20></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:10;page-break-inside:avoid;height:14.6pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.6pt'>
  <p class=MsoNormal>Банк получателя</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.6pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:11;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:solid windowtext 1.0pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:12;page-break-inside:avoid;height:28.0pt'>
  <td width=378 colspan=6 rowspan=3 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:13;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Вид оп.</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:solid windowtext 1.0pt;border-left:
  none;border-bottom:none;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Срок плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;mso-border-top-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:14;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Наз. пл.</p>
  </td>
  <td width=76 style='width:2.0cm;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Очер. плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:15;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Получатель</p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Код</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Рез. поле</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:16;height:13.0pt'>
  <td width=170 colspan=2 valign=bottom style='width:127.6pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=113 colspan=2 valign=bottom style='width:3.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 colspan=3 valign=bottom style='width:99.25pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:17;height:69.55pt'>
  <td width=680 colspan=13 valign=top style='width:18.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:69.55pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:69.55pt;border:none' width=0 height=93></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:18;mso-yfti-lastrow:yes;height:13.65pt'>
  <td width=680 colspan=13 valign=bottom style='width:18.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.65pt'>
  <p class=MsoNormal>Назначение платежа</p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.65pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <![if !supportMisalignedColumns]>
 <tr height=0>
  <td width=76 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=76 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td style='border:none' width=0><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <![endif]>
</table>

<p class=MsoNormal style='margin-bottom:18.0pt;tab-stops:center 9.0cm left 14.0cm'><span
style='mso-tab-count:1'>                                                                                                         </span>Подписи<span
style='mso-tab-count:1'>                                                       </span>Отметки
банка</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=227 valign=bottom style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 rowspan=2 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:41.0pt'>
  <td width=227 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt;
  height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'>М.П.</p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/platpor.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s id=%request.Get("id")
 
 s (DocNumber,DocDate)=""
 
 s DocObj = ##class(Docs.Platejka).%OpenId(id)
 if $ISOBJECT(DocObj)
 {
	 s DocNumber=DocObj.Name
	 s DocDate=$ZD(DocObj.Dat,4)
	 s RubSumm = $J(DocObj.RubSumma,".",2)
	 
	 s Platelchik=DocObj.Kontr
	 if $ISOBJECT(Platelchik)
	 {
		 
	 }
	 
	 s Poluch=DocObj.Poluh
	 if $ISOBJECT(Poluch)
	 {
		 
	 }
 }
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="plat-por.files/filelist.xml">
<title>0401060</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>mvf</o:Author>
  <o:LastAuthor>Art</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:LastPrinted>2003-05-28T12:52:00Z</o:LastPrinted>
  <o:Created>2011-09-19T05:51:00Z</o:Created>
  <o:LastSaved>2011-09-19T05:51:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>61</o:Words>
  <o:Characters>354</o:Characters>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>414</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DoNotHyphenateCaps/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 пт</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 пт</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:Compatibility>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
  <w:LsdException Locked="true" Name="Normal"/>
  <w:LsdException Locked="true" Name="heading 1"/>
  <w:LsdException Locked="true" Name="heading 2"/>
  <w:LsdException Locked="true" Name="heading 3"/>
  <w:LsdException Locked="true" Name="heading 4"/>
  <w:LsdException Locked="true" Name="heading 5"/>
  <w:LsdException Locked="true" Name="heading 6"/>
  <w:LsdException Locked="true" Name="heading 7"/>
  <w:LsdException Locked="true" Name="heading 8"/>
  <w:LsdException Locked="true" Name="heading 9"/>
  <w:LsdException Locked="true" Name="toc 1"/>
  <w:LsdException Locked="true" Name="toc 2"/>
  <w:LsdException Locked="true" Name="toc 3"/>
  <w:LsdException Locked="true" Name="toc 4"/>
  <w:LsdException Locked="true" Name="toc 5"/>
  <w:LsdException Locked="true" Name="toc 6"/>
  <w:LsdException Locked="true" Name="toc 7"/>
  <w:LsdException Locked="true" Name="toc 8"/>
  <w:LsdException Locked="true" Name="toc 9"/>
  <w:LsdException Locked="true" Name="header"/>
  <w:LsdException Locked="true" Name="footer"/>
  <w:LsdException Locked="true" Name="caption"/>
  <w:LsdException Locked="true" Name="Title"/>
  <w:LsdException Locked="true" Name="Body Text"/>
  <w:LsdException Locked="true" Name="Subtitle"/>
  <w:LsdException Locked="true" Name="Hyperlink"/>
  <w:LsdException Locked="true" Name="Strong"/>
  <w:LsdException Locked="true" Name="Emphasis"/>
  <w:LsdException Locked="true" Name="Table Grid"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1073750139 0 0 159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Верхний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Нижний колонтитул Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	text-autospace:none;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{mso-style-link:"Основной текст Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	text-autospace:none;
	font-size:14.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
span.a
	{mso-style-name:"Верхний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Верхний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a0
	{mso-style-name:"Нижний колонтитул Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Нижний колонтитул";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.a1
	{mso-style-name:"Основной текст Знак";
	mso-style-noshow:yes;
	mso-style-locked:yes;
	mso-style-link:"Основной текст";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
	{mso-footnote-separator:url("plat-por.files/header.htm") fs;
	mso-footnote-continuation-separator:url("plat-por.files/header.htm") fcs;
	mso-endnote-separator:url("plat-por.files/header.htm") es;
	mso-endnote-continuation-separator:url("plat-por.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:34.0pt 1.0cm 1.0cm 2.0cm;
	mso-header-margin:19.85pt;
	mso-footer-margin:35.45pt;
	mso-header:url("plat-por.files/header.htm") h1;
	mso-footer:url("plat-por.files/header.htm") f1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:Calibri;
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU link=blue vlink=purple style='tab-interval:36.0pt;text-justify-trim:
punctuation'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 style='width:42.5pt;border:solid windowtext 1.0pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>0401060</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid'>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Поступ. в банк плат.<o:p></o:p></span></p>
  </td>
  <td width=47 valign=bottom style='width:35.45pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.25pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Списано со сч. плат.<o:p></o:p></span></p>
  </td>
  <td width=312 valign=bottom style='width:233.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=57 valign=bottom style='width:42.5pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal style='text-align:justify'><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:18.0pt'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal style='tab-stops:center 205.55pt'><b><span
  style='font-size:12.0pt'>ПЛАТЕЖНОЕ ПОРУЧЕНИЕ № <span style='mso-tab-count:
  1'>          </span><o:p></o:p></span></b></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=28 valign=bottom style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=26 valign=bottom style='width:19.85pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:18.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes'>
  <td width=342 valign=bottom style='width:256.55pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Дата<o:p></o:p></span></p>
  </td>
  <td width=19 valign=bottom style='width:14.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=132 valign=bottom style='width:99.2pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'>Вид платежа<o:p></o:p></span></p>
  </td>
  <td width=28 valign=top style='width:21.3pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=26 valign=top style='width:19.85pt;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;border:none;mso-border-left-alt:
 solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:
 solid windowtext .5pt;mso-padding-alt:0cm 1.4pt 0cm 1.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:41.0pt'>
  <td width=76 valign=top style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal>Сумма</p>
  <p class=MsoNormal>прописью</p>
  </td>
  <td width=605 colspan=12 valign=top style='width:16.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:41.0pt;border:none' width=0 height=55></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сумма</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:2;page-break-inside:avoid;height:28.5pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  border-right:solid windowtext 1.0pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.5pt;border:none' width=0 height=38></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:3;page-break-inside:avoid;height:28.0pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;mso-border-top-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:28.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:4;page-break-inside:avoid;height:14.1pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.1pt'>
  <p class=MsoNormal>Плательщик</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.1pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:5;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:6;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:7;page-break-inside:avoid;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Банк плательщика</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:8;page-break-inside:avoid;height:14.0pt'>
  <td width=378 colspan=6 rowspan=2 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>БИК</p>
  </td>
  <td width=246 colspan=5 style='width:184.25pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:14.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.0pt;border:none' width=0 height=19></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:9;page-break-inside:avoid;height:14.65pt'>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border-top:
  none;border-left:solid windowtext 1.0pt;border-bottom:none;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:14.65pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:14.65pt;border:none' width=0 height=20></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:10;page-break-inside:avoid;height:14.6pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:14.6pt'>
  <p class=MsoNormal>Банк получателя</p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:14.6pt;border:none' width=0 height=19></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:11;page-break-inside:avoid;height:13.0pt'>
  <td width=189 colspan=3 style='width:5.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal>ИНН<span style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=189 colspan=3 style='width:5.0cm;border-top:solid windowtext 1.0pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>КПП<span
  style='mso-spacerun:yes'>  </span></p>
  </td>
  <td width=57 colspan=2 rowspan=2 valign=top style='width:42.55pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Сч. №</p>
  </td>
  <td width=246 colspan=5 rowspan=2 valign=top style='width:184.25pt;
  border:none;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:12;page-break-inside:avoid;height:28.0pt'>
  <td width=378 colspan=6 rowspan=3 valign=top style='width:10.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:28.0pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <span style='font-size:10.0pt;font-family:"Times New Roman";mso-fareast-font-family:
  "Times New Roman";mso-ansi-language:RU;mso-fareast-language:RU;mso-bidi-language:
  AR-SA'><![if !supportMisalignedRows]>
  <td style='height:28.0pt;border:none' width=0 height=37></td>
  <![endif]></span>
 </tr>
 <tr style='mso-yfti-irow:13;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Вид оп.</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:solid windowtext 1.0pt;border-left:
  none;border-bottom:none;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Срок плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;mso-border-top-alt:
  solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:14;page-break-inside:avoid;height:13.5pt'>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Наз. пл.</p>
  </td>
  <td width=76 style='width:2.0cm;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Очер. плат.</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:15;height:13.5pt'>
  <td width=378 colspan=6 valign=bottom style='width:10.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal>Получатель</p>
  </td>
  <td width=57 colspan=2 style='width:42.55pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Код</p>
  </td>
  <td width=76 style='width:2.0cm;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=76 colspan=2 style='width:2.0cm;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'>Рез. поле</p>
  </td>
  <td width=94 colspan=2 style='width:70.85pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.5pt'>
  <p class=MsoNormal style='margin-left:2.85pt'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.5pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:16;height:13.0pt'>
  <td width=170 colspan=2 valign=bottom style='width:127.6pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=113 colspan=2 valign=bottom style='width:3.0cm;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=132 colspan=3 valign=bottom style='width:99.25pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=95 colspan=2 valign=bottom style='width:70.9pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=38 valign=bottom style='width:1.0cm;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0cm 1.4pt 0cm 1.4pt;
  height:13.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.0pt;border:none' width=0 height=17></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:17;height:69.55pt'>
  <td width=680 colspan=13 valign=top style='width:18.0cm;border:none;
  padding:0cm 1.4pt 0cm 1.4pt;height:69.55pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:69.55pt;border:none' width=0 height=93></td>
  <![endif]>
 </tr>
 <tr style='mso-yfti-irow:18;mso-yfti-lastrow:yes;height:13.65pt'>
  <td width=680 colspan=13 valign=bottom style='width:18.0cm;border:none;
  border-bottom:solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:13.65pt'>
  <p class=MsoNormal>Назначение платежа</p>
  </td>
  <![if !supportMisalignedRows]>
  <td style='height:13.65pt;border:none' width=0 height=18></td>
  <![endif]>
 </tr>
 <![if !supportMisalignedColumns]>
 <tr height=0>
  <td width=76 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=95 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=19 style='border:none'></td>
  <td width=76 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td width=57 style='border:none'></td>
  <td width=38 style='border:none'></td>
  <td style='border:none' width=0><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <![endif]>
</table>

<p class=MsoNormal style='margin-bottom:18.0pt;tab-stops:center 9.0cm left 14.0cm'><span
style='mso-tab-count:1'>                                                                                                         </span>Подписи<span
style='mso-tab-count:1'>                                                       </span>Отметки
банка</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='margin-left:1.4pt;border-collapse:collapse;mso-padding-alt:0cm 1.4pt 0cm 1.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid'>
  <td width=227 valign=bottom style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
  <td width=227 rowspan=2 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:41.0pt'>
  <td width=227 valign=top style='width:6.0cm;padding:0cm 1.4pt 0cm 1.4pt;
  height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'>М.П.</p>
  </td>
  <td width=227 valign=bottom style='width:6.0cm;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0cm 1.4pt 0cm 1.4pt;height:41.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/prih.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s docid=%request.Get("id")
 s doc=##class(Docs.Prih).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name
 . s docdate=doc.Dat
 . d:docdate'=""
 . . s docdate=$ZD(docdate,4)
 . . s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 . s kontr=doc.Kontr
 . d:$ISOBJECT(kontr)
 . . s kname=doc.Kontr.Name
 . . s kaddr=doc.Kontr.Address
 . . s bank=doc.Kontr.bank
 . . d:$ISOBJECT(bank)
 . . . s pbank=bank.pbank
 . . . s city=bank.city
 . . . s kpp=bank.kpp
 . . . s inn=bank.inn
 . . . s bik=bank.bik
 . . . s rsch=bank.rsch
 . . . s ksch=bank.ksch
 . . . s code=bank.code
 . . . s okpo=bank.okpo
 s kurs=##class(Goods.GoodsAction).kurs(.other)
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 i nds'=0 s antinds=1/(1+nds)
 e  s antinds=1
 i nsp'=0 s antinsp=1/(1+nsp)
 e  s antinsp=1
 s docname2=##class(Docs.Action).GetDocNameFromClass("Docs.Prih")
</script>
<html>

<head>
<title>#(docname2)#</title>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<style id="Приходная накл_3173_Styles">
<!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
.xl153173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial;
	mso-generic-font-family:auto;
	mso-font-charset:0;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl223173
	{color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl233173
	{color:windowtext;
	font-size:10.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl243173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl253173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl263173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl273173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl283173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl293173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl303173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl313173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl323173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl333173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl343173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl353173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:10.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl363173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl373173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl383173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl393173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl403173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl413173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl423173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:center-across;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl433173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl443173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl453173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl463173
	{color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl473173
	{color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl483173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl493173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl503173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl513173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl523173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:general;
	vertical-align:bottom;
	border:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl533173
	{color:windowtext;
	font-size:8.5pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl543173
	{color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;
	padding-left:12px;
	mso-char-indent-count:1;}
.xl553173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl563173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:"Arial Cyr", sans-serif;
	mso-font-charset:204;
	mso-number-format:Fixed;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl573173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl583173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:italic;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl593173
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
-->
</style>
</head>

<body>

<table x:str border=0 cellpadding=0 cellspacing=0 width=981 class=xl333173
 style='border-collapse:collapse;table-layout:fixed;width:735pt'>
 <col class=xl333173 width=47 style='mso-width-source:userset;mso-width-alt:
 1718;width:35pt'>
 <col class=xl333173 width=128 style='mso-width-source:userset;mso-width-alt:
 4681;width:96pt'>
 <col class=xl333173 width=108 style='mso-width-source:userset;mso-width-alt:
 3949;width:81pt'>
 <col class=xl333173 width=363 style='mso-width-source:userset;mso-width-alt:
 13275;width:272pt'>
 <col class=xl333173 width=40 style='mso-width-source:userset;mso-width-alt:
 1462;width:30pt'>
 <col class=xl333173 width=51 style='mso-width-source:userset;mso-width-alt:
 1865;width:38pt'>
 <col class=xl333173 width=59 style='mso-width-source:userset;mso-width-alt:
 2157;width:44pt'>
 <col class=xl333173 width=80 style='mso-width-source:userset;mso-width-alt:
 2925;width:60pt'>
 <col class=xl333173 width=105 style='mso-width-source:userset;mso-width-alt:
 3840;width:79pt'>
 <tr class=xl293173 height=21 style='height:15.75pt'>
  <td height=21 class=xl223173 colspan=4 width=646 style='height:15.75pt;
  width:484pt'> Накладная на поступление № #($G(docname))# от #($G(docdate))# г. <!-- по счету на покупку N 361 от 17.05.2005 -->
 </td>
  <td class=xl273173 width=40 style='width:30pt'></td>
  <td class=xl283173 width=51 style='width:38pt'></td>
  <td class=xl283173 width=59 style='width:44pt'></td>
  <td class=xl283173 width=80 style='width:60pt'></td>
  <td class=xl283173 width=105 style='width:79pt'></td>
 </tr>
 <!--
 <tr class=xl293173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 colspan=3 style='height:12.75pt'><span
  style="mso-spacerun: yes">              </span>действительна до 20 мая 2005
  г.</td>
  <td class=xl303173></td>
  <td class=xl313173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
 </tr>
 -->
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 style='height:12.75pt'></td>
  <td class=xl223173></td>
  <td class=xl233173></td>
  <td class=xl323173></td>
  <td class=xl323173></td>
  <td class=xl323173></td>
  <td class=xl323173></td>
  <td class=xl323173></td>
  <td class=xl323173></td>
 </tr>
 <tr class=xl293173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 colspan=9 style='height:12.75pt'>Поставщик: #($G(kname))#</td>
 </tr>
 <tr class=xl293173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 style='height:12.75pt' colspan=9>Адрес: #($G(kaddr))#</td>
 </tr>
 <tr class=xl293173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 colspan=9 style='height:12.75pt'>#($G(pbank))# #($G(city))# Р/С #($G(rsch))#, БИК #($G(bik))# </td>
 </tr>
 <tr class=xl293173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 colspan=2 style='height:12.75pt'>К/С #($G(ksch))#,ИНН #($G(inn))#</td>
 </tr>
 <!--
 <tr class=xl253173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 colspan=4 style='height:12.75pt'>Представитель Мартиросова К.В.</td>
  <td class=xl353173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
 </tr>
 -->
 <tr class=xl253173 height=17 style='height:12.75pt'>
  <td height=17 class=xl223173 style='height:12.75pt'></td>
  <td class=xl223173></td>
  <td class=xl233173></td>
  <td class=xl283173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
  <td class=xl253173></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl363173 style='height:12.0pt'>N п/п</td>
  <td class=xl363173 style='border-left:none'>Артикул</td>
  <td class=xl363173 style='border-left:none'>Код</td>
  <td class=xl363173 style='border-left:none'>Наименование</td>
  <td class=xl373173 style='border-left:none'>Кол-во</td>
  <td class=xl373173 style='border-left:none'>Цена.</td>
  <td class=xl373173 style='border-left:none'>Сумма</td>
  <td class=xl373173 style='border-left:none'>Цена(руб.)</td>
  <td class=xl373173 style='border-left:none'>Сумма(руб.)</td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl383173 style='height:12.0pt;border-top:none'>&nbsp;</td>
  <td class=xl383173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl393173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl403173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl413173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl373173 style='border-top:none;border-left:none'><a
  name="RANGE!R11C6"><span style="mso-spacerun: yes"> </span>за ед.</a></td>
  <td class=xl423173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl423173 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl423173 style='border-top:none;border-left:none'>&nbsp;</td>
 </tr>
<script language="cache" runat="server">
 s tot=0,totquant=0,totch=0
 d:$ISOBJECT(doc.Items)
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . s quant=item.Quantity
 . . s total=$J(item.Total,".",2)
 . . s price=$J(item.Price,".",2)
 . . s totquant=totquant+quant
 . . s tot=tot+total
 . . s pricechanged=$J(price*kurs,".",2)
 . . s totchanged=$J(total*kurs,".",2)
 . . s totch=totch+totchanged
 . . w "<tr class=xl253173 height=15 style='height:11.25pt'>"
 . . w "<td height=15 class=xl433173 style='height:11.25pt;border-top:none'>"_count_"</td>"
 . . w "<td class=xl433173 style='border-top:none;border-left:none' x:num>4</td>"
 . . w "<td class=xl443173 style='border-top:none;border-left:none'></td>"
 . . w "<td class=xl443173 style='border-top:none;border-left:none'  >"_goods_"</td>"
 . . w "<td class=xl453173 align=right style='border-top:none;border-left:none' >"_quant_"</td>"
 . . w "<td class=xl453173 align=right style='border-top:none;border-left:none' >"_price_"</td>"
 . . w "<td class=xl453173 align=right style='border-top:none;border-left:none' >"_total_"</td>"
 . . w "<td class=xl453173 align=right style='border-top:none;border-left:none' >"_pricechanged_"</td>"
 . . w "<td class=xl453173 align=right style='border-top:none;border-left:none' >"_totchanged_"</td>"
 . . w "</tr>"
 s totch=$J(totch,".",2)
 s tot=$J(tot,".",2)
 s totnds=$J(totch-(totch*antinds),".",2)
 s totnsp=$J(totch-(totch*antinsp),".",2)
 s ^mtempArt("totch")=totch
</script>

 <tr class=xl253173 height=17 style='height:12.75pt'>
  <td height=17 class=xl463173 colspan=2 style='height:12.75pt'>Итого по документу</td>
  <td class=xl483173>&nbsp;</td>
  <td class=xl483173>&nbsp;</td>
  <td class=xl493173>&nbsp;</td>
  <td class=xl503173>&nbsp;</td>
  <td class=xl513173 align=right >#($G(tot))#</td>
  <td class=xl513173>&nbsp;</td>
  <td class=xl523173 align=right >#($G(totch))#</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl533173 style='height:11.25pt'></td>
  <td class=xl533173></td>
  <td class=xl333173></td>
  <td class=xl253173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl543173 colspan=2 style='height:12.0pt'>Итого наименований</td>
  <td class=xl333173 align=right>#(count)#</td>
  <td class=xl243173></td>
  <td class=xl343173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl543173 colspan=2 style='height:12.0pt'>Сумма к оплате</td>
  <td class=xl293173 colspan=2> (#(totch)# руб.)</td>
  <td class=xl563173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl543173 colspan=2 style='height:12.0pt'>Включая НДС</td>
  <td class=xl333173 colspan=7>#(totnds)# руб.</td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl543173 colspan=2 style='height:12.0pt'>Включая НП</td>
  <td class=xl333173>#(totnsp)# руб.</td>
  <td class=xl553173></td>
  <td class=xl563173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
  <td class=xl283173></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl573173 style='height:12.75pt'></td>
  <td class=xl573173></td>
  <td class=xl333173></td>
  <td class=xl583173>Отпустил ___________________</td>
  <td class=xl593173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl333173 style='height:12.75pt'></td>
  <td class=xl333173></td>
  <td class=xl333173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl333173 style='height:12.75pt'></td>
  <td class=xl333173></td>
  <td class=xl333173></td>
  <td class=xl583173>Получил<span style="mso-spacerun: yes"> 
  </span>___________________</td>
  <td class=xl583173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
  <td class=xl153173></td>
 </tr>
 
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/prihorder.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.PrihKassOrder).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s:$ISOBJECT(obj.User1) usr=obj.User1.Name
 . s numb=obj.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=$G(mn(+$P($ZD(obj.Dat,4),"/",2)))
 . s year=$P($ZD(obj.Dat,4),"/",3)
 . s dat=$ZD(obj.Dat,4)
 . s poluh=obj.Poluh
 . s plat=obj.Plat
 . i $ISOBJECT(poluh) d
 . . s poluhName=poluh.Name
 . i $ISOBJECT(Kontr) d
 . . s Kontr=Kontr.Name
 . s reason=obj.Reason
 . d:$ISOBJECT(obj.bank)
 . . //s okpo=
 //s ^mtempArt=platName
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<link href="prihorder.css" type=text/css rel=stylesheet>
<link href="screen/prihorder.css" type=text/css rel=stylesheet>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">

</head>

<body>

<div id="Прихкассор_3614" align=center x:publishsource="Excel">

<table x:str border=0 cellpadding=0 cellspacing=0 width=967 class=xl233614
 style='border-collapse:collapse;table-layout:fixed;width:695pt'>
 <col class=xl233614 width=7 span=87 style='mso-width-source:userset;
 mso-width-alt:224;width:5pt'>
 <col class=xl233614 width=19 style='mso-width-source:userset;mso-width-alt:
 608;width:14pt'>
 <col class=xl233614 width=8 style='mso-width-source:userset;mso-width-alt:
 256;width:6pt'>
 <col class=xl233614 width=3 style='mso-width-source:userset;mso-width-alt:
 96;width:2pt'>
 <col class=xl233614 width=7 span=32 style='mso-width-source:userset;
 mso-width-alt:224;width:5pt'>
 <col class=xl233614 width=5 style='mso-width-source:userset;mso-width-alt:
 160;width:4pt'>
 <col class=xl233614 width=7 span=4 style='mso-width-source:userset;mso-width-alt:
 224;width:5pt'>
 <col class=xl233614 width=5 style='mso-width-source:userset;mso-width-alt:
 160;width:4pt'>
 <col class=xl233614 width=9 span=2 style='mso-width-source:userset;mso-width-alt:
 288;width:7pt'>
 <col class=xl233614 width=7 style='mso-width-source:userset;mso-width-alt:
 224;width:5pt'>
 <col class=xl233614 width=5 style='mso-width-source:userset;mso-width-alt:
 160;width:4pt'>
 <col class=xl233614 width=9 style='mso-width-source:userset;mso-width-alt:
 288;width:7pt'>
 <col class=xl233614 width=7 style='mso-width-source:userset;mso-width-alt:
 224;width:5pt'>
 <col class=xl233614 width=12 style='mso-width-source:userset;mso-width-alt:
 384;width:9pt'>
 <col class=xl233614 width=8 style='mso-width-source:userset;mso-width-alt:
 256;width:6pt'>
 <tr height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl233614 width=7 style='height:11.1pt;width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl283614 colspan=25 width=175 style='width:125pt'>Унифицированная
  форма № КО-1</td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl253614 width=19 style='width:14pt'>&nbsp;</td>
  <td class=xl233614 width=8 style='width:6pt'></td>
  <td class=xl243614 width=3 style='width:2pt'>&nbsp;</td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=5 style='width:4pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=5 style='width:4pt'></td>
  <td class=xl233614 width=9 style='width:7pt'></td>
  <td class=xl233614 width=9 style='width:7pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=5 style='width:4pt'></td>
  <td class=xl233614 width=9 style='width:7pt'></td>
  <td class=xl233614 width=7 style='width:5pt'></td>
  <td class=xl233614 width=12 style='width:9pt'></td>
  <td class=xl233614 width=8 style='width:6pt'></td>
 </tr>
 <tr height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl233614 style='height:11.1pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl283614 colspan=30>Утверждена постановлением Госкомстата</td>
  <td class=xl253614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.95pt'>
  <td height=17 class=xl233614 style='height:12.95pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl443614 colspan=20>России от 18.08.98 г. № 88</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl253614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl693614>&nbsp;</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl233614 style='height:11.25pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl563614>(организация)</td>
 </tr>
 <tr height=25 style='mso-height-source:userset;height:18.75pt'>
  <td height=25 class=xl233614 style='height:18.75pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=16 class=xl943614>Код</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
 </tr>
 <tr height=25 style='mso-height-source:userset;height:18.75pt'>
  <td height=25 class=xl233614 style='height:18.75pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl333614 colspan=15>Форма по ОКУД</td>
  <td class=xl233614></td>
  <td colspan=16 class=xl913614 style='border-right:1.0pt solid black'>0310001</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl1023614>КВИТАНЦИЯ</td>
 </tr>
 <tr height=25 style='mso-height-source:userset;height:18.75pt'>
  <td colspan=58 height=25 class=xl523614 style='height:18.75pt'>#($G(poluhName))#</td>
  <td class=xl233614></td>
  <td class=xl333614 colspan=9>по ОКПО</td>
  <td class=xl233614></td>
  <td colspan=16 class=xl883614 style='border-right:1.0pt solid black'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl253614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=11 style='mso-height-source:userset;height:8.45pt'>
  <td height=11 class=xl323614 style='height:8.45pt'></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl433614 colspan=9>(организация)</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl293614></td>
  <td class=xl233614></td>
  <td colspan=16 rowspan=2 class=xl953614 style='border-right:1.0pt solid black;
  border-bottom:1.0pt solid black'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl253614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.95pt'>
  <td colspan=69 height=17 class=xl533614 style='border-right:1.0pt solid black;
  height:12.95pt'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl253614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=32>к приходному кассовому ордеру № </td>
  <td colspan=13 class=xl693614>&nbsp;#($g(numb))#</td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl233614 style='height:12.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl303614 colspan=18>(структурное подразделение)</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td rowspan=19 class=xl1033614>Л<br>и<br>н<br>и<br>я<br><br><br>о<br>т<br>р<br>е<br>з<br>а</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=3 >от </td>
  <td class=xl333614>«</td>
  <td colspan=3 class=xl693614>#($G(day))#</td>
  <td class=xl403614 colspan=2>»</td>
  <td colspan=13 class=xl693614>#($G(month))#</td>
  <td class=xl393614></td>
  <td colspan=7 class=xl693614>#($G(year))#</td>
  <td class=xl393614 colspan=3>г.</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=39 style='mso-height-source:userset;height:29.25pt'>
  <td height=39 class=xl233614 style='height:29.25pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=13 class=xl873614 width=91 style='width:65pt'>Номер документа</td>
  <td colspan=13 class=xl873614 width=91 style='border-left:none;width:65pt'>Дата
  составления</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=10>Принято от</td>
  <td class=xl323614></td>
  <td colspan=34 class=xl503614>#($G(Kontr))#</td>
 </tr>
 <tr height=24 style='mso-height-source:userset;height:18.0pt'>
  <td height=24 class=xl233614 style='height:18.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl383614 colspan=34>ПРИХОДНЫЙ КАССОВЫЙ ОРДЕР</td>
  <td class=xl233614></td>
  <td colspan=13 class=xl843614>#($G(numb))#</td>
  <td colspan=13 class=xl853614 style='border-right:1.0pt solid black;border-left:none'>#($G(dat))#</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl503614>&nbsp;</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl233614 style='height:15.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl393614 colspan=11>Основание:</td>
  <td colspan=34 class=xl503614>#($G(reason))#</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td colspan=7 rowspan=4 height=80 class=xl463614 style='height:60.0pt'>Дебет</td>
  <td colspan=41 class=xl573614 style='border-left:none'>Кредит</td>
  <td colspan=18 rowspan=4 class=xl703614 width=126 style='width:90pt'>Сумма,
  руб. коп.</td>
  <td colspan=13 rowspan=4 class=xl703614 width=91 style='width:65pt'>Код
  целевого назначения</td>
  <td colspan=6 rowspan=4 class=xl593614 width=42 style='border-right:.5pt solid black;
  border-bottom:.5pt solid black;width:30pt'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl503614>&nbsp;</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td colspan=5 rowspan=3 height=60 class=xl593614 width=35 style='border-right:
  .5pt solid black;border-bottom:.5pt solid black;height:45.0pt;width:25pt'>&nbsp;</td>
  <td colspan=13 rowspan=3 class=xl483614 width=91 style='width:65pt'>код
  структур- ного подраз- деления</td>
  <td colspan=12 rowspan=3 class=xl483614 width=84 style='width:60pt'>корреспон-
  дирующий счет, субсчет</td>
  <td colspan=11 rowspan=3 class=xl483614 width=77 style='width:55pt'>код
  аналити- ческого учета</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl513614>&nbsp;</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl233614 style='height:15.0pt'></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl513614>&nbsp;</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl233614 style='height:15.0pt'></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td colspan=7 rowspan=2 height=37 class=xl463614 style='height:27.75pt'>&nbsp;</td>
  <td colspan=5 rowspan=2 class=xl463614>&nbsp;</td>
  <td colspan=13 rowspan=2 class=xl453614 width=91 style='width:65pt'>&nbsp;</td>
  <td colspan=12 rowspan=2 class=xl483614 width=84 style='width:60pt'>&nbsp;</td>
  <td colspan=11 rowspan=2 class=xl453614 width=77 style='width:55pt'>&nbsp;</td>
  <td colspan=18 rowspan=2 class=xl723614 style='border-right:.5pt solid black;
  border-bottom:.5pt solid black'>&nbsp;</td>
  <td colspan=13 rowspan=2 class=xl783614 style='border-right:.5pt solid black;
  border-bottom:.5pt solid black'>&nbsp;</td>
  <td colspan=6 rowspan=2 class=xl463614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=21 style='mso-height-source:userset;height:15.75pt'>
  <td height=21 class=xl233614 style='height:15.75pt'></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=7>Сумма</td>
  <td colspan=24 class=xl683614>&nbsp;</td>
  <td class=xl323614></td>
  <td class=xl323614 colspan=5>руб.</td>
  <td colspan=3 class=xl693614>&nbsp;</td>
  <td class=xl323614></td>
  <td class=xl323614 colspan=4>коп.</td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl233614 style='height:15.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td colspan=25 class=xl553614>(цифрами)</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl323614 colspan=10 style='height:15.0pt'>Принято от</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=73 class=xl473614>#($G(Kontr))#</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl473614>&nbsp;</td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl223614 style='height:9.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl1013614>(прописью)</td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl323614 colspan=11 style='height:12.75pt'>Основание: #($G(reason))#</td>

  <td class=xl233614></td>
  <td colspan=73 class=xl473614>#($G(reason))#</td>
  
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=45 class=xl473614>&nbsp;</td>
 </tr>
 <tr height=27 style='mso-height-source:userset;height:20.25pt'>
  <td colspan=85 height=27 class=xl503614 style='height:20.25pt'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td colspan=31 class=xl513614>&nbsp;</td>
  <td class=xl373614 style='border-top:none'>&nbsp;</td>
  <td class=xl323614 colspan=4>руб.</td>
  <td class=xl373614 style='border-top:none'>&nbsp;</td>
  <td colspan=3 class=xl1043614>&nbsp;</td>
  <td class=xl373614 style='border-top:none'>&nbsp;</td>
  <td class=xl323614 colspan=4>коп.</td>
 </tr>
 <tr height=27 style='mso-height-source:userset;height:20.25pt'>
  <td height=27 class=xl323614 colspan=7 style='height:20.25pt'>Сумма</td>
  <td colspan=78 class=xl513614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl263614 style='border-left:none'>&nbsp;</td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=11>В том числе</td>
  <td colspan=34 class=xl503614>&nbsp;</td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl223614 style='height:9.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=78 class=xl1013614>(прописью)</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td colspan=61 height=16 class=xl503614 style='height:12.0pt'>&nbsp;</td>
  <td class=xl323614></td>
  <td class=xl323614 colspan=5>руб.</td>
  <td colspan=11 class=xl693614>&nbsp;</td>
  <td class=xl323614></td>
  <td class=xl323614 colspan=5>коп.</td>
  <td class=xl323614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl333614>«</td>
  <td colspan=3 class=xl693614>&nbsp;</td>
  <td class=xl403614 colspan=2>»</td>
  <td colspan=13 class=xl693614>&nbsp;</td>
  <td class=xl393614></td>
  <td colspan=7 class=xl693614>&nbsp;</td>
  <td class=xl393614 colspan=3><span style='mso-spacerun:yes'> </span>г.</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=26 style='mso-height-source:userset;height:19.5pt'>
  <td height=26 class=xl323614 colspan=11 style='height:19.5pt'>В том числе</td>
  <td class=xl233614></td>
  <td colspan=73 class=xl503614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl233614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl343614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=27 style='mso-height-source:userset;height:20.25pt'>
  <td height=27 class=xl323614 colspan=12 style='height:20.25pt'>Приложение</td>
  <td colspan=73 class=xl513614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl363614 colspan=14>М.П. (штампа)</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=9 style='mso-height-source:userset;height:6.75pt'>
  <td height=9 class=xl223614 style='height:6.75pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=20 style='mso-height-source:userset;height:15.0pt'>
  <td height=20 class=xl323614 colspan=17 style='height:15.0pt'>Главный
  бухгалтер</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=18 class=xl693614>&nbsp;</td>
  <td class=xl413614></td>
  <td class=xl413614></td>
  <td class=xl413614></td>
  <td colspan=27 class=xl693614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=17>Главный бухгалтер</td>
  <td colspan=12 class=xl693614>&nbsp;</td>
  <td class=xl323614></td>
  <td colspan=15 class=xl693614>&nbsp;</td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl223614 style='height:9.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=18 class=xl1013614>(подпись)</td>
  <td class=xl313614></td>
  <td class=xl313614></td>
  <td class=xl313614></td>
  <td colspan=27 class=xl1013614>(расшифровка подписи)</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl223614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td colspan=12 class=xl1013614>(подпись)</td>
  <td class=xl323614></td>
  <td colspan=15 class=xl1013614>(расшифровка подписи)</td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl323614 colspan=15 style='height:13.5pt'>Получил кассир</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=18 class=xl693614>&nbsp;</td>
  <td class=xl413614></td>
  <td class=xl413614></td>
  <td class=xl413614></td>
  <td colspan=27 class=xl693614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614 colspan=7>Кассир</td>
  <td class=xl323614></td>
  <td colspan=12 class=xl693614>&nbsp;</td>
  <td class=xl323614></td>
  <td colspan=20 class=xl693614>&nbsp;</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl223614 style='height:9.0pt'></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td colspan=18 class=xl1013614>(подпись)</td>
  <td class=xl313614></td>
  <td class=xl313614></td>
  <td class=xl313614></td>
  <td colspan=27 class=xl1013614>(расшифровка подписи)</td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl353614 style='border-left:none'>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl243614>&nbsp;</td>
  <td class=xl233614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td colspan=12 class=xl1013614>(подпись)</td>
  <td class=xl323614></td>
  <td colspan=20 class=xl1013614>(расшифровка подписи)</td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
  <td class=xl323614></td>
 </tr>
</table>

</div>

</body>

</html>
]]></CSP>


<CSP name="screen/rash.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Rash).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . //s:$ISOBJECT(obj.User1) usr=obj.User1.Name
 . d:$ISOBJECT(obj.Kontr)
 . . s kontr=obj.Kontr.Name
 . s numb=obj.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=$P($ZD(obj.Dat,4),"/",2)
 . s year=$P($ZD(obj.Dat,4),"/",3)
 . s docdat=day_"."_month_"."_year
 . s kurs=obj.kurs
 . if $ISOBJECT(obj.Source) s SourceInstrName=obj.Source.Name,SourceInstrDat=$ZD(obj.Source.Dat,4)
 s cday=$P($ZD(+$H,4),"/",1)
 s cmonth=$P($ZD(+$H,4),"/",2)
 s cyear=$P($ZD(+$H,4),"/",3)
 s curdat=cday_"."_cmonth_"."_cyear
 s curtime=$ZT($P($H,",",2))

 s docname=##class(Docs.Action).GetDocNameFromClass("Docs.Rash")
 
 
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 </script>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>#(docname)#</title>
<style id="Склад1_17352_Styles"><!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
.xl1517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl1917352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2017352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2117352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2217352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:top;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2317352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2417352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2617352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:top;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2717352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
.xl2817352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2917352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3017352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3117352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3217352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3317352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3417352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
.xl3617352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
--></style>
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=1013 style='border-collapse:
 collapse;table-layout:fixed;width:763pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=107 style='mso-width-source:userset;mso-width-alt:4565;width:80pt'>
 <col width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col width=42 style='mso-width-source:userset;mso-width-alt:1792;width:32pt'>
 <col width=48 style='mso-width-source:userset;mso-width-alt:2048;width:36pt'>
 <col width=50 style='mso-width-source:userset;mso-width-alt:2133;width:38pt'>
 <col width=8 style='mso-width-source:userset;mso-width-alt:341;width:6pt'>
 <col width=4 style='mso-width-source:userset;mso-width-alt:170;width:3pt'>
 <col width=6 style='mso-width-source:userset;mso-width-alt:256;width:5pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=25 style='mso-width-source:userset;mso-width-alt:1066;width:19pt'>
 <col width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <col width=44 style='mso-width-source:userset;mso-width-alt:1877;width:33pt'>
 <col width=49 style='mso-width-source:userset;mso-width-alt:2090;width:37pt'>
 <col width=3 span=2 style='mso-width-source:userset;mso-width-alt:128;
 width:2pt'>
 <col width=5 style='mso-width-source:userset;mso-width-alt:213;width:4pt'>
 <col width=18 style='mso-width-source:userset;mso-width-alt:768;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=32 style='mso-width-source:userset;mso-width-alt:1365;width:24pt'>
 <col width=35 style='mso-width-source:userset;mso-width-alt:1493;width:26pt'>
 <col width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col width=6 style='mso-width-source:userset;mso-width-alt:256;width:5pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <tr height=17 style='mso-height-source:userset;height:12.95pt'>
  <td height=17 class=xl1917352 colspan=2 width=126 style='height:12.95pt;
  width:94pt'><a name="RANGE!R1C1:R12C29">Офис</a></td>
  <td class=xl1517352 width=30 style='width:23pt'></td>
  <td class=xl1517352 width=42 style='width:32pt'></td>
  <td class=xl1517352 width=48 style='width:36pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=50 style='width:38pt'></td>
  <td class=xl1517352 width=8 style='width:6pt'></td>
  <td class=xl2017352 width=4 style='width:3pt'>&nbsp;</td>
  <td class=xl1517352 width=6 style='width:5pt'></td>
  <td class=xl1917352 colspan=2 width=129 style='width:97pt'>Склад</td>
  <td class=xl1517352 width=25 style='width:19pt'></td>
  <td class=xl1517352 width=37 style='width:28pt'></td>
  <td class=xl1517352 colspan=2 width=93 style='width:70pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=3 style='width:2pt'></td>
  <td class=xl2017352 width=3 style='width:2pt'>&nbsp;</td>
  <td class=xl1517352 width=5 style='width:4pt'></td>
  <td class=xl1917352 colspan=2 width=128 style='width:97pt'>На упаковку</td>
  <td class=xl1517352 colspan=2 width=67 style='width:50pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=7 style='width:5pt'></td>
  <td class=xl2017352 width=3 style='width:2pt'>&nbsp;</td>
  <td class=xl1517352 width=6 style='width:5pt'></td>
  <td class=xl1917352 colspan=2 width=129 style='width:97pt'>В Упаковку</td>
  <td class=xl1517352 colspan=2 width=64 style='width:48pt'>#($G(curdat))#</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl1917352 style='height:9.0pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td colspan=2 class=xl3217352>#($g(usr))#</td>
  <td class=xl1517352></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl1917352 colspan=3 style='height:12.75pt'>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl1517352 style='height:12.75pt' colspan=6>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=6>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=5>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=3>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
 </tr>
 <tr height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 class=xl1917352 colspan=5 style='height:10.5pt'>Кому #($g(kontr))#</td>
  <td class=xl2217352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=5>Кому #($g(kontr))#</td>
  <td class=xl2217352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=5>Кому #($g(kontr))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=4>Кому #($g(kontr))#</span></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl1517352 style='height:12.0pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <tr height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl2317352 style='height:11.1pt'>№</td>
  <td class=xl2317352 style='border-left:none' x:str="Наименование " colspan=4>Наименование</td>
  <td class=xl2317352 style='border-left:none'>Кол</td>
  <!--
  <td class=xl2317352 style='border-left:none'>Цена</td>
  <td class=xl2317352 style='border-left:none'>Цена(р)</td>
  <td class=xl2317352 style='border-left:none'>Сумма</td>
  -->
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td class=xl2317352 style='border-left:none' x:str="Наименование " colspan=4>Наименование</td>
  <td class=xl2317352 style='border-left:none'>Кол</td>
  <!--
  <td class=xl2317352 style='border-left:none'>Цена</td>
  <td class=xl2317352 style='border-left:none'>Цена(р<span style='display:none'>)</span></td>
  <td class=xl2317352 style='border-left:none'>Сумма</td>
  -->
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td colspan=2 class=xl3317352 style='border-right:1.0pt solid black;
  border-left:none' x:str="Наименование ">Наименование </td>
  <td class=xl2317352 style='border-left:none'>Уп</td>
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td colspan=2 class=xl3317352 style='border-right:1.0pt solid black;
  border-left:none' x:str="Наименование ">Наименование </td>
  <td class=xl2317352 style='border-left:none'>Уп</td>
 </tr>
 
<script language="cache" runat="server">
 d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=obj.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . if $ISOBJECT(item.ZakazGoods) s ZakazGoods=item.ZakazGoods.FullName
 . . else  s ZakazGoods=""
 . . 
 . . if ZakazGoods'="",ZakazGoods'=goods s GoodsString=ZakazGoods_" ("_goods_")"
 . . else  s GoodsString=goods
 . . 
 . . s quant=item.Quantity
 . . s total=$J(item.Total,".",2)
 . . s price=$J(item.Price,".",2)
 . . s totquant=totquant+quant
 . . s tot=tot+total
 . . s pricechanged=$J(price*kurs,".",2)
 . . w "<tr class=xl1517352>"
 . . w "<td class=xl2617352>"_count_"</td>"
 . . w "<td class=xl2717352 width=107 style='border-left:none;width:80pt' colspan=4>"_GoodsString_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_quant_"</td>"
 . . //w "<td class=xl2817352 style='border-left:none'>"_price_"</td>"
 . . //w "<td class=xl2817352 style='border-left:none'>"_pricechanged_"</td>"
 . . //w "<td class=xl2917352 style='border-left:none'>"_total_"</td>"
 . . w "<td class=xl3017352></td>"
 . . w "<td class=xl3117352>&nbsp;</td>"
 . . w "<td class=xl3017352></td>"
 . . w "<td class=xl2617352>"_count_"</td>"
 . . w "<td class=xl2717352 width=110 style='border-left:none;width:83pt' colspan=4>"_GoodsString_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_quant_"</td>"
 . . //w "<td class=xl2817352 style='border-left:none'>"_price_"</td>"
 . . //w "<td class=xl2817352 style='border-left:none'>"_pricechanged_"</td>"
 . . //w "<td class=xl2917352 style='border-left:none'>"_total_"</td>"
 . . w "<td class=xl3017352></td>"
  . . w "<td class=xl3117352>&nbsp;</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl2617352>"_count_"</td>"
  . . w "<td colspan=2 class=xl3517352 width=142 style='border-right:.5pt solid black;border-left:none;width:107pt'>"_GoodsString_"</td>"
  . . w "<td class=xl2917352 style='border-left:none'>"_quant_"</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl3117352>&nbsp;</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl2617352>"_count_"</td>"
  . . w "<td colspan=2 class=xl3517352 width=137 style='border-right:.5pt solid black;border-left:none;width:103pt'>"_GoodsString_"</td>"
  . . w "<td class=xl2917352 style='border-left:none'>"_quant_"</td>"
 . . w "</tr>"
 . . s summabeznds=$J(pricechanged*quant,".",2)
 . . s summaotnds=$J(summabeznds-(summabeznds*antinds),".",2)
 . . s ItogSumma=$G(ItogSumma)+(summaotnds+summabeznds)
 . . //
 . . //теперь тоже самое в валюте
 . . s summaotndsCurrency= item.Total-(item.Total*antinds)
 . . s ItogSummaCurrency = $G(ItogSummaCurrency) + (summaotndsCurrency + item.Total)
 
 
 //s ItogoBezNDS=$J(ItogSumma*antinds,".",2),ItogoNDS=VsegoKOplate-ItogoBezNDS
</script>
 <tr height=30 style='height:22.5pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352 colspan=4></td>
  <td class=xl1517352>#($J(totquant,".",2))#</td>
  <!--
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J($G(tot),".",2))#<br>#($J($G(ItogSummaCurrency),".",2))#</td>
  -->
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352 colspan=6></td>
  <td class=xl1517352>#($J(totquant,".",2))#</td>
  <!--
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J($G(tot),".",2))#<br>#($J($G(ItogSummaCurrency),".",2))#</td>
  -->
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td colspan=2 height=15 class=xl3217352 style='height:11.25pt'>Курс #($J(kurs,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J(ItogSumma,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td colspan=2 class=xl3217352>Курс #($J(kurs,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($J(ItogSumma,".",2))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <!--
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>646.74</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>26.34</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
-->
</table>
</body>
</html>
]]></CSP>


<CSP name="screen/rashСЦенами.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Rash).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . //s:$ISOBJECT(obj.User1) usr=obj.User1.Name
 . d:$ISOBJECT(obj.Kontr)
 . . s kontr=obj.Kontr.Name
 . s numb=obj.Name
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=$P($ZD(obj.Dat,4),"/",2)
 . s year=$P($ZD(obj.Dat,4),"/",3)
 . s docdat=day_"."_month_"."_year
 . s kurs=obj.kurs
 . if $ISOBJECT(obj.Source) s SourceInstrName=obj.Source.Name,SourceInstrDat=$ZD(obj.Source.Dat,4)
 s cday=$P($ZD(+$H,4),"/",1)
 s cmonth=$P($ZD(+$H,4),"/",2)
 s cyear=$P($ZD(+$H,4),"/",3)
 s curdat=cday_"."_cmonth_"."_cyear
 s curtime=$ZT($P($H,",",2))

 s docname=##class(Docs.Action).GetDocNameFromClass("Docs.Rash")
 
 
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 </script>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>#(docname)#</title>
<style id="Склад1_17352_Styles"><!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
.xl1517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl1917352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2017352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2117352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:12.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2217352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:top;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2317352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2417352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2617352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:top;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2717352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
.xl2817352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:center;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl2917352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3017352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3117352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border-top:none;
	border-right:2.0pt double windowtext;
	border-bottom:none;
	border-left:2.0pt double windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3217352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3317352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:1.0pt solid windowtext;
	border-left:1.0pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3417352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:700;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:1.0pt solid windowtext;
	border-bottom:1.0pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:nowrap;}
.xl3517352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
.xl3617352
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:9.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border-top:1.0pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;
	mso-background-source:auto;
	mso-pattern:auto;
	white-space:normal;}
--></style>
</head>

<body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=1013 style='border-collapse:
 collapse;table-layout:fixed;width:763pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=107 style='mso-width-source:userset;mso-width-alt:4565;width:80pt'>
 <col width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col width=42 style='mso-width-source:userset;mso-width-alt:1792;width:32pt'>
 <col width=48 style='mso-width-source:userset;mso-width-alt:2048;width:36pt'>
 <col width=50 style='mso-width-source:userset;mso-width-alt:2133;width:38pt'>
 <col width=8 style='mso-width-source:userset;mso-width-alt:341;width:6pt'>
 <col width=4 style='mso-width-source:userset;mso-width-alt:170;width:3pt'>
 <col width=6 style='mso-width-source:userset;mso-width-alt:256;width:5pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=25 style='mso-width-source:userset;mso-width-alt:1066;width:19pt'>
 <col width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <col width=44 style='mso-width-source:userset;mso-width-alt:1877;width:33pt'>
 <col width=49 style='mso-width-source:userset;mso-width-alt:2090;width:37pt'>
 <col width=3 span=2 style='mso-width-source:userset;mso-width-alt:128;
 width:2pt'>
 <col width=5 style='mso-width-source:userset;mso-width-alt:213;width:4pt'>
 <col width=18 style='mso-width-source:userset;mso-width-alt:768;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=32 style='mso-width-source:userset;mso-width-alt:1365;width:24pt'>
 <col width=35 style='mso-width-source:userset;mso-width-alt:1493;width:26pt'>
 <col width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col width=6 style='mso-width-source:userset;mso-width-alt:256;width:5pt'>
 <col width=19 style='mso-width-source:userset;mso-width-alt:810;width:14pt'>
 <col width=110 style='mso-width-source:userset;mso-width-alt:4693;width:83pt'>
 <col width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <tr height=17 style='mso-height-source:userset;height:12.95pt'>
  <td height=17 class=xl1917352 colspan=2 width=126 style='height:12.95pt;
  width:94pt'><a name="RANGE!R1C1:R12C29">Офис</a></td>
  <td class=xl1517352 width=30 style='width:23pt'></td>
  <td class=xl1517352 width=42 style='width:32pt'></td>
  <td class=xl1517352 width=48 style='width:36pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=50 style='width:38pt'></td>
  <td class=xl1517352 width=8 style='width:6pt'></td>
  <td class=xl2017352 width=4 style='width:3pt'>&nbsp;</td>
  <td class=xl1517352 width=6 style='width:5pt'></td>
  <td class=xl1917352 colspan=2 width=129 style='width:97pt'>Склад</td>
  <td class=xl1517352 width=25 style='width:19pt'></td>
  <td class=xl1517352 width=37 style='width:28pt'></td>
  <td class=xl1517352 colspan=2 width=93 style='width:70pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=3 style='width:2pt'></td>
  <td class=xl2017352 width=3 style='width:2pt'>&nbsp;</td>
  <td class=xl1517352 width=5 style='width:4pt'></td>
  <td class=xl1917352 colspan=2 width=128 style='width:97pt'>На упаковку</td>
  <td class=xl1517352 colspan=2 width=67 style='width:50pt'>#($G(curdat))#</td>
  <td class=xl1517352 width=7 style='width:5pt'></td>
  <td class=xl2017352 width=3 style='width:2pt'>&nbsp;</td>
  <td class=xl1517352 width=6 style='width:5pt'></td>
  <td class=xl1917352 colspan=2 width=129 style='width:97pt'>В Упаковку</td>
  <td class=xl1517352 colspan=2 width=64 style='width:48pt'>#($G(curdat))#</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($G(curtime))#</td>
 </tr>
 <tr height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 class=xl1917352 style='height:9.0pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td colspan=2 class=xl3217352>#($g(usr))#</td>
  <td class=xl1517352></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl1917352 colspan=3 style='height:12.75pt'>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=3>№ #($G(numb))# от #(docdat)#</td>
  <td class=xl2117352></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl1517352 style='height:12.75pt' colspan=6>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=6>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=5>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=3>Заявка #($G(SourceInstrName))# от #($G(SourceInstrDat))#</td>
  <td class=xl1517352></td>
 </tr>
 <tr height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 class=xl1917352 colspan=5 style='height:10.5pt'>Кому #($g(kontr))#</td>
  <td class=xl2217352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=5>Кому #($g(kontr))#</td>
  <td class=xl2217352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=5>Кому #($g(kontr))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352 colspan=4>Кому #($g(kontr))#</span></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl1517352 style='height:12.0pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <tr height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl2317352 style='height:11.1pt'>№</td>
  <td class=xl2317352 style='border-left:none' x:str="Наименование ">Наименование
  </td>
  <td class=xl2317352 style='border-left:none'>Кол</td>
  <td class=xl2317352 style='border-left:none'>Цена</td>
  <td class=xl2317352 style='border-left:none'>Цена(р)</td>
  <td class=xl2317352 style='border-left:none'>Сумма</td>
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td class=xl2317352 style='border-left:none' x:str="Наименование ">Наименование
  </td>
  <td class=xl2317352 style='border-left:none'>Кол</td>
  <td class=xl2317352 style='border-left:none'>Цена</td>
  <td class=xl2317352 style='border-left:none'>Цена(р<span style='display:none'>)</span></td>
  <td class=xl2317352 style='border-left:none'>Сумма</td>
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td colspan=2 class=xl3317352 style='border-right:1.0pt solid black;
  border-left:none' x:str="Наименование ">Наименование </td>
  <td class=xl2317352 style='border-left:none'>Уп</td>
  <td class=xl2417352></td>
  <td class=xl2517352>&nbsp;</td>
  <td class=xl2417352></td>
  <td class=xl2317352>№</td>
  <td colspan=2 class=xl3317352 style='border-right:1.0pt solid black;
  border-left:none' x:str="Наименование ">Наименование </td>
  <td class=xl2317352 style='border-left:none'>Уп</td>
 </tr>
 
<script language="cache" runat="server">
 d:$ISOBJECT(obj.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . i $I(count)
 . . s item=obj.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . if $ISOBJECT(item.ZakazGoods) s ZakazGoods=item.ZakazGoods.FullName
 . . else  s ZakazGoods=""
 . . 
 . . if ZakazGoods'="",ZakazGoods'=goods s GoodsString=ZakazGoods_" ("_goods_")"
 . . else  s GoodsString=goods
 . . 
 . . s quant=item.Quantity
 . . s total=$J(item.Total,".",2)
 . . s price=$J(item.Price,".",2)
 . . s totquant=totquant+quant
 . . s tot=tot+total
 . . s pricechanged=$J(price*kurs,".",2)
 . . w "<tr class=xl1517352>"
 . . w "<td class=xl2617352>"_count_"</td>"
 . . w "<td class=xl2717352 width=107 style='border-left:none;width:80pt'>"_GoodsString_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_quant_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_price_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_pricechanged_"</td>"
 . . w "<td class=xl2917352 style='border-left:none'>"_total_"</td>"
 . . w "<td class=xl3017352></td>"
 . . w "<td class=xl3117352>&nbsp;</td>"
 . . w "<td class=xl3017352></td>"
 . . w "<td class=xl2617352>"_count_"</td>"
 . . w "<td class=xl2717352 width=110 style='border-left:none;width:83pt'>"_GoodsString_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_quant_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_price_"</td>"
 . . w "<td class=xl2817352 style='border-left:none'>"_pricechanged_"</td>"
 . . w "<td class=xl2917352 style='border-left:none'>"_total_"</td>"
 . . w "<td class=xl3017352></td>"
  . . w "<td class=xl3117352>&nbsp;</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl2617352>"_count_"</td>"
  . . w "<td colspan=2 class=xl3517352 width=142 style='border-right:.5pt solid black;border-left:none;width:107pt'>"_GoodsString_"</td>"
  . . w "<td class=xl2917352 style='border-left:none'>"_quant_"</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl3117352>&nbsp;</td>"
  . . w "<td class=xl3017352></td>"
  . . w "<td class=xl2617352>"_count_"</td>"
  . . w "<td colspan=2 class=xl3517352 width=137 style='border-right:.5pt solid black;border-left:none;width:103pt'>"_GoodsString_"</td>"
  . . w "<td class=xl2917352 style='border-left:none'>"_quant_"</td>"
 . . w "</tr>"
 . . s summabeznds=$J(pricechanged*quant,".",2)
 . . s summaotnds=$J(summabeznds-(summabeznds*antinds),".",2)
 . . s ItogSumma=$G(ItogSumma)+(summaotnds+summabeznds)
 . . //
 . . //теперь тоже самое в валюте
 . . s summaotndsCurrency= item.Total-(item.Total*antinds)
 . . s ItogSummaCurrency = $G(ItogSummaCurrency) + (summaotndsCurrency + item.Total)
 
 
 //s ItogoBezNDS=$J(ItogSumma*antinds,".",2),ItogoNDS=VsegoKOplate-ItogoBezNDS
</script>
 <tr height=30 style='height:22.5pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J(totquant,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J($G(tot),".",2))#<br>#($J($G(ItogSummaCurrency),".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J(totquant,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J($G(tot),".",2))#<br>#($J($G(ItogSummaCurrency),".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td colspan=2 height=15 class=xl3217352 style='height:11.25pt'>Курс #($J(kurs,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>#($J(ItogSumma,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td colspan=2 class=xl3217352>Курс #($J(kurs,".",2))#</td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352 colspan=2>#($J(ItogSumma,".",2))#</td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
 <!--
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl1517352 style='height:11.25pt'></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>646.74</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352>Итого</td>
  <td class=xl1517352></td>
  <td class=xl1517352>26.34</td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl2017352>&nbsp;</td>
  <td class=xl1517352></td>
  <td class=xl1917352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
  <td class=xl1517352></td>
 </tr>
-->
</table>
</body>
</html>
]]></CSP>


<CSP name="screen/sluzap.csp" application="/csp/sklad2/" default="1"><![CDATA[
<csp:class super="%CSP.Page" encoded=0
 includes="xmlmacros">


<server>
 s month=$lb("Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь")
 s class=%request.Get("class")
 , catalogue="" // if class'="" s catalogue=""
 , docid=$g(%request.Data("docid",1))
 , docnumber="" 
 
 if ##class(Docs.Sluzap).%ExistsId(docid) 
 {
	 s docnumber=##class(Docs.Sluzap).NameGetStored(docid)
 }
</server><!doctype html><html lang="ru">
<head><meta charset="windows-1251">
<title>Служебная записка</title>
<link rel='stylesheet' type='text/css' href='../css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='../css/ui.jqgrid.css'/>
<style type="text/css" media="all">
.ui-widget {font-size:.8em;}
.vat {vertical-align: top;}
.tar {text-align: right;}
.tac {text-align: center;}
p {font-family: 'Tahoma','Sans-serif';}
.sluzap-table {border-collapse:collapse; font-size:80%;}
.sluzap-table th,.sluzap-table td {padding:1.2mm;border:1px solid;font-family:'Arial';}
.sluzap-table th {font-weight: normal;}
.noborder { border-right: none; border-top: none; border-bottom: none; }
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.WordSection1 {page:WordSection1;}

/* не работает 
@media print {
 .notprint { display: none }
}*/
</style><style type="text/css" media="print">

.notprint { display: none; }

</style>


<script src="../js/jquery-1.7.2.min.js"></script>
<script type='text/javascript' src='../js/jquery-ui-1.8.16.custom.min.js'></script>
<script type='text/javascript' src='../js/i18n/grid.locale-ru_win1251.js'></script>
<script type='text/javascript' src='../js/jquery.jqGrid-4.1.2.min.js'></script>
<script type="text/javascript" src="../js/pages/sluzap.js"></script>

</head><body>
<server>
 s CreateDate=+$H
 if +docid 
 {
	 &sql(SELECT Stat,Dat,Kontr,Kontr->Name
		INTO :Stat,:CreateDate,:KontrId,:KontrName
		FROM Docs.Sluzap 
		WHERE id=:docid)
		
	if $G(KontrId)="" 
	{
		s KontrName="_________________"
		s KontrId=""
	}
	s CurrencyName = ##class(Kontragent.Action).KontragentCurrencyName(KontrId)
 }
 else
 {
	s KontrId = 695
	s KontrName = "ИП Носач А.В."
 }
</server>
<p class='tar'>Исполнительному директору <br/> Арутюнян А.А.</p>
<p class='tac' style="margin:1cm 0cm;">Служебная записка № <span id="docnumber">#($G(docnumber))#</span></p>
<p style='text-indent:35.4pt'>Александр Альбертович, прошу оплатить за сервисное обслуживание проданной техники, в авторизованные сервисные центры от 
	<span onclick="ChooseKonragent(this)" id="KontrHref" Tag="#(KontrId)#" onmouseover="this.style.background='gray'" onmouseout="this.style.background='transparent'">#(KontrName)#</span></p>
<table id="MainTable" class='sluzap-table'>
<thead><tr>
 <th width=169>Получатель</th>
 <th width=100>Округ</th>
 <th width=61>Номер отчёта</th>
 <th width=60 >Счёт №</th>
 <th width=57 colspan=2>Сумма</th>
 <th width=92 valign=top>Примечание</th>
 <!--th width=84>Бренд</th-->
 </tr></thead>
<tbody>
<server>
	if +docid {
	 &sql(declare zz cursor for
	 	SELECT ID,Kontr,Kontr->Name,Otchet,Otchet->Name,SchetNum,Total,Kontr->Federal->Name,Kontr->Currency
	 	INTO :ID,:Kontr,:KontrName,:Otchet,:OtchetName,:SchetNum,:Total,:FederalName,:KontrCurrency
	 	FROM Docs.SluzapItems WHERE Doc=:docid)
	 &sql(open zz)
	 f  &sql(fetch zz) q:SQLCODE  d
	 . w "<tr id=""",ID,""" KontrId=""",Kontr,""" OtchId=""",Otchet,""">"
	 . w "<td>",KontrName,"</td>"
	 . w "<td>",FederalName,"</td>"
	 . w "<td>",OtchetName,"</td>"
	 . w "<td>",SchetNum,"</td>"
	 . w "<td>",Total,"</td>"
	 . w "<td>",##class(Common.Kontragent).CurrencyLogicalToDisplay(KontrCurrency),"</td>"
	 . w "<td>",$LG(month,+SchetNum),"</td>"
	 . w:Stat=1 "<td class=""noborder""><button class='bDelRow notprint' type=""button"" title=""Удалить строку"">Удалить</button></td>"
	 . w "</tr>"
	 &sql(close zz)
 }
 
 s buttons="<button type=""button"" id=""bAdd"" class=""notprint"">Добавить получателя</button><button type=""button"" id=""bSave"" class=""notprint"">Сохранить</button>"
 if $G(Stat)=2 s buttons=""
 
&html<
</tbody><tfoot><tr>
  <td colspan=4 > Итого:</td>
  <td id="ItogTD"></td>
  <td >&nbsp;</td>
 </tr></tfoot>
</table>

<p>#($ZD(CreateDate,4))# г.</p>
<p>Директор сервисной службы <span style="padding: 0 0 0 5cm">#($$$TunesVariableGlobal("director"))#</span></p>
</div>

<div class="noprint">
	#(buttons)#
</div>
>
</server>
<!-- окно выбора контрагента, отчёта -->
<div id="dialog" style="display:none">
	<table><tr class='vat'>
		<td id="leftPane">
			<table id="kontrGrid"></table><div id="kontrBar"></div>
		</td><td id="rightPane">
			<label for="otchetSel" class='ui-state-default'>Отчёты контрагента</label><br/>	
			<select id="otchetSel" multiple size="13" style="width:160px"></select>
			<!--table id="kontrReportsGrid"></table><div id="kontrReportsBar"></div-->
		</td>
	</tr></table>
	<div>
		<label for="SchetNumb">Номер счёта<label>
		<input type="text" id="SchetNumb"/>
	</div>
</div>
<script type="text/javascript">
var docid = "#(docid)#";
$(function(){ //функция будет выполнена после загрузки страницы
	$(".bDelRow")
		.button({label:'Удалить', icons:{primary:'ui-icon-trash'}, title:'Удалить строку'})
		.click(function(){
			delrow( 
				$(this) //button->
				.parent() //td ->
				.parent() //tr 
				.attr("id")
			);
		})
	;
	//Инициализация диалога выбора
	$("#dialog").dialog({
			title: "Выбор контрагента и отчета" 
			,autoOpen: false
			,buttons: [
				{ text: "Выбрать", click: function(){ 
		        		var KontrId = $("#kontrGrid").jqGrid("getGridParam","selrow")
		        		, OtchetId= $("#otchetSel option:selected").val()
		        		, SchetNum= $("#SchetNumb").val()
		        		;
		        		$.get( "sluzapResults.csp?kontr="+KontrId+"&OtchetId="+OtchetId+"&SchetNum="+SchetNum
		        			,function(data) { 
								$("#MainTable > tbody:last").append(data); 
								Itog();
							}
						); 
		        		$(this).dialog("close");
		        }}
		    	,{ text: "Отмена", click: function(){ 
		        	$(this).dialog("close"); 
		        }}
			]
			,width: 900
			
	});
 //Инициализация грида с контрагентами в диалоге
 $("#kontrGrid").jqGrid({
	url: "../json.Kontragent.cls"
	,datatype: "json",jsonReader : { repeatitems: false }
	,idPrefix:"kt"
	,colModel: [
		{name:"id",hidden: true}
		,{name:"name",label:"Наименование",width:250}
		,{name:"nick",label:"Псевдоним",width:200}
		,{name:"city",label:"Город",width:100}
	]
	,pager: "#kontrBar"	
	,rowNum:100
	,viewrecords:true
 	,gridview:true ,rownumbers:true,viewrecords:true
 	,hidegrid: false,hoverrows:true ,scroll:1
 	,pager:"#kontrBar" 
 	,height:300
 	,onSelectRow: function(id){ 
 		$.get( "sluzapResults.csp?kontrId="+id
 			, function(data){ $("#otchetSel").html(data);}
 		); 
  	}
 }).jqGrid('navGrid',"#kontrBar", 
       {add:false,edit:false,del:false,view:false,search:false}
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{}
 ).jqGrid('filterToolbar',{searchOnEnter:false})
 .jqGrid('gridResize',{})
 ;
  //рассчитываем итог
  Itog(); 
  //Кнопки
  	$("#bAdd").button({
		icons: {primary: "ui-icon-plus"}	
	}).click(function(){
		$("#kontrGrid").trigger("reloadGrid"); //глючит прокрутка 	
 		$("#dialog").dialog("open");
	});
	
	$("#bSave").button({
		icons: {primary: "ui-icon-disk"}	
	}).click(Save);
});
	//функция выбора контрагента (подставит выбранного в innerText переданного объекта
function ChooseKonragent(Obj)
{
	newItem=window.showModalDialog("../Dictionary.csp","Common.Kontragent","center:yes;status:no;dialogHeight:400px;dialogWidth:650px;resizable:yes;");
	if(newItem==null){return false;}
	var newArr=newItem.split('~');
	$(Obj).text(newArr[1]);
	Obj.Tag=newArr[0];
}
</script></body></html>]]></CSP>


<CSP name="screen/sluzapBackup.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s month=$listbuild("Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь")
 s class=%request.Get("class")
 if class'="" s catalogue=""
 else  s catalogue=""
 
 s docid = %request.Get("docid")
 if +docid
 {
	 s docobj = ##class(Docs.Sluzap).%OpenId(docid)
	 if $ISOBJECT(docobj)
	 {
		 s docnumber = docobj.Name
	 }
 }
</script><!doctype html><html lang="ru">
<!--xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40"-->
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>Служебная записка</title>

<link rel='stylesheet' type='text/css' href='../css/redmond/jquery-ui-1.8.16.custom.css'/>
<link rel='stylesheet' type='text/css' href='../css/ui.jqgrid.css'/>


<link rel="stylesheet" href="../jquery/themes/base/jquery.ui.all.css">
<script src="../jquery/jquery-1.7.2.js"></script>
<!-- Это все есть в посленднем файле script src="../jquery/external/jquery.bgiframe-2.1.2.js"></script>
<script src="../jquery/ui/jquery.ui.core.js"></script>
<script src="../jquery/ui/jquery.ui.widget.js"></script>
<script src="../jquery/ui/jquery.ui.mouse.js"></script>
<script src="../jquery/ui/jquery.ui.button.js"></script>
<script src="../jquery/ui/jquery.ui.draggable.js"></script>
<script src="../jquery/ui/jquery.ui.position.js"></script>
<script src="../jquery/ui/jquery.ui.resizable.js"></script>
<script src="../jquery/ui/jquery.ui.dialog.js"></script>
<script src="../jquery/ui/jquery.effects.core.js"></script
--><script type='text/javascript' src='../js/jquery-ui-1.8.16.custom.min.js'></script>

<script type='text/javascript' src='../js/i18n/grid.locale-ru.js'></script>
<script type='text/javascript' src='../js/jquery.jqGrid-4.1.2.min.js'></script>

<style>
body { font-size: 62.5%; }
input.text { margin-bottom:12px; width:95%; padding: .4em; }
fieldset { padding:0; border:0; margin-top:25px; }
h1 { font-size: 1.2em; margin: .6em 0; }
div#users-contain { width: 350px; margin: 20px 0; }
div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
.ui-dialog .ui-state-error { padding: .3em; }
.validateTips { border: 1px solid transparent; padding: 0.3em; }
.noborder{ border-right: none; border-top: none; border-bottom: none; }

<!--
 /* Font Definitions */
 @font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520081665 -1073717157 41 0 66047 0;}
@font-face
	{font-family:"Arial CYR";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-536859905 -1073711037 9 0 511 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
-->
@media print
{
	.notprint { display: none }
}
 TD,TH {border:1px solid black; font-family: Arial}
</style>
<script language="javascript" type="text/javascript" src="../js/pages/sluzap1.js"></script>
<script language="javascript" type="text/javascript" src="js/pages/sluzap.js"></script>
</head>

<body lang=RU style='tab-interval:35.4pt'>
<div class=WordSection1>

<p class=MsoNormal align=right style='text-align:right'><span style='font-family:
"Tahoma","sans-serif"'>Исполнительному директору</span></p>

<p class=MsoNormal align=right style='text-align:right'><span style='font-family:
"Tahoma","sans-serif"'>Арутюнян А.А.</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:"Tahoma","sans-serif"'>Служебная записка № <span id="docnumber">#($G(docnumber))#</span></span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:35.4pt'><span style='font-family:"Tahoma","sans-serif"'>Александр Альбертович, прошу оплатить за сервисное обслуживание, проданной техники, в авторизованные сервисные центры от ИП Носач А.В.</span></p>

<p class=MsoNormal style='text-indent:35.4pt'><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<table id="MainTable" class=MsoNormalTable border=0 cellspacing=0 cellpadding=6 width=625 style='width:468.75pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt: 0cm 5.4pt 0cm 5.4pt'>
<thead>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:13.5pt;mso-row-margin-right:2.3pt'>
  <th width=169>
	Получатель
  </th>
  <th width=100>
  	Округ
  </th>
  <th width=61>
  	Номер отчёта
  </th>
  <th width=60 >
  	Счёт №
  </th>
  <th width=57>
  	Сумма, руб
  </th>
  <th width=92 valign=top>
  	Примечание
  </th>
  <!--
  <th width=84 valign=top>
  	Бренд
  </th>
  -->
 </tr>
</thead>
<tbody>
<script language="cache" runat="server">
 if +docid
 {
	 &sql(declare zz cursor for
	 	SELECT ID,Kontr,Kontr->Name,Otchet,Otchet->Name,SchetNum,Total,Kontr->Federal->Name
	 	INTO :ID,:Kontr,:KontrName,:Otchet,:OtchetName,:SchetNum,:Total,:FederalName
	 	FROM Docs.SluzapItems WHERE Doc=:docid)
	 &sql(open zz)
	 f  &sql(fetch zz) q:SQLCODE  d
	 . w "<tr id="""_ID_""" KontrId="""_Kontr_""" OtchId="""_Otchet_""">"
	 . w "<td>"_KontrName_"</td>"
	 . w "<td>"_FederalName_"</td>"
	 . w "<td>"_OtchetName_"</td>"
	 . w "<td>"_SchetNum_"</td>"
	 . w "<td>"_Total_"</td>"
	 . w "<td>"_$LG(month,+SchetNum)_"</td>"
	 . w "<td class=""noborder""><input type=""button"" onclick=""delrow('"_ID_"')"" class=""noprint"" value=""Удалить"" title=""Удалить строку""></td>"
	 . w "</tr>"
	 &sql(close zz)
 }
</script>
</tbody>
<tfoot>
 <tr>
  <td colspan=4 > ИТОГО:</td>
  <td id="ItogTD"></td>
  <td >&nbsp;</td>
 </tr>
</tfoot>
</table>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>27.12.2011
г.</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Tahoma","sans-serif"'>Директор
сервисной службы<span style='mso-tab-count:4'>                                 </span>В.Ф.Ульянов</span></p>
</div><br><br>
<span class="noprint">
	<input type="button" value="Добавить получателя" onclick="Add()">&nbsp;
	<input type="button" value="Сохранить" onclick="Save()">
</span>
<!-- окно выбора контрагента, отчёта -->
<div id="dialog" title="Выбор контрагента и отчёта" style="display:none">
	<table>
	<tr>
	<td valign="top">
		<table>
			<tr>
			<td>
				<table id="kontrGrid"><tr><td></td></tr></table><div id="kontrBar"></div>
			</td>
			<td>
				<table id="kontrReportsGrid"><tr><td></td></tr></table><div id="kontrBar"></div>
			</td>
			</tr>
		</table>
	</td>
	<td valign="top">
		<font size="3">Отчёты контрагента</font><br>
		<select id="otchetSel" multiple style="font-size:22px;font-family:Arial;width:250px" size="13"></select>
	</td>
	</tr>
	<tr>
		<td colspan=2><nobr>Номер счёта <input type="text" id="SchetNumb" style="font-size:22px;font-family:Arial"></nobr></td>
	</tr>
	</table>
</div>
<script language="javascript" type="text/javascript">
var docid = "";
$("#kontrGrid").jqGrid({
	colModel: [
		{name:"id",hidden: true}
		,{name:"name",label:"Наименование",width:250}
		,{name:"nick",label:"Псевдоним",width:200}
		,{name:"city",label:"Город",width:100}
	]
	,url: "../json.Kontragent.cls"
	,datatype: "json"
	,jsonReader : { repeatitems: false }
	,pager: "#kontrBar"	
	,idPrefix:"kt"
 ,viewrecords:true
 ,height:300
 ,hidegrid: false
 ,gridview:true ,rownumbers:true,viewrecords:true,rowNum:100
 ,pager:"#kontrBar" ,/*scrollrows:true,*/hoverrows:true ,scroll:1
 ,onSelectRow: function(id)
 	{ 
 		$.get( "sluzapResults.csp?kontrId="+id, function(data){ $("#otchetSel").html(data);} ); 
	 }
 }).jqGrid('navGrid',"#kontrBar", 
       {add:false,edit:false,del:false,view:false,search:false}
       ,{} //Параметры редактирования
       ,{} //Параметры добавления
       ,{}
 ).jqGrid('filterToolbar',{searchOnEnter:false})
 .jqGrid('gridResize',{})
 ;
$("#kontrGrid").trigger("reloadGrid"); //глючит прокрутка
Itog();
</script>
</body>
</html>
]]></CSP>


<CSP name="screen/sluzapResults.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s month=$listbuild("Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь")
 
 s kontr=%request.Get("kontr")
 s kontrId=%request.Get("kontrId")
 s OtchetId = %request.Get("OtchetId")
 s SchetNum =%request.Get("SchetNum")
 s Save = %request.Get("Save")
 s docsumm = %request.Get("docsumm")
 s strs = %request.Get("strs")

 //если потребовали сформировать строчку для таблицы
 if (OtchetId '= "")
 {
	 &sql(select Name,Federal->Name,Currency
	 	INTO :KontrName,:FederalName,:Currency 
	 	FROM Common.Kontragent where id=:kontr)
	 if SQLCODE s (KontrName,FederalName)="не найден"
	 
	 &sql(select Name,Summa,Sluzap->Stat,Sluzap->Name
	 	INTO :DocName,:DocSumma,:SluzapStat,:SluzapName
	 	FROM Docs.Otchet where id=:OtchetId)
	 if SQLCODE s (DocName,DocSumma)="не найден"
	 
	 s ID="z"_$R(9999)
	 
	 if SluzapStat=2 
	 {
		 w "<tr ID="""_ID_""">"_
	 	"<td>"_KontrName_"</td>"_
	 	"<td>"_FederalName_"</td>"_
	 	"<td colspan=5>Отчёт "_DocName_" в служебной записке "_SluzapName_"</td>"_
	 	"<td class=""noborder""><input type=""button"" onclick=""delrow('"_ID_"')"" class=""notprint"" value=""Удалить"" title=""Удалить строку""></td>"_
	 	"</tr>"
	 }
	 else  
	 {
	 w "<tr KontrId="""_kontr_""" OtchId="""_OtchetId_""" ID="""_ID_""">"_
	 	"<td>"_KontrName_"</td>"_
	 	"<td>"_FederalName_"</td>"_
	 	"<td>"_DocName_"</td>"_
	 	"<td>"_SchetNum_"</td>"_
	 	"<td>"_DocSumma_"</td>"_
	 	"<td>"_##class(Common.Kontragent).CurrencyLogicalToDisplay(Currency)_"</td>"_
	 	"<td>"_$LG(month,+DocName)_"</td>"_
	 	"<td class=""noborder""><input type=""button"" onclick=""delrow('"_ID_"')"" class=""notprint"" value=""Удалить"" title=""Удалить строку""></td>"_
	 	"</tr>"
	 }
 }
 
 //если потребовали вывести список 
 if (+kontrId)
 {
	 &sql(declare zz cursor for
	 	SELECT ID,Dat,Name 
	 	INTO :ID,:Dat,:Name
	 	FROM Docs.Otchet
	 	WHERE Kontr=:kontrId
	 	ORDER BY id DESC)
	 &sql(open zz)
	 f  &sql(fetch zz) q:SQLCODE  d
	 . w "<option value="""_ID_""">"
	 . w Name_" от "_$ZD(Dat,4)
	 . w "</option>"
	 &sql(close zz)
 }
 
 //если потребовали сохранить документ
 if (+Save)
 {
	 s Summ=%request.Get("docsumm")
	 s docid=%request.Get("docid")
	 s DocKontrId=%request.Get("DocKontrId")
	 
	 s ^mtempArt("sluzap","Summ")=Summ
	 s ^mtempArt("sluzap","docid")=docid
	 s ^mtempArt("sluzap","DocKontrId")=DocKontrId
	 
	 if +docid 
	 {
		 s doc=##class(Docs.Sluzap).%OpenId(docid)
		 if $ISOBJECT(doc) 
		 {
			 s number=doc.Name
		 }
		 else  
		 {
			 s number=""
		 }
		 &sql(delete from Docs.SluzapItems where Doc=:docid)
	 }
	 else
	 {
		 s doc=##class(Docs.Sluzap).%New(docid)
		 s number = ##class(Docs.Action).getRashNumb("Docs.Sluzap")
		 s doc.Name = $TR($J(number,5)," ","0")
	 }
	 
	 s i=""
	 d doc.KontrSetObjectId(DocKontrId)
	 
	 f  s i=$O(%request.Data("strs[]",i)) q:i=""  d
	 . s strobj=##class(Docs.SluzapItems).%New()
	 . s strdata = $G(%request.Data("strs[]",i))
	 . s KontrId = $P(strdata,"&",1)
	 . s OtchId = $P(strdata,"&",2)
	 . s OtchetSumm = $P(strdata,"&",3)
	 . s SchetNum = $P(strdata,"&",4)
	 . d strobj.KontrSetObjectId(KontrId)
	 . d strobj.OtchetSetObjectId(OtchId)
	 . s strobj.Total = OtchetSumm
	 . s strobj.SchetNum = SchetNum
	 . d strobj.DocTypeSetObjectId("Docs.Sluzap")
	 . d strobj.GoodsSetObjectId(0)
	 . s ok = doc.Items.Insert(strobj)
	 
	 s ok=doc.%Save()
	 if ok 
	 {
		 w doc.%Id()_"||"_number
	 }
	 else  
	 {
		 w "Извините. Документ не удалось сохранить."
	 }
 }
 
</script>]]></CSP>


<CSP name="screen/Sverka.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="cache" runat="server">
 s Kontr1Id=%request.Get("Kontr1Id")
 s Kontr2Id=%request.Get("Kontr2Id")
 s dat1=%request.Get("dat1")
 s dat2=%request.Get("dat2")
 
 s date1=$S(dat1="":"",1:$ZDH(dat1,4))
 s date2=$S(dat2="":"",1:$ZDH(dat2,4))

 
 s Kontr1Obj=##class(Common.Kontragent).%OpenId(Kontr1Id)
 if $ISOBJECT(Kontr1Obj) d
 . s Kontr1Name=Kontr1Obj.Name
 . s Kontr1inn=Kontr1Obj.bank.inn
 
 s Kontr2Obj=##class(Common.Kontragent).%OpenId(Kontr2Id)
 if $ISOBJECT(Kontr2Obj) d
 . s Kontr2Name=Kontr2Obj.Name
 . s Kontr2inn=Kontr2Obj.bank.inn 
</script>
<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<style>
<!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
@page
	{margin:1.0in .24in 1.0in .24in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;}
-->
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
.style0
	{mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	white-space:nowrap;
	mso-rotate:0;
	mso-background-source:auto;
	mso-pattern:auto;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:0;
	border:none;
	mso-protection:locked visible;
	mso-style-name:Обычный;
	mso-style-id:0;}
td
	{mso-style-parent:style0;
	padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:0;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
.xl60
	{mso-style-parent:style0;
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl61
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:186;
	text-align:right;
	border:.5pt solid windowtext;}
.xl62
	{mso-style-parent:style0;
	border:.5pt solid windowtext;}
.xl63
	{mso-style-parent:style0;
	mso-number-format:Standard;
	text-align:right;
	border:.5pt solid windowtext;}
.xl64
	{mso-style-parent:style0;
	text-align:right;
	border:.5pt solid windowtext;}
.xl65
	{mso-style-parent:style0;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl66
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:186;
	mso-number-format:Standard;
	text-align:right;
	border:.5pt solid windowtext;}
.xl67
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:justify;
	white-space:normal;}
.xl68
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;}
.xl69
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	mso-number-format:Standard;
	text-align:right;
	border:.5pt solid windowtext;}
.xl70
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:right;
	border:.5pt solid windowtext;}
.xl71
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:186;}
.xl72
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	border-top:.5pt solid windowtext;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:.5pt solid windowtext;}
.xl73
	{mso-style-parent:style0;
	text-align:center;
	border:.5pt solid windowtext;}
.xl74
	{mso-style-parent:style0;
	mso-number-format:"Short Date";
	text-align:center;
	border:.5pt solid windowtext;}
.xl75
	{mso-style-parent:style0;
	text-align:justify;
	white-space:normal;}
.xl76
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;}
.xl77
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl78
	{mso-style-parent:style0;
	font-size:14.0pt;
	font-weight:700;
	font-family:Tahoma, sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl79
	{mso-style-parent:style0;
	font-size:12.0pt;
	font-weight:700;
	font-family:Tahoma, sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl80
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:center;
	white-space:normal;}
.xl81
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:center;}
</style>

</head>

<body link=blue vlink=purple>

<table border=0 cellpadding=0 cellspacing=0 width=768 style='border-collapse:
 collapse;table-layout:fixed;width:576pt'>
 <col width=16 style='mso-width-source:userset;mso-width-alt:682;width:12pt'>
 <col width=78 style='mso-width-source:userset;mso-width-alt:3328;width:59pt'>
 <col width=364 style='mso-width-source:userset;mso-width-alt:15530;width:273pt'>
 <col width=100 style='mso-width-source:userset;mso-width-alt:4266;width:75pt'>
 <col width=119 style='mso-width-source:userset;mso-width-alt:5077;width:89pt'>
 <col width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col width=64 style='width:48pt'>
 <tr height=24 style='height:18.0pt'>
  <td height=24 width=16 style='height:18.0pt;width:12pt'><a name="Print_Area"></a></td>
  <td colspan=4 class=xl78 width=661 style='width:496pt'>Акт</td>
  <td width=27 style='width:20pt'></td>
  <td width=64 style='width:48pt'></td>
 </tr>
 <tr height=20 style='height:15.0pt'>
  <td height=20 style='height:15.0pt'></td>
  <td colspan=4 class=xl79>сверки взаимных расчетов</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 style='height:12.6pt'></td>
  <td colspan=4 class=xl80 width=661 style='width:496pt'>между #($G(Kontr1Name))# и #($G(Kontr2Name))#</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 style='height:12.0pt'></td>
  <td colspan=4 class=xl81>на период: #($G(dat1))# - #($G(dat2))#</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=7 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=43 style='mso-height-source:userset;height:32.85pt'>
  <td height=43 style='height:32.85pt'></td>
  <td colspan=4 class=xl75 width=661 style='width:496pt'><span
  style='mso-spacerun:yes'>   </span>Мы, нижеподписавшиеся, главный бухгалтер
  #($G(Kontr1Name))# ___________________________________ с одной стороны и
  главный бухгалтер #($G(Kontr2Name))#
  ___________________________________, с другой стороны, произвели сверку
  взаимных расчетов</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=7 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td rowspan=2 class=xl76>Дата</td>
  <td rowspan=2 class=xl76>Наименование операции, документ</td>
  <td rowspan=2 class=xl76>Дебет</td>
  <td rowspan=2 class=xl77>Кредит</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl71 style='height:11.25pt'></td>
  <td class=xl72 style='border-top:none' colspan=2>Остаток на #(dat1)#</td>
  <td class=xl61 style='border-top:none'>&nbsp;</td>
  <td class=xl61 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <!--
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td class=xl73 style='border-top:none'>15.01.2009</td>
  <td class=xl62 style='border-top:none;border-left:none'>Технический отчёт № 7
  от 15.01.2009<span style='mso-spacerun:yes'> </span></td>
  <td class=xl63 style='border-top:none;border-left:none'>405 221,00</td>
  <td class=xl64 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 -->
 <script language="cache" runat="server">
 &sql(declare z1 cursor for
 select ID,Summa,Name,Dat
 into :ID,:Summa,:Name,:Dat
 from Docs.Otchet
 where Stat=2
 	and Dat>=:date1 and Dat<=:date2
 	and Kontr=:Kontr2Id)
 &sql(Open z1)
 f  &sql(Fetch z1) q:SQLCODE  d
 . s Docs(ID,"Name")=Name
 . s Docs(ID,"Dat")=Dat
 . s Docs(ID,"Summa")=Summa
 . s Docs(ID,"Type")="Docs.Otchet"
 &sql(Close z1)
 
 &sql(declare z2 cursor for
 select ID,RubSumma,Dat,Name
 into :ID,:Summa,:Dat,:Name
 from Docs.Platejka
 where Dat>=:date1 and Dat<=:date2
 	and Poluh=:Kontr1Id and Kontr=:Kontr2Id)
 &sql(Open z2)
 f  &sql(fetch z2) q:SQLCODE  d
 . s Docs(ID,"Name")=Name
 . s Docs(ID,"Dat")=Dat
 . s Docs(ID,"Summa")=Summa
 . s Docs(ID,"Type")="Docs.Platejka"
 &sql(close z2)
 
 s (AllDebet,AllCredit)=0
 s ID="" f  s ID=$O(Docs(ID)) q:ID=""  d
 . w "<tr height=15 style='height:11.25pt'>",!
 . w "<td height=15 style='height:11.25pt'></td>",!
 . w "<td class=xl73 style='border-top:none'>"_$ZD(Docs(ID,"Dat"),4)_"</td>",!
 . if Docs(ID,"Type")="Docs.Otchet" s DocTypeName="Технический отчёт ",Debet=Docs(ID,"Summa"),Credit=""
 . e  s DocTypeName="Платёжное поручение № ",Debet="",Credit=Docs(ID,"Summa")
 . s Debet=$J(Debet,"",2)
 . s Credit=$J(Credit,"",2)
 . w "<td class=xl62 style='border-top:none;border-left:none'>"_DocTypeName_" "_Docs(ID,"Name")_"</td>"
 . w "<td class=xl63 style='border-top:none;border-left:none'>"_Debet_"</td>"
 . w "<td class=xl64 style='border-top:none;border-left:none'>"_Credit_"</td>"
 . w "<td colspan=2 style='mso-ignore:colspan'></td>",!
 . w "</tr>",!
 . s AllCredit=AllCredit+Credit
 . s AllDebet=AllDebet+Debet
 
 if AllCredit>AllDebet s Kreditor=Kontr1Name
 if AllCredit<AllDebet s Kreditor=Kontr2Name
 </script>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl71 style='height:11.25pt'></td>
  <td class=xl72 colspan=2 style='mso-ignore:colspan'>Обороты за период</td>
  <td class=xl66 style='border-top:none'>#($J(AllDebet,"",2))#</td>
  <td class=xl66 style='border-top:none;border-left:none'>#($J(AllCredit,"",2))#</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl71 style='height:11.25pt'></td>
  <td class=xl72 colspan=2 style='mso-ignore:colspan'>Остаток на #($G(dat2))#</td>
  <td class=xl66 style='border-top:none'>#($G(Ostatok))#</td>
  <td class=xl61 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td class=xl67></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 style='height:22.35pt'></td>
  <td colspan=4 class=xl67 width=661 style='width:496pt'>Задолженность на
  #($G(dat2))# в пользу #($G(Kreditor))# составляет #($G(debt))# #($G(debtString))#</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=7 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=4 class=xl67 width=661 style='width:496pt'>Один экземпляр акта
  просим подписать и вернуть в наш адрес в течении 10 дней со дня получения.</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=4 class=xl67 width=661 style='width:496pt'>В противном случае
  считаем данную задолженность подтвержденной с Вашей стороны.</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=4 class=xl67 width=661 style='width:496pt'>Настоящий акт
  составлен в двух экземплярах.</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=7 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td class=xl68 colspan=2 style='mso-ignore:colspan'>#($G(Kontr1Name))#</td>
  <td class=xl68 colspan=2 style='mso-ignore:colspan'>#($G(Kontr2Name))#</td>
  <td colspan=2 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td class=xl68 colspan=2 style='mso-ignore:colspan'>ИНН: #($G(Kontr1inn))#</td>
  <td class=xl68>ИНН: #($G(Kontr2inn))#</td>
  <td colspan=3 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=21 style='mso-height-source:userset;height:15.75pt'>
  <td height=21 style='height:15.75pt'></td>
  <td colspan=2 style='mso-ignore:colspan'>Главный бухгалтер
  ____________________________</td>
  <td colspan=4 style='mso-ignore:colspan'>Главный бухгалтер
  ___________________________</td>
 </tr>
 
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/torg12.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">

 s DoverennNumber = %request.Get("DoverennNumber")
 s DoverennDatValue = %request.Get("DoverennDatValue")
 
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s kontr3=%request.Get("kontr3")
 s kontr4=%request.Get("kontr4")
 s docid=%request.Get("id")
 s docname="Платежное поручение"
 s nomnakl=%request.Get("nomernakladnoy")
 s NDSinside=%request.Get("NDSinside")
 s DocDate=%request.Get("DocDate")

 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$TR(docdate,"/",".")
 . s kurs=doc.kurs
 . if '+kurs,+doc.Summa s kurs=doc.RubSumma/doc.Summa
 
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s kname1=k.Name
 . s Address1=k.AddressUr
 . s bank1=k.bank
 . s codecity1=k.CityCode
 . s namecity1=k.CityUr
 . s Postalcode1=k.PostalcodeUr
 . d:$ISOBJECT(bank1)
 . . s pbank1=bank1.pbank
 . . s city1=bank1.city
 . . s kpp1=bank1.kpp
 . . s inn1=bank1.inn
 . . s bik1=bank1.bik
 . . s rsch1=bank1.rsch
 . . s ksch1=bank1.ksch
 . . s code1=bank1.code
 . . s okpo1=bank1.okpo
 
 . . s okud1=bank1.okud
 . . s okpo1=bank1.okpo
 . . s okdp1=bank1.okdp
 
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s kname2=k.Name
 . s Address2=k.AddressUr
 . s bank2=k.bank
 . s codecity2=k.CityCode
 . s namecity2=k.CityUr
 . s contract = k.Agree
 . s Postalcode2=k.PostalcodeUr
 . d:$ISOBJECT(bank2)
 . . s pbank2=bank2.pbank
 . . s city2=bank2.city
 . . s kpp2=bank2.kpp
 . . s inn2=bank2.inn
 . . s bik2=bank2.bik
 . . s rsch2=bank2.rsch
 . . s ksch2=bank2.ksch
 . . s code2=bank2.code
 . . s okpo2=bank2.okpo
 . . s okpo2=bank2.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr3)
 d:$ISOBJECT(k)
 . s kname3=k.Name
 . s Address3=k.AddressUr
 . s bank3=k.bank
 . s chief=k.chief
 . s buh=k.glavbuh
 . s codecity3=k.CityCode
 . s namecity3=k.CityUr
 . s Postalcode3=k.PostalcodeUr
 . d:$ISOBJECT(bank3)
 . . s pbank3=bank3.pbank
 . . s city3=bank3.city
 . . s kpp3=bank3.kpp
 . . s inn3=bank3.inn
 . . s bik3=bank3.bik
 . . s rsch3=bank3.rsch
 . . s ksch3=bank3.ksch
 . . s code3=bank3.code
 . . s okpo3=bank3.okpo
 . . s okpo3=bank3.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr4)
 d:$ISOBJECT(k)
 . s kname4=k.Name
 . s Address4=k.AddressUr
 . s bank4=k.bank
 . s codecity4=k.CityCode
 . s namecity4=k.CityUr
 . s Postalcode4=k.PostalcodeUr
 . d:$ISOBJECT(bank4)
 . . s pbank4=bank4.pbank
 . . s city4=bank4.city
 . . s kpp4=bank4.kpp
 . . s inn4=bank4.inn
 . . s bik4=bank4.bik
 . . s rsch4=bank4.rsch
 . . s ksch4=bank4.ksch
 . . s code4=bank4.code
 . . s okpo4=bank4.okpo
 . . s okpo4=bank4.okpo
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 
</script><html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>

<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<title>Товарная накладная #(nomnakl)#</title>
<link rel="stylesheet" href="css/torg12.css" >
</head>

<body link=blue vlink=purple>

<table border=0 cellpadding=0 cellspacing=0 width=1066 style='border-collapse:collapse;table-layout:fixed;width:804pt'>
 <col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=34 style='mso-width-source:userset;mso-width-alt:1450;width:26pt'>
 <col class=xl24 width=74 style='mso-width-source:userset;mso-width-alt:3157;width:56pt'>
 <col class=xl24 width=14 style='mso-width-source:userset;mso-width-alt:597;width:11pt'>
 <col class=xl24 width=109 style='mso-width-source:userset;mso-width-alt:4650;width:82pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=71 style='mso-width-source:userset;mso-width-alt:3029;width:53pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=13 style='mso-width-source:userset;mso-width-alt:554;width:10pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=44 style='mso-width-source:userset;mso-width-alt:1877;width:33pt'>
 <col class=xl24 width=41 style='mso-width-source:userset;mso-width-alt:1749;width:31pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=30 style='mso-width-source:userset;mso-width-alt:1280;width:23pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col class=xl24 width=55 style='mso-width-source:userset;mso-width-alt:2346;width:41pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=15 span=2 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=46 style='mso-width-source:userset;mso-width-alt:1962;width:35pt'>
 <col class=xl24 width=15 style='mso-width-source:userset;mso-width-alt:640;width:11pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=53 style='mso-width-source:userset;mso-width-alt:2261;width:40pt'>
 <col class=xl24 width=37 style='mso-width-source:userset;mso-width-alt:1578;width:28pt'>
 <col class=xl24 width=11 style='mso-width-source:userset;mso-width-alt:469;width:8pt'>
 <col class=xl24 width=27 style='mso-width-source:userset;mso-width-alt:1152;width:20pt'>
 <col class=xl24 width=4 style='mso-width-source:userset;mso-width-alt:170;width:3pt'>
 <col class=xl24 width=9 style='mso-width-source:userset;mso-width-alt:384;width:7pt'>
 <col class=xl24 width=7 style='mso-width-source:userset;mso-width-alt:298;width:5pt'>
 <col class=xl24 width=42 style='mso-width-source:userset;mso-width-alt:1792;width:32pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=26 style='mso-width-source:userset;mso-width-alt:1109;width:20pt'>
 <col class=xl24 width=17 style='mso-width-source:userset;mso-width-alt:725;width:13pt'>
 <col class=xl24 width=36 style='mso-width-source:userset;mso-width-alt:1536;width:27pt'>
 <col class=xl24 width=12 style='mso-width-source:userset;mso-width-alt:512;width:9pt'>
 <col class=xl24 width=76 style='mso-width-source:userset;mso-width-alt:3242;width:57pt'>
 <col class=xl24 width=1 style='mso-width-source:userset;mso-width-alt:42;width:1pt'>
 <col class=xl24 width=3 style='mso-width-source:userset;mso-width-alt:128;width:2pt'>
 <col width=64 span=216 style='mso-width-source:userset;mso-width-alt:2730;width:48pt'>
 <tr height=22 style='mso-height-source:userset;height:17.1pt'>
  <td colspan=38 height=22 class=xl96 width=1062 style='height:17.1pt;width:801pt'>Унифицированная форма № ТОРГ-12<br>
    Утверждена постановлением Госкомстата России от 25.12.98 № 132</td>
  <td class=xl24 width=1 style='width:1pt'></td>
  <td class=xl24 width=3 style='width:2pt'></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 colspan=35 class=xl24 style='height:12.75pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl25 style='mso-ignore:colspan'></td>
  <td class=xl26>Коды</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=28 rowspan=2 class=xl125 width=818 style='width:617pt'>#($G(kname1))#, 
	#($G(Postalcode1))#, #($G(namecity1))#, #($G(Address1))#, Р/C #($G(rsch1))#, 
	#($G(pbank1))#, #($G(city1))#; БИК #($G(bik1))#, К/С #($G(ksch1))#</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl116 style='border-right:1.0pt solid black'>Форма по ОКУД</td>
  <td class=xl27 style='border-left:none'>#($G(okud1))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl30 style='border-left:none' >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>организация-грузоотправитель,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl32 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl97>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl24 style='height:12.0pt'></td>
  <td colspan=33 class=xl98>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=19 style='mso-height-source:userset;height:14.65pt'>
  <td height=19 colspan=3 class=xl24 style='height:14.65pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl31 align=center style='mso-ignore:colspan'>структурное
  подразделение</td>
  <td colspan=8 class=xl118 style='border-right:1.0pt solid black'>Вид
  деятельности по ОКДП</td>
  <td class=xl33 style='border-top:none;border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td colspan=2 class=xl99 width=108 style='width:82pt'>Грузополучатель</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname2))#, 
	#($G(Postalcode2))#, #($G(namecity2))#,&nbsp; #($G(Address2))#, P/C #($G(rsch2))#, 
	#($G(pbank2))#, #($G(city2))#; БИК #($G(bik2))#, K/C #($G(ksch2))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td class=xl34 style='border-left:none'>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация, адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl30 >#($G(okpo4))#</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Поставщик</td>
  <td colspan=31 class=xl125 width=806 style='width:608pt'>#($G(kname3))#, #($G(Postalcode3))#, 
	#($G(namecity3))#,&nbsp; #($G(Address3))#, P/C #($G(rsch3))#, #($G(pbank3))#, 
	#($G(city3))#; БИК #($G(bik3))#, K/C #($G(ksch3))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl29 style='mso-ignore:colspan'></td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=29 style='mso-height-source:userset;height:22.35pt'>
  <td height=29 class=xl24 style='height:22.35pt'></td>
  <td class=xl29></td>
  <td class=xl29>Плательщик</td>
  <td colspan=31 class=xl100 width=806 style='width:608pt'>#($G(kname4))#, #($G(Postalcode4))#, 
	#($G(namecity4))#,&nbsp; #($G(Address4))#, #($G(rsch4))#, #($G(pbank2))#, 
	#($G(city4))#; #($G(bik4))#, #($G(ksch4))#</td>
  <td colspan=3 class=xl118 style='border-right:1.0pt solid black'>по ОКПО</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=3 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>организация,
  адрес, телефон, факс, банковские реквизиты</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 rowspan=2 class=xl101>номер</td>
  <td rowspan=2 class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 class=xl24 style='height:12.6pt'></td>
  <td class=xl29></td>
  <td class=xl29>Основание</td>
  <td colspan=31 class=xl126>Счет № *** от **.**.**** г.№ #(nomnakl)#</td>
  <td class=xl24></td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=26 class=xl35 align=center style='mso-ignore:colspan'>договор, заказ-наряд</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=10 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td colspan=4 class=xl102>Номер документа</td>
  <td colspan=4 class=xl102 style='border-left:none'>Дата составления</td>
  <td colspan=7 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=9 class=xl118>Транспортная накладная</td>
  <td class=xl24></td>
  <td colspan=2 class=xl101>номер</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=3 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl38></td>
  <td colspan=6 class=xl115 style='border-right:1.0pt solid black'>ТОВАРНАЯ НАКЛАДНАЯ<span style='mso-spacerun:yes'>  </span></td>
  <td colspan=4 class=xl103 style='border-left:none'>#(nomnakl)#</td>
  <td colspan=4 class=xl104 style='border-left:none'>#($G(docdate))#</td>
  <td colspan=17 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl101>дата</td>
  <td class=xl37>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=16 style='mso-height-source:userset;height:12.6pt'>
  <td height=16 colspan=35 class=xl24 style='height:12.6pt;mso-ignore:colspan'></td>
  <td class=xl29></td>
  <td class=xl29>Вид операции</td>
  <td class=xl39>&nbsp;</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl40 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=36 class=xl40 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl41 style='mso-ignore:colspan'></td>
  <td class=xl41>Страница 1</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl40 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 class=xl42 style='height:11.1pt'>&nbsp;</td>
  <td rowspan=2 class=xl43 width=34 style='width:26pt'>Но-<br>мер<br> по по-<br>рядку</td>
  <td colspan=5 class=xl26 style='border-left:none'>Товар</td>
  <td colspan=5 class=xl26 style='border-left:none'>Единица измерения</td>
  <td rowspan=2 class=xl43 width=41 style='width:31pt'>Вид упаковки</td>
  <td colspan=4 class=xl26 style='border-left:none'>Количество</td>
  <td colspan=4 rowspan=2 class=xl43 width=48 style='width:36pt'>Масса брутто</td>
  <td colspan=2 rowspan=2 class=xl43 width=61 style='width:46pt'>Коли-<br>
    чество <br>
    (масса <br>
    нетто)</td>
  <td colspan=2 rowspan=2 class=xl43 width=79 style='width:60pt'>Цена,<br>
    руб. коп.</td>
  <td colspan=5 rowspan=2 class=xl43 width=88 style='width:66pt'>Сумма
  без<br>
    учета НДС,<br>
    руб. коп.</td>
  <td colspan=6 class=xl26 style='border-left:none'>НДС</td>
  <td colspan=3 rowspan=2 class=xl43 width=89 style='width:67pt'>Сумма с<br>
    учетом <br>
    НДС, <br>
    руб. коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl40 height=57 style='mso-height-source:userset;height:43.35pt'>
  <td height=57 class=xl42 style='height:43.35pt'>&nbsp;</td>
  <td colspan=4 class=xl43 width=209 style='border-left:none;width:158pt'>наименование, характеристика, сорт, артикул товара</td>
  <td class=xl26 style='border-top:none;border-left:none'>код</td>
  <td colspan=4 class=xl43 width=55 style='border-left:none;width:42pt'>наиме-нование</td>
  <td class=xl43 width=44 style='border-top:none;border-left:none;width:33pt'>код по ОКЕИ</td>
  <td colspan=3 class=xl43 width=42 style='border-left:none;width:32pt'>в одном месте</td>
  <td class=xl43 width=55 style='border-top:none;border-left:none;width:41pt'>мест,<br> штук</td>
  <td colspan=3 class=xl43 width=61 style='border-left:none;width:46pt'>ставка, %</td>
  <td colspan=3 class=xl43 width=79 style='border-left:none;width:60pt'>сумма, <br>руб. коп.</td>
  <td class=xl40></td>
 </tr>
 <tr class=xl44 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl45 style='height:11.25pt'>&nbsp;</td>
  <td class=xl46 style='border-top:none' >1</td>
  <td colspan=4 class=xl46 style='border-left:none' >2</td>
  <td class=xl47 style='border-top:none;border-left:none' >3</td>
  <td colspan=4 class=xl46 style='border-left:none' >4</td>
  <td class=xl47 style='border-top:none;border-left:none' >5</td>
  <td class=xl47 style='border-top:none;border-left:none' >6</td>
  <td colspan=3 class=xl47 style='border-left:none' >7</td>
  <td class=xl47 style='border-top:none;border-left:none' >8</td>
  <td colspan=4 class=xl47 style='border-left:none' >9</td>
  <td colspan=2 class=xl47 style='border-left:none' >10</td>
  <td colspan=2 class=xl47 style='border-left:none' >11</td>
  <td colspan=5 class=xl47 style='border-left:none' >12</td>
  <td colspan=3 class=xl46 style='border-left:none' >13</td>
  <td colspan=3 class=xl47 style='border-left:none' >14</td>
  <td colspan=3 class=xl47 style='border-left:none' >15</td>
  <td class=xl44></td>
 </tr>
 
  
 <script language="cache" runat="server">
  s vsegoquant=""
  s vsegosummabeznds=""
  s vsegondsotsumma=""
  s vsegosummasnds=""  
  s ndsprocent=nds*100
  if NDSinside="true" s ndsprocent=0
  d:$ISOBJECT(doc.Items)
 . s totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . .i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . s quant=item.Quantity
 . . s itempr=item.Price
 . . i NDSinside="false" d
 . . . s price=$J(kurs*itempr,".",2)
 . . . s summabeznds=$J(price*quant,".",2)
 . . . s ndsotsumma=$J(summabeznds-(summabeznds*antinds),".",2)
 . . . s summasnds=$J(summabeznds+ndsotsumma,".",2)
 . . e  d
 . . . s price=$J(kurs*itempr*antinds,".",2)
 . . . s summabeznds=$J(quant*price,".",2)
 . . . s ndsotsumma=$J(summabeznds*nds,".",2)
 . . . s summasnds=summabeznds+ndsotsumma
 . . // подсчёт итогов по колонкам
 . . s vsegoquant=vsegoquant+quant
 . . s vsegondsotsumma=vsegondsotsumma+ndsotsumma
 . . s vsegosummabeznds=vsegosummabeznds+summabeznds
 . . w "<tr class=xl40 height=29 style='mso-height-source:userset;height:22.35pt'>"
 . . w "<td height=29 class=xl42 style='height:22.35pt'>&nbsp;</td>"
 . . w "<td class=xl95 style='border-top:none'>"_count_"</td>"
 . . w "<td colspan=4 class=xl105 width=209 style='width:158pt'>"_$G(goods)_"</td>"
 . . w "<td class=xl48 width=71 style='border-top:none;width:53pt'>&nbsp;</td>"		//код
 . . w "<td colspan=4 class=xl106>шт</td>"
 . . w "<td class=xl49 width=44 style='border-top:none;width:33pt'>&nbsp;</td>"		//код по ОКЕИ
 . . w "<td class=xl50 style='border-top:none'>&nbsp;</td>"
 . . w "<td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl51 style='border-top:none'>&nbsp;</td>"
 . . w "<td class=xl53 style='border-top:none'>&nbsp;</td>"
 . . w "<td class=xl54 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl52 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl51 style='border-top:none'>&nbsp;</td>"
 . . w "<td class=xl51 style='border-top:none'>&nbsp;</td>"
 . . w "<td class=xl53 style='border-top:none'>&nbsp;</td>"
 . . w "<td colspan=2 class=xl107 width=61 style='border-left:none;width:46pt' >"_quant_"</td>"			//количество
 . . w "<td colspan=2 class=xl90 style='border-left:none'>"_price_"</td>"
 . . w "<td colspan=5 class=xl91 width=88 style='border-left:none;width:66pt'>"_summabeznds_"</td>"
 . . w "<td colspan=3 class=xl127>"_ndsprocent_"</td>"
 . . w "<td class=""xl57"" width=26 style='border-top:none;width:20pt;border-left:.5pt solid windowtext;' colspan=3>"_ndsotsumma_"</td>"
 . . w "<td colspan=3 class=xl92 width=89 style='border-left:none;width:67pt'>"_summasnds_"</td>"
 . . w "<td class=xl40></td>"
 . . w "</tr>"
 s vsegosummasnds=vsegosummabeznds+vsegondsotsumma
 
 </script>
  
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl61></td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl60>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl59>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl58>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td class=xl62>&nbsp;</td>
  <td colspan=3 class=xl121 style='border-right:.5pt solid black' >Итого<span
  style='mso-spacerun:yes'> </span></td>
  <td class=xl63 style='border-left:none'>&nbsp;</td>
  <td class=xl65>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl64>&nbsp;</td>
  <td class=xl66>&nbsp;</td>
  <td colspan=2 class=xl88 width=61 style='width:46pt'>#($J(vsegoquant,".",0))#</td>
  <td colspan=2 class=xl89>Х</td>
  <td colspan=5 class=xl108 width=88 style='width:66pt'>#($J(vsegosummabeznds,".",2))#</td>
  <td colspan=3 class=xl109>Х</td>
  <td class=xl68 width=43 style='width:33pt' colspan=2>#($J(vsegondsotsumma,".",2))#</td>
  <td class=xl69 width=36 style='width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl93 width=89 style='width:67pt'>#($J(vsegosummasnds,".",2))#</td>
  <td></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl58 style='height:11.85pt'>&nbsp;</td>
  <td colspan=10 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl123 style='border-right:.5pt solid black'>Всего по накладной<span
  style='mso-spacerun:yes'> </span></td>
  <td class=xl71 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl73 style='border-top:none;border-left:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl72 style='border-top:none'>&nbsp;</td>
  <td class=xl74 style='border-top:none'>&nbsp;</td>
  <td colspan=2 class=xl94 width=61 style='border-left:none;width:46pt'>#($J(vsegoquant,".",0))#</td>
  <td colspan=2 class=xl50 style='border-left:none'>Х</td>
  <td colspan=5 class=xl87 width=88 style='border-left:none;width:66pt'>#($J(vsegosummabeznds,".",2))#</td>
  <td colspan=3 class=xl50 style='border-left:none'>Х</td>
  <td class=xl75 width=26 style='border-top:none;border-left:none;width:20pt'>&nbsp;</td>
  <td class=xl55 width=17 style='border-top:none;width:13pt'>&nbsp;</td>
  <td class=xl57 width=36 style='border-top:none;width:27pt'>&nbsp;</td>
  <td colspan=3 class=xl87 width=89 style='border-left:none;width:67pt'>#($J(vsegosummasnds,".",2))#</td>
  <td></td>
 </tr>
 <tr class=xl24 height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 colspan=4 class=xl24 style='height:12.0pt;mso-ignore:colspan'></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>Товарная накладная имеет
  приложение на</td>
  <td class=xl76></td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=18 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:11.1pt'>
  <td height=14 colspan=4 class=xl24 style='height:11.1pt;mso-ignore:colspan'></td>
  <td class=xl24>и содержит</td>
  <td class=xl78 colspan=2 style='mso-ignore:colspan'><!-- Три --></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl79 style='border-top:none'>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=8 style='mso-ignore:colspan'>порядковых номеров записей</td>
  <td colspan=8 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=27 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=5 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=3 rowspan=3 class=xl78>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span style='mso-spacerun:yes'>     </span>Масса груза (нетто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl77>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td class=xl81>&nbsp;</td>
  <td colspan=5 class=xl81>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=13 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=7 rowspan=2 class=xl110>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl24>Всего мест</td>
  <td class=xl24></td>
  <td class=xl24 colspan=6 style='mso-ignore:colspan'><span
  style='mso-spacerun:yes'>     </span>Масса груза (брутто)</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td class=xl82>&nbsp;</td>
  <td colspan=5 class=xl111>&nbsp;</td>
  <td class=xl24></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 colspan=5 class=xl24 style='height:8.1pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=11 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl80 align=center>прописью</td>
  <td colspan=20 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=6 style='mso-height-source:userset;height:5.1pt'>
  <td height=6 colspan=40 class=xl24 style='height:5.1pt;mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl24 style='height:9.75pt'></td>
  <td class=xl24 colspan=5 style='mso-ignore:colspan'>Приложение (паспорта, сертификаты и т.п.) на</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>листах</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl70></td>
  <td class=xl70>По доверенности №</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=3 class=xl85 align=center style='mso-ignore:colspan'>от</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 colspan=6 class=xl24 style='height:10.5pt;mso-ignore:colspan'></td>
  <td colspan=3 class=xl83>прописью</td>
  <td colspan=9 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=13 style='mso-height-source:userset;height:10.35pt'>
  <td height=13 class=xl24 style='height:10.35pt'></td>
  <td class=xl86 colspan=4 style='mso-ignore:colspan'>Всего отпущено на сумму</td>
  <td colspan=10 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=4 class=xl84>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>выданной</td>
  <td class=xl24></td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
  <td class=xl78>&nbsp;</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=18 class=xl112 width=575 style='width:434pt'><!-- Пятьдесят один рубль 00 копеек --></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>кем, кому (организация, должность, фамилия, и. о.)</td>
  <td colspan=14 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=10 style='mso-height-source:userset;height:8.1pt'>
  <td height=10 class=xl24 style='height:8.1pt'></td>
  <td colspan=14 class=xl113>прописью</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза разрешил</td>
  <td class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td class=xl129></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=10 class=xl130 width=218 style='width:164pt'>Креймер А.Я. <font
  class="font16">(по доверенности №#(DoverennNumber)# от #(DoverennDatValue)# )</font></td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr class=xl24 height=12 style='mso-height-source:userset;height:9.0pt'>
  <td height=12 colspan=4 class=xl24 style='height:9.0pt;mso-ignore:colspan'></td>
  <td class=xl131>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl132 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl133>расшифровка подписи</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td colspan=3 class=xl86 style='mso-ignore:colspan'></td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=10 class=xl134 width=218 style='width:164pt'></td>
  <td class=xl24></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Груз принял</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=6 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td colspan=2 class=xl135 style='mso-ignore:colspan'></td>
  <td class=xl24></td>
  <td colspan=10 class=xl136>&nbsp;</td>
  <td colspan=5 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl24 style='height:11.85pt'></td>
  <td class=xl24 colspan=3 style='mso-ignore:colspan'>Отпуск груза произвел</td>
  <td class=xl128 width=109 style='width:82pt'>&nbsp;</td>
  <td class=xl129></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=10 class=xl130 width=218 style='width:164pt'>Кашменский Ю.Е.</td>
  <td class=xl24></td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan' >Груз получил</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td colspan=5 class=xl28>&nbsp;</td>
  <td class=xl24></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
  <td class=xl28>&nbsp;</td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=4 class=xl24 style='height:11.25pt;mso-ignore:colspan'></td>
  <td class=xl83>должность</td>
  <td class=xl24></td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>подпись</td>
  <td class=xl24></td>
  <td colspan=10 class=xl114>расшифровка подписи</td>
  <td class=xl24></td>
  <td class=xl40 colspan=4 style='mso-ignore:colspan'>грузополучатель</td>
  <td colspan=2 class=xl80 align=center style='mso-ignore:colspan'>должность</td>
  <td class=xl24></td>
  <td colspan=5 class=xl83>подпись</td>
  <td class=xl24></td>
  <td colspan=7 class=xl80 align=center style='mso-ignore:colspan'>расшифровка подписи</td>
 </tr>
 <tr class=xl24 height=6 style='mso-height-source:userset;height:5.1pt'>
  <td height=6 colspan=18 class=xl24 style='height:5.1pt;mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=21 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <tr class=xl24 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl24 style='height:11.25pt'></td>
  <td colspan=2 class=xl70 style='mso-ignore:colspan'></td>
  <td class=xl70>М.П.</td>
  <td class=xl24></td>
  <td class=xl70><!-- &quot;15&quot; --></td>
  <td class=xl28><!-- августа --></td>
  <td class=xl28>&nbsp;</td>
  <td class=xl24 colspan=4 style='mso-ignore:colspan'>20___ г</td>
  <td colspan=6 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl84>&nbsp;</td>
  <td colspan=3 class=xl24 style='mso-ignore:colspan'></td>
  <td colspan=2 class=xl85 align=center style='mso-ignore:colspan'>М.П.</td>
  <td colspan=2 class=xl24 style='mso-ignore:colspan'></td>
  <td class=xl24 colspan=10 style='mso-ignore:colspan'>&quot;_____&quot; _____________ 20__ г</td>
  <td colspan=4 class=xl24 style='mso-ignore:colspan'></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=7 style='width:5pt'></td>
  <td width=34 style='width:26pt'></td>
  <td width=74 style='width:56pt'></td>
  <td width=14 style='width:11pt'></td>
  <td width=109 style='width:82pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=71 style='width:53pt'></td>
  <td width=30 style='width:23pt'></td>
  <td width=13 style='width:10pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=3 style='width:2pt'></td>
  <td width=44 style='width:33pt'></td>
  <td width=41 style='width:31pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=30 style='width:23pt'></td>
  <td width=3 style='width:2pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=46 style='width:35pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=26 style='width:20pt'></td>
  <td width=53 style='width:40pt'></td>
  <td width=37 style='width:28pt'></td>
  <td width=11 style='width:8pt'></td>
  <td width=27 style='width:20pt'></td>
  <td width=4 style='width:3pt'></td>
  <td width=9 style='width:7pt'></td>
  <td width=7 style='width:5pt'></td>
  <td width=42 style='width:32pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=26 style='width:20pt'></td>
  <td width=17 style='width:13pt'></td>
  <td width=36 style='width:27pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=76 style='width:57pt'></td>
  <td width=1 style='width:1pt'></td>
  <td width=3 style='width:2pt'></td>
 </tr>
 <![endif]>
</table>

</body>

</html>
]]></CSP>


<CSP name="screen/tovnakl.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s kontr3=%request.Get("kontr3")
 s kontr4=%request.Get("kontr4")
 s docid=%request.Get("id")
 s docname="Платежное поручение"
 s nomnakl=%request.Get("nomernakladnoy")
 s NDSinside=%request.Get("NDSinside")
 s DocDate=%request.Get("DocDate")

 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
 . s:DocDate'="" docdate=DocDate
 . q:$G(docdate)=""
 . s docdate=$TR(docdate,"/",".")
 . s kurs=doc.kurs
 . if '+kurs s kurs=doc.RubSumma/doc.Summa
 
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s kname1=k.Name
 . s Address1=k.Address
 . s bank1=k.bank
 . s codecity1=k.CityCode
 . s namecity1=k.City
 . s Postalcode1=k.Postalcode
 . d:$ISOBJECT(bank1)
 . . s pbank1=bank1.pbank
 . . s city1=bank1.city
 . . s kpp1=bank1.kpp
 . . s inn1=bank1.inn
 . . s bik1=bank1.bik
 . . s rsch1=bank1.rsch
 . . s ksch1=bank1.ksch
 . . s code1=bank1.code
 . . s okpo1=bank1.okpo
 
 . . s okud1=bank1.okud
 . . s okpo1=bank1.okpo
 . . s okdp1=bank1.okdp
 
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s kname2=k.Name
 . s Address2=k.Address
 . s bank2=k.bank
 . s codecity2=k.CityCode
 . s namecity2=k.City
 . s contract = k.Agree
 . s Postalcode2=k.Postalcode
 . d:$ISOBJECT(bank2)
 . . s pbank2=bank2.pbank
 . . s city2=bank2.city
 . . s kpp2=bank2.kpp
 . . s inn2=bank2.inn
 . . s bik2=bank2.bik
 . . s rsch2=bank2.rsch
 . . s ksch2=bank2.ksch
 . . s code2=bank2.code
 . . s okpo2=bank2.okpo
 . . s okpo2=bank2.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr3)
 d:$ISOBJECT(k)
 . s kname3=k.Name
 . s Address3=k.Address
 . s bank3=k.bank
 . s chief=k.chief
 . s buh=k.glavbuh
 . s codecity3=k.CityCode
 . s namecity3=k.City
 . s Postalcode3=k.Postalcode
 . d:$ISOBJECT(bank3)
 . . s pbank3=bank3.pbank
 . . s city3=bank3.city
 . . s kpp3=bank3.kpp
 . . s inn3=bank3.inn
 . . s bik3=bank3.bik
 . . s rsch3=bank3.rsch
 . . s ksch3=bank3.ksch
 . . s code3=bank3.code
 . . s okpo3=bank3.okpo
 . . s okpo3=bank3.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr4)
 d:$ISOBJECT(k)
 . s kname4=k.Name
 . s Address4=k.AddressUr
 . s bank4=k.bank
 . s codecity4=k.CityCode
 . s namecity4=k.CityUr
 . s Postalcode4=k.PostalcodeUr
 . d:$ISOBJECT(bank4)
 . . s pbank4=bank4.pbank
 . . s city4=bank4.city
 . . s kpp4=bank4.kpp
 . . s inn4=bank4.inn
 . . s bik4=bank4.bik
 . . s rsch4=bank4.rsch
 . . s ksch4=bank4.ksch
 . . s code4=bank4.code
 . . s okpo4=bank4.okpo
 . . s okpo4=bank4.okpo
 
 s waste=##class(Goods.GoodsAction).kurs(.other)
 s:'+$G(kurs) kurs=waste
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">
<title>Товарная накладная #(nomnakl)#</title>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 11">
<link href="screen/tovnakl.css" type=text/css rel=stylesheet>
<link href="tovnakl.css" type=text/css rel=stylesheet>
</head>

<body>
<!--[if !excel]>&nbsp;&nbsp;<![endif]-->
<!--Следующие сведения были подготовлены мастером публикации веб-страниц
Microsoft Office Excel.-->
<!--При повторной публикации этого документа из Excel все сведения между тегами
DIV будут заменены.-->
<!----------------------------->
<!--НАЧАЛО ФРАГМЕНТА ПУБЛИКАЦИИ МАСТЕРА ВЕБ-СТРАНИЦ EXCEL -->
<!----------------------------->

<div id="ттн торг 12_29490" align=center x:publishsource="Excel">

<table x:str border=0 cellpadding=0 cellspacing=0 width=1005 class=xl2229490
 style='border-collapse:collapse;table-layout:fixed;width:753pt'>
 <col class=xl2229490 width=39 style='mso-width-source:userset;mso-width-alt:
 1426;width:29pt'>
 <col class=xl2229490 width=117 style='mso-width-source:userset;mso-width-alt:
 4278;width:88pt'>
 <col class=xl2229490 width=115 style='mso-width-source:userset;mso-width-alt:
 4205;width:86pt'>
 <col class=xl2229490 width=39 style='mso-width-source:userset;mso-width-alt:
 1426;width:29pt'>
 <col class=xl2229490 width=49 style='mso-width-source:userset;mso-width-alt:
 1792;width:37pt'>
 <col class=xl2229490 width=33 style='mso-width-source:userset;mso-width-alt:
 1206;width:25pt'>
 <col class=xl2229490 width=43 style='mso-width-source:userset;mso-width-alt:
 1572;width:32pt'>
 <col class=xl2229490 width=47 style='mso-width-source:userset;mso-width-alt:
 1718;width:35pt'>
 <col class=xl2229490 width=35 style='mso-width-source:userset;mso-width-alt:
 1280;width:26pt'>
 <col class=xl2229490 width=43 style='mso-width-source:userset;mso-width-alt:
 1572;width:32pt'>
 <col class=xl2229490 width=55 style='mso-width-source:userset;mso-width-alt:
 2011;width:41pt'>
 <col class=xl2229490 width=67 style='mso-width-source:userset;mso-width-alt:
 2450;width:50pt'>
 <col class=xl2229490 width=60 style='mso-width-source:userset;mso-width-alt:
 2194;width:45pt'>
 <col class=xl2229490 width=46 style='mso-width-source:userset;mso-width-alt:
 1682;width:35pt'>
 <col class=xl2229490 width=55 style='mso-width-source:userset;mso-width-alt:
 2011;width:41pt'>
 <col class=xl2229490 width=74 style='mso-width-source:userset;mso-width-alt:
 2706;width:56pt'>
 <col class=xl2229490 width=51 style='mso-width-source:userset;mso-width-alt:
 1865;width:38pt'>
 <col class=xl2229490 width=37 style='mso-width-source:userset;mso-width-alt:
 1353;width:28pt'>
 <col class=xl2229490 width=0 span=57 style='display:none;mso-width-source:
 userset;mso-width-alt:0'>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 width=39 style='height:11.25pt;width:29pt'></td>
  <td class=xl2229490 width=117 style='width:88pt'></td>
  <td class=xl2229490 width=115 style='width:86pt'></td>
  <td class=xl2229490 width=39 style='width:29pt'></td>
  <td class=xl2229490 width=49 style='width:37pt'></td>
  <td class=xl2229490 width=33 style='width:25pt'></td>
  <td class=xl2229490 width=43 style='width:32pt'></td>
  <td class=xl2229490 width=47 style='width:35pt'></td>
  <td class=xl2229490 width=35 style='width:26pt'></td>
  <td class=xl2229490 width=43 style='width:32pt'></td>
  <td class=xl2229490 width=55 style='width:41pt'></td>
  <td class=xl2229490 width=67 style='width:50pt'></td>
  <td class=xl2229490 width=60 style='width:45pt'></td>
  <td class=xl2329490 colspan=3 width=175 style='width:132pt'>Унифицированная 
	форма N ТОРГ-12</td>
  <td class=xl2329490 width=51 style='width:38pt'></td>
  <td class=xl2329490 width=37 style='width:28pt'></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=4>Утверждена постановлением Госкомстата</td>
  <td class=xl2329490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>России от 25.12.98 N 132</td>
  <td class=xl2329490></td>
  <td class=xl2329490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl2229490 style='height:12.0pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl2429490 style='height:13.5pt'></td>
  <td class=xl2429490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2629490></td>
  <td class=xl2629490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2729490>Код</td>
  <td class=xl2829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2629490></td>
  <td class=xl2629490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=2>Форма по ОКУД</td>
  <td colspan=2 class=xl11829490 style='border-right:1.0pt solid black' x:num>
	#($G(okud1))#</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr>
  <td class=xl2429490></td>
  <td colspan=12 class=xl7729490 width=703 style='width:526pt'>#($G(kname1))#, 
	#($G(Postalcode1))#, #($G(namecity1))#, #($G(Address1))#, Р/C #($G(rsch1))#, 
	#($G(pbank1))#, #($G(city1))#; БИК #($G(bik1))#, К/С #($G(ksch1))#</td>
  <td class=xl2929490 colspan=2>по ОКПО</td>
  <td colspan=2 class=xl13229490 style='border-right:1.0pt solid black'
  x:str="114 806 70">#($G(okpo1))#</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=23 style='mso-height-source:userset;height:17.25pt'>
  <td height=23 class=xl2429490 style='height:17.25pt'></td>
  <td class=xl3029490 style='border-top:none'>&nbsp;</td>
  <td class=xl3129490 style='border-top:none'>&nbsp;</td>
  <td class=xl3229490 colspan=9>
	организация-грузоотправитель,адрес,телефон,факс,банковские реквизиты</td>
  <td class=xl3129490 style='border-top:none'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl3529490 style='border-top:none'>&nbsp;</td>
  <td class=xl3629490 style='border-top:none'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl2429490 style='height:12.0pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2429490></td>
  <td class=xl3729490></td>
  <td class=xl3829490 colspan=4><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>структурное подразделение</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=3>Вид деятельности по ОКДП</td>
  <td colspan=2 class=xl13229490 style='border-right:1.0pt solid black'
  x:str="114 806 70">#($G(okdp1))#</td>
  <td class=xl4129490 style='border-top:medium none; ; border-right-style:none; border-right-width:medium'>
	&nbsp;</td>
  <td class=xl2229490 style="border-left-style: none; border-left-width: medium"></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=31 style='mso-height-source:userset;height:23.25pt'>
  <td class=xl2429490></td>
  <td>Грузополучатель</td>
  <td colspan=11 class=xl7729490 width=703 style='width:526pt'>#($G(kname2))#, 
	#($G(Postalcode2))#, #($G(namecity2))#,&nbsp; #($G(Address2))#, P/C #($G(rsch2))#, 
	#($G(pbank2))#, #($G(city2))#; БИК #($G(bik2))#, K/C #($G(ksch2))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="                    "><span
  style='mso-spacerun:yes'>#($G(okpo2))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:8.25pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2229490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские 
	реквизиты</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4529490>&nbsp;</td>
  <td class=xl4629490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Поставщик</td>
  <td colspan=11 class=xl7729490 width=703>#($G(kname3))#, #($G(Postalcode3))#, 
	#($G(namecity3))#,&nbsp; #($G(Address3))#, P/C #($G(rsch3))#, #($G(pbank3))#, 
	#($G(city3))#; БИК #($G(bik3))#, K/C #($G(ksch3))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="114 806 70          "><span
  style='mso-spacerun:yes'>&nbsp;#($G(okpo3))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:9.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2229490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские 
	реквизиты</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4529490>&nbsp;</td>
  <td class=xl4629490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Плательщик</td>
  <td colspan=11 class=xl7729490 width=703>#($G(kname4))#, #($G(Postalcode4))#, 
	#($G(namecity4))#,&nbsp; #($G(Address4))#, #($G(rsch4))#, #($G(pbank2))#, 
	#($G(city4))#; #($G(bik4))#, #($G(ksch4))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="                    "><span
  style='mso-spacerun:yes'>#($G(okpo4))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:9.0pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2629490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские 
	реквизиты</td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4829490>&nbsp;</td>
  <td class=xl4929490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Основание</td>
  <td class=xl5029490 colspan="11">Договор № #($G(contract))#</td>
  <td class=xl4729490></td>
  <td class=xl2629490>номер</td>
  <td colspan=2 class=xl4829490 style='border-right:1.0pt solid black'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl2429490></td>
  <td class=xl5629490></td>
  <td class=xl4329490 colspan=3>договор,заказ-наряд</td>
  <td class=xl4429490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>дата</td>
  <td colspan=2 class=xl13629490 style='border-right:1.0pt solid black'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl5929490></td>
  <td class=xl6029490></td>
  <td class=xl6029490></td>
  <td class=xl5729490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>номер</td>
  <td class=xl6129490>&nbsp;</td>
  <td class=xl6229490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl6329490></td>
  <td class=xl4429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>дата</td>
  <td class=xl6129490>&nbsp;</td>
  <td class=xl6229490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl2429490 style='height:13.5pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5729490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td colspan=2 rowspan=2 class=xl14829490 width=98 style='border-right:.5pt solid black;
  border-bottom:1.0pt solid black;width:73pt'>Номер<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	документа</td>
  <td colspan=2 rowspan=2 class=xl14429490 width=127 style='border-right:.5pt solid black;
  border-bottom:1.0pt solid black;width:95pt'>Дата<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	составления</td>
  <td class=xl2629490 colspan=2><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>Вид операции</td>
  <td class=xl6429490>&nbsp;</td>
  <td class=xl6529490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl2429490 style='height:12.0pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4429490></td>
  <td class=xl2429490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=25 style='height:18.75pt'>
  <td height=25 class=xl2429490 style='height:18.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl4429490></td>
  <td class=xl6629490 colspan=5>Товарная накладная</td>
  <td colspan=2 class=xl13829490 style='border-right:1.0pt solid black' x:num>
   #(nomnakl)#</td>
  <td colspan=2 class=xl14029490 style='border-right:1.0pt solid black;
  border-left:none' x:num="38929">#($G(docdate))#
  </td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6929490></td>
  <td class=xl5929490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=26 style='mso-height-source:userset;height:19.5pt'>
  <td rowspan=2 height=86 class=xl12829490 width=39 style='border-bottom:.5pt solid black;
  height:64.5pt;width:29pt'>Номер по поряд-ку</td>
  <td colspan=3 class=xl12929490 width=271 style='border-right:.5pt solid black;
  border-left:none;width:203pt' x:str="Товар ">Товар<span
  style='mso-spacerun:yes'>&nbsp;</span></td>
  <td colspan=2 class=xl7029490 width=82 style='border-left:none;width:62pt'>
	Единица измерения</td>
  <td rowspan=2 class=xl12129490 width=43 style='border-bottom:.5pt solid black;
  width:32pt'>Вид упаков-ки</td>
  <td colspan=2 class=xl12929490 width=82 style='border-right:.5pt solid black;
  border-left:none;width:61pt'>Количество</td>
  <td rowspan=2 class=xl12829490 width=43 style='border-bottom:.5pt solid black;
  width:32pt'>Масса брутто</td>
  <td rowspan=2 class=xl12829490 width=55 style='border-bottom:.5pt solid black;
  width:41pt' x:str="Количест- во  (масса нетто) ">Количест- во<span
  style='mso-spacerun:yes'>&nbsp; </span>(масса нетто)<span
  style='mso-spacerun:yes'>&nbsp;</span></td>
  <td rowspan=2 class=xl12129490 width=67 style='border-bottom:.5pt solid black;
  width:50pt'>Цена<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>руб.коп.</td>
  <td rowspan=2 class=xl12129490 width=60 style='border-bottom:.5pt solid black;
  width:45pt'>Сумма без учета НДС, руб.коп.</td>
  <td colspan=2 class=xl12429490 width=101 style='border-right:.5pt solid black;
  border-left:none;width:76pt'>НДС</td>
  <td rowspan=2 class=xl12129490 width=74 style='border-bottom:.5pt solid black;
  width:56pt'>Сумма с учетом НДС, руб.коп.</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=60 style='height:45.0pt'>
  <td colspan=2 height=60 class=xl12929490 width=232 style='border-right:.5pt solid black;
  height:45.0pt;border-left:none;width:174pt'>Наименование, характеристика,сорт, 
	артикул товара</td>
  <td class=xl7329490 width=39 style='border-left:none;width:29pt'>Код</td>
  <td class=xl7029490 width=49 style='border-top:none;border-left:none;
  width:37pt'>наиме-нование</td>
  <td class=xl7429490 width=33 style='border-top:none;border-left:none;
  width:25pt'>код по ОКЕИ</td>
  <td class=xl7429490 width=47 style='border-top:none;border-left:none;
  width:35pt'>в одном месте</td>
  <td class=xl7429490 width=35 style='border-top:none;border-left:none;
  width:26pt'>мест, штук</td>
  <td class=xl7429490 width=46 style='border-top:none;border-left:none;
  width:35pt'>Ставка, %</td>
  <td class=xl7429490 width=55 style='border-top:none;border-left:none;
  width:41pt'>сумма, руб.коп.</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=16 style='height:12.0pt'>
  <td height=16 class=xl7029490 width=39 style='height:12.0pt;border-top:none;
  width:29pt' x:num>1</td>
  <td colspan=2 class=xl12929490 width=232 style='border-right:.5pt solid black;
  border-left:none;width:174pt' x:num>2</td>
  <td class=xl7029490 width=39 style='border-top:none;border-left:none;
  width:29pt' x:num>3</td>
  <td class=xl7029490 width=49 style='border-top:none;border-left:none;
  width:37pt' x:num>4</td>
  <td class=xl7029490 width=33 style='border-top:none;border-left:none;
  width:25pt' x:num>5</td>
  <td class=xl7029490 width=43 style='border-top:none;border-left:none;
  width:32pt' x:num>6</td>
  <td class=xl7029490 width=47 style='border-top:none;border-left:none;
  width:35pt' x:num>7</td>
  <td class=xl7029490 width=35 style='border-top:none;border-left:none;
  width:26pt' x:num>8</td>
  <td class=xl7029490 width=43 style='border-top:none;border-left:none;
  width:32pt' x:num>9</td>
  <td class=xl7029490 width=55 style='border-top:none;border-left:none;
  width:41pt' x:num>10</td>
  <td class=xl7029490 width=67 style='border-top:none;border-left:none;
  width:50pt' x:num>11</td>
  <td class=xl7029490 width=60 style='border-top:none;border-left:none;
  width:45pt' x:num>12</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>13</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>14</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>15</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <script language="cache" runat="server">
  s vsegoquant=""
  s vsegosummabeznds=""
  s vsegondsotsumma=""
  s vsegosummasnds=""  
  s ndsprocent=nds*100
  d:$ISOBJECT(doc.Items)
 . s totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . .i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . s quant=item.Quantity
 . . s itempr=item.Price
 . . i NDSinside="false" d
 . . . s price=$J(kurs*itempr,".",2)
 . . . s summabeznds=$J(price*quant,".",2)
 . . . s ndsotsumma=$J(summabeznds-(summabeznds*antinds),".",2)
 . . . s summasnds=$J(summabeznds+ndsotsumma,".",2)
 . . e  d
 . . . s price=$J(kurs*itempr*antinds,".",2)
 . . . s summabeznds=$J(quant*price,".",2)
 . . . s ndsotsumma=$J(summabeznds*nds,".",2)
 . . . s summasnds=summabeznds+ndsotsumma
 . . // подсчёт итогов по колонкам
 . . s vsegoquant=vsegoquant+quant
 . . s vsegondsotsumma=vsegondsotsumma+ndsotsumma
 . . s vsegosummabeznds=vsegosummabeznds+summabeznds
 . . w "<tr class=xl7229490 height=15 style='height:11.25pt'>"
 . . w "<td height=15 class=xl7629490 width=39 style='height:11.25pt;border-top:none;"
 . . w "width:29pt' x:num>"_count_"</td>"
 . . w "<td colspan=2 class=xl14229490 width=232 style='border-right:.5pt solid black;"
 . . w "border-left:none;width:174pt'>"_$G(goods)_"</td>"
 . . w "<td class=xl7829490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl7929490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_quant_"</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_price_"</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_summabeznds_"</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_ndsprocent_"%</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_ndsotsumma_"</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_summasnds_"</td>"
 s vsegosummasnds=vsegosummabeznds+vsegondsotsumma
 f i=1:1:59 w "<td class=xl2229490></td>"
 w "</tr>"
 </script>
 <tr class=xl7229490 height=16 style='height:12.0pt'>
  <td height=16 class=xl4729490 style='height:12.0pt'></td>
  <td class=xl8129490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl8229490 colspan=3>Всего по накладной</td>
  <script language="cache" runat="server">
  w "<td class=xl8329490 style='border-top:none'>&nbsp;</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_vsegoquant_"</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_$J(vsegosummabeznds,".",2)_"</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_$J(vsegondsotsumma,".",2)_"</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_$J(vsegosummasnds,".",2)_"</td>"
  </script>
  <td class=xl6029490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='page-break-before:always;mso-height-source:userset;height:5.25pt'>
  <td height=7 class=xl2429490 style='height:5.25pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl8429490 colspan=2 x:str="Товарная накладная имеет приложение на ">Товарная накладная имеет приложение на<span style='mso-spacerun:yes'>&nbsp;</span></td>
  <td class=xl8529490 colspan=2><span style='mso-spacerun:yes'>&nbsp; </span></td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl8429490>и содержит</td>
  <td class=xl8529490 x:num></td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8429490 colspan=3>порядковых номеров заисей</td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl1529490 style='height:9.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='mso-height-source:userset;height:5.25pt'>
  <td height=7 class=xl1529490 style='height:5.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8929490>&nbsp;</td>
  <td class=xl9029490>&nbsp;</td>
  <td class=xl9129490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8429490 colspan=3>Масса груза (нетто)</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9229490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9329490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=10 style='mso-height-source:userset;height:7.5pt'>
  <td height=10 class=xl1529490 style='height:7.5pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl9429490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl9529490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl1529490 style='height:12.0pt'></td>
  <td class=xl8429490>Всего мест</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8429490 colspan=3>Масса груза (брутто)</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9629490>&nbsp;</td>
  <td class=xl9729490>&nbsp;</td>
  <td class=xl9829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=11 style='mso-height-source:userset;height:8.25pt'>
  <td height=11 class=xl1529490 style='height:8.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>Прописю</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='mso-height-source:userset;height:5.25pt'>
  <td height=7 class=xl1529490 style='height:5.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=5 style='mso-height-source:userset;height:3.75pt'>
  <td height=5 class=xl1529490 style='height:3.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl9929490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl10029490 colspan=3 style='height:12.75pt'><span
  style='mso-spacerun:yes'>&nbsp;</span>Приложение (паспорта,сертификаты, и т.п.) на</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl10129490>&nbsp;</td>
  <td class=xl1529490 colspan=2 style='border-right:.5pt solid black'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><font class="font529490">
	листах</font></td>
  <td class=xl7229490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl7229490></td>
  <td colspan=2 class=xl10229490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl10029490 style='height:12.75pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl10429490></td>
  <td class=xl1529490></td>
  <td class=xl9929490>&nbsp;</td>
  <td class=xl7229490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl7229490></td>
  <td class=xl10229490></td>
  <td class=xl10329490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=23 style='mso-height-source:userset;height:17.25pt'>
  <td height=23 class=xl10629490 colspan=2 style='height:17.25pt'
  x:str=" Всего отпущено    "><span style='mso-spacerun:yes'>&nbsp;</span>Всего 
	отпущено<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl10729490></td>
  <td class=xl10729490 colspan=2>наименований</td>
  <td class=xl10729490></td>
  <td class=xl10729490></td>
  <td class=xl10729490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl10929490 colspan=2 x:str=" По доверености N "><span
  style='mso-spacerun:yes'>&nbsp;</span>По доверености N<span style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;</span></span></td>
  <td class=xl11029490 x:str="                    "><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl10929490><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	от</td>
  <td class=xl2229490 colspan=2>31 июля 2006 г.</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=15 style='height:11.25pt'>
  <td height=15 class=xl10029490 colspan=2 style='height:11.25pt'
  x:str="  на сумму    "><span style='mso-spacerun:yes'>&nbsp; </span>на сумму<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl5129490 colspan=6><span style='display:none'></span></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl10029490 colspan=2>выданной</td>
  <td class=xl5129490><span style='mso-spacerun:yes'>&nbsp;</span></td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl2229490 style='height:9.75pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=6 style='mso-height-source:userset;height:4.5pt'>
  <td height=6 class=xl2229490 style='height:4.5pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl5129490 style='height:11.25pt'>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl11129490>&nbsp;</td>
  <td class=xl11129490 align=right x:num>
  <script language="cache" runat="server">
  //w $FN(vsegosummasnds,"",0)
  </script>
  </td>
  <td class=xl2229490>руб</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl11229490 x:num>
  <script language="cache" runat="server">
  //w (vsegosummasnds-$FN(vsegosummasnds,"",0))*100
  </script>
  </td>
  <td class=xl11329490>коп</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl11429490 colspan=9 style='height:11.25pt;border-right:
  .5pt solid black'
  x:str="Отпуск груза разрешил  ________________      ________________    _______________________   ">
	Отпуск груза разрешил<span style='mso-spacerun:yes'>&nbsp; </span>(директор)<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><u>#($G(chief))#</u><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl11429490 colspan=9
  x:str="Груз принял  _____________________      __________________    ____________________">
	Груз принял<span style='mso-spacerun:yes'>&nbsp; </span>__________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	__________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>______________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2329490
  x:str="                      должность                       "><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	должность <span
  style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	подпись</td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl2329490 x:str="  должность                       "><span
  style='mso-spacerun:yes'>&nbsp; </span>должность<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td>
  <td class=xl2329490 colspan=3><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	подпись</td>
  <td class=xl2329490 colspan=2><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;
  </span>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=6 style='mso-height-source:userset;height:4.5pt'>
  <td height=6 class=xl2229490 style='height:4.5pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 class=xl11429490 colspan=9 style='height:10.5pt;border-right:
  .5pt solid black'>Главный(старший) бухгалтер<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	______________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><u>
	#($G(buh))#</u></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2329490></td>
  <td class=xl2329490><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>подпись</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl11429490 colspan=8 style='height:11.25pt'
  x:str="Отпуск груза произвел      __________________      __________________    _____________   ">
	Отпуск груза произвел<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>__________________<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>__________________<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
  </span>_____________<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl11429490 colspan=9
  x:str=" Груз получил грузополучатель _____________   _______________   ________________   "><span
  style='mso-spacerun:yes'>&nbsp;</span>Груз получил грузополучатель _____________<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>
	_______________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp; </span>________________<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=17 style='height:12.75pt'>
  <td height=17 class=xl2229490 style='height:12.75pt'></td>
  <td class=xl2329490
  x:str="                      должность                       "><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	должность <span
  style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	подпись</td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2329490
  x:str="                                                 должность                       "><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>должность<span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td>
  <td class=xl2329490 x:str="              "><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
  <td class=xl2329490 x:str="  должность                       "><span
  style='mso-spacerun:yes'>&nbsp; </span>должность<span style='mso-spacerun:yes'>&nbsp;
  </span><span style='display:none'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	подпись</td>
  <td class=xl2329490 colspan=3 style='border-right:.5pt solid black'><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
	расшифровка подписи</td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490 colspan=3>М.П.<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>&lt;&lt;______&gt;&gt;<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;
  </span>_______________<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>года</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=5>М.П.<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>&lt;&lt;______&gt;&gt;<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;
  </span>_______________<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>года</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=39 style='width:29pt'></td>
  <td width=117 style='width:88pt'></td>
  <td width=115 style='width:86pt'></td>
  <td width=39 style='width:29pt'></td>
  <td width=49 style='width:37pt'></td>
  <td width=33 style='width:25pt'></td>
  <td width=43 style='width:32pt'></td>
  <td width=47 style='width:35pt'></td>
  <td width=35 style='width:26pt'></td>
  <td width=43 style='width:32pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=67 style='width:50pt'></td>
  <td width=60 style='width:45pt'></td>
  <td width=46 style='width:35pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=74 style='width:56pt'></td>
  <td width=51 style='width:38pt'></td>
  <td width=37 style='width:28pt'></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
 </tr>
 <![endif]>
</table>

</div>


<!----------------------------->
<!--КОНЕЦ ФРАГМЕНТА ПУБЛИКАЦИИ МАСТЕРА ВЕБ-СТРАНИЦ EXCEL-->
<!----------------------------->
</body>

</html>]]></CSP>


<CSP name="screen/tovnakl2.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 s kontr2=%request.Get("kontr2")
 s kontr=%request.Get("kontr")
 s kontr3=%request.Get("kontr3")
 s kontr4=%request.Get("kontr4")
 s docid=%request.Get("id")
 s docname="Платежное поручение"
 s nomnakl=%request.Get("nomernakladnoy")
 
 s doc=##class(Docs.Rash).%OpenId(docid)
 d:$ISOBJECT(doc)
 . s docname=doc.Name_"-П"
 . s docdate=doc.Dat,docdata=doc.Dat
 . d:docdate'=""
 . . s docdate=$ZD(docdate,4)
 . . s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
 
 s k=##class(Common.Kontragent).%OpenId(kontr)
 d:$ISOBJECT(k)
 . s kname1=k.Name
 . s Address1=k.Address
 . s bank1=k.bank
 . s codecity1=k.CityCode
 . s namecity1=k.City
 . s Postalcode1=k.Postalcode
 . d:$ISOBJECT(bank1)
 . . s pbank1=bank1.pbank
 . . s city1=bank1.city
 . . s kpp1=bank1.kpp
 . . s inn1=bank1.inn
 . . s bik1=bank1.bik
 . . s rsch1=bank1.rsch
 . . s ksch1=bank1.ksch
 . . s code1=bank1.code
 . . s okpo1=bank1.okpo
 
 . . s okud1=bank1.okud
 . . s okpo1=bank1.okpo
 . . s okdp1=bank1.okdp
 
 s k=##class(Common.Kontragent).%OpenId(kontr2)
 d:$ISOBJECT(k)
 . s kname2=k.Name
 . s Address2=k.Address
 . s bank2=k.bank
 . s codecity2=k.CityCode
 . s namecity2=k.City
 . s contract = k.Agree
 . s Postalcode2=k.Postalcode
 . d:$ISOBJECT(bank2)
 . . s pbank2=bank2.pbank
 . . s city2=bank2.city
 . . s kpp2=bank2.kpp
 . . s inn2=bank2.inn
 . . s bik2=bank2.bik
 . . s rsch2=bank2.rsch
 . . s ksch2=bank2.ksch
 . . s code2=bank2.code
 . . s okpo2=bank2.okpo
 . . s okpo2=bank2.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr3)
 d:$ISOBJECT(k)
 . s kname3=k.Name
 . s Address3=k.Address
 . s bank3=k.bank
 . s chief=k.chief
 . s buh=k.glavbuh
 . s codecity3=k.CityCode
 . s namecity3=k.City
 . s Postalcode3=k.Postalcode
 . d:$ISOBJECT(bank3)
 . . s pbank3=bank3.pbank
 . . s city3=bank3.city
 . . s kpp3=bank3.kpp
 . . s inn3=bank3.inn
 . . s bik3=bank3.bik
 . . s rsch3=bank3.rsch
 . . s ksch3=bank3.ksch
 . . s code3=bank3.code
 . . s okpo3=bank3.okpo
 . . s okpo3=bank3.okpo
 
 s k=##class(Common.Kontragent).%OpenId(kontr4)
 d:$ISOBJECT(k)
 . s kname4=k.Name
 . s Address4=k.Address
 . s bank4=k.bank
 . s codecity4=k.CityCode
 . s namecity4=k.City
 . s Postalcode4=k.Postalcode
 . d:$ISOBJECT(bank4)
 . . s pbank4=bank4.pbank
 . . s city4=bank4.city
 . . s kpp4=bank4.kpp
 . . s inn4=bank4.inn
 . . s bik4=bank4.bik
 . . s rsch4=bank4.rsch
 . . s ksch4=bank4.ksch
 . . s code4=bank4.code
 . . s okpo4=bank4.okpo
 . . s okpo4=bank4.okpo
 
 s kurs=##class(Goods.GoodsAction).kurs(.other)
 s kurs2=$J(kurs,".",2)
 s nds=+$G(other("nds"))/100
 s nsp=+$G(other("nsp"))/100
 s antinds=1/(1+nds)
 
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 11">
<link href="screen/tovnakl.css" type=text/css rel=stylesheet>
<link href="tovnakl.css" type=text/css rel=stylesheet>
</head>

<body>
<!--[if !excel]>&nbsp;&nbsp;<![endif]-->
<!--Следующие сведения были подготовлены мастером публикации веб-страниц
Microsoft Office Excel.-->
<!--При повторной публикации этого документа из Excel все сведения между тегами
DIV будут заменены.-->
<!----------------------------->
<!--НАЧАЛО ФРАГМЕНТА ПУБЛИКАЦИИ МАСТЕРА ВЕБ-СТРАНИЦ EXCEL -->
<!----------------------------->

<div id="ттн торг 12_29490" align=center x:publishsource="Excel">

<table x:str border=0 cellpadding=0 cellspacing=0 width=1005 class=xl2229490
 style='border-collapse:collapse;table-layout:fixed;width:753pt'>
 <col class=xl2229490 width=39 style='mso-width-source:userset;mso-width-alt:
 1426;width:29pt'>
 <col class=xl2229490 width=117 style='mso-width-source:userset;mso-width-alt:
 4278;width:88pt'>
 <col class=xl2229490 width=115 style='mso-width-source:userset;mso-width-alt:
 4205;width:86pt'>
 <col class=xl2229490 width=39 style='mso-width-source:userset;mso-width-alt:
 1426;width:29pt'>
 <col class=xl2229490 width=49 style='mso-width-source:userset;mso-width-alt:
 1792;width:37pt'>
 <col class=xl2229490 width=33 style='mso-width-source:userset;mso-width-alt:
 1206;width:25pt'>
 <col class=xl2229490 width=43 style='mso-width-source:userset;mso-width-alt:
 1572;width:32pt'>
 <col class=xl2229490 width=47 style='mso-width-source:userset;mso-width-alt:
 1718;width:35pt'>
 <col class=xl2229490 width=35 style='mso-width-source:userset;mso-width-alt:
 1280;width:26pt'>
 <col class=xl2229490 width=43 style='mso-width-source:userset;mso-width-alt:
 1572;width:32pt'>
 <col class=xl2229490 width=55 style='mso-width-source:userset;mso-width-alt:
 2011;width:41pt'>
 <col class=xl2229490 width=67 style='mso-width-source:userset;mso-width-alt:
 2450;width:50pt'>
 <col class=xl2229490 width=60 style='mso-width-source:userset;mso-width-alt:
 2194;width:45pt'>
 <col class=xl2229490 width=46 style='mso-width-source:userset;mso-width-alt:
 1682;width:35pt'>
 <col class=xl2229490 width=55 style='mso-width-source:userset;mso-width-alt:
 2011;width:41pt'>
 <col class=xl2229490 width=74 style='mso-width-source:userset;mso-width-alt:
 2706;width:56pt'>
 <col class=xl2229490 width=51 style='mso-width-source:userset;mso-width-alt:
 1865;width:38pt'>
 <col class=xl2229490 width=37 style='mso-width-source:userset;mso-width-alt:
 1353;width:28pt'>
 <col class=xl2229490 width=0 span=57 style='display:none;mso-width-source:
 userset;mso-width-alt:0'>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 width=39 style='height:11.25pt;width:29pt'></td>
  <td class=xl2229490 width=117 style='width:88pt'></td>
  <td class=xl2229490 width=115 style='width:86pt'></td>
  <td class=xl2229490 width=39 style='width:29pt'></td>
  <td class=xl2229490 width=49 style='width:37pt'></td>
  <td class=xl2229490 width=33 style='width:25pt'></td>
  <td class=xl2229490 width=43 style='width:32pt'></td>
  <td class=xl2229490 width=47 style='width:35pt'></td>
  <td class=xl2229490 width=35 style='width:26pt'></td>
  <td class=xl2229490 width=43 style='width:32pt'></td>
  <td class=xl2229490 width=55 style='width:41pt'></td>
  <td class=xl2229490 width=67 style='width:50pt'></td>
  <td class=xl2229490 width=60 style='width:45pt'></td>
  <td class=xl2329490 colspan=3 width=175 style='width:132pt'>Унифицированная
  форма N ТОРГ-12</td>
  <td class=xl2329490 width=51 style='width:38pt'></td>
  <td class=xl2329490 width=37 style='width:28pt'></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
  <td class=xl2229490 width=0></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=4>Утверждена постановлением Госкомстата</td>
  <td class=xl2329490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>России от 25.12.98 N 132</td>
  <td class=xl2329490></td>
  <td class=xl2329490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl2229490 style='height:12.0pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl2429490 style='height:13.5pt'></td>
  <td class=xl2429490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2629490></td>
  <td class=xl2629490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2729490>Код</td>
  <td class=xl2829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2529490></td>
  <td class=xl2629490></td>
  <td class=xl2629490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=2>Форма по ОКУД</td>
  <td colspan=2 class=xl11829490 style='border-right:1.0pt solid black' x:num>
	#($G(okud1))#</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td colspan=12 class=xl7729490 width=703 style='width:526pt'>#($G(kname1))#, 
	#($G(Postalcode1))#, #($G(namecity1))#, #($G(Address1))#, Р/C #($G(rsch1))#, #($G(pbank1))#, #($G(city1))#; БИК #($G(bik1))#, К/С #($G(ksch1))#</td>
  <td class=xl2929490 colspan=2>по ОКПО</td>
  <td colspan=2 class=xl13229490 style='border-right:1.0pt solid black'
  x:str="114 806 70">#($G(okpo1))#</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=23 style='mso-height-source:userset;height:17.25pt'>
  <td height=23 class=xl2429490 style='height:17.25pt'></td>
  <td class=xl3029490 style='border-top:none'>&nbsp;</td>
  <td class=xl3129490 style='border-top:none'>&nbsp;</td>
  <td class=xl3229490 colspan=9>организация-грузоотправитель,адрес,телефон,факс,банковские
  реквизиты</td>
  <td class=xl3129490 style='border-top:none'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl3529490 style='border-top:none'>&nbsp;</td>
  <td class=xl3629490 style='border-top:none'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='height:12.0pt'>
  <td height=16 class=xl2429490 style='height:12.0pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2429490></td>
  <td class=xl3729490></td>
  <td class=xl3829490 colspan=4><span style='mso-spacerun:yes'>        
  </span>структурное подразделение</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=3>Вид деятельности по ОКДП</td>
  <td colspan=2 class=xl13229490 style='border-right:1.0pt solid black'
  x:str="114 806 70">#($G(okdp1))#</td>
  <td class=xl4129490 style='border-top:medium none; ; border-right-style:none; border-right-width:medium'>&nbsp;</td>
  <td class=xl2229490 style="border-left-style: none; border-left-width: medium"></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=31 style='mso-height-source:userset;height:23.25pt'>
  <td class=xl2429490></td>
  <td>Грузополучатель</td>
  <td colspan=11 class=xl7729490 width=703 style='width:526pt'>#($G(kname2))#, #($G(namecity2))#, 
	#($G(Postalcode2))# #($G(Address2))#, P/C #($G(rsch2))#, #($G(pbank2))#, #($G(city2))#; БИК #($G(bik2))#, K/C #($G(ksch2))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>           
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="                    "><span
  style='mso-spacerun:yes'>#($G(okpo2))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:8.25pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2229490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские
  реквизиты</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4529490>&nbsp;</td>
  <td class=xl4629490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Поставщик</td>
  <td colspan=11 class=xl7729490 width=703>#($G(kname3))#, #($G(namecity3))#, 
	#($G(Postalcode3))# #($G(Address3))#, P/C #($G(rsch3))#, #($G(pbank2))#, #($G(city3))#; БИК #($G(bik3))#, K/C #($G(ksch3))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>           
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="114 806 70          "><span
  style='mso-spacerun:yes'> #($G(okpo3))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:9.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2229490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские
  реквизиты</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4529490>&nbsp;</td>
  <td class=xl4629490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Плательщик</td>
  <td colspan=11 class=xl7729490 width=703>#($G(kname4))#, #($G(namecity4))#, 
	#($G(Postalcode4))# #($G(Address4))#,  #($G(rsch4))#, #($G(pbank2))#, #($G(city4))#; #($G(bik4))#, #($G(ksch4))#</td>
  <td class=xl2229490 colspan=2><span style='mso-spacerun:yes'>           
  </span>по ОКПО</td>
  <td colspan=2 class=xl11529490 style='border-right:1.0pt solid black'
  x:str="                    "><span
  style='mso-spacerun:yes'>#($G(okpo4))#</span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='mso-height-source:userset;null:9.0pt'>
  <td class=xl2429490></td>
  <td class=xl4229490></td>
  <td class=xl2629490></td>
  <td class=xl4329490 colspan=7>организация,адрес,телефон,факс,банковские
  реквизиты</td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4829490>&nbsp;</td>
  <td class=xl4929490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl4229490>Основание</td>
  <td class=xl5029490 colspan="11">Договор № #($G(contract))#</td>
  <td class=xl4729490></td>
  <td class=xl2629490>номер</td>
  <td colspan=2 class=xl4829490 style='border-right:1.0pt solid black'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr style='null:12.75pt'>
  <td class=xl2429490></td>
  <td class=xl2429490></td>
  <td class=xl5629490></td>
  <td class=xl4329490 colspan=3>договор,заказ-наряд</td>
  <td class=xl4429490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>дата</td>
  <td colspan=2 class=xl13629490 style='border-right:1.0pt solid black'>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl5929490></td>
  <td class=xl6029490></td>
  <td class=xl6029490></td>
  <td class=xl5729490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>номер</td>
  <td class=xl6129490>&nbsp;</td>
  <td class=xl6229490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl6329490></td>
  <td class=xl4429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2629490>дата</td>
  <td class=xl6129490>&nbsp;</td>
  <td class=xl6229490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=18 style='height:13.5pt'>
  <td height=18 class=xl2429490 style='height:13.5pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5729490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td colspan=2 rowspan=2 class=xl14829490 width=98 style='border-right:.5pt solid black;
  border-bottom:1.0pt solid black;width:73pt'>Номер<span
  style='mso-spacerun:yes'>        </span>документа</td>
  <td colspan=2 rowspan=2 class=xl14429490 width=127 style='border-right:.5pt solid black;
  border-bottom:1.0pt solid black;width:95pt'>Дата<span
  style='mso-spacerun:yes'>            </span>составления</td>
  <td class=xl2629490 colspan=2><span style='mso-spacerun:yes'>      
  </span>Вид операции</td>
  <td class=xl6429490>&nbsp;</td>
  <td class=xl6529490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl2429490 style='height:12.0pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4429490></td>
  <td class=xl2429490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl5929490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=25 style='height:18.75pt'>
  <td height=25 class=xl2429490 style='height:18.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl4429490></td>
  <td class=xl6629490 colspan=5>Товарная накладная</td>
  <td colspan=2 class=xl13829490 style='border-right:1.0pt solid black' x:num>
   #(nomnakl)#</td>
  <td colspan=2 class=xl14029490 style='border-right:1.0pt solid black;
  border-left:none' x:num="38929">
  <script language="cache" runat="server">
	w $TR($ZD(docdata,4),"/",".")
  </script>
  </td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=17 style='mso-height-source:userset;height:12.75pt'>
  <td height=17 class=xl2429490 style='height:12.75pt'></td>
  <td class=xl2429490></td>
  <td class=xl5829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6929490></td>
  <td class=xl5929490></td>
  <td class=xl2429490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=26 style='mso-height-source:userset;height:19.5pt'>
  <td rowspan=2 height=86 class=xl12829490 width=39 style='border-bottom:.5pt solid black;
  height:64.5pt;width:29pt'>Номер по поряд-ку</td>
  <td colspan=3 class=xl12929490 width=271 style='border-right:.5pt solid black;
  border-left:none;width:203pt' x:str="Товар ">Товар<span
  style='mso-spacerun:yes'> </span></td>
  <td colspan=2 class=xl7029490 width=82 style='border-left:none;width:62pt'>Единица
  измерения</td>
  <td rowspan=2 class=xl12129490 width=43 style='border-bottom:.5pt solid black;
  width:32pt'>Вид упаков-ки</td>
  <td colspan=2 class=xl12929490 width=82 style='border-right:.5pt solid black;
  border-left:none;width:61pt'>Количество</td>
  <td rowspan=2 class=xl12829490 width=43 style='border-bottom:.5pt solid black;
  width:32pt'>Масса брутто</td>
  <td rowspan=2 class=xl12829490 width=55 style='border-bottom:.5pt solid black;
  width:41pt' x:str="Количест- во  (масса нетто) ">Количест- во<span
  style='mso-spacerun:yes'>  </span>(масса нетто)<span
  style='mso-spacerun:yes'> </span></td>
  <td rowspan=2 class=xl12129490 width=67 style='border-bottom:.5pt solid black;
  width:50pt'>Цена<span style='mso-spacerun:yes'>   </span>руб.коп.</td>
  <td rowspan=2 class=xl12129490 width=60 style='border-bottom:.5pt solid black;
  width:45pt'>Сумма без учета НДС, руб.коп.</td>
  <td colspan=2 class=xl12429490 width=101 style='border-right:.5pt solid black;
  border-left:none;width:76pt'>НДС</td>
  <td rowspan=2 class=xl12129490 width=74 style='border-bottom:.5pt solid black;
  width:56pt'>Сумма с учетом НДС, руб.коп.</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=60 style='height:45.0pt'>
  <td colspan=2 height=60 class=xl12929490 width=232 style='border-right:.5pt solid black;
  height:45.0pt;border-left:none;width:174pt'>Наименование,
  характеристика,сорт, артикул товара</td>
  <td class=xl7329490 width=39 style='border-left:none;width:29pt'>Код</td>
  <td class=xl7029490 width=49 style='border-top:none;border-left:none;
  width:37pt'>наиме-нование</td>
  <td class=xl7429490 width=33 style='border-top:none;border-left:none;
  width:25pt'>код по ОКЕИ</td>
  <td class=xl7429490 width=47 style='border-top:none;border-left:none;
  width:35pt'>в одном месте</td>
  <td class=xl7429490 width=35 style='border-top:none;border-left:none;
  width:26pt'>мест, штук</td>
  <td class=xl7429490 width=46 style='border-top:none;border-left:none;
  width:35pt'>Ставка, %</td>
  <td class=xl7429490 width=55 style='border-top:none;border-left:none;
  width:41pt'>сумма, руб.коп.</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=16 style='height:12.0pt'>
  <td height=16 class=xl7029490 width=39 style='height:12.0pt;border-top:none;
  width:29pt' x:num>1</td>
  <td colspan=2 class=xl12929490 width=232 style='border-right:.5pt solid black;
  border-left:none;width:174pt' x:num>2</td>
  <td class=xl7029490 width=39 style='border-top:none;border-left:none;
  width:29pt' x:num>3</td>
  <td class=xl7029490 width=49 style='border-top:none;border-left:none;
  width:37pt' x:num>4</td>
  <td class=xl7029490 width=33 style='border-top:none;border-left:none;
  width:25pt' x:num>5</td>
  <td class=xl7029490 width=43 style='border-top:none;border-left:none;
  width:32pt' x:num>6</td>
  <td class=xl7029490 width=47 style='border-top:none;border-left:none;
  width:35pt' x:num>7</td>
  <td class=xl7029490 width=35 style='border-top:none;border-left:none;
  width:26pt' x:num>8</td>
  <td class=xl7029490 width=43 style='border-top:none;border-left:none;
  width:32pt' x:num>9</td>
  <td class=xl7029490 width=55 style='border-top:none;border-left:none;
  width:41pt' x:num>10</td>
  <td class=xl7029490 width=67 style='border-top:none;border-left:none;
  width:50pt' x:num>11</td>
  <td class=xl7029490 width=60 style='border-top:none;border-left:none;
  width:45pt' x:num>12</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>13</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>14</td>
  <td class=xl7529490 style='border-top:none;border-left:none' x:num>15</td>
  <td class=xl7129490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <script language="cache" runat="server">
  s vsegoquant=""
  s vsegosummabeznds=""
  s vsegondsotsumma=""
  s vsegosummasnds=""  
   d:$ISOBJECT(doc.Items)
 . s tot=0,totquant=0
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . .i $I(count)
 . . s item=doc.Items.GetAt(i)
 . . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
 . . s quant=item.Quantity
 . . s itempr=item.Price
 . . s price=$J(kurs*itempr*antinds,".",2)
 . . s pricends=$J(kurs*itempr,".",2)
 . . s total=$J(item.Total*kurs,".",2)
 . . s tot=tot+total
 . . w "<tr class=xl7229490 height=15 style='height:11.25pt'>"
 . . w "<td height=15 class=xl7629490 width=39 style='height:11.25pt;border-top:none;"
 . . w "width:29pt' x:num>"_count_"</td>"
 . . w "<td colspan=2 class=xl14229490 width=232 style='border-right:.5pt solid black;"
 . . w "border-left:none;width:174pt'>"_$G(goods)_"</td>"
 . . w "<td class=xl7829490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl7929490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 style='border-top:none;border-left:none'>&nbsp;</td>"
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_quant_"</td>"
 . . s vsegoquant=vsegoquant+quant
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_price_"</td>"
 . . s summabeznds=$J(quant*price,".",2)
 . . s vsegosummabeznds=vsegosummabeznds+summabeznds
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_summabeznds_"</td>"
 . . s ndsprocent=nds*100
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_ndsprocent_"%</td>"
 . . s ndsotsumma=$J(summabeznds*nds,".",2)
 . . s vsegondsotsumma=vsegondsotsumma+ndsotsumma
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_ndsotsumma_"</td>"
 . . s summasnds=summabeznds+ndsotsumma
 . . w "<td class=xl8029490 align=right style='border-top:none;border-left:none' x:num>"_summasnds_"</td>"
 s vsegosummasnds=vsegosummabeznds+vsegondsotsumma
 </script>
<script language="cache" runat="server">
  f i=1:1:59 w "<td class=xl2229490></td>"
 w "</tr>"
 </script>
 <tr class=xl7229490 height=16 style='height:12.0pt'>
  <td height=16 class=xl4729490 style='height:12.0pt'></td>
  <td class=xl8129490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl8229490 colspan=3>Всего по накладной</td>
  <script language="cache" runat="server">
  w "<td class=xl8329490 style='border-top:none'>&nbsp;</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_vsegoquant_"</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_vsegosummabeznds_"</td>"
  w "<td class=xl8329490 style='border-top:none;border-left:none'>&nbsp;</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_vsegondsotsumma_"</td>"
  w "<td class=xl8329490 align=right style='border-top:none;border-left:none' x:num>"_vsegosummasnds_"</td>"
  </script>
  <td class=xl6029490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='page-break-before:always;mso-height-source:
  userset;height:5.25pt'>
  <td height=7 class=xl2429490 style='height:5.25pt'></td>
  <td class=xl2429490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl6829490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl8429490 colspan=2 x:str="Товарная накладная имеет приложение на ">Товарная
  накладная имеет приложение на<span style='mso-spacerun:yes'> </span></td>
  <td class=xl8529490 colspan=2><span style='mso-spacerun:yes'>  </span></td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl8629490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl8429490>и содержит</td>
  <td class=xl8529490 x:num></td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8429490 colspan=3>порядковых номеров заисей</td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl1529490 style='height:9.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='mso-height-source:userset;height:5.25pt'>
  <td height=7 class=xl1529490 style='height:5.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8929490>&nbsp;</td>
  <td class=xl9029490>&nbsp;</td>
  <td class=xl9129490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl1529490 style='height:12.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8429490 colspan=3>Масса груза (нетто)</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9229490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9329490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=10 style='mso-height-source:userset;height:7.5pt'>
  <td height=10 class=xl1529490 style='height:7.5pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl9429490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl9529490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=16 style='mso-height-source:userset;height:12.0pt'>
  <td height=16 class=xl1529490 style='height:12.0pt'></td>
  <td class=xl8429490>Всего мест</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8429490 colspan=3>Масса груза (брутто)</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl9629490>&nbsp;</td>
  <td class=xl9729490>&nbsp;</td>
  <td class=xl9829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=11 style='mso-height-source:userset;height:8.25pt'>
  <td height=11 class=xl1529490 style='height:8.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl8829490>Прописю</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=7 style='mso-height-source:userset;height:5.25pt'>
  <td height=7 class=xl1529490 style='height:5.25pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=5 style='mso-height-source:userset;height:3.75pt'>
  <td height=5 class=xl1529490 style='height:3.75pt'></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl9929490>&nbsp;</td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl10029490 colspan=3 style='height:12.75pt'><span
  style='mso-spacerun:yes'> </span>Приложение (паспорта,сертификаты, и т.п.) на</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl8729490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl10129490>&nbsp;</td>
  <td class=xl1529490 colspan=2 style='border-right:.5pt solid black'><span
  style='mso-spacerun:yes'>    </span><font class="font529490">листах</font></td>
  <td class=xl7229490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl7229490></td>
  <td colspan=2 class=xl10229490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=17 style='height:12.75pt'>
  <td height=17 class=xl10029490 style='height:12.75pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl10429490></td>
  <td class=xl1529490></td>
  <td class=xl9929490>&nbsp;</td>
  <td class=xl7229490></td>
  <td class=xl1529490></td>
  <td class=xl7229490></td>
  <td class=xl7229490></td>
  <td class=xl10229490></td>
  <td class=xl10329490></td>
  <td class=xl1529490></td>
  <td class=xl1529490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=23 style='mso-height-source:userset;height:17.25pt'>
  <td height=23 class=xl10629490 colspan=2 style='height:17.25pt'
  x:str=" Всего отпущено    "><span style='mso-spacerun:yes'> </span>Всего
  отпущено<span style='mso-spacerun:yes'>    </span></td>
  <td class=xl10729490></td>
  <td class=xl10729490 colspan=2>наименований</td>
  <td class=xl10729490></td>
  <td class=xl10729490></td>
  <td class=xl10729490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl10929490 colspan=2 x:str=" По доверености N "><span
  style='mso-spacerun:yes'> </span>По доверености N<span style='display:none'><span
  style='mso-spacerun:yes'> </span></span></td>
  <td class=xl11029490 x:str="                    "><span
  style='mso-spacerun:yes'>                    </span></td>
  <td class=xl10929490><span style='mso-spacerun:yes'>      </span>от</td>
  <td class=xl2229490 colspan=2>31 июля 2006 г.</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl7229490 height=15 style='height:11.25pt'>
  <td height=15 class=xl10029490 colspan=2 style='height:11.25pt'
  x:str="  на сумму    "><span style='mso-spacerun:yes'>  </span>на сумму<span
  style='mso-spacerun:yes'>    </span></td>
  <td class=xl5129490 colspan=6><span style='display:none'></span></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl10029490 colspan=2>выданной</td>
  <td class=xl5129490><span style='mso-spacerun:yes'> </span></td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=13 style='mso-height-source:userset;height:9.75pt'>
  <td height=13 class=xl2229490 style='height:9.75pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl8829490>прописью</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=6 style='mso-height-source:userset;height:4.5pt'>
  <td height=6 class=xl2229490 style='height:4.5pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl5129490 style='height:11.25pt'>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl11129490>&nbsp;</td>
  <td class=xl11129490 align=right x:num>
  <script language="cache" runat="server">
  //w $FN(vsegosummasnds,"",0)
  </script>
  </td>
  <td class=xl2229490>руб</td>
  <td class=xl5129490>&nbsp;</td>
  <td class=xl11229490 x:num>
  <script language="cache" runat="server">
  //w (vsegosummasnds-$FN(vsegosummasnds,"",0))*100
  </script>
  </td>
  <td class=xl11329490>коп</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl11429490 colspan=9 style='height:11.25pt;border-right:
  .5pt solid black'
  x:str="Отпуск груза разрешил  ________________      ________________    _______________________   ">Отпуск
  груза разрешил<span style='mso-spacerun:yes'>  </span>(директор)<span
  style='mso-spacerun:yes'>      </span>________________<span
  style='mso-spacerun:yes'>    </span><u>#($G(chief))#</u><span
  style='mso-spacerun:yes'>   </span></td>
  <td class=xl11429490 colspan=9
  x:str="Груз принял  _____________________      __________________    ____________________">Груз
  принял<span style='mso-spacerun:yes'>  </span>__________________<span
  style='mso-spacerun:yes'>      </span>__________________<span
  style='mso-spacerun:yes'>    </span>______________________<span
  style='mso-spacerun:yes'>   </span></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2329490
  x:str="                      должность                       "><span
  style='mso-spacerun:yes'>                      </span>должность <span
  style='display:none'><span
  style='mso-spacerun:yes'>                      </span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>                                  </span>подпись</td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl6729490></td>
  <td class=xl2329490 x:str="  должность                       "><span
  style='mso-spacerun:yes'>  </span>должность<span
  style='mso-spacerun:yes'>     </span><span style='display:none'><span
  style='mso-spacerun:yes'>                  </span></span></td>
  <td class=xl2329490 colspan=3><span
  style='mso-spacerun:yes'>                        </span>подпись</td>
  <td class=xl2329490 colspan=2><span style='mso-spacerun:yes'>    
  </span>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=6 style='mso-height-source:userset;height:4.5pt'>
  <td height=6 class=xl2229490 style='height:4.5pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=14 style='mso-height-source:userset;height:10.5pt'>
  <td height=14 class=xl11429490 colspan=9 style='height:10.5pt;border-right:
  .5pt solid black'>Главный(старший) бухгалтер<span
  style='mso-spacerun:yes'>                </span>______________________<span
  style='mso-spacerun:yes'>             </span><u>#($G(buh))#</u></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl6729490 height=15 style='mso-height-source:userset;height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2329490></td>
  <td class=xl2329490><span style='mso-spacerun:yes'>            
  </span>подпись</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
  <td class=xl6729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl11429490 colspan=8 style='height:11.25pt'
  x:str="Отпуск груза произвел      __________________      __________________    _____________   ">Отпуск
  груза произвел<span style='mso-spacerun:yes'>     
  </span>__________________<span style='mso-spacerun:yes'>     
  </span>__________________<span style='mso-spacerun:yes'>   
  </span>_____________<span style='mso-spacerun:yes'>   </span></td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl11429490 colspan=9
  x:str=" Груз получил грузополучатель _____________   _______________   ________________   "><span
  style='mso-spacerun:yes'> </span>Груз получил грузополучатель
  _____________<span style='mso-spacerun:yes'>   </span>_______________<span
  style='mso-spacerun:yes'>   </span>________________<span
  style='mso-spacerun:yes'>   </span></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=17 style='height:12.75pt'>
  <td height=17 class=xl2229490 style='height:12.75pt'></td>
  <td class=xl2329490
  x:str="                      должность                       "><span
  style='mso-spacerun:yes'>                      </span>должность <span
  style='display:none'><span
  style='mso-spacerun:yes'>                      </span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>                                  </span>подпись</td>
  <td class=xl2229490></td>
  <td class=xl2329490 colspan=3>расшифровка подписи</td>
  <td class=xl10829490>&nbsp;</td>
  <td class=xl2229490></td>
  <td class=xl2329490
  x:str="                                                 должность                       "><span
  style='mso-spacerun:yes'>                  </span><span style='display:none'><span
  style='mso-spacerun:yes'>                               </span>должность<span
  style='mso-spacerun:yes'>                       </span></span></td>
  <td class=xl2329490 x:str="              "><span
  style='mso-spacerun:yes'>              </span></td>
  <td class=xl2329490 x:str="  должность                       "><span
  style='mso-spacerun:yes'>  </span>должность<span style='mso-spacerun:yes'> 
  </span><span style='display:none'><span
  style='mso-spacerun:yes'>                     </span></span></td>
  <td class=xl2329490 colspan=2><span
  style='mso-spacerun:yes'>                    </span>подпись</td>
  <td class=xl2329490 colspan=3 style='border-right:.5pt solid black'><span
  style='mso-spacerun:yes'>         </span>расшифровка подписи</td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490 colspan=3>М.П.<span style='mso-spacerun:yes'>        
  </span>&lt;&lt;______&gt;&gt;<span style='mso-spacerun:yes'>    
  </span>_______________<span style='mso-spacerun:yes'>   </span>года</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490 colspan=5>М.П.<span style='mso-spacerun:yes'>        
  </span>&lt;&lt;______&gt;&gt;<span style='mso-spacerun:yes'>    
  </span>_______________<span style='mso-spacerun:yes'>   </span>года</td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <tr class=xl4729490 height=15 style='height:11.25pt'>
  <td height=15 class=xl2229490 style='height:11.25pt'></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl2229490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
  <td class=xl4729490></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=39 style='width:29pt'></td>
  <td width=117 style='width:88pt'></td>
  <td width=115 style='width:86pt'></td>
  <td width=39 style='width:29pt'></td>
  <td width=49 style='width:37pt'></td>
  <td width=33 style='width:25pt'></td>
  <td width=43 style='width:32pt'></td>
  <td width=47 style='width:35pt'></td>
  <td width=35 style='width:26pt'></td>
  <td width=43 style='width:32pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=67 style='width:50pt'></td>
  <td width=60 style='width:45pt'></td>
  <td width=46 style='width:35pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=74 style='width:56pt'></td>
  <td width=51 style='width:38pt'></td>
  <td width=37 style='width:28pt'></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
  <td width=0></td>
 </tr>
 <![endif]>
</table>

</div>


<!----------------------------->
<!--КОНЕЦ ФРАГМЕНТА ПУБЛИКАЦИИ МАСТЕРА ВЕБ-СТРАНИЦ EXCEL-->
<!----------------------------->
</body>

</html>]]></CSP>


<CSP name="screen/zayavka.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
if %request.Get("word")="on"
{
 set %response.ContentType = "application/msword"
 do %response.SetHeader("Content-Disposition","attachment;word.doc")
 set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
}
 q 1
</script>
<script language="cache" runat="server">
 s id=%request.Get("id")
 s obj=##class(Docs.Remont).%OpenId(id)
 d:$ISOBJECT(obj)
 . s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
 . s numb=obj.Name
 . d:$ISOBJECT(obj.Kontr)
 . . s serv=obj.Kontr.Name
 . . s addr=obj.Kontr.City_" "_obj.Kontr.Address
 . . s email=obj.Kontr.EMail
 . . s tel=obj.Kontr.Phones
 . . s Agree=obj.Kontr.Agree
 . . s chief=obj.Kontr.chief
 . . s fax=obj.Kontr.fax
 . s day=$P($ZD(obj.Dat,4),"/",1)
 . s month=mn(+$P($ZD(obj.Dat,4),"/",2))
 . s year=$P($ZD(obj.Dat,4),"/",3)
</script>
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<title>#($G(%session.Data("systemname")))#</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Slava</o:Author>
  <o:LastAuthor>Полиграф</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>2</o:TotalTime>
  <o:LastPrinted>2006-01-30T08:44:00Z</o:LastPrinted>
  <o:Created>2006-06-01T13:23:00Z</o:Created>
  <o:LastSaved>2006-06-01T13:23:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>109</o:Words>
  <o:Characters>626</o:Characters>
  <o:Company>AstConInvest</o:Company>
  <o:Lines>5</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>768</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
@font-face
	{font-family:"Arial Unicode MS";
	mso-font-charset:128;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:16792199 151977984 16 0 4129023 0;}
@font-face
	{font-family:"\@Arial Unicode MS";
	mso-font-charset:128;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:16792199 151977984 16 0 4129023 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Обычный;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:14.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Arial Unicode MS";
	mso-font-kerning:0pt;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	background:navy;
	font-size:12.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:841.9pt 595.3pt;
	mso-page-orientation:landscape;
	margin:3.0cm 2.0cm 42.55pt 2.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
.tdclass{border:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt}
-->
</style>
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal><span lang=EN-US style='font-family:Arial;mso-ansi-language:
EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><b><span style='font-family:Arial'>Заказ на поставку
запасных частей № <u>#($G(numb))#</u>.<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-family:Arial'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'>договор на проведение сервисного обслуживания #($G(Agree))#</span></p>

<br>
<p class=MsoNormal><span style='font-family:Arial'>Наименование сервисного
центра:&nbsp;<u>#($g(serv))#</u>;
Адрес:&nbsp;<u>#($g(addr))#</u>; <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'>Телефон:&nbsp;<u>#($g(tel))#</u>;
Факс:<u>#($g(fax))#</u>; <o:p></o:p></span></p>

<p class=MsoNormal><span
style='font-family:Arial'>E-mail:&nbsp;<u>#($g(email))#</u>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:Arial'>Ф.И.О. директора: <u>#($g(chief))#</u></span><b><o:p></o:p></b></p>
<br>

<br>
<table border=1 cellspacing=0 cellpadding=0 style='border-collapse:collapse;
 border:none;mso-border-alt:solid windowtext .5pt;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr>
  <td width=36 valign=top style='width:27.0pt;border:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>№<o:p></o:p></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>п/п<o:p></o:p></span></p>
  </td>
  <td width=151 valign=top style='width:4.0cm;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Наименование<o:p></o:p></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>изделия<o:p></o:p></span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Модель<o:p></o:p></span></p>
  </td>
  <td width=132 valign=top style='width:99.0pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Наименование<o:p></o:p></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>запчасти<o:p></o:p></span></p>
  </td>
  <td width=86 valign=top style='width:64.75pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>№<o:p></o:p></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>по схеме<o:p></o:p></span></p>
  </td>
  <td width=106 valign=top style='width:79.25pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Код<o:p></o:p></span></p>
  </td>
  <td width=98 valign=top style='width:73.75pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Кол-во<o:p></o:p></span></p>
  </td>
  <td width=108 valign=top style='width:81.0pt;border:solid windowtext .5pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>№ гарантий-ного талона<o:p></o:p></span></p>
  </td>
  <td width=166 valign=top class="tdclass">
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:Arial'>Организация, продавшая товар<o:p></o:p></span></p>
  </td>
 </tr>
 <script language="cache" runat="Server">
 d:$ISOBJECT(obj.Items)
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . i $i(count)
 . . d:$ISOBJECT(obj.Items.GetAt(i).Goods) 
 . . . s z4=obj.Items.GetAt(i).Goods.Name
 . . . s z4code=obj.Items.GetAt(i).Goods.Property3609
 . . . s tovname=obj.Items.GetAt(i).Goods.abbr
 . . . s numschem=obj.Items.GetAt(i).Goods.Property5300
 . .  s z4garant=obj.Items.GetAt(i).garant
 . .  s z4seller=obj.Items.GetAt(i).seller
 . .  s Quantity=obj.Items.GetAt(i).Quantity
 . .  w "<tr><td class=""tdclass"">"_count_"</td><td class=""tdclass"">"_$G(tovname)_"</td><td class=""tdclass""></td><td class=""tdclass"">"_$G(z4)_"</td><td class=""tdclass"">"_$G(numschem)_"</td><td class=""tdclass"">"_$G(z4code)_"</td><td class=""tdclass"">"_$G(Quantity)_"</td><td class=""tdclass"">"_$G(z4garant)_"</td><td class=""tdclass"">"_$G(z4seller)_"</td></tr>"
</script>
</table>
<br>
<br>
<p class=MsoNormal><span style='font-family:Arial'>«<u>#($g(day))#</u>» <u>#($G(month))#</u> <u>#($g(year))#</u> г.</span>


</div>

</body>

</html>]]></CSP>


<CSP name="store.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<script language="cache" runat="server">
 s Tunes=$NA(^Tunes(2))
 s i="" f  s i=$O(@Tunes@(i)) q:i=""  d
 . s CommonVars=$G(CommonVars)_"var "_i_"="""_$G(@Tunes@(i,"Value"),"undefined")_""";"
</script>
<html XMLNS:SKLADz XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLADz" IMPLEMENTATION="htc/treeview.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var Trick=0;
sessionid="#(%session.SessionId)#";

var ItemsPercents = new Array();
depot='#(%session.Data("depot"))#'
#(CommonVars)#
var CurrentElement="";
function load(){
//document.execCommand("2D-position",false,true);
LoadAddress();
AddressTree.onClick="TreeClick()";
TreeClick();
}

function TreeClick(NodeCode){
if(NodeCode==""){Trick=1;}
else{Trick=0;}
CreateAddressLine();
Clear();
if(NodeCode==null)NodeCode=AddressTree.NodeCode;
StoreID.innerText=AddressTree.NodeID;
var childs=""
if(NodeCode==""){var childs=sparents}
else{var childs=ReturnSpace(parents[NodeCode])}
//ok=#server(Store.Action.GetChilds(NodeCode))#
//if(ok!=""){
if(childs!=""){
tablefield.style.display="none";
//var strings = ok.split(StringSplitter);
var strings = childs.split(InnerSplitter);
if (strings.length!=1){
	for (var i = 0; i < strings.length-1; i++){
	var id1=strings[i]
	ElemId=id1
	ElemCode=code[id1]
	ElemName=name[id1]
	ElemComment=comment[id1]
	elemtempstore=tempstore[id1]
	elempercent=percent[id1]
	ElementStr="<div ondblclick='HandleClick(this)' onmouseover=\"Comment.innerText='"+ElemComment+"'\" onmouseout=\"Comment.innerText=''\" style='margin:6;height:"+BlockHeight+";width:"+BlockWidth+";border:1 solid;display:inline' id='"+ElemId+"'></div>";
	aElement=document.createElement(ElementStr);
	if(elemtempstore=="1"){aElement.style.backgroundColor="#efefef"}
	var littlecols=CreateChQuant(ReturnSpace(parents[ElemCode]))
	aElement.innerHTML="<center>"+ElemName+"<font color=gray> ("+elempercent+"%) </font>"+littlecols+"</center>";
	aElement.tag=ElemCode;
	MoveField.appendChild(aElement);
	}
}
else{alert(ok);}
}
else{
	var currentid=AddressTree.NodeID;
	var currentpercent=ItemsPercents[currentid];
	tablefield.style.display="block";
	PropTable.ClearRows();
	PropTable.DownLoadPairs("",currentid,"Depot,Code,Parent");
	goods.loadfrommethod("Goods.GoodsAction.goodsfromstore",currentid,2,3)
	}
}

function CreateChQuant(str){
var res=""
var string=str.split(InnerSplitter);
if(string.length>1)res="<br>"
for(z=0;z<string.length-1;z++){
var curid=string[z];
var procent=percent[curid]
var heightz=(ColumnHeight-Math.ceil(ColumnHeight*(procent/100)))-2
var res=res+"<div style='margin:1;padding:0;border:1 solid;background-color:#898989;height:"+ColumnHeight+";display:inline' ><img src='images/WhitePixel.gif' width=4 height="+heightz+" style='cursor:auto' ></div>"
}
return res
}

function Create(){
number=MoveField.childNodes.length
ElementStr="<button oncontrolselect='HandleClick(this.id)' style='position:absolute;height:28;width:40' id='but"+number+"'></button>";
aElement=document.createElement(ElementStr);
MoveField.appendChild(aElement);
}

function Save(){
res="";
for (i = 0; i <MoveField.childNodes.length; i++){
res=res+MoveField.childNodes(i).id+InnerSplitter;
res=res+MoveField.childNodes(i).offsetLeft+InnerSplitter;
res=res+MoveField.childNodes(i).offsetTop+InnerSplitter;
res=res+MoveField.childNodes(i).style.pixelWidth+InnerSplitter;
res=res+MoveField.childNodes(i).style.pixelHeight+InnerSplitter;
val=ReturnSpace(MoveField.childNodes(i).value);
if(val==""){alert("Элементы без подписи недопустимы");return false;}
res=res+val;
res=res+StringSplitter;
}
ok=#server(Store.Action.SaveButs(AddressTree.NodeCode,res))#
if(ok!=1){alert(ok)}
else{alert("Сохранено")}
}

function HandleClick(Obj){
AddressLine(Obj.tag)
}

function CreateSub(sublevel){
code=ReturnSpace(AddressTree.NodeCode);
if((sublevel==1)&(code=="")){return false;}
ok=window.showModalDialog("addZone.csp",code+";"+sublevel,"center:yes;status:no;dialogHeight:250px;dialogWidth:600px;resizable:yes")
if(ok==null)return false;
if(ok==1){
	//load()
	window.location.reload();
	}
else{alert(ok)}
}

function DelSub(){
if(!window.confirm("Вы уверены?"))return false;
ok=#server(Store.Action.deletecell(AddressTree.NodeID))#
if(isNaN(ok)){alert(ok)}
else{window.location.reload();}
}

function LoadAddress(){
AddressTree.DownLoad("Data.csp?class=Store.Address&fields=Parent,Code,Name,ID,block&where=depot="+depot+"&order=Code")
}

function Clear(){
MoveField.innerHTML="";
}
function AddressLine(code){
AddressTree.SelectedItem=code;
TreeClick();
}

function CreateAddressLine(){
if (Trick==1){addresspath.innerHTML="";return false;}
ParentNames=AddressTree.ParentNames;
ParentCodes=AddressTree.ParentCodes;
if(ParentNames=="")return false
addresspath.innerHTML="";
NamesArr=ParentNames.split("~");
CodesArr=ParentCodes.split("~");
for(i=0;i<NamesArr.length;i++){
	aElement=CreateLink(NamesArr[i],CodesArr[i]);
	addresspath.appendChild(aElement);
	addresspath.innerHTML=addresspath.innerHTML+" > ";
}
}

function CreateLink(name,hrefz){
ElementStr="<a ></a>";
aElement=document.createElement(ElementStr);
hrefz="javascript:AddressLine('"+hrefz+"')";
aElement.href=hrefz;
//javascript:TreeClick('"+hrefz+"')
aElement.innerText=name;
return aElement;
}

function startFun(){
var CurrentCellCode=AddressTree.SelectedItem;
xmldoc=PropTable.GetXmlContent();
ok=SplitSendXml(AddressTree.NodeID,PropTable.ClassName,xmldoc,"","#(%session.SessionId)#")
if(isNaN(ok)){alert(ok)}
else{TreeClick(CurrentCellCode)}
}

//Открыть карточку товара
function OpenCard(){
var gid=goods.ItemID
if(gid=="")return
var gname=goods.item("tov")
ok=window.showModalDialog("GoodsCard.csp?GoodsId="+gid+"&groupspath=",gid+InnerSplitter+gname,"center:yes;status:no;dialogHeight:600px;dialogWidth:650px;resizable:yes")
if(ok==1){ShowTovars()}
}

function multiedit(){
ok=window.showModalDialog("multichange.csp?skip=Code,Parent,Currentsize,Currentweight,Depot,Name,oldnumb&addrpath="+addresspath.innerText,AddressTree.NodeID+";Store.Address","center:yes;status:no;dialogHeight:380px;dialogWidth:400px;resizable:yes;")
}

function editname(){
var Name=window.prompt("Новое наименование",AddressTree.NodeCaption)
if(Name==null)return false;
#server(Store.Action.changename(AddressTree.NodeID,Name))#
window.location.reload()
}

function clearcell(){
var cellid=AddressTree.NodeID;
var cellcode=AddressTree.NodeCode;
if(cellid=="")return false;
if(!window.confirm("Очистить "+AddressTree.NodeCaption+"?"))return false;
ok=#server(Store.Action.ClearCell(cellid,cellcode,depot))#
if(isNaN(ok)){alert(ok);}
else{TreeClick(cellcode)}
}
</script>
</head>
<body onload="load();" onmoveend ="fnHandleMove();" >
<script language="cache" runat="server">
w "<script language=""Jscript"">"
  f var="ids","percent","code","name","comment","tempstore","parents" d
  . w "var "_var_"=new Array();",!
 s depot=%session.Data("depot")
 s sql="select ID,Code,Name,Comment,tempstore,Currentsize,Size1,Parent from Store.Address where depot="_depot_" order by Name"
 s result=##class(%ResultSet).%New()
 d result.Prepare(sql)
 s result.RuntimeMode=2
 s ok=result.Execute()
 s res=""
 While result.Next() {
  s OutString=""
  s id=result.Get("ID")
  s code=result.Get("Code")
  s name=result.Get("Name")
  s comment=result.Get("Comment")
  s tempstore=result.Get("tempstore")
  s percent=0
  s Currentsize=+result.Get("Currentsize")
  s Maxsize=+result.Get("Size1")
  s str2(code)=id
  s parent=result.Get("Parent")
  i parent'="" s str(parent)=$G(str(parent))_id_"~"
  e  s str=$G(str)_id_"~"
  i Maxsize>0 s percent=$J((Currentsize/Maxsize)*100,".",0)
  f var="percent","code","name","comment","tempstore" d
  . w var_"["_id_"]="""_@var_""";"
  w "ids["""_code_"""]="_id_";"
 }
  s i=""
  w "",!
  f  s i=$O(str(i)) q:i=""  d
  . q:str2(i)=""
  . w "parents["""_i_"""]="""_$G(str(i))_""";"
  w "sparents="""_$G(str)_""";"
w "</script"_">"
</script>

<TABLE cellSpacing=0 width="100%" celpadding="0" >
<TR>
<td width=10%><img alt="Обновить раздел" src="images/refresh.gif" onclick="window.location.reload()"></td>
<TD width=80% align=center style="BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid" colspan=2><strong>Структура хранения</strong></TD>
<td width=10% align=right><a href="help/store.htm"><img src="images/BIGHelp.bmp" width="20" height=25 border=0></a></td>
</TABLE>


<!--
<sklad:LittleButton name="new" id="newgrup" onclick="Create()" alt="Новый элемент">
<sklad:LittleButton name="edit" id="save" onclick="Save()" alt="Сохранить">
<sklad:LittleButton name="del" id="clear" onclick="Clear()" alt="Очистить"><br>
-->

<br>
<a href="javascript:TreeClick('')" >#(%session.Data("depotName"))#</a> > <span id="addresspath"></span>
<table cellspacing=0 cellpadding=0 width=100% height=100% border=0 id="TableMoveField"><tr>
<td valign=top><SKLADz:treeview id="AddressTree" width=150 height=200 ShowImages=1 ImagesPath="#(%session.Data("ImagesPath"))#" condition="Types[node]==0"/>
<table><tr><td width=100%><sklad:LittleButton name="new" id="newsub" onclick="CreateSub(0)" alt="Новый элемент">
<sklad:LittleButton name="new+" id="newsub1" onclick="CreateSub(1)" alt="Новый подэлемент">
<sklad:LittleButton name="history" id="multed" onclick="multiedit()" alt="Множественное редактирование">
<sklad:LittleButton name="edit" id="smulted" onclick="editname()" alt="Изменить наименование">
<sklad:LittleButton name="del+" id="shmulted" onclick="clearcell()" alt="Очистить"></td>

<td><sklad:LittleButton name="del" id="deletesub1" onclick="DelSub()" alt="Удалить элемент"></td>
</tr></table>
<br><br><span id="Comment" style="color:darkgrey"></span>
</td>
<td width=100% style="border-left:1 solid black;border-top:1 solid black" valign=top id="MoveField2">
<div id="MoveField" CONTENTEDITABLE='false' >
</div>
<div id="tablefield" >
<div id="StoreID"></div>
<SKLAD2:table id="PropTable" width="400" ClassName="Store.Address" Silent="Currentsize,Currentweight"/>
 <SKLADList:listview width=100% height=150 id="goods" zonDblClick="OpenCard()"/><br>
<br>
<center><sklad:Button value="Да" onclick="startFun();"></center>
</div></td>
<!--
при включенном CONTENTEDITABLE срабатывает событие oncontrolselect
-->
</table>
</body>
</html>
]]></CSP>


<CSP name="toolbar.csp" application="/csp/sklad2/" default="1"><![CDATA[
<script language="Cache" method="OnPreHTTP" arguments="" returntype="%Boolean">
 s login=$G(%session.Data("user"))
 i '+login s %response.ServerSideRedirect="norights.csp" 
 q 1
</script>
<html>
<head>
<SCRIPT Language="jscript">
gobo = Image('');
function ChangePage(BtnKey){
	if(BtnKey==="exit"){
		if(window.confirm("Выйти из программы?")){
			var xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
			try{
				xmlhttp.open("POST","CloseSession.csp",false); xmlhttp.send();
			} catch(e){
			}
			window.parent.close(); return;
		}
	}
    //Высота фреймов на index.csp	
    var hof={ //heights of the frames, начальная инициализация
		toolbar:"37px"
		,goods:"0px",docs:"0px",dicts:"0px",store:"0px",tunes:"0px"
		,chief:"0px",employee:"0px",analyzis:"0px",kontr:"0px",finance:"0px"
		,director:"0px",login:"0px",select:"*",status:"20px"
	};
    if (hof[BtnKey]){
	 	hof[BtnKey]="*"; //раскрываем указанный фрейм
	 	hof["select"]="0px"; //закрываем фрейм по умолчанию
	}
    var arr=new Array(); for (var i in hof) { arr.push(hof[i]);}
    frameElement.document.all.MainFrameSet.rows = arr.join(",");
}
</SCRIPT>

</head>

<body bgcolor="ButtonFace" leftmargin=5 rightmargin=5 topmargin=1 bottommargin=5 >
<Table width=100%><tr><td>
<script language="cache" runat="server">
 s login=$G(%session.Data("user"))
 s:##class(Common.Rights).getrights(login,1) i($i(i))="goods",i(i,"alt")="Товары"
 s:##class(Common.Rights).getrights(login,3) i($i(i))="docs",i(i,"alt")="Документы"
 s:##class(Common.Rights).getrights(login,4) i($i(i))="dicts",i(i,"alt")="Справочники"
 s:##class(Common.Rights).getrights(login,15) i($i(i))="store",i(i,"alt")="Места хранения"
 s:##class(Common.Rights).getrights(login,16) i($i(i))="tunes",i(i,"alt")="Настройки"
 s:##class(Common.Rights).getrights(login,2) i($i(i))="chief",i(i,"alt")="Рабочее место сервис менеджера"
 s:##class(Common.Rights).getrights(login,5) i($i(i))="employee",i(i,"alt")="Рабочее место на складе"
 s:##class(Common.Rights).getrights(login,17) i($i(i))="analyzis",i(i,"alt")="Аналитика"
 s:##class(Common.Rights).getrights(login,18) i($i(i))="kontr",i(i,"alt")="Учёт отгрузок и платежей"
 s:##class(Common.Rights).getrights(login,14) i($i(i))="finance",i(i,"alt")="Финансы"
 s:##class(Common.Rights).getrights(login,13) i($i(i))="director",i(i,"alt")="Рабочее место директора"
 s i($i(i))="login",i(i,"alt")="Вход в систему"
 
 s i="" f  s i=$O(i(i)) q:i=""  d
 . w "<img src=""images/big/on"_i(i)_".gif"" width=1 height=1 style=""display:none"">"
 . w "<img src=""images/big/"_i(i)_".gif"" alt="""_i(i,"alt")_"""onmouseover=""this.src='images/big/on"_i(i)_".gif'"" onmouseout=""this.src='images/big/"_i(i)_".gif'"" onclick=""ChangePage('"_i(i)_"');"" style=""cursor:hand"" width=30 height=30>&nbsp;",!
</script>
</td><td align=right>
<img src="images/big/onexit.gif" width=1 height=1 style="display:none">&nbsp;
<img src="images/big/exit.gif" onmouseover="this.src='images/big/onexit.gif'" onmouseout="this.src='images/big/exit.gif'" onclick="ChangePage('exit');" style="cursor:hand" width=30 height=30>&nbsp;
<img src="images/big/onhelp.gif" width=1 height=1 style="display:none">&nbsp;
<img src="images/big/help.gif" onmouseover="this.src='images/big/onhelp.gif'" onmouseout="this.src='images/big/help.gif'" onclick="window.open('help/index.html');" style="cursor:hand" width=30 height=30>&nbsp;
</td></tr></table>
</body>

</html>
]]></CSP>


<CSP name="tovbuf.csp" application="/csp/sklad2/" default="1"><![CDATA[
<html XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<head>
<link href="style.css" type=text/css rel=stylesheet>
<script language="jscript" src="common.js"></script>
<script language="Jscript">
var ColCode="";
sessionid="#(%session.SessionId)#";

var usr='#($G(%session.Data("user"),1))#';
function load(){
	Dictionary2.ClassName="Goods.Goods";
	Dictionary2.LoadHeaders();
}


function Show(){
	Dictionary2.GetFromCard(usr,"","","");
}

function clearbuff(){
#server(Goods.CardAction.DelCard(usr,Dictionary2.ClassName))#
Dictionary2.GetFromCard(usr,"","","");
}
</script>
</head>
<body onload="load()" >
<fieldset><legend></legend>
 <SKLADList:listview width=100% height=220 id="Dictionary2" onAddColumns="Show()" /><br>  
</fieldset>
<sklad:Button value="Очистить буфер" onclick="clearbuff();">
</body>
</html>]]></CSP>


<CSP name="tovprice.csp" application="/csp/sklad2/" default="1"><![CDATA[
<Script language="cache" runat="server">
 s goodsid=$G(%request.Data("goodsid",1))
 s login=$G(%session.Data("user"))
 s allow=##class(Common.Rights).getrights(login,8)
</script>
<html XMLNS:SKLAD2 XMLNS:SKLADList>
<IMPORT NAMESPACE="SKLADList" IMPLEMENTATION="htc/listview2.htc">
<IMPORT NAMESPACE="SKLAD2" IMPLEMENTATION="htc/table.htc">
<head>
<title>#($G(%session.Data("systemname")))#</title>
<link href="style.css" type=text/css rel=stylesheet>
<script language="Jscript" src="common.js"></script>
<script language="JScript">
sessionid="#(%session.SessionId)#";

var NodeData = new Array();
GoodsId= "#(goodsid)#";

function startFun(){
xmldoc=newpr.GetXmlContent();
addnode(xmldoc,"Goods",GoodsId+"@Goods.Goods")
ok=SplitSendXml("","Store.Price",xmldoc,"","#(%session.SessionId)#")
if(isNaN(ok)){
	alert(ok);}
else{
	alert("Новая цена успешно сохранена");
	loadprices();}

}

function LoadList(){
PropTable.DownLoadPairs('Goods.Goods',GoodsId);
newpr.DownLoadPairs('Store.Price','',"Tim,Depot,Goods");
}

function load(){
LoadList();
loadprices();
}

function loadprices(){
tp.loadfrommethod("Goods.GoodsAction.prices",GoodsId,allpr.checked);
}

function setfornewpr(){
newpr.setCellValue("Dat","#($ZD($H,4))#");
}

</script>
</head>
<body  onload="load();" onkeypress="ManageWindow();">
<table cellpadding=0 cellspacing=0 width=100% border=0><tr>
<td valign=top>
<fieldset><legend>Основные свойства</legend>
<SKLAD2:table id="PropTable" width=360 height=200 />
</fieldset>
</td>
<td>
<fieldset><legend>Новая цена</legend>
<SKLAD2:table id="newpr" width=300 height=200 onLoadComplete="setfornewpr()" />
</fieldset>
</td>
</tr>
<tr><td colspan=2>
<fieldset><legend>История цен</legend>
<input type="checkbox" id="allpr" style="width:15px;border:0" onclick="loadprices()"> Все цены
 <SKLADList:listview width=100% height=135 id="tp" />
</fieldset>
</td></tr>
<tr><td colspan=2 align=center>
<CSP:IF CONDITION='allow'>
<sklad:Button value="Да" onclick="startFun()">
</csp:IF>
&nbsp;&nbsp;&nbsp;<sklad:Button value="Отмена" onclick="window.close()"></td></tr>
</table>
</body>
</html>
]]></CSP>


<Class name="Docs.Act">
<Description>
Акт неремонтопригодности</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>Docs.Super</Super>
<TimeCreated>61508,50126.133794</TimeCreated>

<Property name="Goods">
<Description>
Изделие</Description>
<Type>Goods.Goods</Type>
<Required>1</Required>
</Property>

<Property name="NumbersHistory">
<Description>
История изменений номеров</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Property name="Serial">
<Description>
Серийный номер</Description>
</Property>

<Property name="Garant">
<Description>
Гарантийный номер</Description>
</Property>

<Method name="HasGarant">
<Description><![CDATA[
Проверяет наличие в данных записей с указаным гарантийным талоном
Необходим для проверки перед удалением гарантийного талона 
<class>Common.Dictionary2</class> из базы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>garantId:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	#; Переделать на прямой доступ к индексной глобали
	&sql(Select Top 1 ID Into :id From Docs.Act Where Garant=:garantId)
	Q (SQLCODE'=100)
]]></Implementation>
</Method>

<Property name="SellerName">
<Description>
Продавец</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="SellerAddress">
<Description>
Адрес продавца</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="SellerDate">
<Description>
Дата продажи</Description>
<Type>%Date</Type>
</Property>

<Property name="SellerPhone">
<Description>
Телефон продавца</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="ExpertDate">
<Description>
Дата экспертизы</Description>
<Type>%Date</Type>
</Property>

<Property name="RemontDate">
<Description>
Дата поступления в ремонт</Description>
<Type>%Date</Type>
</Property>

<Property name="RepairsQnt">
<Description>
Количество ремонтов</Description>
</Property>

<Property name="DefectDescription">
<Description>
Неисправность</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2024"/>
</Property>

<Property name="DefectEstimate">
<Description>
Прогноз дефекта</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<UDLText name="T">
<Content><![CDATA[
//Property DefectClass As %String(DISPLAYLIST = ",Заводской,Внешние факторы,Вина потребителя,Иное", VALUELIST = ",0,1,2,3");

]]></Content>
</UDLText>

<Property name="DefectClass">
<Description>
Классификация дефекта</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Заводской,Предпродажный,Иное,Вина потребителя"/>
<Parameter name="VALUELIST" value=",0,1,2,3"/>
</Property>

<Property name="DefectClassDescr">
<Description>
Описание классификации дефекта (это если в форме выбрали ИНОЕ)</Description>
</Property>

<Property name="RepairRefuseReason">
<Description>
Причина отказа в ремонте</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="CustomerName">
<Description>
Потребитель</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="CustomerDoc">
<Description>
Потребитель</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="CustomerAddress">
<Description>
Потребитель</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="CustomerPhone">
<Description>
Потребитель</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="ActDate">
<Description>
Дата акта</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="GoodsKeeping">
<Description>
Товар оставлен в сервисном центре</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Нет,Да"/>
<Parameter name="VALUELIST" value=",0,-1"/>
</Property>

<Property name="SrvName">
<Description>
Наименование сервисного центра</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="SrvAddr">
<Description>
Адрес сервисного центра</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="SrvPhone">
<Description>
Телефон сервисного центра</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="SrvFIO">
<Description>
Директор сервисного центра</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="Stat">
<Description>
Статус</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Создан,Обработан и принят,Акт не принят"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Property name="CheckResult">
<Description>
Результаты проверки</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="5000"/>
</Property>

<Property name="ActType">
<Description>
Тип акта</Description>
<Type>%String</Type>
</Property>

<Index name="ActType">
<Properties>ActType</Properties>
</Index>

<Property name="Paid">
<Description>
Погашен</Description>
<Type>%String</Type>
<InitialExpression>"0"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Нет,Да"/>
<Parameter name="VALUELIST" value=",0,1"/>
</Property>

<Index name="PaidIndex">
<Properties>Paid</Properties>
</Index>

<Property name="PaidDate">
<Description>
Дата погашения</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="PaidTime">
<Description>
Время погашения</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="PaidUser">
<Description>
Оператор погасивший</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Method name="SetActStatFailed">
<Description><![CDATA[
Поставить акту статус "не принят"
<br>ActId - ID акта или объект акта
<br>Comment - ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ActId:%String="",Comment:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s $ZT="SetActStatFailedError"
	if ActId="" q "Не указан ID акта."
	if '$ISOBJECT(ActId) s ActObj = ##class(Docs.Act).%OpenId(ActId)
	else  s ActObj=ActId
	if '$ISOBJECT(ActObj) q "Невозможно найти акт "_ActId
	s ActObj.Stat=3
	s ActObj.Name=""
	s ActObj.Summa=0
	s ActObj.CloseDate=""
	s ActObj.CloseTime=""
 	s ActObj.CloseUser=""
	s ActObj.Comment=Comment
	
	s ok=ActObj.%Save()
	if ok q 1
	$$$WriteObjError(ok)
	q "Извините. Ошибка при отклонении акта."
SetActStatFailedError
 $$$WriteError($ZE)
 q "Извините. Ошибка при отклонении акта."
]]></Implementation>
</Method>

<Property name="NameSorted">
<Description>
Номер пригодный для сортировки</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}=$P({Name},"-",2)_"-"_$TR($J($P({Name},"-",1),3)," ",0)</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value="display:none,"/>
</Property>

<Method name="GetActSumma">
<Description>
Вернёт расчётную сумму акта, тип акта возвращается в третьем параметре по ссылке
Если указать параметр GetActType =1 то вернёт тип акта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ActId:%String="",GetActType:%Boolean=0,&D9Field:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s $ZT="GetActSummaError"
	if ActId = "" q "Не указан ID акта."
	if '$ISOBJECT(ActId) s ActObj = ##class(Docs.Act).%OpenId(ActId)
	else  s ActObj=ActId
	if '$ISOBJECT(ActObj) q "Невозможно найти акт "_ActId
	s KontrObj = ActObj.Kontr
	if '$ISOBJECT(KontrObj) q "В акте не указан контрагент. Вычисление суммы невозможно."
	
	s RemTovar = ActObj.Goods
	if '$ISOBJECT(RemTovar.izdelie) q "У товара "_RemTovar.FullName_" не указана ценовая группа."
	s izdelieRazdel=RemTovar.izdelie.Razdel
	if izdelieRazdel="" q "У ценовой группы "_RemTovar.izdelie.Name_" не указан раздел (бытовая техника или электроинструмент), поэтому невозможно посчитать сумму акта."
 	s izdelieRazdelName=##class(Common.Dictionary12).RazdelLogicalToDisplay(izdelieRazdel)
 	
 	//бытовка
 	if izdelieRazdel = 1 s KontragentCenaKateg = "Property127",D9Field="ActPriceTechnic"
 	//инструмент
 	if izdelieRazdel = 2 s KontragentCenaKateg = "Property126",D9Field="ActPriceInstrument"	
 	
 	if GetActType q $G(D9Field)
 	//возьмём у контрагента Property126 или Property127
 	s KontrCenaObj = $ZOBJPROPERTY(KontrObj,KontragentCenaKateg)
 	
 	if '$ISOBJECT(KontrCenaObj) q "У контрагента "_Kontr.Name_" не указана категория цен "_izdelieRazdelName
	
	s Summa=$ZOBJPROPERTY(KontrCenaObj,D9Field)
	
	if Summa="<remont>" q ##class(Common.Common).GetRemontPrice(ActObj.Kontr.Code,RemTovar.izdelie.%Id())
	if Summa="" q "Для категории цен "_KontrCenaObj.Name_" не установлены необходимые цены за акт."
	q Summa
GetActSummaError
 $$$WriteError($ZE)
 q "Извините. Ошибка при вычислении суммы акта."
]]></Implementation>
</Method>

<Method name="GetActType">
<ClassMethod>1</ClassMethod>
<FormalSpec>ActId:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	q ..GetActSumma(ActId,1)
GetActTypeError
 $$$WriteError($ZE)
 q "Извините. Ошибка при вычислении типа акта."
]]></Implementation>
</Method>

<Method name="SetActStatAccepted">
<Description><![CDATA[
Поставить акту тип "Принят"
<br> ActId - ID акта
<br> ActNumber - номер акта
<br> ActSumma - сумма акта
<br> ActType - тип акта]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ActId:%String="",ActNumber:%String="",ActSumma:%String="",ActType:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s $ZT="SetActStatAcceptedError"
	if ActId="" q "Не указан ID акта."
	
	if ActSumma="" s ActSumma=..GetActSumma(ActId,0,ActType)
	if ActSumma="" q "Невозможно утвердить акт, так как невозможно рассчитать его сумму."
	if '+ActSumma q ActSumma
	if ActNumber="" s ActNumber=##class(Docs.Action).getRashNumb("Docs.Act")
	if '$ISOBJECT(ActId) s ActObj = ##class(Docs.Act).%OpenId(ActId)
	else  s ActObj=ActId
	if '$ISOBJECT(ActObj) q "Невозможно найти акт "_ActId
	s ActObj.Stat=2
	s ActObj.Name=ActNumber
	s ActObj.Summa=ActSumma
	s ActObj.ActType=ActType
	
	//сделаем гарантийный талон недействительным
	s ActObjGarant = ActObj.Garant
	if ActObjGarant'=""
	{
		s GarantObj = ##class(Common.Dictionary2).%OpenId(ActObjGarant)
		if $ISOBJECT(GarantObj)
		{
			
		}
	}
	
	s ok=ActObj.%Save()
	if ok q 1
	$$$WriteObjError(ok)
	q "Извините. Ошибка при утверждении акта."
SetActStatAcceptedError
 $$$WriteError($ZE)
 q "Извините. Ошибка при отклонении акта."
]]></Implementation>
</Method>

<Method name="SetActPaid">
<Description>
установить акту статус "Оплачен"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ActID:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(select Paid into :Paid from Docs.Act where id=:ActID)
	if SQLCODE q "Извините. Ошибка чтения. SQLCODE="_SQLCODE
	if Paid=1 q "Акт уже оплачен."
	s PaidUser=$$$SessionData("user")
	s PaidTime=$P($H,",",2)
	s PaidDate=+$H
	&sql(update Docs.Act set PaidUser=:PaidUser,PaidTime=:PaidTime,PaidDate=:PaidDate,Paid=1 where id=:ActID)
	if 'SQLCODE q 1
	else  q "Извините. Ошибка записи. SQLCODE="_SQLCODE
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>ActDefaultData</DefaultData>
<Data name="ActDefaultData">
<Structure>listnode</Structure>
<Subscript>"Act"</Subscript>
<Value name="1">
<Value>Garant</Value>
</Value>
<Value name="2">
<Value>Goods</Value>
</Value>
<Value name="3">
<Value>Serial</Value>
</Value>
<Value name="4">
<Value>SellerDate</Value>
</Value>
<Value name="5">
<Value>SellerName</Value>
</Value>
<Value name="6">
<Value>SellerPhone</Value>
</Value>
<Value name="7">
<Value>Customer</Value>
</Value>
<Value name="8">
<Value>DefectClass</Value>
</Value>
<Value name="9">
<Value>DefectDescription</Value>
</Value>
<Value name="10">
<Value>DefectEstimate</Value>
</Value>
<Value name="11">
<Value>ExpertDate</Value>
</Value>
<Value name="12">
<Value>RemontDate</Value>
</Value>
<Value name="13">
<Value>RepairRefuseReason</Value>
</Value>
<Value name="14">
<Value>RepairsQnt</Value>
</Value>
<Value name="15">
<Value>SellerAddress</Value>
</Value>
<Value name="16">
<Value>DefectClassDescr</Value>
</Value>
<Value name="17">
<Value>CustomerName</Value>
</Value>
<Value name="18">
<Value>CustomerDoc</Value>
</Value>
<Value name="19">
<Value>CustomerAddress</Value>
</Value>
<Value name="20">
<Value>CustomerPhone</Value>
</Value>
<Value name="21">
<Value>ActDate</Value>
</Value>
<Value name="22">
<Value>GoodsKeeping</Value>
</Value>
<Value name="23">
<Value>SrvAddr</Value>
</Value>
<Value name="24">
<Value>SrvFIO</Value>
</Value>
<Value name="25">
<Value>SrvName</Value>
</Value>
<Value name="26">
<Value>SrvPhone</Value>
</Value>
<Value name="27">
<Value>ActNumber</Value>
</Value>
<Value name="28">
<Value>CheckResult</Value>
</Value>
<Value name="29">
<Value>ActType</Value>
</Value>
<Value name="30">
<Value>Paid</Value>
</Value>
<Value name="31">
<Value>PaidDate</Value>
</Value>
<Value name="32">
<Value>PaidTime</Value>
</Value>
<Value name="33">
<Value>PaidUser</Value>
</Value>
<Value name="34">
<Value>NumbersHistory</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Action">
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60366,25294.435767</TimeCreated>

<Method name="CreateDoc">
<Description>
Создать документ</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocClass,DocId="",DocValues,DocNames,DocTypes,ItemsValues,ItemsNames,ItemsTypes,StringsId</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CreateDocErr",ok=1
 //TSTART
 
 s DocData=$NA(^mtempDoc($I))
 k @DocData
 // занесём в DocData данные шапки документа
 // DocData("head",поле)=зачение
 // DocData=ID документа
 s @DocData=DocId
 f i=1:1:$L(DocNames,"~") d
 . s onefield=$P(DocNames,"~",i)
 . q:onefield=""
 . s @DocData@("head",onefield)=$P(DocValues,"~",i)
 // занесём в StrData данные строк документа
 // StrData("body",строка,поле)=значение
 // StrData("body",строка)=ID строки
 f i=1:1:$L(ItemsValues,"#@#") d
 . s Str=$P(ItemsValues,"#@#",i)
 . q:Str=""
 . s @DocData@("body",i)=$P($G(StringsId),"~",i)
 . f z=1:1:$L(Str,"~") d
 . . s @DocData@("body",i,$P(ItemsNames,"~",z))=$P(Str,"~",z)
 . . s @DocData@("body",i,"DocType")=DocClass
 
 s ok=##class(Docs.Action).SaveDocObject(DocClass,DocData)
 q ok
CreateDocErr
 $$$WriteError($ZE)
 q "Ошибка при создании документа"
]]></Implementation>
</Method>

<Method name="SaveKontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr=1,goods=1</FormalSpec>
<Implementation><![CDATA[
	s ^Kontr(1,goods,kontr)=1
	s ^Kontr(0,kontr,goods)=1
 	q 1
]]></Implementation>
</Method>

<Method name="GetFromCard">
<ClassMethod>1</ClassMethod>
<FormalSpec>CardClass,CardId,p2=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetGoodsFromInstrErr"

 s xmlstr=##class(%XML.Writer).%New()
 s xmlstr.Charset="windows-1251"
 d xmlstr.OutputToDevice()
 s sc=xmlstr.RootElement("AllObjects")
 
 s sc=xmlstr.Element("OneObject")
 
 f i=1:1:result.GetColumnCount() d
 . s sc=xmlstr.Element("Item")
 . $$$WriteElement("text",result.GetData(i))
 . $$$WriteElement("name",$G(columns(i),"undef"))
 . $$$WriteElement("type",$G(coltype(i),"undef"))
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 s sc=xmlstr.EndRootElement()
 q
GetGoodsFromInstrErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="SetSourceDoc">
<Description>
Установить что документ принадлежит источнику (инструкции)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>classname,docid,source</FormalSpec>
<Implementation><![CDATA[
	s $ZT="SetSourceDocErr"
	s err="Ошибка привязки документа к источнику"
	i classname="" $$$WriteError("не указан класс документа") q err
	i docid="" $$$WriteError("не указан id документа") q err
	i source="" $$$WriteError("не указан источник для документа") q err

	s doc=$ZOBJCLASSMETHOD(classname,"%OpenId",docid)
	if '$ISOBJECT(doc) $$$WriteError("SetSourceDoc Не удалось открыть документ "_docid_" класс: "_classname) q err
	s instrid=$P(source,"@",1)
	d doc.SourceSetObjectId(instrid)
	s ok=doc.%Save()
	i '+ok $$$WriteObjError(ok) q err
	//запишем ребёнка инструкции
	//s classname=$P(source,"@",2)
	
	//s doc=$ZOBJCLASSMETHOD(classname,"%OpenId",instrid)
	//if '$ISOBJECT(doc) $$$WriteError("SetSourceDoc Не удалось открыть документ "_instrid_" класс: "_classname) q err
	//d doc.childSetObjectId(docid)
	//s ok=doc.%Save()
	//i '+ok $$$WriteObjError(ok) q err
	q 1
SetSourceDocErr
  $$$WriteError($ZE)
  q "Ошибка привязки документа к источнику"
]]></Implementation>
</Method>

<Method name="LoadDocsFromInstr">
<ClassMethod>1</ClassMethod>
<FormalSpec>InstrId,p1,p2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="LoadDocsFromInstrErr",ok=1
 s xmlstr=##class(%XML.Writer).%New()
 s xmlstr.Charset="windows-1251"
 d xmlstr.OutputToDevice()
 s sc=xmlstr.RootElement("RootElement")
 s instrObj=##class(Operation.Instructions).%OpenId(InstrId)
 i '$ISOBJECT(instrObj) d
 . $$$WriteError("LoadDocsFromInstr Не удалось открыть объект "_InstrId_" класса Operation.Instructions")
 . s sc=xmlstr.EndRootElement()
 . s ok=0
 e  d
 . s Class=..GetClassFromSource(InstrId_"@Operation.Instructions")
 . s:Class'="" headers=##class(Common.Common).showheaders(Class)
 i '+ok q 0
 // Формирование заголовков
  if $L($G(headers),"#@#")>1 {
  s sc=xmlstr.Element("AllHeaders")
   f i=1:1:$L(headers,"#@#") d
   . s header=$P(headers,"#@#",i)
   . q:header=""
   . s sc=xmlstr.Element("OneObject")
   . s FieldName=$P(header,"~",1)
   . s FieldNames(FieldName)=1
   . s FieldNames(FieldName,"type")=$P($P(header,"~",5),"@",2)
   . $$$WriteElement("text",$P(header,"~",2))
   . $$$WriteElement("key",FieldName)
   . s sc=xmlstr.EndElement()
  s sc=xmlstr.EndElement()
  }
 s FieldNames("ID")=1
 s FieldNames("ID","type")="%String"
 s glob=$NA(^mtempSklad($I))
 s ok=..GetChildDocs(InstrId,glob,.FieldNames)
 // Формирование тела
  s sc=xmlstr.Element("AllObjects")
  s i="" f  s i=$O(@glob@(i)) q:i=""  d
  . s sc=xmlstr.Element("OneObject")
  . s sc=xmlstr.WriteAttribute("id",$G(@glob@(i,"ID","text")))
  . s z="" f  s z=$O(@glob@(i,z)) q:z=""  d
  . . s sc=xmlstr.Element(z)
  .	.	$$$WriteElement("text",$G(@glob@(i,z,"text")))
  .	. s sc=xmlstr.EndElement()
  . s sc=xmlstr.EndElement()
  s sc=xmlstr.EndElement()
 
 s sc=xmlstr.EndRootElement()
 q
LoadDocsFromInstrErr
  $$$WriteError($ZE)
  q "Ошибка при попытке вывести документ созданный инструкцией"
]]></Implementation>
</Method>

<Method name="LoadGoodsFromInstr">
<ClassMethod>1</ClassMethod>
<FormalSpec>instr,p1,p2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="LoadGoodsFromInstrErr"
 s err="Извините, ошибка при выводе товаров инструкции"
 
 $$$StartXML
 
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("number","№",40)
  $$$WriteHeader("tovar","Товар",220)
  $$$WriteHeader("kol","Количество",70)
 s sc=xmlstr.EndElement()

 s sc=xmlstr.Element("AllObjects")
 s obj=##class(Operation.Instructions).%OpenId(instr)
 d:$ISOBJECT(obj)
 . s i="" f  s i=obj.Items.Next(i) q:i=""  d
 . . s item=obj.Items.GetAt(i)
 . . d:$ISOBJECT(item.Goods)
 . . . s goodsmod=item.Goods.Property3609
 . . . s goodsabbr=item.Goods.abbr
 . . . s goodsname=item.Goods.Name
 . . . s g=goodsabbr_" "_goodsmod_" "_goodsname
 . . s quant=item.Quantity
 . . i $I(count)
 . . s sc=xmlstr.Element("OneObject")
 . .	$$$WriteElementTwice("number",count)
 . .	$$$WriteElementTwice("tovar",$G(g))
 . .	$$$WriteElementTwice("kol",quant)
 . . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 
 $$$EndXML

 q 1
LoadGoodsFromInstrErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="GetChildDocs">
<Description>
Заполнить глобал glob потомками DocId
FieldNames("имя нужного поля","тип этого поля")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,glob,FieldNames</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetChildDocsErr"
 k @glob
 i DocId="" $$$WriteError("Не указан DocId")
 &sql(select DocumentClass into :DocumentClass from Docs.Super where ISNULL(Source,'')=:DocId)
 if SQLCODE=100 q 1
 s result = ##class(%ResultSet).%New()
 i '+result $$$WriteObjError(result) q 0
 
 s i="" f  s i=$O(FieldNames(i)) q:i=""  d
 . s field=i
 . s:$E($G(FieldNames(i,"type")),1,1)'="%" field=field_"->Name As "_field
 . s fields=$G(fields)_field_","
 i $G(fields)'="" s fields=$E(fields,1,$L(fields)-1)
 e  s fields="*"
 s sql="SELECT "_fields_" FROM "_DocumentClass_" where Source="_DocId
 s ok=result.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 s result.RuntimeMode=2
 s ok=result.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 f i=1:1:result.GetColumnCount() d
 . s columns(i)=result.GetColumnName(i)
 . s:columns(i)="" columns(i)="undef"
 While result.Next() {
 i $Increment(str)
 f i=1:1:result.GetColumnCount() d
 . s text=result.GetData(i)
 . s @glob@(str,columns(i),"text")=text
 }
 q 1
GetChildDocsErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="GetClassFromSource">
<Description><![CDATA[
Получить имя класса который требуется создать для данного документа
<br><var>Source</var> - Документ в формате ID@Class]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Source</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetClassFromSourceErr"
	s SourceClass=$P(Source,"@",2)
	s SourceId=$P(Source,"@",1)
	if SourceClass="" s SourceClass=..getClassFromId(SourceId)
	if SourceClass="Docs.Rash" q "Docs.StorageOut"
	if (SourceClass="Docs.Prih")||(SourceClass="Docs.DocBrak") q "Docs.StorageIn"
	if SourceClass="Docs.StorageOut" q "Docs.InnerDiff"
	s opertype=""
	if SourceClass="Operation.Instructions" d
	. &sql(select Oper->cl into :opercl from Operation.Instructions where id=:SourceId)
	q $P(opercl,",")
GetClassFromSourceErr
 $$$WriteError($ZE)
 q "Docs.Prih"
]]></Implementation>
</Method>

<Method name="GetDocNameFromClass">
<Description><![CDATA[
Получить экранное имя класса
<br><var>ClassName</var> - Имя класса]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName=""</FormalSpec>
<Implementation><![CDATA[
	s $ZT="GetDocNameFromClassErr"
	q:ClassName="" ""
	s obj=##class(Docs.Docs).%OpenId(ClassName)
	i $ISOBJECT(obj) q obj.Name
	q ""
GetDocNameFromClassErr
 $$$WriteError($ZE)	
 q "Ошибка определения имени документа"
]]></Implementation>
</Method>

<Method name="SaveDocObject">
<Description><![CDATA[
Сохранить документ и связанные строки
<var>DocData</var> - данные по всему документу
<example>
DocData=docid
DocData("head",fieldName)=fieldValue
DocData("body",rowindex)=rowid
DocData("body",rowindex,"DocType")=DocClass_"Items"
DocData("body",rowindex,itemFieldName)=itemFieldValue
DocData("body",rowindex,itemFieldName)=itemFieldValue
</example>
<var>types</var>	- Типы значений полей документа и строк		
types(fieldName)=fieldType
types(className_"Items",itemFieldName)=itemFieldType
Используется в классах (json.instruction, json.irows)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocClass,DocData,fieldtypes</FormalSpec>
<Implementation><![CDATA[
 //n docid,doc,waste,field,val,type,ItemsClass,types,strtypes,ok,
 //str,strobj
 q:DocClass=""
 TSTART
 s $ZT="SaveDocObjectErr"
 s docid=$G(@DocData)
 s doc="",types=1,err=1
 //i $D(fieldtypes(DocClass))<10 d //можем передать типы полей, а можем искать
 //. s waste=##class(Common.Common).showheaders(DocClass,"","","","",.types)
 //. k waste
 //e  m types=fieldtypes(DocClass)
 s waste=##class(Common.Common).showheaders(DocClass,"","","","",.types,"","RashOplatType,Tovar,AllowToSend")
 
 //пробежимся по строкам документа который прислал пользователь, соберём там ID строк документа
 k DocumentStringsCameFromUser
 s str="" f  s str=$O(@DocData@("body",str)) q:str=""  d
 . s strobj=$G(@DocData@("body",str))
 . s:strobj'="" DocumentStringsCameFromUser(strobj)=""	//сохраняем в массиве ID строк документа которые пришли

 if docid'="" d
 . s doc=$ZOBJCLASSMETHOD(DocClass,"%OpenId",docid)
 . q:'$D(@DocData@("body"))
 . q:'$ISOBJECT(doc)  //если удалось открыть объект то удалим его строки
 . q:'$ISOBJECT(doc.Items)  //у некоторых документов вообще нет строк
 . s i="" f  s i=doc.Items.Next(i) q:i=""  d  //проходимся по всем строкам документа
 . . s item=doc.Items.GetAt(i)
 . . q:$D(DocumentStringsCameFromUser(item.%Id()))	//пропустим строки которые перечислены в документе который пришёл от пользователя
 . . d item.%DeleteId(item.%Id())  //удаляем строки документа
 . . d doc.Items.RemoveAt(i)  //удаляем из списка строк документа
 . . k item  //убиваем сам объект в памяти

 if '$ISOBJECT(doc) s doc=$ZOBJCLASSMETHOD(DocClass,"%New")
 s field="" f  s field=$O(@DocData@("head",field)) q:(field="")||('+err)  d
 . s val=@DocData@("head",field)
 . s necessary=$$unrequired(field,DocClass)
 . i (val="")&('necessary) s err="Не заполнены все необходимые поля заголовка документа" q
 . s type=$G(types(field))
 . i type="" $$$WriteError("для класса "_DocClass_" не нашлось определения свойства "_field_" в CompiledClass") q
 . i type="%Date" s:val'="" val=$ZDH(val,4)
 . i type="%Time" s:val'="" val=$ZTH(val,1,"")
 . i type="%Numeric" s val=+val
 . i type["%" s $ZOBJPROPERTY(doc,field)=val
 . e  d $ZOBJMETHOD(doc,field_"SetObjectId",val)
 . //если запрещаем товар, то запрещаем его для всех
 . //s ^mtempArt("z",DocClass,field)=val
 . //if (DocClass="Goods.Goods") && (field="AllowToSend")&& (+val=0) d  
 . //. s ^mtempArt("docid")=docid
 . //. d ..BanGoodsForAll(docid)
 
 q:'+err err
 s ItemsClass=DocClass_"Items"
 s strtypes=1
 i $D(fieldtypes(ItemsClass))<10
 . s waste=##class(Common.Common).showheaders(ItemsClass,"","","","",.strtypes,"","RashOplatType")
 . k waste
 e  m strtypes=fieldtypes(ItemsClass)
 //здесь начинается цикл по строкам документа содержащегося в глобали 
 s ok=1
 s str="" f  s str=$O(@DocData@("body",str)) q:(str="")!('+ok)  d
 . s strobj=$G(@DocData@("body",str))
 . s:strobj'="" DocumentStringsCameFromUser(strobj)=""	//сохраняем в массиве ID строк документа которые пришли
 . if strobj'="" s strobj=$ZOBJCLASSMETHOD(ItemsClass,"%OpenId",strobj)
 . if '$ISOBJECT(strobj) s strobj=$ZOBJCLASSMETHOD(ItemsClass,"%New")
 . i '$D(@DocData@("body",str,"DocType")) s @DocData@("body",str,"DocType")=DocClass,strtypes("DocType")="Docs.Docs"
 . s field="" f  s field=$O(@DocData@("body",str,field)) q:(field="")!('+ok)  d
 . . s type=$G(strtypes(field))  //тип поля
 . . i type="" $$$WriteError("для класса "_ItemsClass_" не нашлось определения свойства "_field_" в CompiledClass") q
 . . s val=$G(@DocData@("body",str,field))  //значение поля
 . . s necessary=$$unrequired(field,ItemsClass)  //выяснить обязательно ли к заполнению поле
 . . i (val="")&('necessary) s err="Не заполнены все необходимые поля строк документа" q
 . . i type="%Date" s:val'="" val=$ZDH(val,4)
 . . i type="%Time" s:val'="" val=$ZTH(val,1,"")
 . . i type="%Numeric" s val=+val
 . . i type["%" s $ZOBJPROPERTY(strobj,field)=val
 . . i type'["%"  s ok=$ZOBJMETHOD(strobj,field_"SetObjectId",val)
 . . //s:field="Goods" goods=val
 . //s:DocClass="Operation.Instructions" $ZOBJPROPERTY(strobj,"Price")=##class(Store.Action).getlastcena($G(goods))
 . i DocClass="Docs.StorageOut" s strobj.Price=##class(Store.Action).getlastcena(strobj.Goods.%Id())
 . s ok=doc.Items.Insert(strobj)
 . i '+ok $$$WriteObjError(ok) q
 i '+ok q "Ошибка при сохранении строк документа"
 s ok=doc.%Save()
 i '+ok $$$WriteObjError(ok) TROLLBACK  q "Ошибка при сохранении документа: "_$system.Status.GetOneErrorText(ok)
 s scriptok=..script(DocClass,doc)
 i ('+scriptok)&((DocClass="Docs.Remont")||(DocClass="Docs.Otchet")) d  q scriptok 
 . TROLLBACK
 TCOMMIT
 q:'+scriptok scriptok
 if DocClass="Common.Dictionary2" q 1
 q doc.%Id()
SaveDocObjectErr
 s errorMessage=$ZE
 $$$WriteError($ZE)
 Q "Извините, при сохранении документа произошла ошибка: "_errorMessage
unrequired(field,class)
 // здесь лежат поля которые не обязательны для заполнения
 q:class="Goods.Goods" 1
 q:class="Common.Dictionary2" 1
 q:class="Common.Kontragent" 1
 i field="Comment" q 1
 i field="CloseDate" q 1
 i field="CloseTime" q 1
 i field="CloseUser" q 1
 q $D(^UnRequiredFields(class,field))
]]></Implementation>
</Method>

<Method name="getClassFromId">
<Description>
Получить класс документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SourceId</FormalSpec>
<Implementation><![CDATA[
 s obj=##class(Docs.Super).%OpenId(SourceId)
 q:'$ISOBJECT(obj) ""
 q:'$ISOBJECT(obj.DocumentClass) obj.DocumentClass
 q obj.DocumentClass.%Id()
]]></Implementation>
</Method>

<Method name="GetStrFromDoc">
<Description>
Получить строки документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>docid="",p1,forclass</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetStrFromDocErr"
 if docid="" $$$WriteError("GetStrFromDoc: не указан ID документа")
 s docclass=..getClassFromId(+docid)_"Items"
 i docclass="Items" s docclass=$P(docid,"@",2)
 s docid=+docid 
 s headers=##class(Common.Common).showheaders(docclass)
 s depot=$G(%session.Data("depot"))
 // Формирование заголовков
 if $L($G(headers),"#@#")>1 {
 s fields=""
 f i=1:1:$L(headers,"#@#") d
 . s header=$P(headers,"#@#",i)
 . q:header=""
 . s FieldName=$P(header,"~",1)
 . s FieldType=$P($P(header,"~",5),"@",2)
 . i FieldName="Goods" s fields=fields_"Goods->Size1 As GoodsSize,Goods->Weight As GoodsWeight,Goods->Weight As GoodsWeight,Goods->Property3609 as Property3609,"
 . //если тип поля не начинается с % то выводим его ссылку и рядом само поле но с другим названием
 . s:$E(FieldType,1,1)'="%" FieldName=FieldName_"->Name As "_FieldName_","_FieldName_" As "_FieldName_"ObjectId"
 . s fields=fields_FieldName_","
 }
 i $G(fields)'="" s fields="ID,"_$E(fields,1,($L(fields)-1))  //обрежу последнюю запятую и прибавлю id
 e  s fields="*"
 
 s xmlstr=##class(%XML.Writer).%New()
 s xmlstr.Charset="windows-1251"
 d xmlstr.OutputToDevice()
 s sc=xmlstr.RootElement("RootElement")
 s sc=xmlstr.Element("AllObjects")

 s result = ##class(%ResultSet).%New()
 i '+result $$$WriteObjError(result) q 0
 s sql="SELECT "_fields_" FROM "_docclass_" where Doc="_docid
 s ok=result.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 //s result.RuntimeMode=2
 s ok=result.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 f i=1:1:result.GetColumnCount() d
 . s columns(i)=result.GetColumnName(i)
 . s:columns(i)="" columns(i)="undef"
 . s columnsName(columns(i))=i
 . s columntype(i)=result.GetColumnType(i)
 While result.Next() {
 CONTINUE:(forclass="Docs.Diff")&($G(result.Data("Kolfact"))=$G(result.Data("Quantity")))
 s sc=xmlstr.Element("OneObject") 
 s sc=xmlstr.WriteAttribute("id",result.GetData(columnsName("ID")))
 	f i=1:1:result.GetColumnCount() d
	. q:$G(columns(i))=""
	. s text=result.GetData(i)
	. i columns(i)="Quantity" s quant=text
 	. i '+p1 s fld=$G(^Substitute("StorageDocs",columns(i)),columns(i))
 	. e  s fld=columns(i)
 	. s sc=xmlstr.Element(fld)
 	. i $E(columntype(i),1,1)'="%" s text=result.GetData(i) d  //если тип поля не начинается с % то выводим в его аттрибуте его id эквивалент
 	. . s FieldIdNum=+$G(columnsName(columns(i)_"ObjectId"))
 	. . s objid=result.GetData(FieldIdNum)
 	. . i fld="Goods" s goods=objid,text=result.Data("Property3609")_" "_text  //если это товар то добавляем модель к наименованию
 	. . i FieldIdNum s sc=xmlstr.WriteAttribute("id",objid)
 	. . //i (forclass="Docs.Diff")&(fld="Total") s text=$G(result.Data("Kolfact"))
  	. s:columns(i)="addr" text=##class(Store.Action).AddressPath(result.Data("addrObjectId"),1)
 	. //i fld="Price" s text=##class(Goods.GoodsAction).getprice(goods)
 	. i columntype(i)=8,text s text=$ZT(+text,1,"")
	. i columntype(i)=2,text s text=$ZD(+text,4)
	. $$$WriteElement("text",text)
 	. s sc=xmlstr.EndElement()
 i (docclass="Docs.RashItems")&(forclass="Docs.StorageOut") d
 . s sc=xmlstr.Element("addr")
 . s addr=""
 . s waste=##class(Goods.GoodsAction).getgoodquant($G(goods),"",.addr,quant)  //найдем ячейку где лежит товар с нужным количеством
 . //s waste=##class(Goods.GoodsAction).getgoodquant($G(goods),depot,.addr,quant)
 . s sc=xmlstr.WriteAttribute("id",addr)
 . s text=##class(Store.Action).AddressPath(addr,1)
 . $$$WriteElement("text",text)
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 }
 
 s sc=xmlstr.EndElement()
 s sc=xmlstr.EndRootElement() 
 
 q
GetStrFromDocErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="parsexml">
<Description>
Парсинг XML</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass,types,DocData,saveadditional=0</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveStorageDocErr",str=0
 s err="Извините, при сохранении документа произошла ошибка."
 s:$G(DocData)="" DocData=$NA(^mtempDoc($I))
 k @DocData
 s sc=##class(%XML.TextReader).ParseStream(xmlstream,.reader)
 i '+sc $$$WriteObjError(sc) q err
 While reader.Read() {
 i (reader.NodeType="element") {
     s path=reader.Path
     s namenode=reader.Name
     s parentnode=$P(path,"/",$L(path,"/")-1)
     i $P(path,"/",3)="AllObjects" s class=documentclass_"Items",j="body"
     e  s class=documentclass,j="head"
     i (parentnode="AllObjects")&(namenode="OneObject") s str=$I(str)
     d:(reader.HasAttributes)&(namenode="OneObject")&(+docid)
     . d reader.MoveToAttributeName("id")
     . s @DocData@(j,str)=reader.Value
     i namenode="type" d
     . d:'reader.IsEmptyElement reader.MoveToContent()
     . s types(class,parentnode)=reader.Value
     i (namenode="text")&(j="body") d
     . d:'reader.IsEmptyElement reader.MoveToContent()
     . s @DocData@(j,str,parentnode)=reader.Value
     i (namenode="text")&(j="head") d
     . d:'reader.IsEmptyElement reader.MoveToContent()
     . s @DocData@(j,parentnode)=reader.Value
     i ($L(path,"/")>5)&(namenode'="text")&saveadditional d
     . d:'reader.IsEmptyElement reader.MoveToContent()
     . s @DocData@(j,parentnode,namenode)=reader.Value
     
 }}
 s @DocData=$G(docid)
 q 1
SaveStorageDocErr
 $$$WriteError($ZE)
 q "Извините. При сохранении документа произошла ошибка."
]]></Implementation>
</Method>

<Method name="SaveStorageDoc">
<Description>
Пропарсить XML передать массив в метод сохранения</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass</FormalSpec>
<Implementation><![CDATA[
 s ok=..parsexml(xmlstream,docid,documentclass,.types,.DocData)
 q:'+ok ok
 if documentclass="Common.Kontragent" s ok=..SaveListOfObjects(documentclass, DocData) q ok
 if documentclass="Goods.Goods" s ok=..SaveListOfObjects(documentclass, DocData) q ok
 s ok=..SaveDocObject(documentclass, DocData, .types)
 q ok
]]></Implementation>
</Method>

<Method name="SaveSingleGood">
<Description>
Сохранить товар заполненный на форме</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass</FormalSpec>
<Implementation><![CDATA[
 s CurrentLogin=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 if '##class(Common.Rights).getrights(CurrentLogin,9) q "Нет прав для работы с товаром." 
 s ok=..parsexml(xmlstream,docid,documentclass,.types,.DocData)
 
 q:'+ok ok
 s ok=..SaveDocObject(documentclass, DocData, .types)
 q ok
]]></Implementation>
</Method>

<Method name="CheckFinal">
<Description><![CDATA[
проверить закрыт или не закрыт документ (исполнен/не исполнен)
<var>doc</var> - id или объект документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 i '$ISOBJECT(doc) s doc=##class(Docs.Super).%OpenId(doc)
 i '$ISOBJECT(doc) $$$WriteError("CheckFinal не смогли открыть объект "_doc_" класса Docs.Super") q 0
 i doc.Stat=2 q 1
 q 0
]]></Implementation>
</Method>

<Method name="SetFinal">
<Description>
Установить документу статус закрытого</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
	
 i '$ISOBJECT(doc) s doc=##class(Docs.Super).%OpenId(doc)
 s doc.Stat=2
 s ok=doc.%Save() 
 i '+ok $$$WriteObjError(ok) q "Ошибка при изменении статуса документа"
 q 1
]]></Implementation>
</Method>

<Method name="script">
<Description><![CDATA[
действия над документами после их создания (при создании документов от инструкции руководителя)
<br>class - класс документа
<br>docobj - объект документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class,docobj,currentJob</FormalSpec>
<Implementation><![CDATA[
 s $ZT="scriptErr"
 s ok=1
 q:class="Store.Address" 1
 q:class="Goods.Goods" 1
 q:class="Common.Kontragent" 1
 q:class="Common.Dictionary2" 1
 
 q:'$ISOBJECT(docobj) 1
 i class="" $$$WriteError("script Передали пустой класс") q 1

 //если приходная или расходная запишем контрагента и товар, и закупочную цену для товара
 i class="Store.Price" d  q ok
 . q:docobj.typcen.Property4139'=1 //если это не основная продажная то не пишем товару
 . s docobj.Goods.Price=docobj.Price
 . s ok=docobj.Goods.%Save()
 . i '+ok $$$WriteObjError(ok) s ok="Извините, ошибка при записи цены товару."

 i $ISOBJECT(docobj.Kontr) s kontr=docobj.Kontr.%Id()
 e  s kontr=0
 Set key = ""
 Do 
 {
  Set itemobj = docobj.Items.GetNext(.key)
  If $ISOBJECT(itemobj) 
  {
     s goods=itemobj.Goods.%Id()
     s ok=..SaveKontr(kontr,goods)
     s:class="Docs.Prih" ok=##class(Store.Action).SetPrice(goods,+itemobj.Price,4,docobj.Dat,docobj.Tim)
  }
 } While (key '= "") q:'+ok ok
 q:'+ok ok
 
 
 // Если заявка на ремонт запишем товары
 if class="Docs.Remont" {
 //s ok=..MarkGarant(docobj)
 s docid=docobj.%Id()
 Do {
  Set itemobj = docobj.Items.GetNext(.key)
  If $ISOBJECT(itemobj) {
     s goods=itemobj.Goods.%Id()
     d ..addTovarOnKontr(kontr,goods,itemobj.Quantity)
     //если есть гарантийный талон и если эта связка не фигурировала в этом документе
     //if itemobj.garant'="",'$D(NumbersInThisDoc(" "_itemobj.garant," "_itemobj.serial)) s ok=..setSerialGarant(itemobj.serial,itemobj.garant,itemobj.Goods,docid,class,$G(currentJob))
     s NumbersInThisDoc(" "_itemobj.garant," "_itemobj.serial)=""
  }
  } While ((key '= "")&&(ok)) q:'+ok ok
 }
 q:'+ok ok
  if class="Docs.Otchet" {
 s docid=docobj.%Id()

  Do {
  s demandserial=$G(%session.Data("demandserial"))
  Set itemobj = docobj.Items.GetNext(.key)
  If $ISOBJECT(itemobj) {
     s:$ISOBJECT(itemobj.Goods) goods=itemobj.Goods.%Id()
     s:itemobj.goodssource=1 ok=..remTovarOnKontr(kontr,goods,itemobj.Quantity)
     q:'+ok
	 i (itemobj.garant'="")&(itemobj.serial="")&(+demandserial) s ok="Не указан серийный номер изделия для гарантийного талона "_garant q
     if itemobj.garant'="",'$D(NumbersInThisDoc(" "_itemobj.garant," "_itemobj.serial)) s ok=..setSerialGarant(itemobj.serial,itemobj.garant,itemobj.Goods,docid,class,$G(currentJob))
     s NumbersInThisDoc(" "_itemobj.garant," "_itemobj.serial)=""
  }
  } While (key '= "") q:'+ok ok
  i $ISOBJECT(docobj.Rem) s docobj.Rem.Otchet=docobj d docobj.Rem.%Save()
 }
 q ok
scriptErr
 $$$WriteError($ZE)
 q "Ошибка при исполнении сценария"
]]></Implementation>
</Method>

<Method name="LookGarantDate">
<Description>
Метод записывает соответствие серийного номера и гарантийного талона</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[garantobj:Common.Dictionary2,&remont,docclass,IgnoreDisabled=0]]></FormalSpec>
<Implementation><![CDATA[
 s $ZT="LookGarantDateErr"
 s garantterm=$S($ISOBJECT($G(%session)):$G(%session.Data("garantterm")),1:7)
 s writemode=$S($ISOBJECT($G(%session)):$G(%session.Data("writemode")),1:"skip")
 //s garantterm=7
 //s writemode="skip"
 
 s remont=""
 //s garantterm=7
 //s writemode="skip"
 i garantobj.Property9194=2,'IgnoreDisabled q "Гарантийный талон "_garantobj.Name_" "_garantobj.Property9194LogicalToDisplay(garantobj.Property9194)
 s ok=1
 s remont1=garantobj.remont1
 s remont1otch=garantobj.remont1otch
 s remont2=garantobj.remont2
 s remont2otch=garantobj.remont2otch
 s remont3=garantobj.remont3
 s remont3otch=garantobj.remont3otch

 d:docclass="Docs.Otchet"
 . i remont1'="" d  // есть первая заявка
 . . i remont1otch'="" d  //есть первый отчет
 . . . i remont2'="" d  // есть вторая заявка
 . . . . i remont2otch'="" d  // есть 2 отчет
 . . . . . i remont3'="" d  // есть третья заявка
 . . . . . . i remont3otch'="" d  //есть третий отчет
 . . . . . . . i writemode="perepis" s remont=3 q
 . . . . . . e  s remont="remont3" q
 . . . . . e  d
 . . . . . . i ($H-remont2otch.Dat)>=garantterm s remont="remont3"
 . . . . . . e  s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(remont2otch.Dat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 . . . . e  s remont="remont2" q
 . . . e  d
 . . . . i ($H-remont1otch.Dat)>=garantterm s remont="remont2"  //нет 2 рем и проходит по дате
 . . . . e  s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(remont1otch.Dat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 . . e  s remont="remont1" q
 . e  s remont="remont1"
 
 d:docclass="Docs.Remont"
 . i (remont1'="")||(remont1otch'="") d //есть первый ремонт
 . . i (remont2'="")||(remont2otch'="") d // есть второй ремонт
 . . . i (remont3'="")||(remont3otch'="") d // есть третий ремонт
 . . . . i (writemode="perepis") s remont="remont3"
 . . . . e  s ok=1 q
 . . . e  d
 . . . . s lastremdat=$$data(garantobj,2)
 . . . . i +$H-lastremdat>=garantterm s remont="remont2" q
 . . . . e  s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(lastremdat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 . . e  d
 . . . s lastremdat=$$data(garantobj,1)
 . . . i +$H-lastremdat>=garantterm s remont="remont3" q
 . . . e  s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(lastremdat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 . e  s remont="remont1" q
 q ok
data(garantobj,numb)
 s rem=$ZOBJPROPERTY(garantobj,"remont"_numb)
 s otch=$ZOBJPROPERTY(garantobj,"remont"_numb_"otch")
 i $ISOBJECT(otch) q otch.Dat
 i $ISOBJECT(rem) q rem.Dat
 $$$WriteError("LookGarantDate.date Авария! попытка найти дату несуществующего ремонта ГТ "_garantobj.Name_" ремонт №"_numb)
 q +$H
 //проверим дату последнего ремонта
 d:remont="remont2"
 . s Dat=$S($ISOBJECT(garantobj.remont1):garantobj.remont1.Dat,$ISOBJECT(garantobj.remont1otch):garantobj.remont1otch.Dat)
 . i ($H-Dat)<+garantterm d
 . . s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(Dat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 d:remont="remont3"
 . s Dat=$S($ISOBJECT(garantobj.remont2):garantobj.remont2.Dat,$ISOBJECT(garantobj.remont2otch):garantobj.remont2otch.Dat)
 . i ($H-Dat)<+garantterm d
 . . s ok="Гарантийный талон №"_garantobj.Name_" был использован "_$ZD(Dat,4)_" минимальный срок между гарантийными ремонтами "_garantterm_" дн." q
 q ok                  
LookGarantDateErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при проверке даты гарантийного талона"
]]></Implementation>
</Method>

<Method name="setSerialGarant">
<ClassMethod>1</ClassMethod>
<FormalSpec>serial="",garant="",goodsobj:Goods.Goods,docid,docclass,currentJob</FormalSpec>
<Implementation><![CDATA[
	s $ZT="setSerialGarantErr"
	q:garant="" 1
	i '$ISOBJECT(goodsobj) $$$WriteError("setSerialGarant не передали объект товара serial = "_serial_", garant ="_garant) q 1
	i docclass="Docs.Otchet" s addition="otch"  //в гарантийном талоне заявки сохраняются в remont1 а отчеты в remont1otch
	e  s addition=""
	s remont=""
	s ok=1
	
	s ^mtempArt("serial")=serial
	s ^mtempArt("garant")=garant
	
	//ID талона найденный по имени
	s garantID = ##class(Common.Common).GetGarantIdByName(garant)
	//ID талона найденные по серийному
	s GarantIDFoundBySerial = ""
	
	/*
	//проверим уникальность серийного номера
	if serial'="" s ok = ##class(Common.Common).CheckSerialUnique(serial,.GarantIDFoundBySerial)
	
	//если такой серийный уже есть и его гарантийный не равен найде
	if ('+ok)&(GarantIDFoundBySerial'=garantID) q ok
	*/
	
	s garantobj=##class(Common.Dictionary2).%OpenId(garantID)
	i $ISOBJECT(garantobj) d
	. s oldserial=garantobj.serial
	. i (docclass="Docs.Otchet")&(oldserial'="")&(oldserial'=serial) d  q
	. . s ok="Для гарантийного талона "_garant_" уже записан серийный номер "_oldserial
    . s ok=..LookGarantDate(garantobj,.remont,docclass)
    . q:'+ok
	e  d
	. s garantobj=##class(Common.Dictionary2).%New()
	. s garantobj.Name=garant
	. s remont="remont1"	
	i '$ISOBJECT(garantobj) q "Гарантийный номер "_garant_" не существует. Пожалуйста создайте его"
	
	/*

	*/
	
	d:remont'="" $ZOBJMETHOD(garantobj,remont_addition_"SetObjectId",docid)
	q:'+ok ok
	s garantobj.serial=serial
	s izdelie=goodsobj.abbr
	
	//если товар в гарантийном талоне есть и он не соответствует товару в заявке
	if (garantobj.tovar'=""),(garantobj.tovar'=izdelie_" "_goodsobj.Property3609) 
	{
		 /*
		 if +$G(currentJob)
		 {
			 s ^temp(currentJob)=0
			 	_$C(9)_"В серийном номере "_serial_" записана модель "_garantobj.tovar_", а в документе "_izdelie_" "_goodsobj.Property3609_". Заменить модель в серийном номере?"
			 	_$C(9)_"Да"_$C(8)_"ok"
			 	_$C(9)_"Нет"_$C(8)_"no"
			 while ($G(^temp(currentJob,"answer"))="")
			 {
				 h 1
			 }
			 s ^mtempArt("currentJob")=currentJob
			 s ^mtempArt("answer")=$G(^temp(currentJob,"answer"))
			 //тут действие зависящее от ответа
			 if ($G(^temp(currentJob,"answer")))="ok" s garantobj.tovar=izdelie_" "_goodsobj.Property3609
		 }
		 else
		 {
			 s garantobj.tovar=izdelie_" "_goodsobj.Property3609
		 }
		 */
	}
	//if garantobj.tovar="" s garantobj.tovar=izdelie_" "_goodsobj.Property3609
	
	s ok=garantobj.%Save()
	i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при записи информации о гарантийном талоне "_garant
	q 1
setSerialGarantErr
 $$$WriteError($ZE)
 q "Извините, ошибка при привязке серийного номера"
]]></Implementation>
</Method>

<Method name="addTovarOnKontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr,goods,val</FormalSpec>
<Implementation><![CDATA[
 i $ISOBJECT(kontr) s kontr=kontr.%Id()
 i $ISOBJECT(goods) s goods=goods.%Id()
	s ^mtempArt("addTovarOnKontr",kontr,goods)=val
 s ^t(kontr,goods)=$G(^t(kontr,goods))+val
 q
]]></Implementation>
</Method>

<Method name="remTovarOnKontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr,goods,val</FormalSpec>
<Implementation><![CDATA[
 i $ISOBJECT(kontr) s kontr=kontr.%Id()
 i $ISOBJECT(goods) s goods=goods.%Id()
 s newkol=$G(^t(kontr,goods))-val
 i newkol<0 q "Произошла попытка списания товара больше чем числится за мастерской, отчет не создан."
 i newkol=0 k ^t(kontr,goods)
 e  s ^t(kontr,goods)=newkol
 q 1
]]></Implementation>
</Method>

<Method name="destroy">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s $ZT="destroyErr"
 &sql(delete from Docs.DocItems)
 q:SQLCODE<0 SQLCODE_" Docs.DocItems"
 &sql(delete from Docs.Super)
 q:SQLCODE<0 SQLCODE_" Docs.Super"
 &sql(delete from Docs.DiffItems)
 q:SQLCODE<0 SQLCODE_" Docs.DiffItems"
 &sql(delete from Docs.Diff)
 q:SQLCODE<0 SQLCODE_" Docs.Diff"
 &sql(delete from Docs.InnerItems)
 q:SQLCODE<0 SQLCODE_" Docs.InnerItems"
 &sql(delete from Docs.Inner)
 q:SQLCODE<0 SQLCODE_" Docs.Inner"
 &sql(delete from Docs.InventItems)
 q:SQLCODE<0 SQLCODE_" Docs.InventItems"
 &sql(delete from Docs.Invent)
 q:SQLCODE<0 SQLCODE_" Docs.Invent"
 &sql(delete from Docs.RemontItems)
 q:SQLCODE<0 SQLCODE_" Docs.RemontItems"
 &sql(delete from Docs.Remont)
 q:SQLCODE<0 SQLCODE_" Docs.Remont"
 &sql(delete from Docs.OtchetItems)
 q:SQLCODE<0 SQLCODE_" Docs.Remont"
 &sql(delete from Docs.Otchet)
 q:SQLCODE<0 SQLCODE_" Docs.Otchet"
 &sql(delete from Docs.PrihItems)
 q:SQLCODE<0 SQLCODE_" Docs.PrihItems"
 &sql(delete from Docs.Prih)
 q:SQLCODE<0 SQLCODE_" Docs.Prih"
 &sql(delete from Docs.RashItems)
 q:SQLCODE<0 SQLCODE_" Docs.RashItems"
 &sql(delete from Docs.Rash)
 q:SQLCODE<0 SQLCODE_" Docs.Rash"
 &sql(delete from Docs.StorageInItems)
 q:SQLCODE<0 SQLCODE_" Docs.StorageInItems"
 &sql(delete from Docs.StorageIn)
 q:SQLCODE<0 SQLCODE_" Docs.StorageIn"
 &sql(delete from Docs.StorageOutItems)
 q:SQLCODE<0 SQLCODE_" Docs.StorageOutItems"
 &sql(delete from Docs.StorageOut)
 q:SQLCODE<0 SQLCODE_" Docs.StorageOut"
 &sql(delete from Docs.UtilizItems)
 q:SQLCODE<0 SQLCODE_" Docs.UtilizItems"
 &sql(delete from Docs.Utiliz)
 q:SQLCODE<0 SQLCODE_" Docs.Utiliz"
 &sql(delete from Store.Quantity)
 q:SQLCODE<0 SQLCODE_" Store.Quantity"
 &sql(delete from Store.Price)
 q:SQLCODE<0 SQLCODE_" Store.Price"
 &sql(delete from Operation.OperationHistory)
 q:SQLCODE<0 SQLCODE_" Operation.OperationHistory"
 &sql(delete from Operation.Plan)
 q:SQLCODE<0 SQLCODE_" Operation.Plan"
 &sql(delete from Operation.InstructionsItems)
 q:SQLCODE<0 SQLCODE_" Operation.InstructionsItems"
 &sql(delete from Operation.Instructions)
 q:SQLCODE<0 SQLCODE_" Operation.Instructions"
 &sql(delete from Operation.InstructionsHist)
 q:SQLCODE<0 SQLCODE_" Operation.InstructionsHist"
 k ^t
 &sql(update Store.Address set Currentsize=0,Currentweight=0)
 q:SQLCODE<0 SQLCODE_" Store.Address"
 k ^Kontr
 k ^RashNumbers
 q 1
destroyErr
 q $ZE
]]></Implementation>
</Method>

<Method name="PrihNeedsDiff">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s $ZT="PrihNeedsDiffErr"
 s class=..getClassFromId(doc)
 s docobj=$ZOBJCLASSMETHOD(class,"%OpenId",doc)
 i '$ISOBJECT(docobj) $$$WriteError("PrihNeedsDiff не открылся объект "_doc_" класса "_class) q "Документ сохранён но возникли ошибки при проверке."
 s ok=1
 i class="Docs.Prih" d
 . f i=1:1:docobj.Items.Count() q:'+ok  d
 . . s item=docobj.Items.GetAt(i)
 . . i item.Kolfact'=item.Quantity s ok="yes"
 i class="Docs.StorageOut" d
 . f i=1:1:docobj.Items.Count() q:'+ok  d
 . . s item=docobj.Items.GetAt(i)
 . . i (item.quantdefault'=item.quantreal)&(item.quantreal'="") s ok="yes"
 q ok
PrihNeedsDiffErr
 $$$WriteError($ZE)
 q "Документ сохранён но возникли ошибки при проверке."
]]></Implementation>
</Method>

<Method name="processdoc">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc=""</FormalSpec>
<Implementation><![CDATA[
	 //s $ZT="processdocErr"
	 s ok=1,made=0
	 s err="Извините. Внутренняя ошибка при обработке документа."
	 s docid=$P(doc,"@",1)
	 s docclass=$P(doc,"@",2)
	 i docid="" $$$WriteError("processdoc docid=""""") q err
	 i docclass="" $$$WriteError("processdoc docclass=""""") q err
	 s doc=$ZOBJCLASSMETHOD(docclass,"%OpenId",docid)
	 i '$ISOBJECT(doc) $$$WriteError("processdoc Не удалось открыть объект "_docid_" класса "_docclass) q err
	 q:doc.Stat=2 "Документ уже обработан"
	 i docclass="Docs.Utiliz" s ok=..processutiliz(doc),made=1
	 i docclass="Docs.Invent" s ok=..processinvent(doc),made=1
	 i docclass="Docs.Inner" s ok=..processinner(doc),made=1
	 i docclass="Docs.Platejka" s ok=..processplatej(doc),made=1
	 i docclass="Docs.Otchet" s ok=..processotchet(doc),made=1
	 i docclass="Docs.Brakremont" s ok=..processbrakremont(doc),made=1
	 i docclass="Docs.Act" s ok=..processact(doc),made=1
	 i docclass="Docs.Sluzap" s ok=..processSluZap(doc),made=1
	 q:'+ok ok
	 i 'made q "Данный тип документов не подлежит обработке."
	 s doc.Stat=2
	 s ok=doc.%Save()
	 i '+ok $$$WriteObjError(ok) q err
	 q 1
processdocErr
	 $$$WriteError($ZE)
	 q "Извините, во время обработки документа произошла ошибка."
]]></Implementation>
</Method>

<Method name="processSluZap">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
	s $ZT="processSluZapErr"
	
	if $ISOBJECT(doc) s docobj = doc
	else  s docobj = ##class(Docs.Sluzap).%OpenId(doc)
	
	if '$ISOBJECT(docobj) q "Извините. Не удалось получить доступ к документу "_doc
	s docid = docobj.%Id()
	
	&sql(declare sluzap cursor for
		SELECT Otchet
		INTO :Otchet
		FROM Docs.sluzapItems 
		WHERE Doc=:docid)
	&sql(open sluzap)
	f  &sql(fetch sluzap) q:SQLCODE  d
	. if '+Otchet q
	. s otch(Otchet)=""
	&sql(close sluzap)
	
	//теперь всем отчётам пропишем эту служебную записку
	TSTART
	s OtchetId = ""
 	f  s OtchetId = $O(otch(OtchetId)) q:OtchetId=""  d
 	. &sql(update Docs.Otchet set Sluzap = :docid where ID=:OtchetId)
 	. if SQLCODE q
 	if SQLCODE 
 	{
	 	TROLLBACK
	 	q "Извините, ошибка при попытке закрыть служебную записку, не найден отчёт "_OtchetId
 	}
 	else
 	{
		TCOMMIT
 	}
	
	
	//соберём в массив все отчёты упоминающиеся в этой записке
	q 1
processSluZapErr
 $$$WriteError($ZE)
 q "Извините, во время обработки документа произошла ошибка"
]]></Implementation>
</Method>

<Method name="processotchet">
<Description>
Обработать отчёт</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s ok=##class(Kontragent.DocsFilter).CheckOtchet(doc)
 //если отчёт прошёл и не разрешено автоматическое проведение отчётов
 if +ok,'$$$TunesVariableGlobal("AllowReportApprovement") q "Программа проверки не нашла ошибок в отчёте, но статус документа остался ""создан"""
 //юра попросил 29.10.2010 он сам примет а ему только показать ошибки
 //if ok s ok=##class(Docs.Otchet).SetOthcetStatAccepted(doc)
 //e  q ok
 q ok
]]></Implementation>
</Method>

<Method name="processact">
<Description>
Обработать акт</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s login = $$$SessionData("user")
	if '##class(Common.Rights).getrights(login,12) q "У вас нет достаточных прав для операций с актами."
	
	if doc.Items.Count()=0 q "Акт не может быть принят, так как нет ни одной заявки."
	
	s serial=doc.Serial
	s garant=doc.Garant
	s kontr =doc.Kontr.%Id()
	
	if $TR(garant," ","")="" q "Акт не может быть принят, так как не указан гарантийный талон."
	
	s GarantObj=##class(Common.Dictionary2).%OpenId(garant)
	if '$ISOBJECT(GarantObj) d
	. s GarantObj=##class(Common.Dictionary2).%New()
	. s GarantObj.Name=garant
	
	//если вдруг гарантийный уже недействительный, акт надо отбить
	if GarantObj.Property9194=2 d
	. s result="Акт не может быть принят. Гарантийный талон "_garant_" недействительный"
	. //но если вдруг в гарантийном уже был указан именно этот акт, то всё таки можно принять
	. if $ISOBJECT(GarantObj.Act),GarantObj.Act.%Id()=doc.%Id() s result=1
	e  s result=1
	if '+result q result
	
	//проверим наличие инструкций от этого контрагента, в которых есть этот серийный и гарантийный
	&sql(declare kot cursor for
		select ID,doc,doc->Name,doc->Dat,Goods
		into :ID,:docId,:docName,:docDat,:Goods
		from Operation.InstructionsItems
		where garant = :garant and sn=:serial and doc->Kontr=:kontr
		)
	&sql(open kot)
	f  &sql(fetch kot) q:SQLCODE  d
	. i $i(docscount)
	. s docsstring(docId,"doc")=docId
	. s docsstring(docId,"Name")=docName
	. s docsstring(docId,"Dat")=docDat
	. s docsstring(docId,ID,"Goods")=Goods
	. s docsstring=$G(docsstring)_docId_","
	&sql(close kot)
	
	//не найдено ни одной заявки на этот серийный номер
	if $G(docsstring)="" q "Не найдено ни одной заявки для этого акта."
	//обрезаем последнюю запятую
	s docsstring=$E(docsstring,1,$L(docsstring)-1)
	
	//f i=1:1:$L(docsstring,",") s docsstring($P(docsstring,",",i))=""
	
	
	//ищем в истории инструкции которые были отправлены
	s SqlString = "select Instr,State from Operation.InstructionsHist where instr in ("_docsstring_")"
	s rs=##class(%ResultSet).%New()
	s ok=rs.Prepare(SqlString)
	s ok=rs.Execute()
	while rs.Next()
	{
		s Instr=rs.Data("instr")
		s State=rs.Data("State")
		if $LF($LB(5,6,7,8,8.7,8.9),State)
		{
			if '$D(docsstring(Instr,"innerinstr")) s docsstring(Instr,"innerinstr")=##class(Operation.InstrActions).GetInnerInstr(Instr)
			s InnerInstr=docsstring(Instr,"innerinstr")
			//проверяем был ли 100% отправлен этот товар, 
			//если да - удаляем упоминание об этой инструкции
			if ##class(Operation.InstrActions).GoodsHasBeenSent(InnerInstr,Goods) s docsstring(Instr,"HasBeenSent")=1
			else  s docsstring(Instr,"HasBeenSent")=0
		}
		else  
		{
			s docsstring(Instr,"HasBeenSent")=0
		}
	}
	
	s i="" f  s i=$O(docsstring(i)) q:i=""  d
	. s HasBeenSent=+$G(docsstring(i,"HasBeenSent"))
	. if HasBeenSent s HasBeenSentCount=$G(HasBeenSentCount)+1
	. i $I(InstructionsCount)
	. s Dat=$G(docsstring(i,"Dat"))
	. if Dat?5N s Dat=$ZD(Dat,4)
	. s result=$G(result)_" № "_$G(docsstring(i,"Name"))_" от "_Dat_" "_$S(HasBeenSent:"Отправлена",1:"Не отправлена")
	s doc.CheckResult=result
	
	//если все заявки были отправлены, тогда не примем, иначе примем
	if InstructionsCount=$G(HasBeenSentCount) d
	. s ActCheckStatus="fail"
	. s result="Все заявки к акту были отправлены"
	e  d
	. s ActCheckStatus="approve"
	
	if $$$TunesVariableGlobal("AllowReportApprovement") 
	{
		//зелёной птичке "провести документ" разрешено проводить документы
		if ActCheckStatus="fail"
		{
			d ##class(Docs.Act).SetActStatFailed(doc)
			s result=result + " Программа проверки нашла ошибоки в акте, но статус документа остался ""создан"""
		}
		else
		{
			s result = ##class(Docs.Act).SetActStatAccepted(doc)
			//s result=result + " Программа проверки нашла ошибки в акте, но статус документа остался ""создан"""

			if result
			{
				//s GarantObj=##class(Common.Dictionary2).%OpenId(doc.garant)
				s GarantObj.Act=doc
				s result=##class(Common.Common).SetGarantDisabled(doc.garant,0,"Акт "_doc.Name_" от "_$ZD(doc.Date,4))
			}
		}	
	}
	else
	{
		//зелёной птичке "провести документ" не разрешено проводить документы
		if ActCheckStatus="fail" s result="Документ содержит ошибки и должен быть переведён в статус Не принят. "_result
		else  s result="Документ успешно прошёл проверку и может быть принят."
	}
	q result
]]></Implementation>
</Method>

<Method name="processbrakremont">
<Description>
Обработка документа "Отправка брака в мастерскую"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s ok=1
 TSTART
 f i=1:1:doc.Items.Count() q:'+ok  d
 . s item=doc.Items.GetAt(i)
 . i item.Quantity>item.Brak.Qnt s ok="Списание невозможно, т.к. для товара "_item.Goods.FullName_" указано количество "_item.Quantity_" а в ячейке лишь "_item.Brak.Qnt q
 . i item.Brak.Qnt=item.Quantity d
 . . d ##class(Store.Brak).%DeleteId(item.Brak.%Id())
 . . s item.Brak=""
 . e  s item.Brak.Qnt=item.Brak.Qnt-item.Quantity
 i '+ok TROLLBACK
 e  TCOMMIT
 q ok
]]></Implementation>
</Method>

<Method name="processutiliz">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s ok=1
 
 if $ISOBJECT(doc.Kontr) s KontragentId = doc.Kontr.%Id()
 e  s KontragentId = ""
 
 
 TSTART
 f i=1:1:doc.Items.Count() q:'+ok  d
 . s item=doc.Items.GetAt(i)
 . d:item.goodsdir=2 //оприходование товара
 . . s:item.addr'="" ok=##class(Store.Action).savequant(item.Goods,item.addr,item.Quantity)
 . . d:item.Client'="" ..addTovarOnKontr(item.Client,item.Goods,item.Quantity)
 . d:item.goodsdir=1 //списание товара
 . . i item.SourceTbl=2 d
 . . . //Списываем из брака
 . . . if '$ISOBJECT(item.Brak) d
 . . . . s GoodsID=item.Goods.%Id(),AddressID=item.addr.%Id()
 . . . . &sql(select ID into :BrakID from Store.Brak where Goods=:GoodsID and Address=:AddressID AND ((Kontr=:KontragentId) OR (:KontragentId='') OR (:KontragentId IS NULL)))
 . . . . if SQLCODE s ok="Списание невозможно, т.к. для некондиционного товара "_item.Goods.FullName_" установлено списание из ячейки "_##class(Store.Action).AddressPath(item.addr)_" но в ней нет этого некондиционного товара. (SQLCODE "_SQLCODE_")" q
 . . . . s item.Brak=##class(Store.Brak).%OpenId(BrakID)
 . . . q:'+ok
 . . . i item.Quantity>item.Brak.Qnt s ok="Списание невозможно, т.к. для товара "_item.Goods.FullName_" указано количество "_item.Quantity_" а в ячейке лишь "_item.Brak.Qnt q
 . . . i item.Brak.Qnt=item.Quantity d
 . . . . d ##class(Store.Brak).%DeleteId(item.Brak.%Id())
 . . . . s item.Brak=""
 . . . e  s item.Brak.Qnt=item.Brak.Qnt-item.Quantity
 . . e  d
 . . . ;списываем из общего количества, если указан адрес то списываем остаток с адреса
 . . . ;s:item.addr'="" ok=##class(Store.Action).remquant(item.Goods,item.addr,item.Quantity)
 . . . s:item.addr'="" ok=##class(Store.Action).RemoveQuantity(item.Goods,item.addr,item.Quantity)
 . . . d:item.Client'="" ..remTovarOnKontr(item.Client,item.Goods,item.Quantity)
 . . d ##class(Store.GarantAction).SetGarantNotActual(item.garant)
 i '+ok TROLLBACK
 e  TCOMMIT
 q ok
]]></Implementation>
</Method>

<Method name="processinvent">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s AddressId=$S($ISOBJECT(doc.Address):doc.Address.%Id(),1:"")
 s ok=##class(Store.Action).BlockCells(AddressId,1)
 i '+ok q ok
 f i=1:1:doc.Items.Count() q:'+ok  d
 . s item=doc.Items.GetAt(i)
 . s ok=##class(Store.Action).savequant(item.Goods,item.addr,item.Quantity,1)  //последний параметр укажет что предыдущее значение ячеек не учитывать
 q ok
]]></Implementation>
</Method>

<Method name="processinner">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s ok=1
 f i=1:1:doc.Items.Count() q:'+ok  d
 . s item=doc.Items.GetAt(i)
 . ;s ok=##class(Store.Action).remquant(item.Goods,item.addr2,item.Quantity)
 . s ok=##class(Store.Action).RemoveQuantity(item.Goods,item.addr2,item.Quantity)
 . q:'+ok
 . s ok=##class(Store.Action).savequant(item.Goods,item.addr,item.Quantity)
 . q:'+ok
 q ok
]]></Implementation>
</Method>

<Method name="print">
<ClassMethod>1</ClassMethod>
<FormalSpec>doc=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="printErr"
 s docclass=$P(doc,"@",2)
 i docclass="" $$$WriteError("Пустой класс документа "_doc) q
 s page=$G(^docpages(docclass))
 i page="" $$$WriteError("Нет страницы для класса "_docclass) q
 
 s xmlstr=##class(%XML.Writer).%New() s xmlstr.Charset="windows-1251" d xmlstr.OutputToDevice() 
 s sc=xmlstr.Write("<?xml-stylesheet type='text/xsl' href='xsl/"_page_"'?>")
 s sc=xmlstr.RootElement("root")
	
 $$$EndXML
 q
printErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="tovsforotchet">
<Description>
Товары для отчёта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr,q1,q2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="tovsforotchetErr"
 s glob=$NA(^t(kontr))
 $$$StartXML
  s sc=xmlstr.Element("AllObjects")
  	s i="" f  s i=$O(@glob@(i)) q:i=""  d
  	. s sc=xmlstr.Element("OneObject")
	. s sc=xmlstr.Element("Goods")
 	. s sc=xmlstr.WriteAttribute("id",i)
 	. s tov=##class(Goods.Goods).%OpenId(i)
 	. i $ISOBJECT(tov) s name=tov.Name
 	. e  s name="товар с кодом "_i
 	. $$$WriteElement("text",name)
 	. s sc=xmlstr.EndElement()
	. s sc=xmlstr.Element("Quantity")
	. s sc=xmlstr.WriteAttribute("id",i)
	. $$$WriteElement("text",$G(@glob@(i)))
	. s sc=xmlstr.EndElement()
	. $$$WriteElementTwice("Price",tov.Price)
  	. s sc=xmlstr.EndElement()
  s sc=xmlstr.EndElement()
 $$$EndXML
 q
tovsforotchetErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="getRashNumb">
<Description>
Получить новый уникальный номер документа</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocType:%String="Docs.Rash"</FormalSpec>
<Implementation><![CDATA[
 s $ZT="getRashNumbErr"
 s year=$P($ZD(+$H,4),"/",3)
 i DocType="Docs.Rash" d
 . s numb=+$G(^RashNumbers(year))+1
 . s ^RashNumbers(year)=numb
 e  d
 . s numb=+$G(^RashNumbers(DocType,year))+1
 . s ^RashNumbers(DocType,year)=numb
 s newNumber=numb_"-"_year
 if DocType="Docs.Sluzap" s newNumber="C"_newNumber
 q newNumber
getRashNumbErr
 $$$WriteError($ZE)
 q "----"
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
/*
 похоже что метод не используется, чуть позже надо грохнуть
ClassMethod LoadFreeDocs(dat1, dat2, depot)
{
  s $ZT="LoadFreeDocsErr"
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare("select ID,Dat,Tim,DocumentClass->Name as doc,Name from Docs.Super where Dat>="_dat1_" and Dat<="_dat2_" and (DocumentClass='Docs.Prih' or DocumentClass='Docs.Rash' or DocumentClass='Docs.Inner')")
 i '+ok $$$WriteObjError(ok) q
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q
 
 $$$StartXML
 	s sc=xmlstr.Element("AllHeaders")
		 $$$WriteHeader("number","№",30)
		 $$$WriteHeader("doc","Документ",140)
		 $$$WriteHeader("dat","Дата",90)
		 $$$WriteHeader("name","Номер",90)
	s sc=xmlstr.EndElement()
	s sc=xmlstr.Element("AllObjects")
  While rs.Next() {
	    i $I(i)
		s sc=xmlstr.Element("OneObject")
		s sc=xmlstr.WriteAttribute("id",rs.Data("ID"))

		 $$$WriteElementTwice("number",i)
		 $$$WriteElementTwice("doc",rs.Data("doc"))
		 s Dat=$ZD(rs.Data("Dat"),4)
		 $$$WriteElementTwice("name",rs.Data("Name"))
		 $$$WriteElementTwice("dat",Dat)
		s sc=xmlstr.EndElement()
  }	
	s sc=xmlstr.EndElement()
 $$$EndXML
LoadFreeDocsErr
 $$$WriteError($ZE)
 q
}
*/
]]></Content>
</UDLText>

<Method name="DocFromInstr">
<Description><![CDATA[
Создать документы на основании инструкции руководителя
<br><var>id</var> - ID инструкции руководителя]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id,currentJob</FormalSpec>
<Implementation><![CDATA[
 s $ZT="DocFromInstrErr"
 
 s ^mtempArt("docfrominstr",3,"InstrId")=id
 s ^mtempArt("docfrominstr",3,"currentJob")=$G(currentJob)
 
 
 s err="Извините, внутренняя ошибка при создании документа"
 s ok=..ChildDocs(id,.Array)
 i $D(Array)>1 d  q "На основе этой инструкции уже созданы документы: "_$C(10)_$C(13)_Names
 . s i="" f  s i=$O(Array(i)) q:i=""  s Names=$G(Names)_Array(i,"DocumentClassName")_" № "_Array(i,"Name")_" от "_Array(i,"Dat")_$C(10)_$C(13)
 TSTART
 s instr=##class(Operation.Instructions).%OpenId(id)
 i '$ISOBJECT(instr) $$$WriteError("DocFromInstr не открылся id='"_id_"' класс Operation.Instructions") q err
 i instr.State=1 q "Инструкция ещё не утверждена"
 q:'$ISOBJECT(instr.Depot1) "В инструкции не указан склад, дочерние документы не могут быть созданы."
 i '$ISOBJECT(instr.Oper) s classes=""
 e  s classes=instr.Oper.cl,InstructionType=instr.Oper.%Id()  //классы документов которые необходимо создать на основании данной инструкции
 i classes="" $$$WriteError("DocFromInstr для инструкции "_id_" был предложен пустой класс для документа") q err
 s ok=1,err=1
 f clnum=1:1:$L(classes,",") q:('+ok)!('+err)  d
 . s class=$P(classes,",",clnum)
 . s doc=$ZOBJCLASSMETHOD(class,"%New")
 . s doc.Name=instr.Name
 . i class="Docs.Rash" d  //расходная накладная
 . . s doc.Name=..getRashNumb()
 . . s:$ISOBJECT(instr.RashOplatType) doc.opl=instr.RashOplatType
 . s doc.Depot=instr.Depot1.%Id()
 . s doc.Kontr=instr.Kontr
 . d doc.SourceSetObjectId(id)
 . s ok=1
 . s tot=0
 . f i=1:1:instr.Items.Count() q:'+ok  d
 . . s item=instr.Items.GetAt(i)
 . . s docitem=$ZOBJCLASSMETHOD(class_"Items","%New")
 . . s docitem.Goods=item.Goods
 . . s ItemPrice=item.Price
 . . s ItemQuantity=item.Quantity
 . . s docitem.Price=ItemPrice
 . . s docitem.Total=item.Total
 . . i class="Docs.Rash" d
 . . . s docitem.serial=item.sn
 . . . s docitem.comment=item.BrakComment
 . . . s docitem.Zakaz=item.Quantity
 . . . s docitem.Quantity=item.Quantity
 . . . s ItemTotal=$J(ItemPrice*ItemQuantity,".",2)
 . . . s:InstructionType=10 docitem.Total=ItemTotal  //считаем сумму строки в расходной, если делаем от заявки на поставку запчастей
 . . e  s docitem.Quantity=ItemQuantity
 . . s tot=tot+docitem.Total
 . . d docitem.DocTypeSetObjectId(class)
 . . d:class="Docs.Invent"  //для инвентаризации
 . . . s docitem.quantplan=item.quantplan
 . . . s docitem.addr=item.addr
 . . d:class="Docs.Utiliz"  //для утилизации
 . . . s docitem.Client=item.Client
 . . . s docitem.addr=item.addr
 . . . s docitem.goodsdir=item.goodsdir
 . . . s docitem.spravka=item.spravka
 . . . s docitem.garant=item.garant
 . . . s docitem.sn=item.sn
 . . d:class="Docs.Remont"  //для заявки на ремонт
 . . . s docitem.seller=item.seller
 . . . s docitem.garant=item.garant
 . . . s docitem.serial=item.sn
 . . . s docitem.Name=item.opispolomki
 . . d:class="Docs.DocBrak"  //для приёма брака
 . . . s docitem.PlanQuant=item.Quantity
 . . s ok=doc.Items.Insert(docitem)
 . . i '+ok $$$WriteObjError(ok) q
 . q:'+ok
 . s doc.Summa=tot
 . s err=..script(class,doc,$G(currentJob))
 . q:class="Docs.Remont"&'+err
 . s ok=doc.%Save()
 . q:'+ok
 q:'+err err
 i '+ok $$$WriteObjError(ok) q err
 s ok=..script(class,doc)
 
 TCOMMIT
 i '+ok TROLLBACK  q ok
 
 //i '+ok q ok
 q doc.%Id()
DocFromInstrErr
 $$$WriteError($ZE)
 q "Извините, при создании документа произошла ошибка"
]]></Implementation>
</Method>

<Method name="GetPageFromInstr">
<ClassMethod>1</ClassMethod>
<FormalSpec>inid,what="cspfile"</FormalSpec>
<Implementation><![CDATA[
 s in=##class(Operation.Instructions).%OpenId(inid)
 q:'$ISOBJECT(in) ""
 q:'$ISOBJECT(in.Oper) ""
 q $ZOBJPROPERTY(in.Oper,what)
]]></Implementation>
</Method>

<Method name="GetPageFromOper">
<ClassMethod>1</ClassMethod>
<FormalSpec>oper,what="cspfile"</FormalSpec>
<Implementation><![CDATA[
 s in=##class(Operation.OperTemplate).%OpenId(oper)
 q:'$ISOBJECT(in) ""
 q $ZOBJPROPERTY(in,what)
]]></Implementation>
</Method>

<Method name="MarkGarant">
<Description>
Всем гарантийным талонам этого документа проставить что они использованы здесь 
метод не используется</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>docobj</FormalSpec>
<Implementation><![CDATA[
 s $ZT="MarkGarantErr"
 s err="Извините, ошибка при записи информации о гарантийном талоне"
 s ok=1
 i '$ISOBJECT(docobj) s docobjID=docobj,docobj=##class(Docs.Remont).%OpenId(docobj)
 e  s docobjID=docobj.%Id()
 i '$ISOBJECT(docobj) $$$WriteError("MarkGarant не открылся объект ("_docobjID_") класса Docs.Remont") q err
 
 //цикл по строкам документа, пишем все гарантийные в массив
 Set key = ""
 Do {
  Set itemobj = docobj.Items.GetNext(.key)
  If $ISOBJECT(itemobj) {
     s garant=itemobj.garant
     s garants(garant)=1
  }
 } While (key '= "")
 
 //пошли по массиву гарантийных, пытаемся открыть каждый
 s garant="" f  s garant=$O(garants(garant)) q:(garant="")||('+ok)  d
 . s garantobj=##class(Common.Dictionary2).%OpenId(garant)
 . i $ISOBJECT(garantobj)  //гарантийный талон есть в базе
 .. i garantobj.Property9194=2 s ok="Гарантийный талон №"_garantobj.Name_" недействителен" q
 .. //вставить проверку дат
 .. q:'+ok
 .. //чейта???
 .. //i remont'="fukk" d
 .. //. d $ZOBJMETHOD(garantobj,remont,docobj.%Id())
 .. //s:remont="remont3SetObjectId" garantobj.Property9194=2 //Ставя третий ремонт одновременно ставим что талон недействителен
 .e  d   //гарантийного талона нет (или ошибка)
 .. s garantobj=##class(Common.Dictionary2).%New()
 .. s garantobj.Name=garant
 .. d garantobj.remont1SetObjectId(docobj.%Id())
 . q:'+ok
 . s ok=garantobj.%Save()
 . i '+ok $$$WriteObjError(ok)
 q:'+ok ok
 i '+ok $$$WriteObjError($ZE) q err
 q 1
MarkGarantErr
 $$$WriteError($ZE)
 q "Извините, ошибка при записи информации о гарантийном талоне"
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//метод сохраняющий xml поток в глобальку

]]></Content>
</UDLText>

<Method name="checkgarant">
<Description>
Проверить гарантийный талон</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass</FormalSpec>
<Implementation><![CDATA[
 s user=$G(%session.Data("user"),"undefined")
 s ok=..parsexml(xmlstream,docid,documentclass,.types,.DocData)
 k ^mtempCurrentRemDoc(user)
 m ^mtempCurrentRemDoc(user)=@DocData
 q 1
]]></Implementation>
</Method>

<Method name="makealotgarants">
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass</FormalSpec>
<Implementation><![CDATA[
 s ok=..parsexml(xmlstream,docid,documentclass,.types,.DocData)
 q:'+ok ok
 s ok=..makealotgarants2(documentclass, DocData, .types)
 
 q ok
]]></Implementation>
</Method>

<Method name="makealotgarants2">
<Description>
создать несколько гарантийных талонов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>documentclass,DocData,types</FormalSpec>
<Implementation><![CDATA[
 s $ZT="makealotgarantsErr"
 s kontr=$G(@DocData@("head","Property5330"))
 s dat=$G(@DocData@("head","Property8550"))
 s Property9194=$G(@DocData@("head","Property9194"))
 s tovar=$G(@DocData@("head","tovar"))
 s kol=$G(@DocData@("head","koli4est"))
 s serial=$G(@DocData@("head","serial"))
 s startnumb=+$G(@DocData@("head","startnumb"))
 s prefix=$G(@DocData@("head","prefix"))
 s leng=$G(@DocData@("head","leng"))
 s comment=$G(@DocData@("head","comment"))
 s SerialAsGarant=$G(@DocData@("head","SerialAsGarant"))
 s glob=$NA(^Common.Dictionary2I("serialInd"))	//индексный глобал содержащий серийные номера

 

 s ok=1
 TSTART
 f i=startnumb:1:(kol-1+startnumb) q:'+ok  d
 . i $I(CountAll)	//подсчёт всего
 . s Name=prefix_$TR($J(i,leng)," ",0)	//будущий гарантийный номер
 . if SerialAsGarant s SearchString = " "_$ZCVT(Name,"U")	//серийный номер, как он лежит в индексной глобали
 . else  s SearchString = " "_$ZCVT(serial,"U")
 . if $D(@glob@(SearchString)) d  q		//пропускаем создание записи, если такой серийный номер уже есть в базе
 . . i $I(CountSkipped)	//подсчёт пропущенных с неуникальным серийным
 . . s SkippedList=$G(SkippedList)_SearchString	//собираем в строчку пропущенные номера
 . s garobj=##class(Common.Dictionary2).%New()
 . d:kontr'="" garobj.Property5330SetObjectId(kontr)
 . s:dat'="" garobj.Property8550=$ZDH(dat,4)
 . s:Property9194'="" garobj.Property9194=Property9194
 . s:tovar'="" garobj.tovar=tovar
 . s:comment'="" garobj.Comment=comment
 . s garobj.Name=Name
 . if SerialAsGarant s garobj.serial=garobj.Name
 . else  s garobj.serial=serial
 . s ok=garobj.%Save()
 . if ok i $I(CountSuccess)
 
 i '+ok d  q ok
 . TROLLBACK 1
 . $$$WriteObjError(ok) 
 . s ok="Извините, внутренняя ошибка при генерации списка гарантийных талонов."
 TCOMMIT
 
 s result = "Процесс создания серийных номеров успешно завершён."_$C(13,10)_
 	"Всего попыток создать: "_+$G(CountAll)_$C(13,10)_
 	"  из них успешно созданы: "_+$G(CountSuccess)_$C(13,10)_
 	"  пропущены неуникальные серийные номера: "_+$G(CountSkipped)
 
 q result
makealotgarantsErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при создании списка гарантийных номеров"
]]></Implementation>
</Method>

<Method name="deletedoc">
<ClassMethod>1</ClassMethod>
<FormalSpec>class="",docid="",p1</FormalSpec>
<Implementation><![CDATA[
 s ok=1
 s $ZT="deletedocErr"
 s err="Извините, ошибка при удалении документа"
 q:class="" err
 q:docid="" err
 s doc=$ZOBJCLASSMETHOD(class,"%OpenId",docid)
 d:$ISOBJECT(doc)  //если удалось открыть объект то удалим его строки
 . //получим ссылку на свойство документа содержащее строки
 . i class="Docs.Platejka" s DocItemsProperty=$ZOBJPROPERTY(doc,"PlatejkaItems")	//строки платёжной накладной содержатся в свойстве PlatejkaItems
 . e  s DocItemsProperty=$ZOBJPROPERTY(doc,"Items")
 . s i="" f  s i=$ZOBJMETHOD(DocItemsProperty,"Next",i) q:i=""  d
 . . s item=$ZOBJMETHOD(DocItemsProperty,"GetAt",i)
 . . s ok=$ZOBJMETHOD(item,"%DeleteId",item.%Id())
 . . i '+ok $$$WriteObjError(ok) q
 . . d $ZOBJMETHOD(DocItemsProperty,"RemoveAt",i)
 . . k item  //убиваем сам объект в памяти
 i '+ok q err
 s ok=$ZOBJCLASSMETHOD(class,"%DeleteId",docid)
 i '+ok $$$WriteObjError(ok) q err
 q 1
deletedocErr
 b	;err
 $$$WriteError($ZE)
 q "Извините, ошибка при удалении документа"
]]></Implementation>
</Method>

<Method name="GetSummByPrice">
<Description>
показать сумму документа по строкам
class - класс документа
id - id документа
massiv - массив передаваемый по ссылке куда будет ссыпана информация по брендам</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[class="",id,&massiv]]></FormalSpec>
<Implementation><![CDATA[
 k massiv
 s $ZT="GetSummByPriceErr"
 s rs=##class(%ResultSet).%New()
 // если класс не указали то и не смотрим на него
 i class'="" s class=" and DocType='"_class_"'"
 s sql="select id,Quantity,Goods,Goods->abbr as Goodsabbr from Docs.DocItems where doc='"_id_"'"_class
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 While rs.Next() {
	 s Goodsabbr=$G(rs.Data("Goodsabbr"))
	 s Quantity=$G(rs.Data("Quantity"))
	 s Goods=$G(rs.Data("Goods"))
	 s Price=##class(Goods.GoodsAction).getprice(Goods)
	 s id=$G(rs.Data("id"))
	 s massiv=$G(massiv)+(+Price*+Quantity)
	 i Goodsabbr="" s Goodsabbr="-"
	 s massiv("code",Goodsabbr)=$G(massiv("code",Goodsabbr))+(+Price*+Quantity)
	 //s massiv("goods",Goods)=$G(massiv("code",Goods))+Price*Quantity
 } 
 q 1
GetSummByPriceErr
 $$$WriteError($ZE)
 q "Извините, ошибка при подсчёте суммы"
]]></Implementation>
</Method>

<Method name="CloneDoc">
<Description><![CDATA[
Создать копию документа
<br><var>doc</var> - документ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CloneDocErr"
 s err="Ошибка при создании копии документа. Копия не создана."
 i '$ISOBJECT(doc) s doc=##class(Operation.Instructions).%OpenId(doc)
 i '$ISOBJECT(doc) $$$WriteError("CloneDoc не опознан как объект "_doc) q err
 TSTART
 s newObj=doc.%ConstructClone()  	//делаем клона передаваемого объекта
 s newObj.Name=doc.Name_" копия" 	//переименовываем новый объект
 s newObj.Stat=1
 s newObj.Dat=+$H
 s newObj.Tim=$P($H,",",2)
 d newObj.User1SetObjectId($S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:""))
 s newObj.CloseDate=""
 s newObj.CloseTime=""
 s newObj.CloseUser=""

 if $ISOBJECT(newObj.DocumentClass),newObj.DocumentClass.%Id()="Operation.Instructions" d
 . s newObj.State=1
 . s newObj.InstDate=+$H
 . s newObj.innerinstr=""
 . s newObj.HasBeenSent=""
 . d newObj.ChangesChain.Clear()
 s ok=newObj.%Save()
 i '+ok $$$WriteObjError(ok) q err
 TCOMMIT
 q 1
CloneDocErr
 f i=1:1:$TLEVEL TROLLBACK
 $$$WriteError($ZE)
 q "Ошибка при создании копии документа. Копия не создана."
]]></Implementation>
</Method>

<Method name="EmailFromDoc">
<Description><![CDATA[
Извлечь e-mail адрес контрагента из документа
<br><var>DocID</var> - ID или объект документа
<br><var>Class</var> - Класс (по умолчанию Docs.Super)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocID,Class="Docs.Super"</FormalSpec>
<Implementation><![CDATA[
	s Splitter="#@#"
	i '$ISOBJECT(DocID) d
	. s DocID=$ZOBJCLASSMETHOD(Class,"%OpenId",DocID)
	
	i $ISOBJECT(DocID) d
	. d:$ISOBJECT(DocID.Kontr)
	. . s EmailAddress=DocID.Kontr.EMail
	. . s KontrName=DocID.Kontr.Name
	. s DocTypeName=$S($ISOBJECT(DocID.DocumentClass):DocID.DocumentClass.Name,1:"")
	. s DocName=DocID.Name
	
	q $G(EmailAddress)_Splitter_$G(KontrName)_Splitter_$G(DocTypeName)_Splitter_$G(DocName)
]]></Implementation>
</Method>

<Method name="DeleteDoc2">
<Description><![CDATA[
Удаление документа
<br><var>Doc</var> - ID или объект документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Doc=""</FormalSpec>
<Implementation><![CDATA[
 q:Doc="" "Не указан документ для удаления"
 i '$ISOBJECT(Doc) s Doc=##class(Docs.Super).%OpenId(Doc)
 q Doc.Delete()
]]></Implementation>
</Method>

<Method name="CreateStorageOutOnRash">
<Description><![CDATA[
Создать внутреннюю инструкцию по отгрузке на основании расходной накладной
<br><var>doc</doc> - расходная накладная (id или объект)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 i '$isobject(doc) s doc=##class(Docs.Rash).%OpenId(doc)
 i '$ISOBJECT(doc) $$$WriteError("CreateStorageOutOnRash не удалось открыть документ "_doc) q "Извините, при формировании внутренней инструкции произошла ошибка. Невозможно получить информацию о документе."
 s StoreDoc=##class(Docs.StorageOut).%New()
 s ok=..CopyDoc(doc,StoreDoc)
 i '+ok q ok
 s StoreDoc.Name=doc.Name_"-о"
 s ok=StoreDoc.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, произошла ошибка при создании внутренней инструкции."
 q StoreDoc.%Id()
]]></Implementation>
</Method>

<Method name="CopyDoc">
<Description><![CDATA[
Заполнить новый документ данными документа-источника
<br><var>SourceDoc</var> - Документ источник (ID или объект)
<br><var>NewDoc</var> - Новый документ (ID или объект)
<br><var>SourceDocAsParent</var> - пометить документ-источник в качестве источника в новом документе
<br><var>KillNewDocItems</var> - Не сохранять строки нового документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SourceDoc="",NewDoc="",SourceDocAsParent=1,KillNewDocItems=1</FormalSpec>
<Implementation><![CDATA[
 
 s $ZT="CopyDocErr",ok=1,err="Ошибка при создании внутренней инструкции от расходной накладной."
 i '$ISOBJECT(SourceDoc) s SourceDoc=##class(Docs.Super).%OpenId(SourceDoc)
 i '$ISOBJECT(NewDoc) s NewDoc=##class(Docs.Super).%OpenId(NewDoc)
 i '$ISOBJECT(SourceDoc) $$$WriteError("Не удалось открыть документ "_SourceDoc) q err
 i '$ISOBJECT(NewDoc) $$$WriteError("Не удалось открыть документ "_NewDoc) q err
 i (SourceDoc.%ClassName(1)'="Docs.Rash")&(SourceDoc.%ClassName(1)'="Docs.Prih")&(SourceDoc.%ClassName(1)'="Docs.DocBrak") q "Обрабатываются только Приходные и расходные. Все иные движения товара необходимо оформлять в разделе ДОКУМЕНТЫ."
 s NewDoc.Kontr=SourceDoc.Kontr
 s NewDoc.Summa=SourceDoc.Summa
 s NewDoc.Name=SourceDoc.Name
 s:SourceDocAsParent NewDoc.Source=SourceDoc
 s NewDoc.Depot=SourceDoc.Depot
 s NewDoc.Comment=SourceDoc.Comment
 if SourceDoc.%ClassName(1)="Docs.DocBrak" s NewDoc.PrihodType=1
 
 i KillNewDocItems s ok=NewDoc.Items.Clear()
 i 'ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при клонировании документа."
 s i="" f  s i=SourceDoc.Items.Next(i) q:(i="")!('+ok)  d
 . s SourceItem=SourceDoc.Items.GetAt(i)
 . s NewItem=$ZOBJCLASSMETHOD(NewDoc.%ClassName(1)_"Items","%New")
 . s NewItem.Goods=SourceItem.Goods
 . d NewItem.DocTypeSetObjectId(NewDoc.%ClassName(1))
 . if NewDoc.%ClassName(1)="Docs.StorageOut" d ..SetDataForInnerStorageOutItems(SourceItem,.NewItem,NewDoc)
 . if NewDoc.%ClassName(1)="Docs.StorageIn" d ..SetDataForInnerStorageInItems(SourceItem,.NewItem,NewDoc)
 . s:$ISOBJECT(NewItem) ok=NewDoc.Items.SetAt(NewItem,i)
 . i '+ok $$$WriteObjError(ok) 
 d ..SetDataForInnerStorageDocs(SourceDoc,NewDoc)
 q ok
CopyDocErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при клонировании документа."
]]></Implementation>
</Method>

<Method name="ChangeGoodsInDoc">
<Description><![CDATA[
Замена товаров в строках документа
<br><var>Zamena</var> - Строка с указанием что где заменить IdСтрокиДокумента=IdНовогоТовара;IdСтрокиДокумента=IdНовогоТовара;...]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Zamena</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ChangeGoodsInDocErr",ok=1
 TSTART
 s CurrentUserId=$G(%session.Data("user"))
 f i=1:1:$L(Zamena,";") q:'+ok  d
 . s CurrentZamena=$P(Zamena,";",i)
 . q:CurrentZamena=""
 . s StringId=$P(CurrentZamena,"=",1)
 . s NewGood=$P(CurrentZamena,"=",2)
 . s DocStringObj=##class(Docs.RashItems).%OpenId(StringId)
 . s DocStringObj.ZakazGoods=DocStringObj.Goods
 . s DocStringObj.ZakazDat=+$H
 . s DocStringObj.ZakazTim=$P($H,",",2)
 . d:CurrentUserId'="" DocStringObj.ZakazUser1SetObjectId(CurrentUserId)
 . d DocStringObj.GoodsSetObjectId(NewGood)
 . s ok=DocStringObj.%Save()
 i '+ok d  q "Извините. Ошибка при замене строк документа."
 . TROLLBACK
 . $$$WriteObjError(ok)
 TCOMMIT
 q 1
ChangeGoodsInDocErr
 TROLLBACK
 $$$WriteError($ZE)
 q "Извините. Ошибка при замене строк документа."
]]></Implementation>
</Method>

<Method name="ChildDocs">
<Description><![CDATA[
Получить потомков данного документа
<br><var>doc</var> - документ родитель (ID или объект)
<br><var>Array</var> - возвращаемый массив с данными]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[doc="",&Array]]></FormalSpec>
<Implementation><![CDATA[
 i $ISOBJECT(doc) s docid=doc.%Id()
 e  s docid=doc
 i '+docid q ""
 &sql(declare gods cursor for 
 select ID,Name,DocumentClass->Name,Dat
 into :ID,:Name,:DocumentClassName,:Dat
 from Docs.Super where Source=:docid)
 &sql(open gods)
 f  &sql(fetch gods) q:SQLCODE  d
 . s Array(ID,"Name")=Name
 . s Array(ID,"DocumentClassName")=DocumentClassName
 . s Array(ID,"Dat")=$ZD(Dat,4)
 &sql(close gods)
 q 1
]]></Implementation>
</Method>

<Method name="CreateChildDoc">
<Description><![CDATA[
Создать внутреннюю инструкцию на основании документа
<br><var>DocId</var> - ID документа
<br><var>ClassName</var> - Класс документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,ClassName</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CreateChildDocErr"
 s NewDocClass=..GetClassFromSource(DocId_"@"_ClassName)
 i NewDocClass="" q "Извините. Не удалось определить тип дочернего документа." 
 i NewDocClass="Docs.StorageOut" q ##class(Docs.Action2).MakeStoreOut(DocId)
 s NewDocObj=$ZOBJCLASSMETHOD(NewDocClass,"%New")
 i '$ISOBJECT(NewDocObj) q "Ошибка при формировании дочернего документа. Невозможно сформировать документ "_NewDocClass
 s ok=..CopyDoc(DocId,NewDocObj)
 q:'+ok ok
 s ok=NewDocObj.%Save()
 i '+ok $$$WriteObjError(ok) q "Ошибка при создании дочернего документа."
 q ok
CreateChildDocErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при формировании дочернего документа."
]]></Implementation>
</Method>

<Method name="SetDataForInnerStorageOutItems">
<Description><![CDATA[
Установить данные для строк внутренних инструкций образованных от документа-родителя
<br><var>SourceItem</var> - Строка документа родителя
<br><var>NewItem</var> - Строка документа - внутренней инструкции
<br><var>NewDoc</var> - документ - внутренняя инструкция]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[SourceItem,&NewItem,NewDoc]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 s NewItem.quantdefault=SourceItem.Quantity
 s NewItem.Price=SourceItem.Price
 //общее количество товара на складе (предприятии)
 s Quantity=##class(Goods.GoodsAction).getgoodquant(SourceItem.Goods.%Id(),"",.addr)  //найдем ячейки где лежит товар с нужным количеством
 i $G(addr("value"))<SourceItem.Quantity d  q
 . //общее кол. товара меньше чем требуется, надо что то делать
 . s ok=..InsertReplaceMent(NewDoc,SourceItem)
 . s NewItem=""
 //если Количество в найденной ячейке больше или равно нужному
 i Quantity>=SourceItem.Quantity d
 . d NewItem.addrSetObjectId(addr)
 . s NewItem.Total=SourceItem.Total
 e  d
 . //иначе, т.е. общее кол. в ячейках не меньше чем надо, но надо набирать из ячеек
 . d ..AddDocStr(.NewDoc,SourceItem,.addr)
 . //текущую строку сбросим, ибо сделаем новых кучу
 . s NewItem=""
 q
]]></Implementation>
</Method>

<Method name="SetDataForInnerStorageDocs">
<Description><![CDATA[
Установить данные для строк внутренних инструкций образованных от документа-родителя
<br><var>Source</var> - Документа родителя
<br><var>New</var> - Документа - внутренней инструкции]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Source,New</FormalSpec>
<Implementation><![CDATA[
 s New.Name=New.Name_$S(New.%ClassName(1)="Docs.StorageOut":"-о",New.%ClassName(1)="Docs.StorageIn":"-р")
 q
]]></Implementation>
</Method>

<Method name="AddDocStr">
<Description><![CDATA[
Добавить нужное количество строк в документ на основании странного массива addr (описание см. в Goods.GoodsAction.getgoodquant())
<br><var>NewDoc</var> - документ в который добавлять новые строки
<br><var>DataArray</var> - массив источник информации - какой товар, сколько надо, какая у него цена
<br><var>addr</var> - массив с ячейками содержащими требуемый товар (структуру см. Goods.GoodsAction.getgoodquant())
<br><var>Accumulated</var> - сколько удалось набрать
<br><var>NeedQuantity</var> - сколько нужно набрать]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[NewDoc,DataArray,&addr,&Accumulated,NeedQuantity=""]]></FormalSpec>
<Implementation><![CDATA[
 s Accumulated=0	//количество которое набрали из ячеек
 s:'+NeedQuantity NeedQuantity=DataArray("NeedQuantity")	//количество которое надо набрать из ячеек
 s GoodId=DataArray("GoodId")
 s Price=DataArray("Price")
 s NewDocClassName=NewDoc.%ClassName(1)
 s ItemClass=NewDocClassName_"Items"
 s i="" f  s i=$O(addr("value",i),-1) q:(i="")||(Accumulated>=NeedQuantity)  d
 . s NeedStill=NeedQuantity-Accumulated	//такое количество ещё надо набрать
 . i $G(addr("value",i,"val"))>=NeedStill d
 . . //в текущей ячейке количество товара больше или равно нужному количеству
 . . //значит забираем столько сколько ещё нужно
 . . s CurrentQnt=NeedStill
 . e  d
 . . //в текущей ячейке меньше чем нам ещё надо
 . . //значит забираем всю ячейку
 . . s CurrentQnt=addr("value",i,"val")
 . s CurrentAddressId=addr("value",i,"addr")
 . s StoreQntID=addr("value",i,"StoreQntID")	//ID в таблице Store.Quantity
 . s Accumulated=Accumulated+CurrentQnt	//такое количество уже набрали
 . s NewItem=$ZOBJCLASSMETHOD(ItemClass,"%New")
 . d NewItem.GoodsSetObjectId(GoodId)
 . d NewItem.DocTypeSetObjectId(NewDocClassName)
 . s NewItem.quantdefault=CurrentQnt
 . s NewItem.Price=Price
 . d NewItem.addrSetObjectId(CurrentAddressId)
 . s NewItem.Total=$J((Price*CurrentQnt),"",2)
 . d NewItem.StoreQntIDSetObjectId(StoreQntID)
 . s ok=NewDoc.Items.Insert(NewItem)
 . i ok do
 . . //переводим товар из свободного количества в резерв
 . . &sql(update Store.Quantity Set Value1=(Value1-:CurrentQnt),Value2=(Value2+:CurrentQnt) where ID=:StoreQntID)
 q
]]></Implementation>
</Method>

<Method name="InsertReplaceMent">
<Description><![CDATA[
Вставить в документ ИНСТРУКЦИЯ ПО ОТГРУЗКЕ аналог товара указанного в строке SourceItem
<br><var>NewDoc</var> - документ в который добавлять новые строки
<br><var>SourceItem</var> - строка источник информации - какой товар, сколько надо, какая у него цена]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[NewDoc,SourceItem,SourceDoc,NeedQuantity="",CreateNewString,&TotalAccumulated]]></FormalSpec>
<Implementation><![CDATA[
 s:NeedQuantity="" NeedQuantity=SourceItem.Quantity	//нужное количество товара
 s TotalAccumulated=0
 s CurrentUserId=$$$SessionData("user")
 s GoodsId=SourceItem.Goods.%Id()	//товар для которого нужна замена
 &sql(declare brokkoli cursor for
 select Property6625,Property6625->Price into :NewGoodsId,:NewGoodsIdPrice
 from Common.Dictionary4 where Name=:GoodsId and 
 	(select sum(Value1) from Store.Quantity where Goods=Property6625)>=1
 )
 &sql(open brokkoli)
 f  &sql(fetch brokkoli) q:(SQLCODE)||(TotalAccumulated>=NeedQuantity)  d
 . s Quantity=##class(Goods.GoodsAction).getgoodquant(NewGoodsId,"",.addr)  //найдем ячейки где лежит товар с нужным количеством
 . s Accumulated=0
 . s DataArray("GoodId")=NewGoodsId
 . s DataArray("Price")=NewGoodsIdPrice
 . s DataArray("NeedQuantity")=NeedQuantity
 . d ..AddDocStr(.NewDoc,.DataArray,.addr,.Accumulated,(NeedQuantity-TotalAccumulated))
 . s TotalAccumulated=TotalAccumulated+Accumulated
 . //фиксируем изменения в строке расходной накладной
 . i 'CreateNewString d
 . . d SetRashItem(SourceItem,CurrentUserId,Accumulated,GoodsId,NewGoodsId)
 . . s CreateNewString=1
 . e  d
 . . s SourceItem2=SourceItem.%ConstructClone()
 . . d SetRashItem(SourceItem2,CurrentUserId,Accumulated,GoodsId,NewGoodsId)
 . . s SourceItem2.JustCreated=1
 . . d SourceDoc.Items.Insert(SourceItem2)
 &sql(close brokkoli)
 q 1
SetRashItem(RashItem,CurrentUserId,Accumulated,GoodsId,NewGoodsId)
 S RashItem.Quantity=Accumulated
 d RashItem.ZakazGoodsSetObjectId(GoodsId)
 d RashItem.GoodsSetObjectId(NewGoodsId)
 s RashItem.ZakazDat=+$H
 s RashItem.ZakazTim=$P($H,",",2)
 d:CurrentUserId'="" RashItem.ZakazUser1SetObjectId(CurrentUserId)
 q
]]></Implementation>
</Method>

<Method name="SetDataForInnerStorageInItems">
<Description>
Установить данные строки для приходных внутренних инструкций</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[SourceItem,&NewItem,NewDoc]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 s GoodsId=SourceItem.Goods.%Id()
 s NewItem.Price=SourceItem.Price
 s NewItem.Quantity=SourceItem.Quantity
 s NewItem.quantdefault=SourceItem.Quantity
 s NewItem.Total=SourceItem.Total
 d NewItem.GoodsSetObjectId(GoodsId)
 i ##class(Goods.GoodsAction).getgoodquant(GoodsId,"",.addr) d  //найдем ячейки где лежит товар с нужным количеством
 . d NewItem.addrSetObjectId(addr)
 q
]]></Implementation>
</Method>

<Method name="zzz">
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s RashObj=##class(Docs.Rash).%OpenId(DocId)
 s StoreObj=##class(Docs.StorageOut).%New()
 s StoreObj.Name=RashObj.Name_"-о"
 s StoreObj.Comment=RashObj.Comment
 s StoreObj.Depot=RashObj.Depot
 s StoreObj.Source=RashObj
 s ok=1
 s i="" f  s i=RashObj.Items.Next(i) q:(i="")!('+ok)  d
 . s SourceItem=RashObj.Items.GetAt(i)
 . q:SourceItem.JustCreated
 . s ItemsQntBefore=StoreObj.Items.Count()
 . s InitialQuantity=SourceItem.Quantity
 . s Price=SourceItem.Price
 . k addr,Accumulated,TotalAccumulated
 . s GoodsId=SourceItem.Goods.%Id()
 . s Quantity=##class(Goods.GoodsAction).getgoodquant(GoodsId,"",.addr)  //найдем ячейки где лежит товар с нужным количеством
 . //если нашли хоть сколько нибудь нужного товара
 . i $G(addr("value")) d
 . . s DataArray("GoodId")=GoodsId
 . . s DataArray("Price")=Price
 . . s DataArray("NeedQuantity")=InitialQuantity
 . . d ..AddDocStr(.StoreObj,.DataArray,.addr, .Accumulated)	//заполняем StoreObj строками с товарами
 . . s SourceItem.Quantity=Accumulated
 . . s CreateNewString=1
 . //будем вставлять замену если набрали меньше чем надо, или количество товара вообще не нашли
 . i (InitialQuantity-$G(Accumulated))||('$G(addr("value"))) d
 . . s ok=..InsertReplaceMent(StoreObj,SourceItem,RashObj,InitialQuantity-$G(Accumulated),+$G(CreateNewString))
 . // если количество строк конечного документа не изменилось, то сами добавим пустую строку
 . i ItemsQntBefore=StoreObj.Items.Count() d
 . . s NewItem=$ZOBJCLASSMETHOD("Docs.StorageOutItems","%New")
 . . d NewItem.GoodsSetObjectId(GoodsId)
 . . d NewItem.DocTypeSetObjectId("Docs.StorageOut")
 . . s NewItem.quantdefault=InitialQuantity
 . . s NewItem.Price=Price
 . . s NewItem.Total=$J((Price*InitialQuantity),"",2)
 . . s ok=StoreObj.Items.Insert(NewItem)
 q:'+ok ok
 s ok=StoreObj.%Save()
 q:'+ok ok
 s ok=RashObj.%Save()
 q:'+ok ok 
 q ok
]]></Implementation>
</Method>

<Method name="processplatej">
<Description><![CDATA[
Обработать платёжное поручение
<br><var>doc</var> - объект документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc:Docs.Platejka</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i '$ISOBJECT(doc.Kontr) q "В платёжном поручении не указан контрагент. Обработка документа невозможна."
 i '$ISOBJECT(doc.Poluh) q "В платёжном поручении не указан получатель платежа. Обработка документа невозможна."
 
 s CommonSumma=0
 s next="" f  s next=doc.PlatejkaItems.Next(next) q:next=""  d
 . s item=doc.PlatejkaItems.GetAt(next)
 . q:'$ISOBJECT(item)
 . s RashObj=item.Rash
 . q:'$ISOBJECT(RashObj)
 . s Summa=item.Summa
 . s CommonSumma=CommonSumma+Summa
 . s RashObj.OplSumma=RashObj.OplSumma+Summa
 . d RashObj.PlatejSetObjectId(doc.%Id())
 . i +RashObj.OplSumma=+RashObj.Summa s RashObj.OplatStatus=2
 . e  s RashObj.OplatStatus=3
 
 //лог
 	s ^mtempArt("processplatej","CommonSumma")=CommonSumma
 	s ^mtempArt("processplatej","doc.Summa")=doc.Summa
 
 //если контрагент не мы и вообще есть расходные
 i 'doc.Kontr.IsWe,doc.PlatejkaItems.Count() 
 {
	 //сумма расходных больше суммы документа 
	 	if CommonSumma>doc.Summa q "Общая сумма оплачиваемых отгрузок ("_CommonSumma_") больше чем сумма документа("_doc.Summa_"). Скорректируйте оплату."
	 //сумма расходных меньше суммы документа 
	 	if CommonSumma<doc.Summa q "Общая сумма оплачиваемых отгрузок ("_CommonSumma_") меньше чем сумма документа ("_doc.Summa_"). Скорректируйте оплату."
 }
 
 s doc.Kontr.Balance=doc.Kontr.Balance+doc.Summa
 
 d ##class(Account.Kontragent).Change(doc.Kontr.%Id(),doc.%Id(),doc.Summa)
 q 1
]]></Implementation>
</Method>

<Method name="GetDataForPlatejka">
<Description><![CDATA[
Установить оплату расходных накладных по данным с веб морды
<br>DocId - ID документа платёжки
<br>res - строка с ID расходных накладных и суммой - сколько надо на неё записать]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,res,p3</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="GetDataForPlatejkaErr"

 //пройдёмся по переданной строке с результатами, сформируем массив
 f i=1:1:($L(res,";")-1) d
 . s RashData=$P(res,";",i)
 . s RashId=$P(RashData,"~",1)
 . s RashSumma=$P(RashData,"~",2)
 . s Array(RashId)=RashSumma
 s PlatejkaObj=##class(Docs.Platejka).%OpenId(DocId)
 
 //пошли по собственным строкам документа
 s doc=##class(Docs.Platejka).%OpenId(DocId)
 s next="" f  s next=doc.PlatejkaItems.Next(next) q:next=""  d
 . s item=doc.PlatejkaItems.GetAt(next)
 . q:'$ISOBJECT(item)
 . s RashObj=item.Rash
 . q:'$ISOBJECT(RashObj)
 . s RashId=RashObj.%Id()
 . q:'$D(Array(RashId))			//выходим если расходная в платёжке. не упомянута в пришедшем списке
 . i Array(RashId)="" d
 . . //если расходная упомянута и значение оплаты = "" то удалим её вообще из анналов платёжки
 . . d doc.PlatejkaItems.RemoveAt(next)
 . . d item.%DeleteId(item.%Id()) 
 . . k Array(RashId)
 
 //на основании переданных данных - id расходной и суммы которую следует на неё записать, создадим строки в платёжке
 s i="" f  s i=$O(Array(i)) q:i=""  d
 . s newitem=##class(Docs.PlatejkaItems).%New()
 . d newitem.RashSetObjectId(i)
 . s newitem.Summa=Array(i)
 . d doc.PlatejkaItems.Insert(newitem)
 
 s ok=doc.%Save()
 i '+ok $$$WriteObjError(ok)

 q ok
GetDataForPlatejkaErr
 $$$WriteError($ZE)
 q "Ошибка записи данных в платёжное поручение."
]]></Implementation>
</Method>

<Method name="ClearPlatejkaItems">
<Description>
Очистить строки платёжки</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId</FormalSpec>
<Implementation><![CDATA[
 &sql(select Stat into :Stat from Docs.Platejka where id=:DocId)
 if Stat=2 q "Платёжное поручение уже обработано. Внести изменения невозможно."
 &sql(delete from Docs.PlatejkaItems where Doc=:DocId)
 i SQLCODE>=0 q 1
 $$$WriteError("SQLCODE="_SQLCODE)
 q "Извините. Ошибка при очистке строк платёжного поручения."
]]></Implementation>
</Method>

<Method name="CreatePlatejForRash">
<Description>
Создать платёжку на основании расходной накладной</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>RashId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CreatePlatejForRashErr"
 s RashObj = ##class(Docs.Rash).%OpenId(RashId)
 i '$ISOBJECT(RashObj) q "Невозможно получить информацию о расходной накладной "_RashId q
 s DefaultPoluh=$$$TunesVariableGlobal("DefaultPoluh")
 s Summa=RashObj.Summa
 s innerkurs=$$$TunesVariableGlobal("innerkurs")
 
 s PlatejObj=##class(Docs.Platejka).%New()
 s PlatejObj.Name=..getRashNumb("Docs.Platejka")
 s PlatejObj.Summa=Summa
 s PlatejObj.RubSumma=$J(Summa*innerkurs,"",2)
 s PlatejObj.Kontr=RashObj.Kontr
 s Item=##class(Docs.PlatejkaItems).%New()
 s Item.Rash=RashObj
 s Item.Summa=Summa
 d PlatejObj.Items.Insert(Item)
 s ok=PlatejObj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при создании платёжного документа."
 q PlatejObj.%Id()
CreatePlatejForRashErr
 $$$WriteError($ZE)
 q "Извините. Внутренняя ошибка при попытке создания платёжного документа."
]]></Implementation>
</Method>

<Method name="SaveListOfObjects">
<Description>
Сохранить список объектов класса documentclass</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>documentclass,DocData</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="SaveListOfObjectsErr"
 s CurrentLogin=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 if documentclass="Goods.Goods",'##class(Common.Rights).getrights(CurrentLogin,9) q "Нет прав для работы с товаром." 
 if documentclass="Common.Kontragent",'##class(Common.Rights).getrights(CurrentLogin,10) q "Нет прав для работы с контрагентами." 
 TSTART
 s ok=1
 s str="" f  s str=$O(@DocData@("body",str)) q:(str="")!('+ok)  d
 . s strID=$G(@DocData@("body",str))
 . i strID s Object=$ZOBJCLASSMETHOD(documentclass,"%OpenId",strID)
 . e  s Object=""
 . i '$ISOBJECT(Object) s Object=$ZOBJCLASSMETHOD(documentclass,"%New")
 . s field="" f  s field=$O(@DocData@("body",str,field)) q:(field="")!('+ok)  d
 . . s type=$ZOBJCLASSMETHOD(documentclass,"GetPropertyType",field)
 . . i type="" $$$WriteError("для класса "_documentclass_" не нашлось определения свойства "_field_" в CompiledClass") q
 . . s val=$G(@DocData@("body",str,field))  //значение поля
 . . i type="%Library.Date" s:val'="" val=$ZDH(val,4)
 . . i type="%Library.Time" s:val'="" val=$ZTH(val,1,"")
 . . i type="%Library.Numeric" s val=+val
 . . i type["%" s $ZOBJPROPERTY(Object,field)=val
 . . e  s ok=$ZOBJMETHOD(Object,field_"SetObjectId",val)
 . s ok=Object.%Save()
 . i '+ok $$$WriteObjError(ok)
 i '+ok TROLLBACK 1 q "Извините. Во время сохранения списка произошла ошибка. Список не сохранён."
 TCOMMIT
 q 1
SaveListOfObjectsErr
 $$$WriteError($ZE)
 TROLLBACK 1
 q "Извините. Во время сохранения списка произошла ошибка. Список не сохранён."
]]></Implementation>
</Method>

<Method name="BanGoodsForAll">
<Description><![CDATA[
Забанить запчасть для всех контрагентов
<var>goodsID</var> - ID запчасти которую нужно забанить для всех контрагентов
<var>SetBan</var> - поставить/снять бан (1 - поставить, 0 - снять)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>goods:%String,SetBan:%Boolean=1</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s goods=$g(goods) Q:goods="" 
	s SetBan=$g(SetBan,1)
	s kontr=""
	&sql(DECLARE krs cursor for 
		SELECT ID INTO :kontr FROM Common.Kontragent
	) &sql(OPEN krs)
 //TSTART
	 s sc=0 ;status code
	 for { 
	 		&sql(FETCH krs) 
	 		Q:SQLCODE'=0
	   
	 		if ( SetBan ) 
	 		{
		 		
		 		d ##class(Goods.Goods).kbanAdd(goods, kontr)
	 		} else 
	 		{
	 			d ##class(Goods.Goods).kbanDel(goods, kontr)
	 		}
	 		//s ban=##class(Goods.Goods).kbanned(goods,kontr) //посмотрим что получилось
	 		//действие совпало с результатом ?
	 		//k sc s sc= ( ban = SetBan ) Q:'sc  ;quit for
	 }
	 &sql(close krs)
 //if 'sc TROLLBACK  Q 0 ;не получилось установить
 //TCOMMIT
 Q 1
]]></Implementation>
</Method>
</Class>


<Class name="Docs.Action2">
<Description>
Дополнительные методы для работы с документами</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>60841,85070.746555</TimeCreated>

<Method name="InnerInstructNewStr">
<Description><![CDATA[
Сформировать и вывести xml с данными строк указанной внутренней инструкции
<br><var>DocId</var> - ID]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,p1,ClassName</FormalSpec>
<Implementation><![CDATA[
 s $ZT="InnerInstructNewStrErr"

 s Fields("addr","ValueField")="Common.SqlProcs_AddrPath(addr)"
 s Fields("addr","ValueAlias")="addrName"
 s Fields("addr","IDField")="addr"
 s Fields("addr","IDAlias")="addr"
 
 s Fields("Goods","ValueField")="Goods->FullName"
 s Fields("Goods","ValueAlias")="GoodsFullName"
 s Fields("Goods","IDField")="Goods"
 s Fields("Goods","IDAlias")="Goods"
 
 s Fields("quantdefault","ValueField")="quantdefault"
 
 s Fields("quantreal","ValueField")="quantreal"

 q ..SqlQuery(.Fields,ClassName,"Doc="_DocId)
InnerInstructNewStrErr
 $$$WriteError($ZE)
 q "Ошибка при формировании списка строк"
]]></Implementation>
</Method>

<Method name="ChiefInstructStr">
<Description><![CDATA[
Сформировать и вывести xml с данными строк указанной инструкции руководителя
<br><var>DocId</var> - ID]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId,Class:%String="Operation.InstructionsItems",p2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ChiefInstructStrErr"
 if Class="undefined" s Class = "Operation.InstructionsItems"
 
 s Fields("Goods","ValueField")="Goods->FullName"
 s Fields("Goods","ValueAlias")="GoodsFullName"
 s Fields("Goods","IDField")="Goods"
 s Fields("Goods","IDAlias")="Goods"
 
 s Fields("Quantity","ValueField")="Quantity"
 
 s Fields("Price","ValueField")="Price"
 s Fields("Total","ValueField")="Total"
 
 if Class="Operation.InstructionsItems" 
 {
	s Fields("BrakComment","ValueField")="BrakComment"
	s Fields("sn","ValueField")="sn"
 	s Fields("garant","ValueField")="garant"
 	s Fields("opispolomki","ValueField")="opispolomki"
 	s Fields("seller","ValueField")="seller"
 	s Fields("SellDate2","ValueField")="SellDate2"
 }

 q ..SqlQuery(.Fields,Class,"Doc="_DocId)
ChiefInstructStrErr
 $$$WriteError($ZE)
 q "Ошибка при формировании списка строк"
]]></Implementation>
</Method>

<Method name="SqlQuery">
<Description><![CDATA[
Выполнить SQL запрос вернуть его в виде XML
<br><var>Fields</var> - массив с полями запроса
<br><var>ClassName</var> - From
<br><var>DocId</var> - Where 
<br><var>IdField</val> - поле значение которого будет трактоваться как ID записи (по умолчанию ID)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Fields:%String,ClassName:%String,Where:%String="",IdField:%String="ID"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="SqlQueryErr"

 $$$StartXML
 s sc=xmlstr.Element("AllObjects")
 
 s Fields=""
 s i="" f  s i=$O(Fields(i)) q:i=""  d
 . s ValueField=Fields(i,"ValueField")
 . s ValueAlias=$G(Fields(i,"ValueAlias"),Fields(i,"ValueField"))
 . s IDField=$G(Fields(i,"IDField"))
 . s IDAlias=$G(Fields(i,"IDAlias"))
 . s Fields=Fields_ValueField_" As "_ValueAlias_","
 . s:IDField'="" Fields=Fields_IDField_" As "_IDAlias_","
 s Fields=$E(Fields,1,$L(Fields)-1)
 s sql="select "_IdField_" as ID,"_Fields_" from "_ClassName
 i Where'="" s sql=sql_" where "_Where
 s result = ##class(%ResultSet).%New()
 s ^mtempArt("Doc.Action2.SqlQuery.sql")=sql
 s ok=result.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 s ok=result.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 While result.Next() {

 s ID=$G(result.Data("ID"))
 
	s sc=xmlstr.Element("OneObject")
	s sc=xmlstr.WriteAttribute("id",ID)
	
		s i="" f  s i=$O(Fields(i)) q:i=""  d
		. s ValueAlias=$G(Fields(i,"ValueAlias"),Fields(i,"ValueField"))
		. s IDAlias=$G(Fields(i,"IDAlias"))
		. s sc=xmlstr.Element(i)
		. s Value=$ZCVT($G(result.Data(ValueAlias)),"O","HTML")
		. 	s sc=xmlstr.WriteAttribute("Value",Value)
		. 	s:IDAlias'="" sc=xmlstr.WriteAttribute("id",$G(result.Data(IDAlias)))
		. s sc=xmlstr.EndElement()
		
	s sc=xmlstr.EndElement()
 } 
 
 s sc=xmlstr.EndElement()
 
 $$$EndXML
 q 1
SqlQueryErr
 $$$WriteError($ZE)
 q "Ошибка при формировании списка строк"
]]></Implementation>
</Method>

<Method name="GetDisplayListArray">
<Description><![CDATA[
Получить массив значений DisplayList = ValueList
<br><val>ClassProperty</val> - Класс||Свойство (например "Operation.Instructions||State")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ClassProperty:%String="",&Array]]></FormalSpec>
<Implementation><![CDATA[
 k Array
 s cl=##class(%Dictionary.PropertyDefinition).%OpenId(ClassProperty)
 s DISPLAYLIST=cl.Parameters.GetAt("DISPLAYLIST")
 s VALUELIST=cl.Parameters.GetAt("VALUELIST")
 f i=1:1:$L(DISPLAYLIST,",") d
 . s ValueItem=$P(VALUELIST,",",i)
 . s DisplayItem=$P(DISPLAYLIST,",",i)
 . s:ValueItem'="" Array(ValueItem)=DisplayItem
 q 1
]]></Implementation>
</Method>

<Method name="GetDisplaylistOptions">
<Description><![CDATA[
Получить строку элементов <option> для HTML элемента <SELECT>
в которой DISPLAYLIST и VALUELIST для свойства указанного свойства
<br><val>DefaultValue</var> - значение из списка VALUELIST элемент с которым следует сделать SELECTED 
<br><val>ClassProperty</val> - Класс||Свойство (например "Operation.Instructions||State")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DefaultValue:%String="",ClassProperty:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="GetDisplaylistErr"
 q:ClassProperty="" "<option>Ошибка. Не указано имя поля для вывода начальных значений.</option>"
 k ResultArray
 s cl=##class(%Dictionary.PropertyDefinition).%OpenId(ClassProperty)
 s DISPLAYLIST=cl.Parameters.GetAt("DISPLAYLIST")
 s VALUELIST=cl.Parameters.GetAt("VALUELIST")
 f i=1:1:$L(DISPLAYLIST,",") d
 . s OptionValue=$P(VALUELIST,",",i)
 . i OptionValue=DefaultValue s SELECTED="SELECTED"
 . e  s SELECTED=""
 . s result=$G(result)_"<option value="""_OptionValue_""" "_SELECTED_">"_$P(DISPLAYLIST,",",i)_"</option>"
 q $G(result)
GetDisplaylistErr
 $$$WriteError($ZE)
 q "<option>Извините. Ошибка при заполнении начальных значений поля.</option>"
]]></Implementation>
</Method>

<Method name="GetClassValuesOptions">
<Description><![CDATA[
Получить строку элементов <option> для HTML элемента <SELECT>
в которой значения указанного класса (ID,Name)
<br><val>DefaultValue</val> - значение поля OptionValueField которое следует подсветить
<br><val>Classname</val> - Имя класса (например Common.Dictionary7)
<br><val>OptionValueField</val> - Имя поля которое будет в атрибуте VALUE элемента OPTION (по умолчанию ID)
<br><val>OptionTextField</val> - Имя поля которое будет значением элемента OPTION (по умолчанию Name)
<br><val>AddEmptyOption</val> - Добавить пустой элемент (по умолчанию да)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DefaultValue:%String="",Classname:%String="",OptionValueField:%String="ID",OptionTextField:%String="Name",AddEmptyOption:%Boolean=1,OrderBy:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="GetClassValuesOptionsErr"
 i AddEmptyOption s result="<option></option>"
 if $ISOBJECT(DefaultValue) s DefaultValue=DefaultValue.%Id()
 s sql="select "_OptionValueField_","_OptionTextField_" from "_Classname
 if OrderBy'="" s sql=sql_" order by "_OrderBy
 s rs = ##class(%ResultSet).%New()
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 While rs.Next() {
	s OptionText = $G(rs.Data(OptionTextField))
	s OptionValue = $G(rs.Data(OptionValueField))
	i OptionValue=DefaultValue s SELECTED="SELECTED"
	e  s SELECTED=""
	s result=$G(result)_"<option value="""_OptionValue_""" "_SELECTED_">"_OptionText_"</option>"
 }
 q $G(result)
GetClassValuesOptionsErr
 $$$WriteError($ZE)
 q "<option>Извините. Ошибка при заполнении начальных значений поля.</option>"
]]></Implementation>
</Method>

<Method name="BlockAndShowCells">
<Description><![CDATA[
Заблокировать и вывести ячейки принадлежащие указанной
<br><var>CellId</var> - Id из справочника Store.Address]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>CellId,p1,p2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="BlockAndShowCellsErr"
 s addrobj=##class(Store.Address).%OpenId(CellId)
 s depot=addrobj.Depot.%Id()
 s OriginalCode=addrobj.Code
 s ParentCode=addrobj.Code_"*"
 s ok=##class(Store.Action).BlockCells(addrobj)
 i '+ok q ok
 s Fields("addr","ValueField")="Common.SqlProcs_AddrPath(Address)"
 s Fields("addr","ValueAlias")="addr"
 s Fields("addr","IDField")="Address"
 s Fields("addr","IDAlias")="Address"
 
 s Fields("Goods","ValueField")="Goods->FullName"
 s Fields("Goods","ValueAlias")="GoodsFullName"
 s Fields("Goods","IDField")="Goods"
 s Fields("Goods","IDAlias")="Goods"
 
 s Fields("quantplan","ValueField")="Value1"
 
 s Fields("Price","ValueField")="Goods->Price"
 s Fields("Price","ValueAlias")="GoodsPrice"

 s Fields("Total","ValueField")="(Goods->Price*Value1)"
 s Fields("Total","ValueAlias")="Summa"
 
 q ..SqlQuery(.Fields,"Store.Quantity","(Address->code %STARTSWITH '"_ParentCode_"' OR Address->code='"_OriginalCode_"') and Address->Depot="_depot)
BlockAndShowCellsErr
 $$$WriteError($ZE)
 q "Ошибка формирования строк инвентаризации"
]]></Implementation>
</Method>

<Method name="InventStr">
<Description><![CDATA[
Вывести строки инвентаризации
<br><var>DocId</var> - Id документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String="",p1,p2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="InventStrErr"

 s Fields("addr","ValueField")="Common.SqlProcs_AddrPath(addr)"
 s Fields("addr","ValueAlias")="addr"
 s Fields("addr","IDField")="addr"
 s Fields("addr","IDAlias")="Address"
 
 s Fields("Goods","ValueField")="Goods->FullName"
 s Fields("Goods","ValueAlias")="GoodsFullName"
 s Fields("Goods","IDField")="Goods"
 s Fields("Goods","IDAlias")="Goods"
 
 s Fields("quantplan","ValueField")="quantplan"
 s Fields("Quantity","ValueField")="Quantity"
  
 s Fields("Price","ValueField")="Price"

 s Fields("Total","ValueField")="Total"
 
 q ..SqlQuery(.Fields,"Docs.InventItems","Doc="_DocId)
InventStrErr
 $$$WriteError($ZE)
 q "Ошибка формирования строк инвентаризации"
]]></Implementation>
</Method>

<Method name="CreateUtiliz">
<Description><![CDATA[
Создать документ утилизации с товарами подлежащими утилизации
<br>BrakIDs - строка с ID из таблицы Store.Brak для ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>BrakIDs:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CreateUtilizErr",ok=1
 
 f i=1:1:$L(BrakIDs,"#@#") d
 . s GoodsId=$P(BrakIDs,"#@#",i)
 . q:'+GoodsId
 . s IdsList=$G(IdsList)_GoodsId_","
 i $E(IdsList,$L(IdsList))="," s $E(IdsList,$L(IdsList))=""
	//извлечём данные о товаре, количестве и месте его расположения из таблицы брака
 s sql="select ID,Goods,Address,Qnt from Store.Brak where ID in ("_IdsList_")"
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql) i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа утилизации"
 s ok=rs.Execute() i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа утилизации"
 while rs.Next() {
 	s ID=rs.Data("ID")
 	s BrakData(ID,"Goods")=rs.Data("Goods")
 	s BrakData(ID,"Address")=rs.Data("Address")
 	s BrakData(ID,"Qnt")=rs.Data("Qnt")
 }
 
 s doc=##class(Docs.Utiliz).%New() 	
 s DocName=##class(Docs.Action).getRashNumb("Docs.Utiliz")
 s doc.Name=DocName
 f i=1:1:$L(BrakIDs,"#@#") d  q:'+ok
 . s BrakID=$P(BrakIDs,"#@#",i)
 . q:'+BrakID
 . s item=##class(Docs.UtilizItems).%New()
 . d item.GoodsSetObjectId(BrakData(BrakID,"Goods"))
 . s item.Quantity=BrakData(BrakID,"Qnt")
 . d item.addrSetObjectId(BrakData(BrakID,"Address"))
 . s item.goodsdir=1
 . s item.SourceTbl=2
 . d item.BrakSetObjectId(BrakID)
 . d item.DocTypeSetObjectId("Docs.Utiliz")
 . s ok=doc.Items.Insert(item)
 . i '+ok $$$WriteObjError(ok)
 i '+ok q "Ошибка при создании документа утилизации."
 s ok=doc.%Save()
 i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа утилизации"
 q doc.%Id()
CreateUtilizErr
 $$$WriteError($ZE)
 q "Ошибка при создании документа утилизации"
]]></Implementation>
</Method>

<Method name="CreateBrakremont">
<Description><![CDATA[
Создать документ утилизации с товарами подлежащими утилизации
<br>BrakIDs - строка с ID из таблицы Store.Brak для ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>BrakIDs:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CreateBrakremontErr",ok=1
 
 f i=1:1:$L(BrakIDs,"#@#") d
 . s GoodsId=$P(BrakIDs,"#@#",i)
 . q:'+GoodsId
 . s IdsList=$G(IdsList)_GoodsId_","
 i $E(IdsList,$L(IdsList))="," s $E(IdsList,$L(IdsList))=""
	//извлечём данные о товаре, количестве и месте его расположения из таблицы брака
 s sql="select ID,Goods,Address,Qnt from Store.Brak where ID in ("_IdsList_")"
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql) i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа передачи брака в ремонт"
 s ok=rs.Execute() i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа передачи брака в ремонт"
 while rs.Next() {
 	s ID=rs.Data("ID")
 	s BrakData(ID,"Goods")=rs.Data("Goods")
 	s BrakData(ID,"Address")=rs.Data("Address")
 	s BrakData(ID,"Qnt")=rs.Data("Qnt")
 }
 
 s doc=##class(Docs.Brakremont).%New() 	
 s DocName=##class(Docs.Action).getRashNumb("Docs.Brakremont")
 s doc.Name=DocName
 f i=1:1:$L(BrakIDs,"#@#") d  q:'+ok
 . s BrakID=$P(BrakIDs,"#@#",i)
 . q:'+BrakID
 . s item=##class(Docs.BrakremontItems).%New()
 . d item.GoodsSetObjectId(BrakData(BrakID,"Goods"))
 . s item.Quantity=BrakData(BrakID,"Qnt")
 . d item.addrSetObjectId(BrakData(BrakID,"Address"))
 . d item.BrakSetObjectId(BrakID)
 . d item.DocTypeSetObjectId("Docs.Brakremont")
 . s ok=doc.Items.Insert(item)
 . i '+ok $$$WriteObjError(ok)
 i '+ok q "Ошибка при создании документа передачи брака в ремонт"
 s ok=doc.%Save()
 i '+ok $$$WriteObjError(ok) q "Ошибка при создании документа передачи брака в ремонт"
 q doc.%Id()
CreateBrakremontErr
 $$$WriteError($ZE)
 q "Ошибка при создании документа передачи брака в ремонт"
]]></Implementation>
</Method>

<Method name="ImportDocsGlobal">
<ClassMethod>1</ClassMethod>
<FormalSpec>file</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ImportDocsGlobalErr"
 s Resultglob="^mtempHiddenImport"_$J
 s SourceFieldListIndex=##class(Docs.Super).GetPropertyListIndex("Source")
 s docFieldListIndex=##class(Docs.DocItems).GetPropertyListIndex("Doc")
 k @Resultglob,^OldAndNewDocs
 j Import^ExportImport(Resultglob,file)
 f  h .01 q:$G(@Resultglob)'=""
 s ok=$S(+@Resultglob:"Загрузка завершилась успешно. Импортированные элементы: "_@Resultglob@("loadedlist"),1:@Resultglob)
 w ok,!
 s glob=$P(@Resultglob@("loadedlist"),".")
 s LastDocid=$G(^Docs.SuperD)				//ID последнего док. в системе
 w "ID последнего документа в системе "_LastDocid,!
 s i="" f  s i=$o(@glob@("Docs",i)) q:i=""  d
 . //цикл по документам в пакете импорта
 . q:i=""
 . i $i(count)
 . s NewDocId=count+LastDocid				//ID вновь создаваемого документа в системе из пакета импорта
 . m @glob@("NewDocs",NewDocId)=@glob@("Docs",i)	//в новую структуру пишем документы c ID которые вставятся в Docs.Super
 . s ^OldAndNewDocs(0,i)=NewDocId	//соответствие старых и новых ID
 . s ^OldAndNewDocs(1,NewDocId)=i	//соответствие новых и старых ID
 w "прошли "_+$G(count)_" документов, id последнего будет: ",NewDocId,!
 w "Соответствие старых и новых ID в ^mtempArt(""Equal"")",!

 //в новых документах заменим поле Source
 s i="" f  s i=$o(@glob@("NewDocs",i)) q:i=""  d
 . //цикл по документам в пакете импорта с новыми ID, которые позже запишутся в Docs.Super
 . s Source=$LG(@glob@("NewDocs",i),SourceFieldListIndex)	//поле Source
 . //если в нашем пакете импорта есть тот документ на который ссылается это поле Source
 . q:'+Source
 . d:$D(^OldAndNewDocs(0,Source))
 . . //в поле Source старый ID меняем на тот, который был создан
 . . s $LI(@glob@("NewDocs",i),SourceFieldListIndex)=^OldAndNewDocs(0,Source)

 s count=""
 s LastItemId=$G(^Docs.DocItemsD)				//ID последнего док. в системе
 s i="" f  s i=$o(@glob@("Items",i)) q:i=""  d
 . //цикл по строкам в пакете импорта
 . i $I(count)
 . s NewItemId=count+LastItemId				//ID вновь создаваемого документа в системе из пакета импорта
 . s OlddocValue=$LG(@glob@("Items",i),docFieldListIndex)
 . q:'$D(OldAndNewDocs(0,OlddocValue))
 . s $LI(@glob@("Items",i),docFieldListIndex)=OldAndNewDocs(0,OlddocValue)
 . m @glob@("NewItems",NewItemId)=@glob@("Items",i)

 m ^Docs.SuperD=@glob@("NewDocs")
 w "Добавили в ^Docs.SuperD "_glob_"(""NewDocs"")",!
 i +$G(NewDocId) d
 . w "Последний id в ^Docs.SuperD теперь "_NewDocId+1
 . s ^Docs.SuperD=NewDocId+1
 m ^Docs.DocItemsD=@glob@("NewItems")
 w "Добавили в ^Docs.DocItemsD "_glob_"(""NewItems"")",!
 i +$G(NewItemId) d
 . w "Последний id в ^Docs.DocItemsD теперь "_NewItemId+1
 . s ^Docs.DocItemsD=NewItemId+1
 
 w "Удаление индексов Docs.Super ..."
 d ##class(Docs.Super).%PurgeIndices()
 w "ok",!
 w "Удаление индексов Docs.DocItems..."
 d ##class(Docs.DocItems).%PurgeIndices()
 w "ok",!
 w "Перестройка индексов Docs.Super ..."
 d ##class(Docs.Super).%BuildIndices()
 w "ok",!
 w "Перестройка индексов Docs.DocItems ..."
 d ##class(Docs.DocItems).%BuildIndices()
 w "ok",!
 //увеличим ID каждого документа на 

 q ok
ImportDocsGlobalErr
 $$$WriteError($ZE)
 q "Ошибка импорта документов"
]]></Implementation>
</Method>

<Method name="ExportDocsGlobal">
<ClassMethod>1</ClassMethod>
<FormalSpec>dat1="",dat2="",p1</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ExportDocsGlobalErr"
 s dat1=$ZDH(dat1,4)
 s dat2=$ZDH(dat2,4)
 s glob="^mtempHiddenExport"_$J
 k @glob
 //выгружаем документы
 &sql(declare zzz cursor for select id into :DocId from Docs.Super where (Dat>=:dat1 and Dat<=:dat2) or (ChangeDate>=:dat1 and ChangeDate<=:dat2))
 &sql(open zzz)
 f  &sql(fetch zzz) q:SQLCODE  d
 . m @glob@("Docs",DocId)=^Docs.SuperD(DocId)
 &sql(close zzz)
 //выгружаем строки
 &sql(declare zz cursor for select id into :ItemId from Docs.DocItems where (doc->Dat>=:dat1 and doc->Dat<=:dat2) or (doc->ChangeDate>=:dat1 and doc->ChangeDate<=:dat2))
 &sql(open zz)
 f  &sql(fetch zz) q:SQLCODE  d
 . m @glob@("Items",ItemId)=^Docs.DocItemsD(ItemId)
 &sql(close zz)
 s file="c:\DocsGlobalExport.gbl"
 s globFile=$E(glob,2,$L(glob))_".gbl"
 j Export^ExportImport(globFile,file,glob)
 f  h .01 q:$G(@glob)'=""
 s ok=$S(+@glob:"Выгрузка завершилась успешно. Файлj экспорта "_file,1:@glob)
 k @glob
 q ok
ExportDocsGlobalErr
 $$$WriteError($ZE)
 q "Ошибка при выгрузке документов."
]]></Implementation>
</Method>

<Method name="MakeStoreOutBrak">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[RashObj,&StoreObj]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s InstructionObj=RashObj.Source	//инструкция руководителя
 s StoreObj.Brak=1
 s i="",ok=1
 f  s i=InstructionObj.Items.Next(i) q:(i="")!('+ok)  d
 . s Item=InstructionObj.Items.GetAt(i)	//строка инструкции руководителя
 . s StoreItemObj=##class(Docs.StorageOutItems).%New()	//строка внутренней инструкции
 . d StoreItemObj.DocTypeSetObjectId("Docs.StorageOut")
 . s StoreItemObj.Goods=Item.Goods
 . s StoreItemObj.Price=Item.Price
 . s StoreItemObj.quantdefault=Item.Quantity
 . s StoreItemObj.Total=Item.Total
 . s StoreItemObj.addr=Item.addr
 . s ok=StoreObj.Items.Insert(StoreItemObj)
 i '+ok d  q "Извините. Ошибка при создании внутренней инструкции."
 s ok=StoreObj.%Save()
 i '+ok d  q "Извините. Ошибка при создании внутренней инструкции."
 . $$$WriteObjError(ok)
 q 1
]]></Implementation>
</Method>

<Method name="MakeStoreOut">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[RashID:%String,&StoreObj:Docs.StorageOut=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="MakeStoreOutErr"
 TSTART
 s kurs=##class(Goods.GoodsAction).kurs(.other)
 s glob=$NA(^mtempMakeStoreOut($J)) k @glob
 i $ISOBJECT(RashID) s RashObj=RashID,RashID=RashObj.%Id()
 e  s RashObj=##class(Docs.Rash).%OpenId(RashID)
 s RashObj.kurs=kurs
 i '$ISOBJECT(StoreObj) d
 . s StoreObj=##class(Docs.StorageOut).%New()
 . s StoreObj.Name=RashObj.Name_"-о"
 . s StoreObj.Comment=RashObj.Comment
 . s StoreObj.Depot=RashObj.Depot
 . s StoreObj.Source=RashObj
 . s StoreObj.Kontr=RashObj.Kontr
 . d StoreObj.%Save()
 
 // если это от инструкции руководителя "отправка некондиционных товаров" то создаём другим методом
 if RashObj.Source.Oper.%Id()=11 d  q ok
 . s ok=..MakeStoreOutBrak(RashObj,.StoreObj)
 . if ok TCOMMIT
 . else  TROLLBACK
 s StoreID=StoreObj.%Id()
 k ^LogOfCreation(StoreID)
 s i="",ok=1
 f  s i=RashObj.Items.Next(i) q:(i="")!('+ok)  d
 . s Item=RashObj.Items.GetAt(i)
 . q:'$ISOBJECT(Item)
 . q:Item.JustCreated
 . s (QntStillNeeded,Qnt)=Item.Quantity				//Нужное количество товара
 . s GoodsId=Item.Goods.%Id()		//ID нужного товара
 . s GoodsName=Item.Goods.FullName
 . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="    Товар "_GoodsName_" Нужно "_Qnt
 . k Found, @glob
 . s ok=##class(Store.Action).FindGoodsPlaces(GoodsId,.Found)
 . q:'+ok
 . //Перепишем массив с найденными ячейками во временную глобальку что бы передавать в процедуры
 . m @glob=Found
 . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Всего нашли "_Found
 . if Found>=Qnt d  q
 . . //нашли сколько нужно или даже больше
 . . //найдём в списке найденных ячеек количество такое же или больше чем нам надо
 . . s Quantity=$O(Found(1,(Qnt-0.000001)))	//количество в ячейке которая соответствует нужному количеству
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))= "Нашли больше чем надо"
 . . if Quantity d
 . . . //нашли нужное количество в одной ячейке
 . . . s StoreQntID = Found(1,Quantity,"ID")	//ID записи в Store.Quantity
 . . . s AddressID=Found(1,Quantity)			//ID ячейки с нужным количеством товара
 . . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Количество в ближайшей ячейке "_Quantity_" Адрес "_##class(Store.Action).AddressPath(AddressID)
 . . . d MakeStorageItem(StoreObj,GoodsId,Qnt,AddressID,StoreQntID,GoodsName)	//пишем в инструкцию по отгрузке
 . . e  d
 . . . //Нужное количество нашли но оно разбросано
 . . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Собираем из разных ячеек"
 . . . s QntStillNeeded=$$CollectGoodFromCells(glob,StoreObj,GoodsId,Qnt,,,,GoodsName)
 . //отсюда идёт ветка набора остатков товара
 . //если мы здесь значит для текущего товара (GoodsId) нет нужного количества на складе
 . //сколько его вообще затребовали, если хоть один товар будет найден на местах хранения, QntStillNeeded - будет означать сколькр ещ1 товара осталось набрать
 . if Found>=1 d
 . . //нашли хотя бы один требуемый товар
 . . //QntStillNeeded - количество которое ещё требуется доложить по данному товару
 . . //т.е. CollectGoodFromCells набирает сколько может из представленного массива, 
 . . //но этого не хватит, и вот количество которого не хватает это QntStillNeeded
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Сколько нужно не нашли, но вообще количество есть"
 . . s QntStillNeeded=$$CollectGoodFromCells(glob,StoreObj,GoodsId,QntStillNeeded,,,,GoodsName)
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="После сбора из всех ячеек остался недобор "_QntStillNeeded
 . . //после того как набрали сколько могли товара объявляем сколько требовалось и сколько мы набрали
 . . s Item.Quantity=(Qnt-QntStillNeeded)
 . . s Item.Zakaz=Qnt
 . //теперь пошли по аналогам товара
 . //попытаемся найти такой аналог у которого в одной ячейке лежало бы нужное количество товара
 . &sql(select d4.Property6625,d4.Property6625->FullName,stq.ID,stq.Address into :AnalogId,:AnalogName,:StoreQntID,:AddressId from Common.Dictionary4 d4, Store.Quantity stq where d4.Name=:GoodsId and stq.Goods=d4.Property6625 and stq.Value1>=:QntStillNeeded order by Value1 asc)
 . if 'SQLCODE do  q
 . . //нашли аналог у которого нужное количество есть в одной ячейке, добавляем его и выходим
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Нашли аналог "_AnalogName_" который сосредоточен в одной ячейке "_##class(Store.Action).AddressPath(AddressId)
 . . d MakeStorageItem(StoreObj,AnalogId,QntStillNeeded,AddressId,StoreQntID,GoodsName)
 . . //выставляем в расходной накладной факт замены
 . . d Item.GoodsSetObjectId(AnalogId)
 . . s Item.Zakaz=Qnt
 . . d Item.ZakazGoodsSetObjectId(GoodsId)
 . . s Item.ZakazDat=+$H
 . . s Item.ZakazTim=$P($H,",",2)
 . //последний этап.
 . //Если мы здесь значит для строки расходной накладной не смогли набрать нужного товара 
 . //и не нашли такой аналог что бы нужное количество было на одной полке
 . &sql(declare analogs cursor for select Property6625,Property6625->FullName into :Property6625,:Property6625FullName from Common.Dictionary4 where Name=:GoodsId)
 . &sql(open analogs)
 . f  &sql(fetch analogs) q:SQLCODE  d
 . . s Analogs(Property6625)=""		//массив в котором узлы это ID товаров - аналогов текущего
 . . s Analogs(Property6625,"FullName")=Property6625FullName
 . &sql(close analogs)
 . //пошли по сформированному массиву с аналогами для каждого находим количество
 . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Нашли несколько аналогов."
 . s AnalogId="" f  s AnalogId=$O(Analogs(AnalogId)) q:(AnalogId="")||('+ok)||('+QntStillNeeded)  d
 . . k Found, @glob
 . . s ok=##class(Store.Action).FindGoodsPlaces(AnalogId,.Found)
 . . q:('+ok)||(Found<1)
 . . m @glob=Found
 . . s AnalogFullName=Analogs(AnalogId,"FullName")
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="Аналог "_AnalogFullName_" количество "_Found
 . . s QntStillNeeded=$$CollectGoodFromCells(glob,StoreObj,AnalogId,QntStillNeeded,1,GoodsId,RashObj,GoodsName)
 . . s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="После него ещё необходимо набрать "_QntStillNeeded
 . if Qnt>=QntStillNeeded,QntStillNeeded d MakeStorageItem(StoreObj,GoodsId,QntStillNeeded,"","",GoodsName)
 if '+ok TROLLBACK  q ok
 
 s ok=StoreObj.%Save()
 i '+ok d  q "Извините. Ошибка при создании внутренней инструкции."
 . TROLLBACK
 . $$$WriteObjError(ok)
 s ^LogOfCreation(StoreID,GoodsName,$I(^LogOfCreation(StoreID,GoodsName)))="код в структуре остатков StoreObj.%Id()="_StoreObj.%Id()
 
 s ok=RashObj.%Save()
 i '+ok d  q "Извините. Ошибка при создании внутренней инструкции."
 . TROLLBACK
 . $$$WriteObjError(ok)
 
 TCOMMIT
 q 1

 //Создать строку инструкции по отгрузке и прикрепить к этой инструкции
MakeStorageItem(StoreObj,GoodsId,Qnt,Address="",StoreQntID="", GoodName)
 s StoreObjId=StoreObj.%Id()
 s GoodName2 = ##class(Goods.Goods).GetPropertyValue(GoodsId,"abbr")_"-"_##class(Goods.Goods).GetPropertyValue(GoodsId,"Property3609")_" "_##class(Goods.Goods).GetPropertyValue(GoodsId,"Name")
 s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))= "Записываем строку в инструкцию по отгрузке. Товар:"_GoodName2_" ("_GoodsId_") количество: "_Qnt_" ячейка: "_##class(Store.Action).AddressPath(Address)
 s StorageItem=##class(Docs.StorageOutItems).%New()
 d StorageItem.GoodsSetObjectId(GoodsId)
 s StorageItem.quantdefault=Qnt
 s StorageItem.Quantity=Qnt
 d:StoreQntID StorageItem.StoreQntIDSetObjectId(StoreQntID)
 d:Address StorageItem.addrSetObjectId(Address)
 d StorageItem.DocTypeSetObjectId("Docs.StorageOut")
 s StorageItem.serial=Item.serial
 s StorageItem.comment=Item.comment
 d StorageItem.%Save()
 d StoreObj.Items.Insert(StorageItem)
 d:StoreQntID SetRezerv(StoreQntID,Qnt,StoreObj.Name,GoodsId,GoodName,StorageItem.%Id())	//ставим резерв 
 q

 //создать строку расходной накладной
MakeRashItem(RashObj,GoodsId,ZakazId,Quantity,ZakazQuant,GoodName,StoreObjId)
 s $ZT="MakeRashItemErr"
 s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))="  Делаем новую строку в расходной накладной №"_RashObj.Name_" Товар: "_GoodName_" ("_GoodsId_") Количество: "_Quantity_" Заказанное Количество: "_ZakazQuant
 s RashItem=##class(Docs.RashItems).%New()
 d RashItem.GoodsSetObjectId(GoodsId)
 s RashItem.Quantity=Quantity
 d RashItem.ZakazGoodsSetObjectId(ZakazId)
 s RashItem.Zakaz=ZakazQuant
 s RashItem.ZakazDat=+$H
 s RashItem.ZakazTim=$P($H,",",2)
 d RashItem.DocTypeSetObjectId("Docs.Rash")
 s RashItem.JustCreated = 1
 d RashObj.Items.Insert(RashItem)
 q 
MakeRashItemErr
 $$$WriteError($ZE)
 q
 //glob		ссылка на глобаль с данными (формат см. Store.Action.FindGoodsPlaces()
 //StoreObj
 //GoodsId
 //Qnt
 //StoreQntID
CollectGoodFromCells(glob,StoreObj,GoodsId,Qnt,CreateRashItem=0,ZakazGood,RashObj,GoodName)
 //цикл по массиву с найденными ячейками, 
 //в цикле набираем нужное количество (Qnt) товара (GoodsId) 
 //и создаём строки инструкции по отгрузке, которые привязываем к самой инстр. по отгрузке
 s StoreObjId=StoreObj.%Id()
 s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))= "  Собираем из разных ячеек, всего нужно набрать "_Qnt_" в переданном массиве: "_Found_" "_$S(CreateRashItem:"Необходимо создать строку в расходной накладной.",1:"")
 k Found
 m Found=@glob
 if '+$G(Found) q 0
 //. s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))= "  не нашли вообще ни одной штуки "
 s AddressID="" f  s AddressID=$O(Found(0,AddressID)) q:(AddressID="")||('Qnt)  d
 . s StoreQntID = Found(0,AddressID,"ID")
 . s QntInCell = Found(0,AddressID)
 . //если Количество в ячейке больше чем нужно то в строку вставляем просто то количество которое нужно
 . //иначе в строку вставляем всё количество ячейки
 . if QntInCell>Qnt s QntForString=Qnt
 . e  s QntForString=QntInCell
 . s Qnt=Qnt-QntForString
 . s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))="Ячейка: "_##class(Store.Action).AddressPath(AddressID)_" в ней: "_QntInCell_" берём в строку: "_QntForString
 . d MakeStorageItem(StoreObj,GoodsId,QntForString,AddressID,StoreQntID,GoodName)
 d:CreateRashItem MakeRashItem(RashObj,GoodsId,ZakazGood,QntForString,QntForString,GoodName,StoreObjId)
 s ^LogOfCreation(StoreObjId,GoodName,$I(^LogOfCreation(StoreObjId,GoodName)))="после набора остался недобор: "_Qnt
 q Qnt
 
 //Установить резерв
SetRezerv(StoreQntID,Qnt,StoreID,GoodsId,GoodName,StorageItemId)
 //&sql(update Store.Quantity set Value1=(Value1-:Qnt),Value2=(Value2+:Qnt) where ID=:StoreQntID)
 d ##class(Docs.StorageOutItems).SetReserve(StoreQntID,Qnt,StorageItemId)
 i $G(StoreID)'="",$G(GoodsId)'="" s ^LogOfCreation(StoreID,GoodName,$I(^LogOfCreation(StoreID,GoodName)))="Ставим резерв "_GoodName_" StoreQntID="_StoreQntID_" Qnt="_Qnt_" SQLCODE="_SQLCODE
 q
 
 //Ошибка
MakeStoreOutErr
 TROLLBACK
 $$$WriteError($ZE)
 q "Извините, ошибка при создании инструкции по отгрузке."
]]></Implementation>
</Method>

<Method name="KontragentsList">
<Description><![CDATA[
Вывести список контрагентов
<br><var>Where</var> - where для SQL запроса]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Where:%String="",p1,p2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="KontragentsListErr"
 s Fields("Name","ValueField")="Name"
 s Fields("Code","ValueField")="Code"
 s Fields("Address","ValueField")="Address"
 s Fields("EMail","ValueField")="EMail"
 s Fields("Agree","ValueField")="Agree"
 s Fields("chief","ValueField")="chief"
 s Fields("Status","ValueField")="Status"
 s Fields("Property2506","ValueField")="Property2506"
 s Fields("Activity","ValueField")="Activity"
 s Fields("Region","ValueField")="Region"
 s Fields("City","ValueField")="City"
 s Fields("Phones","ValueField")="Phones"
 s Fields("ContPers","ValueField")="ContPers"
 s Fields("Federal","ValueField")="Federal"
 
 /*
 s Fields("region2","ValueField")="region2->Name"
 s Fields("region2","ValueAlias")="region2Name"
 s Fields("region2","IDField")="region2"
 s Fields("region2","IDAlias")="region2"

 s Fields("Property126","ValueField")="Property126->Name"
 s Fields("Property126","ValueAlias")="Property126Name"
 s Fields("Property126","IDField")="Property126"
 s Fields("Property126","IDAlias")="Property126"
 */
 
 q ..SqlQuery(.Fields,"Common.Kontragent",Where)
KontragentsListErr
 $$$WriteError($ZE)
 q "Ошибка формирования строк инвентаризации"
]]></Implementation>
</Method>

<Method name="RashStr">
<Description><![CDATA[
Вывести строки расходной накладной
<br><var>DocId</var> - Id документа]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String="",p2,p3</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="RashStrErr"
 
 s Fields("Goods","ValueField")="Goods->FullName"
 s Fields("Goods","ValueAlias")="GoodsFullName"
 s Fields("Goods","IDField")="Goods"
 s Fields("Goods","IDAlias")="Goods"
 s Fields("Quantity","ValueField")="Quantity"
 s Fields("Price","ValueField")="Price"
 s Fields("Total","ValueField")="Total"
 s Fields("ZakazGoods","ValueField")="ZakazGoods->FullName"
 s Fields("ZakazGoods","ValueAlias")="ZakazGoodsFullName"
 s Fields("ZakazGoods","IDField")="ZakazGoods"
 s Fields("ZakazGoods","IDAlias")="ZakazGoods"
 s Fields("Zakaz","ValueField")="Zakaz"
 s Fields("ZakazDat","ValueField")="%external(ZakazDat)"
 s Fields("ZakazDat","ValueAlias")="ZakazDat"
 s Fields("ZakazTim","ValueField")="%external(ZakazTim)"
 s Fields("ZakazTim","ValueAlias")="ZakazTim"
 s Fields("ZakazUser1","ValueField")="ZakazUser1->Name"
 s Fields("ZakazUser1","ValueAlias")="ZakazUser1Name"
 s Fields("ZakazUser1","IDField")="ZakazUser1"
 s Fields("ZakazUser1","IDAlias")="ZakazUser1"
  
 q ..SqlQuery(.Fields,"Docs.RashItems","Doc="_DocId)
RashStrErr
 $$$WriteError($ZE)
 q "Ошибка формирования строк инвентаризации"
]]></Implementation>
</Method>

<Method name="ShowHeaders">
<Description><![CDATA[
Написать JS код для формирования массивов с наименованиями колонок компонента iGrid
<br>ClassName - Имя класса
<br>Fields - название полей класса через запятую, которые необходимо вывести как поля iGrid
<br>ComponentID - ID компонента iGrid (для полей-комбобоксов)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName,Fields,componentID</FormalSpec>
<Implementation><![CDATA[
 if $G(componentID)="" s componentID=0
 s fieldsquantity=$L(Fields,",")
 w "Captions = new Array("_fieldsquantity_");",!
 w "Keys = new Array("_fieldsquantity_");",!
 w "Tags = new Array("_fieldsquantity_");",!
 w "Widths = new Array("_fieldsquantity_");",!
 w "Combos = new Array("_fieldsquantity_");",!
 f i=0:1:fieldsquantity-1 d
 . s FieldName=$P(Fields,",",i+1)
 . s PropertyType=$ZOBJCLASSMETHOD(ClassName,"GetPropertyType",FieldName,.Data)
 . w "Captions["_i_"]="""_Data("Description")_""";",!
 . w "Tags["_i_"]="""_PropertyType_""";",!
 . w "Keys["_i_"]="""_FieldName_""";",!
 . w "Widths["_i_"]="_$G(^HTC("igrid","settings",componentID,FieldName,"Width"),80)_";",!
 . if $G(Data("Valuelist"))'="" d
 . . s ComboName=FieldName_"Combo"
 . . w "Combos["_i_"]='"_ComboName_"'",!
 . . w componentID_".MakeCombo('"_Data("Displaylist")_"','"_Data("Valuelist")_"','"_ComboName_"');",!
 . if $E(PropertyType)'="%" d
 . . s ComboName=FieldName_"Combo"
 . . w "Combos["_i_"]='"_ComboName_"'",!
 . . s sql="select ID,Name from "_PropertyType
 . . s rs=##class(%Library.ResultSet).%New()
 . . s ok=rs.Prepare(sql)
 . . s ok=rs.Execute()
 . . s (Displaylist,Valuelist)=""
 . . while rs.Next() { s Displaylist=$G(Displaylist)_","_rs.Data("Name"),Valuelist=$G(Valuelist)_","_rs.Data("ID") }
 . . w:Displaylist'="" componentID_".MakeCombo('"_Displaylist_"','"_Valuelist_"','"_ComboName_"');",!
 q
]]></Implementation>
</Method>

<Method name="MakeBrakInstruction">
<Description><![CDATA[
Создать или открыть инструкцию руководителя и внести в неё некондиционные товары (с адресом и количеством)
<br>StoreBrakId - список ID Store.Brak]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>StoreBrakId:%String,InstructionId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="MakeBrakInstructionErr"
 if InstructionId'="" s ChiefInstrObj=##class(Operation.Instructions).%OpenId(InstructionId)
 else  d
 . s ChiefInstrObj=##class(Operation.Instructions).%New()
 . d ChiefInstrObj.OperSetObjectId(11)
 . s ChiefInstrObj.Name=##class(Docs.Action).getRashNumb("Operation.Instructions")
 . d ChiefInstrObj.Depot1SetObjectId(1)
 . s ChiefInstrObj.Depot=1
 . s ChiefInstrObj.InstDate=+$H
 f i=1:1:$L(StoreBrakId,"#@#")-1 d
 . s StoreBrakObj=##class(Store.Brak).%OpenId($P(StoreBrakId,"#@#",i))
 . s GoodsId=StoreBrakObj.Goods.%Id()
 . s AddressId=StoreBrakObj.Address.%Id()
 . s Qnt=StoreBrakObj.Qnt
 . s Price=StoreBrakObj.Goods.Price
 . s Total=Qnt*Price
 . //теперь формируем строку инструкции руководителя
 . s ChiefInstrItemObj=##class(Operation.InstructionsItems).%New()
 . d ChiefInstrItemObj.DocTypeSetObjectId("Operation.Instructions")
 . d ChiefInstrItemObj.addrSetObjectId(AddressId)
 . d ChiefInstrItemObj.GoodsSetObjectId(GoodsId)
 . s ChiefInstrItemObj.Quantity=Qnt
 . s ChiefInstrItemObj.Price=Price
 . s ChiefInstrItemObj.Total=Total
 . d ChiefInstrObj.Items.Insert(ChiefInstrItemObj)
 . s Summa=$G(Summa)+Total
 s ChiefInstrObj.Summa=+ChiefInstrObj.Summa+$G(Summa)
 s ok=ChiefInstrObj.%Save()
 if $$$ISERR(ok) $$$WriteObjError(ok) q "Извините, ошибка при создании инструкции на отгрузку некондиционного товара."
 q ChiefInstrObj.%Id()
MakeBrakInstructionErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при создании инструкции руководителя."
]]></Implementation>
</Method>

<Method name="GetSummsByBrands">
<Description>
Получить сумму документа по брендам</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[DocId:%String,&Summ:%String]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	//n SQLCODE,MM,VC,TL,abbr,Total,ID
 s $ZT="GetSummsByBrandsErr"
 k Summ
 s Summ=0
 s MM=$$$TunesVariableGlobal("MM")	//список аббревиатур мастермакс через запятую
 s VC=$$$TunesVariableGlobal("VC")
 s TL=$$$TunesVariableGlobal("TL")
  //списки которые через запятую перегоним в массивы, и вырежем пробелы
 f i=1:1:$L(MM,",") d
 . //обрезаем пробелы
 . s abbr=$TR($P(MM,",",i)," ","")
 . q:abbr=""
 . s MM(abbr)=""

 f i=1:1:$L(VC,",") d
 . //обрезаем пробелы
 . s abbr=$TR($P(VC,",",i)," ","")
 . q:abbr=""
 . s VC(abbr)=""

 f i=1:1:$L(TL,",") d
 . //обрезаем пробелы
 . s abbr=$TR($P(TL,",",i)," ","")
 . q:abbr=""
 . s TL(abbr)=""

 
 &sql(declare BrandSumms cursor for 
 select ID,Goods->abbr,Total
 into :ID,:abbr,:Total
 from Docs.StorageOutItems
 where doc = :DocId)
 &sql(open BrandSumms)
 f  &sql(fetch BrandSumms) q:SQLCODE  d
 . s Summ=Summ+Total
 . s brand="undefined"
 . if abbr'="",$d(MM(abbr)) s brand="MM"
 . if abbr'="",$d(TL(abbr)) s brand="TL"
 . if abbr'="",$d(VC(abbr)) s brand="VC"
 . if brand="undefined" s Summ(brand,"names")=$G(Summ(brand,"names"))_", "_abbr
 . s Summ(brand)=$G(Summ(brand))+Total
 &sql(close BrandSumms)
 q 1
GetSummsByBrandsErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при подсчёте суммы."
]]></Implementation>
</Method>

<Method name="CreateActNote">
<ClassMethod>1</ClassMethod>
<FormalSpec>docids:%String="",PoluhId:%String="",Comment:%String=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CreateActNoteErr"
 s ok=1
 
 s NoteObj=##class(Docs.ActNote).%New()
 f i=1:1:$L(docids,"%23@%23")-1
 {
	 s docid=$P(docids,"%23@%23",i)
	 
	 s DocObj = ##class(Docs.Act).%OpenId(docid)
	 if $ISOBJECT(DocObj),DocObj.Stat=2,DocObj.Paid=0
	 {
	 	s glob(docid)=""
	 	s glob(docid,"goodsid")=DocObj.Goods.%Id()
	 	s glob(docid,"price")=DocObj.Summa
		s ActName=DocObj.Name
		s:DocObj.Paid ErrorActs=$G(ErrorActs)_ActName_", "
		if $ISOBJECT(DocObj.Kontr) 
		{
			s Manager=DocObj.Kontr.Manager
			s Kontr=DocObj.Kontr
			s KontrId=DocObj.Kontr.%Id()
		}
	 }
 }
 
 if $G(ErrorActs)'="" q "Невозможно сформировать служебную записку на оплату акта, так как нектоорые из перечисленных актов уже оплачены: "_ErrorActs
 s NoteObj.Name=##class(Docs.Action).getRashNumb("Docs.ActNote")
 
 //если получателя не указали, то им будет контрагент последнего акта
 if PoluhId="" s PoluhId=KontrId
 d:PoluhId NoteObj.PaymentPoluhSetObjectId(PoluhId)
 
 s NoteObj.Manager=$G(Manager)
 s login=$$$SessionData("login")
 if +login d NoteObj.ChiefSetObjectId(login)
 
 s actid="" f  s actid=$O(glob(actid)) q:(actid="")||('+ok)  d
 . s item = ##class(Docs.ActNoteItems).%New()
 . d item.ActSetObjectId(actid)
 . d item.GoodsSetObjectId(glob(actid,"goodsid"))
 . d item.DocTypeSetObjectId("Docs.ActNote")
 . s item.Price = glob(actid,"price")
 . s ok = NoteObj.Items.Insert(item)
 . if '+ok $$$WriteObjError(ok)
 
 if '+ok q "Извините. Ошибка при записи строк служебной записки."
 
 s ok=NoteObj.%Save()
 
 s result=NoteObj.%Id()
 
 //если всё хорошо, то гасим акты и вернём ID служ. записки
 if +ok d  q result
 . s actid="" f  s actid=$O(glob(actid)) q:actid=""  d
 . . s DocObj = ##class(Docs.Act).%OpenId(docid)
 . . q:'$ISOBJECT(DocObj)
 . . s DocObj.Paid=1
 . . s DocObj.PaidDate=+$H
 . . s DocObj.PaidTime=$P($H,",",2)
 . . s DocObj.PaidUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 . . s DocObj.Comment=DocObj.Comment_" "_Comment
 . . s ok=DocObj.%Save()
 . . if '+ok d
 . . . $$$WriteObjError(ok)
 . . . if +result s result=""	//если произошла ошибка то стираем номер записки из переменной которая вернётся пользователю
 . . . s result=result_"Ошибка при гашении акта "_DocObj.Name_", "

 $$$WriteObjError(ok)
 q "Извините, ошибка при формировании служебной записки."
CreateActNoteErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при формировании служебной записки."
]]></Implementation>
</Method>

<Method name="isDocCreditOrDebet">
<Description>
Проверить документ - кредит или дебет
credit - кредит, debet - дебет</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s $ZT="isDocCreditOrDebetErr"
	
	s (result,DocClass)=""
	
	//если объект, то из объекта, иначе по SQL запросу
	if $ISOBJECT(DocId)
	{
		if $ISOBJECT(DocId.DocumentClass)
		{
			s DocClass=DocId.DocumentClass.%Id()
		}
	}
	else
	{
		&sql(select DocumentClass into :DocClass from Docs.Super where ID=:DocId)
		if SQLCODE s DocClass=""
	}
	
	
	
	if DocClass="Docs.Rash" s result="credit"
	
	
	
	q result
isDocCreditOrDebetErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при проверке документа (кредит или дебет)."
]]></Implementation>
</Method>

<Method name="MakeRashFromOthet">
<Description>
Сделать расходную накладную на основе отчёта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>OtchetID:%String</FormalSpec>
<ReturnType>Docs.Rash</ReturnType>
<Implementation><![CDATA[
	s docobj = ##class(Docs.Otchet).%OpenId(OtchetID)
	if '$ISOBJECT(docobj) q ""
	
	s docrash = ##class(Docs.Rash).%New()
	s docrash.Name = $P(docobj.Name,"\",2)_"-"_$P(docobj.Name,"\",1)_" "_docobj.Kontr.Code
	s docrash.Kontr = docobj.Kontr
	
	s i=""
	s ok=1
 	for  s i=docobj.Items.Next(i) q:(i="")!('+ok)  d
 	. s Item=docobj.Items.GetAt(i)
 	. q:'$ISOBJECT(Item)
 	. q:Item.StringType'=1	
 	. s newitem = ##class(Docs.RashItems).%New()
 	. s newitem.Goods = Item.Goods
 	. d newitem.DocTypeSetObjectId("Docs.Rash")
 	. s newitem.Doc = docrash
 	. s newitem.Quantity = Item.Quantity
 	. d docrash.Items.Insert(newitem)
 	
 	s ok = docrash.%Save()
 	if '+ok $$$WriteObjError(ok) q "Извините, ошибка при генерации накладной."
 	
 	q docrash.%Id()
]]></Implementation>
</Method>
</Class>


<Class name="Docs.ActItems">
<Description>
Заявки, запчасти на основании которых был выписан акт</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>61508,51385.800655</TimeCreated>

<Property name="Request">
<Description>
Заявка</Description>
<Type>Operation.Instructions</Type>
</Property>

<Property name="RequestItem">
<Description>
Заявка</Description>
<Type>Operation.InstructionsItems</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>ActItemsDefaultData</DefaultData>
<Data name="ActItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"ActItems"</Subscript>
<Value name="1">
<Value>Request</Value>
</Value>
<Value name="2">
<Value>RequestItems</Value>
</Value>
<Value name="3">
<Value>RequestItem</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.ActNote">
<Description>
Служебная записка на погашение актов</Description>
<Super>Docs.Super</Super>
<TimeCreated>61623,56813.354029</TimeCreated>

<Property name="PaymentPoluh">
<Description>
Получатель платежа</Description>
<Type>Common.Kontragent</Type>
</Property>

<Property name="Manager">
<Description>
Менеджер</Description>
<Type>%String</Type>
</Property>

<Property name="Chief">
<Description>
Начальник</Description>
<Type>Users.Dates</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>ActNoteDefaultData</DefaultData>
<Data name="ActNoteDefaultData">
<Structure>listnode</Structure>
<Subscript>"ActNote"</Subscript>
<Value name="1">
<Value>Act</Value>
</Value>
<Value name="2">
<Value>Poluh</Value>
</Value>
<Value name="3">
<Value>PaymentPoluh</Value>
</Value>
<Value name="4">
<Value>Chief</Value>
</Value>
<Value name="5">
<Value>Manager</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.ActNoteItems">
<Description>
Строки служебной записки на погашение актов</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>61623,56517.272486</TimeCreated>

<Property name="Act">
<Description>
Акт</Description>
<Type>Docs.Act</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>ActNoteItemsDefaultData</DefaultData>
<Data name="ActNoteItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"ActNoteItems"</Subscript>
<Value name="1">
<Value>Act</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Brakremont">
<Description>
Передача брака в ремонтную</Description>
<Super>Docs.Super</Super>
<TimeCreated>60963,3302.980515</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Docs.BrakremontItems">
<Description>
Строки документа передачи брака в ремонт</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>60963,5427.352001</TimeCreated>

<Property name="Brak">
<Description>
ID в хранилище брака</Description>
<Type>Store.Brak</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="BrakInd">
<Properties>Brak</Properties>
</Index>

<Property name="addr">
<Description>
Место</Description>
<Type>Store.Address</Type>
</Property>

<Index name="addrInd">
<Properties>addr</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>BrakremontItemsDefaultData</DefaultData>
<Data name="BrakremontItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"BrakremontItems"</Subscript>
<Value name="1">
<Value>StoreBrak</Value>
</Value>
<Value name="2">
<Value>addr</Value>
</Value>
<Value name="3">
<Value>Brak</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.BrandPlatej">
<Description>
Платежи разбитые по брендам</Description>
<Super>%Persistent</Super>
<TimeCreated>61720,54706.239143</TimeCreated>

<Property name="Doc">
<Description>
Документ</Description>
<Type>Docs.Platejka</Type>
</Property>

<Index name="DocInd">
<Properties>Doc</Properties>
</Index>

<Property name="Brand">
<Description>
Бренд</Description>
<Type>Common.Dictionary19</Type>
</Property>

<Index name="BrandInd">
<Properties>Brand</Properties>
</Index>

<Property name="RubSumma">
<Description>
Сумма в рублях</Description>
<Type>%Numeric</Type>
</Property>

<Property name="CurrSumma">
<Description>
Сумма в валюте</Description>
<Type>%Numeric</Type>
</Property>

<Index name="NewIndex1">
<Properties>Doc,Brand</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.BrandPlatejD</DataLocation>
<DefaultData>BrandPlatejDefaultData</DefaultData>
<IdLocation>^Docs.BrandPlatejD</IdLocation>
<IndexLocation>^Docs.BrandPlatejI</IndexLocation>
<StreamLocation>^Docs.BrandPlatejS</StreamLocation>
<Data name="BrandPlatejDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Brand</Value>
</Value>
<Value name="3">
<Value>CurrSumma</Value>
</Value>
<Value name="4">
<Value>Doc</Value>
</Value>
<Value name="5">
<Value>RubSumma</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Chet">
<Description>
</Description>
<Super>Docs.Super</Super>
<TimeCreated>60422,81959.827587</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Docs.ChetItems">
<Description>
</Description>
<TimeCreated>60422,81991.224017</TimeCreated>
</Class>


<Class name="Docs.Diff">
<Description>
</Description>
<Super>Docs.Super</Super>
<TimeCreated>60395,29673.088262</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Docs.DiffItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60395,29896.231654</TimeCreated>

<Property name="Kolfact">
<Description>
Количество по документу</Description>
<Type>%Numeric</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>DiffItemsDefaultData</DefaultData>
<Data name="DiffItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"DiffItems"</Subscript>
<Value name="1">
<Value>Kolfact</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.DocBrak">
<Super>Docs.Super</Super>
<TimeCreated>60520,61871.881598</TimeCreated>

<Property name="datpriem">
<Description>
Дата приема</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="datpriemInd">
<Properties>datpriem</Properties>
</Index>

<Property name="datend">
<Description>
Дата завершения</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="datendInd">
<Properties>datend</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>DocBrakDefaultData</DefaultData>
<Data name="DocBrakDefaultData">
<Structure>listnode</Structure>
<Subscript>"DocBrak"</Subscript>
<Value name="1">
<Value>datend</Value>
</Value>
<Value name="2">
<Value>datpriem</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.DocBrakItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60520,61965.645477</TimeCreated>

<Property name="result">
<Description>
Результат</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=", ,принят,передан в мастерскую,списано,передано на склад ГП,утерян,не получено,расформировано на зч"/>
<Parameter name="VALUELIST" value=",1,2,3,4,5,6,7,8"/>
</Property>

<Index name="resultind">
<Properties>result</Properties>
</Index>

<Property name="PlanQuant">
<Description>
Планируемое количество</Description>
<Type>%Numeric</Type>
</Property>

<Index name="PlanQuantInd">
<Properties>PlanQuant</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>DocBrakItemsDefaultData</DefaultData>
<Data name="DocBrakItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"DocBrakItems"</Subscript>
<Value name="1">
<Value>result</Value>
</Value>
<Value name="2">
<Value>PlanQuant</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.DocItems">
<Description>
Записи в документах</Description>
<Super>%Persistent</Super>
<TimeCreated>60361,60730.914637</TimeCreated>

<Property name="Doc">
<Description>
Номер документа</Description>
<Type>Docs.Super</Type>
<Cardinality>one</Cardinality>
<Inverse>Items</Inverse>
<Relationship>1</Relationship>
</Property>

<Index name="DocInd">
<Properties>Doc</Properties>
</Index>

<Property name="DocType">
<Description>
Тип документа</Description>
<Type>Docs.Docs</Type>
<Required>1</Required>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="DocTypeInd">
<Properties>DocType</Properties>
</Index>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Required>1</Required>
</Property>

<Index name="GInd">
<Properties>Goods</Properties>
</Index>

<Property name="Quantity">
<Description>
Количество</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Price">
<Description>
Цена</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Total">
<Description>
Сумма</Description>
<Type>%Numeric</Type>
</Property>

<Property name="kurs">
<Description>
Курс валюты</Description>
<Type>%Numeric</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="ChangeDate">
<Description>
Дата закрытия</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="ChangeDateInd">
<Properties>ChangeDate</Properties>
</Index>

<Property name="ChangeTime">
<Description>
Время закрытия</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeTimeInd">
<Properties>ChangeTime</Properties>
</Index>

<Property name="ChangeUser">
<Description>
Человек закрывший</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeUserInd">
<Properties>ChangeUser</Properties>
</Index>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>PropertyName:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnBeforeSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 n ChangeUser
 s %this.ChangeDate=+$H
 s %this.ChangeTime=$P($H,",",2)
 s ChangeUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 d:ChangeUser %this.ChangeUserSetObjectId(ChangeUser)
 Quit $$$OK
]]></Implementation>
</Method>

<Trigger name="OnUpdate">
<Code> s obj=##class(Docs.DocItems).%OpenId({ID})
 s obj.ChangeTime=1
 d obj.%Save()</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.DocItemsD</DataLocation>
<DefaultData>DocItemsDefaultData</DefaultData>
<IdLocation>^Docs.DocItemsD</IdLocation>
<IndexLocation>^Docs.DocItemsI</IndexLocation>
<StreamLocation>^Docs.DocItemsS</StreamLocation>
<Data name="DocItemsDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Doc</Value>
</Value>
<Value name="3">
<Value>Goods</Value>
</Value>
<Value name="4">
<Value>Quantity</Value>
</Value>
<Value name="5">
<Value>DocType</Value>
</Value>
<Value name="6">
<Value>Price</Value>
</Value>
<Value name="7">
<Value>Total</Value>
</Value>
<Value name="8">
<Value>Totalka</Value>
</Value>
<Value name="9">
<Value>Totalh</Value>
</Value>
<Value name="10">
<Value>Dattka</Value>
</Value>
<Value name="11">
<Value>dopperc</Value>
</Value>
<Value name="12">
<Value>kurs</Value>
</Value>
<Value name="13">
<Value>ChangeDate</Value>
</Value>
<Value name="14">
<Value>ChangeTime</Value>
</Value>
<Value name="15">
<Value>ChangeUser</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Docs">
<Super>%Persistent</Super>
<TimeCreated>60360,82943.788788</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="Cl">
<Description>
Имя класса</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="OperType">
<Description>
Тип Операции</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ClIndex">
<IdKey>1</IdKey>
<Properties>Cl</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.DocsD</DataLocation>
<DefaultData>DocsDefaultData</DefaultData>
<IdLocation>^Docs.DocsD</IdLocation>
<IndexLocation>^Docs.DocsI</IndexLocation>
<StreamLocation>^Docs.DocsS</StreamLocation>
<Data name="DocsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Cl</Value>
</Value>
<Value name="4">
<Value>OperType</Value>
</Value>
</Data>
<Property name="Cl"/>
<Property name="Name"/>
<Property name="OperType"/>
</Storage>
</Class>


<Class name="Docs.Inner">
<Description>
Накладная на внутреннее перемещение</Description>
<Super>Docs.Super</Super>
<TimeCreated>60395,4624.855524</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Docs.InnerDiff">
<Super>Docs.Super</Super>
<TimeCreated>60398,65473.066023</TimeCreated>

<Property name="storeman">
<Description>
Грузчик</Description>
<Type>Common.Dictionary5</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InnerDiffDefaultData</DefaultData>
<Data name="InnerDiffDefaultData">
<Structure>listnode</Structure>
<Subscript>"InnerDiff"</Subscript>
<Value name="1">
<Value>storeman</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.InnerDiffItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60398,65468.298027</TimeCreated>

<Property name="addr">
<Description>
Адрес</Description>
<Type>Store.Address</Type>
</Property>

<Property name="quantdefault">
<Description>
Количество по накладной</Description>
<Type>%Numeric</Type>
</Property>

<Property name="quantreal">
<Description>
Количество фактическое</Description>
<Type>%Numeric</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InnerDiffItemsDefaultData</DefaultData>
<Data name="InnerDiffItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"InnerDiffItems"</Subscript>
<Value name="1">
<Value>storeman</Value>
</Value>
<Value name="2">
<Value>addr</Value>
</Value>
<Value name="3">
<Value>quantdefault</Value>
</Value>
<Value name="4">
<Value>quantreal</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.InnerItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60395,4693.327331</TimeCreated>

<Property name="addr2">
<Description>
Текущее место </Description>
<Type>Store.Address</Type>
</Property>

<Property name="addr">
<Description>
Место назначения</Description>
<Type>Store.Address</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InnerItemsDefaultData</DefaultData>
<Data name="InnerItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"InnerItems"</Subscript>
<Value name="1">
<Value>addr2</Value>
</Value>
<Value name="2">
<Value>addr</Value>
</Value>
</Data>
<Property name="Doc"/>
<Property name="DocType"/>
<Property name="Goods"/>
<Property name="Price"/>
<Property name="Quantity"/>
<Property name="Total"/>
<Property name="addr"/>
<Property name="addr2"/>
</Storage>
</Class>


<Class name="Docs.Invent">
<Super>Docs.Super</Super>
<TimeCreated>60394,67472.101696</TimeCreated>

<Property name="Address">
<Description>
Блокировка адреса</Description>
<Type>Store.Address</Type>
</Property>

<Index name="AddressInd">
<Properties>Address</Properties>
</Index>

<Property name="FullName">
<Description>
Блокировка адреса</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}= ##class(Store.Action).AddressPath({Address})</SqlComputeCode>
<SqlComputed>1</SqlComputed>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InventDefaultData</DefaultData>
<Data name="InventDefaultData">
<Structure>listnode</Structure>
<Subscript>"Invent"</Subscript>
<Value name="1">
<Value>Address</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.InventItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60394,67500.325007</TimeCreated>

<Property name="quantplan">
<Description>
Количество по плану</Description>
<Type>%Numeric</Type>
</Property>

<Index name="quantplanind">
<Properties>quantplan</Properties>
</Index>

<Property name="addr">
<Description>
Ячейка</Description>
<Type>Store.Address</Type>
</Property>

<Index name="addrind">
<Properties>addr</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InventItemsDefaultData</DefaultData>
<Data name="InventItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"InventItems"</Subscript>
<Value name="1">
<Value>addr</Value>
</Value>
<Value name="2">
<Value>quantplan</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Otchet">
<Super>Docs.Super</Super>
<TimeCreated>60393,39985.442538</TimeCreated>

<Property name="Stat">
<Description>
Статус</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Создан,Обработан и принят,Отчёт не принят"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Index name="StatInd2">
<Properties>Stat</Properties>
</Index>

<Property name="ErrorDescription">
<Description>
Ответ контрагенту</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2000"/>
</Property>

<Property name="SummaCurrency">
<Description>
Сумма в валюте</Description>
<Type>%Numeric</Type>
</Property>

<Property name="NameSorted">
<Description>
Номер пригодный для сортировки</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}=$P({Name},"\",2)_$TR($J($P({Name},"\",1),2)," ",0)</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value="display:none,"/>
</Property>

<Property name="Kurs">
<Description>
Курс валюты</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="display:none,"/>
</Property>

<Property name="Rem">
<Description>
Заявка</Description>
<Type>Docs.Remont</Type>
</Property>

<Property name="Errors">
<Description>
Ошибки отчёта</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="GotPaperProve">
<Description>
Бумажный отчёт проверен</Description>
<Type>%String</Type>
<InitialExpression>0</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Нет,Да"/>
<Parameter name="VALUELIST" value=",0,1"/>
</Property>

<Property name="DatePaperProve">
<Description>
Дата проверки бумажного отчёта</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=readonly"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="UserPaperProve">
<Description>
Оператор проверивший бумажный отчёт</Description>
<Type>Users.Dates</Type>
</Property>

<Property name="Sluzap">
<Description>
Служебная записка</Description>
<Type>Sluzap</Type>
</Property>

<Index name="SluzapInd">
<Properties>Sluzap</Properties>
</Index>

<Property name="MOVersion">
<Description>
Версия софта отправившего документ</Description>
</Property>

<Method name="GetOtchetDat">
<Description>
Вернуть дату отчёта</Description>
<Implementation><![CDATA[ q %this.Dat
]]></Implementation>
</Method>

<Method name="SetOthcetStatFailed">
<Description>
Поставить отчёту статус "Отчёт не принят"</Description>
<FormalSpec>Description:%String=""</FormalSpec>
<Implementation><![CDATA[
 s %this.Stat=3
 if Description'="" s ..ErrorDescription=Description
 q
]]></Implementation>
</Method>

<Method name="SetOthcetStatFailed2">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Description:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s obj=..%OpenId(ID)
 q:'$ISOBJECT(obj) "Невозможно изменить статус отчёта, так как не указан отчёт."
 d obj.SetOthcetStatFailed(Description)
 s ok=obj.%Save()
 if '+ok $$$WriteObjError(ok) q "Извините, ошибка при сохранении отчёта."
 q 1
]]></Implementation>
</Method>

<Method name="SetOthcetStatAccepted">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID="" "Невозможно изменить статус отчёта, так как не указан ID отчёта."
 if $ISOBJECT(ID) s obj=ID
 e  s obj=..%OpenId(ID)
 q:'$ISOBJECT(obj) "Невозможно изменить статус отчёта, так как невозможно найти информацию по отчёту."
 s obj.Stat=2
 s DocId=obj.%Id()
 s KontrId=obj.Kontr.%Id()
 s DocName=obj.Name
 &sql(delete from Docs.OtchetItems where doc->Kontr=:KontrId and doc->Name=:DocName and doc<>:DocId)
 if SQLCODE<0 q "Ошибка при удалении строк предыдущих отчётов этого клиента за этот период."
 &sql(delete from Docs.Otchet where Kontr=:KontrId and Name=:DocName and ID<>:DocId)
 if SQLCODE<0 q "Ошибка при удалении предыдущих отчётов этого клиента за этот период."
 s ok=##class(Docs.Action).SetFinal(obj)
 q ok
]]></Implementation>
</Method>

<Method name="SetParerProve">
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s $ZT="SetParerProveErr"
	s CurrentDate = +$H
	s CurrentUserId = $S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
	if '+DocId q "Не указан ID отчёта"
	&sql(update Docs.Otchet 
		(GotPaperProve,DatePaperProve,UserPaperProve) 
		Values
		(1,:CurrentDate,:CurrentUserId)
		WHERE ID=:DocId)
	if SQLCODE q "Извините. Ошибка. SQLCODE="_SQLCODE
	q 1
SetParerProveErr
 $$$WriteError($ZE)
 q "Извините. Произошла внутренняя ошибка."
]]></Implementation>
</Method>

<Method name="CreatePaperOthet">
<ClassMethod>1</ClassMethod>
<FormalSpec>KontrId,Name,Summa,Comment,SummaCurrency</FormalSpec>
<Implementation><![CDATA[
	s $ZT="CreatePaperOthetErr"
	if '+KontrId q "Не указан контрагент."
	if '+Summa,'+SummaCurrency q "Укажите рублёвую сумму или сумму в валюте."
	if '+Summa,SummaCurrency s Summa=$J(SummaCurrency*##class(Goods.GoodsAction).kurs(),"",2)
	if Name'?1.2N1"\"4N q "Дата отчёта должна быть в формате ММ\ГГГГ"
	s Doc=##class(Docs.Otchet).%New()
	s Doc.Summa=$TR(Summa,",",".")
	do Doc.KontrSetObjectId(KontrId)
	s Doc.Name=Name
	s Doc.Stat=1
	s Doc.SummaCurrency=$TR(SummaCurrency,",",".")
	s Doc.Comment=$G(Comment)
	//s Doc.GotPaperProve=1
	//d ##class(Docs.Action).SetFinal(Doc)
	s ok=Doc.%Save()
	if '+ok $$$WriteObjError(ok) q "Извините. Ошибка при сохранении отчёта."
	q 1
CreatePaperOthetErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при сохранении отчёта."
]]></Implementation>
</Method>

<Method name="Brand">
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s MM=$$$TunesVariableGlobal("MM")	//список аббревиатур мастермакс через запятую
 	s VC=$$$TunesVariableGlobal("VC")
 	s TL=$$$TunesVariableGlobal("TL")
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>OtchetDefaultData</DefaultData>
<Data name="OtchetDefaultData">
<Structure>listnode</Structure>
<Subscript>"Otchet"</Subscript>
<Value name="1">
<Value>Rem</Value>
</Value>
<Value name="2">
<Value>Errors</Value>
</Value>
<Value name="3">
<Value>ErrorDescription</Value>
</Value>
<Value name="4">
<Value>GotPaperProve</Value>
</Value>
<Value name="5">
<Value>SummaCurrency</Value>
</Value>
<Value name="6">
<Value>Kurs</Value>
</Value>
<Value name="7">
<Value>DatePaperProve</Value>
</Value>
<Value name="8">
<Value>UserPaperProve</Value>
</Value>
<Value name="9">
<Value>ProvementDate</Value>
</Value>
<Value name="10">
<Value>Sluzap</Value>
</Value>
<Value name="11">
<Value>MOVersion</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.OtchetItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60392,65765.800838</TimeCreated>

<Property name="goodssource">
<Description>
Источник товара</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Склад,Покупка"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="serial">
<Description>
Серийный номер</Description>
<Type>%String</Type>
</Property>

<Property name="garant">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
</Property>

<Method name="HasGarant">
<Description><![CDATA[
Проверяет наличие в данных записей с указаным гарантийным талоном
Необходим для проверки перед удалением гарантийного талона 
<class>Common.Dictionary2</class> из базы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>garantId:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	#; Переделать на прямой доступ к индексной глобали
	&sql(Select Top 1 ID Into :id From Docs.OtchetItems Where garant=:garantId)
	Q (SQLCODE'=100)
]]></Implementation>
</Method>

<Property name="talon">
<Description>
Отрывной талон</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",,A,B,C,Предпрод."/>
<Parameter name="VALUELIST" value=",0,1,2,3,4"/>
</Property>

<Property name="Dat">
<Description>
Дата</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatInd">
<Properties>Dat</Properties>
</Index>

<Property name="Comment">
<Description>
Примечание</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="500"/>
</Property>

<Property name="RemType">
<Description>
Тип ремонта</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Ремонт,Акт (Электроинструмент),Диагностика (Электроинструмент),Акт (Бытовая техника),Диагностика (Бытовая техника),Не указано"/>
<Parameter name="VALUELIST" value=",0,1,2,3,4,-1"/>
</Property>

<Index name="RemTypeInd">
<Properties>RemType</Properties>
</Index>

<Property name="StringType">
<Description>
Тип строки</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="DISPLAYLIST" value=",Ремонт,Отчёт за деталь"/>
<Parameter name="VALUELIST" value=",0,1"/>
</Property>

<Index name="StringTypeInd">
<Properties>StringType</Properties>
</Index>

<Property name="remcost">
<Description>
Стоимость ремонта</Description>
<Type>%String</Type>
</Property>

<Property name="RemTovar">
<Description>
Ремонтируемый товар</Description>
<Type>Goods.Goods</Type>
</Property>

<Index name="RemTovarInd">
<Properties>RemTovar</Properties>
</Index>

<Property name="Groups">
<Description>
Группировка моделей и деталей принадлежащих им</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="ActNumber">
<Description>
Номер акта</Description>
<Type>%String</Type>
</Property>

<Property name="SummaRub">
<Description>
Рублёвая стоимость</Description>
<Type>%String</Type>
</Property>

<Property name="Currency">
<Description>
Валюта в которой считали</Description>
<Type>%String</Type>
</Property>

<Property name="Number">
<Description>
Номер строки</Description>
<Type>%String</Type>
</Property>

<UDLText name="T">
<Content><![CDATA[
/*
Method CalculatedStringRubSumma()
{
	s Result = ..Total
	
	if (..StringType=1)&&(..Currency="Рубли") d
	. //если строка - деталь и указана сумма в рублях
	. s Result = $J(..Quantity*..SummaRub,"",2)
	if (..StringType=1)&&(..Currency'="Рубли") d
	. //если строка - деталь и не указана сумма в рублях
	. s innerkurs=##class(Goods.GoodsAction).kurs(.w,..Doc.Dat)	//найдём курс на дату отчёта
	. s Result = $J(..Total * innerkurs,"",2)
	
	q Result
}
*/
]]></Content>
</UDLText>

<Method name="CalculatedStringRubSumma">
<Implementation><![CDATA[
	s Result = ..Total
	
	if (..StringType=1) d
	. s innerkurs=##class(Goods.GoodsAction).kurs(.w,..Doc.Dat)	//найдём курс на дату отчёта
	. s KontrCurrency=..Doc.Kontr.Currency
 	. if (..Currency="Рубли")&&(KontrCurrency=1) s Result = $J(..Quantity*..SummaRub,"",2)
 	. if (..Currency="Рубли")&&(KontrCurrency=2) s Result = $J(..Quantity*..SummaRub*(1/innerkurs),"",2)
 	. if (..Currency["Долл")&&(KontrCurrency=1) s Result = $J(..Quantity*..Price*innerkurs,"",2)
 	. if (..Currency["Долл")&&(KontrCurrency=2) s Result = $J(..Quantity*..Price,"",2)
	
	q Result
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>OtchetItemsDefaultData</DefaultData>
<Data name="OtchetItemsDefaultData">
<Subscript>"OtchetItems"</Subscript>
<Value name="1">
<Value>goodssource</Value>
</Value>
<Value name="2">
<Value>serial</Value>
</Value>
<Value name="3">
<Value>remcost</Value>
</Value>
<Value name="4">
<Value>garant</Value>
</Value>
<Value name="5">
<Value>talon</Value>
</Value>
<Value name="6">
<Value>RemTovar</Value>
</Value>
<Value name="7">
<Value>Dat</Value>
</Value>
<Value name="8">
<Value>Comment</Value>
</Value>
<Value name="9">
<Value>RemType</Value>
</Value>
<Value name="10">
<Value>StringType</Value>
</Value>
<Value name="11">
<Value>Groups</Value>
</Value>
<Value name="12">
<Value>ActNumber</Value>
</Value>
<Value name="13">
<Value>SummaRub</Value>
</Value>
<Value name="14">
<Value>Currency</Value>
</Value>
<Value name="15">
<Value>Number</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.OtchetNote">
<Description>
Служебная записка о гарантийном ремонте</Description>
<Super>Docs.Super</Super>
<TimeCreated>62303,85794.764203</TimeCreated>

<Property name="Manager">
<Description>
Менеджер</Description>
<Type>%String</Type>
</Property>

<Property name="Otchet">
<Description>
Отчёт</Description>
<Type>Docs.Otchet</Type>
</Property>

<Property name="OurCompany">
<Description>
Наше юр лицо</Description>
<Type>Common.Kontragent</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>OtchetNoteDefaultData</DefaultData>
<Data name="OtchetNoteDefaultData">
<Structure>listnode</Structure>
<Subscript>"OtchetNote"</Subscript>
<Value name="1">
<Value>Manager</Value>
</Value>
<Value name="2">
<Value>Otchet</Value>
</Value>
<Value name="3">
<Value>OurCompany</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.OtchetNoteItems">
<Super>Docs.DocItems</Super>
<TimeCreated>62304,37.027896</TimeCreated>

<Property name="Brand">
<Description>
Бренд</Description>
<Type>Common.Dictionary19</Type>
</Property>

<Property name="Period">
<Description>
Период</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>OtchetNoteItemsDefaultData</DefaultData>
<Data name="OtchetNoteItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"OtchetNoteItems"</Subscript>
<Value name="1">
<Value>Brand</Value>
</Value>
<Value name="2">
<Value>Period</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Platejka">
<Super>Docs.Super</Super>
<TimeCreated>60456,54011.254885</TimeCreated>

<Property name="Poluh">
<Description>
Получатель</Description>
<Type>Common.Kontragent</Type>
<InitialExpression>$$$TunesVariableGlobal("DefaultPoluh")</InitialExpression>
</Property>

<Index name="PoluhInd">
<Properties>Poluh</Properties>
</Index>

<Property name="Typeplatej">
<Description>
Тип платежа</Description>
<Type>Common.Dictionary13</Type>
<InitialExpression>$$$TunesVariableGlobal("DefaultPlatejType")</InitialExpression>
</Property>

<Index name="TypeplatejInd">
<Properties>Typeplatej</Properties>
</Index>

<Property name="PlatejkaItems">
<Description>
Строки платёжки - расходные документы и суммы на них</Description>
<Type>Docs.PlatejkaItems</Type>
<Cardinality>many</Cardinality>
<Inverse>Doc</Inverse>
<Relationship>1</Relationship>
</Property>

<Property name="RubSumma">
<Description>
Рублёвая сумма</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Kurs">
<Description>
Курс</Description>
<Type>%Numeric</Type>
</Property>

<Property name="ViconteSummRub">
<Description>
Сумма Viconte в рублях</Description>
<Type>%Numeric</Type>
</Property>

<Property name="ViconteSummCurr">
<Description>
Сумма Viconte в валюте</Description>
<Type>%Numeric</Type>
</Property>

<Property name="MastermaxSummRub">
<Description>
Сумма Mastermax в рублях</Description>
<Type>%Numeric</Type>
</Property>

<Property name="MastermaxSummCurr">
<Description>
Сумма Mastermax в валюте</Description>
<Type>%Numeric</Type>
</Property>

<Property name="TullSummRub">
<Description>
Сумма Tull в рублях</Description>
<Type>%Numeric</Type>
</Property>

<Property name="TullSummCurr">
<Description>
Сумма Tull в валюте</Description>
<Type>%Numeric</Type>
</Property>

<Property name="PlatejDate">
<Description>
Дата платёжного поручения</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
</Property>

<Index name="PlatejDate">
<Properties>PlatejDate</Properties>
</Index>

<Property name="ActNumber">
<Description>
Акт выполненных работ</Description>
<Type>%String</Type>
</Property>

<Property name="ActDate">
<Description>
Дата акта выполненных работ</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="InvoiceNumber">
<Description>
Номер счёта</Description>
<Type>%String</Type>
</Property>

<Property name="InvoiceDate">
<Description>
Дата счёта</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Method name="GetFreeSumma">
<Description>
Вернуть неизрасходованную сумму, т.е. сумму которую ещё не разнесли по расходным накладным</Description>
<Implementation><![CDATA[
	
 s next="" f  s next=%this.PlatejkaItems.Next(next) q:next=""  d
 . s item=%this.PlatejkaItems.GetAt(next)
 . q:'$ISOBJECT(item)
 . s OplSumma=$G(OplSumma)+item.Summa
 q %this.Summa-$G(OplSumma)
 
 /*
 s DocId=%this.%Id()
 &sql(Select SUM(OplSumma) into :OplSumma from Docs.Rash where Platej=:DocId)
 i SQLCODE s OplSumma=0
 q %this.Summa-OplSumma
 */
]]></Implementation>
</Method>

<Method name="GetRashSumma">
<Description>
Вернуть сумму зачисленную на расходные накладные, т.е. сумму которую уже разнесли по расходным накладным</Description>
<Implementation><![CDATA[
 s DocId=%this.%Id()
 &sql(Select SUM(OplSumma) into :OplSumma from Docs.Rash where Platej=:DocId)
 i SQLCODE s OplSumma=0
 q OplSumma
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>PlatejkaDefaultData</DefaultData>
<Data name="PlatejkaDefaultData">
<Structure>listnode</Structure>
<Subscript>"Platejka"</Subscript>
<Value name="1">
<Value>Plat</Value>
</Value>
<Value name="2">
<Value>Poluh</Value>
</Value>
<Value name="3">
<Value>Typeplatej</Value>
</Value>
<Value name="4">
<Value>Rash</Value>
</Value>
<Value name="5">
<Value>RubSumma</Value>
</Value>
<Value name="6">
<Value>Kurs</Value>
</Value>
<Value name="7">
<Value>VCSummRub</Value>
</Value>
<Value name="8">
<Value>VCSummCurr</Value>
</Value>
<Value name="9">
<Value>MMSummRub</Value>
</Value>
<Value name="10">
<Value>MMSummCurr</Value>
</Value>
<Value name="11">
<Value>TLSummRub</Value>
</Value>
<Value name="12">
<Value>TLSummCurr</Value>
</Value>
<Value name="13">
<Value>ViconteSummRub</Value>
</Value>
<Value name="14">
<Value>ViconteSummCurr</Value>
</Value>
<Value name="15">
<Value>MastermaxSummRub</Value>
</Value>
<Value name="16">
<Value>MastermaxSummCurr</Value>
</Value>
<Value name="17">
<Value>TullSummRub</Value>
</Value>
<Value name="18">
<Value>TullSummCurr</Value>
</Value>
<Value name="19">
<Value>PlatejDate</Value>
</Value>
<Value name="20">
<Value>ActDate</Value>
</Value>
<Value name="21">
<Value>ActNumber</Value>
</Value>
<Value name="22">
<Value>InvoiceDate</Value>
</Value>
<Value name="23">
<Value>InvoiceNumber</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.PlatejkaItems">
<Description>
Строки платёжного поручения</Description>
<Super>%Persistent</Super>
<TimeCreated>60967,85699.67393</TimeCreated>

<Property name="Rash">
<Description>
Отгрузка</Description>
<Type>Docs.Rash</Type>
</Property>

<Index name="RashInd">
<Properties>Rash</Properties>
</Index>

<Property name="Summa">
<Description>
Cумма</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Doc">
<Type>Docs.Platejka</Type>
<Cardinality>one</Cardinality>
<Inverse>PlatejkaItems</Inverse>
<Relationship>1</Relationship>
</Property>

<Index name="DocIndex">
<Properties>Doc</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.PlatejkaItemsD</DataLocation>
<DefaultData>PlatejkaItemsDefaultData</DefaultData>
<IdLocation>^Docs.PlatejkaItemsD</IdLocation>
<IndexLocation>^Docs.PlatejkaItemsI</IndexLocation>
<StreamLocation>^Docs.PlatejkaItemsS</StreamLocation>
<Data name="PlatejkaItemsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Rash</Value>
</Value>
<Value name="3">
<Value>Summa</Value>
</Value>
<Value name="4">
<Value>Platejka</Value>
</Value>
<Value name="5">
<Value>Doc</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Prih">
<Description>
Приходная накладная</Description>
<Super>Docs.Super</Super>
<TimeCreated>60363,72111.620385</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>PrihDefaultData</DefaultData>
<Data name="PrihDefaultData">
<Structure>listnode</Structure>
<Subscript>"Prih"</Subscript>
<Value name="1">
<Value>Depot</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.PrihItems">
<Description>
Строки приходной накладной</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>60365,82463.57393</TimeCreated>

<Property name="Kolfact">
<Description>
Количество по документу</Description>
<Type>%Numeric</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>PrihItemsDefaultData</DefaultData>
<Data name="PrihItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"PrihItems"</Subscript>
<Value name="1">
<Value>tt</Value>
</Value>
<Value name="2">
<Value>Kolfact</Value>
</Value>
</Data>
<Property name="Doc"/>
<Property name="DocType"/>
<Property name="Goods"/>
<Property name="Kolfact"/>
<Property name="Price"/>
<Property name="Quantity"/>
<Property name="Total"/>
</Storage>
</Class>


<Class name="Docs.PrihKassOrder">
<Super>Docs.Super</Super>
<TimeCreated>60456,54250.219379</TimeCreated>

<Property name="Poluh">
<Description>
Получатель</Description>
<Type>Common.Kontragent</Type>
</Property>

<Index name="PoluhInd">
<Properties>Poluh</Properties>
</Index>

<Property name="Reason">
<Description>
Основание</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="Typeplatej">
<Description>
Тип платежа</Description>
<Type>Common.Dictionary13</Type>
</Property>

<Index name="TypeplatejInd">
<Properties>Typeplatej</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>PrihKassOrderDefaultData</DefaultData>
<Data name="PrihKassOrderDefaultData">
<Structure>listnode</Structure>
<Subscript>"PrihKassOrder"</Subscript>
<Value name="1">
<Value>Plat</Value>
</Value>
<Value name="2">
<Value>Poluh</Value>
</Value>
<Value name="3">
<Value>Reason</Value>
</Value>
<Value name="4">
<Value>Typeplatej</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Rash">
<Description>
Расходная накладная</Description>
<Super>Docs.Super</Super>
<TimeCreated>60364,45410.412161</TimeCreated>

<Property name="opl">
<Description>
Оплата</Description>
<Type>Common.Dictionary7</Type>
</Property>

<Index name="oplind">
<Properties>opl</Properties>
</Index>

<Property name="Platej">
<Description>
Платёжный документ</Description>
<Type>Docs.Platejka</Type>
<Parameter name="CAPTION" value=",display=readonly"/>
</Property>

<Index name="PlatejInd">
<Properties>Platej</Properties>
</Index>

<Property name="OplatStatus">
<Description>
Статус оплаты</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=", ,Ожидает оплаты,Оплачено полностью,Оплачено частично"/>
<Parameter name="VALUELIST" value=",0,1,2,3"/>
</Property>

<Index name="OplatStatusInd">
<Properties>OplatStatus</Properties>
</Index>

<Property name="OplSumma">
<Description>
Оплаченная сумма</Description>
<Type>%String</Type>
</Property>

<Property name="RubSumma">
<Description>
Рублёвая сумма</Description>
<Type>%Numeric</Type>
</Property>

<Property name="kurs">
<Description>
Курс</Description>
</Property>

<Property name="SendMailLog">
<Description>
Ссылка на лог отправки</Description>
<Type>Kontragent.SendMailLog</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="SendMailLog">
<Properties>SendMailLog</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>RashDefaultData</DefaultData>
<Data name="RashDefaultData">
<Structure>listnode</Structure>
<Subscript>"Rash"</Subscript>
<Value name="1">
<Value>Depot</Value>
</Value>
<Value name="2">
<Value>opl</Value>
</Value>
<Value name="3">
<Value>OplatStatus</Value>
</Value>
<Value name="4">
<Value>OplSumma</Value>
</Value>
<Value name="5">
<Value>Platej</Value>
</Value>
<Value name="6">
<Value>RubSumma</Value>
</Value>
<Value name="7">
<Value>kurs</Value>
</Value>
<Value name="8">
<Value>SendMailLog</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.RashItems">
<Description>
Строки расходной накладной</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>60365,82534.486859</TimeCreated>

<Property name="Zakaz">
<Description>
Заказ</Description>
<Type>%Numeric</Type>
</Property>

<Property name="ZakazGoods">
<Description>
Заказанный товар</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="ZakazGoodsInd">
<Properties>ZakazGoods</Properties>
</Index>

<Property name="ZakazTim">
<Description>
Время замены</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="ZakazTimInd">
<Properties>ZakazTim</Properties>
</Index>

<Property name="ZakazDat">
<Description>
Дата замены</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",readonly"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="ZakazDatInd">
<Properties>ZakazDat</Properties>
</Index>

<Property name="ZakazUser1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="ZakazUser1Ind">
<Properties>ZakazUser1</Properties>
</Index>

<Property name="JustCreated">
<Type>%String</Type>
<Transient>1</Transient>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="serial">
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="comment">
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="500"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>RashItemsDefaultData</DefaultData>
<Data name="RashItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"RashItems"</Subscript>
<Value name="1">
<Value>Zakaz</Value>
</Value>
<Value name="2">
<Value>ZakazGoods</Value>
</Value>
<Value name="3">
<Value>Dat</Value>
</Value>
<Value name="4">
<Value>Tim</Value>
</Value>
<Value name="5">
<Value>User1</Value>
</Value>
<Value name="6">
<Value>ZakazDat</Value>
</Value>
<Value name="7">
<Value>ZakazTim</Value>
</Value>
<Value name="8">
<Value>ZakazUser1</Value>
</Value>
<Value name="9">
<Value>comment</Value>
</Value>
<Value name="10">
<Value>serial</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.RashPlatej">
<Description>
Связь платёжки и расходной</Description>
<Super>%Persistent</Super>
<TimeCreated>62303,45162.091378</TimeCreated>

<Property name="Rash">
<Description>
Расходная накладная</Description>
<Type>Docs.Rash</Type>
<Required>1</Required>
</Property>

<Index name="Rash">
<Properties>Rash</Properties>
</Index>

<Property name="Platej">
<Description>
Платёжка</Description>
<Type>Docs.Platejka</Type>
<Required>1</Required>
</Property>

<Index name="Platej">
<Properties>Platej</Properties>
</Index>

<Property name="Summa">
<Description>
Сумма</Description>
</Property>

<Property name="NewProperty1">
<Type>%String</Type>
<Required>1</Required>
</Property>

<Index name="NewIndex1">
<IdKey>1</IdKey>
<PrimaryKey>1</PrimaryKey>
<Properties>NewProperty1</Properties>
<Unique>1</Unique>
</Index>

<Method name="%OnBeforeSave">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%Save</METHOD> method to 
provide notification that the object is being saved. It is called before 
any data is written to disk.

<P><VAR>insert</VAR> will be set to 1 if this object is being saved for the first time.

<P>If this method returns an error then the call to <METHOD>%Save</METHOD> will fail.]]></Description>
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s:$ISOBJECT(##this.Rash) RashId = ##this.Rash.%Id()
	s:$ISOBJECT(##this.Platej) PlatejId = ##this.Platej.%Id()
	
	s ##this.NewProperty1 = RashId_"||"_PlatejId
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.RashPlatejD</DataLocation>
<DefaultData>RashPlatejDefaultData</DefaultData>
<IdLocation>^Docs.RashPlatejD</IdLocation>
<IndexLocation>^Docs.RashPlatejI</IndexLocation>
<StreamLocation>^Docs.RashPlatejS</StreamLocation>
<Data name="RashPlatejDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Platej</Value>
</Value>
<Value name="3">
<Value>Rash</Value>
</Value>
<Value name="4">
<Value>Summa</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Remont">
<Description>
Ремонт</Description>
<Super>Docs.Super</Super>
<TimeCreated>60386,52074.329565</TimeCreated>

<Property name="Otchet">
<Description>
Отчёт</Description>
<Type>Docs.Otchet</Type>
</Property>

<Property name="Oplacheno">
<Description>
Оплачено</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Оплачено,Не оплачено"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>RemontDefaultData</DefaultData>
<Data name="RemontDefaultData">
<Structure>listnode</Structure>
<Subscript>"Remont"</Subscript>
<Value name="1">
<Value>Oplacheno</Value>
</Value>
<Value name="2">
<Value>Oplata</Value>
</Value>
<Value name="3">
<Value>Otchet</Value>
</Value>
<Value name="4">
<Value>Client</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.RemontItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60386,52123.380286</TimeCreated>

<Property name="garant">
<Description>
№ Гарантийного талона</Description>
<Type>%String</Type>
</Property>

<Index name="NewIndex1">
<Properties>garant</Properties>
</Index>

<Property name="serial">
<Description>
Серийный номер</Description>
<Type>%String</Type>
</Property>

<Property name="seller">
<Description>
Организация продавшая товар</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="Name">
<Description>
Описание поломки</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>RemontItemsDefaultData</DefaultData>
<Data name="RemontItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"RemontItems"</Subscript>
<Value name="1">
<Value>garant</Value>
</Value>
<Value name="2">
<Value>seller</Value>
</Value>
<Value name="3">
<Value>NewProperty1</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>serial</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Sluzap">
<Description>
Служебная записка</Description>
<Super>Docs.Super</Super>
<TimeCreated>62633,42957.928644</TimeCreated>

<Method name="IsKontrInDoc">
<Description>
отвечает на вопрос - есть ли этот контрагент в этом документе</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocId:%String,KontrId:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	&sql(Select ID from Docs.SluzapItems where Doc=:DocId and Kontr=:KontrId)
	
	if SQLCODE q 0
	else  q 1
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Docs.SluzapItems">
<Description>
Строки служебной записки</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>62633,43094.971403</TimeCreated>

<Property name="Otchet">
<Description>
Отчёт</Description>
<Type>Docs.Otchet</Type>
</Property>

<Index name="OtchetInd">
<Properties>Otchet</Properties>
</Index>

<Property name="SchetNum">
<Description>
Счёт</Description>
<Type>%String</Type>
</Property>

<Index name="SchetNumInd">
<Properties>SchetNum</Properties>
</Index>

<Property name="Kontr">
<Description>
Контрагент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Index name="KontrInd">
<Properties>Kontr</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>SluzapItemsDefaultData</DefaultData>
<Data name="SluzapItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"SluzapItems"</Subscript>
<Value name="1">
<Value>Kontr</Value>
</Value>
<Value name="2">
<Value>Otchet</Value>
</Value>
<Value name="3">
<Value>SchetNum</Value>
</Value>
<Value name="4">
<Value>Summ</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.StorageIn">
<Description>
Инструкция по размещению</Description>
<Super>Docs.Super</Super>
<TimeCreated>60373,30563.898212</TimeCreated>

<Property name="storeman">
<Description>
Грузчик</Description>
<Type>Common.Dictionary5</Type>
</Property>

<Property name="PrihodType">
<Description>
Тип приёма</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Обычный товар,Брак"/>
<Parameter name="VALUELIST" value=",0,1"/>
</Property>

<Index name="PrihodTypeInd">
<Properties>PrihodType</Properties>
</Index>

<Property name="Images">
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>StorageInDefaultData</DefaultData>
<Data name="StorageInDefaultData">
<Structure>listnode</Structure>
<Subscript>"StorageIn"</Subscript>
<Value name="1">
<Value>storeman</Value>
</Value>
<Value name="2">
<Value>PrihodType</Value>
</Value>
<Value name="3">
<Value>Images</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.StorageInItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60373,30721.033797</TimeCreated>

<Property name="addr">
<Description>
Адрес</Description>
<Type>Store.Address</Type>
</Property>

<Property name="quantdefault">
<Description>
Количество по накладной</Description>
<Type>%Numeric</Type>
</Property>

<Property name="quantreal">
<Description>
Количество фактическое</Description>
<Type>%Numeric</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>StorageInItemsDefaultData</DefaultData>
<Data name="StorageInItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"StorageInItems"</Subscript>
<Value name="1">
<Value>addr</Value>
</Value>
<Value name="2">
<Value>quantdefault</Value>
</Value>
<Value name="3">
<Value>quantreal</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.StorageOut">
<Super>Docs.Super</Super>
<TimeCreated>60373,31366.642324</TimeCreated>

<Property name="storeman">
<Description>
Грузчик</Description>
<Type>Common.Dictionary5</Type>
</Property>

<Property name="Brak">
<Type>%Boolean</Type>
</Property>

<Index name="BrakInd">
<Properties>Brak</Properties>
</Index>

<Property name="Images">
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>StorageOutDefaultData</DefaultData>
<Data name="StorageOutDefaultData">
<Structure>listnode</Structure>
<Subscript>"StorageOut"</Subscript>
<Value name="1">
<Value>storeman</Value>
</Value>
<Value name="2">
<Value>Brak</Value>
</Value>
<Value name="3">
<Value>Images</Value>
</Value>
<Value name="4">
<Value>SendMailLog</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.StorageOutItems">
<IncludeCode>xmlmacros</IncludeCode>
<Super>Docs.DocItems</Super>
<TimeCreated>60373,31441.72857</TimeCreated>

<Property name="addr">
<Description>
Адрес</Description>
<Type>Store.Address</Type>
</Property>

<Property name="quantdefault">
<Description>
Количество по накладной</Description>
<Type>%Numeric</Type>
</Property>

<Property name="quantreal">
<Description>
Количество фактическое</Description>
<Type>%Numeric</Type>
</Property>

<Property name="StoreQntID">
<Description>
ID в Store.Quantity</Description>
<Type>Store.Quantity</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="StoreQntIDIndex">
<Properties>StoreQntID</Properties>
</Index>

<Property name="garant">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="serial">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="comment">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Trigger name="OnDelete">
<Code> n StoreQntID,quantdefault,StatPropertyListIndex,docid
 s docid={Doc}
 s StatPropertyListIndex=##class(Docs.Super).GetPropertyListIndex("Stat")
 i docid,$LG(^Docs.SuperD(docid),StatPropertyListIndex)=2 q
 s StoreQntID={StoreQntID}
 s quantdefault={quantdefault}
 s CurrentStringId={ID}
 //уменьшаем резерв и увеличиваем товар в ячейке которая привязана к данной строке
 d ..RemoveReserve(StoreQntID,quantdefault,CurrentStringId)</Code>
<Event>DELETE</Event>
</Trigger>

<Method name="%OnDelete">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%Delete</METHOD> method to 
provide notification that the object specified by <VAR>oid</VAR> is being deleted.

<P>If this method returns an error then the object will not be deleted.]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s CurrentStringId=$LG(oid,1)
 s docid=$LG(^Docs.DocItemsD(CurrentStringId),##class(Docs.DocItems).GetPropertyListIndex("Doc"))
 s StatPropertyListIndex=##class(Docs.Super).GetPropertyListIndex("Stat")
 i docid,$LG(^Docs.SuperD(docid),StatPropertyListIndex)=2 q
 s StoreQntID=$LG(^Docs.DocItemsD(CurrentStringId,"StorageOutItems"),..GetPropertyListIndex("StoreQntID"))
 s quantdefault=$LG(^Docs.DocItemsD(CurrentStringId,"StorageOutItems"),..GetPropertyListIndex("quantdefault"))

 d:StoreQntID ..RemoveReserve(StoreQntID,quantdefault,CurrentStringId)
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="RemoveReserve">
<Description>
Перевести резерв в основное количество</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>StoreQntID:%String="",value:%Numeric=0,DocStr:Docs.DocItems=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 n Goods,Address,Value1,Value2
 &sql(update Store.Quantity set Value2=(Value2-:value),Value1=(Value1+:value) where ID=:StoreQntID)
 if SQLCODE $$$WriteError("Ошибка update Store.Quantity SQLCODE="_SQLCODE)
 &sql(select Goods,Address,Value1,Value2 into :Goods,:Address,:Value1,:Value2 from Store.Quantity where ID=:StoreQntID)
 if SQLCODE<0 $$$WriteError("Ошибка select Store.Quantity SQLCODE="_SQLCODE)
 &sql(insert into Operation.Operation (Goods,Address,OperationType,Quantity,Ostatok,DocStr,Rezerv) VALUES (:Goods,:Address,2,:value,:Value1,:DocStr,:Value2))
 if SQLCODE<0 $$$WriteError("Ошибка insert into Operation.Operation SQLCODE="_SQLCODE)
 q
]]></Implementation>
</Method>

<Method name="SetReserve">
<Description>
Поставить резерв</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>StoreQntID:%String="",value:%Numeric=0,DocStr:Docs.DocItems=""</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 n Goods,Address,Value1,Value2
 
 &sql(update Store.Quantity set Value1=(Value1-:value),Value2=(Value2+:value) where ID=:StoreQntID)
 if SQLCODE<0 $$$WriteError("Ошибка update Store.Quantity SQLCODE="_SQLCODE)
 &sql(select Goods,Address,Value1,Value2 into :Goods,:Address,:Value1,:Value2 from Store.Quantity where ID=:StoreQntID)
 if SQLCODE<0 $$$WriteError("Ошибка select Store.Quantity SQLCODE="_SQLCODE)
 &sql(insert into Operation.Operation (Goods,Address,OperationType,Quantity,Ostatok,DocStr,Rezerv) VALUES (:Goods,:Address,1,:value,:Value1,:DocStr,:Value2))
 if SQLCODE<0 $$$WriteError("Ошибка insert into Operation.Operation SQLCODE="_SQLCODE)
 q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>StorageOutItemsDefaultData</DefaultData>
<Data name="StorageOutItemsDefaultData">
<Subscript>"StorageOutItems"</Subscript>
<Value name="1">
<Value>addr</Value>
</Value>
<Value name="2">
<Value>quantdefault</Value>
</Value>
<Value name="3">
<Value>quantreal</Value>
</Value>
<Value name="4">
<Value>StoreQntID</Value>
</Value>
<Value name="5">
<Value>garant</Value>
</Value>
<Value name="6">
<Value>comment</Value>
</Value>
<Value name="7">
<Value>serial</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Super">
<Description>
Суперкласс для всех документов</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%Persistent</Super>
<TimeCreated>60361,44569.488251</TimeCreated>

<Property name="Kontr">
<Description>
Контрагент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Index name="kontrind">
<Properties>Kontr</Properties>
</Index>

<Property name="Dat">
<Description>
Дата создания</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
<Parameter name="CAPTION" value=",display=readonly"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatInd">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время</Description>
<Type>%Time</Type>
<InitialExpression>$PIECE($H,",",2)</InitialExpression>
<Parameter name="CAPTION" value=",display=readonly"/>
</Property>

<Index name="TimInd">
<Properties>Tim</Properties>
</Index>

<Property name="Summa">
<Description>
Сумма</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Name">
<Description>
Номер</Description>
<Type>%String</Type>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Property name="DocumentClass">
<Description>
Класс документа</Description>
<Type>Docs.Docs</Type>
<InitialExpression>..%ClassName(1)</InitialExpression>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="DocumentClassInd">
<Properties>DocumentClass</Properties>
</Index>

<Property name="Items">
<Type>Docs.DocItems</Type>
<Cardinality>many</Cardinality>
<Inverse>Doc</Inverse>
<Relationship>1</Relationship>
</Property>

<Property name="Stat">
<Description>
Статус</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",создан,закрыт"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="StatInd">
<Properties>Stat</Properties>
</Index>

<Property name="Source">
<Description>
Родитель</Description>
<Type>Docs.Super</Type>
</Property>

<Index name="SourceInd">
<Properties>Source</Properties>
</Index>

<UDLText name="T">
<Content><![CDATA[
//Property User1 As Users.Dates [ InitialExpression = 7 ];

]]></Content>
</UDLText>

<Property name="User1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Index name="User1Ind">
<Properties>User1</Properties>
</Index>

<UDLText name="T">
<Content><![CDATA[
//Property Depot As %String(CAPTION = ",display=none") [ InitialExpression = 1 ];

]]></Content>
</UDLText>

<Property name="Depot">
<Description>
Склад</Description>
<Type>%String</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("depot")),1:"")</InitialExpression>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="DepotInd">
<Properties>Depot</Properties>
</Index>

<Property name="Comment">
<Description>
Комментарий</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="CloseDate">
<Description>
Дата закрытия</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",readonly"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="CloseDateInd">
<Properties>CloseDate</Properties>
</Index>

<Property name="CloseTime">
<Description>
Время закрытия</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="CloseTimeInd">
<Properties>CloseTime</Properties>
</Index>

<Property name="CloseUser">
<Description>
Человек закрывший</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",readonly"/>
</Property>

<Index name="CloseUserInd">
<Properties>CloseUser</Properties>
</Index>

<Property name="ChangeDate">
<Description>
Дата закрытия</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="ChangeDateInd">
<Properties>ChangeDate</Properties>
</Index>

<Property name="ChangeTime">
<Description>
Время закрытия</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeTimeInd">
<Properties>ChangeTime</Properties>
</Index>

<Property name="ChangeUser">
<Description>
Человек закрывший</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeUserInd">
<Properties>ChangeUser</Properties>
</Index>

<Method name="StatSet">
<FormalSpec>val</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i%Stat=val
 d:val=2
 . s %this.CloseDate=+$H
 . s %this.CloseTime=$P($H,",",2)
 . s CloseUser=$$$SessionData("user")
 . d:CloseUser'="" %this.CloseUserSetObjectId(CloseUser)
 q 1
]]></Implementation>
</Method>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>PropertyName:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnBeforeSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 n ChangeUser
 s %this.ChangeDate=+$H
 s %this.ChangeTime=$P($H,",",2)
 s ChangeUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 d:ChangeUser %this.ChangeUserSetObjectId(ChangeUser)
 Quit $$$OK
]]></Implementation>
</Method>

<Trigger name="OnUpdate">
<Code> s obj=##class(Docs.Super).%OpenId({ID})
 s obj.ChangeTime=1
 d obj.%Save()</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.SuperD</DataLocation>
<DefaultData>SuperDefaultData</DefaultData>
<IdLocation>^Docs.SuperD</IdLocation>
<IndexLocation>^Docs.SuperI</IndexLocation>
<StreamLocation>^Docs.SuperS</StreamLocation>
<Data name="SuperDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Dat</Value>
</Value>
<Value name="3">
<Value>Kontr</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>Summa</Value>
</Value>
<Value name="6">
<Value>Tim</Value>
</Value>
<Value name="7">
<Value>DocumentClass</Value>
</Value>
<Value name="8">
<Value>Stat</Value>
</Value>
<Value name="9">
<Value>DocType</Value>
</Value>
<Value name="10">
<Value>Source</Value>
</Value>
<Value name="11">
<Value>User1</Value>
</Value>
<Value name="12">
<Value>Depot</Value>
</Value>
<Value name="13">
<Value>Comment</Value>
</Value>
<Value name="14">
<Value>CloseDate</Value>
</Value>
<Value name="15">
<Value>CloseTime</Value>
</Value>
<Value name="16">
<Value>CloseUser</Value>
</Value>
<Value name="17">
<Value>ChangeDate</Value>
</Value>
<Value name="18">
<Value>ChangeTime</Value>
</Value>
<Value name="19">
<Value>ChangeUser</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.Utiliz">
<Super>Docs.Super</Super>
<TimeCreated>60382,50442.215787</TimeCreated>

<Property name="Komissia">
<Description>
Комиссия</Description>
<Type>%String</Type>
</Property>

<Property name="SourceTbl">
<Description>
Откуда утилизировать</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Общее количество,Брак,Контрагент"/>
<Parameter name="VALUELIST" value=",1,2,3"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>UtilizDefaultData</DefaultData>
<Data name="UtilizDefaultData">
<Structure>listnode</Structure>
<Subscript>"Utiliz"</Subscript>
<Value name="1">
<Value>Komissia</Value>
</Value>
<Value name="2">
<Value>SourceTbl</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.UtilizItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60382,50526.753113</TimeCreated>

<Property name="goodsdir">
<Description>
Действие с товаром</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Утилизация,Оприходование"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="Goodind">
<Properties>goodsdir</Properties>
</Index>

<Property name="spravka">
<Description>
№ и дата выписки Справки</Description>
<Type>%String</Type>
</Property>

<Property name="Client">
<Description>
Клиент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Index name="ClInd">
<Properties>Client</Properties>
</Index>

<Property name="addr">
<Description>
Место</Description>
<Type>Store.Address</Type>
</Property>

<Property name="garant">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
</Property>

<Property name="sn">
<Description>
Серийный номер изделия</Description>
<Type>%String</Type>
</Property>

<Property name="SourceTbl">
<Description>
Откуда утилизировать</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Общее количество,Брак"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="SourceTblInd">
<Properties>SourceTbl</Properties>
</Index>

<Property name="Brak">
<Type>Store.Brak</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>UtilizItemsDefaultData</DefaultData>
<Data name="UtilizItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"UtilizItems"</Subscript>
<Value name="1">
<Value>goodsdir</Value>
</Value>
<Value name="2">
<Value>Client</Value>
</Value>
<Value name="3">
<Value>spravka</Value>
</Value>
<Value name="4">
<Value>Store</Value>
</Value>
<Value name="5">
<Value>garant</Value>
</Value>
<Value name="6">
<Value>sn</Value>
</Value>
<Value name="7">
<Value>addr</Value>
</Value>
<Value name="8">
<Value>SourceTbl</Value>
</Value>
<Value name="9">
<Value>Brak</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Docs.waste">
<Super>%Persistent</Super>
<TimeCreated>60423,63900.223959</TimeCreated>

<Property name="meas">
<Description>
Единица</Description>
<Type>Store.Measures</Type>
</Property>

<Property name="DocumentClass">
<Description>
Тип документа</Description>
<Type>Docs.Docs</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Docs.wasteD</DataLocation>
<DefaultData>wasteDefaultData</DefaultData>
<IdLocation>^Docs.wasteD</IdLocation>
<IndexLocation>^Docs.wasteI</IndexLocation>
<StreamLocation>^Docs.wasteS</StreamLocation>
<Data name="wasteDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>meas</Value>
</Value>
<Value name="3">
<Value>DocumentClass</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.Card">
<Description>
Карточка товара</Description>
<Super>%Persistent</Super>
<TimeCreated>60348,6676.247999</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.CardD</DataLocation>
<DefaultData>CardDefaultData</DefaultData>
<IdLocation>^Goods.CardD</IdLocation>
<IndexLocation>^Goods.CardI</IndexLocation>
<StreamLocation>^Goods.CardS</StreamLocation>
<Data name="CardDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Store</Value>
</Value>
<Value name="4">
<Value>GoodsStore</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.CardAction">
<Description>
Действия с карточками товаров</Description>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60353,59475.901363</TimeCreated>

<Method name="SaveCard">
<ClassMethod>1</ClassMethod>
<FormalSpec>id="",CardData,Name="",CardClass="undefined"</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveCardErr"
 i id="" s card=##class(Goods.Card).%New()
 e  d
 . s card=##class(Goods.Card).%OpenId(id)
 . i '$ISOBJECT(card) s card=##class(Goods.Card).%New()
 s card.Name=Name
 s ok=card.%Save()
 q:'+ok ok
 s ^Cards(CardClass,card.%Id())=CardData
 q ok
SaveCardErr
 s ^Errors($H,"$ZE")=$ZE
 q "Goods.CardAction.SaveCard() "_$ZE
]]></Implementation>
</Method>

<Method name="SaveCard2">
<ClassMethod>1</ClassMethod>
<FormalSpec>id="1",CardData,CardClass="undefined"</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveCardErr"
 s ^Cards(CardClass,id)=CardData
 q 1
SaveCardErr
 s ^Errors($H,"$ZE")=$ZE
 q "Goods.CardAction.SaveCard() "_$ZE
]]></Implementation>
</Method>

<Method name="GetCard">
<ClassMethod>1</ClassMethod>
<FormalSpec>id="",CardClass="undefined"</FormalSpec>
<Implementation><![CDATA[
 q:id="" ""
 q:CardClass="" ""
 q $G(^Cards(CardClass,id))
]]></Implementation>
</Method>

<Method name="DelCard">
<ClassMethod>1</ClassMethod>
<FormalSpec>id="",CardClass=""</FormalSpec>
<Implementation><![CDATA[
 q:id=""
 q:CardClass=""
 k ^Cards(CardClass,id)
 q
]]></Implementation>
</Method>

<Method name="GetGoods">
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr=1</FormalSpec>
<Implementation><![CDATA[
 q:kontr="" ""
 s res=""
 s glob=$NA(^Kontr(0,kontr))
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s res=res_i_"~"
 q $E(res,1,$L(res)-1)
]]></Implementation>
</Method>

<Method name="GetKontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>tovar=1</FormalSpec>
<Implementation><![CDATA[
 q:tovar="" ""
 s res=""
 s glob=$NA(^Kontr(1,tovar))
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s res=res_i_"~"
 q $E(res,1,$L(res)-1)
]]></Implementation>
</Method>
</Class>


<Class name="Goods.Catalogue">
<Description>
Каталог групп</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,34623.276743</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Index name="DepotIndex">
<Properties>Depot</Properties>
</Index>

<Query name="Common">
<Type>%SQLQuery</Type>
<FormalSpec>depot:%String=$G(%session.Data("depot"))</FormalSpec>
<SqlQuery> SELECT %ID,Name,Comment,Main FROM Catalogue
 WHERE (Depot = :depot)
 ORDER BY Name</SqlQuery>
<Parameter name="CONTAINID" value="1"/>
</Query>

<Property name="Main">
<Description>
Основной</Description>
<Type>%Boolean</Type>
<Parameter name="CAPTION" value="Основной"/>
</Property>

<Index name="MainIndex">
<Properties>Main</Properties>
</Index>

<Property name="ShowClients">
<Description>
Отправлять клиентам</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Никому не отправлять,Всем отправлять, -,Электроинструмент,Бытовая техника,Электроинструмент и бытовая техника"/>
<Parameter name="VALUELIST" value=",4,0,1,2,3,23"/>
</Property>

<Index name="ShowClientsIndex">
<Properties>ShowClients</Properties>
</Index>

<Property name="ShowPrice">
<Description>
Показывать цену клиентам</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Да,Нет"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Index name="ShowPriceIndex">
<Properties>ShowPrice</Properties>
</Index>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>PropertyName:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.CatalogueD</DataLocation>
<DefaultData>CatalogueDefaultData</DefaultData>
<IdLocation>^Goods.CatalogueD</IdLocation>
<IndexLocation>^Goods.CatalogueI</IndexLocation>
<StreamLocation>^Goods.CatalogueS</StreamLocation>
<Data name="CatalogueDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Depot</Value>
</Value>
<Value name="5">
<Value>Main</Value>
</Value>
<Value name="6">
<Value>ShowClients</Value>
</Value>
<Value name="7">
<Value>ShowPrice</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.CatalogueAction">
<Description>
Действия с каталогами</Description>
<Abstract>1</Abstract>
<ProcedureBlock>1</ProcedureBlock>
<TimeCreated>60328,1340.321205</TimeCreated>

<Method name="IsMain">
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue</FormalSpec>
<Implementation><![CDATA[
	q:'##class(Goods.Catalogue).%ExistsId(Catalogue) 0
	s ok=##class(Goods.Catalogue).%OpenId(Catalogue)
	q +ok.Main
]]></Implementation>
</Method>
</Class>


<Class name="Goods.Goods">
<Description>
Товары</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,67371.691037</TimeCreated>

<Property name="kban">
<Description>
Kontragent ban list
Список ид контрагентов через запятую, для которых запрещен экспорт данного товара</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="16384"/>
</Property>

<Index name="kbanIDX">
<Description><![CDATA[
Хитро-ный индекс
Не менять название, используется в коде <method>..kbanned</method>]]></Description>
<Type>bitmap</Type>
<Properties>kban(ELEMENTS)</Properties>
</Index>

<Method name="kbanBuildValueArray">
<Description><![CDATA[
Обязательный метод для построения системой хитро-ного индекса <index>kbanIDX</index>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[kban:%String,&arr]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s list=$LFS(kban,","),key=0,k=""
	while $LISTNEXT(list,key,k){
		s:k'="" arr(k)=""
	}
 Q $$$OK
]]></Implementation>
</Method>

<Method name="kbanned">
<Description>
Проверка на наличие запрета</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>good,kontr</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	//испльзовать ^GoodsKontrBan
	q $D(^GoodsKontrBan("Goods",good,kontr))
	
	/*
	//использовать SQL таблицу
	&sql(select id from Goods.GoodsKontrBan where Goods=:good and Kontr=:kontr)
	if 'SQLCODE q 1
	q 0
	*/
	
	
	//старый код использующий битмап индекс
	s part=good\64000+1 ;подиндекс в зависимости от кол-ва ид в классе
	s offset=good#64000+1 ;смещение от начала строки
	Q $bit($g(^Goods.GoodsI("kbanIDX"," "_kontr,part)),offset)
]]></Implementation>
</Method>

<Method name="kbanAdd">
<Description>
Добавление запрета на контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>good="",kontr="",*err:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	if '..%ExistsId(good) s err="указан несуществующий товар "_good q 0
	if '##class(Common.Kontragent).%ExistsId(kontr) s err="указан несуществующий контрагент "_kontr q 0
	
	if good'="",kontr'="" 	{
		s ^GoodsKontrBan("Goods",good,kontr)=""
		s ^GoodsKontrBan("Kontr",kontr,good)=""
	}
	q 1
 /*
 	//использовать  SQL таблицу
	if '..%ExistsId(good) s err="указан несуществующий товар "_goods q 0
	if '##class(Common.Kontragent).%ExistsId(kontr) s err="указан несуществующий контрагент "_kontr q 0
	if ..kbanned(good, kontr) q 1
	&sql(insert into Goods.GoodsKontrBan (Goods,Kontr) VALUES (:good,:kontr) )
	q 1
 */	
	
	//старый код использующий битмап индекс
	if '..%ExistsId(good) s err="указан несуществующий товар "_goods q 0
	if '##class(Common.Kontragent).%ExistsId(kontr) s err="указан несуществующий контрагент "_kontr q 0
	
	s kban=..kbanGetStored(good)
	s list=$LFS(kban,",") 
	if $LF(list,kontr) Q $$$OK ;уже в списке
	
	s list=list_$LB(kontr), kban=$LTS(list,",")
	#; при обновлении через SQL сложный индекс не строится
	s g=..%OpenId(good,,.sc) 
	if $IsObject(g) s g.kban=kban Q g.%Save()
	
	Q sc
]]></Implementation>
</Method>

<Method name="kbanDel">
<Description>
Удаление запрета на котрагента
Добавление запрета на контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>good,kontr</FormalSpec>
<ReturnType>%Status</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	if good'="",kontr'=""
	{
		k ^GoodsKontrBan("Goods",good,kontr)
		k ^GoodsKontrBan("Kontr",kontr,good)
	}
	
	q 1
	/*
	&sql(delete from Goods.GoodsKontrBan where Goods=:good and Kontr=:kontr)
	q 1
	*/
	
	//старый код использующий битмап индекс
	s good=$g(good) Q:'..%ExistsId(good) $$$OK	
	s kontr=$g(kontr) Q:'##class(Common.Kontragent).%ExistsId(kontr)
	s kban=..kbanGetStored(good)
	s list=$LFS(kban,",") s pos=$LF(list,kontr)
	if 'pos Q $$$OK ;уже в нет списке
	s list=$li(list,1,pos-1)_$li(list,pos+1,$ll(list)), kban=$LTS(list,",")
	#; при обновлении через SQL сложный индекс не строится
	s g=..%OpenId(good,,.sc) if $IsObject(g) s g.kban=kban Q g.%Save()
	Q sc
]]></Implementation>
</Method>

<Property name="AllowToSend">
<Description>
Разрешено использовать в заявках</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="CAPTION" value="Отправлять контрагенту"/>
<Parameter name="DISPLAYLIST" value=",Да,Нет"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Index name="AllowToSend">
<Properties>AllowToSend</Properties>
</Index>

<Property name="Property312">
<Description>
Количество в упаковке</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Количество в упаковке,display=none"/>
</Property>

<Property name="Property675">
<Description>
Ед. Изм.</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Ед. Изм."/>
</Property>

<Property name="Property9469">
<Description>
Категория</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Категория"/>
<Parameter name="DISPLAYLIST" value=",Товар,Запчасть"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="Property3609">
<Description>
Модель</Description>
<Type>%String</Type>
</Property>

<Property name="Property5300">
<Description>
Номер по схеме</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Номер по схеме"/>
</Property>

<Property name="Property7053">
<Description>
Изделие</Description>
<Type>%String</Type>
</Property>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Index name="NamInd">
<Properties>Name</Properties>
</Index>

<Property name="Images">
<Description>
Изображения товара</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="Size1">
<Description>
Объём</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Weight">
<Description>
Вес</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Price">
<Description>
Цена</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="2"/>
</Property>

<Property name="abbr">
<Description>
Аббревиатура модели</Description>
<Type>%String</Type>
</Property>

<Index name="abbrind">
<Properties>abbr</Properties>
</Index>

<Property name="Params">
<Type>Goods.GoodsParams</Type>
<Cardinality>many</Cardinality>
<Inverse>Goods</Inverse>
<Relationship>1</Relationship>
</Property>

<Property name="aspektid">
<Description>
ID в аспекте</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="aspektidind">
<Properties>aspektid</Properties>
</Index>

<Property name="Comment">
<Description>
Комментарий</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="300"/>
</Property>

<Property name="codedetail">
<Description>
Код детали</Description>
<Type>%String</Type>
</Property>

<Index name="codedetailInd">
<Properties>codedetail</Properties>
</Index>

<Property name="izdelie">
<Description>
Изделие</Description>
<Type>Common.Dictionary12</Type>
</Property>

<Index name="izdelieInd">
<Properties>izdelie</Properties>
</Index>

<Property name="FullName">
<Description>
Полное наименование</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}={abbr}_"-"_{Property3609}_" "_{Name}</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Method name="GetFullName">
<Description>
Один метод в одном месте д.б.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	Q:'..%ExistsId($g(id)) ""
	Q ..abbrGetStored(id)_"-"_..Property3609GetStored(id)_" "_..NameGetStored(id)
]]></Implementation>
</Method>

<Property name="ModelNumber">
<Description>
Модель и номер</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}={abbr}_"-"_{Property3609}</SqlComputeCode>
<SqlComputed>1</SqlComputed>
</Property>

<Property name="EnglishName">
<Description>
Английское наименование</Description>
<Type>%String</Type>
</Property>

<Index name="EnglishNameIndex">
<Properties>EnglishName</Properties>
</Index>

<Property name="Tovar">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="TovarInd">
<Properties>Tovar</Properties>
</Index>

<Property name="ChangeDate">
<Description>
Дата закрытия</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="ChangeDateInd">
<Properties>ChangeDate</Properties>
</Index>

<Property name="ChangeTime">
<Description>
Время закрытия</Description>
<Type>%Time</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeTimeInd">
<Properties>ChangeTime</Properties>
</Index>

<Property name="ChangeUser">
<Description>
Человек закрывший</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="ChangeUserInd">
<Properties>ChangeUser</Properties>
</Index>

<Property name="Composition">
<Description>
Состав запчасти</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Property name="Description">
<Description>
Подробное описание</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="2048"/>
</Property>

<Property name="CodeOKVED">
<Description>
Код ТНВЭД</Description>
<Type>%String</Type>
</Property>

<Property name="MaterialEng">
<Description>
Материал (англ.)</Description>
<Type>%String</Type>
</Property>

<Property name="AllowAct">
<Description>
Разрешать выписывать акт без заявки</Description>
<Type>%String</Type>
<InitialExpression>0</InitialExpression>
<Parameter name="CAPTION" value="Разрешать акт без заявки"/>
<Parameter name="DISPLAYLIST" value=",Да,Нет"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
  s PropertyName=data.Value
  s ListIndex=data.Name
  Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
  s data=StorageData.Values.GetNext(.number)
  }  
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG(@DataLocation@(ID),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Goods")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyType">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>PropertyName:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 f i=1:1:%compiledclass.Properties.Count() d
 . Do %code.WriteLine(" Set Prop("""_%compiledclass.Properties.GetAt(i).Name_""")="""_%compiledclass.Properties.GetAt(i).Type_"""")
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnBeforeSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 n ChangeUser
 s %this.ChangeDate=+$H
 s %this.ChangeTime=$P($H,",",2)
 s ChangeUser=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 d:ChangeUser %this.ChangeUserSetObjectId(ChangeUser)
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnNew">
<Description>
Инициализация через конструктор</Description>
<FormalSpec><![CDATA[&initvalue:%CacheString]]></FormalSpec>
<Private>1</Private>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s ..Name=$g(initvalue("Name"))
 s ..Size1=$g(initvalue("Size1"))
 s ..Weight=$g(initvalue("Weight"))
 s ..Price=$g(initvalue("Price"))
 Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.GoodsD</DataLocation>
<DefaultData>GoodsDefaultData</DefaultData>
<IdLocation>^Goods.GoodsD</IdLocation>
<IndexLocation>^Goods.GoodsI</IndexLocation>
<StreamLocation>^Goods.GoodsS</StreamLocation>
<Data name="GoodsDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Measure</Value>
</Value>
<Value name="4">
<Value>manufact</Value>
</Value>
<Value name="5">
<Value>articul</Value>
</Value>
<Value name="6">
<Value>test</Value>
</Value>
<Value name="7">
<Value>Property7636</Value>
</Value>
<Value name="8">
<Value>Property3584</Value>
</Value>
<Value name="9">
<Value>Property9410</Value>
</Value>
<Value name="10">
<Value>Property82</Value>
</Value>
<Value name="11">
<Value>Property4727</Value>
</Value>
<Value name="12">
<Value>fghhh</Value>
</Value>
<Value name="13">
<Value>gh</Value>
</Value>
<Value name="14">
<Value>Property8263</Value>
</Value>
<Value name="15">
<Value>Property2833</Value>
</Value>
<Value name="16">
<Value>Property271</Value>
</Value>
<Value name="17">
<Value>Property8678</Value>
</Value>
<Value name="18">
<Value>Property8595</Value>
</Value>
<Value name="19">
<Value>Property2901</Value>
</Value>
<Value name="20">
<Value>Property75</Value>
</Value>
<Value name="21">
<Value>Property3642</Value>
</Value>
<Value name="22">
<Value>Property5348</Value>
</Value>
<Value name="23">
<Value>Property4968</Value>
</Value>
<Value name="24">
<Value>Property895</Value>
</Value>
<Value name="25">
<Value>Property348</Value>
</Value>
<Value name="26">
<Value>Property3287</Value>
</Value>
<Value name="27">
<Value>Property2859</Value>
</Value>
<Value name="28">
<Value>Property1988</Value>
</Value>
<Value name="29">
<Value>Property7607</Value>
</Value>
<Value name="30">
<Value>Property3885</Value>
</Value>
<Value name="31">
<Value>Property5100</Value>
</Value>
<Value name="32">
<Value>Property3541</Value>
</Value>
<Value name="33">
<Value>Property5325</Value>
</Value>
<Value name="34">
<Value>Property6074</Value>
</Value>
<Value name="35">
<Value>Property8462</Value>
</Value>
<Value name="36">
<Value>Property936</Value>
</Value>
<Value name="37">
<Value>Property2405</Value>
</Value>
<Value name="38">
<Value>Property1435</Value>
</Value>
<Value name="39">
<Value>Property6025</Value>
</Value>
<Value name="40">
<Value>Property4974</Value>
</Value>
<Value name="41">
<Value>Property7534</Value>
</Value>
<Value name="42">
<Value>Property6438</Value>
</Value>
<Value name="43">
<Value>Property7379</Value>
</Value>
<Value name="44">
<Value>Property3309</Value>
</Value>
<Value name="45">
<Value>Property9173</Value>
</Value>
<Value name="46">
<Value>Property2468</Value>
</Value>
<Value name="47">
<Value>Property2274</Value>
</Value>
<Value name="48">
<Value>Property26</Value>
</Value>
<Value name="49">
<Value>Property1576</Value>
</Value>
<Value name="50">
<Value>Property4680</Value>
</Value>
<Value name="51">
<Value>Property8640</Value>
</Value>
<Value name="52">
<Value>Property2224</Value>
</Value>
<Value name="53">
<Value>Property4927</Value>
</Value>
<Value name="54">
<Value>Property9581</Value>
</Value>
<Value name="55">
<Value>Property7126</Value>
</Value>
<Value name="56">
<Value>Property6903</Value>
</Value>
<Value name="57">
<Value>Property1776</Value>
</Value>
<Value name="58">
<Value>Property1525</Value>
</Value>
<Value name="59">
<Value>Property3351</Value>
</Value>
<Value name="60">
<Value>Property8738</Value>
</Value>
<Value name="61">
<Value>Property2151</Value>
</Value>
<Value name="62">
<Value>Property6488</Value>
</Value>
<Value name="63">
<Value>Property8230</Value>
</Value>
<Value name="64">
<Value>Property7992</Value>
</Value>
<Value name="65">
<Value>Property5857</Value>
</Value>
<Value name="66">
<Value>Property2307</Value>
</Value>
<Value name="67">
<Value>Property2275</Value>
</Value>
<Value name="68">
<Value>Property9823</Value>
</Value>
<Value name="69">
<Value>Property4127</Value>
</Value>
<Value name="70">
<Value>Property117</Value>
</Value>
<Value name="71">
<Value>Property5206</Value>
</Value>
<Value name="72">
<Value>Property627</Value>
</Value>
<Value name="73">
<Value>Property5293</Value>
</Value>
<Value name="74">
<Value>Property7912</Value>
</Value>
<Value name="75">
<Value>Property9521</Value>
</Value>
<Value name="76">
<Value>Property4905</Value>
</Value>
<Value name="77">
<Value>Property2469</Value>
</Value>
<Value name="78">
<Value>Property4483</Value>
</Value>
<Value name="79">
<Value>Property287</Value>
</Value>
<Value name="80">
<Value>Property7492</Value>
</Value>
<Value name="81">
<Value>Property684</Value>
</Value>
<Value name="82">
<Value>Property969</Value>
</Value>
<Value name="83">
<Value>Property5370</Value>
</Value>
<Value name="84">
<Value>Params</Value>
</Value>
<Value name="85">
<Value>Property2822</Value>
</Value>
<Value name="86">
<Value>Property1509</Value>
</Value>
<Value name="87">
<Value>Property7274</Value>
</Value>
<Value name="88">
<Value>Property7499</Value>
</Value>
<Value name="89">
<Value>Property7854</Value>
</Value>
<Value name="90">
<Value>Property6620</Value>
</Value>
<Value name="91">
<Value>Property8603</Value>
</Value>
<Value name="92">
<Value>Property115</Value>
</Value>
<Value name="93">
<Value>Property7053</Value>
</Value>
<Value name="94">
<Value>Property9801</Value>
</Value>
<Value name="95">
<Value>Property7451</Value>
</Value>
<Value name="96">
<Value>Property8077</Value>
</Value>
<Value name="97">
<Value>Property5300</Value>
</Value>
<Value name="98">
<Value>Property4861</Value>
</Value>
<Value name="99">
<Value>Size</Value>
</Value>
<Value name="100">
<Value>Weight</Value>
</Value>
<Value name="101">
<Value>Property6969</Value>
</Value>
<Value name="102">
<Value>Property8270</Value>
</Value>
<Value name="103">
<Value>Property1242</Value>
</Value>
<Value name="104">
<Value>Property9363</Value>
</Value>
<Value name="105">
<Value>Property6187</Value>
</Value>
<Value name="106">
<Value>Property5353</Value>
</Value>
<Value name="107">
<Value>Property84</Value>
</Value>
<Value name="108">
<Value>Property7286</Value>
</Value>
<Value name="109">
<Value>Property3609</Value>
</Value>
<Value name="110">
<Value>Property9313</Value>
</Value>
<Value name="111">
<Value>Images</Value>
</Value>
<Value name="112">
<Value>Size1</Value>
</Value>
<Value name="113">
<Value>Property2268</Value>
</Value>
<Value name="114">
<Value>Property9469</Value>
</Value>
<Value name="115">
<Value>Property3880</Value>
</Value>
<Value name="116">
<Value>Price</Value>
</Value>
<Value name="117">
<Value>Property675</Value>
</Value>
<Value name="118">
<Value>abbr</Value>
</Value>
<Value name="119">
<Value>Property312</Value>
</Value>
<Value name="120">
<Value>aspektid</Value>
</Value>
<Value name="121">
<Value>Comment</Value>
</Value>
<Value name="122">
<Value>codedetail</Value>
</Value>
<Value name="123">
<Value>izdelie</Value>
</Value>
<Value name="124">
<Value>EnglishName</Value>
</Value>
<Value name="125">
<Value>Tovar</Value>
</Value>
<Value name="126">
<Value>ChangeDate</Value>
</Value>
<Value name="127">
<Value>ChangeTime</Value>
</Value>
<Value name="128">
<Value>ChangeUser</Value>
</Value>
<Value name="129">
<Value>Composition</Value>
</Value>
<Value name="130">
<Value>Description</Value>
</Value>
<Value name="131">
<Value>CodeOKVED</Value>
</Value>
<Value name="132">
<Value>MaterialEng</Value>
</Value>
<Value name="133">
<Value>AllowAct</Value>
</Value>
<Value name="134">
<Value>AllowToSend</Value>
</Value>
<Value name="135">
<Value>kban</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.GoodsAction">
<Description>
Действия с товарами</Description>
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60324,81785.661493</TimeCreated>

<Method name="CreateProp">
<Description><![CDATA[
Создать свойство товара
<br><var>Catalogue</var> - ID каталога
<br><var>Group</var> - Код группы товарного классификатора которой (возможно) будет принадлежать новое свойство
<br><var>PropName</var> - Наименование свойства
<br><var>PropCode</var> - Код доп товарного свойства на котором стоял курсор (для создания на следующем уровне иерархии)
<br><var>Sub</var> - если 1 то доп свойство создавать на следующем уровне иерархии]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue="",Group="",PropName="",PropCode="",Sub=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="CreatePropERR",err=1
 q:PropName="" "Не указано имя свойства"
 q:Catalogue="" "Не указан каталог"
 q:(Sub=1)&(PropCode="") "Не указан код свойства"
    
    i Sub=1 s ok=..GetLastSubItem(.PropCode)
    e  s ok=..GetLastItem(.PropCode)
 q:'ok ok
 
 s prop=##class(Goods.Params).%New()
   s prop.Name=PropName
   s prop.Code=PropCode
   s prop.Groups=Group
   d prop.CatalogueSetObjectId(Catalogue)
 s ok=prop.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, ошибка при сохранении дополнительного свойства товара"
 q 1
CreatePropERR
 $$$WriteError($ZE)
 q "Извините, ошибка при сохранении дополнительного свойства товара"
]]></Implementation>
</Method>

<Method name="GetLastItem">
<Description><![CDATA[
получить последний элемент списка дополнительных свойств товара на данном уровне
<br><var>Code</var> - код элемента на уровне которого требуется найти последний элемент]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Code=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetLastItemErr"
 s Parent=$Piece(Code,"*",1,$Length(Code,"*")-1)
 if Parent'=""{
 &sql(select top 1 Code into :Code from Goods.Params where Parent=:Parent order by Code desc)}
 else{
 &sql(select top 1 Code into :Code from Goods.Params where Parent is Null order by Code desc)}
 
 q:SQLCODE<0 err="Goods.GoodsAction.GetLastItem() SQLCODE="_SQLCODE
 s:(SQLCODE=100)&(%ROWCOUNT=0) Code="*0"
 s $P(Code,"*",$L(Code,"*"))=+$P(Code,"*",$L(Code,"*"))+1
 q 1
GetLastItemErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка системы, попробуйте создать с другими параметрами."
]]></Implementation>
</Method>

<Method name="GetLastSubItem">
<Description><![CDATA[
Получить последний элемент списка дополнительных свойств товара на низлежащем уровне
<br><var>Code</var> - Код элемента для которого требуется найти последний элемент на низлежащем уровне]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Code=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetLastSItemErr"
 &sql(select top 1 Code into :LasSubCode from Goods.Params where Parent=:Code order by Code desc)
 q:SQLCODE<0 err="Goods.GoodsAction.GetLastItem() SQLCODE="_SQLCODE
 s:(SQLCODE=100)&(%ROWCOUNT=0) LasSubCode=Code_"*0"
 s $P(LasSubCode,"*",$L(LasSubCode,"*"))=+$P(LasSubCode,"*",$L(LasSubCode,"*"))+1
 s Code=LasSubCode
 q 1
GetLastSItemErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка системы, попробуйте создать с другими параметрами."
]]></Implementation>
</Method>

<Method name="addClassProperty">
<Description><![CDATA[
Создать свойство класса
<br><var>Description</var> - описание свойства
<br><var>Displaylist</var> - список значений Displaylist (через ~)
<br><var>FieldType</var> - Тип поля (%String,%Date,enumerated)
<br><var>ClassName</var> - Имя класса для этого поля
<br><var>KeyProp</var> - если 1 - это основное поле и имя его должно быть Name
<br><var>PatternType</var> - попытка реализовать проверку паттерна для поля (не работает)
<br><var>PatternStr</var> - попытка реализовать проверку паттерна для поля (не работает)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Description,Displaylist="",FieldType,ClassName="",KeyProp="",PatternType,PatternStr</FormalSpec>
<Implementation><![CDATA[
 s $ZT="addClassPropertyErr",err=1
 q:Description="" "Не указано наименование свойства"
 TSTART
 s err=1
 s ErrorDescription = "Извините, ошибка при создании поля справочника, попробуйте создать поле с другими параметрами."
 
 s GoodsPropOrder=$NA(^GoodsPropOrder("Goods.Goods"))  //здесь лежат все свойсва Goods.Goods по номерам
 //строим список Valuelist, все значения Displaylist пронумерованы с 1
 d:FieldType="enumerated"
 . f i=1:1:$L(Displaylist,"~") d
 . . s Valuelist=$G(Valuelist)_","_i
 //создаём новое свойство
 s:ClassName="" ClassName="Goods.Goods"
 if (ClassName'="")&(KeyProp=1) d  q:+exist "Только одно свойство справочника может быть основным"
 . s exist=##class(%Dictionary.PropertyDefinition).%ExistsId(ClassName_"||Name")
 Set pdef = ##class(%Dictionary.PropertyDefinition).%New()
 i '$ISOBJECT(pdef) d  q ErrorDescription_1
 . $$$WriteError("addClassProperty не смогли создать определение нового свойства") 
 . TROLLBACK 1
 
 s pdef.Description=Description
 s pdef.Type=FieldType
 d:FieldType="%Date" pdef.Parameters.SetAt(4,"FORMAT")
 d pdef.Parameters.SetAt(Description,"CAPTION")
 
 d:(Displaylist'="")&(FieldType="enumerated")
 . d pdef.Parameters.SetAt($TR(Valuelist,"~",","),"VALUELIST")
 . d pdef.Parameters.SetAt(","_$TR(Displaylist,"~",","),"DISPLAYLIST")
 . s pdef.Type="%String"
 
 S cdef = ##class(%Dictionary.ClassDefinition).%OpenId(ClassName)
 i '$ISOBJECT(cdef) d  q ErrorDescription_2
 . $$$WriteError("addClassProperty не смогли открыть класс "_ClassName_" в %Dictionary.ClassDefinition")
 . TROLLBACK 1
 
 // придумаем имя свойству тока если свойство не основное
 if '((ClassName'="")&(KeyProp=1)) d
 s PropName="Property"_$RANDOM(10000)
 while ##class(%Dictionary.PropertyDefinition).%ExistsId(ClassName_"||"_PropName)
  {
  	s PropName="Property"_$RANDOM(10000)	  
  }
 e  s PropName="Name"
 s pdef.Name=PropName
 
 //Запишем какие шаблоны может принимать свойство (см. стр. AddGoodsProp2.CSP)
 s:PatternType="prohibited" ^Property(ClassName,PropName,"Prohibited")=PatternStr
 s:PatternType="%Numeric" ^Property(ClassName,PropName,"Pattern")="?1(.N1""."".N,.N)"
 s:PatternType="%String" ^Property(ClassName,PropName,"Pattern")="?.(.A,.P)"
 s:PatternType="cachepattern" ^Property(ClassName,PropName,"Pattern")="?"_PatternStr

 s ok = cdef.Properties.Insert(pdef)
 i '+ok d  q ErrorDescription_3
 . $$$WriteObjError(ok)
 . TROLLBACK 1

 
 //Установим индекс для данного поля
 s IndexObject = ##class(%Dictionary.IndexDefinition).%New()
 s IndexObject.Name=PropName_"Ind"
 s IndexObject.Properties=PropName
 s ok=cdef.Properties.Insert(IndexObject)
 i '+ok d  q ErrorDescription_4
 . $$$WriteObjError(ok)
 . TROLLBACK 1
 s ok=cdef.%Save()
 i '+ok d  q ErrorDescription_5
 . $$$WriteObjError(ok)
 . TROLLBACK 1
 
 k cdef
 k pdef
 k IndexObject
 
 d:ClassName="Goods.Goods" AddPropToOrder(GoodsPropOrder,PropName)  //Запишем свойство в список свойств
 
 //компилируем
 s err=$$Comple()
 //если компиляция с ошибками убираем свойство, сохраняем и перекомпилируем
 i '+err d  q ErrorDescription_6
 . $$$WriteError(err)
 . TROLLBACK 1

 /*
 .  Do cdef.Properties.Remove(pdef)
 .  s ok=cdef.%Save()
 .  i '+ok d  q
 .  .  Do DecomposeStatus^%apiOBJ(%objlasterror,.err2) 
 .  .  s err=err_$CHAR(13)_"Попытка отката привела к ошибке "_err2(err2)
 .  d:ClassName="Goods.Goods" DelPropFromOrder(GoodsPropOrder,PropName)  //Удалим свойство из списка свойств после успешного отката
 .  s err2=$$Comple()
 .  s err=err_$CHAR(13)_$S('err2:"Откат произведён успешно.",1:"Попытка отката привела к ошибке,  сохраните эту запись и обратитесь к системному администратору."_$CHAR(13)_err2)
 */
 TCOMMIT
 q 1
addClassPropertyErr
 TROLLBACK
 q $ZE
Comple()
 s glob=$NA(^mtempSklad($I,"Compile"))
 k @glob
 j Compile^cmpl(ClassName,glob)
 while $G(@glob)="" {
 h .1
 }
 q:@glob@("err")>0 @glob@("err",@glob@("err"))
 q 1
AddPropToOrder(GoodsPropOrder,PropName)
 s number=$G(@GoodsPropOrder)+1
 s @GoodsPropOrder@(PropName)=number
 s @GoodsPropOrder=number
 q
DelPropFromOrder(GoodsPropOrder,PropName)
 s number=$G(@GoodsPropOrder)
 k @GoodsPropOrder@(PropName)
 s @GoodsPropOrder=number-1
 q
]]></Implementation>
</Method>

<Method name="DeleteProperty">
<Description><![CDATA[
Удаление свойства класса Goods.Goods
<br><var>name</var> - имя удаляемого свойства]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name=""</FormalSpec>
<Implementation><![CDATA[
	q:name="" "Не указан код свойства"
	s ClassName="Goods.Goods"
	s ErrorDescription="Извините, ошибка при удалении свойства."

	s cdef=##class(%Dictionary.ClassDefinition).%OpenId(ClassName)
	i '$ISOBJECT(cdef) $$$WriteError("DeleteProperty не открыли класс "_ClassName_" в %Dictionary.ClassDefinition") q ErrorDescription
	
	s key=cdef.Properties.FindObjectId(ClassName_"||"_name)
	q:key="" "Goods.GoodsAction.DeleteProperty. Невозможно найти указанное свойство."
	s oid=cdef.Properties.RemoveAt(key)
	s ok=cdef.%Save()
	i '+ok $$$WriteObjError(ok) q ErrorDescription

	s glob=$NA(^mtempSklad($I,"Compile"))
 	k @glob
 	j Compile^cmpl(ClassName,glob)
 	while $G(@glob)="" {
 	h .05
 	}
 	q:@glob@("err")>0 @glob@("err",@glob@("err"))
 	k ^GoodsPropOrder(ClassName,name)
 	k ^Property(ClassName,name)
 	
 	q 1
]]></Implementation>
</Method>

<Method name="SaveGoods">
<Description>
Сохранение товара</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Group,Names,Values,TypesStr,Names2,Values2,GoodsId=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveGoodsErr",err=1
 s CurrentLogin=$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
 if '##class(Common.Rights).getrights(CurrentLogin,9) q "Нет прав для работы с товаром."
 s ErrorDescription="Извините, ошибка при сохранении товара, попробуйте сохранить с другими параметрами."
 //Соберём все свойства в массив
 f i=1:1:$L(Names2,"~")-1 d
 . s Params($P(Names2,"~",i))=$P(Values2,"~",i)
  TSTART
 //Если предоставили ID товара попытаемся открыть
 //иначе делаем новый
 i GoodsId'="" d
 . s tov=##class(Goods.Goods).%OpenId(GoodsId),new=0
 . i '$ISOBJECT(tov) s tov=##class(Goods.Goods).%New(),new=1
 e  s tov=##class(Goods.Goods).%New(),new=1
 s check=1
 //Присвоим товару все его свойства
 f i=1:1:$L(Names,"~")-1 q:'+check  d 
 . s PropType=$P(TypesStr,"~",i)
 . s PropName=$P(Names,"~",i)
 . //тип свойства может быть 27@Package.Class или @%String или @%Date
 . i $E($P(PropType,"@",2),1,1)'="%" d  //тип свойства
 . . d $ZOBJMETHOD(tov,PropName_"SetObjectId",$P(PropType,"@",1))
 . e  d
 . . s value=$P(Values,"~",i)
 . . s check=##class(Common.Common).CheckPattern("Goods.Goods",PropName,value)
 . . q:'+check
 . . d:PropType="@%Date" 
 . . . i value'="" s value=$ZDH(value,4)
 . . . e  s value=+$H
 . . set $ZOBJPROPERTY(tov, PropName) = value
 
 q:'+check check
 //Теперь если новый то надо создать Params и присвоить их,
 //а если старый апдейтить старые и присвоить новые парамс
 i new d
 . s i="" f  s i=$O(Params(i)) q:i=""  d
 . . d:$G(Params(i))'=""
 . . . s param=##class(Goods.GoodsParams).%New()
 . . . s param.Gvalue=Params(i)
 . . . d param.ParamSetObjectId(i)
 . . . d tov.Params.Insert(param)
 e  d
 . f i=1:1:tov.Params.Count() d
 . . s ParamID=tov.Params.GetAt(i).Param.%Id()
 . . s tov.Params.GetAt(i).Gvalue=$G(Params(ParamID))
 . . k Params(ParamID)
 . s i="" f  s i=$O(Params(i)) q:i=""  d
 . . d:$G(Params(i))'=""
 . . . s param=##class(Goods.GoodsParams).%New()
 . . . s param.Gvalue=Params(i)
 . . . d param.ParamSetObjectId(i)
 . . . d tov.Params.Insert(param)

 //Сохраняем товар
 s err=tov.%Save()
 i '+err $$$WriteObjError(err) q ErrorDescription
 s tov=tov.%Id()

 //Запишем товар в соответствующую группу
 d:new
 . s GoodsGroup=##class(Goods.GoodsGroup).%New()
 . d GoodsGroup.GoodsSetObjectId(tov)
 . d GoodsGroup.GroupsSetObjectId(Group)
 . s err=GoodsGroup.%Save()
 i '+err $$$WriteObjError(err) q ErrorDescription
 TCOMMIT
 q err
SaveGoodsErr
 $$$WriteError($ZE)
 q "Извините, ошибка при сохранении товара, попробуйте с другими параметрами."
]]></Implementation>
</Method>

<Method name="DeleteGoods">
<Description><![CDATA[
Удаление товара
<br><var>id</var> - id товара]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id=""</FormalSpec>
<Implementation><![CDATA[
 n countid
 q:id="" 1
 s countid=0
 &sql(select count(id) into :countid from Docs.DocItems where Goods=:id)
 q:countid "Товар уже был использован в документах, удаление невозможно."
 TSTART
 &sql(delete from Goods.GoodsParams where Goods=:id)
 if SQLCODE<0 $$$WriteError("DeleteGoods 1 SQLCODE="_SQLCODE) q "Извините, внутренняя ошибка при удалении товара."
 s ok=##class(Goods.Goods).%DeleteId(id)
 i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при удалении товара."
 &sql(delete from Goods.GoodsGroup where Goods=:id)
 if SQLCODE<0 $$$WriteError("DeleteGoods 2 SQLCODE="_SQLCODE) q "Извините, внутренняя ошибка при удалении товара."
 TCOMMIT
 q 1
]]></Implementation>
</Method>

<Method name="SaveGoodsParams">
<Description>
Сохранить дополнительное свойство товара</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Value,Param</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveGoodsParamsErr"
 q:$G(Goods)="" "Не указан товар"
 q:$G(Value)="" "Не указано значение"
 q:$G(Param)="" "Не указано свойство"
  
 &sql(select id into :id from Goods.GoodsParams where Param=:Param and Goods=:Goods)
 //Если не нашли то Свойство и Товар сами заполним
 if ('%ROWCOUNT)&(SQLCODE) d
 . s idObj=##class(Goods.GoodsParams).%New()
 . d idObj.ParamSetObjectId(Param)
 . d idObj.GoodsSetObjectId(Goods)
 e  s idObj=##class(Goods.GoodsParams).%OpenId(id)
 s idObj.Gvalue=Value
 s ok=idObj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, ошибка при сохранении свойства товара"
 q ok
SaveGoodsParamsErr
 $$$WriteError($ZE)
 q "Извините, ошибка при сохранении свойства товара"
]]></Implementation>
</Method>

<Method name="DeleteGoodsParam">
<Description><![CDATA[
Удалить описание дополнительного свойства товара
<br><var>ParamID</var> - id дополнительного свойства]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ParamID</FormalSpec>
<Implementation><![CDATA[
	q:ParamID="" "Не найден код параметра"
	s $ZT="DeleteGoodsParamErr"
	s ok=##class(Goods.Params).%DeleteId(ParamID)
	//удаляем без оглядки на Склад, ибо уникален ParamID внутри всей программы
	&sql(delete from Goods.GoodsParams where Param=:ParamID)
	i SQLCODE<0 $$$WriteError("Goods.GoodsAction.DeleteGoodsParam SQLCODE="_SQLCODE) q "Извините, ошибка при удалении дополнительного свойства товара."
	q 1
DeleteGoodsParamErr
 $$$WriteError($ZE)
 q "Извините, ошибка при удалении дополнительного свойства товара."
]]></Implementation>
</Method>

<Method name="GetGoodsFromParams">
<ClassMethod>1</ClassMethod>
<FormalSpec>fields,where</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetGoodsFromParamsErr"
 s field=$P(where,"~",1)
 s equal=$P(where,"~",2)
 s value=$P(where,"~",3)
 d:(equal[">")!(equal["<") MoreLess(field,equal,value,.result)
 d:(equal="=") Equal(field,equal,value,.result)
 d:(equal="<>") NotEqual(field,equal,value,.result)
 d ..ShowObjects("Goods.Goods",fields,.result)
 q
Equal(field,equal,value,result)
 s $ZT="GetGoodsFromParamsErr"
 m result=^GoodsPar(field,value)
 q
NotEqual(field,equal,value,result)
 s $ZT="GetGoodsFromParamsErr"
 s i="" f  s i=$O(^GoodsPar(field,i)) q:i=""  d
 . q:i=value
 . m result=^GoodsPar(field,i)
 q
MoreLess(field,equal,value,result)
 s $ZT="GetGoodsFromParamsErr"
 d:(equal[">")!(equal["<")
 . i equal[">" s direction="1"
 . i equal["<" s direction="-1"
 . i equal["=" m result=^GoodsPar(field,value)
 . s i=value
 . f  s i=$O(^GoodsPar(field,i),direction) q:i=""  d
 . . s go="" f  s go=$O(^GoodsPar(field,i,go)) q:go=""  d
 . . . s result(go)=1
 q
GetGoodsFromParamsErr
 s ^Errors($H,"$ZE")=$ZE
 q
]]></Implementation>
</Method>

<Method name="ShowObjects">
<Description>
Показать объекты указанного класса
Класс выводимых объектов, поля которые необходимо вывести, надо ли показывать в xml, замена</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ClassName,fields,&Objects,xml=0,zamena=""]]></FormalSpec>
<Implementation><![CDATA[
 s $ZT="ShowObjectsErr"
 s depot=$G(%session.Data("depot"))
 w:'+xml "#@#"
 W:xml "<?xml version=""1.0"" encoding=""windows-1251"" ?>"
 W:xml "<root>"
 W:xml "<AllObjects>"
 s i="" f  s i=$O(Objects(i)) q:i=""  d
 . W:xml "<OneObject>"
 . s object=$ZOBJCLASSMETHOD(ClassName,"%OpenId",i)
 . i '$ISOBJECT(object) W:xml "</OneObject>" d ##class(Common.Common).saveerror("Не открылся объект "_i_" класса "_ClassName,"Goods.GoodsAction.ShowObjects")
 . q:'$ISOBJECT(object)
 . s $P(OutString,"~",1)=i
 . d:ClassName="Goods.Goods"
 . . s addr=""
 . . s quant=##class(Goods.GoodsAction).getgoodquant(i,depot,.addr)
 . . s price=##class(Goods.GoodsAction).getprice(i)
 . f z=1:1:$L(fields,",") d
 . . s field=$P($P(fields,",",z),"->")
 . . s shownfield=field
 . . i zamena'="" s shownfield=$G(^Substitute(zamena,field),field)
 . . w:xml "<"_shownfield_" id="""_i_""">"
 . . s value=$ZOBJPROPERTY(object,field)
 . . i shownfield="Goods" s tovname=value
 . . d:value'=""
 . . . i $ISOBJECT(value) d
 . . . . w:xml "<ObjectValue>"_value_"</ObjectValue>"
 . . . . s value=$ZOBJPROPERTY(value,"Name")
 . . . e  s value=$ZOBJMETHOD(object,field_"LogicalToDisplay",value)
 . . s $P(OutString,"~",z+1)=value
 . . i shownfield="Price" s value=+$G(price)
 . . w:xml "<text>"_value_"</text>"
 . . w:xml "</"_shownfield_">"
 . d:ClassName="Goods.Goods"
 . . W:(xml)&('quant) "<comment>Внимание! Товар "_tovname_" отсутствует на складе "_$G(%session.Data("depotName"))_" замените товар.</comment>"
 . W:xml "</OneObject>"
 . w:'+xml OutString_"#@#"
 W:xml "</AllObjects>"
 W:xml "<comment>"
 W:xml ""
 W:xml "</comment>"
 W:xml "</root>"
 q
ShowObjectsErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="getgoodquant">
<Description><![CDATA[
получить максимальное количество товара на складе и массив всех его ячеек
<br><var>goods</var> - товар (ID)
<br><var>depot</var> - склад ID на котором искать (можно не указывать)
<br><var>addr</var> - массив (по ссылке) в который запишем ячейки товара 
<li>addr=ID_ячейки (с максимальным количеством)
<li>addr("value",Количество_"."_Счётчик,"addr")=ID_ячейки
<br><var>quant</var> - минимальное количество которое требуется в ячейке которая будет в переменной addr]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[goods="",depot="",&addr,quant=0]]></FormalSpec>
<ReturnType>%Numeric</ReturnType>
<Implementation><![CDATA[
 q:goods=""
 k addr
 i $ISOBJECT(goods) s goods=goods.%Id()
 i $ISOBJECT(depot) s depot=depot.%Id()
 i depot'="" s DepotCondition="and Address->Depot="_depot
 s sqlquery="select ID,(Value1-Value2) as val,Address as addr from Store.Quantity where Goods="_goods_" and (Value1-Value2)>="_quant_" and Address->block=1 "_$G(DepotCondition)
 s rs=##class(%Library.ResultSet).%New() 
 s ok=rs.Prepare(sqlquery)
 i $$$ISERR(ok) $$$WriteObjError(ok) q "Извините. Внутренняя ошибка при поиске товара."
 s ok=rs.Execute()
 i $$$ISERR(ok) $$$WriteObjError(ok) q "Извините. Внутренняя ошибка при поиске товара."
 while rs.Next() {
 	i $i(count)
 	s val=rs.Data("val")
 	s addr=rs.Data("addr")
 	s StoreQntID=rs.Data("ID")
 	//count - шоп не затирались строки, если вдруг одинаковое количество в разных ячейках
 	s addr("value",+(val_"."_count),"addr")=addr
 	s addr("value",+(val_"."_count),"val")=+val
 	s addr("value",+(val_"."_count),"StoreQntID")=StoreQntID
 	s addr("addr",addr)=val
 	s addr("value")=$G(addr("value"))+val	//накапливаем общее количество 
 }
 //если общее количество меньше требуемого, то выходим с нулём
 i '+$G(addr("value"))<quant q 0
 s last=$O(addr("value",""),-1)
 d:+last 
 . s addr=$G(addr("value",last,"addr"))
 . s val=$P(last,".")
 q +$G(val)
]]></Implementation>
</Method>

<Method name="goodsfromstore">
<ClassMethod>1</ClassMethod>
<FormalSpec>addr,q1,q2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="selgoodsfromstoreErr"
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("number","№",40)
  $$$WriteHeader("FullName","Полное наименование",240)
  $$$WriteHeader("Property5300","Номер по схеме",140)
  $$$WriteHeader("kol","Количество",80)
  $$$WriteHeader("rezerv","Резерв",80)
  $$$WriteHeader("brak","Брак",80)
  $$$WriteHeader("brakDoc","Документ брака",80)
  $$$WriteHeader("brakDocDate","Дата документа брака",80)
  $$$WriteHeader("brakKontr","Контрагент брака",80)
  
 s sc=xmlstr.EndElement()
 	//основное количество
  	&sql(declare zz cursor for 
  	select Goods->FullName,Goods->Property5300,Goods,Value1,Value2
  	into :FullName,:Property5300,:GoodsId,:Value1,:Value2
  	from Store.Quantity where Address=:addr)
  	&sql(open zz)
  	f  &sql(fetch zz) q:SQLCODE  d
  	. s Goods(GoodsId,"FullName")=FullName
  	. s Goods(GoodsId,"Property5300")=Property5300
  	. s Goods(GoodsId,"number")=$I(i)
  	. s Goods(GoodsId,"kol")=Value1
  	. s Goods(GoodsId,"rezerv")=Value2
  	&sql(close zz)
 	
 	
 	//Брак
   	&sql(declare zz2 cursor for 
  	select Goods->FullName,Goods->Property5300,Goods,Qnt,SourceDoc->Name,SourceDoc->Kontr->Name,SourceDoc->Dat
  	into :FullName,:Property5300,:GoodsId,:Qnt,:SourceDocName,:KontrName,:SourceDocDate
  	from Store.Brak where Address=:addr)
  	&sql(open zz2)
  	f  &sql(fetch zz2) q:SQLCODE  d
  	. s Goods(GoodsId,"FullName")=FullName
  	. s Goods(GoodsId,"Property5300")=Property5300
  	. s Goods(GoodsId,"number")=$I(i)
  	. s Goods(GoodsId,"brak")=Qnt
   	. s Goods(GoodsId,"brakDoc")=SourceDocName
   	. s Goods(GoodsId,"brakKontr")=KontrName
   	. s Goods(GoodsId,"brakDocDate")=SourceDocDate
  	&sql(close zz2)

 
 s sc=xmlstr.Element("AllObjects")
  	s GoodsId="" f  s GoodsId=$O(Goods(GoodsId)) q:GoodsId=""  d
  	. s sc=xmlstr.Element("OneObject")
  	. s sc=xmlstr.WriteAttribute("id",GoodsId)
  	. $$$WriteElementTwice("FullName",$G(Goods(GoodsId,"FullName")))
  	. $$$WriteElementTwice("Property5300",$G(Goods(GoodsId,"Property5300")))
  	. $$$WriteElementTwice("number",$G(Goods(GoodsId,"number")))
  	. $$$WriteElementTwice("kol",+$G(Goods(GoodsId,"kol")))
  	. $$$WriteElementTwice("rezerv",+$G(Goods(GoodsId,"rezerv")))
  	. $$$WriteElementTwice("brak",+$G(Goods(GoodsId,"brak")))
  	. $$$WriteElementTwice("brakDoc",$G(Goods(GoodsId,"brakDoc")))
  	. $$$WriteElementTwice("brakKontr",$G(Goods(GoodsId,"brakKontr")))
  	. s brakDocDate=$G(Goods(GoodsId,"brakDocDate"))
  	. s:brakDocDate?5N brakDocDate=$ZD(brakDocDate,4)
  	. $$$WriteElementTwice("brakDocDate",brakDocDate)
  	. s sc=xmlstr.EndElement()
 
 s sc=xmlstr.EndElement()
 $$$EndXML
 q
selgoodsfromstoreErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="delimg">
<Description><![CDATA[
Удалить изображение товара
<br><var>gid</var> - ID товара
<br><var>img</var> - имя файла изображения
<br><var>curcsp</var> - url текущей страницы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gid,img,curcsp</FormalSpec>
<Implementation><![CDATA[
 s $ZT="delimgErr"
 s file=$P(img,"/",$L(img,"/"))
 s path=$P(curcsp,"?",1,$L(curcsp,"?")-1)
 s filefordel=$P($ZU(86),"\",1,$L($ZU(86),"\")-1)_$TR(path,"?","\")_"\csp\sklad2\GoodsImages\"_file
 q:gid="" "Не указан код товара"
 q:img="" "Не указан файл для удаления"
 s ok=##class(%Library.File).Delete(filefordel)
 i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при удалении файла"
 s obj=##class(Goods.Goods).%OpenId(gid)
 i '$ISOBJECT(obj) q "Не удалось найти запись о товаре"
 s images=obj.Images
 f i=1:1:$L(images,"\") d
 . s cf=$P(images,"\",i)
 . q:cf=file
 . s ss=$G(ss)_cf_"\"
 s ss=$E($G(ss),1,$L($G(ss))-1)
 s obj.Images=ss
 s ok=obj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при удалении файла"
 q 1
delimgErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при удалении файла"
]]></Implementation>
</Method>

<Method name="FromCardInGroup">
<Description><![CDATA[
скопировать содержимое буфера обмена в текущую группу
<br><var>cardid</var> - id карточки товара (в данном случае буфер обмена)
<br><var>destination</var> - ID группы - куда вставить товары]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>cardid,destination</FormalSpec>
<Implementation><![CDATA[
 s $zt="FromCardInGroupErr"
 i destination="" $$$WriteError("destination=""""") q "Извините. Внутренняя ошибка при записи товаров в группу."
 s goods=##class(Goods.CardAction).GetCard(cardid, "Goods.Goods")
 //определеим принадлежность группы-назначения к каталогу и складу
 &sql(select Depot,Catalogue into :GroupsDepot,:GroupsCatalogue from Goods.Group where ID=:destination)
 i SQLCODE $$$WriteError("SQLCODE=100") q "Извините. Не найдено описание группы - назначения для копирования"
 f i=1:1:$L(goods,"~") d
 . s currentgood=$P(goods,"~",i)
 . q:currentgood=""
 . //удаляем этот товар в каталоге данной группы
 . &sql(delete from Goods.GoodsGroup where Goods=:currentgood and Groups->Catalogue=:GroupsCatalogue and Groups->Depot=:GroupsDepot)
 . s o=##class(Goods.GoodsGroup).%New()
 . d o.GoodsSetObjectId(currentgood)
 . d o.GroupsSetObjectId(destination)
 . d o.%Save()
 . k o
 d ##class(Goods.CardAction).DelCard(cardid, "Goods.Goods")
 q 1
FromCardInGroupErr
 $$$WriteError($ZE)
 q "Извините. Внутренняя ошибка при записи товаров в группу."
]]></Implementation>
</Method>

<Method name="prices">
<ClassMethod>1</ClassMethod>
<FormalSpec>goodsid,allprices,q2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="pricesErr"
 $$$StartXML
 
  &sql(select max(Dat) as d,max(Tim) as t into :d,:t from Store.Price where Goods=:goodsid)
  i (d="")||(t="") $$$EndXML q
  
  s rs=##class(%ResultSet).%New()
  s sql="select Price,Dat,Tim,typcen,typcen->Name as typcenname,User1->Name as username from Store.Price where Goods="_goodsid
  s:allprices="true" sql=sql_" order by Dat,Tim DESC"
  s ok=rs.Prepare(sql)
  i '+ok $$$WriteObjError(ok) $$$EndXML q 0
  s ok=rs.Execute()
  i '+ok $$$WriteObjError(ok) $$$EndXML q 0
 s glob=$NA(^mtempCena(%session.Data("user")))
 k @glob
 While rs.Next() {
 i $I(i) 
 s Dat=$G(rs.Data("Dat"))
 s Tim=$G(rs.Data("Tim"))
 s @glob@("whole",i,"Dat")=Dat
 s @glob@("whole",i,"Tim")=Tim
 s @glob@("whole",i,"Price")=$G(rs.Data("Price"))
 s @glob@("whole",i,"typcen")=$G(rs.Data("typcen"))
 s @glob@("whole",i,"username")=$G(rs.Data("username"))
 s @glob@("whole",i,"typcenname")=$G(rs.Data("typcenname"))
 
 s @glob@("typcen",$G(rs.Data("typcen"),"undef"),Dat,Tim,"Price")=$G(rs.Data("Price"))
 s @glob@("typcen",$G(rs.Data("typcen"),"undef"),Dat,Tim,"username")=$G(rs.Data("username"))
 s cennames($G(rs.Data("typcen"),"undef"))=$G(rs.Data("typcenname"))
  }

  s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("typcen"," ",150)
	 $$$WriteHeader("price","Цена",80)
	 $$$WriteHeader("dat","Дата",100)
	 $$$WriteHeader("tim","Время",100)
	 $$$WriteHeader("user","Отв. лицо",200)
  s sc=xmlstr.EndElement()

 s sc=xmlstr.Element("AllObjects")
 //i $Increment(str)
 //вывести только актуальные цены
  d:allprices="false"
  . s i="" f  s i=$O(@glob@("typcen",i)) q:i=""  d
  . .s Dat=$O(@glob@("typcen",i,""),-1)
  . .s Tim=+$O(@glob@("typcen",i,Dat,""),-1)
  . .s price=$G(@glob@("typcen",i,Dat,Tim,"Price"))
  . .s usr=$G(@glob@("typcen",i,Dat,Tim,"username"))
  . .s typcen=$G(cennames(i)," ")
  . .s sc=xmlstr.Element("OneObject")
  . .$$$WriteElementTwice("typcen",typcen)
  . .$$$WriteElementTwice("dat",$ZD(Dat,4))
  . .$$$WriteElementTwice("tim",$ZT(Tim))
  . .$$$WriteElementTwice("price",price)
  . .$$$WriteElementTwice("user",usr)
  . .s sc=xmlstr.EndElement()

  //вывести все цены
  d:allprices="true"
  . s i="" f  s i=$O(@glob@("whole",i)) q:i=""  d
  . .s Dat=$G(@glob@("whole",i,"Dat"))
  . .s Tim=$G(@glob@("whole",i,"Tim"))
  . .s price=$G(@glob@("whole",i,"Price"))
  . .s usr=$G(@glob@("whole",i,"username"))
  . .s typcen=$G(@glob@("whole",i,"typcenname"))
  . .s sc=xmlstr.Element("OneObject")
  . .$$$WriteElementTwice("typcen",typcen)
  . .$$$WriteElementTwice("dat",$ZD(Dat,4))
  . .$$$WriteElementTwice("tim",$ZT(Tim))
  . .$$$WriteElementTwice("price",price)
  . .$$$WriteElementTwice("user",usr)
  . .s sc=xmlstr.EndElement()

  s sc=xmlstr.EndElement()
 $$$EndXML
 
 q 1
pricesErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="getprice">
<ClassMethod>1</ClassMethod>
<FormalSpec>goodsid</FormalSpec>
<Implementation><![CDATA[
 s tovobj=##class(Goods.Goods).%OpenId(goodsid)
 q:'$ISOBJECT(tovobj) 0.00
 q $J(tovobj.Price,".",2)
]]></Implementation>
</Method>

<Method name="goodsbykontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>dates,kontr,p1</FormalSpec>
<Implementation><![CDATA[
 s $ZT="goodsbykontrErr"
 s dat1=$P(dates,"@",1)
 s dat2=$P(dates,"@",2)
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))

 $$$StartXML
   s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",40)
	 $$$WriteHeader("doctype","Документ",80)
	 $$$WriteHeader("docdat","Дата",80)
	 $$$WriteHeader("doctim","Время",80)
	 $$$WriteHeader("goodsnam","Товар",80)
	 $$$WriteHeader("price","Цена",80)
	 $$$WriteHeader("quant","Количество",80)
	 $$$WriteHeader("summ","Сумма",80)
  s sc=xmlstr.EndElement()
  s rs=##class(%ResultSet).%New()
  s sql="select doc as docid,doc->DocumentClass->Name as doctype,doc->Dat as docdat,doc->Tim as doctim,goods->Name as goodsnam,Price as price,Quantity as quant from Docs.DocItems where doc->Dat>="_dat2_" and doc->Dat<="_dat2_" and doc->Kontr="_kontr
  s ok=rs.Prepare(sql)
  i '+ok $$$WriteObjError(ok) $$$EndXML q 
  s ok=rs.Execute()
  i '+ok $$$WriteObjError(ok) $$$EndXML q 
  
  s sc=xmlstr.Element("AllObjects")
  while rs.Next(){
	i $i(i)
  	s sc=xmlstr.Element("OneObject")
  	$$$WriteElementTwice("number",i)
  	$$$WriteElementTwice("doctype",$G(rs.Data("doctype")))
  	s docdat=$G(rs.Data("docdat"))
  	i docdat'="" s docdat=$ZD(docdat,4)
  	$$$WriteElementTwice("docdat",docdat)
  	s doctim=$G(rs.Data("doctim"))
  	i doctim'="" s doctim=$ZT(doctim)
  	$$$WriteElementTwice("doctim",doctim)
  	$$$WriteElementTwice("goodsnam",$G(rs.Data("goodsnam")))
  	s price=$G(rs.Data("price"))
  	$$$WriteElementTwice("price",$J(price,".",2))
  	s quant=$G(rs.Data("quant"))
  	$$$WriteElementTwice("quant",quant)
  	$$$WriteElementTwice("summ",$J(quant*price,".",2))
  	s sc=xmlstr.EndElement()
  }
  s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
goodsbykontrErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="fromgroup">
<ClassMethod>1</ClassMethod>
<FormalSpec>where,fields,CalculateQuantity=1</FormalSpec>
<Implementation><![CDATA[
 s $ZT="fromgroupErr"
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
 s sc=xmlstr.WriteAttribute("addcols","true")
 Set result = ##class(%ResultSet).%New("Store.Depot:Common")
 s ok=result.Execute()
 s i=0
 while result.Next(){
	i $I(i)
	s depid=$G(result.Data("ID"),"undef")
	s depots(depid)=$G(result.Data("Name"),"undef")
	$$$WriteHeader("depot"_depid,depots(depid)_" свободно",100)
 }
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 s rs=##class(%ResultSet).%New()
 s sql="select Goods,"_fields_" from Goods.GoodsGroup where "_where
 s ^mtempArt("Goods.GoodsAction.fromgroup_fields")=sql
 s ^mtempArt("Goods.GoodsAction.fromgroup_sql")=sql
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q
 s ok=rs.Execute()
 f i=1:1:rs.GetColumnCount() d 
 . s columns(i)=rs.GetColumnName(i)
 . s columns(i,"enum")=##class(%Dictionary.CompiledMethod).%ExistsId("Goods.Goods||"_columns(i)_"LogicalToDisplay")

 while rs.Next(){
  	s sc=xmlstr.Element("OneObject")
  	s goods=$G(rs.Data("Goods"))
	s sc=xmlstr.WriteAttribute("id",goods)
  	s i="" f  s i=$O(columns(i)) q:i=""  d
  	. s txt=rs.Data(columns(i))
  	. //для отбора товаров для плана руководителя, нужны закупочные цены товаров
  	. //запрос на закупочные цены идёт третьим параметром "ХХХ@1", то есть $P()
  	. if columns(i)="Price",$P(CalculateQuantity,"@",2) s txt=..GetPriceType(goods,4)
  	. i columns(i,"enum") s txt=$ZOBJCLASSMETHOD("Goods.Goods",columns(i)_"LogicalToDisplay",txt)
  	. $$$WriteElementTwice(columns(i),txt)
  	k quant
  	s:CalculateQuantity ok=##class(Store.Action).GetQuantByGoods(goods,.quant)
  	s i="" f  s i=$O(quant(i)) q:i=""  d
  	. i CalculateQuantity s Quantity=+$G(quant(i))	//-$G(quant(i,"rezerv"))
  	. e  s Quantity=""
  	. $$$WriteElementTwice("depot"_i,Quantity)
  	s sc=xmlstr.EndElement()
 }
  	s sc=xmlstr.EndElement()

 $$$EndXML
 q 1
fromgroupErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="kurs">
<ClassMethod>1</ClassMethod>
<FormalSpec>other,Dat=0</FormalSpec>
<Implementation><![CDATA[
 s i="" f  s i=$O(^Tunes(3,i)) q:i=""  d
 . s other(i)=$G(^Tunes(3,i,"Value"))
 if Dat d
 . &sql(select Name into :Name from Common.Dictionary16 where Dat=:Dat)
 . if SQLCODE s Name=0
 if $G(Name) q Name	//если передали дату и на эту дату есть запись в истории курсов
 q $$$TunesVariableGlobal("innerkurs")
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//метод очищает содержимое товарной группы

]]></Content>
</UDLText>

<Method name="cleargrup">
<ClassMethod>1</ClassMethod>
<FormalSpec>grupid</FormalSpec>
<Implementation><![CDATA[
 &sql(delete from Goods.GoodsGroup where Groups=:grupid)
 q 1
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// вставляет в указанную группу все товары не привязанные к какой либо группе

]]></Content>
</UDLText>

<Method name="fillgrup">
<ClassMethod>1</ClassMethod>
<FormalSpec>grupid</FormalSpec>
<Implementation><![CDATA[
 s $ZT="fillgrupErr"
 s ok=1,err="Извините, ошибка при выполнении операции"
 i $ISOBJECT(%session) s user=$G(%session.Data("user"),"lostuser")
 e  s user="undef"
 s glob=$NA(^mtempGlob("goodsingr",user))
 k @glob
 &sql(declare goodsingr cursor for select goods into :goods from Goods.GoodsGroup)
 &sql(open goodsingr)
 f  &sql(fetch goodsingr) q:SQLCODE  d
 . s @glob@(goods)=1
 &sql(close goodsingr)
 
 s allgoods=$NA(^Goods.GoodsD)
 s i="" f  s i=$O(@allgoods@(i)) q:(i="")!('+ok)  d
 . i $I(ii)
 . i '$D(@glob@(i)) d
 . . s gr=##class(Goods.GoodsGroup).%New()
 . . d gr.GoodsSetObjectId(i)
 . . d gr.GroupsSetObjectId(grupid)
 . . s ok=gr.%Save()

 i '+ok $$$WriteObjError($ZE) q err
 q 1
fillgrupErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка в программе"
]]></Implementation>
</Method>

<Method name="RemoveFromGroup">
<Description><![CDATA[
Убрать товар из группы
<br><var>GoodsId</var> - ID или объект товара
<br><var>GroupId</var> - ID или объект товарной группы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId="",GroupId=""</FormalSpec>
<Implementation><![CDATA[
	i $ISOBJECT(GoodsId) s GoodsObject=GoodsId,GoodsId=GoodsId.%Id()
	i $ISOBJECT(GroupId) s GroupObject=GroupId,GroupId=GroupId.%Id()
	&sql(delete from Goods.GoodsGroup where Groups=:GroupId and Goods=:GoodsId)
	i %ROWCOUNT>0 q %ROWCOUNT
	i SQLCODE<0 $$$WriteError("RemoveFromGroup SQLCODE="_SQLCODE)
	q "Извините. Ошибка при удалении товара из группы"
]]></Implementation>
</Method>

<Method name="AddPriceGroup">
<Description>
Создать новую ценовую группу</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Name:%String="",Razdel="",p2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s GrObj=##class(Common.Dictionary12).%New()
 s GrObj.Name=Name
 s GrObj.Razdel=Razdel
 s ok=GrObj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. Внутренняя ошибка при создании ценовой группы."
 q GrObj.%Id()
]]></Implementation>
</Method>

<Method name="MovePriceGroup">
<Description>
Переместить ценовую группу в другой раздел</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GroupId,Razdel</FormalSpec>
<Implementation><![CDATA[
 s $ZT="MovePriceGroupErr"
 q:GroupId="" "Не указана ценовая группа"
 q:Razdel="" "Не указан новый раздел для ценовой группы."
 &sql(update Common.Dictionary12 set Razdel=:Razdel where ID=:GroupId)
 i SQLCODE $$$WriteError("MovePriceGroup SQLCODE="_SQLCODE) q "Извините. Ошибка при перемещении ценовой группы."
 q 1
MovePriceGroupErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при перемещении ценовой группы."
]]></Implementation>
</Method>

<Method name="SetNamePriceGroup">
<Description>
Изменить имя ценовой группы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",NewName:%String="",p1</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID="" "Ошибка. Не указана ценовая группа."
 s GrObj=##class(Common.Dictionary12).%OpenId(ID)
 i '$ISOBJECT(GrObj) q "Ошибка. Не найдена ценовая группа которой требуется изменить наименование."
 s GrObj.Name=NewName
 s ok=GrObj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. Внутренняя ошибка при изменении наименования ценовой группы."
 q 1
]]></Implementation>
</Method>

<Method name="DeletePriceGroup">
<Description>
Удалить ценовую группу</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",par1,par2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID="" "Ошибка. Не указана ценовая группа."
 q:$D(^Goods.GoodsI("izdelieInd",ID)) "Невозможно удалить ценовую группу содержащую товары"
 q ##class(Common.Common).DeleteItem("Common.Dictionary12",ID)
]]></Implementation>
</Method>

<Method name="GoodsPriceGroup">
<Description><![CDATA[
Добавить/Убрать товары из ценовой группы
<br><var>SelectedGoodsIDs</var> - список ID товаров через ~
<br><var>ID</var> - ID товарной группы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SelectedGoodsIDs:%String="",ID:%String="",p2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	k ^mtempArt
	s ^mtempArt("SelectedGoodsIDs")=SelectedGoodsIDs
	s ^mtempArt("ID")=ID
 s $ZT="GoodsPriceGroupErr"
 s SelectedGoodsIDs=$TR(SelectedGoodsIDs,"~",",")
 s rs=##class(%ResultSet).%New()
 s SqlQuery="update Goods.Goods set izdelie = "_ID_" where ID in ("_SelectedGoodsIDs_")"
 	s ^mtempArt("SqlQuery")=SqlQuery
 s ok=rs.Prepare(SqlQuery)
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при удалении товара из ценовой группы."
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при удалении товара из ценовой группы."
 q 1
GoodsPriceGroupErr
 $$$WriteError($ZE)
 q "Ошибка работе с товарами и ценовой группой."
]]></Implementation>
</Method>

<Method name="GoodsList">
<Description><![CDATA[
Вывести список товаров (для GoodsListEdit)
<br><var>Where</var> - where для SQL запроса]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Where:%String="",p1,p2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="GoodsListErr"

 s Fields("abbr","ValueField")="Goods->abbr"
 s Fields("abbr","ValueAlias")="abbr"
 
 s Fields("Property3609","ValueField")="Goods->Property3609"
 s Fields("Property3609","ValueAlias")="Property3609"
 
 s Fields("Name","ValueField")="Goods->Name"
 s Fields("Name","ValueAlias")="Name"
 
 s Fields("EnglishName","ValueField")="Goods->EnglishName"
 s Fields("EnglishName","ValueAlias")="EnglishName"
 
 s Fields("Weight","ValueField")="Goods->Weight"
 s Fields("Weight","ValueAlias")="Weight"
 
 s Fields("Size1","ValueField")="Goods->Size1"
 s Fields("Size1","ValueAlias")="Size1"
 
 s Fields("codedetail","ValueField")="Goods->codedetail"
 s Fields("codedetail","ValueAlias")="codedetail"
 
 s Fields("Property5300","ValueField")="Goods->Property5300"
 s Fields("Property5300","ValueAlias")="Property5300"
 
 q ##class(Docs.Action2).SqlQuery(.Fields,"Goods.GoodsGroup",Where,"Goods->ID")
GoodsListErr
 $$$WriteError($ZE)
 q "Ошибка формирования списка товаров"
]]></Implementation>
</Method>

<Method name="GetPriceType">
<Description><![CDATA[
Получить цену указанного типа
<br> GoodsId - ID товара (Goods.Goods)
<br> TypeId - ID типа цены (Common.Dictionary6)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId=0,TypeId=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s storeprice = $NA(^Store.PriceI("main",GoodsId,TypeId))
 q:'$D(@storeprice) 0
 s Dat=$O(@storeprice@(""),-1)
 q:Dat="" 0
 s Tim=$O(@storeprice@(Dat,""),-1)
 q:Tim="" 0
 s ID=$O(@storeprice@(Dat,Tim,""),-1)
 s Data=@storeprice@(Dat,Tim,ID)
 q $LG(Data,2)
]]></Implementation>
</Method>

<Method name="AddGoodToGroup">
<Description>
Добавить товар в указанную группу</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId:%String="",GroupId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="AddGoodToGroupErr"
 s count=$I(^Art)
 s ^Art(count,"GoodsId")=GoodsId
 s ^Art(count,"GroupId")=GroupId
 s GoodsGroupObj=##class(Goods.GoodsGroup).%New()
 d GoodsGroupObj.GoodsSetObjectId(GoodsId)
 d GoodsGroupObj.GroupsSetObjectId(GroupId)
 s ok=GoodsGroupObj.%Save()
 if '+ok $$$WriteObjError(ok) q "Извините, ошибка при попытке привязать товар к группе."
 q 1
AddGoodToGroupErr
 $$$WriteError($ZE)
 q "Извините, ошибка при попытке привязать товар к группе"
]]></Implementation>
</Method>

<Method name="GetGoodsPriceCateg">
<Description>
Получить ценовые группы, которым принадлежит товар
GoodsId - ID товара</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s $ZT="GetGoodsPriceCategErr"
	s izdelie = ##class(Goods.Goods).GetPropertyValue(GoodsId,"izdelie")
	q:izdelie="" ""
	s GroupName = ##class(Common.Dictionary12).GetPropertyValue(izdelie,"Name")
	s GroupRazdel = ##class(Common.Dictionary12).GetPropertyValue(izdelie,"Razdel")
	q GroupName_"("_GroupRazdel_")"
GetGoodsPriceCategErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при поиске группы товара"
]]></Implementation>
</Method>

<Method name="SetTovarFieldForGoods">
<Description>
Поставить указанное значение в поле Tovar для указанных товаров</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>IDs:%String="",Value:%String="null"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT = "DetachZapchastFromModelErr"
 s IDs = $$Replace(IDs,"#@#",",")
 if $E(IDs,$L(IDs))="," s IDs = $E(IDs,1,$L(IDs)-1)
 if Value '="null" s Value = "'"_Value_"'"
 s SqlString = "update Goods.Goods set Tovar = "_Value_" where ID in ("_IDs_")"
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(SqlString)
 if '+ ok $$$WriteObjError(ok) q "Извините. Ошибка при изменении списка запчастей."
 s ok=rs.Execute()
 if '+ ok $$$WriteObjError(ok) q "Извините. Ошибка при изменении списка запчастей"
 q 1
DetachZapchastFromModelErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при изменении списка запчастей."
Replace(String,SearchStr,Replacment)
 s Return = ""
 f i=1:1:$L(String,SearchStr) d
 . s Return = Return_$P(String,SearchStr,i)_Replacment
 if $E(Return,$L(Return)+1-$L(Replacment),$L(Return))=Replacment s Return = $E(Return,1,$L(Return)-$L(Replacment))
 q Return
]]></Implementation>
</Method>
</Class>


<Class name="Goods.GoodsGroup">
<Description>
Товары в группах</Description>
<Super>%Persistent</Super>
<TimeCreated>60324,75603.020859</TimeCreated>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="GoodsIndex">
<Properties>Goods</Properties>
</Index>

<Property name="Groups">
<Description>
Группа</Description>
<Type>Goods.Group</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Группы"/>
</Property>

<Index name="GroupIndex">
<Properties>Groups</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.GoodsGroupD</DataLocation>
<DefaultData>GoodsGroupDefaultData</DefaultData>
<IdLocation>^Goods.GoodsGroupD</IdLocation>
<IndexLocation>^Goods.GoodsGroupI</IndexLocation>
<StreamLocation>^Goods.GoodsGroupS</StreamLocation>
<Data name="GoodsGroupDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Catalogue</Value>
</Value>
<Value name="3">
<Value>Depot</Value>
</Value>
<Value name="4">
<Value>Goods</Value>
</Value>
<Value name="5">
<Value>Group</Value>
</Value>
<Value name="6">
<Value>Groups</Value>
</Value>
</Data>
<Property name="Goods"/>
<Property name="Groups"/>
</Storage>
</Class>


<Class name="Goods.GoodsKontrBan">
<Description>
Запрет использования товара контрагентом</Description>
<Super>%Persistent</Super>
<TimeCreated>62768,43373.94115</TimeCreated>

<Property name="Goods">
<Type>Goods.Goods</Type>
</Property>

<Property name="Kontr">
<Type>Common.Kontragent</Type>
</Property>

<Index name="GoodsKontr">
<Properties>Goods,Kontr</Properties>
<Unique>1</Unique>
</Index>

<Index name="KontrGoods">
<Properties>Kontr,Goods</Properties>
<Unique>1</Unique>
</Index>

<Method name="Convert">
<Description>
перетащить баны из старой системы в новую</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	k Array,Array2
	
	&sql(declare zz cursor for 
		select ID,kban into :GoodsId,:kban
		from Goods.Goods)
	&sql(open zz)
	f  &sql(fetch zz) q:SQLCODE  d
	. s Array(GoodsId)=kban
	&sql(close zz)
	
	/*
	&sql(declare zz2 cursor for 
		select ID into :KontrId 
		from Common.Kontragent)
	&sql(open zz)
	f  &sql(fetch zz) q:SQLCODE  d
	. m Array2(KontrId)=Array
	&sql(close zz)
	*/
	
	//&sql(delete from Goods.GoodsKontrBan)
	s goods = "" f  s goods=$O(Array(goods),1,data) q:goods=""  d
	. //w "goods="_goods,!
	. for i=1:1:$L(data,",") do
	. . s kontr=$P(data,",",i)
	. . q:kontr=""
	. . s ^GoodsKontrBan("Goods",goods,kontr)=""
	. . s ^GoodsKontrBan("Kontr",kontr,goods)=""
	. . //&sql(insert into Goods.GoodsKontrBan (Goods,Kontr) VALUES (:goods,:kontr) )
	q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.GoodsKontrBanD</DataLocation>
<DefaultData>GoodsKontrBanDefaultData</DefaultData>
<IdLocation>^Goods.GoodsKontrBanD</IdLocation>
<IndexLocation>^Goods.GoodsKontrBanI</IndexLocation>
<StreamLocation>^Goods.GoodsKontrBanS</StreamLocation>
<Data name="GoodsKontrBanDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Goods</Value>
</Value>
<Value name="3">
<Value>Kontr</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.GoodsParams">
<Description>
Параметры товаров</Description>
<Super>%Persistent,%XML.Adaptor</Super>
<TimeCreated>60332,396.283541</TimeCreated>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Cardinality>one</Cardinality>
<Inverse>Params</Inverse>
<Relationship>1</Relationship>
<Required>1</Required>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="GoodsIndex">
<Properties>Goods</Properties>
</Index>

<Property name="Gvalue">
<Description>
Значение</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Значение"/>
</Property>

<Index name="ValueIndex">
<Properties>Gvalue:EXACT</Properties>
</Index>

<Property name="Param">
<Description>
Свойство</Description>
<Type>Params</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Свойство"/>
</Property>

<Index name="ParamIndex">
<Properties>Param</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.GoodsParamsD</DataLocation>
<DefaultData>GoodsParamsDefaultData</DefaultData>
<IdLocation>^Goods.GoodsParamsD</IdLocation>
<IndexLocation>^Goods.GoodsParamsI</IndexLocation>
<StreamLocation>^Goods.GoodsParamsS</StreamLocation>
<Data name="GoodsParamsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Goods</Value>
</Value>
<Value name="3">
<Value>Param</Value>
</Value>
<Value name="4">
<Value>Value</Value>
</Value>
<Value name="5">
<Value>Gvalue</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.Group">
<Description>
Группа</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,84605.823539</TimeCreated>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Property name="Catalogue">
<Description>
Каталог</Description>
<Type>Goods.Catalogue</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Каталог"/>
</Property>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Index name="DepotIndex">
<Properties>Depot</Properties>
</Index>

<Index name="CatalogueIndex">
<Properties>Catalogue</Properties>
</Index>

<Property name="Code">
<Description>
Код группы</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Код группы"/>
</Property>

<Index name="CodeIndex">
<Properties>Code</Properties>
</Index>

<Property name="Parent">
<Description>
Code родительcкой группы</Description>
<Type>%String</Type>
<SqlComputeCode> 
		s {*}=##class(Goods.Group).GetParentCode({Code})
	</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<SqlComputeOnChange>Code</SqlComputeOnChange>
<Parameter name="CAPTION" value="Группа - родитель"/>
</Property>

<Index name="ParentIndex">
<Properties>Parent</Properties>
</Index>

<Property name="ParentGroup">
<Description>
Родительская группа</Description>
<Type>Group</Type>
<SqlComputeCode> 
		s {*}=##class(Goods.Group).GetParentId({ID})
</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<SqlComputeOnChange>Code,Catalogue,Depot</SqlComputeOnChange>
<Parameter name="CAPTION" value="ID род. группы"/>
</Property>

<Index name="ParentGroup">
<Properties>ParentGroup</Properties>
</Index>

<Method name="GetParentCode">
<Description>
Возвращает код родительской группы по коду подчиненной</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[	s len=$L(code,"*")-1  Q $p(code,"*",1,len)
]]></Implementation>
</Method>

<Method name="GetParentId">
<Description>
Определить идентификатор родительского узла</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 Q:'..%ExistsId($g(id)) ""
 s depot= ..DepotGetStored(id), cat=..CatalogueGetStored(id), code=..CodeGetStored(id)
 s code=..GetParentCode(code)
 Q ..GetParentIdBy(depot,cat,code)
]]></Implementation>
</Method>

<Method name="GetParentIdBy">
<Description>
Расчет родителя по значениям</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>depot:%String,cat:%String,code:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s id=""
 &sql( Select ID Into :id From Goods."Group" 
 		Where Depot=:depot And Catalogue=:cat And Code=:code 
 )
 Q:'SQLCODE id
 Q ""
]]></Implementation>
</Method>

<Method name="HasChild">
<Description>
Проверка на наличие дочерних </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>group:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	s child=""
	&sql(
		Select ID Into :child 
		From Goods."Group"
	  	Where ParentGroup=:group
	)
	if (SQLCODE=0)&&(child'="") Q 1
	Q 0
]]></Implementation>
</Method>

<Query name="Common">
<Type>%SQLQuery</Type>
<FormalSpec>Depot,Catalogue</FormalSpec>
<SqlQuery>SELECT Parent,Code,Name,ID FROM "Group"
where Catalogue=:Catalogue
 ORDER BY Code</SqlQuery>
</Query>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>PropertyName:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Trigger name="UpdTrigger">
<Description>
Набор триггеров и методов для поддержки версии справочника</Description>
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>UPDATE</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="InsTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>INSERT</Event>
<Time>AFTER</Time>
</Trigger>

<Trigger name="DelTrigger">
<Code> d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")</Code>
<Event>DELETE</Event>
<Time>AFTER</Time>
</Trigger>

<Method name="%OnDelete">
<ClassMethod>1</ClassMethod>
<FormalSpec>oid:%ObjectIdentity</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnBeforeSave">
<Description>
У группы есть два расчетных свойства (Parent,ParentGroup)
которые по коду группы определяют код родительской группы
а затем идентификатор родительской группы
Эти свойства срабатывают при работе через sql
Цель этого метода - рассчитывать их при работе через объекты</Description>
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ..Code'=""  {
		s ..Parent=..GetParentCode(..Code)
		#;s ^test($i(^test))=..Depot.%Id()
		#;s ^test($i(^test))=..Catalogue.%Id()
		#;s ^test($i(^test))=..Parent
		
		s ParentId=..GetParentIdBy(..Depot.%Id(),..Catalogue.%Id(),..Parent)
		#;s ^test($i(^test))=ParentId
		d ..ParentGroupSetObjectId(ParentId)	
	}
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnAfterSave">
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if (insert)||(%this.%IsModified()) d ##class(Common.Common).IncreaseCurrentDictVersion("Goods.Group")
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.GroupD</DataLocation>
<DefaultData>GroupDefaultData</DefaultData>
<IdLocation>^Goods.GroupD</IdLocation>
<IndexLocation>^Goods.GroupI</IndexLocation>
<StreamLocation>^Goods.GroupS</StreamLocation>
<Data name="GroupDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Code</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Catalogue</Value>
</Value>
<Value name="5">
<Value>Depot</Value>
</Value>
<Value name="6">
<Value>Parent</Value>
</Value>
<Value name="7">
<Value>ParentGroup</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.GroupAction">
<Description>
Действия с группами</Description>
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60322,72305.584415</TimeCreated>

<Method name="createGroup">
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue="",Name="",Code="",Sub=""</FormalSpec>
<Implementation><![CDATA[
	s $ZT="GroupActionError"
	q:Catalogue="" "Не указан каталог"
	q:Name="" "Не указано имя новой группы"
	i $ISOBJECT($G(%session)) s Depot=$G(%session.Data("depot"),1)
	e  s Depot=1
	q:Depot="" "Отсутствует код текущего склада"
 	i Sub=1 s ok=..GetLastSubItem(Catalogue,.Code)
 	e  s ok=..GetLastItem(Catalogue,.Code)
	s new=##class(Goods.Group).%New()
	d new.DepotSetObjectId(Depot)
	d new.CatalogueSetObjectId(Catalogue)
	s new.Code=Code
	s new.Name=Name
	s ok=new.%Save()
	i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при создании новой группы"
	q new.%Id()
GroupActionError
 s ^Errors($H,"$ZE")=$ZE
 q "Goods.GoodsAction "_$ZE
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
/*
ClassMethod createSubGroup(Catalogue, Name, Parent)
{
 s $ZT="createSubGroupErr"
 s Depot=%session.Data("depot")
 q:Depot="" "Отсутствует код текущего склада"
 &sql(select top 1 Code into :Code from Goods.Group where Depot=:Depot and Catalogue=:Catalogue and Parent=:Parent order by code DESC)
 q:SQLCODE<0 "Goods.GroupAction.createSubGroup SQLCODE="_SQLCODE
 i SQLCODE=100 s Code=Parent_"*0"
 s $P(Code,"*",$L(Code,"*"))=+$P(Code,"*",$L(Code,"*"))+1
 s new=##class(Goods.Group).%New()
 d new.DepotSetObjectId(Depot)
 d new.CatalogueSetObjectId(Catalogue)
 s new.Code=Code
 s new.Name=Name
 s ok=new.%Save()
 q ok
createSubGroupErr
 s ^Errors($H,"$ZE")=$ZE
 q "Goods.GoodsAction "_$ZE
}
*/
]]></Content>
</UDLText>

<Method name="DelGroup">
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue="",Code,GroupId</FormalSpec>
<Implementation><![CDATA[
 s $ZT="DelGroupErr"
 s Depot=%session.Data("depot")
 q:Depot="" "Отсутствует код текущего склада"
 
 &sql(select id into :id from Goods.Group where Depot=:Depot and Catalogue=:Catalogue and Parent=:Code)
 q:SQLCODE<0 "Goods.GroupAction.DelGroup() 1 SQLCODE="_SQLCODE
 q:'SQLCODE "Невозможно удалить группу содержащую подгруппы"
 
 &sql(select count(id) into :count from Goods.GoodsGroup where Groups=:GroupId)
 q:SQLCODE<0 "Goods.GroupAction.DelGroup() 2 SQLCODE="_SQLCODE
 q:count>0 "Невозможно удалить группу содержащую товары"

 &sql(select count(id) into :count from Goods.Params where Catalogue=:Catalogue and Groups=:Code)
 q:SQLCODE<0 "Goods.GroupAction.DelGroup() 3 SQLCODE="_SQLCODE
 q:count>0 "Невозможно удалить группу к которой привязаны свойства"

 &sql(delete from Goods.Group where id=:GroupId)
 q:SQLCODE<0 "Goods.GroupAction.DelGroup() 4 SQLCODE="_SQLCODE
 q 1
DelGroupErr
 s ^Errors($H,"$ZE")=$ZE
 q "Goods.GoodsAction "_$ZE
]]></Implementation>
</Method>

<Method name="GetLastItem">
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue="",Code="*"</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetLastItemErr"
 //s Depot=$G(%session.Data("depot"),1)
 s Depot=1
 s Parent=$Piece(Code,"*",1,$Length(Code,"*")-1)
 
 &sql(
 declare huu cursor for
 select Code into :lCode 
 from Goods.Group 
 where NULLIF(Parent,:Parent) is Null 
 	and Catalogue=:Catalogue 
 	and Depot=:Depot 
 order by Code desc)
 &sql(open huu)
 f  &sql(fetch huu) q:SQLCODE  d
 . s t=$P(lCode,"*",$L(lCode,"*"))
 . i t>+$G(res) s res=t
 &sql(close huu)
 i $G(res)="" s Code="*"
 s:Code="" Code="*"
 s $P(Code,"*",$L(Code,"*"))=+$G(res)+1
 q 1
GetLastItemErr
 $$$WriteError($ZE)
 q "Goods.GroupAction "_$ZE
]]></Implementation>
</Method>

<Method name="GetLastSubItem">
<ClassMethod>1</ClassMethod>
<FormalSpec>Catalogue="",Code=""</FormalSpec>
<Implementation><![CDATA[
  s $ZT="GetLastSubItemErr"
 //s Depot=$G(%session.Data("depot"),1)
 s Depot=1
 &sql(
 declare huu2 cursor for
 select Code into :lCode 
 from Goods.Group 
 where Parent=:Code and Depot=:Depot and Catalogue=:Catalogue 
 order by Code desc)
 &sql(open huu2)
 f  &sql(fetch huu2) q:SQLCODE  d
 . s t=$P(lCode,"*",$L(lCode,"*"))
 . i t>+$G(res) s res=t
 &sql(close huu2)
 s Code=Code_"*"_(+$G(res)+1)
 q 1
GetLastSubItemErr
 $$$WriteError($ZE)
 q "Goods.GroupAction "_$ZE
old
 //s $ZT="GetLastSItemErr"
 s Depot=%session.Data("depot")
 &sql(select top 1 Code into :LasSubCode from Goods.Group where Parent=:Code and Catalogue=:Catalogue and Depot=:Depot order by Code desc)
 q:SQLCODE<0 err="Goods.GoodsAction.GetLastItem() SQLCODE="_SQLCODE
 s:(SQLCODE=100)&(%ROWCOUNT=0) LasSubCode=Code_"*0"
 s $P(LasSubCode,"*",$L(LasSubCode,"*"))=+$P(LasSubCode,"*",$L(LasSubCode,"*"))+1
 s Code=LasSubCode
 q 1
]]></Implementation>
</Method>

<Method name="RenameGroup">
<Description><![CDATA[
Переименовывает товарную группу
<br><var>GroupID</var> - ID группы
<br><var>NewName</var> - Наименование группы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GroupID,NewName</FormalSpec>
<Implementation><![CDATA[
 s err="Извините, ошибка при переименовании группы"
 &sql(update Goods.Group set Name=:NewName where ID=:GroupID)
 i (SQLCODE<0)!(SQLCODE=100) $$$WriteError("RenameGroup SQLCODE="_SQLCODE) q err
 q 1
]]></Implementation>
</Method>
</Class>


<Class name="Goods.Measure">
<Description>
Единицы измерения</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,84102.288427</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.MeasureD</DataLocation>
<DefaultData>MeasureDefaultData</DefaultData>
<IdLocation>^Goods.MeasureD</IdLocation>
<IndexLocation>^Goods.MeasureI</IndexLocation>
<StreamLocation>^Goods.MeasureS</StreamLocation>
<Data name="MeasureDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.Params">
<Description>
Общие параметры товаров</Description>
<Super>%Persistent,%XML.Adaptor</Super>
<TimeCreated>60319,69667.192533</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Type">
<Description>
Тип</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Тип"/>
</Property>

<Property name="Code">
<Description>
Код</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Код"/>
</Property>

<Index name="CodeIndex">
<Properties>Code</Properties>
</Index>

<Property name="Groups">
<Description>
Группа</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Группа"/>
</Property>

<Index name="GroupIndex">
<Properties>Groups</Properties>
</Index>

<Property name="Catalogue">
<Description>
Каталог группы</Description>
<Type>Goods.Catalogue</Type>
<Parameter name="CAPTION" value="Каталог группы"/>
</Property>

<Index name="CatalogueIndex">
<Properties>Catalogue</Properties>
</Index>

<Property name="Parent">
<Description>
Свойство родитель</Description>
<Type>%String</Type>
<SqlComputeCode> Set {*} = $Piece({Code},"*",1,$Length({Code},"*")-1)</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value="Свойство родитель"/>
</Property>

<Index name="ParentIndex">
<Properties>Parent</Properties>
</Index>

<Query name="Common">
<Type>%SQLQuery</Type>
<SqlQuery>SELECT Code,Name,Parent,Type,ID FROM Params</SqlQuery>
</Query>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.ParamsD</DataLocation>
<DefaultData>ParamsDefaultData</DefaultData>
<IdLocation>^Goods.ParamsD</IdLocation>
<IndexLocation>^Goods.ParamsI</IndexLocation>
<StreamLocation>^Goods.ParamsS</StreamLocation>
<Data name="ParamsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Type</Value>
</Value>
<Value name="4">
<Value>Code</Value>
</Value>
<Value name="5">
<Value>Parent</Value>
</Value>
<Value name="6">
<Value>Catalogue</Value>
</Value>
<Value name="7">
<Value>Group</Value>
</Value>
<Value name="8">
<Value>Groups</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Goods.Users">
<Description>
Пользователи</Description>
<Super>%Persistent</Super>
<TimeCreated>60325,65020.197167</TimeCreated>

<Property name="User">
<Description>
Пользователь</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Пользователь"/>
</Property>

<Index name="UserIndex">
<Properties>User</Properties>
<Unique>1</Unique>
</Index>

<Property name="FIO">
<Description>
Ф.И.О.</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Ф.И.О."/>
</Property>

<Property name="Password">
<Description>
Пароль</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Пароль"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Goods.UsersD</DataLocation>
<DefaultData>UsersDefaultData</DefaultData>
<IdLocation>^Goods.UsersD</IdLocation>
<IndexLocation>^Goods.UsersI</IndexLocation>
<StreamLocation>^Goods.UsersS</StreamLocation>
<Data name="UsersDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>FIO</Value>
</Value>
<Value name="3">
<Value>Password</Value>
</Value>
<Value name="4">
<Value>User</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="json.Catalogue">
<Description>
Служба выгрузки каталогов</Description>
<Super>json.service2</Super>
<TimeCreated>62488,59165.527393</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Goods.Catalogue</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as nm</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String</Default>
</Parameter>
</Class>


<Class name="json.CommonDicts">
<Description>
Список справочников</Description>
<Super>json.service2</Super>
<TimeCreated>62532,63239.37434</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Common.Dicts</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as nm,Comment as cm</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Act">
<Description>
Выводит заголовки документов "Акт технического осмотра"
Настройки сняты с имеющейся системы </Description>
<Super>json.service2</Super>
<TimeCreated>62556,78136.6595</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Docs.Act</Default>
</Parameter>

<Parameter name="FIELDS">
<Description>
Список полей взят из действующей системы	 </Description>
<Type>%String</Type>
<Default><![CDATA[NameSorted as ns,Name as nm, Serial as sn,Paid as paid, Comment as cm, Garant as grn, ActDate as dt,	CustomerName as cst, DefectDescription as dfd, Kontr->Name as kn, NumbersHistory  as nmh,	PaidDate as pdt, RepairsQnt as rqnt, SellerName as sl, Source->Name as srcnm, SrvFIO as srvfio, SrvName as srvnm, User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.ActNote">
<Description>
Служба для документов данного типа</Description>
<Super>json.service2</Super>
<TimeCreated>62557,79690.543727</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.ActNote</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm, Chief->Name as chnm, CloseDate as cldt, CloseTime as cltm	,CloseUser->Name as clusnm, Comment as cm,Dat as dt, Kontr->Name as ktnm	,Manager as mng, PaymentPoluh->Name as pplnm	,Source->Name as srcnm, Stat as st, Summa as sum, Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Brakremont">
<Super>json.service2</Super>
<TimeCreated>62558,47987.617073</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Docs.Brakremont</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,	CloseDate as cldt,	CloseTime as cltm,	CloseUser->Name as clusnm,	Comment as cm,	Dat as dt,	Kontr->Name as ktnm,	Source->Name as srcnm,	Stat as stat,	Summa as sum,	Tim as tm,	User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Diff">
<Description>
Акты расхождения</Description>
<Super>json.service2</Super>
<TimeCreated>62566,5174.29904</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Diff</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.DocBrak">
<Super>json.service2</Super>
<TimeCreated>62568,5401.662328</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.DocBrak</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,datend as de,datpriem as dp,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Docs">
<Description>
Список типов документов системы</Description>
<Super>json.service2</Super>
<TimeCreated>62519,39346.029874</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Docs.Docs</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as nm,OperType as ot</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Inner">
<Super>json.service2</Super>
<TimeCreated>62568,42084.2956</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Inner</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.InnerDiff">
<Super>json.service2</Super>
<TimeCreated>62568,42270.652273</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.InnerDiff</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as com,Dat as dt,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,storeman->Name as stmnm,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Invent">
<Super>json.service2</Super>
<TimeCreated>62568,43064.495482</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Invent</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,Address->Name as adrnm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,FullName as flnm,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>
</Class>


<Class name="json.Docs.Otchet">
<Super>json.service2</Super>
<TimeCreated>62568,43526.814506</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Otchet</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[NameSorted as nms,Name as nm,Dat as dt,Summa as sum,Stat as st,ErrorDescription as erd,GotPaperProve as gpp,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,DatePaperProve as dtpp,Kontr->Name as ktnm,Kurs as cr,Rem->Name as rnm,Source->Name as srcnm,SummaCurrency as sumc,Tim as tm,User1->Name as usnm,UserPaperProve->Name as usnmpp]]></Default>
</Parameter>

<UDLText name="T">
<Content><![CDATA[
//Errors as err,

]]></Content>
</UDLText>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
  
  s oper=$G(qa("oper",1)) 
  Q:oper="add" ..Add(.qa) 
  Q:oper="edit" ..Edit(.qa) 
  Q:oper="del" ..Delete(.qa)
  
  if %session.Data("Login")'="" s qa("where")=" where Kontr->Code='"_%session.Data("Login")_"'"
  Q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="json.Docs.OtchetNote">
<Description>
нет данных?</Description>
<Super>json.service2</Super>
<TimeCreated>62568,46546.460605</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.OtchetNote</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Manager as mng,Otchet->Name as otnm,OurCompany->Name as ocnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Platejka">
<Super>json.service2</Super>
<TimeCreated>62568,47124.911513</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Platejka</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Kurs as cr,MastermaxSummCurr as mmcsum,MastermaxSummRub as mmsum,PlatejDate as pldt,Poluh->Name as plnm,RubSumma as sumr,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,TullSummCurr as tcsum,TullSummRub as tsum,Typeplatej->Name as tplnm,User1->Name as usnm,ViconteSummCurr as vccsum,ViconteSummRub as vcsum]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Prih">
<Description>
</Description>
<Super>json.service2</Super>
<TimeCreated>62568,53407.7921</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Prih</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Rash">
<Super>json.service2</Super>
<TimeCreated>62568,53668.454376</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Rash</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,kurs as cr,opl->Name as oplnm,OplatStatus as oplst,OplSumma as oplsum,Platej->Name as plnm,RubSumma as rsum,Source->Name as srcnm,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Remont">
<Super>json.service2</Super>
<TimeCreated>62568,53668.454376</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Remont</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,Oplacheno as opl,Otchet->Name as otnm,Source->Name as srcnm,Stat as stnm,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.StorageIn">
<Super>json.service2</Super>
<TimeCreated>62568,54731.533107</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.StorageIn</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Kontr->Name as ktnm,PrihodType as prtp,Source->Name as srcnm,Stat as st,storeman->Name as stmnm,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.StorageOut">
<Super>json.service2</Super>
<TimeCreated>62568,54839.37425</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.StorageOut</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,Brak as br,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Images as im,Kontr->Name as ktnm,Source->Name as srcnm,Stat as st,storeman->Name as stmnm,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.Docs.Utiliz">
<Super>json.service2</Super>
<TimeCreated>62568,54839.37425</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Utiliz</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[Name as nm,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,Dat as dt,Komissia as kms,Kontr->Name as ktnm,Source->Name as srcnm,SourceTbl as srct,Stat as st,Summa as sum,Tim as tm,User1->Name as usnm]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>
</Class>


<Class name="json.DynamicSql">
<Description>
Улучшения - поддержка синонимов, отладочные сообщения при компиляции, разбивка на доп. методы
Отличия: режимы просмотра (исп. список полей) и создания+редактирования (список свойств)
Типы полей указываются разработчиками
Методы изменения данных по умолчанию не работают и сведены в один метод Set
Вместо системных запросов используется кроссверсионный (Cache 5.0 - 2010)</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62527,53666.015578</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Operation.Instructions</Default>
</Parameter>

<Parameter name="IDField">
<Description>
Имя поля, значение которого подставится в качестве ID строки на странице</Description>
<Type>%String</Type>
<Default>ID</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as nm,Dat as d,%external(State) as st</Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле (или его синоним), связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>
Например Parameter PARENTFIELD = "doc"]]></Description>
<Type>%String</Type>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
  s oper=$G(qa("oper",1)) 
  Q:oper="add" ..Add(.qa) 
  Q:oper="edit" ..Edit(.qa) 
  Q:oper="del" ..Delete(.qa)
  
  q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="DATESTR3">
<Description>
Из-за усложнения разбора полей при использовании многоаргументных функций
типа: FIELDS="fld1,TO_CHAR(fld2,'YYYY-MM-DD') as fld2"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dat:%Date</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[		Q $zd(Dat,3,,,,,,,"")
]]></Implementation>
</Method>

<Method name="GetFieldName">
<Description>
Соответствие между синонимами и полями</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>caption:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	#;первая строчка кода
	s %code=0 ;начиная с первой строки
	#; принимаем и проверяем параметр
	$$$GENERATE("  s caption=$g(caption) Q:caption="""" """" ") 
	
	s fields=%parameter("FIELDS"), fields=$zstrip(fields,"<>W")
	s fieldList=$LFS(fields,",")
	
	#; проходим по списку полей с синонимами, выделяем поле и его синоним
	w !,!,"Cоответствие синонимов и полей"
	s key=0,pair="" while $LISTNEXT(fieldList,key,pair){ 
		s field=$zstrip($P(pair," as "),"<>W"), syn=$zstrip($P(pair," as ",2),"<>W")
		if field'="" && (syn'="") { ;выделили и имя и синоним
			w !,syn," = ",field  ;отладка
			#; нашли соответствие вернули значение
			$$$GENERATE("  Q:caption="""_syn_""" """_field_"""")			
		}
	}
	
	#; по умолчанию возвращаем принятое значение
	$$$GENERATE("  Q caption ")
	w ! ;форматирование отладочных сообщений
	Q $$$OK
]]></Implementation>
</Method>

<Method name="GetWhere">
<Description><![CDATA[
Построение Where для простых фильтров
<var>rq</var> - %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>*rq:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s %code=0
 $$$GENERATE("  s where=$g(rq(""where""))  m qp=rq(""where"",""params"") ")
 s parentField=%parameter("PARENTFIELD")
 if parentField '="" { ;если параметр был определен, то условие обязательно должно попасть в запрос
 	 $$$GENERATE("  s parentValue=$g(rq("""_parentField_""",1)) ") 
 	 $$$GENERATE("  s syn=..GetFieldName("""_parentField_""") ") 
	 $$$GENERATE("  s where=where_"" and ""_syn_""=?"", qp($i(qp))=parentValue ") 
	 #; обязательно возвращаем
	 $$$GENERATE("  s rq(""where"")="" WHERE 1=1 ""_where m rq(""where"",""qp"")=qp ")
 }
 #; выбрать список синонимов, которые могут быть в параметрах запроса
 #; так как служба предназначена для компонента jqgrid
 #; должен быть установлен параметр _search=true
 #; без него where не строится
 
 $$$GENERATE("  if $g(rq(""_search"",1))'=""true"" Q $g(rq(""where"")) ")
 
 #; со стороны клиента на сервер фильтр будет приходить в виде пар
 #; синоним=параметр 
 #; проверяем запрос на наличие синонимов
 
 s fields=$LFS(%parameter("FIELDS"),","), flen=$LL(fields), pair=""
 s ftypes=$LFS(%parameter("FTYPES"),",")
 w !,!,"Условия фильтров"
 for i=1:1:flen {
	 	s pair=$LG(fields,i), type=$LG(ftypes,i,"%String")
	 	s field=$P(pair," as "), syn=$P(pair," as ",2) 
	 	s:syn="" syn=field
	  
	    s cmd=""  
	 	
	 	#; Для поля c типом %String "обычно" требуется регистро-независимый поиск по вхождению
	 	#; что приводит к переводу в верхний регистр как значения запроса, так и поля
	 	if type="%String" {
		 
		 	s cmd="  if $d(rq("""_syn_"""))  s where=where_"" and "
				s cmd=cmd_" %UPPER("_field_") LIKE %UPPER(?) "" "	 	
				#; избавляемся от проблемных символов в значении параметра
				s cmd=cmd_", qp($i(qp))=""%""_$tr($g(rq("""_syn_""",1)),""%"")_""%"" "
	 	
	 	} else {
	 	
	 		#; для остальных типов полей - поиск на соответствие 
	 		s cmd="  if $d(rq("""_syn_"""))  s where=where_"" and "_field_"=?"" , qp($i(qp))=$g(rq("""_syn_""",1)) "
	 	
	 	}
	 	w !,cmd  ;отладка генерации
	 	$$$GENERATE(cmd)
	 	
	}
	#; возвращаем собранное выражение 
	$$$GENERATE(" s rq(""where"")="" WHERE 1=1 ""_where m rq(""where"",""qp"")=qp ")
	$$$GENERATE(" Q $g(rq(""where"")) ") 	
	
 Q $$$OK
]]></Implementation>
</Method>

<Method name="GetCount">
<Description><![CDATA[
Вычисление количества записей в запросе
В отличии от предыдущей версии используется 
<class>%SQL.Statement</class>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
	 s sql="Select Count(*) as count1 From "_..#CLASSNAME
	 k qp s qp=0  ;query parameters
	 if $d(rq("where")) {
		 s sql=sql_$g(rq("where")) m qp=rq("where","qp") ;забираем параметры
	 }
	 s count=0,sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
	 If $$$ISERR(sc) {
		 w !,$system.Status.GetOneErrorText(sc)
		 Q 0
	 }
	 s sc=rs.Next(), count=rs.Get("count1")  d rs.Close()
	 Q:sc count
	 Q 0
]]></Implementation>
</Method>

<Method name="GetOrder">
<Description>
Строим выражение сортировки с учетом значения параметра FIELDS
Проверяем запрос на наличие параметров sidx и sord
Проверяем чтобы sidx был указан в списке синонимов</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>*rq:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s %code=0
 $$$GENERATE(" s sidx=$G(rq(""sidx"",1)), sord=$G(rq(""sord"",1)) ")
 #;если не задана сортировка 
 $$$GENERATE(" Q:sidx="""" """" ")
 #;строим общий список из полей и синонимов, нечувствительный к регистру
 s fields=$LFS($zcvt(%parameter("FIELDS"),"U"),","), flen=$LL(fields), key=0, pair=""
 k list s list=""
 while $LISTNEXT(fields,key,pair){
	 s field=$zstrip($p(pair," AS "),"<>W"), syn=$zstrip($p(pair," AS ",2),"<>W")
	 s:syn="" syn=field ;предпочтение синониму, но если нет - берем поле
	 s:syn'="" list(syn)="" 
 }
 
 #;Разворачиваем массив в список
 s name="" for { s name=$o(list(name)) Q:name="" 
	s:list'="" list=list_","
	s list=list_name
 }
 
 #;выходим если имя сортировки не соответствует указанным полям и/или их синониму
 s cmd=" Q:'$LF($LFS("""_list_""","",""),$zcvt(sidx,""U"")) """" "
 w !,!,"Проверка параметров сортировки: "
 w !,cmd
 $$$GENERATE(cmd)
 $$$GENERATE(" s sord=$S(sord=""desc"":"" desc"",1:"""") ") 
 $$$GENERATE(" s field=..GetFieldName(sidx) ")
 $$$GENERATE(" Q "" ORDER BY ""_field_"" ""_sord ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Out">
<Description><![CDATA[
Вывод первой или указанной страницы
<var>rq</var> %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s classname=..#CLASSNAME
 
 #; Не пригодилось
 #; если был задан сложный фильтр - за два года работы так и не потребовалось
 #; s filters=$G(rq("filters",1)), where=""  ;where массив вида where()="Select ID From...", where(params)=3
 #; парсим из json where
 #; d ##class(json.filter).Get(filters,.where)
 #; здесь корректность фильтра надо проверить
 #; сбросить ненужные поля и выражения
 #; строим sql where
 #; d ##class(json.filter).Build(.where)
 #; w "where:'",where,"'" Q $$$OK
 #; m rq("where")=where k where
  
 #;Узнаем количество записей по запросу 
 #;Необходимо знать до выполнения основного запроса
 #;так как нужно определять номер выводимой порции данных
 d ..GetWhere(.rq)
 s allrows=..GetCount(.rq)
 
 s rows=+$G(rq("rows",1),100) ;вывести строк на страницу, по умолчанию 100
 s:rows<1 rows=100 ;контроль количества строк на страницу
 
 s page=+$G(rq("page",1),1) ;номер запрашиваемой страницы, по умолчанию первой
 s:page<1 page=1 ;контроль номера страницы 
 
 s pages=0 ;всего страниц данных
 s:allrows>0 pages=allrows\rows ; если есть строки 
 s:allrows#rows>0 pages=pages+1 ;непоместившиеся строки на след страницу
 s:page>pages page=pages ;нельзя вывести страницу больше чем есть

 #;диапазон выводимых строк
 s lastRow=rows*page ;последняя запись которую надо вывести с записи
 s firstRow=lastRow-rows ; начиная с записи
 
 s sql="SELECT ID FROM "_..#CLASSNAME_$g(rq("where"))_..GetOrder(.rq) 
 k qp s qp=0 m qp=rq("where","qp")
 #;w "sql: ",sql
 #;zw qp
 
 s ^mtempArt=sql
 
 #; Переходим на универсальный интерфейс к динамическим запросам
 s sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
 if 'sc {
	 w sc Q $$$OK 
	}
 s first=1 
 w "{"
 #; w """userData"":",..QuoteJS(sql),","
 w """page"":""",page,""""
 w ",""total"":""",pages,""",""records"":""",allrows,""",""rows"":["
 while rs.Next() {
   s i=$i(i) ;счетчик выведенных строк
   if i<=firstRow continue ;Не дошли до первой записи
   if i>lastRow quit  ;прошли последнюю запись
   w:'first "," s:first first=0 ;запятая перед каждым объектом кроме первого
   d ..wJson(rs.Get("ID")) ;вывод объекта 
 }
 d rs.Close() k rs
 w "]}"
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wJson">
<Description>
Вывести объект в формате json</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0
 #; устанавливаем режим вывода
 $$$GENERATE(" #SQLCompile Select=ODBC ")
 s class=%class
 s IDField=%parameter("IDField")
 #; попался на таком:
 #; FIELDS="fld1, TO_CHAR(fld,'YYYY-MM-DD') as fld2"
 #; ошибка разбиения по полям

 s fields=%parameter("FIELDS"), list=$LFS(fields,","), len=$LL(list)
  
 #; формируем список INTO
 s into="" f i=1:1:len s into=into_":var"_i s:i<len into=into_","
 
 #; получаем значения
 s cmd=" &sql(Select "_fields_","_IDField_" INTO "_into_",:"_IDField_" FROM "_%parameter("CLASSNAME")_" WHERE ID=:id) "
 w !,!,"Выражение для получения одной записи:"
 w !,cmd,!
 $$$GENERATE(cmd)
 
 #; выводим как синонимы в JSON
 #; соглашение: id простое число
 #; количество кавычек напрягает
 
 $$$GENERATE(" w ""{""""id"""":"""""","_IDField_","""""""" ")
 
 for i=1:1:len {
		s pair=$LG(list,i), field=$P(pair," as "), syn=$P(pair," as ",2)
		s field=$zstrip(field,"<>W"), syn=$zstrip(syn,"<>W") s:syn="" syn=field
		if i<=len $$$GENERATE(" w "","" ")
		$$$GENERATE(" s val"_i_"=..QuoteJS(var"_i_"),len"_i_"=$l(val"_i_") ")
		$$$GENERATE(" s $e(val"_i_",1)=$c(34),$e(val"_i_",len"_i_")=$c(34) ")
		$$$GENERATE(" w """""""_syn_""""":"",val"_i_" ")
	}
	$$$GENERATE(" w ""}""  ")
	$$$GENERATE("  Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Add">
<Description>
метод добавления
</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME")
 $$$GENERATE(" s obj=##class("_class_").%New() ")
 $$$GENERATE(" d ..Set(obj,.rq) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Edit">
<Description>
Редактирование </Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME"),concurrency=%parameter("OBJECTCONCURRENCY")
 $$$GENERATE(" s id=$g(rq(""id"",1)) ")
 $$$GENERATE(" s obj=##class("_class_").%OpenId(id,"_concurrency_",.sc) ")
 #; если не удалось открыть
 $$$GENERATE(" if 'sc d ..wError(sc,id) Q $$$OK ")
 $$$GENERATE(" d ..Set(obj,.rq) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Set">
<Description>
Самый переопределяемый метод в наследниках </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#; Примерный код
	#define g(%name) $g(rq(%name,1))
	#; Q:'$IsObject(obj) $$$OK	;если не удалось создать новый объект ?!
 #; s obj.field=$$$g("field")
 #; s sc=obj.%Save(),id=obj.%Id()
 #; d ..wError(sc,id)
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Delete">
<Description>
Удаление </Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME")
 $$$GENERATE(" s id=$g(rq(""id"",1)) ")
 $$$GENERATE(" s sc=##class("_class_").%DeleteId(id) ")
 $$$GENERATE(" d ..wError(sc, id) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wError">
<Description>
Выводит результат выполнения операций создания, редактирования, удаления в javascript
на клиенте обычно используется операция eval
по этому пишем в формате javascript массива [result,message,id]</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sc:%Status,id:%String=""</FormalSpec>
<Implementation><![CDATA[
 w "[",$S(+sc=1:"true",1:"false")
 s errtext="" s:'sc errtext=$system.Status.GetOneErrorText(sc)
 w ",",..QuoteJS(errtext)
 w ",",id
 w "]"
]]></Implementation>
</Method>
</Class>


<Class name="json.Goods">
<Description>
Показывает товары выбранной группы 
с правами доступа (доступен, недоступен)
для выбранного пользователя</Description>
<Super>json.service2</Super>
<TimeCreated>62464,47863.857205</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Goods.GoodsGroup</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default><![CDATA[Groups as gp, Goods as gd,Goods->FullName as nm]]></Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле (или синоним), связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>gp</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>
</Class>


<Class name="json.GoodsGroup">
<Description>
выгружает дерево групп товаров</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62463,80009.390097</TimeCreated>

<Parameter name="CONTENTTYPE">
<Description><![CDATA[
Specifies the default content type for the page.  This can be overriden using the
&lt;CSP:CONTENT TYPE=&gt; tag, or by setting the <b>%response</b>.ContentType property
in the <method>OnPreHTTP</method> method.  The default value if this parameter is
not set is text/html.]]></Description>
<Default>text/plain</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	m Args=%request.Data
	s Args("depot",1)=$g(%session.Data("depot"),1)
	d ..wJSON(.Args)
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="wJSON">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	k gl s depot=$g(Args("depot",1),1) 
	s gl("depot")=depot
	s defcat="" &sql(Select ID Into :defcat From Goods.Catalogue Where Depot=:depot Order By Name)
	s cat=$g(Args("cat",1),defcat)
	s:cat="" cat=1
	s gl("cat")=cat
	
	d ..gTree(.gl)
	s rows=$g(gl("data"))
	w "{""page"":""1"",""records"":""",+rows,""",""total"":""",+rows,""",""rows"":["
	m root=gl("root")
	d ..wNodes(.gl,.root) ;раскручиваем с главных листьев
	w "]}"
	
	k gl
	Q ""
]]></Implementation>
</Method>

<Method name="gJSON">
<Description>
для асинхроннных вызовов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>cat:%String,jsfunc:%String="alert"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	k Args s Args("cat",1)=$g(cat)
	s depot="" 
	s:$g(%session)'="" depot=$g(%session.Data("depot"))	
	s:depot="" depot=1
	s Args("depot",1)=depot
		
	w jsfunc,"("
	d ..wJSON(.Args)
	w ");"
	Q ""
]]></Implementation>
</Method>

<Method name="gTree">
<Description>
Собираем дерево групп
Все дерево очень большое и не уникальное в рамках каталога</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&gl:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s depot=$g(gl("depot"),1)
	s cat=$g(gl("cat"),1) 
	
	&sql(Declare grs Cursor For
		Select ID,Name,Code,Goods.Group_GetParentId(ID) as parent
		Into :id,:name,:code,:parent
		From Goods."Group"
		Where Depot=:depot And Catalogue=:cat
	) &sql(Open grs)
	
	for { &sql(Fetch grs) Q:SQLCODE'=0
	  s gl("data")=$i(gl("data"))
	  s gl("data",id,"name")=name
	  s gl("data",id,"code")=code
	  s gl("data",id,"parent")=parent
	  if parent'="" {
			  s gl("data",parent,"childs",name,"id",id)="" //сортированные по наименованию дети
	  }
	} 
	
	&sql(Close grs)
	
	 
	
	#; пост-обработка собранного массива
	s id="" for { s id=$o(gl("data",id)) Q:id=""
		
		if $d(gl("data",id,"childs"))=0 {
			s gl("data",id,"leaf")=1	
		}	
		
		#;рассчет уровень 
		s level=0, parent=id  for { s parent=$g(gl("data",parent,"parent")) Q:parent=""
			s level=level+1
		} s gl("data",id,"level")=level
		
		#;сортированные по наименованию рутовые узлы
		s name=$g(gl("data",id,"name"))
		s:level=0 gl("root",name,"id",id)="" 
		
	}
]]></Implementation>
</Method>

<Method name="wNodes">
<Description>
Выгрузка дерева </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&gl:%String,&childs:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	#define qt(%js) $tr(..QuoteJS(%js),"'","""")
	
	s first=1	
	s idx="" for { s idx=$o(childs(idx)) Q:idx=""   ;цикл по наименованию
	 s id="" for { s id=$o(childs(idx,"id",id)) Q:id=""  ;цикл по кодам
	
			w:'first "," s:first first=0
			w "{""id"":",id
			w ",""n"":",$$$qt($g(gl("data",id,"name")))
			w ",""c"":",$$$qt($g(gl("data",id,"code")))
			s level=$g(gl("data",id,"level")) 
		 w ",""level"":",level
		 s parent=$g(gl("data",id,"parent")) 
			w:parent'="" ",""parent"":",parent
		 s hasChilds=$d(gl("data",id,"childs")) 
		 w ",""leaf"":",$CASE(hasChilds,0:"true",:"false")
			w ",""expanded"":false"
			w "}"
			if hasChilds { k codes m codes=gl("data",id,"childs")
			 w ","
				d ..wNodes(.gl,.codes)
			}
			
	 }
	}
]]></Implementation>
</Method>
</Class>


<Class name="json.GoodsGroup2">
<Description>
выгружает дерево групп товаров
Вариант для динамической подгрузки узлов
Устраняем жалобы на медленную работу дерева</Description>
<Super>%CSP.Page</Super>
<TimeCreated>62463,80009.390097</TimeCreated>

<Parameter name="CONTENTTYPE">
<Description><![CDATA[
Specifies the default content type for the page.  This can be overriden using the
&lt;CSP:CONTENT TYPE=&gt; tag, or by setting the <b>%response</b>.ContentType property
in the <method>OnPreHTTP</method> method.  The default value if this parameter is
not set is text/html.]]></Description>
<Default>text/plain</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	m Args=%request.Data
	s Args("depot",1)=$g(%session.Data("depot"),1)
	d ..wJSON(.Args)
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="wJSON">
<Description>
Последовательная выгрузка узлов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&Args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s depot=$g(Args("depot",1),1) ;склад 
	s defcat="" &sql(Select ID Into :defcat From Goods.Catalogue Where Depot=:depot Order By Name)
	s cat=$g(Args("cat",1),defcat) ;каталог
	s:cat="" cat=1
	
	s node=$g(Args("nodeid",1)) ;родительский узел
	s lvl=$g(Args("n_level",1)) ;уровень родительского узла
	s lvl=$i(lvl) ;уровень дочерних узлов
	
	s sql="Select ID,Name From Goods.""Group"" "
		  _" Where Depot=? And Catalogue=? And Goods.Group_GetParentId(ID)=? "
		  _" Order By Name"	  
	s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
	s sc=rs.Prepare(sql)
	s:sc sc=rs.Execute(depot,cat,node)
	
	#define qt(%js) """"_$zcvt(%js,"O","JS")_""""
	s count=0

	w "{""rows"":["
	while rs.Next() {
	  k id,name,code,child,leaf
	  s id=$g(rs.Data("ID")), name=$g(rs.Data("Name"))
	  #;, code=$g(rs.Data("Code"))	
	  s hasChild=##class(Goods.Group).HasChild(id)
	  
	  w:count>0 ","
	  
	  w "{""id"":",id
	  w ",""n"":",$$$qt(name)
	  
	  #;w ",""c"":",$$$qt(code)
	  
	  w ",""level"":",lvl
	  w:node'="" ",""parent"":",node
	  w ",""leaf"":",$CASE(hasChild,1:"false",:"true")
	  w "}"
	  s count=$i(count)
	  
	} d rs.Close(),rs.%Close()
	 w "],""page"":1,""total"":1,""records"":",+count,"}"
	 Q ""
]]></Implementation>
</Method>

<Method name="gJSON">
<Description>
для асинхроннных вызовов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>cat:%String,jsfunc:%String="alert"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	k Args s Args("cat",1)=$g(cat)
	s depot="" 
	s:$g(%session)'="" depot=$g(%session.Data("depot"))	
	s:depot="" depot=1
	s Args("depot",1)=depot
		
	w jsfunc,"("
	d ..wJSON(.Args)
	w ");"
	Q ""
]]></Implementation>
</Method>
</Class>


<Class name="json.GoodsJQ">
<Super>json.DynamicSql</Super>
<TimeCreated>62527,62357.893094</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Goods.GoodsGroup</Default>
</Parameter>

<Parameter name="IDField">
<Description>
Имя поля, значение которого подставится в качестве ID строки на странице</Description>
<Type>%String</Type>
<Default>Goods</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default><![CDATA[Goods as gd,Goods->FullName as nm,Goods->Property5300 as P5300,Goods->EnglishName as EN,%external(Goods->AllowToSend) as ats]]></Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле (или синоним), связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>Groups</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>
</Class>


<Class name="json.GoodsParams">
<Description>
Показывает товары выбранной группы 
с правами доступа (доступен, недоступен)
для выбранного пользователя</Description>
<Super>json.service2</Super>
<TimeCreated>62527,36615.74236</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Goods.GoodsGroup</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default><![CDATA[Groups as gp, Goods as gd,Goods->FullName as nm]]></Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле (или синоним), связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>gp</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>
</Class>


<Class name="json.GoodsRights">
<Description>
Права контрагента на товары определенной группы
По умолчанию разрешен доступ ко всем товарам - скорее таблица запретов
Назначение - ограничивать экспорт справочника товаров</Description>
<IncludeCode>csp</IncludeCode>
<Super>json.service2</Super>
<TimeCreated>62464,47974.92532</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    m args=%request.Data
    #; модуль редактирования в ячейке не умеет отправлять postData
    #; поэтому обновляем контрагента любым способом (например при загрузке товара)
    if $d(args("kontr")) s %session.Data("kontr")=$g(args("kontr",1))
    s oper=$g(args("oper",1))
    Q:oper="add" $$$OK
    Q:oper="edit" $$$OK
    Q:oper="del" $$$OK
    Q:oper="ban" ..Ban(.args)
    #;бан на список товаров
    Q:oper="banlist" ..BanList(.args)
    d ..wOut(.args)
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="wOut">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 s page=$g(args("page",1),1) ;какую страницу данных
 s rows=+$g(args("rows",1),100) ;по сколько записей на страницу
 s sql="Select Count(ID) as total From Goods.GoodsGroup"
 s where=" WHERE 1=1 ",qp=0
 
 d ..BuildWhere(.args,.where,.qp)

 s total=..GetTotal(sql_where,.qp)  ;всего записей с такими параметрами будет ?
    
 #; проверяем корретность номера страницы
 s pages=total\rows ;целых страниц
 s:total#rows>0 pages=pages+1 ;учтем остаток
 s:page<0 page=1 s:page>pages page=pages
 
 #; ограничения порции данных
 s max=page*rows, min=max-rows
 #;w !,"max: ",max
 #;w !,"min: ",min
 
 #;только теперь интересуемся сортировкой
 s order=..GetOrder(.args)
 
 s sql="Select ID From Goods.GoodsGroup "_where_order
 
 s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")
 #;w !,sql
 d rs.Prepare(sql)
 #; этот тип запроса только 16 параметров
 #; но используется только 2 - группа и, возможно, наименование
 d rs.Execute($g(qp(1)),$g(qp(2)))
 
 s count=0,records=0
 
 w "{""rows"":["
 
 #define qt(%str) $tr(..QuoteJS(%str),"'","""")
 s first=1
 while rs.Next() {
    
  s count=count+1 ;номер текущей строки
  if count<min continue   ;пропускаем
  if count>max Q  ;прекращаем
  #; собственно вывод
  s records=records+1 ;считаем количество выведенных записей
  w:'first "," s:first first=0
  k id s id=$g(rs.Data("ID"))
  d ..wJson(id,.args) 
 
    }
    d rs.Close(),rs.%Close() k rs
    
 w "],""page"":""",page,""",""records"":""",total,""",""total"":""",pages,"""}"
 Q ""
]]></Implementation>
</Method>

<Method name="BuildWhere">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String,&where:%String,&qp:%String]]></FormalSpec>
<Implementation><![CDATA[
    #; обязательно группа
    s group=$g(args("group",1)), where=where_" And Groups = ? ", qp($i(qp))=group
    
    s kontr=$g(args("kontr",1)), kontr=$zstrip(kontr,"<>W") ;обязательный параметр
    if kontr="" {
        s where=where_" And ID =-1 " ;невыполнимое условие или нарушение структуры
    }
    
    if $d(args("_search")) { //в режиме поиска
        if $d(args("name")) {
            s where=where_" AND Goods->FullName Like ? "
            s name=$g(args("name",1)),  qp($i(qp))="%"_$tr(name,"%")_"%"
            
        }   
    }
]]></Implementation>
</Method>

<Method name="GetOrder">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    s order=""
    if $d(args("sidx")){ //задана сортировка
     #;сортировка возможна по единственному полю - наименование
        s sord=$g(args("sord",1)) //без проверки
        s order=" ORDER BY Goods->FullName "_sord
    }   
    Q order
]]></Implementation>
</Method>

<Method name="GetTotal">
<Description>
Подсчет количества</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[sql:%String,&qp:%String]]></FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
    s total=0
    s rs=##class(%ResultSet).%New("%DynamicQuery:SQL")  
    d rs.Prepare(sql)
    d rs.Execute($g(qp(1)),$g(qp(2)))
    while rs.Next() {
        s total=+$g(rs.Data("total"))
    }
    d rs.Close(),rs.%Close() k rs
    Q total
]]></Implementation>
</Method>

<Method name="wJson">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[id:%String,&args=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  s kontr=$g(args("kontr",1))
  w "{""id"":",$$$qt(id)
  s (name,kban)="" 
  &sql(Select Goods->FullName, Goods.Goods_kbanned(Goods,:kontr) 
                                    Into :name, :kban 
                                    From Goods.GoodsGroup 
                                    Where ID=:id
  )
  w ",""name"":",$$$qt(name)
  w ",""kban"":",$$$qt(kban)
  w "}"
]]></Implementation>
</Method>

<Method name="Ban">
<Description>
Редактирование ячейки запрет</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
    s gg=$g(args("gg",1)), kontr=$g(args("kontr",1)), unban=$g(args("unban",1))
    s good=""
    &sql(Select goods Into :good From Goods.GoodsGroup Where ID=:gg)
    if unban {
            d ##class(Goods.Goods).kbanDel(good,kontr)
    } else {
         d ##class(Goods.Goods).kbanAdd(good,kontr)
    }
    w "true"
    
 Q $$$OK
]]></Implementation>
</Method>

<Method name="BanList">
<Description>
Установка запрета на несколько идентификаторов товара сразу</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    s ids=$g(args("ids",1)), kontr=$g(args("kontr",1)), ban=+$g(args("ban",1))
    i $i(^mtempAr("BanList"))
    m ^mtempAr("BanList","ids")=ids
    m ^mtempAr("BanList","kontr")=kontr
    m ^mtempAr("BanList","ban")=ban
    s ggs=$LFS(ids),p=0,gg="", err=""
    s sc=1, err=""
    #;TSTART
    while $LISTNEXT(ggs,p,gg){
        s good=""
        if ##class(Goods.GoodsGroup).%ExistsId(gg){
            s good=##class(Goods.GoodsGroup).GoodsGetStored(gg)
        }
        if ban {
            s sc=sc & ##class(Goods.Goods).kbanAdd(good,kontr,.err) 
        } else {
            s sc=sc & ##class(Goods.Goods).kbanDel(good,kontr)
        }
        
    }
    #; if 'sc TROLLBACK  w "false" Q $$$OK
    
    #;TCOMMIT
    w:sc "true"
    w:'sc "false,",err
    
 Q $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^json.GoodsRightsD</DataLocation>
<DefaultData>GoodsRightsDefaultData</DefaultData>
<IdLocation>^json.GoodsRightsD</IdLocation>
<IndexLocation>^json.GoodsRightsI</IndexLocation>
<StreamLocation>^json.GoodsRightsS</StreamLocation>
<Data name="GoodsRightsDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Goods</Value>
</Value>
<Value name="3">
<Value>Kontr</Value>
</Value>
<Value name="4">
<Value>Rights</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="json.instruction">
<Description>
служба для инструкций</Description>
<Super>json.service2</Super>
<TimeCreated>62482,82508.423363</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Operation.Instructions</Default>
</Parameter>

<Parameter name="FIELDS">
<Description>
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " </Description>
<Type>%String</Type>
<Default>Name as nm,json.service2_DATESTR3(Dat) as d,%external(State) as ste,State as st</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String,%Integer</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле, связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>oper</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
  s oper=$G(qa("oper",1)) 
  Q:oper="add" ..Add(.qa) 
  Q:oper="edit" ..Edit(.qa) 
  Q:oper="del" ..Delete(.qa)
  
  #;Так получилось что в этой службе у целевого класса 
  #;тоже есть поле oper, и по нему надо фильтровать записи
  s qa("oper",1)=10
  //s qa("where")=" and Kontr->Code=464 "
  if %session.Data("Login")'="" s qa("where")=" and Kontr->Code='"_%session.Data("Login")_"'"
  Q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="Set">
<Description>
Самый переопределяемый метод в наследниках </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#; Примерный код
	#define g(%name) $g(rq(%name,1))
	#; Q:'$IsObject(obj) $$$OK	;если не удалось создать новый объект ?!
 	d obj.OperSetObjectId( $$$g("type") )
 	d obj.Depot1SetObjectId( $$$g("depot") )
 	d obj.RashOplatTypeSetObjectId( $$$g("payment") )
 	d obj.dostavkaSetObjectId( $$$g("delivery") )
 	s obj.Name=$$$g("name")
 	s obj.InstDate=$zdh( $$$g("date"), 3,,,,,,,"")
 	s obj.Comment=$$$g("comment")
 	s sc=obj.%Save(),id=obj.%Id()
 	d ..wError(sc,id)
    Q $$$OK
]]></Implementation>
</Method>

<Method name="Delete">
<Description>
Удаление </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  Q $$$OK	
  /* 13.02.2012 Артем попросил убрать удаление
  s id=$g(rq("id",1))	
  s res=##class(Docs.Action).deletedoc("Operation.Instructions",id)
  //1 или строка с ошибкой
  s sc=$CASE(+res,1:"true",:"false")
  w "[",sc,",",..QuoteJS(res),",",id,"]"
  */
  Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="json.irows">
<Description>
Строки инструкции</Description>
<Super>json.service2</Super>
<TimeCreated>62486,78851.192655</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Operation.InstructionsItems</Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле, связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>Doc</Default>
</Parameter>

<Parameter name="FIELDS">
<Description>
g - good
gn - good name
qnt - quantity
grt - garant
sn - serial number
slr - seller
rsn - reason (opispolomki)
sdt - SellDate
nt - note (BrakComment)</Description>
<Type>%String</Type>
<Default><![CDATA[Goods as g,Goods->Name as gn,Quantity as qnt,garant as grt,sn,seller as slr,opispolomki as rsn,SellDate as sdt,BrakComment as nt]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%Integer,%String,%String</Default>
</Parameter>

<Method name="Set">
<Description>
Самый переопределяемый метод в наследниках </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#; Примерный код
	#define g(%name) $g(rq(%name,1))
	Q:'$IsObject(obj) $$$OK	;если не удалось создать новый объект ?!
 	d obj.DocSetObjectId( $$$g("Doc") )
 	d obj.DocTypeSetObjectId("Operation.Instructions")
 	d obj.GoodsSetObjectId( $$$g("g") )
 	s obj.Quantity=$$$g("qnt")
 	s obj.garant=$$$g("qrt")
 	s obj.sn=$$$g("sn")
 	s obj.seller=$$$g("slr")
 	s obj.opispolomki=$$$g("rsn")
 	s obj.SellDate=$zdh( $$$g("sdt") ,3,,,,,,,"")
 	s obj.BrakComment=$$$g("nt") 
 	s sc=obj.%Save(),id=obj.%Id()
 	s msg="" s:'sc msg=$system.Status.GetOneErrorText(sc) 
 	w "[",$CASE(sc,1:"true",:"false"),",",..QuoteJS(msg),",",..QuoteJS(id),"]"
 	Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="json.KaOrders">
<Description>
служба только для просмотра заявок
в подсистеме web доступа контрагентов</Description>
<Super>csp.KaProtected,json.service2</Super>
<TimeCreated>62482,82508.423363</TimeCreated>

<Parameter name="CHARSET">
<Description><![CDATA[
Specifies the default character set for the page.  This can be overriden using the
&lt;CSP:CONTENT CHARSET=&gt; tag, or by setting the <b>%response</b>.CharSet property
in the <method>OnPreHTTP</method> method.  If this parameter is not specified, then
for Unicode systems the default charset is utf-8 and for 8-bit systems it is the
system default charset.]]></Description>
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Operation.Instructions</Default>
</Parameter>

<Parameter name="FIELDS">
<Description>
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " </Description>
<Type>%String</Type>
<Default>Name as nm,json.service2_DATESTR3(Dat) as d,%external(State) as ste,State as st</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String,%Integer</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле, связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>]]></Description>
<Type>%String</Type>
<Default>oper</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
 
  #;Так получилось что в этой службе у целевого класса 
  #;тоже есть поле oper, и по нему надо фильтровать записи
  s qa("oper",1)=10
  
  #; обязательный параметр
  s qa("where")=" and Kontr->Code=?"
  s qa("where","params")=1, qa("where","params",1)=$$$client
  
  Q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="json.KaReports">
<Description>
Служба для (только!!!) просмотра отчетов
для подсистемы web-доступа контрагентов</Description>
<Super>csp.KaProtected,json.service2</Super>
<TimeCreated>62568,43526.814506</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Docs.Otchet</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default><![CDATA[NameSorted as nms,Name as nm,Dat as dt,Summa as sum,Stat as st,ErrorDescription as erd,GotPaperProve as gpp,CloseDate as cldt,CloseTime as cltm,CloseUser->Name as clusnm,Comment as cm,DatePaperProve as dtpp,Kontr->Name as ktnm,Kurs as cr,Rem->Name as rnm,Source->Name as srcnm,SummaCurrency as sumc,Tim as tm,User1->Name as usnm,UserPaperProve->Name as usnmpp]]></Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
  
  #; обязательный параметр
  s qa("where")=" where Kontr->Code=? "
  s qa("where","params")=1
  s qa("where","params",1)=$$$client
  
  #; только просмотр
  Q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="json.Kontragent">
<Description>
Вывод списка контрагентов</Description>
<IncludeCode>csp</IncludeCode>
<Super>json.service2</Super>
<TimeCreated>62465,3515.037625</TimeCreated>

<Parameter name="CHARSET">
<Default>utf-8</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Common.Kontragent</Default>
</Parameter>

<Parameter name="FIELDS">
<Type>%String</Type>
<Default>Name as name,Pseudonym as nick,City as city</Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String</Default>
</Parameter>
</Class>


<Class name="json.serials">
<Description>
Источник данных для страницы serials.csp 
Поиск и удаление по серийному номеру гарантийных талонов
Специализованный вариант JSON службы</Description>
<Super>json.service2</Super>
<TimeCreated>62576,85828.197879</TimeCreated>

<Parameter name="CLASSNAME">
<Type>%String</Type>
<Default>Common.Dictionary2</Default>
</Parameter>

<Parameter name="FIELDS">
<Description>
Помним о путанице наименований серийный/гарантийный в целевом классе</Description>
<Type>%String</Type>
<Default>Name as sn,serial as gn,Comment as cm,remont1 as rm,Property9194 as st</Default>
</Parameter>

<Parameter name="FTYPES">
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
</Parameter>

<Parameter name="PARENTFIELD">
<Type>%String</Type>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  m qa=%request.Data 
  s oper=$G(qa("oper",1)) 
  #;Q:oper="add" ..Add(.qa) 
  #;Q:oper="edit" ..Edit(.qa) 
  Q:oper="del" ..Delete(.qa)
  q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="Delete">
<Description>
Удаление </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s id=$g(rq("id",1))
	s sc=##class(Common.Dictionary2).Delete(id)
	d ..wError(sc, id)
	Q $$$OK
]]></Implementation>
</Method>

<Method name="GetCount">
<Description><![CDATA[
Вычисление количества записей в запросе
В отличии от предыдущей версии используется 
<class>%SQL.Statement</class>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
	 s sql="Select Count(*) as count1 From "_..#CLASSNAME
	 k qp s qp=0  ;query parameters
	 if $d(rq("where")) {
		 s sql=sql_$g(rq("where")) m qp=rq("where","qp") ;забираем параметры
	 }
	 s count=0,sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
	 If $$$ISERR(sc) {
		 w !,$system.Status.GetOneErrorText(sc)
		 Q 0
	 }
	 s sc=rs.Next(), count=rs.Get("count1")  d rs.Close()
	 Q:sc count
	 Q 0
]]></Implementation>
</Method>

<Method name="Out">
<Description><![CDATA[
Вывод первой или указанной страницы
<var>rq</var> %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s classname=..#CLASSNAME
 
 #; ждем два параметра на входе серийный или гарантийный
 #; невозможное значение ( я так думаю ) в индексе
 #define UNDEFINED $c(2)
 
 k arr
 #; По умолчанию ищем по серийному
 s arr("where")=" WHERE Name %STARTSWITH ? ", arr("where","qp")=1
 s param=$g(rq("sn",1)) s:param="" param=$$$UNDEFINED
 s arr("where","qp",1)=param
 
 #; Но если указано, переключаемся на гарантийный
 if $d(rq("gn")) {
	s arr("where")=" WHERE serial %STARTSWITH ? ", arr("where","qp")=1
	s param=$g(rq("gn",1)) s:param="" param=$$$UNDEFINED
 	s arr("where","qp",1)=param
 }
 
 #; блок с доп.условиями
 s cm=$d(rq("cm")), rm=$d(rq("rm"))
 if cm || rm {
  s and=$g(rq("and",1)) s and=$S(and="and":" AND ",1:" OR ")
		s wcm=" NVL(Comment,'')<>'' "  ; дополнительный фильтр - наличие комментария
  s wrm=" NVL(remont1,'')<>'' "  ; дополнительный фильтр - наличие заявки
  s additional=""
	 if ( cm && rm ) { 
	 	s additional="("_wcm_and_wrm_")" 
	 } elseif cm {
		 s additional=wcm
		} else {
			s additional=wrm
		}
 	s arr("where")=$g(arr("where"))_" AND "_additional
 }
 
 s allrows=..GetCount(.arr)
 s rows=30 ;количество строк на страницу жестко фиксировано
 
 s page=+$G(rq("page",1),1) ;номер запрашиваемой страницы, по умолчанию первой
 s:page<1 page=1 ;контроль номера страницы 
 
 s pages=0 ;всего страниц данных
 s:allrows>0 pages=allrows\rows ; если есть строки 
 s:allrows#rows>0 pages=pages+1 ;непоместившиеся строки на след страницу
 s:page>pages page=pages ;нельзя вывести страницу больше чем есть

 #;диапазон выводимых строк
 s lastRow=rows*page ;последняя запись которую надо вывести с записи
 s firstRow=lastRow-rows ; начиная с записи
 
 s sql="SELECT ID FROM Common.Dictionary2 "_$g(arr("where"))
 k qp s qp=0 m qp=arr("where","qp")
 
 
 #; Переходим на универсальный интерфейс к динамическим запросам
 s sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
 if 'sc {
	 w sc Q $$$OK 
 }
 s first=1 
 w "{"
 w """page"":""",page,""""
 #;w ",""userData"":""",sql,""""
 w ",""total"":""",pages,""",""records"":""",allrows,""",""rows"":["

 s:$d(rq("scm")) output("scm")=1 ;параметры вывода одной строки
 s:$d(rq("sst")) output("sst")=1

 while rs.Next() {
   s i=$i(i) ;счетчик выведенных строк
   if i<=firstRow continue ;Не дошли до первой записи
   if i>lastRow quit  ;прошли последнюю запись
   w:'first "," s:first first=0 ;запятая перед каждым объектом кроме первого
   d ..Output(rs.Get("ID"),.output) ;вывод объекта 
 }
 d rs.Close() k rs
 w "]}"
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Output">
<Description>
Свой вывод объектов</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[id:%String,&params:%Boolean]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 w "{""id"":""",id,""""
 
 s sn=##class(Common.Dictionary2).NameGetStored(id)
 w ",""sn"":",$$qt(sn)
 
 s gn=##class(Common.Dictionary2).serialGetStored(id)
 w ",""gn"":",$$qt(gn)
 
 if $g(params("scm"))=1 {
	s cm=##class(Common.Dictionary2).CommentGetStored(id) 
	w ",""cm"":",$$qt(cm)
 }

 if $g(params("sst"))=1 {
	s st=##class(Common.Dictionary2).Property9194GetStored(id) 
	s stnm=##class(Common.Dictionary2).Property9194LogicalToDisplay(st) 
	w ",""st"":",$$qt(stnm)
 }
	 	
 w "}"
 Q $$$OK
	
qt(str)
	s qstr=..QuoteJS(str), $e(qstr,1)="""",$e(qstr,$l(qstr))=""""
	Q qstr
]]></Implementation>
</Method>
</Class>


<Class name="json.service2">
<Description>
Улучшения - поддержка синонимов, отладочные сообщения при компиляции, разбивка на доп. методы
Отличия: режимы просмотра (исп. список полей) и создания+редактирования (список свойств)
Типы полей указываются разработчиками
Методы изменения данных по умолчанию не работают и сведены в один метод Set
Вместо системных запросов используется кроссверсионный (Cache 5.0 - 2010)</Description>
<IncludeCode>csp</IncludeCode>
<Super>%CSP.Page</Super>
<TimeCreated>62441,68723.484539</TimeCreated>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Operation.Instructions</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as nm,Dat as d,%external(State) as st</Default>
</Parameter>

<Parameter name="PARENTFIELD">
<Description><![CDATA[
Поле (или его синоним), связанное с родительским объектом
Например, поле документ для строк накладной
Используется при отборе записей чтобы не показывать строки из всех накладных
Используется в методе <method>GetWhere</method>
Например Parameter PARENTFIELD = "doc"]]></Description>
<Type>%String</Type>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>

<Method name="OnPage">
<Description>
Вывод на страницу </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  k qa s qa="" 
  if $g(%request)'="" && $IsObject(%request) {
      m qa=%request.Data 
  }
  
  #;s ^mtempArt2("qa")=qa
  
  s oper=$g(qa("oper",1)) 
  Q:oper="add" ..Add(.qa) 
  Q:oper="edit" ..Edit(.qa) 
  Q:oper="del" ..Delete(.qa)
  q ..Out(.qa)
  Quit $$$OK
]]></Implementation>
</Method>

<Method name="DATESTR3">
<Description>
Из-за усложнения разбора полей при использовании многоаргументных функций
типа: FIELDS="fld1,TO_CHAR(fld2,'YYYY-MM-DD') as fld2"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dat:%Date</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[        Q $zd(Dat,3,,,,,,,"")
]]></Implementation>
</Method>

<Method name="GetFieldName">
<Description>
Соответствие между синонимами и полями</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>caption:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
    #;первая строчка кода
    s %code=0 ;начиная с первой строки
    #; принимаем и проверяем параметр
    $$$GENERATE("  s caption=$g(caption) Q:caption="""" """" ") 
    
    s fields=%parameter("FIELDS"), fields=$zstrip(fields,"<>W")
    s fieldList=$LFS(fields,",")
    
    #; проходим по списку полей с синонимами, выделяем поле и его синоним
    w !,!,"Cоответствие синонимов и полей"
    s key=0,pair="" while $LISTNEXT(fieldList,key,pair){ 
        s field=$zstrip($P(pair," as "),"<>W"), syn=$zstrip($P(pair," as ",2),"<>W")
        if field'="" && (syn'="") { ;выделили и имя и синоним
            w !,syn," = ",field  ;отладка
            #; нашли соответствие вернули значение
            $$$GENERATE("  Q:caption="""_syn_""" """_field_"""")            
        }
    }
    
    #; по умолчанию возвращаем принятое значение
    $$$GENERATE("  Q caption ")
    w ! ;форматирование отладочных сообщений
    Q $$$OK
]]></Implementation>
</Method>

<Method name="GetWhere">
<Description><![CDATA[
Построение Where для простых фильтров
<var>rq</var> - %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>*rq:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s %code=0
 
 $$$GENERATE("  s where=$g(rq(""where""))  m qp=rq(""where"",""params"") ")
 
 #; было неудачное переименование rq(""where"",""params"")
 #; в rq(""where"",""qp"")
 #; делаем режим совместимости чтобы срабатывало или "params" или "qp"
 $$$GENERATE("  m:'$d(qp) qp=rq(""where"",""qp"") ")
 
 
 
 s parentField=%parameter("PARENTFIELD")
 if parentField '="" { ;если параметр был определен, то условие обязательно должно попасть в запрос
     $$$GENERATE("  s parentValue=$g(rq("""_parentField_""",1)) ") 
     $$$GENERATE("  s syn=..GetFieldName("""_parentField_""") ") 
     $$$GENERATE("  s where=where_"" and ""_syn_""=?"", qp($i(qp))=parentValue ") 
 }
 
 #; выбрать список синонимов, которые могут быть в параметрах запроса
 #; так как служба предназначена для компонента jqgrid
 #; должен быть установлен параметр _search=true без него where не строится
 $$$GENERATE("  if $g(rq(""_search"",1))'=""true"" { ")
 $$$GENERATE("      s rq(""where"")= where ")
 $$$GENERATE("      if '$f($zcvt(where,""U""),""WHERE"") s rq(""where"")="" WHERE 1=1 ""_where ")
 $$$GENERATE("      m rq(""where"",""qp"")=qp ")
 $$$GENERATE("      Q $g(rq(""where"")) ")
 $$$GENERATE(" } ")
 
 #; со стороны клиента на сервер фильтр будет приходить в виде пар
 #; синоним=параметр 
 #; проверяем запрос на наличие синонимов
 
 s fields=$LFS(%parameter("FIELDS"),","), flen=$LL(fields), pair=""
 s ftypes=$LFS(%parameter("FTYPES"),",")
 w !,!,"Условия фильтров"
 for i=1:1:flen {
        s pair=$LG(fields,i), type=$LG(ftypes,i,"%String")
        s field=$P(pair," as "), syn=$P(pair," as ",2) 
        s:syn="" syn=field
      
        s cmd=""  
        
        #; Для поля c типом %String "обычно" требуется регистро-независимый поиск по вхождению
        #; что приводит к переводу в верхний регистр как значения запроса, так и поля
        if type="%String" {
         
            s cmd="  if $d(rq("""_syn_"""))  s where=where_"" and "
                s cmd=cmd_" %UPPER("_field_") LIKE %UPPER(?) "" "       
                #; избавляемся от проблемных символов в значении параметра
                s cmd=cmd_", qp($i(qp))=""%""_$tr($g(rq("""_syn_""",1)),""%"")_""%"" "
        
        } else {
        
            #; для остальных типов полей - поиск на соответствие 
            s cmd="  if $d(rq("""_syn_"""))  s where=where_"" and "_field_"=?"" , qp($i(qp))=$g(rq("""_syn_""",1)) "
        
        }
        w !,cmd  ;отладка генерации
        $$$GENERATE(cmd)
        
    }
    
    #; возвращаем собранное выражение 
    $$$GENERATE("   s rq(""where"")= where ")
    $$$GENERATE("   if '$f($zcvt(where,""U""),""WHERE"") s rq(""where"")="" WHERE 1=1 ""_where ")
    $$$GENERATE("   m rq(""where"",""qp"")=qp ")
    $$$GENERATE(" Q $g(rq(""where"")) ")    
    
 Q $$$OK
]]></Implementation>
</Method>

<Method name="GetCount">
<Description><![CDATA[
Вычисление количества записей в запросе
В отличии от предыдущей версии используется 
<class>%SQL.Statement</class>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
     s sql="Select Count(*) as count1 From "_..#CLASSNAME
     k qp s qp=0  ;query parameters
     if $d(rq("where")) {
         s sql=sql_$g(rq("where")) m qp=rq("where","qp") ;забираем параметры
     }
     s count=0,sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
     If $$$ISERR(sc) {
         w !,$system.Status.GetOneErrorText(sc)
         Q 0
     }
     s sc=rs.Next(), count=rs.Get("count1")  d rs.Close()
     Q:sc count
     Q 0
]]></Implementation>
</Method>

<Method name="GetOrder">
<Description>
Строим выражение сортировки с учетом значения параметра FIELDS
Проверяем запрос на наличие параметров sidx и sord
Проверяем чтобы sidx был указан в списке синонимов</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>*rq:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s %code=0
 $$$GENERATE(" s sidx=$G(rq(""sidx"",1)), sord=$G(rq(""sord"",1)) ")
 #;если не задана сортировка 
 $$$GENERATE(" Q:sidx="""" """" ")
 #;строим общий список из полей и синонимов, нечувствительный к регистру
 s fields=$LFS($zcvt(%parameter("FIELDS"),"U"),","), flen=$LL(fields), key=0, pair=""
 k list s list=""
 while $LISTNEXT(fields,key,pair){
     s field=$zstrip($p(pair," AS "),"<>W"), syn=$zstrip($p(pair," AS ",2),"<>W")
     s:syn="" syn=field ;предпочтение синониму, но если нет - берем поле
     s:syn'="" list(syn)="" 
 }
 
 #;Разворачиваем массив в список
 s name="" for { s name=$o(list(name)) Q:name="" 
    s:list'="" list=list_","
    s list=list_name
 }
 
 #;выходим если имя сортировки не соответствует указанным полям и/или их синониму
 s cmd=" Q:'$LF($LFS("""_list_""","",""),$zcvt(sidx,""U"")) """" "
 w !,!,"Проверка параметров сортировки: "
 w !,cmd
 $$$GENERATE(cmd)
 $$$GENERATE(" s sord=$S(sord=""desc"":"" desc"",1:"""") ") 
 $$$GENERATE(" s field=..GetFieldName(sidx) ")
 $$$GENERATE(" Q "" ORDER BY ""_field_"" ""_sord ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Out">
<Description><![CDATA[
Вывод первой или указанной страницы
<var>rq</var> %request.Data]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&rq:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s classname=..#CLASSNAME
 
 #; Не пригодилось
 #; если был задан сложный фильтр - за два года работы так и не потребовалось
 #; s filters=$G(rq("filters",1)), where=""  ;where массив вида where()="Select ID From...", where(params)=3
 #; парсим из json where
 #; d ##class(json.filter).Get(filters,.where)
 #; здесь корректность фильтра надо проверить
 #; сбросить ненужные поля и выражения
 #; строим sql where
 #; d ##class(json.filter).Build(.where)
 #; w "where:'",where,"'" Q $$$OK
 #; m rq("where")=where k where
  
 #;Узнаем количество записей по запросу 
 #;Необходимо знать до выполнения основного запроса
 #;так как нужно определять номер выводимой порции данных
 d ..GetWhere(.rq)
 s allrows=..GetCount(.rq)
 
 s rows=+$G(rq("rows",1),100) ;вывести строк на страницу, по умолчанию 100
 s:rows<1 rows=100 ;контроль количества строк на страницу
 
 s page=+$G(rq("page",1),1) ;номер запрашиваемой страницы, по умолчанию первой
 s:page<1 page=1 ;контроль номера страницы 
 
 s pages=0 ;всего страниц данных
 s:allrows>0 pages=allrows\rows ; если есть строки 
 s:allrows#rows>0 pages=pages+1 ;непоместившиеся строки на след страницу
 s:page>pages page=pages ;нельзя вывести страницу больше чем есть

 #;диапазон выводимых строк
 s lastRow=rows*page ;последняя запись которую надо вывести с записи
 s firstRow=lastRow-rows ; начиная с записи
 
 s sql="SELECT ID FROM "_..#CLASSNAME_$g(rq("where"))_..GetOrder(.rq) 
 k qp s qp=0 m qp=rq("where","qp")
 #;w "sql: ",sql
 #;zw qp
 
 s ^mtempArt=sql
 
 #; Переходим на универсальный интерфейс к динамическим запросам
 s sc=1, rs=##class(json.xvrs).GetResultSet(sql,.qp,.sc)
 if 'sc {
     w sc Q $$$OK 
    }
 s first=1 
 w "{"
 #; w """userData"":",..QuoteJS(sql),","
 w """page"":""",page,""""
 w ",""total"":""",pages,""",""records"":""",allrows,""",""rows"":["
 while rs.Next() {
   s i=$i(i) ;счетчик выведенных строк
   if i<=firstRow continue ;Не дошли до первой записи
   if i>lastRow quit  ;прошли последнюю запись
   w:'first "," s:first first=0 ;запятая перед каждым объектом кроме первого
   d ..wJson(rs.Get("ID")) ;вывод объекта 
 }
 d rs.Close() k rs
 w "]}"
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wJson">
<Description>
Вывести объект в формате json</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0
 #; устанавливаем режим вывода
 $$$GENERATE(" #SQLCompile Select=ODBC ")
 s class=%class
 #; попался на таком:
 #; FIELDS="fld1, TO_CHAR(fld,'YYYY-MM-DD') as fld2"
 #; ошибка разбиения по полям

 s fields=%parameter("FIELDS"), list=$LFS(fields,","), len=$LL(list)
  
 #; формируем список INTO
 s into="" f i=1:1:len s into=into_":var"_i s:i<len into=into_","
 
 #; получаем значения
 s cmd=" &sql(Select "_fields_" INTO "_into_" FROM "_%parameter("CLASSNAME")_" WHERE ID=:id) "
 w !,!,"Выражение для получения одной записи:"
 w !,cmd,!
 $$$GENERATE(cmd)
 
 #; выводим как синонимы в JSON
 $$$GENERATE(" s jsid=..QuoteJS(id), $e(jsid)=$c(34), $e(jsid,$l(jsid))=$c(34)")
 $$$GENERATE(" w ""{""""id"""":"",jsid ")
 
 for i=1:1:len {
        s pair=$LG(list,i), field=$P(pair," as "), syn=$P(pair," as ",2)
        s field=$zstrip(field,"<>W"), syn=$zstrip(syn,"<>W") s:syn="" syn=field
        if i<=len $$$GENERATE(" w "","" ")
        $$$GENERATE(" s val"_i_"=..QuoteJS(var"_i_"),len"_i_"=$l(val"_i_") ")
        $$$GENERATE(" s $e(val"_i_",1)=$c(34),$e(val"_i_",len"_i_")=$c(34) ")
        $$$GENERATE(" w """""""_syn_""""":"",val"_i_" ")
    }
    $$$GENERATE(" w ""}""  ")
    $$$GENERATE("  Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Add">
<Description>
метод добавления
</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME")
 $$$GENERATE(" s obj=##class("_class_").%New() ")
 $$$GENERATE(" d ..Set(obj,.rq) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Edit">
<Description>
Редактирование </Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME"),concurrency=%parameter("OBJECTCONCURRENCY")
 $$$GENERATE(" s id=$g(rq(""id"",1)) ")
 $$$GENERATE(" s obj=##class("_class_").%OpenId(id,"_concurrency_",.sc) ")
 #; если не удалось открыть
 $$$GENERATE(" if 'sc d ..wError(sc,id) Q $$$OK ")
 $$$GENERATE(" d ..Set(obj,.rq) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Set">
<Description>
Самый переопределяемый метод в наследниках </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    #; Примерный код
    #define g(%name) $g(rq(%name,1))
    #; Q:'$IsObject(obj) $$$OK  ;если не удалось создать новый объект ?!
 #; s obj.field=$$$g("field")
 #; s sc=obj.%Save(),id=obj.%Id()
 #; d ..wError(sc,id)
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Delete">
<Description>
Удаление </Description>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<FormalSpec><![CDATA[&rq:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s %code=0, class=%parameter("CLASSNAME")
 $$$GENERATE(" s id=$g(rq(""id"",1)) ")
 $$$GENERATE(" s sc=##class("_class_").%DeleteId(id) ")
 $$$GENERATE(" d ..wError(sc, id) ")
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="wError">
<Description>
Выводит результат выполнения операций создания, редактирования, удаления в javascript
на клиенте обычно используется операция eval
по этому пишем в формате javascript массива [result,message,id]</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sc:%Status,id:%String=""</FormalSpec>
<Implementation><![CDATA[
 w "[",$S(+sc=1:"true",1:"false")
 s errtext="" s:'sc errtext=$system.Status.GetOneErrorText(sc)
 w ",",..QuoteJS(errtext)
 w ",",id
 w "]"
]]></Implementation>
</Method>
</Class>


<Class name="json.WarrantyCard">
<Description>
Гарантийные талоны</Description>
<Super>json.service2</Super>
<TimeCreated>62503,64888.503131</TimeCreated>

<Parameter name="PRIVATE">
<Description><![CDATA[
Controls the access to the page, it can be set to one of the following:<br>
<br><ul>
<li><b>PRIVATE=0</b> - Page can be linked to/bookmarked</li>
<li><b>PRIVATE=1</b> - Can only be referenced from another CSP page</li>
</ul>
The user needs initially to enter the site through a PUBLIC page.]]></Description>
<Default>0</Default>
</Parameter>

<Parameter name="CLASSNAME">
<Description>
Имя Persistent класса для которого создается служба
Соглашение: имя класса и имя таблицы совпадает
Используйте Cache правильно!</Description>
<Type>%String</Type>
<Default>Common.Dictionary2</Default>
</Parameter>

<Parameter name="FIELDS">
<Description><![CDATA[
Список SQL полей, возможно с синонимами "Name As nm"
ID можно не указывать, т.к. выбирается обязательно
Внимание!, имена синонимов чувствительны к регистру (для javascript клиента)
В отличие от имен полей (SQL на стороне сервера)
Соглашение: синоним писать  через " as " - ",OBJ->name as oname "
Раньше неправильно разбивал на поля ]]></Description>
<Type>%String</Type>
<Default>Name as sn,Property9194 as st,%external(Property9194) as stnm, json.WarrantyCard_first50(Comment) as cm</Default>
</Parameter>

<Parameter name="FTYPES">
<Description>
Типы полей, по умолчанию %String
Используются при построении фильтра
тип %String </Description>
<Type>%String</Type>
<Default>%String,%String,%String</Default>
</Parameter>

<Parameter name="OBJECTCONCURRENCY">
<Description>
Как открывать объект на редактирование</Description>
</Parameter>

<Method name="first50">
<Description>
Первые 50
Обходим ограничения разбора параметра FIELDS 
Не любит запятые :) </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>str:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	s part=$e(str,1,50) Q:$e(part)="" ""
	Q part_$S($e(part,50)'="":"...",1:"")
]]></Implementation>
</Method>
</Class>


<Class name="json.xvrs">
<Description>
Кросс-версионный резалтсет, адаптер
Использование: %New(),Prepare(sql),SetMode(2),Execute(.p),Next(),Close()</Description>
<ClassType/>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>62164,63911.441927</TimeCreated>

<Property name="rs">
<Description>
Ссылка на внутренний ResultSet</Description>
<Type>%ObjectHandle</Type>
<Private>1</Private>
</Property>

<Property name="sql">
<Description>
sql для %ResultSet.SQL, так как у него только %Prepare</Description>
<Type>%String</Type>
<Private>1</Private>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PreviousMode">
<Description>
Предыдущий режим запросов для %ResultSet.SQL</Description>
<Type>%Integer</Type>
<InitialExpression>$zu(115,5)</InitialExpression>
<Private>1</Private>
</Property>

<Property name="ColNames">
<Description>
Массив названий колонок, для 2010</Description>
<Type>%String</Type>
<MultiDimensional>1</MultiDimensional>
<Private>1</Private>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Method name="%OnNew">
<Description>
Создание нового запроса</Description>
<CodeMode>generator</CodeMode>
<FormalSpec>initvalue:%CacheString</FormalSpec>
<Private>1</Private>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
 s major=$system.Version.GetMajor()
 s rs="  s ..rs=##class(%ResultSet).%New(""%DynamicQuery:SQL"") "
 s rssql="  s %this.rs=##class(%ResultSet.SQL).%New() "
 s sqlstm="  s %this.rs=##class(%SQL.Statement).%New() "
 if major<2008 {
  $$$GENERATE(rs)
 } elseif major<2010 {
  $$$GENERATE(rssql)
 } else {  
  $$$GENERATE(sqlstm)
 }
 $$$GENERATE(" Quit $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="GetResultSet">
<Description>
Типовое использование</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[sql:%String,&p:%String,&err:%String=""]]></FormalSpec>
<ReturnType>json.xvrs</ReturnType>
<Implementation><![CDATA[
  k rs s rs=##class(json.xvrs).%New()
  s err=rs.Prepare(sql) Q:'err rs
  s err=rs.Execute(.p) Q:'err rs
  Q rs
]]></Implementation>
</Method>

<Method name="SetMode">
<Description>
Режим вывода данных</Description>
<CodeMode>generator</CodeMode>
<FormalSpec>mode:%Integer</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 $$$GENERATE(" Q:""012""'[$g(mode) $$$ERROR($$$GeneralError,""Возможные режимы 0,1,2"") ")
 s major=$system.Version.GetMajor()
 if major<2008 {
  $$$GENERATE(" s ..rs.RuntimeMode=mode ")
 } elseif major<2010 {
  $$$GENERATE(" s ..PreviousMode=$zu(115,5,mode) ")
 } else {
  $$$GENERATE(" s ..rs.%SelectMode=mode ")
 }
 $$$GENERATE(" Q $$$OK ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Get">
<CodeMode>generator</CodeMode>
<FormalSpec>prop:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s major=$system.Version.GetMajor()
 if major<2008 {
  $$$GENERATE(" Q $g(..rs.Data(prop)) ")
 } elseif major<2010 {
  $$$GENERATE(" Q ..rs.%Get(prop) ")
 } else {
  $$$GENERATE(" s i=$g(..ColNames(prop)) Q:i'="""" ..rs.%GetData(i) ")
 }
 $$$GENERATE(" Q """" ")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Prepare">
<Description>
Подготовка</Description>
<CodeMode>generator</CodeMode>
<FormalSpec>sql:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s major=$system.Version.GetMajor()
 if major<2008{
  $$$GENERATE(" s sc=..rs.Prepare(sql)  ")
 } elseif major<2010  {
  $$$GENERATE(" s ..sql=sql Q $$$OK") 
 } else  { ;SQL Statement
  $$$GENERATE(" s sc=..rs.%Prepare(.sql) ")
  $$$GENERATE(" if sc { ")
  #;Заполняем нумерацию полей
  $$$GENERATE(" k ..ColNames s meta=..rs.%Metadata ")
  $$$GENERATE(" s cols=meta.columns.Count() ")
  $$$GENERATE(" f i=1:1:cols { ")
  $$$GENERATE("  s col=meta.columns.GetAt(i) ")
  $$$GENERATE("  s ..ColNames(col.colName)=i ")
  $$$GENERATE(" } ")  
  $$$GENERATE(" } ")  
 } 
 $$$GENERATE(" Q sc")
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Execute">
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[&p:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s major=$system.Version.GetMajor()
 ;5.0
 if major<2008 { 
  s pcount=16, cmd=" s sc=..rs.Execute("
 } elseif major<2010 {
  s pcount=251 ;s:major>2009 pcount=124 ;2010 - %ResultSet.SQL
  s cmd=" s sql=..sql, ..rs=##class(%ResultSet.SQL).%Prepare(.sql,.sc,"""", "
 }
 
 if major<2010 { ;передача параметров
  d %code.Write(cmd)
  f i=1:1:pcount { 
   d:i'=1 %code.Write(",")
   d %code.Write("$g(p("_i_"))") 
  }
  d %code.WriteLine(" )")
 } else { 
  #;SQLStatement 2010 можно сразу скормить массив, но он должен быть правильно оформлен
  d %code.WriteLine(" if $d(p)>1 { s p=$o(p(""""),-1) s ..rs=..rs.%Execute(p...) ")
  d %code.WriteLine(" } else { s ..rs=..rs.%Execute() }")
 }
 
 ;вывод результата
 if major<2008 {
   d %code.WriteLine(" Q sc ")
   Q $$$OK
 } 
 
 if major<2010 {
	 	d %code.WriteLine(" s sqlcode=..rs.%SQLCode ")
 } else { 
 	 d %code.WriteLine(" s sqlcode=..rs.%SQLCODE ")
 }
 
 d %code.WriteLine(" Q:sqlcode=0 $$$OK")   
 d %code.WriteLine(" Q $$$ERROR($$$GeneralError,$system.SQL.SQLCODE(sqlcode))")    
 
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Next">
<CodeMode>generator</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 s major=$system.Version.GetMajor()
 if major<2008{
  $$$GENERATE(" Q ..rs.Next() ") 
 } else {
  $$$GENERATE(" Q ..rs.%Next() ") 
 }
 Q $$$OK
]]></Implementation>
</Method>

<Method name="Close">
<CodeMode>generator</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  s major=$system.Version.GetMajor()
  if major<2008 {
   $$$GENERATE("  d ..rs.Close(),..rs.%Close() ") 
  } elseif major<2010 {
   $$$GENERATE("  s sc=$zu(115,5,..PreviousMode) " ) 
  }
  $$$GENERATE("  d ..rs.%Close() ")  
  $$$GENERATE(" Quit $$$OK ")
  Q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="Kontragent.Action">
<Description>
Общие действия контрагентов</Description>
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60699,52633.014894</TimeCreated>

<Method name="SendMail">
<Description><![CDATA[
Послать документ контрагенту по E-mail
<br><var>DocID</var> - ID или объекта документа
<br><var>DocClass</var> - Класс документа
<br><var>MailAddress</var> - Адрес для отправки]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>DocID="",DocClass,MailAddress=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SendMailErr"
 i DocID="" $$$WriteError("Внутренняя ошибка. Не указан документ для отправки.") q
 i '$ISOBJECT(DocID) s DocID=##class(Docs.Super).%OpenId(DocID)
 i '$ISOBJECT(DocID) $$$WriteError("Не открылся документ DocID="_DocID)
 i MailAddress ="" s mail=..KontrMail(DocID.Kontr)
 e  s mail=MailAddress
 s To=mail
 i mail="" s ok="Не удалось определить e-mail контрагента, укажите, пожалуйста e-mail вручную или заполните соответствующее поле контрагента" Goto LogResult
 ///если не включена автоматическая отправка, то отправляем самим себе
 s:'+$$$TunesVariableGlobal("AutoSendMails") To=$$$TunesVariable("smtpfrom")
 //делаем word файл
 s exitfile=$$$TunesVariable("WordDestinationDir")_"\"_$TR($H,",","")_".doc"
 s ok=..MakeFile(DocID, DocClass, $$$TunesVariableGlobal("AutoTemplate"), .exitfile)
 i '+ok Goto LogResult
 //отправляем письмо с аттачем
 s ok=..SendMailNotification(To,exitfile)
LogResult
 S Comment = DocID.Name_" "_DocID.DocumentClass.Name
 d ..LogResult($G(To),$G(exitfile),Comment,$G(ok),.LogResultID)
 
 //сохраним в документе привязку к логу отправки
 if DocID.DocumentClass.%Id()="Docs.Rash"
 {
	 d DocID.SendMailLogSetObjectId(LogResultID)
	 d DocID.%Save()
 }
 
 
 q 
SendMailErr
 $$$WriteError($ZE)
 q
]]></Implementation>
</Method>

<Method name="LogResult">
<ClassMethod>1</ClassMethod>
<FormalSpec>To="",exitfile="",Comment="",ok="",ID="",Resend=""</FormalSpec>
<Implementation><![CDATA[
 if +ID s log=##class(Kontragent.SendMailLog).%OpenId(ID)
 if '$ISOBJECT($G(log)) s log=##class(Kontragent.SendMailLog).%New()
 
 s log.Attach=$G(exitfile)
 //потом исказим ответ для чтения человеком
 i ok=1 s Result="Уведомление успешно отправлено"
 else  s Result=ok
 s log.Result=Result
 s log.ResultCode=+$G(ok)
 s log.MessageTo=$G(To)
 s log.Comment=Comment
 d:Resend'="" log.ResendSetObjectId(Resend)
 s ok=log.%Save()
 i '+ok $$$WriteObjError(ok)
 s ID = log.%Id()
 q ok
]]></Implementation>
</Method>

<Method name="KontrMail">
<Description><![CDATA[
E-mail контрагента
<br><var>KontrID</var> - ID или объект контрагента]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>KontrID,Code,Name</FormalSpec>
<Implementation><![CDATA[
	i $ISOBJECT(KontrID) q KontrID.EMail
	&sql(select EMail,Code,Name into :EMail,:Code,:Name from Common.Kontragent where ID=:KontrID)
	i SQLCODE 
	{
	 s (EMail,Code,Name)=""
	}
	q EMail
]]></Implementation>
</Method>

<Method name="MakeFile">
<Description><![CDATA[
Сделать и сохранить word файл из документа
<br><var>Doc</var> - ID или объект документа
<br><var>WordTemplate</var> - файл - вордовский шаблон]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Doc,Class,WordTemplate,&exitfile]]></FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
 s $ZT="MakeFileErr"
 q:Doc="" "Ошибка"
 
 n Variables,DocName,word,TemplateDir,WordDoc,f,t,wrap,filename,i,SearchStr,StartPosition,
 EndPosition,CurrentRow,MainRowCellsCount,RowNumber,CurrentGoodsStr,StrVariables,CellPos,
 CurrentCell,var,DestinationDirectory,waste,Values,Properties,replacement
 
 s:'$ISOBJECT(Doc) Doc=$ZOBJCLASSMETHOD(Class,"%OpenId",Doc)
 
 //извлекаем данные документа в массив Variables
 d ..FillObjValues(Class,Doc,.Variables)
 s Variables("DocTypeName")=$S($ISOBJECT(Doc.DocumentClass):Doc.DocumentClass.Name,1:"")
 
 //подставим номер и дату заявки 
 if Doc.DocumentClass.%Id()="Docs.StorageOut",$ISOBJECT(Doc.Source),$ISOBJECT(Doc.Source.Source) {
	 s Variables("RequestName")=Doc.Source.Source.Name
	 if Doc.Source.Source.Dat?5N s Variables("RequestDat")=$ZD(Doc.Source.Source.Dat,4)
 }
 
 if Doc.DocumentClass.%Id()="Docs.Rash",$ISOBJECT(Doc.Source) 
 {
	 s Variables("RequestName")=Doc.Source.Name
	 s Variables("RequestDat")=$ZD(Doc.Source.Dat,4)
 }
 
 #;zw Variables
 
 #; правило формирования имени нового файла
 s filename=$G(^Tunes(3,"filename","Value"),"<<Dat>> - <<Kontr>> <<Name>>")
 #; из настроек - каталог шаблона
 s TemplateDir=$G(^Tunes(3,"TemplateDir","Value"))
 #; из настроек - каталог нового файла
 s DestinationDirectory=$G(^Tunes(3,"WordDestinationDir","Value"))
 
 s DocName=##class(Docs.Action).GetDocNameFromClass(Class) 
 
 s f=##class(%Activate.Variant).FALSE(), t=##class(%Activate.Variant).TRUE()
 s wrap=##class(%Activate.Variant).%New(), wrap.Value="wdFindContinue"
 
 s filename=$G(^Tunes(3,"filename","Value"),"<<Dat>> - <<Kontr>> <<Name>>")
 
 #; инициализируем Word
 s word=##class(Activate.Word.Application).%New() 
 #; открываем шаблон
 s WordDoc=word.Documents.Add(TemplateDir_"\"_WordTemplate_".doc")
 
 i 'word.Documents.Count d word.Quit() q "Не удалось открыть шаблон "_TemplateDir_"\"_WordTemplate_".doc"
 
 #; формируем имя нового файла по правилу
 s i="" f  s i=$O(Variables(i)) q:i=""  d
 . s SearchStr="<<"_i_">>"
 . s StartPosition=$F(filename,SearchStr)-$L(SearchStr)
 . s EndPosition=$F(filename,SearchStr)
 . q:StartPosition<=0
 . s $E(filename,StartPosition,EndPosition)=$G(Variables(i))
 
 #; убираем запрещенные символы
 f i="\","/",":","*","?",":","<",">","|" d
 . s filename=$TR(filename,i,"-")
 
 s:$G(exitfile)="" exitfile=DestinationDirectory_"\"_filename_".doc"
 
 #; сохраняем еще пустой шаблон
 d WordDoc.SaveAs(exitfile)
 
 #; после сохранения проверяем есть ли такой файл
 i $ZU(140,4,exitfile) d  q "Не удалось сохранить файл "_exitfile_".doc"
 . d WordDoc.Close()
 . d word.Quit()
 
 //заменяем "общие" теги документа
 s i="" f  s i=$O(Variables(i)) q:i=""  d
 . d WordDoc.Select()
 . s SearchStr="<<"_i_">>"
 . d word.Selection.Find.Execute(SearchStr,f,f,f,f,f,t,wrap,f,$G(Variables(i)))
 
 //пошли по строкам документа
 s CurrentRow=WordDoc.Tables.Item(1).Rows.Item(2)
 s MainRowCellsCount=CurrentRow.Cells.Count
 
 f i=1:1:MainRowCellsCount d
 . s MainRowArray(i)=CurrentRow.Cells.Item(i).Range.Text
 d:$ISOBJECT(Doc.Items)
 . s i="" f  s i=Doc.Items.Next(i) q:i=""  d
 . . i $I(RowNumber)
 . . s:RowNumber>1 CurrentRow=WordDoc.Tables.Item(1).Rows.Add()
 . . s CurrentGoodsStr=Doc.Items.GetAt(i)
 . . //заполняем переменные строки значениями текущей строки документа
 . . d ..FillObjValues(Class_"Items", CurrentGoodsStr, .StrVariables, .Properties)
 . . d FillVariableWithData(.StrVariables,CurrentGoodsStr,RowNumber)
 . . f CellPos=1:1:MainRowCellsCount d  						//цикл по ячейкам строки
 . . . s CurrentCell=CurrentRow.Cells.Item(CellPos)				//текущая ячейка
 . . . s CurrentRow.Cells.Item(CellPos).Range.Text=$G(MainRowArray(CellPos))
 . . . s var="" f  s var=$O(StrVariables(var)) q:var=""  d   	//цикл по переменным содержащим данные текущей строки
 . . . . s SearchStr="<<"_..NumberOfProperty(var)_">>"
 . . . . d CurrentCell.Select()
 . . . . //s replacement=$G(StrVariables(var))
 . . . . s replacement=$G(StrVariables(var))
 . . . . d word.Selection.Find.Execute(SearchStr,f,f,f,f,f,t,wrap,f,replacement)
 d WordDoc.SaveAs(exitfile)
 d WordDoc.Close()
 d word.Quit()
 q 1
 
MakeFileErr
 d:$ISOBJECT($G(WordDoc)) WordDoc.Close()
 d:$ISOBJECT($G(word)) word.Quit()
 $$$WriteError($ZE)
 q "Извините ошибка при создании файла."
FillVariableWithData(StrVariables,CurrentGoodsStr,RowNumber)
 //заполняем массив данными строки документа
 s StrVariables(1)=RowNumber
 s StrVariables(2)=CurrentGoodsStr.Goods.Name
 s StrVariables(2.1)=CurrentGoodsStr.Goods.FullName
 s StrVariables(3)=CurrentGoodsStr.Goods.codedetail
 s StrVariables(4)=CurrentGoodsStr.Goods.Price
 s StrVariables(5)=CurrentGoodsStr.Goods.Property3609
 s StrVariables(6)=CurrentGoodsStr.Goods.abbr
 s StrVariables(7)=CurrentGoodsStr.Goods.Property5300
 s StrVariables(8)=CurrentGoodsStr.Goods.Weight
 s StrVariables(9)=CurrentGoodsStr.Goods.Comment
 // если это строчка расходной накладной и заполнено поле ZakazGoods, то 55 переменная - это название заказанного товара
 s StrVariables(55)=""
 s StrVariables(56)=""
 if CurrentGoodsStr.%ClassName(1)="Docs.RashItems",$ISOBJECT(CurrentGoodsStr.ZakazGoods) s StrVariables(55)=CurrentGoodsStr.ZakazGoods.FullName
 q
]]></Implementation>
</Method>

<Method name="FillObjValues">
<Description><![CDATA[
Заполнить переданный массив значениями полей объекта
<br><var>Class</var> - Класс объекта
<br><var>Object</var> - Объект источник данных
<br><var>Values</var> - Массив по ссылке заполняемый данными объекта
<br><var>Properties</var> - Массив по ссылке со свойствами объекта (их типами и названием), необязательный]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Class,Object,&Values,&Properties]]></FormalSpec>
<Implementation><![CDATA[
 k Values
 q:'$ISOBJECT(Object)
 s:'$D(Properties) waste=##class(Common.Common).showheaders(Class,,,,,.Properties)
 s i="" f  s i=$O(Properties(i)) q:i=""  d
 . s proptype=Properties(i)
 . s prop=$ZOBJPROPERTY(Object,i)
 . //если свойство содержит VALUELIST то извлечём его
 . i $D(Properties(i,"VALUELIST")) s prop=$ZOBJMETHOD(Object,i_"LogicalToDisplay",prop)
 . //если тип свойства не содержит % значит это объектная ссылка, значит поле Name из связанного объекта
 . i ($E(proptype,1,1)'="%")&($ISOBJECT(prop)) d
 . . i prop.%ClassName(1)="Goods.Goods" s prop=prop.FullName
 . . e  s prop=prop.Name
 . i proptype="%Date" s prop=$ZD(prop,4)
 . i proptype="%Time" s prop=$ZT(prop)
 . s Values(i)=prop
 q
]]></Implementation>
</Method>

<Method name="NumberOfProperty">
<Description><![CDATA[
Возвращает номер свойства строки документа согласно перечню свойств в "Правила меток в шаблонах.doc"
<br><var>PropertyName</var> - наименование свойства]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>PropertyName</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ q $G(^DocumentProperties(PropertyName),PropertyName)
]]></Implementation>
</Method>

<Method name="SendMailNotification">
<Description><![CDATA[
Отсылает письмо с указанным файлом по указанному адресу
<br><var>MailDestination</var> - E-mail получателя письма
<br><var>attachfile</var> - Полный локальный путь к аттачу]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>MailDestination,attachfile="",MailText:%String=$$$TunesVariableGlobal("NotifyText"),MailSubject:%String=$$$TunesVariableGlobal("NotifySubj")</FormalSpec>
<Implementation><![CDATA[
 //соберём настройки отправки из сессии
 s smtpserver=$$$TunesVariableGlobal("smtpserver")
 s smtpuser=$$$TunesVariableGlobal("smtpuser")
 s smtpfrom=$$$TunesVariableGlobal("smtpfrom")
 s smtppassword=$$$TunesVariableGlobal("smtppassword")
 s smtpport=$$$TunesVariableGlobal("smtpport")
 
	set s=##class(%Net.SMTP).%New()
 	set auth=##class(%Net.Authenticator).%New() ; use default authentication list
	set auth.UserName=smtpuser
	set auth.Password=smtppassword
	set s.authenticator=auth
 set s.smtpserver=smtpserver
 set m=##class(%Net.MailMessage).%New()
 set m.From=smtpfrom
 s s.port=smtpport
	// Either address with name or just email address supported.
	f i=1:1:$L(MailDestination,",") d
	. do m.To.Insert($P(MailDestination,",",i))
	do m.Bcc.Insert(smtpfrom)
	s m.ReplyTo="serviceman@aska-el.ru"

	set m.Subject=MailSubject
	set m.Charset="windows-1251"
	set status=m.TextData.Write(MailText)
	if '+status d  q "1 Ошибка отправки письма. "_$ZCVT(Err(Err),"O","HTML")
	. $$$WriteObjError(status)
	. Do DecomposeStatus^%apiOBJ(status,.Err) 
	d:attachfile'="" 
	. //set nestedm=m.AttachNewMessage()
	. set status=m.AttachFile($P(attachfile,"\",1,$L(attachfile,"\")-1),$P(attachfile,"\",$L(attachfile,"\")),1,"windows-1251")
	. q:'+status
	. s pc=m.Parts.Count()
 	. s m.Parts.GetAt(1).IsBase64=1
	. s m.Parts.GetAt(1).IsBinary=1
	. s m.Parts.GetAt(1).ContentType="application/x-msword"
	. s m.Parts.GetAt(1).Charset="windows-1251"
	. s m.Parts.GetAt(1).MultiPartType=0
	. s m.Parts.GetAt(1).ContentTransferEncoding="base64"
	if '+status d  q "2 Ошибка отправки письма. "_$ZCVT(Err(Err),"O","HTML")
	. $$$WriteObjError(status)
	. Do DecomposeStatus^%apiOBJ(status,.Err) 
	set status=s.Send(m)
	if '+status d  q "3 Ошибка отправки письма. "_$ZCVT(Err(Err),"O","HTML")
	. $$$WriteObjError(status)
	. Do DecomposeStatus^%apiOBJ(status,.Err) 
	q 1
]]></Implementation>
</Method>

<Method name="GetKontrIdFromCode">
<Description>
Получить ID контрагента по его уникальному коду</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Code:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 &sql(select ID into :ID from Common.Kontragent where Code=:Code)
 q:'SQLCODE ID
 q ""
]]></Implementation>
</Method>

<Method name="AddMeetingResult">
<Description><![CDATA[
Добавить результат разговора с контрагентом
<br/><var>Result</var> - текст результата беседы
, в случае удачного завершения сюда будет записан идентификатор.
<br/><var>Dat</var> - дата в формате дд/мм/гггг 
<br/><var>Tim</var> - время в формате чч/мм/сс
<br/><var>KontrId</var> - ID контрагента
<br/><var>MessageType</var> - тип сообщения (0, 2 или 3), см. свойство в классе]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>*Result:%String="",Dat:%String="",Tim:%String="",KontrId:%String="",MessageType:%String="",FileName:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="AddMeetingResultErr"
 s login = $$$SessionData("user"), FileName=$g(FileName)
 if '##class(Common.Rights).getrights(login,19) q "У вас нет прав на отправку сообщений контрагентам"
 if Dat'?1.2N1"/"2N1"/"4N q "Неверно указан формат даты. Дата должна быть в формате дд/мм/гггг"
 if Tim'?2N1":"2N1":"2N q "Неверно указан формат времени. Время должно быть в формате чч:мм:сс"
 if KontrId="" q "Не указан контрагент."
 
 s Obj=##class(Kontragent.Meeting).%New()
 d Obj.KontrSetObjectId(KontrId)
 s Obj.Result=Result, Obj.MessageType=+MessageType
 s Obj.Dat=$ZDH(Dat,4), Obj.Tim=$ZTH(Tim)
 
 if FileName'="" { //дополнительно сохраняем в объект
	s AttachName=##class(%File).GetFilename(FileName)
	s Obj.AttachName = AttachName 
	s file=##class(%File).%New(FileName)
	s sc=file.Open("RU")
	if sc {
		d Obj.Attachment.CopyFrom(file)	
	}
	d file.Close()
 }
  
 s ok=Obj.%Save(),  mid=Obj.%Id()
 if '+ok q "Извините. Ошибка при записи."
 
 if +MessageType  {
	 s KontrEMail = ..KontrMail(KontrId,.Code,.Name)
	 if KontrEMail'="" {
	 	s TextMessage="Здравствуйте"_$C(13,10)_"Вам поступило новое сообщение от сервисной службы Aska Elc."_$C(13,10)_$C(13,10)
	 	s TextMessage=TextMessage_Result_$C(13,10)_$C(13,10)
	 	s TextMessage=TextMessage_"Наша с вами переписка доступна по адресу http://213.128.198.234/csp/sklad2/Support.csp?login="_Code_" пароль тот, который вы используете в Менеджере отчётов."_$C(13,10)
	 	s TextMessage=TextMessage_"C уважением "_$$$TunesVariableGlobal("OurName")
	 	d ..LogResult(KontrEMail,"","Сообщение контрагенту "_Name ,"Сообщение отправить не удалось",.ID)
	 	s ok = ..SendMailNotification(KontrEMail,FileName,TextMessage,"Новое сообщение в программе Менеджер отчётов Aska Elc.")
	 	s ok = ..LogResult(KontrEMail,"","Сообщение контрагенту "_Name ,ok,ID)
	 }
 }
 
 //если сообщение отправляли на мыло, то поставим на него ссылку
 if +$G(ID) {
	 d Obj.SendMailLogSetObjectId(ID)
	 s ok=Obj.%Save()
	 if '+ok q "Извините. Ошибка при записи."
 }
 
 #; В случае удачного завершения записываем вместо текста идентификатор сообщения
 s:+ok Result=mid 
 Quit ok
 
AddMeetingResultErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при записи. "_$ZCVT($ZE,"O","JS")
]]></Implementation>
</Method>

<Method name="SendSpam">
<Description>
Разослать контрагентам спам</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Message=""</FormalSpec>
<Implementation><![CDATA[
	s $ZT="SendSpamErr"

	s MailSubject="Уведомление о смене номеров телефонов Aska Elc."

	s:Message="" Message="Уважаемые клиенты."_$C(13,10)_$C(13,10)_
	"Сервер Aska Elc поменял IP, к сожалению, мы не смогли заранее уведомить Вас. Поэтому мы просим Вас указать в менеджере отчётов новый IP адрес. Для этого необходимо сделать следующее:"_$C(13,10)_
	"Запустить Менеджер отчётов, зайти во вкладку Параметры"_$C(13,10)_
	"Отметить чекбокс ""Редактировать параметры"". В открывшихся полях необходимо заменить старый ip адрес 89.175.39.6 на новый 91.214.205.78 Сделать это необходимо в двух полях: URL и FTP host."_$C(13,10)_
	"После замены необходимо сохранить изменения (кнопка Сохранить в верхней части программы)."_$C(13,10)_$C(13,10)_
	"Ульянов В.Ф."_$c(13,10)_"P.S. Не отвечайте на это письмо."_$c(13,10)
		
	s:Message="" Message="Уважаемые партнеры."_$C(13,10)_$C(13,10)_
	"В Сервисной службе изменились телефоны."_$C(13,10)_
 	"Вопросы по запасным частям и заявкам - Кашменский Ю.Е. т. +7(967) 129-8201  "_$C(13,10)_
	"zip@aska-el.ru."_$C(13,10)_
 	"Все вопросы и проблемы - Лопатин Ю.Е. т. +7 (967) 129-8148,"_$C(13,10)_
	"serviceman@aska-el.ru."_$C(13,10)_
 	"Руководитель Сервисной службы - Ульянов В.Ф. +7 (967) 129-8101,"_$C(13,10)_
	"serviceman@aska-el.ru."_$C(13,10)_$C(13,10)_
 	"Сервисная служба Viconte, Mastermax, Tull."
	
	s:Message="" Message = "Уважаемые партнёры."_$C(13,10)_$C(13,10)_
		"У нас изменился фактический адрес местонахождения. Пожалуйста отправляйте корреспонденцию по адресам."_
		"Почтовый адрес:"_$C(13,10)_
 		"121087, г. Москва"_$C(13,10)_
		"Багратионовский проезд, д.1  а/я 28"_$C(13,10)_
		"ИП Носач А.В."_$C(13,10)_
		"Адрес для отравлений срочной (экспресс) почтой ЕМС, PONY EXPRESS, DHL и пр.:"_$C(13,10)_
		"117152, г. Москва,  Загородное ш., д.1, кор.1"_$C(13,10)_
 		"Тел: (495)229 90 09"_$C(13,10)
	
	Set file=##class(%File).%New("file.txt")
	Do file.Open("WSN")
	
	Do file.WriteLine("Отправка письма контарагентам:")
	Do file.WriteLine(MailSubject)
	Do file.WriteLine(Message)
	Do file.WriteLine("")
	Do file.WriteLine("")
	
	s smtpfrom=$$$TunesVariableGlobal("smtpfrom")
	&sql(DECLARE zzz CURSOR FOR 
		SELECT ID,Name,EMail 
		INTO :ID,:Name,:email 
		FROM Common.Kontragent
		where Activity=1 and id>26
		)
	&sql(open zzz)
	f  &sql(fetch zzz) q:SQLCODE  d
	. s EMail=$TR(email," ","")
	. if (EMail="")||(email'["@") d  q
	. . Do file.WriteLine($ZDT($H,4)_" контрагент "_Name_" ("_ID_"), e-mail """_email_""" невозможно отправить письмо.")
	. s ok = ..SendMailNotification(email,"",Message,MailSubject) 
	. Do file.WriteLine($ZDT($H,4)_" контрагент "_Name_" ("_ID_"), e-mail """_email_" результат отправки:"_$S(ok=1:"ОК",1:ok))
	. h 301
	&sql(close zzz)
	
	d file.Close()
	
	q
SendSpamErr
 $$$WriteError($ZE)
 if $ISOBJECT($G(file)) d file.Close()
 q
]]></Implementation>
</Method>

<Method name="KontragentCurrencyName">
<ClassMethod>1</ClassMethod>
<FormalSpec>KontrId:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s obj = ##class(Common.Kontragent).%OpenId(KontrId)
	Q:'$ISOBJECT(obj) ""
	s CurrencyName = ##class(Common.Kontragent).CurrencyLogicalToDisplay(obj.Currency)
	
	q CurrencyName
]]></Implementation>
</Method>

<Method name="ResendList">
<Description>
Переотправить список из Kontragent.SendMailLog
ListOfLogItems - список ID из Kontragent.SendMailLog (например "2145~2143~2147~2255"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ListOfLogItems</FormalSpec>
<Implementation><![CDATA[
	//s $ZT="ResendListErr"
	s sql = "SELECT ID,Attach,MessageTo FROM Kontragent.SendMailLog where ID in ("_$TR(ListOfLogItems,"~",",")_")"
	s rs=##class(%ResultSet).%New()
	s ok=rs.Prepare(sql)
	if '+ok $$$WriteObjError(ok) q ok
	s ok= rs.Execute()
	if '+ok $$$WriteObjError(ok) q ok
	
	//перебираем логи отправки писем с целью отправить заново
	while rs.Next()
	{
		s ID = rs.Data("ID")				
		s MessageTo = rs.Data("MessageTo")
		s Attach = rs.Data("Attach")
		
		//если аттача небыло - это сообщение сервисного центра
		if Attach=""
		{
			&sql(SELECT AttachName,Result 
				INTO :AttachName,:Result 
				FROM Kontragent.Meeting 
				WHERE SendMailLog=:ID)
			if 'SQLCODE
			{
				s ok=..SendMailNotification(MessageTo,AttachName,Result,"Новое сообщение в программе Менеджер отчётов Aska Elc.")
			}
			else
			{
				s Error = $G(Error)_"Не удалось переслать сообщение №"_ID_" так как не найдено сообщение в Kontragent.Meeting\n"
			}
		}
		else
		{
			//иначе это автоматическое уведомление
			s ok=..SendMailNotification(MessageTo,Attach)
		}
		s ok = ..LogResult(MessageTo,"","Повторная пересылка уведомления ",ok,"",ID)
		if '+ok s Error = $G(Error)_"Не удалось данные о повторной отправке сообщения "_ID_"\n"
	}
	
	q $G(Error,1)
ResendListErr
 $$$WriteError($ZE)
 q "Извините, ошибка при повторной отсылке писем, часть могла быть отправлена"
]]></Implementation>
</Method>
</Class>


<Class name="Kontragent.DocsFilter">
<Description>
Алгоритмы для фильтрации отчётов и заявок</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>61233,56924.869915</TimeCreated>

<Method name="CheckOtchetItem">
<Description>
проверка одной строки отчёта</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>item:Docs.OtchetItems=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if '$ISOBJECT(item) q "Ошибка. Не указана строка отчёта для проверки."
 s RemontDat=item.Dat
 s StringType=item.StringType
 s KontragentId=item.Doc.Kontr.%Id()
 s GoodsId=$S($ISOBJECT(item.Goods):item.Goods.%Id(),1:"")
 s RemTovarId=$S($ISOBJECT(item.RemTovar):item.RemTovar.%Id(),1:"")
 s remcost=item.remcost
 s Garant=item.garant
 s Serial=item.serial
 s Price=item.Price
 s Quantity=item.Quantity
 s RemType=item.RemType
 if '$ISOBJECT(item.RemTovar)&&'$ISOBJECT(item.Goods) q "В строке не указан ни товар, ни деталь. Проверка невозможна."
 s ErrText=$S($ISOBJECT(item.RemTovar):" Товар <span onclick=""wopen('GoodCard.csp?GoodId="_item.RemTovar.%Id()_"')"" >"_item.RemTovar.FullName_"</span>",1:" Деталь <span onclick=""wopen('GoodCard.csp?GoodId="_item.Goods.%Id()_"')"">"_item.Goods.FullName_"</span>")
 s ItemHasError=0
 if StringType=1 d
 . //строка - отчёт за деталь
 . //если цена детали в отчёте - 0, значит проверяем что отправляли и снимаем с клиента эту деталь
 . //иначе, сверяем с нашей ценой
 . if '+Price s ok=..DetailHasBeenSent(KontragentId, GoodsId, Quantity)
 . else  s ok=..CheckDetailCostForKontr(GoodsId,Price,KontragentId)
 . if '+ok s ErrText=ErrText_" "_ok,ItemHasError=1
 if StringType=0 d
 . //строка - отчёт за ремонт товара
 . s ok=..CheckRemontCost(KontragentId,RemTovarId,RemType,remcost)
 . if '+ok s ErrText=ErrText_" "_ok,ItemHasError=1
 . s ok=..CheckGarantTalon(Garant,Serial,KontragentId,RemontDat,item.Doc)
 . if '+ok s ErrText=ErrText_" "_ok,ItemHasError=1
 if ItemHasError q ErrText
 q 1
]]></Implementation>
</Method>

<Method name="CheckOtchet">
<Description>
Проверка отчёта </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc:Docs.Otchet=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CheckOtchetErr"
 if '$ISOBJECT(doc) q "Ошибка. Не указан отчёт. Проверка не может быть выполнена."
 if '$ISOBJECT(doc.Kontr) q "В отчёте не указан контрагент. Проверка невозможна."
 if '+doc.Items.Count() q "Отчёт не содержит строк. Проверка невозможна."
 s innerkurs=##class(Goods.GoodsAction).kurs(.w,doc.Dat)	//найдём курс на дату отчёта
 
 TSTART
 s doc.Errors=""
 s i="" f  s i=doc.Items.Next(i) q:i=""  d
 . s item=doc.Items.GetAt(i)
 . s ok=..CheckOtchetItem(item)
 . if '+ok s doc.Errors=doc.Errors_ok_$C(13,10)_$C(13,10)
 . s CurrentRowPrice = $J(item.Total,"",2)
 . //если это деталь 
 . if item.StringType=1 s CurrentRowPrice = item.CalculatedStringRubSumma()
 . s ItogPrice=$G(ItogPrice)+CurrentRowPrice
 . if +CurrentRowPrice'=+item.Total,'item.StringType s doc.Errors=doc.Errors_"Сумма в строке отчёта = "_item.Total_" посчитанная сумма = "_CurrentRowPrice_$C(13,10)_$C(13,10)
 if $J(ItogPrice,"",2)'=$J(doc.Summa,"",2) s doc.Errors=doc.Errors_"Сумма отчёта ("_$J(doc.Summa,"",2)_") не равна сумме строк отчёта ("_$J(ItogPrice,"",2)_"). Курс валюты на момент расчёта суммы отчёта = "_innerkurs_$C(13,10)_$C(13,10)
 
 if doc.Errors'="" d  q "При проверке отчёта были обнаружены ошибки."
 . TROLLBACK 1
 . //если в настройках отключили автоматическую проверку, то и статус "не принят" тоже не ставим
 . d:$$$TunesVariableGlobal("AllowReportApprovement") doc.SetOthcetStatFailed()
 . d doc.%Save()
 TCOMMIT
 q 1
CheckOtchetErr
 $$$WriteError($ZE)
 q "Извините. Ошибки при проверке отчёта"
]]></Implementation>
</Method>

<Method name="DetailHasBeenSent">
<Description>
Проверить отправлялась ли такая деталь контрагенту</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Kontragent:%String="",Detail:%String="",Quantity:%Numeric=0</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 if Kontragent="" q "Ошибка при проверке отправленной <span onclick=""wopen('GoodCard.csp?GoodId="_Detail_"')"">детали</span>. Не указан контрагент."	//если не указан контрагент
 if Detail="" q "Ошибка при проверке отправленной детали. Не указан товар."		//если не указана деталь
 if '$D(^t(Kontragent,Detail)) q "<span onclick=""wopen('GoodCard.csp?GoodId="_Detail_"')"">Деталь</span> не отправлялась контрагенту"			//если нет в списке деталей контрагента
 if +$G(^t(Kontragent,Detail))<Quantity q "Такая <span onclick=""wopen('GoodCard.csp?GoodId="_Detail_"')"">деталь</span> отправлялась но в количестве "_+$G(^t(Kontragent,Detail))_" тогда как в отчёте указано "_Quantity		//если количество на балансе меньше чем отчитываются
 //на этом этапе выяснили, что деталь мы поставляли и что поставляли не больше чем нам показывают
 //если на балансе клиента числится больше чем он отчитывается, то уменьшаем баланс
 //иначе, вообще эту ветку баланса убираем
 if +$G(^t(Kontragent,Detail))>Quantity s ^t(Kontragent,Detail)=^t(Kontragent,Detail)-Quantity
 else  k ^t(Kontragent,Detail)
 q 1
]]></Implementation>
</Method>

<Method name="CheckRemontCost">
<Description>
Проверить стоимость ремонта для контрагента </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>KontragentId:%String="",RemTovarId:%String="",RemType:%String,remcost:%Numeric=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="CheckRemontCostErr"
 q:KontragentId="" "Не указан контрагент, невозможно проверить цену ремонта."
 
 //Property126 - категория цен контрагента (Common.Dictionary9)
 &sql(select Code,Property126,Property127 into :Code,:Property126,:Property127 from Common.Kontragent where ID=:KontragentId)
 if SQLCODE $$$WriteError("CheckRemontCost SQLCODE="_SQLCODE_" KontragentId="_KontragentId) q "системная ошибка при проверке стоимости ремонта. Проверка невозможна."
 
 //Если тип ремонта не указан - значит простой ремонт изделия
 //иначе это может быть акт или диагностика (бытовка или инструмент) - 
 //цена за акт или диагностику определена в Common.Dictionary9 (связь с контрагентом через поле Property126 в Common.Kontragent)
 s error=1
 &sql(select izdelie,FullName into :izdelie,:RemTovarFullName from Goods.Goods where ID=:RemTovarId)
 if SQLCODE=100 s izdelie=0
 
 if izdelie="" q "Ошибка. Для товара "_RemTovarFullName_" не указана ценовая группа товара."
 if '+RemType s OurRemontPrice=##class(Common.Common).GetRemontPrice(Code,izdelie)
 else  d
 . s ThisGroupTypeIs=##class(Common.Dictionary12).GetPropertyValue(izdelie, "Razdel")
 . if ThisGroupTypeIs = 1 s KontragentCenaKateg = Property127
 . else  s KontragentCenaKateg = Property126
 . if KontragentCenaKateg="" s error="Для <span onclick=""wopen('kontragent.csp?KontrId="_KontragentId_"')"">контрагента</span> не определена категория цены. Проверка стоимости ремонта невозможна" q
 . //если определён тип ремонта, значит это акт или диагностика
 . //значит извлекаем из Common.Dictionary9, Категории цен для контрагентов
 . s PropertyToExtract=$Select(RemType=1:"ActPriceInstrument",RemType=2:"DiagPriceInstrument",RemType=3:"ActPriceTechnic",RemType=4:"DiagPriceTechnic",1:"")
 . if PropertyToExtract="" $$$WriteError("CheckRemontCost RemType="_RemType) s error="Указан неопознанный тип ремонта (тип "_RemType_"). Проверка стоимости ремонта невозможна." q
 . s KontragentCenaKategObj=##class(Common.Dictionary9).%OpenId(KontragentCenaKateg)
 . if '$ISOBJECT(KontragentCenaKategObj) s error="Невозможно получить информацию о категории цены "_KontragentCenaKateg_" для контрагентов. Проверка стоимости ремонта невозможна." q
 . s OurRemontPrice=$ZOBJPROPERTY(KontragentCenaKategObj,PropertyToExtract)
 . if OurRemontPrice="<remont>" s OurRemontPrice=##class(Common.Common).GetRemontPrice(Code,izdelie)
 if '+error q error
 if OurRemontPrice<remcost q "указанная в отчёте цена за ремонт "_remcost_" выше чем цена для данной категории цен контрагентов "_$J(+OurRemontPrice,"",2)
 //if OurRemontPrice<remcost q "Указанная в отчёте цена за ремонт "_remcost_" выше чем цена для данной категории цен контрагентов "_"OurRemontPrice"
 q 1
CheckRemontCostErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при проверке стоимости ремонта."
]]></Implementation>
</Method>

<Method name="CheckGarantTalon">
<Description>
Проверить гарантийный талон в системе</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GarantNumber:%String="",Serial:%String="",KontragentId:%String="",RemontDat:%Date="",doc:Docs.Otchet=""</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	if $TR(GarantNumber," ","")="б/н" q 1
 s garantterm=$$$TunesVariableGlobal("garantterm")
 
 s GarantId = ##class(Common.Common).GetGarantIdByName(GarantNumber)
 s GarantObj=##class(Common.Dictionary2).%OpenId(GarantId)
 if '$ISOBJECT(GarantObj) d
 . s GarantObj=##class(Common.Dictionary2).%New()
 . s GarantObj.Name=GarantNumber
 . s GarantObj.serial=Serial
 . d GarantObj.Property5330SetObjectId(KontragentId)
 //проверить актуальность
 if GarantObj.Property9194=2 q "Гарантийный талон <span onclick=""wopen('garant.csp?GarantName="_GarantNumber_"')"">"_GarantNumber_"</span> недействительный."
 //Проверить соответствие гарантийного контрагенту
 if $ISOBJECT(GarantObj.Property5330),GarantObj.Property5330.%Id()'=KontragentId q "Для гарантийного талона <span onclick=""wopen('garant.csp?GarantName="_GarantNumber_"')"">"_GarantNumber_"</span> установлен контрагент <span onclick=""wopen('kontragent.csp?KontrId="_GarantObj.Property5330.%Id()_"')"">"_GarantObj.Property5330.Name_"</span>"
 //проверить соответствие серийному номеру
 if ($$$TunesVariableGlobal("demandserial"))&&(Serial="") q "Не указан серийный номер."
 if Serial'="",GarantObj.serial'=Serial q "Для гарантийного талона <span onclick=""wopen('garant.csp?GarantName="_GarantNumber_"')"">"_GarantNumber_"</span> уже записан товар "_GarantObj.tovar_" с серийным номером "_GarantObj.serial_" хотя в отчёте указан "_Serial
 //проверить по дате последнего ремонта
 if $ISOBJECT(GarantObj.remont3otch) q "Для гарантийного талона <span onclick=""wopen('garant.csp?GarantName="_GarantNumber_"')"">"_GarantNumber_"</span> уже указаны три ремонта. Это значит что талон недействителен."
 s LastRemontDat=0
 if $ISOBJECT(GarantObj.remont1otch) s LastRemontDat=GarantObj.remont1otch.GetRemontDat()
 if $ISOBJECT(GarantObj.remont2otch) s LastRemontDat=GarantObj.remont2otch.GetRemontDat()
 if +LastRemontDat,RemontDat-LastRemontDat<garantterm q "Для гарантийного номера <span onclick=""wopen('garant.csp?GarantName="_GarantNumber_"')"">"_GarantNumber_"</span> установлена последняя дата ремонта "_$ZD(LastRemontDat,4)_" тогда как дата текущего ремонта "_$ZD(RemontDat,4)_" промежуток между ремонтами меньше положенного "_garantterm_" дн."
 //запишем текущий отчёт в первую попавшуюся дырку гарантийного талона
 if '$ISOBJECT(GarantObj.remont1otch) s GarantObj.remont1otch=doc q 1
 if '$ISOBJECT(GarantObj.remont2otch) s GarantObj.remont2otch=doc q 1
 if '$ISOBJECT(GarantObj.remont3otch) s GarantObj.remont3otch=doc q 1
 q 1
]]></Implementation>
</Method>

<Method name="CheckDetailCostForKontr">
<Description>
Проверить стоимость детали для данного контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId:%String="",remcost,KontragentId</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 if +$G(^t(KontragentId,GoodsId)) q "Деталь указана как платная, однако такие детали числятся на балансе контрагента: "_^t(KontragentId,GoodsId)_" шт."
 &sql(select Price into :Price from Goods.Goods where ID=:GoodsId)
 if SQLCODE=100 q "Невозможно найти товар "_GoodsId_" проверка цены невозможна."
 if SQLCODE<0 $$$WriteError("CheckRemontCost SQLCODE="_SQLCODE) q "Системная ошибка при проверке цены товара"
 if $J(Price,"",2)<$J(remcost,"",2) q "Цена в отчёте "_remcost_", тогда как в базе установлена цена "_Price
 q 1
]]></Implementation>
</Method>
</Class>


<Class name="Kontragent.Meeting">
<Description>
Общение с контрагентами</Description>
<Super>%Persistent</Super>
<TimeCreated>61056,2079.284813</TimeCreated>

<Property name="Kontr">
<Description>
Контрагент</Description>
<Type>Common.Kontragent</Type>
<Required>1</Required>
</Property>

<Index name="KontrInd">
<Properties>Kontr</Properties>
</Index>

<Property name="Dat">
<Description>
Дата</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatInd">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время</Description>
<Type>%Time</Type>
</Property>

<Index name="TimInd">
<Properties>Tim</Properties>
</Index>

<Property name="Result">
<Description>
Результат разговора</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="4048"/>
</Property>

<Property name="User1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Index name="User1Ind">
<Properties>User1</Properties>
</Index>

<Property name="MessageType">
<Description>
Тип сообщения</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Закрытое (для себя),От клиента,Клиенту"/>
<Parameter name="VALUELIST" value=",0,2,3"/>
</Property>

<Index name="MessageTypeInd">
<Properties>MessageType</Properties>
</Index>

<Property name="SendMailLog">
<Description>
Ссылка на лог отправки</Description>
<Type>Kontragent.SendMailLog</Type>
</Property>

<Index name="SendMailLog">
<Properties>SendMailLog</Properties>
</Index>

<Property name="Attachment">
<Description>
Приложение к сообщению - файл</Description>
<Type>%FileBinaryStream</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="AttachName">
<Description>
Имя вложения - имя файла</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Method name="GetAttachmentDirectory">
<Description><![CDATA[
Возвращает директорию для хранения вложений к письму
<ol>
<li>Определяем csp приложение для области по умолчанию
<li>Находим физический путь к файлам приложения
<li>Добавляем "\AttachFiles\"
</ol> Может вернуть пустую строку!!!]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s ns=$zu(5)
	#; s app=##class(%SYSTEM.CSP).GetDefaultApp(ns) ; в этой версии нет
	s appName=$$getDefaultApp^%SYS.cspServer2(ns) Q:appName="" ""
	s cspDir=$$GetFilename^%apiCSP(appName_"/") Q:cspDir="" ""
	Q ##class(%File).SubDirectoryName(cspDir,"AttachFiles")
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Kontragent.MeetingD</DataLocation>
<DefaultData>MeetingDefaultData</DefaultData>
<IdLocation>^Kontragent.MeetingD</IdLocation>
<IndexLocation>^Kontragent.MeetingI</IndexLocation>
<StreamLocation>^Kontragent.MeetingS</StreamLocation>
<Data name="MeetingDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Dat</Value>
</Value>
<Value name="3">
<Value>Kontr</Value>
</Value>
<Value name="4">
<Value>Result</Value>
</Value>
<Value name="5">
<Value>Tim</Value>
</Value>
<Value name="6">
<Value>User1</Value>
</Value>
<Value name="7">
<Value>MessageType</Value>
</Value>
<Value name="8">
<Value>SendMailLog</Value>
</Value>
<Value name="9">
<Value>Attachment</Value>
</Value>
<Value name="10">
<Value>AttachName</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Kontragent.SendMailLog">
<Description>
Лог отправки писем</Description>
<Super>%Persistent</Super>
<TimeCreated>60764,86119.599953</TimeCreated>

<Property name="Dat">
<Description>
Дата</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatInd">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время</Description>
<Type>%Time</Type>
<InitialExpression>$P($H,",",2)</InitialExpression>
</Property>

<Index name="TimInd">
<Properties>Tim</Properties>
</Index>

<Property name="MessageTo">
<Description>
Кому</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Index name="MessageToInd">
<Properties>MessageTo</Properties>
</Index>

<Property name="Cc">
<Description>
Копия</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Index name="CcInd">
<Properties>Cc</Properties>
</Index>

<Property name="Attach">
<Description>
Файл</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Index name="AttachInd">
<Properties>Attach</Properties>
</Index>

<Property name="Result">
<Description>
Результат</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="500"/>
</Property>

<Index name="ResultInd">
<Properties>Result</Properties>
</Index>

<Property name="ResultCode">
<Description>
Результат</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="500"/>
</Property>

<Index name="ResultCodeInd">
<Properties>ResultCode</Properties>
</Index>

<Property name="Comment">
<Description>
Комментарий</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="200"/>
</Property>

<Index name="CommentInd">
<Properties>Comment</Properties>
</Index>

<Property name="Resend">
<Description>
Оригинал (при дубликате письма)</Description>
<Type>SendMailLog</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Kontragent.SendMailLogD</DataLocation>
<DefaultData>SendMailLogDefaultData</DefaultData>
<IdLocation>^Kontragent.SendMailLogD</IdLocation>
<IndexLocation>^Kontragent.SendMailLogI</IndexLocation>
<StreamLocation>^Kontragent.SendMailLogS</StreamLocation>
<Data name="SendMailLogDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Attach</Value>
</Value>
<Value name="3">
<Value>Cc</Value>
</Value>
<Value name="4">
<Value>Dat</Value>
</Value>
<Value name="5">
<Value>Tim</Value>
</Value>
<Value name="6">
<Value>MessageTo</Value>
</Value>
<Value name="7">
<Value>Result</Value>
</Value>
<Value name="8">
<Value>Comment</Value>
</Value>
<Value name="9">
<Value>ResultCode</Value>
</Value>
<Value name="10">
<Value>Resend</Value>
</Value>
</Data>
</Storage>
</Class>


<Project name="NewLife" LastModified="2014-01-22 12:02:29">
  <Items>
    <ProjectItem name="Common.Bank" type="CLS"/>
    <ProjectItem name="Common.Boss" type="CLS"/>
    <ProjectItem name="Common.Common" type="CLS"/>
    <ProjectItem name="Common.Dictionary1" type="CLS"/>
    <ProjectItem name="Common.Dictionary10" type="CLS"/>
    <ProjectItem name="Common.Dictionary11" type="CLS"/>
    <ProjectItem name="Common.Dictionary12" type="CLS"/>
    <ProjectItem name="Common.Dictionary13" type="CLS"/>
    <ProjectItem name="Common.Dictionary14" type="CLS"/>
    <ProjectItem name="Common.Dictionary15" type="CLS"/>
    <ProjectItem name="Common.Dictionary16" type="CLS"/>
    <ProjectItem name="Common.Dictionary18" type="CLS"/>
    <ProjectItem name="Common.Dictionary19" type="CLS"/>
    <ProjectItem name="Common.Dictionary2" type="CLS"/>
    <ProjectItem name="Common.Dictionary20" type="CLS"/>
    <ProjectItem name="Common.Dictionary4" type="CLS"/>
    <ProjectItem name="Common.Dictionary5" type="CLS"/>
    <ProjectItem name="Common.Dictionary6" type="CLS"/>
    <ProjectItem name="Common.Dictionary7" type="CLS"/>
    <ProjectItem name="Common.Dictionary8" type="CLS"/>
    <ProjectItem name="Common.Dictionary9" type="CLS"/>
    <ProjectItem name="Common.Dicts" type="CLS"/>
    <ProjectItem name="Common.Kontragent" type="CLS"/>
    <ProjectItem name="Common.Rights" type="CLS"/>
    <ProjectItem name="Common.SouceFiles" type="CLS"/>
    <ProjectItem name="Common.SqlProcs" type="CLS"/>
    <ProjectItem name="Common.Sync" type="CLS"/>
    <ProjectItem name="Common.talking" type="CLS"/>
    <ProjectItem name="Docs.Act" type="CLS"/>
    <ProjectItem name="Docs.ActItems" type="CLS"/>
    <ProjectItem name="Docs.ActNote" type="CLS"/>
    <ProjectItem name="Docs.ActNoteItems" type="CLS"/>
    <ProjectItem name="Docs.Action" type="CLS"/>
    <ProjectItem name="Docs.Action2" type="CLS"/>
    <ProjectItem name="Docs.Brakremont" type="CLS"/>
    <ProjectItem name="Docs.BrakremontItems" type="CLS"/>
    <ProjectItem name="Docs.BrandPlatej" type="CLS"/>
    <ProjectItem name="Docs.Chet" type="CLS"/>
    <ProjectItem name="Docs.ChetItems" type="CLS"/>
    <ProjectItem name="Docs.Diff" type="CLS"/>
    <ProjectItem name="Docs.DiffItems" type="CLS"/>
    <ProjectItem name="Docs.DocBrak" type="CLS"/>
    <ProjectItem name="Docs.DocBrakItems" type="CLS"/>
    <ProjectItem name="Docs.DocItems" type="CLS"/>
    <ProjectItem name="Docs.Docs" type="CLS"/>
    <ProjectItem name="Docs.Inner" type="CLS"/>
    <ProjectItem name="Docs.InnerDiff" type="CLS"/>
    <ProjectItem name="Docs.InnerDiffItems" type="CLS"/>
    <ProjectItem name="Docs.InnerItems" type="CLS"/>
    <ProjectItem name="Docs.Invent" type="CLS"/>
    <ProjectItem name="Docs.InventItems" type="CLS"/>
    <ProjectItem name="Docs.Otchet" type="CLS"/>
    <ProjectItem name="Docs.OtchetItems" type="CLS"/>
    <ProjectItem name="Docs.OtchetNote" type="CLS"/>
    <ProjectItem name="Docs.OtchetNoteItems" type="CLS"/>
    <ProjectItem name="Docs.Platejka" type="CLS"/>
    <ProjectItem name="Docs.PlatejkaItems" type="CLS"/>
    <ProjectItem name="Docs.Prih" type="CLS"/>
    <ProjectItem name="Docs.PrihItems" type="CLS"/>
    <ProjectItem name="Docs.PrihKassOrder" type="CLS"/>
    <ProjectItem name="Docs.Rash" type="CLS"/>
    <ProjectItem name="Docs.RashItems" type="CLS"/>
    <ProjectItem name="Docs.RashPlatej" type="CLS"/>
    <ProjectItem name="Docs.Remont" type="CLS"/>
    <ProjectItem name="Docs.RemontItems" type="CLS"/>
    <ProjectItem name="Docs.Sluzap" type="CLS"/>
    <ProjectItem name="Docs.SluzapItems" type="CLS"/>
    <ProjectItem name="Docs.StorageIn" type="CLS"/>
    <ProjectItem name="Docs.StorageInItems" type="CLS"/>
    <ProjectItem name="Docs.StorageOut" type="CLS"/>
    <ProjectItem name="Docs.StorageOutItems" type="CLS"/>
    <ProjectItem name="Docs.Super" type="CLS"/>
    <ProjectItem name="Docs.Utiliz" type="CLS"/>
    <ProjectItem name="Docs.UtilizItems" type="CLS"/>
    <ProjectItem name="Docs.waste" type="CLS"/>
    <ProjectItem name="Goods.Card" type="CLS"/>
    <ProjectItem name="Goods.CardAction" type="CLS"/>
    <ProjectItem name="Goods.Catalogue" type="CLS"/>
    <ProjectItem name="Goods.CatalogueAction" type="CLS"/>
    <ProjectItem name="Goods.Goods" type="CLS"/>
    <ProjectItem name="Goods.GoodsAction" type="CLS"/>
    <ProjectItem name="Goods.GoodsGroup" type="CLS"/>
    <ProjectItem name="Goods.GoodsKontrBan" type="CLS"/>
    <ProjectItem name="Goods.GoodsParams" type="CLS"/>
    <ProjectItem name="Goods.Group" type="CLS"/>
    <ProjectItem name="Goods.GroupAction" type="CLS"/>
    <ProjectItem name="Goods.Measure" type="CLS"/>
    <ProjectItem name="Goods.Params" type="CLS"/>
    <ProjectItem name="Goods.Users" type="CLS"/>
    <ProjectItem name="Kontragent.Action" type="CLS"/>
    <ProjectItem name="Kontragent.DocsFilter" type="CLS"/>
    <ProjectItem name="Kontragent.Meeting" type="CLS"/>
    <ProjectItem name="Kontragent.SendMailLog" type="CLS"/>
    <ProjectItem name="Operation.IDocView" type="CLS"/>
    <ProjectItem name="Operation.InstrActions" type="CLS"/>
    <ProjectItem name="Operation.Instructions" type="CLS"/>
    <ProjectItem name="Operation.InstructionsHist" type="CLS"/>
    <ProjectItem name="Operation.InstructionsItems" type="CLS"/>
    <ProjectItem name="Operation.OperTemplate" type="CLS"/>
    <ProjectItem name="Operation.Operation" type="CLS"/>
    <ProjectItem name="Operation.OperationHistory" type="CLS"/>
    <ProjectItem name="Operation.Plan" type="CLS"/>
    <ProjectItem name="Operation.PlanItems" type="CLS"/>
    <ProjectItem name="Operation.Step" type="CLS"/>
    <ProjectItem name="Operation.StepHistory" type="CLS"/>
    <ProjectItem name="Operation.StepTemplate" type="CLS"/>
    <ProjectItem name="Reports.ActSverki" type="CLS"/>
    <ProjectItem name="Reports.Analyzis" type="CLS"/>
    <ProjectItem name="Reports.ShowTables" type="CLS"/>
    <ProjectItem name="Store.Action" type="CLS"/>
    <ProjectItem name="Store.Address" type="CLS"/>
    <ProjectItem name="Store.AddressOld" type="CLS"/>
    <ProjectItem name="Store.Brak" type="CLS"/>
    <ProjectItem name="Store.Cell" type="CLS"/>
    <ProjectItem name="Store.Depot" type="CLS"/>
    <ProjectItem name="Store.GarantAction" type="CLS"/>
    <ProjectItem name="Store.Measures" type="CLS"/>
    <ProjectItem name="Store.Params" type="CLS"/>
    <ProjectItem name="Store.Price" type="CLS"/>
    <ProjectItem name="Store.Quantity" type="CLS"/>
    <ProjectItem name="Store.Zone" type="CLS"/>
    <ProjectItem name="User.REGION" type="CLS"/>
    <ProjectItem name="User.Settings" type="CLS"/>
    <ProjectItem name="User.TOV" type="CLS"/>
    <ProjectItem name="User.instument" type="CLS"/>
    <ProjectItem name="User.valera" type="CLS"/>
    <ProjectItem name="Users.Dates" type="CLS"/>
    <ProjectItem name="Users.FunctionUser" type="CLS"/>
    <ProjectItem name="Users.Functions" type="CLS"/>
    <ProjectItem name="Users.Journal" type="CLS"/>
    <ProjectItem name="Users.NameRoles" type="CLS"/>
    <ProjectItem name="Users.OptionRoles" type="CLS"/>
    <ProjectItem name="Users.RenameGlobal" type="CLS"/>
    <ProjectItem name="Users.Roles" type="CLS"/>
    <ProjectItem name="Utils.Class" type="CLS"/>
    <ProjectItem name="Utils.Propis" type="CLS"/>
    <ProjectItem name="csp.Base" type="CLS"/>
    <ProjectItem name="csp.Chat2Ka" type="CLS"/>
    <ProjectItem name="csp.CheckSerial3" type="CLS"/>
    <ProjectItem name="csp.Design" type="CLS"/>
    <ProjectItem name="csp.Documents" type="CLS"/>
    <ProjectItem name="csp.Documents2" type="CLS"/>
    <ProjectItem name="csp.EmpLight3" type="CLS"/>
    <ProjectItem name="csp.GlobalBinary" type="CLS"/>
    <ProjectItem name="csp.GoodsRights" type="CLS"/>
    <ProjectItem name="csp.Instruction" type="CLS"/>
    <ProjectItem name="csp.Ka" type="CLS"/>
    <ProjectItem name="csp.KaAuth" type="CLS"/>
    <ProjectItem name="csp.KaAuthCheck" type="CLS"/>
    <ProjectItem name="csp.KaChat" type="CLS"/>
    <ProjectItem name="csp.KaOrders" type="CLS"/>
    <ProjectItem name="csp.KaProtected" type="CLS"/>
    <ProjectItem name="csp.KaReportCSA3" type="CLS"/>
    <ProjectItem name="csp.KaReports" type="CLS"/>
    <ProjectItem name="csp.KontragentAccount" type="CLS"/>
    <ProjectItem name="csp.Logon" type="CLS"/>
    <ProjectItem name="csp.PaymentOrderView" type="CLS"/>
    <ProjectItem name="csp.Protected" type="CLS"/>
    <ProjectItem name="csp.ReqWar" type="CLS"/>
    <ProjectItem name="csp.ReqWar2" type="CLS"/>
    <ProjectItem name="csp.Serials2" type="CLS"/>
    <ProjectItem name="csp.ShowLicense" type="CLS"/>
    <ProjectItem name="csp.StatusBar" type="CLS"/>
    <ProjectItem name="csp.StoreSelect" type="CLS"/>
    <ProjectItem name="csp.StreamServer" type="CLS"/>
    <ProjectItem name="csp.WarrantyCard" type="CLS"/>
    <ProjectItem name="csp.WarrantyCardImport" type="CLS"/>
    <ProjectItem name="csp.WarrantyCardImport2" type="CLS"/>
    <ProjectItem name="csp.console" type="CLS"/>
    <ProjectItem name="csp.jqGrid" type="CLS"/>
    <ProjectItem name="csp.jqgrid412src" type="CLS"/>
    <ProjectItem name="csp.makeTovNaklV2" type="CLS"/>
    <ProjectItem name="csp.repSO" type="CLS"/>
    <ProjectItem name="csp.screen.chet2" type="CLS"/>
    <ProjectItem name="csp.screen.chetapi" type="CLS"/>
    <ProjectItem name="csp.screen.torg12v2" type="CLS"/>
    <ProjectItem name="csp.screen.torg12v3" type="CLS"/>
    <ProjectItem name="csp.screen.torg12v4" type="CLS"/>
    <ProjectItem name="csp/sklad2/ActFromClient.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/AddGoodsProp.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/AddGoodsProp2.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/AnalogForm.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/ArchiveBase.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Attach2Model.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Brak.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/BrakUtiliz.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CardData.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Cards.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/ChangeGoods.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CheckRemontPrices.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CheckSerial.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CheckSerial2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CloseSession.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/ComboBox.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Commands.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CreateAnalogs.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CreateHackInvent.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/CreateNewDict.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Data.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DictItem.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DictItem2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DictVersions.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Dictionary.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DocImages.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DocsExportImport.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DocsList.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/DocsRash.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/FillInnerStorage.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/FindGood.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/FixReserves.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/ForceFilesCreation.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GetFile.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GetGoodsImagesNames.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Globalreuse.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/GoodCard.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GoodsCard.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GoodsListEdit.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GoodsParams.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/GoodsParams2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Gps.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Info.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/InnerInstructNew.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/InventarizationIgrid.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/JQGoods.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/JQGridData.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/JQserials.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/KontrDetailHistory.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/KontrMeetingResult.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/KontragentsListEdit.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/ListData.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/ListDataxml.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/LogJournal.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/LogOfCreation.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/LookCard.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/MailSetup.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/MakeSerial.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/ManyGarants.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/MestoOpera.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/NegativeQnt.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Operations.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Operations2.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/OperationsRight.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Reports/InOut.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/Reports/InnerInstrGoods.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/addCard.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/addTovar.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/addZone.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/analyzis.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/appstat.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/bank.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/calendar.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/checkgarant.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/chief.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/chief_new.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/classmethod.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/createinstruct.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/createinstructIgrid.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/createrole.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/createstorage.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/delGoodsProp.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/dicts.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/dicts_old.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/director.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docdiff.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docinner.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docinnerdiff.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docinvent.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docplatej.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docprihorder.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docs.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docs2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docs3.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docsDebug.CSP" type="CSP"/>
    <ProjectItem name="csp/sklad2/docssuper.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/document.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/docutiliz.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/emplight.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/empty.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/errors.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/excel.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/excelfile.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/finance.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/garant.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/goods.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/goodsBackupTask23.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/goodsJQ.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/index.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/instrhistory.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/instrstates.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/justempty.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/kontr.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/kontragent.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/launch.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/login.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/makescet.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/maketovnakl.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/multichange.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/norights.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/oldtovars.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/Act.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/ActSverki.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/Brakremont.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/ChiefInstr.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/ChiefPlanHtml.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/ChiefPlanXml.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/InnerDiff.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/OLDchet.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/OstatkiExcel.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/OtchetSerialTake.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/PlanExcel.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/Sverka.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/actnote.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/actutil.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/chet.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/factura.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/inner.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/instrotbor.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/invent.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/otchet.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/otchet2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/plat-por.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/platejnoe.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/platpor.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/prih.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/prihorder.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/rash.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/rashСЦенами.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/sluzap.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/sluzapBackup.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/sluzapResults.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/torg12.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/tovnakl.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/tovnakl2.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/screen/zayavka.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/store.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/toolbar.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/tovbuf.csp" type="CSP"/>
    <ProjectItem name="csp/sklad2/tovprice.csp" type="CSP"/>
    <ProjectItem name="json.Catalogue" type="CLS"/>
    <ProjectItem name="json.CommonDicts" type="CLS"/>
    <ProjectItem name="json.Docs.Act" type="CLS"/>
    <ProjectItem name="json.Docs.ActNote" type="CLS"/>
    <ProjectItem name="json.Docs.Brakremont" type="CLS"/>
    <ProjectItem name="json.Docs.Diff" type="CLS"/>
    <ProjectItem name="json.Docs.DocBrak" type="CLS"/>
    <ProjectItem name="json.Docs.Docs" type="CLS"/>
    <ProjectItem name="json.Docs.Inner" type="CLS"/>
    <ProjectItem name="json.Docs.InnerDiff" type="CLS"/>
    <ProjectItem name="json.Docs.Invent" type="CLS"/>
    <ProjectItem name="json.Docs.Otchet" type="CLS"/>
    <ProjectItem name="json.Docs.OtchetNote" type="CLS"/>
    <ProjectItem name="json.Docs.Platejka" type="CLS"/>
    <ProjectItem name="json.Docs.Prih" type="CLS"/>
    <ProjectItem name="json.Docs.Rash" type="CLS"/>
    <ProjectItem name="json.Docs.Remont" type="CLS"/>
    <ProjectItem name="json.Docs.StorageIn" type="CLS"/>
    <ProjectItem name="json.Docs.StorageOut" type="CLS"/>
    <ProjectItem name="json.Docs.Utiliz" type="CLS"/>
    <ProjectItem name="json.DynamicSql" type="CLS"/>
    <ProjectItem name="json.Goods" type="CLS"/>
    <ProjectItem name="json.GoodsGroup" type="CLS"/>
    <ProjectItem name="json.GoodsGroup2" type="CLS"/>
    <ProjectItem name="json.GoodsJQ" type="CLS"/>
    <ProjectItem name="json.GoodsParams" type="CLS"/>
    <ProjectItem name="json.GoodsRights" type="CLS"/>
    <ProjectItem name="json.KaOrders" type="CLS"/>
    <ProjectItem name="json.KaReports" type="CLS"/>
    <ProjectItem name="json.Kontragent" type="CLS"/>
    <ProjectItem name="json.WarrantyCard" type="CLS"/>
    <ProjectItem name="json.instruction" type="CLS"/>
    <ProjectItem name="json.irows" type="CLS"/>
    <ProjectItem name="json.serials" type="CLS"/>
    <ProjectItem name="json.service2" type="CLS"/>
    <ProjectItem name="json.xvrs" type="CLS"/>
  </Items>
</Project>


<Class name="Operation.IDocView">
<Description>
Инструкции в вместе со связанными документами
только Инструкции у которых есть дочерние документы</Description>
<ClassType>view</ClassType>
<CompileAfter>Docs.Super,Operation.Instructions</CompileAfter>
<Owner>_SYSTEM</Owner>
<ProcedureBlock>0</ProcedureBlock>
<SqlTableName>IDocView</SqlTableName>
<TimeCreated>62305,79283.444657</TimeCreated>
<ViewQuery><![CDATA[ 
  
  		SELECT I.ID as IID,I.Name as INAME, I.InstDate as IDATE
  				, I.State as ISTATE,%external(I.State) as ISTATENAME
  				, I.Depot1 as IDEPOT1, I.Kontr as IKONTR, I.Kontr->Name as IKONTRNAME
  				, I.Oper as IOPER, I.Oper->Name as IOPERNAME
  				, I.dostavka as IDOSTAVKA, I.dostavka->Name as IDOSTAVKANAME 
  				, I.User1 as IUSER,I.User1->Name as IUSERNAME
  				, I.postnumber as IPOSTNUM, I.POSTDATA as IPOSTDATE
  				, I.RashOplatType->Name as IROTNAME
  				, I.ShowColor as ICOLOR
  			   ,D.DocumentClass as DCLASS,D.ID as DOCID,D.Name as DNAME
  			   
  				
  		FROM Operation.Instructions as I Inner Join Docs.Super as D 
  			On ($PIECE(I.Oper->cl,',')=D.DocumentClass And I.ID=D.Source)

   
   ]]></ViewQuery>
</Class>


<Class name="Operation.InstrActions">
<Description>
Действия с инструкциями</Description>
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60368,10170.107302</TimeCreated>

<Method name="changestat">
<ClassMethod>1</ClassMethod>
<FormalSpec>instrid,newstat,HasBeenSent:%String=""</FormalSpec>
<Implementation><![CDATA[
 //1Создана
 //2Утверждена
 //3Принята
 //4Укомплектовано
 //5Отправлено в офис
 //6Отправлено со склада
 //7Отправлено из офиса
 //8Отправлено экспресс-почтой
 //9Завершено
 s $ZT="changestatErr"
 s instr=##class(Operation.Instructions).%OpenId(instrid)
 
 
 i '$ISOBJECT(instr) $$$WriteError("changestat Не удалось открыть инструкцию ("_instrid_") класс Operation.Instructions") q "Невозможно извлечь информацию об указанном документе в базе данных."
 
 i '$ISOBJECT(instr.Oper) q "Извините, эту операцию невозможно выполнить. Для инструкции не установлен шаблон операции, пожалуйста установите его перед завершением инструкции."
 
 //30.11.2012 Запрещаем завершать инструкции без внутренних инструкций
 if (instr.Oper.%Id()=10),newstat=9,'$ISOBJECT(instr.innerinstr) q "Извините, невозможно завершить инструкцию, так как к ней не привязана внутренняя инструкция. Пожалуйста, закройте внутреннюю инструкцию в разделе Рабочее место на складе."
 
 s oldstat=instr.State
 i newstat=2 d
 . i (oldstat'=1)&(oldstat'=9)&(oldstat'=8.6) s err="Инструкция уже утверждена" q
 . i '$ISOBJECT(instr.Kontr) s err="В инструкции не указан контрагент" q
 if $G(err)'="" q err
 i newstat=9 s instr.Stat=2	//если "завершена" то закрываем документ (для записи времени и оператора)
 s instr.State=newstat
 
 //запись истории 
 s hc=##class(Operation.InstructionsHist).%New()
 s hc.StateChangeD=+$H
 s hc.StateChangeT=$P($H,",",2)
 s hc.State=newstat
 Do instr.ChangesChain.Insert(hc)
 s instr.HasBeenSent=HasBeenSent
 s ok=instr.%Save()
 
 s NewStateName=instr.StateLogicalToDisplay(newstat)
 
 i 'ok $$$WriteObjError(ok) q "Ошибка при изменении статуса"
 q 1_"@"_NewStateName
changestatErr
 $$$WriteError($ZE)
 q "Извините при изменении статуса произошла ошибка"
]]></Implementation>
</Method>

<Method name="startoper">
<ClassMethod>1</ClassMethod>
<FormalSpec>instobj</FormalSpec>
<Implementation><![CDATA[
 s $ZT="startoperErr"
 i '$ISOBJECT(instobj) $$$WriteError("Не удалось открыть инструкцию ("_instrid_") класс Operation.Instructions") q "Статус изменён но возникла ошибка при создании операции."
 s newoper=##class(Operation.OperationHistory).%New()
 s newoper.Start=+$H
 s newoper.StartTime=$P($H,",",2)
 s newoper.Name="Операция инструкции "_instobj.Name
 s newoper.OperTemplate=instobj.Oper
 s newoper.Depot=instobj.Depot
 s newoper.instruction=instobj
 s ok=newoper.%Save()
 i '+ok $$$WriteObjError(ok) q "Статус изменён, но возникла ошибка при создании операции."
 q newoper.%Id()
startoperErr
 $$$WriteError($ZE)
 q "Статус изменён, но возникла ошибка при создании операции."
]]></Implementation>
</Method>

<Method name="endoper">
<ClassMethod>1</ClassMethod>
<FormalSpec>instobj</FormalSpec>
<Implementation><![CDATA[
 s $ZT="startoperErr"
 
 i '$ISOBJECT(instobj) $$$WriteError("Не удалось открыть инструкцию ("_instrid_") класс Operation.Instructions") q "Статус изменён но возникла ошибка при завершении операции."
 s newoper=instobj.Operation
 i '$ISOBJECT(newoper) $$$WriteError("Не удалось открыть операцию ("_instobj.Operation_") класс Operation.OperationHistory") q "Статус изменён но возникла ошибка при завершении операции."
 s newoper.EndDate=+$H
 s newoper.EndTime=$P($H,",",2)
 s ok=newoper.%Save()
 i '+ok $$$WriteObjError(ok) q "Статус изменён, но возникла ошибка при создании операции."
 q 1
startoperErr
 $$$WriteError($ZE)
 q "Статус изменён, но возникла ошибка при создании операции."
]]></Implementation>
</Method>

<Method name="create">
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName,ItemID,NamesStr,RowDataStr,TypesStr</FormalSpec>
<Implementation><![CDATA[
 s $ZT="createErr"
 s doc=##class(Common.Common).SaveItem(ClassName,ItemID,NamesStr,RowDataStr,TypesStr)
 i '+doc $$$WriteObjError(doc) q doc
 q doc
createErr
 $$$WriteError($ZE)
 q "Извините. При сохранении инструкции возникла ошибка."
]]></Implementation>
</Method>

<Method name="pickasanswer">
<ClassMethod>1</ClassMethod>
<FormalSpec>docid</FormalSpec>
<Implementation><![CDATA[
 s $ZT="pickasanswerErr",err="Извините. При привязке внутренней инструкции к инструкции руководителя возникла ошибка."
 i '$ISOBJECT(docid) s innerinstr=##class(Docs.Super).%OpenId(docid)
 e  s innerinstr=docid
 i '$ISOBJECT(innerinstr.Source) $$$WriteError("Внутренняя инструкция id="_docid_" не содержит ссылку на накладную") q err
 i '$ISOBJECT(innerinstr.Source.Source) $$$WriteError("Накладная внутренней инструкции id="_docid_" не содержит ссылку на инструкцию руководителя") q err
 s instr=innerinstr.Source.Source
 i '$ISOBJECT(docid) d instr.innerinstrSetObjectId(docid)
 e  s instr.innerinstr=docid
 s ok=instr.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. При привязке внутренней инструкции к инструкции руководителя возникла ошибка."
 q 1 
pickasanswerErr
 $$$WriteError($ZE)
 q "Извините. При привязке внутренней инструкции к инструкции руководителя возникла ошибка."
]]></Implementation>
</Method>

<Method name="InstructHist">
<ClassMethod>1</ClassMethod>
<FormalSpec>instrid,l,l2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="InstructHistErr"
 s instr=##class(Operation.Instructions).%OpenId(instrid)
 
 $$$StartXML
 
 s sc=xmlstr.Element("AllHeaders")
 	 s sc=xmlstr.Element("OneObject")
 		 $$$WriteElement("text","Состояние")
 		 $$$WriteElement("key","State")
	 s sc=xmlstr.EndElement()
	 s sc=xmlstr.Element("OneObject")
 		 $$$WriteElement("text","Дата")
 		 $$$WriteElement("key","StateChangeD")
	 s sc=xmlstr.EndElement()
 	 s sc=xmlstr.Element("OneObject")
 		 $$$WriteElement("text","Время")
 		 $$$WriteElement("key","StateChangeT")
	 s sc=xmlstr.EndElement()
 	 s sc=xmlstr.Element("OneObject")
 		 $$$WriteElement("text","Пользователь")
 		 $$$WriteElement("key","User1")
	 s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 //конец заголовков
 
 s f=##class(Operation.Instructions).%OpenId(instrid)
 i '$ISOBJECT(f) $$$WriteError("InstructHist. Не удалось открыть инструкцию ("_instrid_") класс Operation.Instructions") $$$EndXML q

 s sc=xmlstr.Element("AllObjects")
 Set key = ""

 Do {
	q:'$ISOBJECT(f.ChangesChain)
 	Set chain = f.ChangesChain.GetNext(.key)
 	q:'$ISOBJECT(chain)
 	s time="",date="",name=""
 s sc=xmlstr.Element("OneObject")
 	
 	s sc=xmlstr.Element("State")
 	s st=##class(Operation.Instructions).StateLogicalToDisplay(chain.State)
    $$$WriteElement("text",st)
	s sc=xmlstr.EndElement() 
	
 	s sc=xmlstr.Element("StateChangeD")
    i chain.StateChangeD'="" s date=$ZD(chain.StateChangeD)
    $$$WriteElement("text",date)
 	s sc=xmlstr.EndElement()   
 	
 	s sc=xmlstr.Element("StateChangeT")
 	i chain.StateChangeT'="" s time=$ZT(chain.StateChangeT)
    $$$WriteElement("text",time)
 	s sc=xmlstr.EndElement()   
 	
 	s sc=xmlstr.Element("User1")
 	i $ISOBJECT(chain.User1) s name=chain.User1.Name
    $$$WriteElement("text",name)
 	s sc=xmlstr.EndElement()   
 	 	
 s sc=xmlstr.EndElement()
 	  
 } While (key '= "")

 
 s sc=xmlstr.EndElement()


 $$$EndXML

 q 1
InstructHistErr
 $$$WriteError($ZE)
 q 1
]]></Implementation>
</Method>

<Method name="SetInstrDepot">
<ClassMethod>1</ClassMethod>
<FormalSpec>instrid,depot</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SetInstrDepotErr"
 s instrobj=##class(Operation.Instructions).%OpenId(instrid)
 i '$ISOBJECT(instrobj) $$$WriteError("SetInstrDepot Не удалось открыть объект "_instrid_" класса Operation.Instructions") q ""
 d instrobj.Depot1SetObjectId(depot)
 s ok=instrobj.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, ошибка при назначении склада инструкции"
 q 1
SetInstrDepotErr
 $$$WriteError($ZE)
 q "Извините, ошибка при назначении склада инструкции"
]]></Implementation>
</Method>

<Method name="InstrFromPlan">
<Description><![CDATA[
Создать инструкцию на основе плана
<br><var>Plan</var> - ID или объект плана (Operation.Plan)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Plan="",CreateAnyWay=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="InstrFromPlanErr"
 i Plan="" q "Ошибка. Не указан план руководителя. Инструкция не может быть создана."
 i '$ISOBJECT(Plan) s Plan=##class(Operation.Plan).%OpenId(Plan)
 i ('CreateAnyWay)&(Plan.Stat=2) q "PlanIsClosed"
 s Instr=##class(Operation.Instructions).%New()
 s Instr.Name=Plan.Name
 s Instr.Kontr=Plan.Kontr
 s Instr.Comment=Plan.Comment
 d Instr.SourceSetObjectId(Plan.%Id())
 
 // параметры которые возможно надо вынести в настройки
 s CurrentDepot=$S($ISOBJECT($G(%session)):$G(%session.Data("depot")),1:"")
 d Instr.Depot1SetObjectId(CurrentDepot)	//склад на который отправится инструкция
 d Instr.OperSetObjectId(1)		//тип операции (приём товара)
 s Instr.InstDate=+$H			//дата инструкции
 
 s ok=1
 //пошли по строкам плана
 s i="" f  s i=Plan.Items.Next(i) q:(i="")!('+ok)  d
 . s PlanItem=Plan.Items.GetAt(i)
 . s InstrItem=##class(Operation.InstructionsItems).%New()
 . s InstrItem.Goods=PlanItem.Goods
 . s InstrItem.Price=PlanItem.Price
 . s InstrItem.Quantity=PlanItem.Quantity
 . s InstrItem.Total=PlanItem.Total
 . d InstrItem.DocTypeSetObjectId("Operation.Instructions")
 . 
 . s ok=Instr.Items.Insert(InstrItem)
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при создании инструкции. План не может быть создан."
 s ok=Instr.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при создании инструкции. План не может быть создан."
 s Plan.Stat=2	//ставим плану статус "закрыт"
 s ok=Plan.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. Ошибка при закрытии плана. Инструкция создана, но план не закрыт."
 q Instr.%Id()
InstrFromPlanErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при создании инструкции на основе плана."
]]></Implementation>
</Method>

<Method name="DeleteInstrChildren">
<Description><![CDATA[
Удалить всех потомков инструкции руководителя
<br>InstrId - ID инструкции руководителя]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>InstrId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 TSTART
 s ok=1
 &sql(declare InstrChildren cursor for 
 select id,DocumentClass,DocumentClass->Name,Stat,Name
 into :ChildId,:DocumentClass,:DocumentClassName,:Stat,:Name
 from Docs.Super 
 where Source=:InstrId)
 &sql(open InstrChildren)
 //в цикле идём по всем потомкам инструкции
 f  &sql(fetch InstrChildren) q:(SQLCODE)!('+ok)  d
 . if Stat=2 s ok=DocumentClassName_" № "_Name_" находится в состоянии ""обработан"", поэтому удаление документов инструкции руководителя невозможно. Операция отменена." q
 . //удаляем строки текущего потомка инструкции
 . &sql(delete from Docs.DocItems where Doc=:ChildId)
 . if SQLCODE<0 s ok="Ошибка при удалении "_DocumentClassName_" № "_Name q
 . //если текущий потомок расходная - то удалим её потомка (то есть внутреннюю инструкцию)
 . if DocumentClass="Docs.Rash" s ok=$$KillRashChild(ChildId)
 &sql(close InstrChildren)
 if '+ok TROLLBACK  q ok
 //теперь удалим непосредственно потомков инструкции
 &sql(delete from Docs.Super where Source=:InstrId)
 if SQLCODE<0 s ok="Ошибка при удалении документов инструкции руководителя."
 if '+ok TROLLBACK  q ok
 TCOMMIT
 q 1
KillRashChild(ChildId)
 &sql(select id,DocumentClass,DocumentClass->Name,Stat,Name 
 	into :RashChildId,:DocumentClass,:DocumentClassName,:Stat,:Name
 	from Docs.Super where Source=:ChildId)
 if Stat=2 q DocumentClassName_" № "_Name_" находится в состоянии ""обработан"", поэтому удаление документов инструкции руководителя невозможно. Операция отменена."
 
 &sql(delete from Docs.StorageOutItems where Doc=:RashChildId)
 if SQLCODE<0 q "Ошибка при удалении "_DocumentClassName_" № "_Name
 
 &sql(delete from Docs.DocItems where Doc=:RashChildId)
 if SQLCODE<0 q "Ошибка при удалении "_DocumentClassName_" № "_Name
 &sql(delete from Docs.Super where Source=:RashChildId)
 if SQLCODE<0 q "Ошибка при удалении строк "_DocumentClassName_" № "_Name
 q 1
]]></Implementation>
</Method>

<Method name="GetInstrType">
<ClassMethod>1</ClassMethod>
<FormalSpec>InstrId:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(select Oper into :Oper from Operation.Instructions where ID=:InstrId)
	if SQLCODE $$$WriteError("Ошибка SQLCODE. GetInstrType InstrId="_InstrId_" SQLCODE="_SQLCODE) q ""
	q Oper
]]></Implementation>
</Method>

<Method name="GoodsHasBeenSent">
<ClassMethod>1</ClassMethod>
<FormalSpec>InnerInstr,Goods</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(select sum(quantdefault),sum(quantreal)
		into :quantdefault,:quantreal
		from Docs.StorageOutItems
		where doc=:InnerInstr
			and Goods=:Goods)
	if SQLCODE q 0	//если не нашли инструкцию и товар. значит не отправили
	if quantdefault>quantreal q 0	//если заказывали больше чем отправили, значит не отправили
	q 1	//во всех иных случаях считаем что отправили
]]></Implementation>
</Method>

<Method name="GetInnerInstr">
<ClassMethod>1</ClassMethod>
<FormalSpec>Instr:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	&sql(select innerinstr into :innerinstr from Operation.Instructions where ID=:Instr)
	if SQLCODE q 0
	q innerinstr
]]></Implementation>
</Method>

<Method name="GetInstrReminderText">
<Description>
Получить </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ShowOnlyCount=0</FormalSpec>
<Implementation><![CDATA[
	s $ZT = "GetInstrReminderTextErr"
	s str="<table border=1>"
	s DaysCount = $$$TunesVariableGlobal("ShowInstrReminder")
	&sql(declare ReminderCr cursor for
		select ID,dat,Name,Kontr->Name,%external(State),State
		into :ID,:dat,:Name,:KontrName,:StateName,:State
		from Operation.Instructions 
		where ({fn CURDATE()}-dat>=:DaysCount) 
			AND ( not State in (9,8.6) )
		)
	&sql(open ReminderCr)
	f  &sql(fetch ReminderCr) q:SQLCODE  d
	. s CurrentInstr = "<tr><td>"_$I(counter)
	. s CurrentInstr = CurrentInstr_"<td>"_Name
	. s CurrentInstr = CurrentInstr_"<td> от "_$ZD(dat,4)
	. s CurrentInstr = CurrentInstr_"<td>"_StateName
	. s CurrentInstr = CurrentInstr_"<td>"_KontrName
	. s CurrentInstr = CurrentInstr_"<td><a href=""javascript:PrintInstr('"_ID_"')""><img src=""images/print.gif"" alt=""распечатать""></a>"
	. s CurrentInstr = CurrentInstr_"<a href=""javascript:ItemInstr('"_ID_"')""><img src=""images/edit.gif"" alt=""редактировать""></a>"
	. s str=str_CurrentInstr
	&sql(close ReminderCr)
	s str=str_"</table>"
	if ShowOnlyCount q +$G(counter)
	q str
GetInstrReminderTextErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при формировании списка пропущенных заявок."
]]></Implementation>
</Method>
</Class>


<Class name="Operation.Instructions">
<Description>
Инструкции</Description>
<Super>Docs.Super</Super>
<TimeCreated>60368,686.374027</TimeCreated>

<Property name="InstDate">
<Description>
Дата</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="InstDateIndex">
<Properties>InstDate</Properties>
</Index>

<Property name="Name">
<Description>
Краткое описание</Description>
<Type>%String</Type>
</Property>

<Property name="Depot1">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
</Property>

<Index name="DepotIndex">
<Type>bitmap</Type>
<Properties>Depot</Properties>
</Index>

<Property name="State">
<Description>
Состояние</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Создана,Утверждена,Принята,Укомплектовано,Отправлено в офис,Отправлено c товаром,Отправлено из офиса,Отправлено экпресс-почтой,Нет в наличии,Отклонена,Самовывоз,Отправлено транспортной компанией,Завершена"/>
<Parameter name="VALUELIST" value=",1,2,3,4,5,6,7,8,8.5,8.6,8.7,8.9,9"/>
</Property>

<Index name="StateIndex">
<Type>bitmap</Type>
<Properties>State</Properties>
</Index>

<Property name="Oper">
<Description>
Шаблон операции</Description>
<Type>Operation.OperTemplate</Type>
</Property>

<Index name="OperInd">
<Type>bitmap</Type>
<Properties>Oper</Properties>
</Index>

<Property name="Operation">
<Description>
Текущая операция</Description>
<Type>Operation.OperationHistory</Type>
</Property>

<Property name="innerinstr">
<Description>
Внутренняя инструкция</Description>
<Type>Docs.Super</Type>
</Property>

<Property name="dostavka">
<Description>
Способ доставки</Description>
<Type>Common.Dictionary1</Type>
</Property>

<Property name="imp">
<Description>
Важность</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=", ,Важно"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="ChangesChain">
<Type>Operation.InstructionsHist</Type>
<Cardinality>children</Cardinality>
<Inverse>instr</Inverse>
<Relationship>1</Relationship>
</Property>

<Property name="showcolor">
<Description>
Выделить цветом</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",,Красным,Синим"/>
<Parameter name="VALUELIST" value=",,red,blue"/>
</Property>

<Property name="postnumber">
<Description>
Номер почтового документа</Description>
<Type>%String</Type>
</Property>

<Index name="postnumbind">
<Properties>postnumber</Properties>
</Index>

<Property name="postdata">
<Description>
Дата почтового документа</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="PostDataIndex">
<Properties>postdata</Properties>
</Index>

<Property name="RashOplatType">
<Description>
Тип оплаты</Description>
<Type>Common.Dictionary7</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="RashOplatTypeInd">
<Properties>RashOplatType</Properties>
</Index>

<Property name="HasBeenSent">
<Description>
Инструкция отправлена</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Отправлена,Не отправлена"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Index name="HasBeenSent">
<Properties>HasBeenSent</Properties>
</Index>

<Property name="PhotoFile">
<Description>
путь к файлу с фотографией</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="255"/>
</Property>

<Property name="BrakComment">
<Description>
Комментарий клиента</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="BrakCommentDat">
<Description>
Комментарий клиента</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="BrakCommentAnswer">
<Description>
Ответ сервис менеджера на негативный отзыв</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="BrakCommentAnswerUser">
<Description>
Сервис менеджер ответивший на негативный отзыв</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="BrakCommentAnswerDat">
<Description>
Дата ответа сервис менеджера</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="RefuseReason">
<Description>
Причина отклонения заявки</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="RefuseReasonUser">
<Description>
Сервис менеджер написавший причину отклонения</Description>
<Type>Users.Dates</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Property name="RefuseReasonDat">
<Description>
Дата отклонения заявки</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InstructionsDefaultData</DefaultData>
<Data name="InstructionsDefaultData">
<Subscript>"Instructions"</Subscript>
<Value name="1">
<Value>Comment</Value>
</Value>
<Value name="2">
<Value>Contr</Value>
</Value>
<Value name="3">
<Value>Depot</Value>
</Value>
<Value name="4">
<Value>InstDate</Value>
</Value>
<Value name="5">
<Value>State</Value>
</Value>
<Value name="6">
<Value>OperType</Value>
</Value>
<Value name="7">
<Value>Oper</Value>
</Value>
<Value name="8">
<Value>Kontrag</Value>
</Value>
<Value name="9">
<Value>child</Value>
</Value>
<Value name="10">
<Value>innerinstr</Value>
</Value>
<Value name="11">
<Value>Operation</Value>
</Value>
<Value name="12">
<Value>Depot1</Value>
</Value>
<Value name="13">
<Value>dostavka</Value>
</Value>
<Value name="14">
<Value>imp</Value>
</Value>
<Value name="15">
<Value>showcolor</Value>
</Value>
<Value name="16">
<Value>postdata</Value>
</Value>
<Value name="17">
<Value>postnumber</Value>
</Value>
<Value name="18">
<Value>RashOplatType</Value>
</Value>
<Value name="19">
<Value>HasBeenSent</Value>
</Value>
<Value name="20">
<Value>BrakComment</Value>
</Value>
<Value name="21">
<Value>PhotoFile</Value>
</Value>
<Value name="22">
<Value>BrakCommentAnswer</Value>
</Value>
<Value name="23">
<Value>BrakCommentDat</Value>
</Value>
<Value name="24">
<Value>BrakCommentAnswerDat</Value>
</Value>
<Value name="25">
<Value>BrakCommentAnswerUser</Value>
</Value>
<Value name="26">
<Value>RefuseReason</Value>
</Value>
<Value name="27">
<Value>RefuseReasonDat</Value>
</Value>
<Value name="28">
<Value>RefuseReasonUser</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.InstructionsHist">
<Description>
Изменение состояний инструкции</Description>
<Super>%Persistent</Super>
<TimeCreated>60383,58765.719923</TimeCreated>

<Property name="instr">
<Description>
Инструкция</Description>
<Type>Operation.Instructions</Type>
<Cardinality>parent</Cardinality>
<Inverse>ChangesChain</Inverse>
<Relationship>1</Relationship>
</Property>

<Property name="State">
<Description>
Состояние</Description>
<Type>%String</Type>
<InitialExpression>"1"</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Создана,Утверждена,Принята,Укомплектовано,Отправлено в офис,Отправлено c товаром,Отправлено из офиса,Отправлено экпресс-почтой,Нет в наличии,Отклонена,Самовывоз,Отправлено транспортной компанией,Завершена"/>
<Parameter name="VALUELIST" value=",1,2,3,4,5,6,7,8,8.5,8.6,8.7,8.9,9"/>
</Property>

<Property name="StateChangeD">
<Description>
Дата перехода</Description>
<Type>%Date</Type>
</Property>

<Property name="StateChangeT">
<Description>
Время перехода</Description>
<Type>%Time</Type>
</Property>

<Property name="User1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.InstructionsHistD</DataLocation>
<DefaultData>InstructionsHistDefaultData</DefaultData>
<IdLocation>^Operation.InstructionsHistD</IdLocation>
<IndexLocation>^Operation.InstructionsHistI</IndexLocation>
<StreamLocation>^Operation.InstructionsHistS</StreamLocation>
<Data name="InstructionsHistDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>instr</Value>
</Value>
<Value name="3">
<Value>Stat</Value>
</Value>
<Value name="4">
<Value>StatChange</Value>
</Value>
<Value name="5">
<Value>StatChangeD</Value>
</Value>
<Value name="6">
<Value>StatChangeT</Value>
</Value>
<Value name="7">
<Value>State</Value>
</Value>
<Value name="8">
<Value>StateChange</Value>
</Value>
<Value name="9">
<Value>StateChangeD</Value>
</Value>
<Value name="10">
<Value>StateChangeT</Value>
</Value>
<Value name="11">
<Value>user</Value>
</Value>
<Value name="12">
<Value>User1</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.InstructionsItems">
<Super>Docs.DocItems</Super>
<TimeCreated>60410,44053.384771</TimeCreated>

<Property name="quantplan">
<Description>
Количество по плану</Description>
<Type>%Numeric</Type>
</Property>

<Index name="quantplanind">
<Properties>quantplan</Properties>
</Index>

<Property name="addr">
<Description>
Ячейка</Description>
<Type>Store.Address</Type>
</Property>

<Index name="indaddr">
<Properties>addr</Properties>
</Index>

<Property name="addr2">
<Description>
Место назначения</Description>
<Type>Store.Address</Type>
</Property>

<Index name="indaddr2">
<Properties>addr2</Properties>
</Index>

<Property name="spravka">
<Description>
№ и дата выписки Справки</Description>
<Type>%String</Type>
</Property>

<Property name="Client">
<Description>
Клиент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Property name="goodsdir">
<Description>
Действие с товаром</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Утилизация,Оприходование"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="garant">
<Description>
Гарантийный талон</Description>
<Type>%String</Type>
</Property>

<Method name="HasGarant">
<Description><![CDATA[
Проверяет наличие в данных записей с указаным гарантийным талоном
Необходим для проверки перед удалением гарантийного талона 
<class>Common.Dictionary2</class> из базы]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>garantId:%String</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
	#; Переделать на прямой доступ к индексной глобали
	&sql(Select Top 1 ID Into :id From Operation.InstructionsItems Where garant=:garantId)
	Q (SQLCODE'=100)
]]></Implementation>
</Method>

<Property name="sn">
<Description>
Серийный номер изделия</Description>
<Type>%String</Type>
</Property>

<Property name="seller">
<Description>
Организация продавшая товар</Description>
<Type>%String</Type>
</Property>

<Property name="opispolomki">
<Description>
Описание поломки</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="BrakComment">
<Description>
Комментарий клиента</Description>
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Property name="SellDate">
<Description>
Комментарий клиента</Description>
<Type>%Date</Type>
</Property>

<Property name="SellDate2">
<Description>
Дата продажи</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>InstructionsItemsDefaultData</DefaultData>
<Data name="InstructionsItemsDefaultData">
<Structure>listnode</Structure>
<Subscript>"InstructionsItems"</Subscript>
<Value name="1">
<Value>addr</Value>
</Value>
<Value name="2">
<Value>addr2</Value>
</Value>
<Value name="3">
<Value>quantplan</Value>
</Value>
<Value name="4">
<Value>Client</Value>
</Value>
<Value name="5">
<Value>garant</Value>
</Value>
<Value name="6">
<Value>goodsdir</Value>
</Value>
<Value name="7">
<Value>sn</Value>
</Value>
<Value name="8">
<Value>spravka</Value>
</Value>
<Value name="9">
<Value>seller</Value>
</Value>
<Value name="10">
<Value>opispolomki</Value>
</Value>
<Value name="11">
<Value>BrakComment</Value>
</Value>
<Value name="12">
<Value>SellDate</Value>
</Value>
<Value name="13">
<Value>SellDate2</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.Operation">
<Description>
Операции</Description>
<Super>%Persistent</Super>
<TimeCreated>61222,36826.911402</TimeCreated>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
</Property>

<Index name="Goods">
<Properties>Goods</Properties>
</Index>

<Property name="Address">
<Description>
Ячейка</Description>
<Type>Store.Address</Type>
</Property>

<Index name="Address">
<Properties>Address</Properties>
</Index>

<Property name="Quantity">
<Description>
Количество </Description>
<Type>%Integer</Type>
</Property>

<Property name="Ostatok">
<Description>
Остаток после операции</Description>
<Type>%String</Type>
</Property>

<Property name="OperationType">
<Description>
Тип операции</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Запись в резерв,Снятие с резерва"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="OperationType">
<Properties>OperationType</Properties>
</Index>

<Property name="DocStr">
<Description>
Строка документа</Description>
<Type>Docs.DocItems</Type>
</Property>

<Index name="DocStr">
<Properties>DocStr</Properties>
</Index>

<Property name="Dat">
<Description>
Дата операции</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
</Property>

<Index name="Dat">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время операции</Description>
<Type>%Time</Type>
<InitialExpression>$P($H,",",2)</InitialExpression>
</Property>

<Index name="Tim">
<Properties>Tim</Properties>
</Index>

<Property name="User1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Index name="User1">
<Properties>User1</Properties>
</Index>

<Property name="Rezerv">
<Description>
Резерв после операции</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.OperationD</DataLocation>
<DefaultData>OperationDefaultData</DefaultData>
<IdLocation>^Operation.OperationD</IdLocation>
<IndexLocation>^Operation.OperationI</IndexLocation>
<StreamLocation>^Operation.OperationS</StreamLocation>
<Data name="OperationDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Address</Value>
</Value>
<Value name="3">
<Value>Dat</Value>
</Value>
<Value name="4">
<Value>DocStr</Value>
</Value>
<Value name="5">
<Value>Goods</Value>
</Value>
<Value name="6">
<Value>OperationType</Value>
</Value>
<Value name="7">
<Value>Ostatok</Value>
</Value>
<Value name="8">
<Value>Quantity</Value>
</Value>
<Value name="9">
<Value>Tim</Value>
</Value>
<Value name="10">
<Value>User1</Value>
</Value>
<Value name="11">
<Value>Rezerv</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.OperationHistory">
<Description>
История операций</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,47712.963472</TimeCreated>

<Property name="instruction">
<Description>
Инструкция</Description>
<Type>Operation.Instructions</Type>
</Property>

<Property name="Resource">
<Description>
Ресурсы</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Ресурсы"/>
</Property>

<Property name="Place">
<Description>
Место</Description>
<Type>Store.Address</Type>
<Parameter name="CAPTION" value="Место"/>
</Property>

<Index name="PlaceIndex">
<Properties>Place</Properties>
</Index>

<Property name="Name">
<Description>
Имя</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Имя"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Start">
<Description>
Дата начала</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value="Дата начала"/>
</Property>

<Property name="StartTime">
<Description>
Время начала</Description>
<Type>%Time</Type>
</Property>

<Property name="EndDate">
<Description>
Дата завершения</Description>
<Type>%Date</Type>
<Parameter name="CAPTION" value="Конец"/>
</Property>

<Property name="EndTime">
<Description>
Время завершения</Description>
<Type>%Time</Type>
</Property>

<Property name="OperTemplate">
<Description>
Шаблон</Description>
<Type>Operation.OperTemplate</Type>
<Parameter name="CAPTION" value="Шаблон"/>
</Property>

<Index name="OperTemplate">
<Properties>OperTemplate</Properties>
</Index>

<UDLText name="T">
<Content><![CDATA[
//Relationship StepHistory As Operation.StepHistory [ Cardinality = many, Inverse = OperationHistory ];

]]></Content>
</UDLText>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.OperationHistoryD</DataLocation>
<DefaultData>OperationHistoryDefaultData</DefaultData>
<IdLocation>^Operation.OperationHistoryD</IdLocation>
<IndexLocation>^Operation.OperationHistoryI</IndexLocation>
<StreamLocation>^Operation.OperationHistoryS</StreamLocation>
<Data name="OperationHistoryDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>End</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>Object</Value>
</Value>
<Value name="6">
<Value>OperTemplate</Value>
</Value>
<Value name="7">
<Value>Place</Value>
</Value>
<Value name="8">
<Value>Resource</Value>
</Value>
<Value name="9">
<Value>Start</Value>
</Value>
<Value name="10">
<Value>Depot</Value>
</Value>
<Value name="11">
<Value>Card</Value>
</Value>
<Value name="12">
<Value>EndTime</Value>
</Value>
<Value name="13">
<Value>StartTime</Value>
</Value>
<Value name="14">
<Value>EndDate</Value>
</Value>
<Value name="15">
<Value>instruction</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.OperTemplate">
<Description>
Шаблоны операций</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,35535.287873</TimeCreated>

<Property name="Resource">
<Description>
Ресурсы</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Ресурсы"/>
</Property>

<Property name="Place">
<Description>
Место</Description>
<Type>Store.Address</Type>
<Parameter name="CAPTION" value="Место"/>
</Property>

<Index name="PlaceIndex">
<Properties>Place</Properties>
</Index>

<Property name="Name">
<Description>
Имя</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Имя"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<UDLText name="T">
<Content><![CDATA[
// Средняя продолжительность

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Property Duration As %String(CAPTION = "Средняя продолжительность");

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Index DurationIndex On Duration;

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
// Шаги

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Relationship Steps As Operation.StepTemplate [ Cardinality = many, Inverse = Operation ];

]]></Content>
</UDLText>

<Property name="OperType">
<Description>
Тип операции</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Приём,Отгрузка,Внутренняя"/>
<Parameter name="VALUELIST" value=",Приём,Отгрузка,Внутренняя"/>
</Property>

<Property name="cspfile">
<Description>
CSP файл</Description>
<Type>%String</Type>
</Property>

<Property name="cl">
<Description>
Класс</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.OperTemplateD</DataLocation>
<DefaultData>OperTemplateDefaultData</DefaultData>
<IdLocation>^Operation.OperTemplateD</IdLocation>
<IndexLocation>^Operation.OperTemplateI</IndexLocation>
<StreamLocation>^Operation.OperTemplateS</StreamLocation>
<Data name="OperTemplateDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Step</Value>
</Value>
<Value name="3">
<Value>Place</Value>
</Value>
<Value name="4">
<Value>Resource</Value>
</Value>
<Value name="5">
<Value>Comment</Value>
</Value>
<Value name="6">
<Value>Name</Value>
</Value>
<Value name="7">
<Value>Duration</Value>
</Value>
<Value name="8">
<Value>Steps</Value>
</Value>
<Value name="9">
<Value>Depot</Value>
</Value>
<Value name="10">
<Value>OperType</Value>
</Value>
<Value name="11">
<Value>cl</Value>
</Value>
<Value name="12">
<Value>cspfile</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.Plan">
<Description>
План руководителя</Description>
<Super>Docs.Super</Super>
<TimeCreated>60762,38407.703272</TimeCreated>

<Property name="PlanDate">
<Description>
Начальная дата</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="PlanDate2">
<Description>
Конечная дата</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Property name="DocLanguage">
<Description>
Язык</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Русский,Английский"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="DocLanguageInd">
<Properties>DocLanguage</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>PlanDefaultData</DefaultData>
<Data name="PlanDefaultData">
<Structure>listnode</Structure>
<Subscript>"Plan"</Subscript>
<Value name="1">
<Value>PlanDate</Value>
</Value>
<Value name="2">
<Value>PlanDate2</Value>
</Value>
<Value name="3">
<Value>Language</Value>
</Value>
<Value name="4">
<Value>DocLanguage</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.PlanItems">
<Description>
Строки плана руководителя</Description>
<Super>Docs.DocItems</Super>
<TimeCreated>60762,39022.264863</TimeCreated>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
</Storage>
</Class>


<Class name="Operation.Step">
<Description>
Шаги операций</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,35175.524796</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.StepD</DataLocation>
<DefaultData>StepDefaultData</DefaultData>
<IdLocation>^Operation.StepD</IdLocation>
<IndexLocation>^Operation.StepI</IndexLocation>
<StreamLocation>^Operation.StepS</StreamLocation>
<Data name="StepDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Place</Value>
</Value>
<Value name="4">
<Value>Resource</Value>
</Value>
<Value name="5">
<Value>Depot</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.StepHistory">
<Description>
История шагов операций</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,47850.929341</TimeCreated>

<Property name="Resource">
<Description>
Ресурсы</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Ресурсы"/>
</Property>

<Property name="Place">
<Description>
Место</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Место"/>
</Property>

<Index name="PlaceIndex">
<Properties>Place</Properties>
</Index>

<Property name="Name">
<Description>
Имя</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Имя"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Start">
<Description>
Начало</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Начало"/>
</Property>

<Property name="End">
<Description>
Конец</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Конец"/>
</Property>

<UDLText name="T">
<Content><![CDATA[
//Relationship OperationHistory As Operation.OperationHistory [ Cardinality = one, Inverse = StepHistory ];

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Index OperationHistoryIndex On OperationHistory;

]]></Content>
</UDLText>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.StepHistoryD</DataLocation>
<DefaultData>StepHistoryDefaultData</DefaultData>
<IdLocation>^Operation.StepHistoryD</IdLocation>
<IndexLocation>^Operation.StepHistoryI</IndexLocation>
<StreamLocation>^Operation.StepHistoryS</StreamLocation>
<Data name="StepHistoryDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>End</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>OperationHistory</Value>
</Value>
<Value name="6">
<Value>Place</Value>
</Value>
<Value name="7">
<Value>Resource</Value>
</Value>
<Value name="8">
<Value>Start</Value>
</Value>
<Value name="9">
<Value>Depot</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Operation.StepTemplate">
<Description>
Шаблон шагов</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,45228.535448</TimeCreated>

<Property name="Resource">
<Description>
Ресурсы</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Ресурсы"/>
</Property>

<Property name="Place">
<Description>
Место</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Место"/>
</Property>

<Index name="PlaceIndex">
<Properties>Place</Properties>
</Index>

<Property name="Name">
<Description>
Имя</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Имя"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Duration">
<Description>
Средняя продолжительность</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Средняя продолжительность"/>
</Property>

<Index name="DurationIndex">
<Properties>Duration</Properties>
</Index>

<Property name="Step">
<Description>
Шаг</Description>
<Type>Operation.Step</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Шаг"/>
</Property>

<Index name="StepIndex">
<Properties>Step</Properties>
</Index>

<Property name="Sequence">
<Description>
Порядок</Description>
<Type>%Integer</Type>
<Parameter name="CAPTION" value="Порядок"/>
</Property>

<UDLText name="T">
<Content><![CDATA[
// Операция

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Relationship Operation As Operation.OperTemplate [ Cardinality = one, Inverse = Steps ];

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//Index OperationIndex On Operation;

]]></Content>
</UDLText>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Store.Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Operation.StepTemplateD</DataLocation>
<DefaultData>StepTemplateDefaultData</DefaultData>
<IdLocation>^Operation.StepTemplateD</IdLocation>
<IndexLocation>^Operation.StepTemplateI</IndexLocation>
<StreamLocation>^Operation.StepTemplateS</StreamLocation>
<Data name="StepTemplateDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>Duration</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>Place</Value>
</Value>
<Value name="6">
<Value>Resource</Value>
</Value>
<Value name="7">
<Value>Sequence</Value>
</Value>
<Value name="8">
<Value>Step</Value>
</Value>
<Value name="9">
<Value>Operation</Value>
</Value>
<Value name="10">
<Value>Depot</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Reports.ActSverki">
<Description><![CDATA[
Акт сверки взаиморасчетов
Замена csp-файлу screen/AktSverki 
Необходимость появилась после требования выводить сумму в валюте контрагента
Акт сверки взаиморасчетов — это документ, 
отражающий состояние взаимных расчетов между сторонами за определенный период. 
http://formz.ru/forms/act_sverki/info
Данный класс - это объектная модель акта сверки
<example>s act=##class(Reports.ActSverki).%New(597,192,61600,61602)
d act.Prepare(), act.Output()
k act
</example>]]></Description>
<Super>%RegisteredObject,%CSP.Page</Super>
<TimeCreated>62407,74343.06928</TimeCreated>

<Parameter name="RUR">
<Description>
Код рубля</Description>
<Type>%Integer</Type>
<Default>1</Default>
</Parameter>

<Parameter name="USD">
<Description>
Код доллара</Description>
<Type>%Integer</Type>
<Default>2</Default>
</Parameter>

<Property name="start">
<Description>
Начало периода сверки</Description>
<Type>%Date</Type>
</Property>

<Property name="stop">
<Description>
Конец периода сверки</Description>
<Type>%Date</Type>
</Property>

<Property name="we">
<Description>
код нашей компании (слева)</Description>
<Type>%String</Type>
</Property>

<Property name="saldoStart">
<Description>
сальдо контрагента на начало периода</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="debitStart">
<Description>
положительное сальдо контрагента</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="creditStart">
<Description>
отрицательное сальдо контрагента</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="saldoStop">
<Description>
сальдо контрагента на начало периода</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="debitStop">
<Description>
положительное сальдо контрагента</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="creditStop">
<Description>
отрицательное сальдо контрагента</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Method name="weSet">
<Description>
Должен инициализироваться перед контрагентом</Description>
<FormalSpec>Arg:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s Arg=$g(Arg) 
	if ##class(Common.Kontragent).%ExistsId(Arg) {
		s i%we = Arg
	 	s i%weName = ##class(Common.Kontragent).NameGetStored(Arg)
	 	s i%weBoss = ##class(Common.Kontragent).chiefGetStored(Arg)
	}
]]></Implementation>
</Method>

<Property name="weName">
<Description>
наименование контрагента 2, определяется при назначении кода контрагента</Description>
<Type>%String</Type>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="weBoss">
<Description>
наименование контрагента 2, определяется при назначении кода контрагента</Description>
<Type>%String</Type>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="they">
<Description>
код контрагента (справа) </Description>
<Type>%String</Type>
</Property>

<Method name="theySet">
<Description>
При присвоении контрагента инициализируем остальные переменные </Description>
<FormalSpec>Arg:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	 s Arg=$g(Arg) 
	 if ##class(Common.Kontragent).%ExistsId(Arg) {
		 s i%they=Arg
	 	s i%theyName = ##class(Common.Kontragent).NameGetStored(Arg)
	 	s i%theyBoss = ##class(Common.Kontragent).chiefGetStored(Arg)
	 	s i%currency=##class(Common.Kontragent).CurrencyGetStored(Arg)  
	 	s i%rurMode=(..#RUR=..currency) 
	 	#;Наше юр. лицо с которым работает контрагент
	 	s:(..we="") ..we=##class(Common.Kontragent).OurCompanyGetStored(Arg)  
	 }
	 Q $$$OK
]]></Implementation>
</Method>

<Property name="theyName">
<Description>
наименование контрагента, определяется при назначении кода контрагента</Description>
<Type>%String</Type>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="theyBoss">
<Description>
директор контрагента, определяется при назначении кода контрагента</Description>
<Type>%String</Type>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="currency">
<Description>
Валюта расчета определяется исходя из кода контрагента</Description>
<Type>%String</Type>
<InitialExpression>..#RUR</InitialExpression>
<ReadOnly>1</ReadOnly>
<Parameter name="DISPLAYLIST" value=",RUR,USD"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Property name="rurMode">
<Type>%Boolean</Type>
<InitialExpression>1</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="docs">
<Description>
Массив со списком документов </Description>
<Type>%String</Type>
<MultiDimensional>1</MultiDimensional>
</Property>

<Property name="Debit">
<Description>
Приход за период</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Property name="Credit">
<Description>
Расход за период</Description>
<Type>%Currency</Type>
<InitialExpression>0</InitialExpression>
<ReadOnly>1</ReadOnly>
</Property>

<Method name="%OnNew">
<Description>
инициализация объекта </Description>
<FormalSpec>we:%String,they:%String,start:%Date,stop:%Date</FormalSpec>
<Private>1</Private>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s ..we=$g(we), ..they=$g(they), ..start=$g(start), ..stop=$g(stop)
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="Prepare">
<Description>
Подготовка отчета с указанными параметрами</Description>
<Implementation><![CDATA[
	;узнаем начальное сальдо контрагента
	s sc=##class(Account.Kontragent).Get(..they,$zd(..start,3),.rur,.usd) ;начальное сальдо
	#;w ..they,";",..start,";",rur,";",usd
	s saldo=$S(..rurMode:rur,1:usd) ;если валюты только две
	s i%saldoStart=saldo ;начальное сальдо в валюте контрагента
	if saldo>0 s i%debitStart=saldo
	if saldo<0 s i%creditStart=saldo*-1
	
	d ..getTheyDocs() ;собираем документы от контрагента (кредит)
	d ..getOurDocs() ;собираем документы от контрагента (дебет)
	
	s total = saldo + ..Debit - ..Credit
	s i%saldoStop=total
	if total>0 s i%debitStop=total
	if total<0 s i%creditStop=total*-1
]]></Implementation>
</Method>

<Method name="getTheyDocs">
<Description>
Выбираем все документы от контрагента</Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
 k ..docs ;сбрасываем список документов
 s they=..they,start=..start,stop=..stop ;копируем для запроса
 // выбрать все документы этого контрагента, в том числе платёжки от этого контрагента к нам
 &sql(declare theyDocs cursor for 
 	SELECT ID,DocumentClass,DocumentClass->Name,Name,Dat,Tim,Summa
 	INTO :id,:class,:classText,:name,:date,:time,:sum
 	FROM Docs.Super
 	WHERE Kontr=:they And Dat>=:start and Dat<=:stop 
 	 And Stat=2 -- Обработанные документы 
 	 And DocumentClass In ('Docs.Platejka','Docs.Rash','Docs.Otchet') -- влияющие на взаиморасчеты
  ) &sql(OPEN theyDocs)
  s count=0
  for { &sql(FETCH theyDocs) q:SQLCODE  
					if (class="Docs.Rash") { ;если расходная накладная, то извлечём рублёвую сумму
						s opl=##class(Docs.Rash).oplGetStored(id) 
						if opl=1 continue ; оплачено по гарантии не учитывать
						s:..rurMode sum=##class(Docs.Rash).RubSummaGetStored(id)
					}
					if (class="Docs.Otchet") { ;если технический отчёт
						s prove=##class(Docs.Otchet).GotPaperProveGetStored(id) 
						if 'prove continue  ;только если получено бумажное подверждение
						#; технический отчет валюто-зависимый, поле Summa содержит в валюте контрагента
					}
					if (class="Docs.Platejka") { ;если платёжка - вытащим рублёвую сумму
						s:..rurMode sum=##class(Docs.Platejka).RubSummaGetStored(id)
					} 
					s count=count+1
					s ..docs(id)="" 
					s ..docs(id,"class")=class, ..docs(id,"classText")=classText
					s ..docs(id,"name")=name, ..docs(id,"date")=date
					if (class="Docs.Rash")
					{
						s ..docs(id,"debit")=sum ;все уходит в дебит
						s i%Debit=sum+..Debit
					}
					else
					{
						s ..docs(id,"credit")=sum ;все уходит в кредит
						s i%Credit=sum+..Credit						
					}

 } &sql(close theyDocs)
 s ..docs=count
 Q $$$OK
]]></Implementation>
</Method>

<Method name="getOurDocs">
<Description>
Собираем документы от нас к контрагенту</Description>
<Implementation><![CDATA[
 // выбрать платёжки от нас к этому контрагенту
 s we=..we, they=..they,start=..start,stop=..stop ;копируем для запроса 
 &sql(declare ourDocs cursor for 
 	SELECT ID,DocumentClass,DocumentClass->Name,Name,Dat,Tim,Summa,RubSumma
 	INTO :id,:class,:classText,:name,:date,:time,:sum,:rSum
 	FROM Docs.Platejka
 	WHERE Poluh=:they and Kontr=:we and Stat=2
 	and Dat>=:start and Dat<=:stop)
 &sql(open ourDocs)
 s count=..docs
 f { &sql(fetch ourDocs) q:SQLCODE  
	s ..docs(id)=""
	s ..docs(id,"class")=class, ..docs(id,"classText")=classText
	s ..docs(id,"name")=name, ..docs(id,"date")=date
	s summa=$S(..rurMode:rSum,1:sum) 
	s ..docs(id,"debit")=summa ;все уходит в дебит
	s i%Debit=summa+..Debit
	s count=count+1
 } &sql(close ourDocs)
 s ..docs=count
]]></Implementation>
</Method>

<Method name="Dump">
<Implementation><![CDATA[
	w "<table border=1>"
 s num=0
 s id="" for { s id=$o(..docs(id)) q:id=""
 	s num=num+1
	w "<tr>"
	w "<td>",num,"</td>"	 
	s class=..docs(id,"classText")
	w "<td>",id,",",class,"</td>"	 
	s debit=$g(..docs(id,"debit"))	
	w "<td>",debit,"</td>"	 
	s credit=$g(..docs(id,"credit"))
	w "<td>",credit,"</td>"	 
	w "</tr>"
 }
 w "<table>"
]]></Implementation>
</Method>

<Method name="Output">
<Description>
вывод страницы с отчетом в html-excel</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 #define dtru(%date) $tr($zd(%date,4),"/",".")
 #define fn(%num) $s(+%num=0:"",1:$j(+%num,"",2))
  
 &html<<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta http-equiv=Content-Type content="text/html; charset=windows-1251"><meta name=ProgId content=Excel.Sheet><meta name=Generator content="Microsoft Excel 11">>
 d ..outputCss()
 &html<</head><body>
<table x:str border=0 cellpadding=0 cellspacing=0 width=971 style='border-collapse: collapse;table-layout:fixed;width:730pt'>
 <tr height=15 style='height:11.25pt'>
  <td height=15 width=14 style='height:11.25pt;width:11pt'></td>
  <td width=75 style='width:61pt'></td>
  <td width=183 style='width:135pt'></td>
  <td width=12 style='width:9pt'></td>
  <td width=61 style='width:43pt'></td>
  <td width=38 style='width:29pt'></td>
  <td width=92 style='width:69pt'></td>
  <td width=15 style='width:11pt'></td>
  <td width=2 style='width:2pt'></td>
  <td width=55 style='width:41pt'></td>
  <td width=188 style='width:141pt'></td>
  <td width=17 style='width:13pt'></td>
  <td width=65 style='width:49pt'></td>
  <td width=44 style='width:33pt'></td>
  <td width=109 style='width:82pt'></td>
  <td width=1 style='width:1pt'></td>
 </tr>
 <tr height=24 style='height:18.0pt'>
  <td height=24 style='height:18.0pt'></td>
  <td colspan=14 class=xl40>Акт сверки</td>
  <td></td>
 </tr>
 <tr height=51 style='mso-height-source:userset;height:38.45pt'>
  <td height=51 style='height:38.45pt'></td>
  <td colspan=15 class=xl46 width=957 style='width:719pt'>взаимных расчетов<br>
    между #(..weName)# и #(..theyName)# за период с #($$$dtru(..start))# по #($$$dtru(..stop))#</td>
 </tr>
 <tr height=24 style='mso-height-source:userset;height:18.0pt'>
  <td height=24 colspan=16 style='height:18.0pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=49 style='mso-height-source:userset;height:37.35pt'>
  <td height=49 style='height:37.35pt'></td>
  <td colspan=15 class=xl47 width=957 style='width:719pt'>Мы,
  нижеподписавшиеся, <u>#(..weName)#</u>, с одной стороны, и <u>#(..theyName)#</u>, с другой стороны, составили настоящий акт
  сверки в том, что состояние взаимных расчетов по данным учета следующее:</td>
 </tr>
 <tr height=18 style='mso-height-source:userset;height:13.5pt'>
  <td height=18 colspan=16 style='height:13.5pt;mso-ignore:colspan'></td>
 </tr>

 <tr height=17 style='mso-height-source:userset;height:13.35pt'>
  <td height=17 style='height:13.35pt'></td>
  <td colspan=8 class=xl48 width=478 style='width:359pt'>По
  данным #(..weName)#</td>
  <td colspan=7 class=xl48 width=479 style='border-left:none;width:360pt'>По данным > w ..theyName &html<</td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td class=xl18>Дата</td>
  <td colspan=2 class=xl18 >Документ</td>
  <td colspan=2 class=xl18 >Дебет, > w ..currencyLogicalToDisplay(..currency) &html<</td>
  <td colspan=3 class=xl18 >Кредит, > w ..currencyLogicalToDisplay(..currency) &html<</td>
  <td class=xl18 >Дата</td>
  <td colspan=2 class=xl18>Документ</td>
  <td colspan=2 class=xl18>Дебет</td>
  <td colspan=2 class=xl18>Кредит</td>
 </tr>
 
 <tr class=xl19 height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 class=xl19 style='height:11.85pt'></td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan;padding:0pt 4pt'>Сальдо начальное</td>
  <td colspan=2 class=xl43 style='padding:0pt 4pt'>> w $$$fn(..debitStart) &html<</td>
  <td colspan=3 class=xl43 style='padding:0pt 4pt'>> w $$$fn(..creditStart) &html<</td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan'>Сальдо начальное</td>
  <td class=xl24 colspan=2 style=''>&nbsp;</td>
  <td class=xl24 colspan=2 style=''>&nbsp;</td>
 </tr>>
 
 #;цикл по выбранным документам
 s count=0
 s id="" for { s id=$o(..docs(id)) q:id=""  
  s count=count+1 
 	s name = $g(..docs(id,"name")), class = $g(..docs(id,"class"))
 	s classText = $g(..docs(id,"classText")), date = $g(..docs(id,"date"))
 	s debit = $g(..docs(id,"debit")),  credit = $g(..docs(id,"credit"))
 	s debit=$J(debit,"",2), credit=$J(credit,"",2)
 	&html<<!--height=15 style='mso-height-source:userset;height:11.85pt'-->
 	<tr><td style="text-align:right;font-size:50%;">#(count)#</td>
  <td class=xl49>#($$$dtru(date))#</td>
  <td colspan=2 class=xl49 style="white-space:normal">
  	<a href="../print.csp?id=#(id)#&class=#(class)#" target=_blank>#(name)#</a> (#(classText)#)</td>
  <td colspan=2 class=xl50>#($$$fn(debit))#</td>
  <td colspan=3 class=xl50>#($$$fn(credit))#</td>
  <td class=xl49></td>
  <td colspan=2 class=xl49></td>
  <td colspan=2 class=xl49></td>
  <td colspan=2 class=xl49></td>
  </tr>>
 }
 
 &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan'>&nbsp;Обороты за период</td>
  <td colspan=2 class=xl43 style='padding:0pt 4pt;border-left:none'>> 
  	w $$$fn(..Debit) 
  &html<</td>
  <td colspan=3 class=xl43 style='padding:0pt 4pt;border-left:none'>> 
   w $$$fn(..Credit) 
  &html<</td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan'>&nbsp;Обороты за период</td>
  <td colspan=2 class=xl35 style=''>&nbsp;</td>
  <td colspan=2 class=xl35 style=''>&nbsp;</td>
 </tr>>
 
 &html<<tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan'>&nbsp;Сальдо конечное</td>
  <td colspan=2 class=xl43 style='padding:0pt 4pt'>#($$$fn(..debitStop))#</td>
  <td colspan=3 class=xl24 style='padding:0pt 4pt'>#($$$fn(..creditStop))#</td>
  <td class=xl20 colspan=3 style='mso-ignore:colspan'>&nbsp;Сальдо конечное</td>
  <td colspan=2 class=xl35 style=''>&nbsp;</td>
  <td colspan=2 class=xl35 style=''>&nbsp;</td>
 </tr>>
 
 &html<<tr height=15 style='height:11.25pt'>
  <td height=15 colspan=16 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=6 class=xl42 width=461 style='width:346pt'>&nbsp;</td>
  <td colspan=3 style='mso-ignore:colspan'></td>
  <td height=15 width=188 style='height:11.85pt;width:141pt'><!--[if gte vml 1]><v:shapetype
   id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
   path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
   <v:stroke joinstyle="miter"/>
   <v:formulas>
    <v:f eqn="if lineDrawn pixelLineWidth 0"/>
    <v:f eqn="sum @0 1 0"/>
    <v:f eqn="sum 0 0 @1"/>
    <v:f eqn="prod @2 1 2"/>
    <v:f eqn="prod @3 21600 pixelWidth"/>
    <v:f eqn="prod @3 21600 pixelHeight"/>
    <v:f eqn="sum @0 0 1"/>
    <v:f eqn="prod @6 1 2"/>
    <v:f eqn="prod @7 21600 pixelWidth"/>
    <v:f eqn="sum @8 21600 0"/>
    <v:f eqn="prod @7 21600 pixelHeight"/>
    <v:f eqn="sum @10 21600 0"/>
   </v:formulas>
   <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
   <o:lock v:ext="edit" aspectratio="t"/>
  </v:shapetype><v:shape id="_x0000_s1025" type="#_x0000_t75" style='position:absolute;
   margin-left:13.5pt;margin-top:6.75pt;width:0;height:0;z-index:1' stroked="t"
   strokecolor="windowText [64]">
   <v:fill color2="windowText [64]" type="frame"/>
   <v:imagedata src="Акт%20сверки%20№%20212.files/image001.wmz" o:title=""/>
   <x:ClientData ObjectType="Pict">
   </x:ClientData>
  </v:shape><![endif]--><!--[if !mso & vml]><span style='width:141.0pt;height:11.25pt'></span><![endif]--></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
 </tr>
 <tr><td></td><td colspan=6 class=xl41 width=461 style='width:346pt'>>
  #; Footer Text
   w "По данным ",..weName, "<div style='font-weight:600'> на ", $$$dtru(..stop)," задолженность "
   
   k in,dn s (in,dn)=""
   s cut="руб."
   if '..rurMode { ;формируем словари для прописи
    s cut="долл. США "
	   s in=1 ;доллар - мужской род 
	   s in(10)="долларов", in(5)="долларов", in(2)="доллара", in(1)="доллар", in(-1)="долларов"
	   s dn=1 ;цент - мужской род
	   s dn(10)="центов", dn(5)="центов", dn(2)="цента", dn(1)="цент", dn(-1)="цента"
	  }
   
   if (..saldoStop<0) { ;Сальдо кредитовое
    s full=$J(..creditStop,"",2)
	  	w " в пользу ",..theyName," составляет <span style='white-space:nowrap'>",full," ",cut,".</span>"
	  	w " (", ##class(Utils.Propis).Write(full,.in,.dn),")"
   } elseif (..saldoStop>0) { ;Сальдо дебетовое
 		 s full=$J(..debitStop,"",2)
 			w " в пользу ",..weName," составляет <span style='white-space:nowrap'>",full," ",cut,".</span>"
	 		w " (", ##class(Utils.Propis).Write(full,.in,.dn),")"
   } else {
				w " отсутствует"
   }
   w "</div>" 
	 	
  &html<</td>
  <td colspan=9 style='mso-ignore:colspan'></td>
 </tr>
 <tr height=21 style='mso-height-source:userset;height:15.75pt'>
  <td height=21 colspan=16 style='height:15.75pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=6 class=xl42 width=461 style='width:346pt'><!-- От #(..weName))# -->&nbsp;</td>
  <td></td>
  <td colspan=7 class=xl42 width=480 style='width:361pt'></td>
  <td></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=16 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td colspan=6 class=xl42 width=461 style='width:346pt'>________________</td>
  <td></td>
  <td colspan=7 class=xl42 width=480 style='width:361pt'>________________</td>
  <td></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=16 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='mso-height-source:userset;height:11.85pt'>
  <td height=15 style='height:11.85pt'></td>
  <td class=xl36>&nbsp;</td>
  <td class=xl36>&nbsp;</td>
  <td colspan=4 width=213 style='width:160pt'> <u>(#(..theyBoss)#)</u></td>
  <td class=xl37></td>
  <td class=xl36>&nbsp;</td>
  <td class=xl36>&nbsp;</td>
  <td class=xl36>&nbsp;</td>
  <td colspan=4 class=xl38> <u>(#(..weBoss)#)</u></td>
  <td></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 colspan=16 style='height:11.25pt;mso-ignore:colspan'></td>
 </tr>
 <tr height=15 style='height:11.25pt'>
  <td height=15 style='height:11.25pt'></td>
  <td class=xl38>М.П.</td>
  <td class=xl38></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
  <td class=xl38 colspan=2 style='mso-ignore:colspan'>М.П.</td>
  <td class=xl38></td>
  <td colspan=5 style='mso-ignore:colspan'></td>
 </tr>
</table></body></html>>

 Q ""
]]></Implementation>
</Method>

<Method name="outputCss">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 &html<<!--[if !mso]><style>
 v\:* {behavior:url(#default#VML);}
 o\:* {behavior:url(#default#VML);}
 x\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style><![endif]-->
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:LastAuthor>Учетно-информационная система "Склад"</o:LastAuthor>
  <o:Revision>1</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:LastPrinted>2011-01-01T00:00:00Z</o:LastPrinted>
  <o:Created>2011-08-01T10:59:29Z</o:Created>
  <o:LastSaved>2011-08-15T18:07:22Z</o:LastSaved>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<style>
<!--table
	{mso-displayed-decimal-separator:"\,";
	mso-displayed-thousand-separator:" ";}
@page
	{margin:.98in .79in .98in .79in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
td
	{mso-style-parent:style0;
	padding:0px;
	mso-ignore:padding;
	color:windowtext;
	font-size:8.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Arial, sans-serif;
	mso-font-charset:0;
	mso-number-format:General;
	text-align:left;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;
	}
.xl18
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:600;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	text-align:center;
	padding: 0pt 4pt;
	vertical-align:middle;
	border:.5pt solid windowtext;}
.xl19
	{mso-style-parent:style0;
	font-weight:700;
	font-family:Arial, sans-serif;
	mso-font-charset:204;}
.xl20
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:600;
	font-family:"MS Shell Dlg";
	padding: 0pt 4pt;
	vertical-align:middle;
	mso-generic-font-family:auto;
	mso-font-charset:204;
	border:.5pt solid windowtext;
	}
.xl24
	{mso-style-parent:style0;
	font-weight:700;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	text-align:right;
	vertical-align:middle;
	border:.5pt solid windowtext;
	}
.xl35
	{mso-style-parent:style0;
	font-weight:700;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	vertical-align:middle;
	border:.5pt solid windowtext;
}
.xl36
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	border-top:none;
	border-right:none;
	border-bottom:.5pt solid windowtext;
	border-left:none;}
.xl37
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	border:none;}
.xl38
	{mso-style-parent:style0;
	font-family:Arial, sans-serif;
	mso-font-charset:204;}
.xl40
	{mso-style-parent:style0;
	font-size:14.0pt;
	font-weight:700;
	font-family:Tahoma, sans-serif;
	mso-font-charset:204;
	text-align:center;
	vertical-align:middle;}
.xl41
	{mso-style-parent:style0;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	white-space:normal;}
.xl42
	{mso-style-parent:style0;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	white-space:normal;}
.xl43
	{mso-style-parent:style0;
	font-weight:700;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	mso-number-format:"\#\,\#\#0\.00\;\[Red\]\\-\#\,\#\#0\.00";
	text-align:right;
	vertical-align:middle;
	border:.5pt solid windowtext;}
.xl46
	{mso-style-parent:style0;
	font-size:10.0pt;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:center;
	white-space:normal;}
.xl47
	{mso-style-parent:style0;
	font-size:10.0pt;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	text-align:justify;
	white-space:normal;}
.xl48
	{mso-style-parent:style0;
	font-size:10.0pt;
	font-family:Arial, sans-serif;
	mso-font-charset:204;
	vertical-align:top;
	border-top:.5pt solid windowtext;
	border-right:.5pt solid windowtext;
	border-bottom:none;
	border-left:.5pt solid windowtext;
	white-space:normal;
	padding:0pt 4pt;
	}
.xl49
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:normal;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	text-align:left;
	padding:0pt 4pt;
	vertical-align:middle;
	border:.5pt solid windowtext;
}
.xl50
	{mso-style-parent:style0;
	font-size:9.0pt;
	font-weight:normal;
	font-family:"MS Shell Dlg";
	mso-generic-font-family:auto;
	mso-font-charset:204;
	text-align:right;
	padding:0pt 4pt;
	vertical-align:middle;
	border:.5pt solid windowtext;
}
-->
</style>
<!--[if gte mso 9]><xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
    <x:Name>TDSheet</x:Name>
    <x:WorksheetOptions>
     <x:DefaultRowHeight>225</x:DefaultRowHeight>
     <x:NoSummaryRowsBelowDetail/>
     <x:NoSummaryColumnsRightDetail/>
     <x:DisplayPageBreak/>
     <x:NoSummaryRowsBelowDetail/>
     <x:NoSummaryColumnsRightDetail/>
     <x:DisplayPageBreak/>
     <x:Selected/>
     <x:Panes>
      <x:Pane>
       <x:Number>3</x:Number>
       <x:ActiveRow>1</x:ActiveRow>
       <x:ActiveCol>1</x:ActiveCol>
       <x:RangeSelection>$B$2:$O$2</x:RangeSelection>
      </x:Pane>
     </x:Panes>
     <x:ProtectContents>False</x:ProtectContents>
     <x:ProtectObjects>False</x:ProtectObjects>
     <x:ProtectScenarios>False</x:ProtectScenarios>
    </x:WorksheetOptions>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
  <x:WindowHeight>5895</x:WindowHeight>
  <x:WindowWidth>11400</x:WindowWidth>
  <x:WindowTopX>0</x:WindowTopX>
  <x:WindowTopY>0</x:WindowTopY>
  <x:TabRatio>0</x:TabRatio>
  <x:RefModeR1C1/>
  <x:ProtectStructure>False</x:ProtectStructure>
  <x:ProtectWindows>False</x:ProtectWindows>
 </x:ExcelWorkbook>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2049"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
  >
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Переопределяем вывод страницы</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
 s start=%request.Get("dat1"), start=$S(start="":"",1:$ZDH(start,4))
 s stop=%request.Get("dat2"), stop=$S(stop="":"",1:$ZDH(stop,4))
 s we=$g(%request.Data("OurCompany",1)), they = $g(%request.Data("kontr",1))
 s act=##class(Reports.ActSverki).%New(we,they,start,stop)	
 d act.Prepare()
 d act.Output()
 Quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="Reports.Analyzis">
<Description>
Аналитика</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>60385,46549.566228</TimeCreated>

<Method name="prihrash">
<Description>
показать приход расход за период
dat - начальная и конечная даты 
depot1 - с какого склада искать документы
kontr -  id контрагента </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dat,depot1="",kontr=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="prihrashErr"
 s dat1=$P(dat,"@",1)
 s dat2=$P(dat,"@",2)
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 //s kontr=$P(third,"@",1)
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",40)
	 $$$WriteHeader("TypDoc","Документ",120)
	 $$$WriteHeader("DocName","№ Документа",80)
	 $$$WriteHeader("Kontr","Контрагент",80)
	 $$$WriteHeader("region","Регион",80)
	 $$$WriteHeader("DocDate","Дата",85)
	 $$$WriteHeader("DocTime","Время",70)
	 $$$WriteHeader("prih","Приход",65)
	 $$$WriteHeader("rash","Расход",65)
	 $$$WriteHeader("depot","Склад",80)
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 &sql(DECLARE C1 CURSOR FOR
    SELECT ID,Kontr->Name,Kontr,Dat,Name,Tim,DocumentClass,DocumentClass->Name,Summa,Depot,Kontr->region2->Name
    INTO :ID,:Kontr,KontrID,:DocDate,:DocName,:DocTime,:TypDoc,:TypDocName,:Summa,:depot,:region
    FROM Docs.Super
    where Dat>=:dat1 and Dat<=:dat2
 )
 &sql(OPEN C1)
 
 &sql(FETCH C1)
 While (SQLCODE = 0) {
  i (depot1'=depot)&(depot1'="") &sql(FETCH C1) CONTINUE
  i (KontrID'=kontr)&(kontr'="") &sql(FETCH C1) CONTINUE
  i (TypDoc="Docs.Prih")||(TypDoc="Docs.Rash") {
  i $I(i)
  if '$D(temp(depot)) {
  	s obj=##class(Store.Depot).%OpenId(depot)
  	i $ISOBJECT(obj) s temp(depot)=obj.Name
  	e  s temp(depot)=""
  }
  s sc=xmlstr.Element("OneObject")
  s sc=xmlstr.WriteAttribute("id",ID_"@"_TypDoc)
  i TypDoc="Docs.Prih" s direct="prih"
  i TypDoc="Docs.Rash" s direct="rash"
  s DocTime=$S(DocTime="":"",1:$ZT(DocTime))
  s DocDate=$S(DocDate="":"",1:$ZD(DocDate,4))
  s summ=$J(Summa,".",2)
  // вместо суммы документа подставлю cумму собранную из строк товара
  s ok=##class(Docs.Action).GetSummByPrice(TypDoc,ID,.mummy)
  i '+ok s summ=ok
  e  s summ=$J(+$G(mummy),".",2)
  $$$WriteElementTwice("number",i)
  $$$WriteElementTwice("TypDoc",TypDocName)
  $$$WriteElementTwice("DocName",DocName)
  $$$WriteElementTwice("DocTime",DocTime)
  $$$WriteElementTwice("DocDate",DocDate)
  $$$WriteElementTwice(direct,summ)
  $$$WriteElementTwice("depot",temp(depot))
  $$$WriteElementTwice("Kontr",Kontr)
  $$$WriteElementTwice("region",region)
  s itog(direct)=$G(itog(direct))+summ
  s sc=xmlstr.EndElement()
  &sql(FETCH C1)
  }
  else{&sql(FETCH C1)}
 }
 &sql(CLOSE C1)
 
 s sc=xmlstr.Element("OneObject")
 $$$WriteElementTwice("TypDoc","Итого")
 f i="prih","rash" d
 . $$$WriteElementTwice(i,$G(itog(i)))
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
prihrashErr
 $$$WriteError($ZE)
 q "Ошибка при формировании отчёта"
]]></Implementation>
</Method>

<Method name="KontrsJobs">
<Description>
Заполнить listview работами контрагента</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Kontr,dat1,dat2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="KontrsJobsErr"
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))

 $$$StartXML
 	s sc=xmlstr.Element("AllHeaders")
		 $$$WriteHeader("number","№ заявки",80)
		 $$$WriteHeader("dat","Дата заявки",85)
		 $$$WriteHeader("otchet","Отчёт",85)
		 $$$WriteHeader("otchetdat","Дата отчёта",85)
		 $$$WriteHeader("oplata","Оплата",85)
		 $$$WriteHeader("zapch","Запчасти",100)
 	s sc=xmlstr.EndElement()
  	s sc=xmlstr.Element("AllObjects")
  	 &sql(declare zzz cursor for select 
  		Dat,ID,Otchet->Name,Otchet->Dat,Name into :Dat,:ID,:Otchet,:OtchetDat,:Name
  		from Docs.Remont
  		where Dat>=:dat1 and Dat<=:dat2 and Kontr=:Kontr)
  	 &sql(OPEN zzz)
  	 &sql(FETCH zzz)
  	While (SQLCODE = 0) {
	i $I(i)
	s Data=$ZD(Dat,4)
	s:OtchetDat'="" OtchetDat=$ZD(OtchetDat,4)
	s sc=xmlstr.Element("OneObject")
	s sc=xmlstr.WriteAttribute("id",ID)
	$$$WriteElementTwice("number",Name)
	$$$WriteElementTwice("dat",Data)
	$$$WriteElementTwice("otchet",Otchet)
	$$$WriteElementTwice("otchetdat",OtchetDat)
	s sc=xmlstr.EndElement()
  	&sql(FETCH zzz)
  	}
  	&sql(CLOSE zzz)
  	s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
KontrsJobsErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="GoodsOnKontr">
<ClassMethod>1</ClassMethod>
<FormalSpec>kontr,q,w</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GoodsOnKontrErr"
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
 s sc=xmlstr.WriteAttribute("addcols","true")
		 $$$WriteHeader("kol","Количество",85)
 s sc=xmlstr.EndElement()
 s types=1
 s goodshead=##class(Common.Common).showheaders("Goods.Goods","","","","",.types)
 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(^t(kontr,i)) q:i=""  d
 . s kol=$G(^t(kontr,i))
 . q:'+$G(kol)
 . s sc=xmlstr.Element("OneObject")
 . s sc=xmlstr.WriteAttribute("id",i)
 . $$$WriteElementTwice("kol",kol)
 . d ..showxmlobj(i_"@Goods.Goods",.types,.xmlstr)
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
GoodsOnKontrErr
 $$$WriteError($ZE)
 q $ZE
]]></Implementation>
</Method>

<Method name="showxmlobj">
<ClassMethod>1</ClassMethod>
<FormalSpec>item,properties,xmlstr</FormalSpec>
<Implementation><![CDATA[
	s class=$P(item,"@",2)
	s id=$P(item,"@",1)
	s obj=$ZOBJCLASSMETHOD(class,"%OpenId",id)
	i '+$ISOBJECT(obj) $$$WriteError("showxmlobj не удалось открыть объект "_id_" класса "_class) q "Извините, внутренняя ошибка программы."
	s i="" f  s i=$O(properties(i)) q:i=""  d
	. q:i="Images"
	. s val=$ZOBJPROPERTY(obj,i)
	. i $ISOBJECT(val) s val=val.Name
	. $$$WriteElementTwice(i,val)
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//Остаток по ячейкам

]]></Content>
</UDLText>

<Method name="ostatok">
<ClassMethod>1</ClassMethod>
<FormalSpec>addr,p1,param</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 s $ZT="ostatokErr"
 s currentpage=$G(param("currentpage"),1)		//текущая страница в списке страниц таблицы (на стороне пользователя)
 s stroknastr=$G(param("stroknastr"),100)		//сколько выводить строк на странице
 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr
 s user=$G(%session.Data("user"),"anonim")
 s addressdelim=$G(%session.Data("addressdelim")," - ")
 s glob=$NA(^mtempQuant(user))
 k @glob
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("number","№",40)
  $$$WriteHeader("addr","Ячейка",200)
  $$$WriteHeader("tov","Товар",200)
  $$$WriteHeader("kol1","Количество",100)
  $$$WriteHeader("kol2","Зарезервировано",100)
  $$$WriteHeader("percwieght","% по массе",80)
  $$$WriteHeader("percsize","% по объему",80)
 s sc=xmlstr.EndElement()
 s sc=xmlstr.Element("AllObjects")
 i addr'="" d
 . s cell=##class(Store.Address).%OpenId(addr)
 . i '$ISOBJECT(cell) d  q
 . . $$$WriteError("ostatok не открылся объект ("_addr_") класса Store.Address")
 . . s sc=xmlstr.EndElement()
 . . $$$EndXML
 . s parcode=cell.Code
 . s depot=cell.Depot.%Id()
 . s where = " and Code %STARTSWITH '"_parcode_"' and Depot="_depot
 e  s parcode=" ",mainname="."
 k cell

 s rs=##class(%ResultSet).%New()
 if +to>0 s top=" top "_to
 s sql="select"_$G(top)_" a.ID,a.Code,a.Name,a.Currentweight,a.Weight,a.Currentsize,a.Size1,"
 s sql=sql_"b.Value1 ,b.Value2,b.Goods->FullName as GoodsName,b.Goods "
 s sql=sql_"from Store.Address a,Store.Quantity b "
 s sql=sql_"where a.ID=b.Address "_$G(where)
 s strcount=##class(Common.Common).Count("Store.Address a,Store.Quantity b","a.ID=b.Address "_$G(where))
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q 0
 while rs.Next(){
 s Currentweight=$G(rs.Data("Currentweight"))
 s Weight=$G(rs.Data("Weight"))
 s Currentsize=$G(rs.Data("Currentsize"))
 s Size1=$G(rs.Data("Size1"))
 i +Weight>0 s percwieght=$J(100*(Currentweight/Weight),".",2)_" %"
 e  s percwieght=""
 i +Size1>0 s percsize=$J(100*(Currentsize/Size1),".",2)_" %"
 e  s percsize=""
 i $i(count)
 s id=$G(rs.Data("ID"))
 s @glob@(count,"Code")=$G(rs.Data("Code"))
 s @glob@(count,"Name")=$G(rs.Data("Name"))
 s @glob@(count,"id")=id
 s @glob@(count,"percwieght")=percwieght
 s @glob@(count,"percsize")=percsize
 s @glob@(count,"Value1")=$G(rs.Data("Value1"))
 s @glob@(count,"Value2")=$G(rs.Data("Value2"))
 s @glob@(count,"GoodsName")=$G(rs.Data("GoodsName"))
 s @glob@(count,"Goods")=$G(rs.Data("Goods"))
 s @glob@(count,"CellName")=##class(Store.Action).AddressPath(id)
 }

 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s id=@glob@(i,"id")
 . s percwieght= @glob@(i,"percwieght")
 . s percsize=@glob@(i,"percsize")
 . q:(i<from)&(+currentpage)	//пропускаем строки не попадающие в текущую страницу
 . s sc=xmlstr.Element("OneObject")
 . s Value1=@glob@(i,"Value1")
 . s Value2=@glob@(i,"Value2")
 . s tov=@glob@(i,"GoodsName")
 . s GoodsId=@glob@(i,"Goods")
 . s Name=@glob@(i,"CellName")
 . s sc=xmlstr.WriteAttribute("id",GoodsId)
 . $$$WriteElementTwice("number",$TR($J(i,3)," ",0))
 . $$$WriteElementTwice("addr",Name)
 . $$$WriteElementTwice("tov",tov)
 . $$$WriteElementTwice("kol1",$J(Value1,".",2))
 . $$$WriteElementTwice("kol2",$J(Value2,".",2))
 . $$$WriteElementTwice("percwieght",percwieght)
 . $$$WriteElementTwice("percsize",percsize)
 . s sc=xmlstr.EndElement()

 s sc=xmlstr.EndElement() 
 $$$WriteElementTwice("strcount",strcount)
 $$$EndXML
 k @glob
 q 1
ostatokErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//Показать документы по товарам с указанными параметрами

]]></Content>
</UDLText>

<Method name="docsbytovs">
<ClassMethod>1</ClassMethod>
<FormalSpec>dates,where,p1</FormalSpec>
<Implementation><![CDATA[
 s $ZT="docsbytovsErr"
 s dat1=$P(dates,"@",1)
 s dat2=$P(dates,"@",2)
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 
 s rs=##class(%ResultSet).%New()
 s AdditionalFields=""
 s DocsItemsClass = p1
 if (p1 = "undefined")||(p1="") s DocsItemsClass = "Docs.DocItems"
 if p1 = "Brak" 
 {
	 s DocsItemsClass = "Docs.StorageInItems, Docs.StorageIn"
	 s where = where_"and Docs.StorageIn.PrihodType = 1 and Docs.StorageIn.ID = Docs.StorageInItems.doc"
	 s AdditionalFields=", quantreal"
 }
 
 
 s sql="select doc as docid,doc->Kontr->Name as kontrname,doc->Dat as docdat,doc->Name as docnum,doc->Tim as doctim,doc->DocumentClass as docclass,doc->DocumentClass->Name as docclassname,doc->Summa as docsumm,Goods->FullName as Goodsfullname"
 	_AdditionalFields
 	_" from "_DocsItemsClass
 	_" where doc->Dat>="_dat1_" and doc->Dat<="_dat2_" and "_where
 	_" group by doc"
 //,doc->Depot as docdepot,doc->Depot->Name as depotname
 
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q 0
 
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",40)
	 $$$WriteHeader("TypDoc","Документ",150)
	 $$$WriteHeader("DocName","№ Документа",120)
	 $$$WriteHeader("Kontr","Контрагент",150)
	 $$$WriteHeader("DocDate","Дата",90)
	 $$$WriteHeader("DocTime","Время",90)
	 $$$WriteHeader("Goods","Товар",90)
	 $$$WriteHeader("summa","Сумма",80)
	 if p1="Brak" $$$WriteHeader("Quantity","Количество",80)
	 //$$$WriteHeader("depot","Склад",80)
 s sc=xmlstr.EndElement()
 
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q 0

 s sc=xmlstr.Element("AllObjects")
 While rs.Next() {
 i $I(i)
 s docd="",doct=""
 s sc=xmlstr.Element("OneObject")
 s sc=xmlstr.WriteAttribute("id",rs.Data("docid")_"@"_rs.Data("docclass"))
 $$$WriteElementTwice("number",i)
 $$$WriteElementTwice("TypDoc",$G(rs.Data("docclassname")))
 $$$WriteElementTwice("DocName",$G(rs.Data("docnum")))
 $$$WriteElementTwice("Kontr",$G(rs.Data("kontrname")))
 i $G(rs.Data("docdat"))'="" s docd=$ZD(rs.Data("docdat"),4)
 i $G(rs.Data("doctim"))'="" s doct=$ZT(rs.Data("doctim"))
 
 $$$WriteElementTwice("DocDate",docd)
 $$$WriteElementTwice("DocTime",doct)
 $$$WriteElementTwice("summa",$G(rs.Data("docsumm")))
 $$$WriteElementTwice("Goods",$G(rs.Data("Goodsfullname")))
 if p1="Brak" $$$WriteElementTwice("Quantity",$G(rs.Data("quantreal")))
 
 //$$$WriteElementTwice("depot",$G(rs.Data("depotname")))
 
 s sc=xmlstr.EndElement()
  }
 s sc=xmlstr.EndElement()
 
 $$$EndXML
 q 1
docsbytovsErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="nullost">
<ClassMethod>1</ClassMethod>
<FormalSpec>dat="",p1,p2</FormalSpec>
<Implementation><![CDATA[
 s $ZT="nullostErr"
 s dat1=$S(dat="":+$H,1:$ZDH(dat,4))
 s perd=$G(%session.Data("period"))
 s data2=+$H
 s data1=data2-perd
 s usr=$G(%session.Data("user"),"undef")
 s tempglob=$NA(^mtempReport(usr))
 k @tempglob
 //выберем курсором все записи из товарных строк расходных накладных
 //за период указанный в настройках
 //просуммируем по каждому товару количество и сумму
 &sql(declare dfg cursor for
 select Quantity,Price,Total,Goods
 into :Quantity,:Price,:Total,:Goods 
 from Docs.RashItems
 where Doc->Dat>=:data1 and Doc->Dat<=:data2)
 &sql(open dfg)
 f  &sql(fetch dfg) q:SQLCODE  d
 . s @tempglob@(Goods,"Quantity")=+$G(tempglob(Goods,"Quantity"))+Quantity
 . s @tempglob@(Goods,"Total")=+$G(tempglob(Goods,"Total"))+Total
 &sql(close dfg)
 
 //добавить Property5300
 
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",40)
	 $$$WriteHeader("Property7053","Изделие",120)
	 $$$WriteHeader("Property3609","Модель",120)
	 $$$WriteHeader("name","Наименование",120)
	 $$$WriteHeader("Property5300","Номер по схеме",80)
	 $$$WriteHeader("Quantity","Общий расход",90)
	 $$$WriteHeader("d","Среднедневной расход",90)
	 $$$WriteHeader("Total","Сумма расхода",90)
	 $$$WriteHeader("curquant","Текущее количество",90)
	 $$$WriteHeader("prognoz","Прогноз обнуления (дн.)",90)
 s sc=xmlstr.EndElement()
 //пройдемся по получившемуся списку товаров
 //запишем каждому название и посчитаем среднедневной расход
 s i="" f  s i=$O(@tempglob@(i)) q:i=""  d
 . s quant=@tempglob@(i,"Quantity")
 . s d=quant/perd //это среднедневной расход товара за период который указан в общих настройках для прогноза обнуления
 . s curquant=##class(Goods.GoodsAction).getgoodquant(i,"")  //текущее количество
 . q:(d=0)	//если расход нулевой то тоже выходим из цикла	18,05,2011
 . q:(curquant/d)<(dat1-$H) //если обнулится меньше чем за указанный период то выходим из цикла
 . s tov=##class(Goods.Goods).%OpenId(i)
 . i $ISOBJECT(tov) d
 . . s name=tov.Name
 . . s Property7053=tov.Property7053
 . . s Property3609=tov.Property3609
 . . s Property5300=tov.Property5300
 . e  d
 . . s name="Товар с кодом "_i_" отсутствует с списке товаров"
 . . s (Property5300,Property3609,Property7053) = ""
 . s @tempglob@(i)=1
 . s @tempglob@(i,"name")=name
 . s @tempglob@(i,"Property7053")=Property7053
 . s @tempglob@(i,"Property3609")=Property3609
 . s @tempglob@(i,"Property5300")=Property5300
 . s @tempglob@(i,"prognoz")=$J(curquant/d,".",0)
 . s @tempglob@(i,"d")=$J(d,".",3)
 . s @tempglob@(i,"curquant")=curquant
 
 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@tempglob@(i)) q:i=""  d
 . q:'+$G(@tempglob@(i))
 . s sc=xmlstr.Element("OneObject")
 . s sc=xmlstr.WriteAttribute("id",i)
 . i $I(count)
 . $$$WriteElementTwice("number",count)
 . $$$WriteElementTwice("Property7053",@tempglob@(i,"Property7053"))
 . $$$WriteElementTwice("Property3609",@tempglob@(i,"Property3609"))
 . $$$WriteElementTwice("name",@tempglob@(i,"name"))
 . $$$WriteElementTwice("Property5300",@tempglob@(i,"Property5300"))
 . $$$WriteElementTwice("Quantity",@tempglob@(i,"Quantity"))
 . $$$WriteElementTwice("d",@tempglob@(i,"d"))
 . $$$WriteElementTwice("Total",@tempglob@(i,"Total"))
 . $$$WriteElementTwice("curquant",@tempglob@(i,"curquant"))
 . $$$WriteElementTwice("prognoz",@tempglob@(i,"prognoz"))
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 $$$WriteComment("Период для расчета среднедневного расхода "_perd_" дн.")
 $$$EndXML
 q 1
nullostErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="docsbypars">
<ClassMethod>1</ClassMethod>
<FormalSpec>class="",params,data</FormalSpec>
<Implementation><![CDATA[
 s $ZT="docsbyparsErr"
 s dat1=$P(data,"@",1)
 s dat2=$P(data,"@",2)
 s dat1=$S(dat1="":0,1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 
 i class="" d  q 1
 . $$$StartXML
 . $$$WriteError("docsbypars class=""""") 
 . $$$WriteComment("Не указан класс документов для вывода. Отчет не может быть выполнен") 
 . $$$EndXML

 s types=1
 s waste=##class(Common.Common).showheaders(class,"","","","",.types)
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("number","№",40)
 s i="" f  s i=$O(types(i)) q:i=""  d
 . $$$WriteHeader(i,$G(types(i,"descr"),i),100)
 s sc=xmlstr.EndElement()
 
 s rs=##class(%ResultSet).%New()
 s i="" f  s i=$O(types(i)) q:i=""  d
 . s fld=i
 . if fld="Goods" s fld="Goods->FullName as Goods"
 . else  if types(i)'["%" s fld=i_"->Name as "_i
 . s fields=$G(fields)_","_fld
 //s fields=$E(fields,1,$L(fields)-1)
 s sql="select id"_$G(fields)_" from "_class_" where "_params_" and Dat>="_dat1_" and Dat<="_dat2
 
 s ok=rs.Prepare(sql)
 i '+ok d  q 1
 . $$$WriteObjError(ok) 
 . $$$WriteComment("Извините, внутренняя ошибка при формировании отчета, попробуйте изменить параметры.") 
 . $$$EndXML
 s ok=rs.Execute()
 i '+ok d  q 1
 . $$$WriteObjError(ok) 
 . $$$WriteComment("Извините, внутренняя ошибка при формировании отчета, попробуйте изменить параметры.") 
 . $$$EndXML
  
 s sc=xmlstr.Element("AllObjects")
 While rs.Next() {
 i $I(count)
 s sc=xmlstr.Element("OneObject")
 $$$WriteElementTwice("number",count)
 s i="" f  s i=$O(types(i)) q:i=""  d
 . s txt=$G(rs.Data(i))
 . i (types(i)="%Date")&(txt'="") s txt=$ZD(txt,4)
 . i (types(i)="%Time")&(txt'="") s txt=$ZT(txt)
 . i i="Summa" s txt=$J(txt,".",2),tot=$G(tot)+$J(txt,".",2)
 . $$$WriteElementTwice(i,txt)
 s sc=xmlstr.EndElement()
 }
 s sc=xmlstr.Element("OneObject")
 $$$WriteElementTwice("Summa",$G(tot))
 s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 $$$EndXML
 
 q 1
docsbyparsErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="GetGoodsFromGroup">
<Description><![CDATA[
Получить список товаров по id группы
<var>GroupCode</var> - код товарной группы
<var>CatalogueID</var> - ID каталога
<var>Global</var> - ссылка на глобал куда скидывать результаты]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GroupCode="",CatalogueID="",Global=""</FormalSpec>
<Implementation><![CDATA[
 s err="Извините, ошибка при выборке товаров группы"
 i GroupCode="" q err
 i CatalogueID="" q err
 i Global="" s Global=$NA(^mtempReport("GetGoodsFromGroup",$I))
 k @Global
 s $ZT="GetGoodsFromGroupErr"
 &sql(declare qwer cursor for select goo.Goods,goo.Groups,goo.Goods->Name,goo.Goods->abbr,goo.Goods->Property3609,goo.Goods->codedetail,goo.Goods->Price,gru.Name,gru.Code,goo.Goods->izdelie->Name,goo.Goods->Images
 into :GoodsID,:GroupID,:GoodsName,:Goodsabbr,:GoodsModel,:codedetail,:GoodsPrice,:GroupName,:GroupCode,:izdelie,:Images
 from goods.goodsgroup goo,goods.group gru 
 where gru.Code %STARTSWITH :GroupCode and gru.Catalogue=:CatalogueID and goo.Groups=gru.ID)
 &sql(open qwer)
 f  &sql(fetch qwer) q:SQLCODE  d
 . s @Global@(GroupCode,"Goods",GoodsID,"GroupID")=GroupID
 . s @Global@(GroupCode,"Goods",GoodsID,"GoodsName")=GoodsName
 . s @Global@(GroupCode,"Goods",GoodsID,"Goodsabbr")=Goodsabbr
 . s @Global@(GroupCode,"Goods",GoodsID,"GoodsModel")=GoodsModel
 . s @Global@(GroupCode,"Goods",GoodsID,"GoodsShemNumber")=codedetail
 . s @Global@(GroupCode,"Goods",GoodsID,"GoodsPrice")=GoodsPrice
 . s @Global@(GroupCode,"Goods",GoodsID,"Goodsizdelie")=izdelie
 . s @Global@(GroupCode,"Goods",GoodsID,"Images")=Images
 . s @Global@(GroupCode,"GroupName")=GroupName
 &sql(close qwer)
 q 1
GetGoodsFromGroupErr
 $$$WriteError($ZE)
 q "Извините, ошибка при выборке товаров группы"
]]></Implementation>
</Method>

<Method name="Zapchasti">
<Description><![CDATA[
Выводит отчёт Отправленные запчасти за период
<br><var>Dates</var> дд/мм/гггг@дд/мм/гггг начало и конец периода для вывода
<br><var>GroupModels</var> не используются
<br><var>GroupName</var> не используются]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates,GroupModels,GroupName</FormalSpec>
<Implementation><![CDATA[

 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("opl","Оплата",100)
  $$$WriteHeader("date","Дата",80)
  $$$WriteHeader("kontr","Контрагент",180)
  $$$WriteHeader("sent","Способ отправки",120)
  $$$WriteHeader("abbr","Аббревиатура",80)
  $$$WriteHeader("Stoimost","Стоимость",80)
  $$$WriteHeader("Cena","Цена",80)
  
 s sc=xmlstr.EndElement()
 
 s glob=$NA(^mtempReport("Zapchasti",$I))
 k @glob
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)
 s ModelsToGroup=GroupName
 f i=1:1:$L(GroupModels,",") d
 . s model=$P(GroupModels,",",i)
 . q:model=""
 . s ModelsToGroup(model)=""
 
 s ok=..SentZapchasti(Dat1,Dat2,glob,.ModelsToGroup)
 i '+ok d  q 1
 . $$$WriteElementTwice("comment",ok)
 . $$$EndXML
 
 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s Dat="" f  s Dat=$O(@glob@(i,Dat)) q:Dat=""  d
 . . s Kontr="" f  s Kontr=$O(@glob@(i,Dat,Kontr)) q:Kontr=""  d
 . . . s Abbr="" f  s Abbr=$O(@glob@(i,Dat,Kontr,Abbr)) q:Abbr=""  d
 . . . . s Cena=$G(@glob@(i,Dat,Kontr,Abbr,"Cena"))
 . . . . s Stoimost=$G(@glob@(i,Dat,Kontr,Abbr,"Stoimost"))
 . . . . s sc=xmlstr.Element("OneObject")
 . . . .     $$$WriteElementTwice("opl",i)
 . . . .	 $$$WriteElementTwice("date",$ZD(Dat,4))
 . . . .	 $$$WriteElementTwice("kontr",Kontr)
 . . . .	 $$$WriteElementTwice("abbr",Abbr)
 . . . .	 $$$WriteElementTwice("Cena",Cena)
 . . . .	 $$$WriteElementTwice("Stoimost",Stoimost)
 . . . . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 $$$EndXML  
  
 q 1
]]></Implementation>
</Method>

<Method name="SentZapchasti">
<Description><![CDATA[
Отправленные запчасти
<br><var>Dat1</var> - Начальная дата периода (HOROLOG)
<br><var>Dat2</var> - Конечная дата периода (HOROLOG)
<br><var>glob</var> - ссылка на глобаль наполняемую результатами
<br><var>ModelsToGroup</var> - группировать модели]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dat1="",Dat2="",glob="",ModelsToGroup=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SentZapchastiErr"
 s:glob="" glob=$NA(^mtempReport("SentZapchasti",$I))
 s:Dat1="" Dat1=+$H
 s:Dat2="" Dat2=+$H
 
 &sql(declare dfg32 cursor for Select ID,Name into :ID,:Name from Common.Dictionary7)
 &sql(open dfg32)
 f  &sql(fetch dfg32) q:SQLCODE  d
 . s OplatNames(ID)=Name
 &sql(close dfg32)
 &sql(declare dfg33 cursor for
 select Doc,Doc->Dat,Doc->Kontr->Name,Quantity,Price,Goods->abbr,Goods->Price
 into :Doc,:Dat,:Kontr,:Quant,:Price,:Abbr,:Goodsprice
 from Docs.RashItems
 where Doc->Dat>=:Dat1 and Doc->Dat<=:Dat2)
 &sql(open dfg33)
 f  &sql(fetch dfg33) q:SQLCODE  d
 . s:Abbr="" Abbr="Не указано"
 . i $D(ModelsToGroup(Abbr)) s Abbr=ModelsToGroup  //если модель содержится в списке замены то заменяем
 . s:Abbr="" Abbr="Не указано"
 . s RashString=$G(^Docs.SuperD(Doc,"Rash")),opl=""
 . s:RashString'="" opl=$LIST(RashString,$$$RashOpl)
 . i opl="" s opl="Не указано"
 . e  s opl=$G(OplatNames(opl))
 . i opl="" s opl="Не указано"
 . s Stoimost=Quant*Price
 . s Cena=Quant*Goodsprice
 . s @glob@(opl,Dat,Kontr,Abbr,"Cena")=$G(@glob@(opl,Dat,Kontr,Abbr,"Cena"))+Cena
 . s @glob@(opl,Dat,Kontr,Abbr,"Stoimost")=$G(@glob@(opl,Dat,Kontr,Abbr,"Stoimost"))+Stoimost
 &sql(close dfg33)
 q 1
SentZapchastiErr
 $$$WriteError($ZE)
 q "Извините, ошибка при формировании списка."
]]></Implementation>
</Method>

<Method name="OtpravkaKontragentu">
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates="",Goods="",Kontr=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="OtpravkaKontragentuErr"
 s glob=$NA(^mtempReport("Zapchasti",$I))
 k @glob
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)
 s $E(Goods)=""

 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("doc","Документ",100)
  $$$WriteHeader("date","Дата",80)
  $$$WriteHeader("oplata","Оплата",180)
  $$$WriteHeader("tovar","Товар",180)
  $$$WriteHeader("qnt","Количество",120)
  $$$WriteHeader("summa","Сумма",80)
  if Kontr="" $$$WriteHeader("Kontrname","Контрагент",80)
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 s SqlQuery="select doc->Name as docname,doc->Dat as doctat,Goods->FullName as goodsname,Quantity,Total "
 s:Kontr="" SqlQuery=SqlQuery_", doc->Kontr->Name as Kontrname "
 s SqlQuery=SqlQuery_"from Docs.StorageOutItems"
 s SqlQuery=SqlQuery_" where doc->Source->Dat>="_Dat1_" and doc->Source->Dat<="_Dat2
 s:Kontr'="" SqlQuery=SqlQuery_" and doc->Source->Kontr="_Kontr
 s SqlQuery=SqlQuery_" and doc->Stat=2"
 if Goods'="" s SqlQuery=SqlQuery_" and Goods in ("_Goods_") "
 
 s ^mtempArt("OtpravkaKontragentu")=SqlQuery
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(SqlQuery) i '+ok $$$WriteObjError(ok) q "Ошибка"
 s ok=rs.Execute() i '+ok $$$WriteObjError(ok) q "Ошибка"
 while rs.Next() {
	s sc=xmlstr.Element("OneObject")
	 s docname=rs.Data("docname")
	 s doctat=rs.Data("doctat")
	 s goodsname=rs.Data("goodsname")
	 s Quantity=rs.Data("Quantity")
	 s Total=rs.Data("Total")

     $$$WriteElementTwice("doc",docname)
	 $$$WriteElementTwice("date",$ZD(doctat,4))
 	 $$$WriteElementTwice("oplata","")
 	 $$$WriteElementTwice("tovar",goodsname)
 	 $$$WriteElementTwice("qnt",Quantity)
 	 $$$WriteElementTwice("summa",Total)
 	 if Kontr="" $$$WriteElementTwice("Kontrname",rs.Data("Kontrname"))
 	s sc=xmlstr.EndElement()
 }
 s sc=xmlstr.EndElement()
 $$$EndXML  

 q 1
OtpravkaKontragentuErr
 $$$WriteError($ZE)
 q "Ошибка"
]]></Implementation>
</Method>

<Method name="ShowInactiveKontr">
<Description>
Отчёт о контрагентах которые не заказывают запчасти</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates:%String="",p1="",p2=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="ShowInactiveKontrErr"
 s glob=$NA(^mtempReport("ShowInactiveKontr",$I))
 k @glob
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("number","№ п/п",30)
  $$$WriteHeader("kontr","Клиент",150)
  $$$WriteHeader("city","Город",150)
  $$$WriteHeader("phone","Телефон",150)
  $$$WriteHeader("email","EMail",150)
  $$$WriteHeader("contpers","Конт. лицо",150)
  $$$WriteHeader("chief","Директор",150)
  $$$WriteHeader("lastinstr","Последний заказ",150)
  $$$WriteHeader("Result","Последний созвон",150)
 s sc=xmlstr.EndElement()

 &sql(declare Opers cursor for
 	select ID,Kontr
 	into :OperId,:KontrId
 	from Operation.Instructions
 	where Dat>=:Dat1 and Dat<=:Dat2)
 &sql(open Opers)
 f  &sql(fetch Opers) q:SQLCODE  d
 . q:KontrId=""
 . s @glob@("Exclude",KontrId)=""
 &sql(close Opers)

 &sql(declare Kontrs cursor for select ID,City,Phones,EMail,ContPers,Chief,Name into :KontrId,:City,:Phones,:EMail,:ContPers,:Chief,:KontrName from Common.Kontragent where Activity=1)
 &sql(open Kontrs)
 f  &sql(fetch Kontrs) q:SQLCODE  d
 . q:$D(@glob@("Exclude",KontrId))
 . &sql(select top 1 ID,Dat,Tim,Name,RashOplatType->Name,%external(State) into :OperId,:Dat,:Tim,:Name,:RashOplatTypeName,:State from Operation.Instructions where Kontr=:KontrId and Oper=10 order by Dat desc, Tim desc)
 . if SQLCODE s (OperId,Dat,Tim,Name,RashOplatTypeName,State)=""
 . if 'SQLCODE&Dat>Dat1 q		//пропустим тех кого нашли и дата его больше начальной даты заданной пользователем
 . s @glob@("Kontrs",KontrId)=""
 . s @glob@("Kontrs",KontrId,"Dat")=Dat
 . s @glob@("Kontrs",KontrId,"Tim")=Tim
 . s @glob@("Kontrs",KontrId,"Name")=Name
 . s @glob@("Kontrs",KontrId,"RashOplatTypeName")=RashOplatTypeName
 . s @glob@("Kontrs",KontrId,"State")=State
 . s @glob@("Kontrs",KontrId,"City")=City
 . s @glob@("Kontrs",KontrId,"Phones")=Phones
 . s @glob@("Kontrs",KontrId,"EMail")=EMail
 . s @glob@("Kontrs",KontrId,"ContPers")=ContPers
 . s @glob@("Kontrs",KontrId,"Chief")=Chief
 . s @glob@("Kontrs",KontrId,"KontrName")=KontrName
 . &sql(select top 1 Dat,Tim,Result into :MeetDat,:MeetTim,:Result from Kontragent.Meeting where Kontr=:KontrId Order By Dat desc, Tim desc)
 . d:'SQLCODE 
 . . if MeetDat s MeetDat=$ZD(MeetDat,4)
 . . s @glob@("Kontrs",KontrId,"Result")=MeetDat_" "_Result
 &sql(close Kontrs)

 s sc=xmlstr.Element("AllObjects")
 s KontrId="" 
 f  s KontrId=$O(@glob@("Kontrs",KontrId)) q:KontrId=""  d
 . s sc=xmlstr.Element("OneObject")
 . $$$WriteElementTwice("number",$i(count))
 . $$$WriteElementTwice("kontr",$G(@glob@("Kontrs",KontrId,"KontrName")))
 . $$$WriteElementTwice("city",$G(@glob@("Kontrs",KontrId,"City")))
 . $$$WriteElementTwice("phone",$G(@glob@("Kontrs",KontrId,"Phones")))
 . $$$WriteElementTwice("email",$G(@glob@("Kontrs",KontrId,"EMail")))
 . $$$WriteElementTwice("contpers",$G(@glob@("Kontrs",KontrId,"ContPers")))
 . $$$WriteElementTwice("chief",$G(@glob@("Kontrs",KontrId,"Chief")))
 . s Dat=$G(@glob@("Kontrs",KontrId,"Dat"))
 . if Dat s Dat=$ZD(Dat,4)
 . else  s Dat=""
 . s RashOplatTypeName=$G(@glob@("Kontrs",KontrId,"RashOplatTypeName"))
 . s Name=$G(@glob@("Kontrs",KontrId,"Name"))
 . if (Dat'="")||(RashOplatTypeName'="")||(Name'="") s lastinstr=Dat_" / "_RashOplatTypeName_" / "_Name
 . else  s lastinstr=""
 . $$$WriteElementTwice("lastinstr",lastinstr)
 . $$$WriteElementTwice("Result",$G(@glob@("Kontrs",KontrId,"Result")))
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 $$$EndXML  

 q 1
ShowInactiveKontrErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="NullOstatokForecastPrepare">
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates:%String="",RepTypeGoodsAbbr:%String="",param=""</FormalSpec>
<Implementation><![CDATA[
 s tempglob=$NA(^mtempReport(param_"@NullOstatokForecast"))
 j ##class(Reports.Analyzis).NullOstatokForecastMake(Dates, RepTypeGoodsAbbr, param, tempglob)
 q
]]></Implementation>
</Method>

<Method name="NullOstatokForecastLookUp">
<ClassMethod>1</ClassMethod>
<FormalSpec>param="",secondParam="@NullOstatokForecast"</FormalSpec>
<Implementation><![CDATA[
 s tempglob=$NA(^mtempReport(param_secondParam))
 q $G(@tempglob)
]]></Implementation>
</Method>

<Method name="NullOstatokForecastMake">
<Description>
Отчёт - прогноз обнуления остатков
Dates - даты для расчёта среднемесячного расхода
TermType - тип периода для расчёта среднемесячного расхода (зима, лето, год или указанные даты)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates:%String="",RepTypeGoodsAbbr:%String="",param,glob=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="NullOstatokForecastErr"
 k @glob
 s @glob="Запущен отчёт прогноз обнуления остатков"
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)
 s month=+$ZD(+$H,1)
 s year=+$ZD(+$H,3)
 s TermType=$P(RepTypeGoodsAbbr,"@",1)
 s GoodsAbbr=$P(RepTypeGoodsAbbr,"@",2)
 if TermType="winter" d
 . if (month=11)||(month=12) s year1=year,year2=year+1
 . else  s year1=year-1,year2=year
 . s Dat1=$ZDH("01/11/"_year1,4)
 . s Dat2=$ZDH("28/02/"_year2,4)
 if TermType="summer" d
 . if month<4 s year=-1
 . s Dat1=$ZDH("01/04/"_year,4)
 . s Dat2=$ZDH("30/09/"_year,4)
 if TermType="year" d
 . s Dat1=$ZDH("01/01/"_year,4)
 . s Dat2=+$H
 s MonthsDiff=+$ZD(Dat2,1)-$ZD(Dat1,1)	//разница в месяцах
 //если годы различаются
 if +$ZD(Dat1,3)'=+$ZD(Dat2,3) d
 . s MonthsDiff=(13-$ZD(Dat1,1))+$ZD(Dat2,1)
 
 &sql(select count(ID) into :DocsCount from Docs.StorageOut where Dat>=:Dat1 and Dat<=:Dat2)
 
 s i=""
 //идём по внутренним инструкциям и суммируем продажи всех товаров в диапазоне дат 
 //(шоп по каждому товару потом не бегать отдельно)
 //&sql(declare rep9doc cursor for select quantreal,Goods into :quantreal,:Goods from Docs.StorageOutItems where Doc->Dat>=:Dat1 and Doc->Dat<=:Dat2 and doc->stat=2)
 //нет! бежим по инструкциям руководителя и подсчитываем сколько чего было заказано
 &sql(declare rep9doc cursor for select Quantity,Goods into :quantreal,:Goods from Operation.InstructionsItems where Doc->Dat>=:Dat1 and Doc->Dat<=:Dat2)
 &sql(open rep9doc)
 f  &sql(fetch rep9doc) q:SQLCODE  d
 . s @glob@("Count",Goods)=$G(@glob@("Count",Goods))+quantreal
 . s @glob="Обработано "_$I(i)_" из "_DocsCount_" документов"
 &sql(close rep9doc)
 s i=""
 
 &sql(select count(ID) into :GoodsCount from Goods.Goods where (abbr %STARTSWITH :GoodsAbbr) OR (:GoodsAbbr is null))
 
 &sql(declare rep9 cursor for 
 	select ID,FullName,Property5300,codedetail
 	into :ID,:Name,:Property5300,:codedetail
 	from Goods.Goods 
 	where (abbr %STARTSWITH :GoodsAbbr) OR (:GoodsAbbr is null)
 	order by abbr,Property3609)
 &sql(open rep9)
 f  &sql(fetch rep9) q:SQLCODE  d
 . i $i(strcount)
 . s @glob="Обработано "_strcount_" из "_GoodsCount_" товаров"
 . s @glob@("Data",strcount,"Name")=Name
 . s @glob@("Data",strcount,"Property5300")=Property5300
 . s @glob@("Data",strcount,"codedetail")=codedetail
 . s (@glob@("Data",strcount,"quantreal"),TotalShipmentOut)=+$G(@glob@("Count",ID))
 . if '+TotalShipmentOut d  q
 . . s @glob@("Data",strcount,"MonQuant")="Движения нет, подсчёт невозможен"
 . . s @glob@("Data",strcount,"quantity")="Движения нет, подсчёт невозможен"
 . . s @glob@("Data",strcount,"NullDate")="Движения нет, подсчёт невозможен"
 . s @glob@("Data",strcount,"MonQuant")=$J(TotalShipmentOut/MonthsDiff,"",2)
 . s CommonQuantity=0
 . d ##class(Store.Action).GetQuantByGoods(ID,.CommonQuantity)
 . s @glob@("Data",strcount,"quantity")=CommonQuantity
 . s OutPerDay=TotalShipmentOut/(Dat2-Dat1)	//ежедневный расход
 . s DaysLeft=$FN(CommonQuantity/OutPerDay,"",0)	//осталось дней до полного обнуления
 . s @glob@("Data",strcount,"NullDate")=$ZD(Dat2+DaysLeft,4)
 &sql(close rep9)
 
 s @glob="stopПериод для расчёта среднемесячного расхода"_$C(13,10)_"с "_$ZD(Dat1,4)_" по "_$ZD(Dat2,4)_$C(13,10)_"Количество месяцев: "_MonthsDiff
 q 1
NullOstatokForecastErr
 $$$WriteError($ZE)
 s @glob="stopИзвините. Ошибка при формировании отчёта. Попробуйте запустить с другими параметрами."
 q 0
]]></Implementation>
</Method>

<Method name="NullOstatokForecastShow">
<ClassMethod>1</ClassMethod>
<FormalSpec>p1,p2,param</FormalSpec>
<Implementation><![CDATA[
 $$$StartXML
 s glob=$NA(^mtempReport(param_"@NullOstatokForecast"))

 s currentpage=$G(param("currentpage"),1)		//текущая страница в списке страниц таблицы (на стороне пользователя)
 s stroknastr=$G(param("stroknastr"),100)		//сколько выводить строк на странице
 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr
 
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("Name","Название запчасти",300)
  $$$WriteHeader("Property5300","Ном. по схеме",80)
  $$$WriteHeader("codedetail","Код детали",80)
  $$$WriteHeader("zakaz","Всего заказано",150)
  $$$WriteHeader("quantity","Текущее количество",150)
  $$$WriteHeader("MonQuant","Среднемесячный заказ",150)
  $$$WriteHeader("NullDate","Дата обнуления остатков",150)
 s sc=xmlstr.EndElement()

 s sc=xmlstr.Element("AllObjects")
 s i=from f  s i=$O(@glob@("Data",i)) q:(i=to)!(i="")  d
 . s sc=xmlstr.Element("OneObject")
 . $$$WriteElementTwice("Name",@glob@("Data",i,"Name"))
 . $$$WriteElementTwice("Property5300",@glob@("Data",i,"Property5300"))
 . $$$WriteElementTwice("codedetail",@glob@("Data",i,"codedetail"))
 . //$$$WriteElementTwice("quantreal",$G(@glob@("Data",i,"quantreal")))
 . $$$WriteElementTwice("zakaz",$G(@glob@("Data",i,"quantreal")))
 . $$$WriteElementTwice("quantity",$G(@glob@("Data",i,"quantity")))
 . $$$WriteElementTwice("MonQuant",$G(@glob@("Data",i,"MonQuant")))
 . $$$WriteElementTwice("NullDate",$G(@glob@("Data",i,"NullDate")))
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 
 s strcount=$O(@glob@("Data",""),-1)
 
 $$$WriteElementTwice("strcount",strcount)
 $$$EndXML
]]></Implementation>
</Method>

<Method name="SendTermControl">
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates:%String="",TermTypeAndTerm:%String="",param</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="SendTermControlErr"
 s glob=$NA(^mtempReport("SendTermControl",$I))
 k @glob
 s currentpage=$G(param("currentpage"),1)		//текущая страница в списке страниц таблицы (на стороне пользователя)
 s stroknastr=$G(param("stroknastr"),100)		//сколько выводить строк на странице
 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr
 s ShowAllInstructions=$S($P(param,"@")="true":1,1:0)	//если передали true, значит надо показывать все инструкции а неподходящие по сроку подсвечивать
 s TermType=$P(TermTypeAndTerm,"@",1)
 s Term=+$P(TermTypeAndTerm,"@",2)
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)

 &sql(declare rep10 cursor for 
 select instr,instr->Name,State,StateChangeD,instr->Dat,instr->Kontr->Name,instr->RashOplatType->Name,instr->dostavka->Name,instr->innerinstr->Name
 into :instr,:Name,:State,:StateChangeD,:Dat,:Kontr,:Opl,:dostavka,:InnerName
 from Operation.InstructionsHist 
 where Instr->Dat>=:Dat1 and Instr->Dat<=:Dat2 and Instr->Oper=10
 and (Instr->RashOplatType=:TermType OR :TermType is null))
 &sql(open rep10)
 f  &sql(fetch rep10) q:SQLCODE  d
 . s @glob@("Hist",instr,"Dat")=Dat
 . s @glob@("Hist",instr,"Kontr")=Kontr
 . s @glob@("Hist",instr,"Opl")=Opl
 . s @glob@("Hist",instr,"Name")=Name
 . s @glob@("Hist",instr,"Number")=InnerName
 . if $LF($LB(5,6,7,8,8.7,8.9),State) d
 . . s @glob@("Hist",instr,"end")=StateChangeD
 . . s @glob@("Hist",instr,"dostavka")=##class(Operation.Instructions).StateLogicalToDisplay(State)
 &sql(close rep10)
 s i="" f  s i=$O(@glob@("Hist",i)) q:i=""  d
 . s EndDat=$G(@glob@("Hist",i,"end"))
 . if (EndDat="")&(ShowAllInstructions) s @glob@("Hist",i,"color")=123,@glob@("Hist",i,"description")="Не отправлено"
 . if EndDat="" q
 . s @glob@("Hist",i,"description")="Отправлено в срок"
 . s Dat=$G(@glob@("Hist",i,"Dat"))
 . if (EndDat-Dat<Term)&('ShowAllInstructions) k @glob@("Hist",i) q
 . if (EndDat-Dat>=Term)&ShowAllInstructions s @glob@("Hist",i,"color")=255,@glob@("Hist",i,"description")="Отправлено с опозданием"
 . s @glob@("Hist",i,"Term")=(EndDat-Dat)
 . i $i(strcount)
 
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("Term","Срок выполнения",60)
  $$$WriteHeader("Dat","Дата инструкции",90)
  $$$WriteHeader("SendDat","Дата отправки",90)
  $$$WriteHeader("Kontr","Контрагент",150)
  $$$WriteHeader("Opl","Оплата",90)
  $$$WriteHeader("Number","Номер инструкции",80)
  $$$WriteHeader("Name","краткое описание",100)
  $$$WriteHeader("dostavka","способ отправки",100)
  if ShowAllInstructions $$$WriteHeader("description","Состояние отправки",150)
 s sc=xmlstr.EndElement()

 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@glob@("Hist",i)) q:i=""  d
 . i $i(count)
 . q:(count<from)&(+currentpage)
 . s sc=xmlstr.Element("OneObject")
 . s color=$G(@glob@("Hist",i,"color"),0) 
 . s sc=xmlstr.WriteAttribute("color",color)
 . s Term=$G(@glob@("Hist",i,"Term"))
 . s Dat=$G(@glob@("Hist",i,"Dat"))
 . s Dat=$ZD(Dat,4)
 . s SendDat=$G(@glob@("Hist",i,"end"))
 . if +SendDat s SendDat=$ZD(SendDat,4)
 . s Kontr=$G(@glob@("Hist",i,"Kontr"))
 . s Opl=$G(@glob@("Hist",i,"Opl"))
 . s Number=$G(@glob@("Hist",i,"Number"))
 . s Name=$G(@glob@("Hist",i,"Name"))
 . s dostavka=$G(@glob@("Hist",i,"dostavka"))
 . s description=$G(@glob@("Hist",i,"description"))
 . 	s sc=xmlstr.WriteAttribute("id",i)
 .  $$$WriteElementTwice("Term",Term)
 . 	$$$WriteElementTwice("Dat",Dat)
 . 	$$$WriteElementTwice("SendDat",SendDat)
 . 	$$$WriteElementTwice("Kontr",Kontr)
 . 	$$$WriteElementTwice("Opl",Opl)
 . 	$$$WriteElementTwice("Number",Number)
 . 	$$$WriteElementTwice("Name",Name)
 . 	$$$WriteElementTwice("dostavka",dostavka)
 .  if ShowAllInstructions $$$WriteElementTwice("description",description)
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 
 $$$WriteElementTwice("strcount",+$G(strcount))
 
 $$$EndXML 

 k @glob
 q 1
SendTermControlErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="ShowGoodsZeroSent">
<Description>
Отчёт "Запчасти которые были затребованы клиентом и которые не были отправлены"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates,p1,login</FormalSpec>
<Implementation><![CDATA[
 s $ZE="ShowGoodsZeroSentErr"
 s glob=$NA(^mtempReport(login_"@ShowGoodsZeroSent"))
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
  $$$WriteHeader("GoodsName","Название запчасти",350)
  $$$WriteHeader("Kontr","Клиент",200)
  $$$WriteHeader("DocName","Номер заявки",110)
  $$$WriteHeader("Dat","Дата",110)
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 if '+..ShowGoodsZeroSentMake(Dates,p1,login,glob) d  q 1
 . s sc=xmlstr.EndElement()
 . $$$WriteComment("Извините. Ошибка при поиске неотправленных запчастей. Попробуйте запустить отчёт с другими параметрами.")
 . $$$EndXML 
 s i="" f  s i=$O(@glob@("Data",i)) q:i=""  d
 . s DocName=@glob@("Data",i,"DocName")
 . s KontrName=@glob@("Data",i,"KontrName")
 . s GoodsName=@glob@("Data",i,"GoodsName")
 . s Goods=@glob@("Data",i,"Goods")
 . s DocDat=@glob@("Data",i,"DocDat")
 . s sc=xmlstr.Element("OneObject")
 . s sc=xmlstr.WriteAttribute("id",Goods)
 . $$$WriteElementTwice("GoodsName",GoodsName)
 . $$$WriteElementTwice("Kontr",KontrName)
 . $$$WriteElementTwice("DocName",DocName)
 . $$$WriteElementTwice("Dat",DocDat)
 . s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 
 $$$EndXML 
 q 1
ShowGoodsZeroSentErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="ShowGoodsZeroSentMake">
<ClassMethod>1</ClassMethod>
<FormalSpec>Dates,p1,p2,glob</FormalSpec>
<Implementation><![CDATA[
 s $ZE="ShowGoodsZeroSentMakeErr"
 s Dat1=$ZDH($P(Dates,"@",1),4)
 s Dat2=$ZDH($P(Dates,"@",2),4)
 &sql(declare SGZS cursor for
 select ID,Doc->Name,Doc->Source->Kontr->Name,Goods->FullName,Doc->Dat,Goods 
 into :ID,:DocName,:KontrName,:GoodsName,:DocDat,:Goods
 from Docs.StorageOutItems
 where Doc->Dat>=:Dat1 and Doc->Dat<=:Dat2 and quantreal=0 and Doc->stat=2)
 &sql(open SGZS)
 f  &sql(fetch SGZS) q:SQLCODE  d
 . s @glob@("Data",ID,"DocName")=DocName
 . s @glob@("Data",ID,"KontrName")=KontrName
 . s @glob@("Data",ID,"GoodsName")=GoodsName
 . s @glob@("Data",ID,"Goods")=Goods
 . s @glob@("Data",ID,"DocDat")=$ZD(DocDat,4)
 &sql(close SGZS)
 q 1
ShowGoodsZeroSentMakeErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>
</Class>


<Class name="Reports.ShowTables">
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>60447,53978.857891</TimeCreated>

<Method name="showanalogs">
<ClassMethod>1</ClassMethod>
<FormalSpec>where="",q2,params</FormalSpec>
<Implementation><![CDATA[
 s $ZT="showanalogsErr"
  s currentpage=$G(params("currentpage"),1)
 s stroknastr=$G(params("stroknastr"),1)

 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr

  $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("Name--Name","Наименование",150)
	 $$$WriteHeader("Name--abbr","Аббревиатура",90)
	 $$$WriteHeader("Name--Property3609","Код товара",90)
	 $$$WriteHeader("Name--codedetail","Код детали",130)
	 $$$WriteHeader("Property6625--Name","Аналог",150)
	 $$$WriteHeader("Property6625--abbr","Аббревиатура аналога",90)
	 $$$WriteHeader("Property6625--Property3609","Код аналога",90)
	 $$$WriteHeader("Property6625--codedetail","Код детали аналога",130)
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 s rs=##class(%Library.ResultSet).%New()
 s sql="select ID,Property6625,Name->Name as tov,Name->abbr as tovabbr,Name->Property3609 as tovcode,Property6625->Name as analog,Property6625->abbr as analogabbr,Property6625->Property3609 as analogcode,Property6625,Property6625->codedetail as codedetAnal,Name->codedetail as codedet from Common.Dictionary4"
 s sqlcount="select count(*) as strcount from Common.Dictionary4"
 i where'="" d
 . s what="--"
 . s rep="->"
 . f i=1:1:$L(where," ") q:where'["--"  d
 . . s where=$E(where,0,$F(where,what)-$L(what)-1)_rep_$E(where,$F(where,what),$L(where))
 . s sql=sql_" where "_where
 . s sqlcount=sqlcount_" where "_where
 
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 
 s rss=##class(%Library.ResultSet).%New()
 s ok=rss.Prepare(sqlcount)
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 s ok=rss.Execute()
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 while rss.Next(){
 s strcount=$G(rss.Data("strcount"))
 }
 
 While rs.Next() {
 s sc=xmlstr.Element("OneObject")
  s sc=xmlstr.WriteAttribute("id",$G(rs.Data("ID")))
  $$$WriteElementTwice("Name--Name",$G(rs.Data("tov")))
  $$$WriteElementTwice("Name--abbr",$G(rs.Data("tovabbr")))
  $$$WriteElementTwice("Name--Property3609",$G(rs.Data("tovcode")))
  $$$WriteElementTwice("Name--codedetail",$G(rs.Data("codedet")))
  $$$WriteElementTwice("Property6625--Name",$G(rs.Data("analog")))
  $$$WriteElementTwice("Property6625--abbr",$G(rs.Data("analogabbr")))
  $$$WriteElementTwice("Property6625--Property3609",$G(rs.Data("analogcode")))
  $$$WriteElementTwice("Property6625--codedetail",$G(rs.Data("codedetAnal")))
  
 s sc=xmlstr.EndElement()
 }
 //&sql(close df)
 s sc=xmlstr.EndElement()
  $$$WriteElementTwice("strcount",strcount)

 $$$EndXML
 q
showanalogsErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="showgarants">
<ClassMethod>1</ClassMethod>
<FormalSpec>where="",q2,params</FormalSpec>
<Implementation><![CDATA[
 s $ZT="showgarantsErr"
 s currentpage=$G(params("currentpage"),1)
 s stroknastr=$G(params("stroknastr"),1)

 s from=(currentpage*stroknastr)-stroknastr+1
 s to=currentpage*stroknastr
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("Name","Номер",90)
	 $$$WriteHeader("Property8550","Дата выдачи",120)
	 $$$WriteHeader("Property5330--Name","Кому выдан",150)
	 $$$WriteHeader("Property9194","Актуальность",120)
	 $$$WriteHeader("serial","Номер изделия",120)
	 $$$WriteHeader("tovar","Модель изделия",130)
 	 $$$WriteHeader("remont1--Dat","1 ремонт",130)
	 $$$WriteHeader("remont2--Dat","2 ремонт",130)
	 $$$WriteHeader("remont3--Dat","3 ремонт",130)
 s sc=xmlstr.EndElement()
 
 s sc=xmlstr.Element("AllObjects")
 s rs=##class(%Library.ResultSet).%New()
 s sql="select Name,%external(Property9194) as Property9194,Property8550,Property5330->Name as Property5330,serial,tovar,remont1->Dat as rem1dat,remont2->Dat as rem2dat,remont3->Dat as rem3dat,remont1otch->Dat as otch1dat,remont2otch->Dat as otch2dat,remont3otch->Dat as otch3dat from Common.Dictionary2"
 
 s sqlcount="select count(*) as strcount from Common.Dictionary2"
 i where'="" d
 . s what="--"
 . s rep="->"
 . f i=1:1:$L(where," ") q:where'["--"  d
 . . s where=$E(where,0,$F(where,what)-$L(what)-1)_rep_$E(where,$F(where,what),$L(where))
 . s sql=sql_" where "_where
 . s sqlcount=sqlcount_" where "_where
 
 s ^mtempArt("sql")=sql
 s ^mtempArt("where")=where
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 
 s rss=##class(%Library.ResultSet).%New()
 s ok=rss.Prepare(sqlcount)
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 s ok=rss.Execute()
 i '+ok $$$WriteObjError(ok) d  q 
 . s sc=xmlstr.EndElement()
 . $$$EndXML
 while rss.Next(){
 s strcount=$G(rss.Data("strcount"))
 }
 //s star=$P($ZU(188),",",2)
 While rs.Next() {
	i $I(count)
	continue:count<from
	q:count>to
 	s sc=xmlstr.Element("OneObject")
 	s name=$G(rs.Data("Name"))
    s sc=xmlstr.WriteAttribute("id",name)
 	$$$WriteElementTwice("Name",name)
 	s dat=$G(rs.Data("Property8550"))
 	s:dat'="" dat=$ZD(dat,4)
 	$$$WriteElementTwice("Property8550",dat)
 	$$$WriteElementTwice("Property5330--Name",$G(rs.Data("Property5330")))
 	$$$WriteElementTwice("Property9194",$G(rs.Data("Property9194")))
 	$$$WriteElementTwice("serial",$G(rs.Data("serial")))
 	$$$WriteElementTwice("tovar",$G(rs.Data("tovar")))
 	
 	s kik=$$data($G(rs.Data("otch1dat")))
 	s rem=$$data($G(rs.Data("rem1dat")))
 	s remo1=$S(kik'="":kik_" отчет",rem'="":rem_" заявка",1:"")

 	s kik=$$data($G(rs.Data("otch2dat")))
 	s rem=$$data($G(rs.Data("rem2dat")))
 	s remo2=$S(kik'="":kik_" отчет",rem'="":rem_" заявка",1:"")

 	s kik=$$data($G(rs.Data("otch3dat")))
 	s rem=$$data($G(rs.Data("rem3dat")))
 	s remo3=$S(kik'="":kik_" отчет",rem'="":rem_" заявка",1:"")
 	
 	$$$WriteElementTwice("remont1--Dat",remo1)
 	$$$WriteElementTwice("remont2--Dat",remo2)
 	$$$WriteElementTwice("remont3--Dat",remo3)
 	s sc=xmlstr.EndElement()
 }
 s sc=xmlstr.EndElement()
 $$$WriteElementTwice("strcount",strcount)
 $$$EndXML
 q
showgarantsErr
 $$$WriteError($ZE)
 q 0
data(data="")
 i data="" q ""
 q $ZD(data,4)
]]></Implementation>
</Method>

<Method name="jok">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
  s rs=##class(%Library.ResultSet).%New()
 s ok=rs.Prepare("select id from Common.Dictionary2 where id>'М1206599900'")
 i '+ok $$$WriteObjError(ok)  q 
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok)  q 

  s star=$P($ZU(188),",",2)
 s i=0
 While rs.Next() {
 s i=i+1
 }
 w $P($ZU(188),",",2)-star,!
 w i
 q
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// заполнить таблицу Отгрузки на странице ПЛАТЕЖИ

]]></Content>
</UDLText>

<Method name="otgruzki">
<ClassMethod>1</ClassMethod>
<FormalSpec>dat1="",dat2="",kontr=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="otgruzkiErr"
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 $$$StartXML
  s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",60)
	$$$WriteHeader("name","Номер",100)
	 $$$WriteHeader("dat","Дата",100)
	 $$$WriteHeader("summa","Сумма",80)
 s sc=xmlstr.EndElement()
 s sql="select id,Dat,Summa,Name,DocumentClass from Docs.Rash where Dat>="_dat1_" and Dat<="_dat2_" and Kontr="_kontr
 s rs=##class(%Library.ResultSet).%New()
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "fuck off"
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "fuck off"
 
 s sc=xmlstr.Element("AllObjects")
  While rs.Next() {
	i $I(count)
 	s sc=xmlstr.Element("OneObject")
	 	s id=$G(rs.Data("ID"))

	 	s name=$G(rs.Data("Name"))
	 	s dat=$G(rs.Data("Dat"))
	 	s summa=$G(rs.Data("Summa"))
	 	i dat'="" s dat=$ZD(dat,4)
	 	s summa=$J(summa,".",2)
	 	s DocumentClass=$G(rs.Data("DocumentClass"))

	 	s sc=xmlstr.WriteAttribute("id",id_"@"_DocumentClass)
 		$$$WriteElementTwice("number",count)
 		$$$WriteElementTwice("name",name)
 		$$$WriteElementTwice("dat",dat)
 		$$$WriteElementTwice("summa",summa)
 	s sc=xmlstr.EndElement()
  }
 s sc=xmlstr.EndElement()
 $$$EndXML

 q 1
otgruzkiErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// заполнить таблицу Платежи на странице ПЛАТЕЖИ

]]></Content>
</UDLText>

<Method name="plateji">
<ClassMethod>1</ClassMethod>
<FormalSpec>dat1="",dat2="",kontr=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="platejiErr"
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
 $$$StartXML
  s sc=xmlstr.Element("AllHeaders")
	 $$$WriteHeader("number","№",30)
	 $$$WriteHeader("DocumentClass","Тип документа",200)
	$$$WriteHeader("name","Номер",100)
	 $$$WriteHeader("dat","Дата",100)
	 $$$WriteHeader("summa","Сумма",80)
 s sc=xmlstr.EndElement()
 s sc=xmlstr.Element("AllObjects")

 //отберем все из приходных документов
 s sql="select ID,Dat,Summa,Name,DocumentClass->Name as DocumentClass,DocumentClass as DocumentClassId from Docs.Platejka where Dat>="_dat1_" and Dat<="_dat2_" and Kontr="_kontr
 s rs=##class(%Library.ResultSet).%New()
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "fuck off"
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "fuck off"
  While rs.Next() {
	i $I(count)
 	s sc=xmlstr.Element("OneObject")
	 	s id=$G(rs.Data("ID"))
	 	s name=$G(rs.Data("Name"))
	 	s dat=$G(rs.Data("Dat"))
	 	s summa=$G(rs.Data("Summa"))
	 	s DocumentClass=$G(rs.Data("DocumentClass"))
	 	s DocumentClassId=$G(rs.Data("DocumentClassId"))
	 	i dat'="" s dat=$ZD(dat,4)
	 	s summa=$J(summa,".",2)
	 	s sc=xmlstr.WriteAttribute("id",id_"@"_DocumentClassId)
 		$$$WriteElementTwice("number",count)
 		$$$WriteElementTwice("DocumentClass",DocumentClass)
 		$$$WriteElementTwice("name",name)
 		$$$WriteElementTwice("dat",dat)
 		$$$WriteElementTwice("summa",summa)
 	s sc=xmlstr.EndElement()
  }
  //отберем все из платежек
 s sql="select ID,Dat,Summa,Name,DocumentClass->Name as DocumentClass,DocumentClass as DocumentClassId from Docs.PrihKassOrder where Dat>="_dat1_" and Dat<="_dat2_" and Kontr="_kontr
 s rs=##class(%Library.ResultSet).%New()
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "fuck off"
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "fuck off"
  While rs.Next() {
	i $I(count)
 	s sc=xmlstr.Element("OneObject")
	 	s id=$G(rs.Data("ID"))
	 	s name=$G(rs.Data("Name"))
	 	s dat=$G(rs.Data("Dat"))
	 	s summa=$G(rs.Data("Summa"))
	 	s DocumentClass=$G(rs.Data("DocumentClass"))
		s DocumentClassId=$G(rs.Data("DocumentClassId"))
	 	i dat'="" s dat=$ZD(dat,4)
	 	s summa=$J(summa,".",2)
	 	s sc=xmlstr.WriteAttribute("id",id_"@"_DocumentClassId)
 		$$$WriteElementTwice("number",count)
 		$$$WriteElementTwice("DocumentClass",DocumentClass)
 		$$$WriteElementTwice("name",name)
 		$$$WriteElementTwice("dat",dat)
 		$$$WriteElementTwice("summa",summa)
 	s sc=xmlstr.EndElement()
  }

  
 s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
platejiErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="MakeGlobForCheifPlan">
<Description><![CDATA[
Заполнить глобаль для плана руководителя
<br><var>PlanId</var> - 
<br><var>tempGlob</var> - ]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[PlanId="",&tempGlob:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="MakeGlobForCheifPlanErr"
	i '+PlanId q "Извините. Ошибка при выводе плана руководителя. Не указан номер плана."
	i tempGlob="" s tempGlob=$NA(^mtempPlanExcel($I))
	k @tempGlob

	s docobj=##class(Operation.Plan).%OpenId(PlanId)
 	if '$ISOBJECT(docobj) q "Ошибка при выводе плана. Невозможно извлечь информацию о плане ID="_PlanId

 	i docobj.DocLanguage=2 s DocLanguage="English"
 	e  s DocLanguage=""
 	s i="" f  s i=docobj.Items.Next(i) q:i=""  d
	. s Quantity=docobj.Items.GetAt(i).Quantity
	. s DocString=docobj.Items.GetAt(i)
	. //i $i(count)
	. d:$ISOBJECT(DocString.Goods) 
	. . s abbr=$TR(DocString.Goods.abbr," ","")
	. . s digits=$TR(DocString.Goods.Property3609," ","")
	. . s:$ISOBJECT(DocString.Goods.Tovar) TovarName=$ZOBJPROPERTY(DocString.Goods.Tovar,DocLanguage_"Name")
	. . s Name=$ZOBJPROPERTY(DocString.Goods,DocLanguage_"Name")
	. . s SchemaNumber=DocString.Goods.Property5300
	. s:$G(TovarName)'="" @tempGlob@(abbr_"-"_digits,"Name")=$G(TovarName)
	. s count=$O(@tempGlob@(abbr_"-"_digits,"Name",""),-1)+1
	. s @tempGlob@(abbr_"-"_digits,"Name",count,"Quantity")=Quantity
	. s @tempGlob@(abbr_"-"_digits,"Name",count,"Name")=$G(Name)
	. s @tempGlob@(abbr_"-"_digits,"Name",count,"SchemaNumber")=$G(SchemaNumber)
 q 1
MakeGlobForCheifPlanErr
 $$$WriteError($ZE)
 q "Извините. Внутренняя ошибка при выводе плана руководителя."
]]></Implementation>
</Method>

<Method name="ShowReserves">
<Description>
Вывести резервы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SearchProperty:%String="",SearchValue:%String="",p3</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ShowReservesErr"
 s Properties("Goods")="StoreQuantity.Goods->FullName"
 s Properties("PathName")="Common.SqlProcs_AddrPath(Address)"
 s Properties("Document")="StorageOutItems.doc->Name"
 s Properties("Kontragent")="StorageOutItems.doc->Source->Kontr->Name"
 s Properties("Dat")="StorageOutItems.doc->Dat"
 s Properties("Quantity")="Value2"
  $$$StartXML
  s sc=xmlstr.Element("AllHeaders")
	$$$WriteHeader("Goods","Товар",170)
	$$$WriteHeader("PathName","Расположение",170)
	$$$WriteHeader("Document","№ документа",100)
	$$$WriteHeader("Kontragent","Контрагент",150)
	$$$WriteHeader("Dat","Дата",80)
	$$$WriteHeader("QntDoc","Резерв документа",100)
	$$$WriteHeader("QntAll","Всего в резерве",100)
 s sc=xmlstr.EndElement()
 s sc=xmlstr.Element("AllObjects")
 s rs=##class(%ResultSet).%New()
 s SqlQuery="select StoreQuantity.Goods->FullName as GoodsFullName,"
 s SqlQuery=SqlQuery_"Common.SqlProcs_AddrPath(Address) as PathName,"
 s SqlQuery=SqlQuery_"Value2,"
 s SqlQuery=SqlQuery_"StorageOutItems.goods as goods,"
 s SqlQuery=SqlQuery_"StorageOutItems.quantdefault as quantdefault,"
 s SqlQuery=SqlQuery_"StorageOutItems.doc as doc,"
 s SqlQuery=SqlQuery_"StorageOutItems.doc->Name as DocName,"
 s SqlQuery=SqlQuery_"StorageOutItems.doc->Dat as DocDat,"
 s SqlQuery=SqlQuery_"StorageOutItems.doc->Source->Kontr->Name as KontrName"
 s SqlQuery=SqlQuery_" from Store.Quantity StoreQuantity, Docs.StorageOutItems StorageOutItems"
 s SqlQuery=SqlQuery_" where (Value2>0 and StorageOutItems.StoreQntID=StoreQuantity.ID and StorageOutItems.doc->stat=1) "
 s ^mtempArt("gobo")=SqlQuery
 if SearchProperty'="" s SqlQuery=SqlQuery_" and "_Properties(SearchProperty)_" %STARTSWITH '"_SearchValue_"'"

 s ok=rs.Prepare(SqlQuery)
 i $$$ISERR(ok) $$$WriteObjError(ok)
 s ok=rs.Execute()
 i $$$ISERR(ok) $$$WriteObjError(ok)
 while rs.Next() {
  s sc=xmlstr.Element("OneObject")
  	s doc=rs.Data("doc")
  	s goods=rs.Data("goods")
	s GoodsFullName=rs.Data("GoodsFullName")
	s Addr=rs.Data("PathName")
	s Document=rs.Data("DocName")
	s Kontragent=rs.Data("KontrName")
	s Dat=rs.Data("DocDat")
	s QntAll=rs.Data("Value2")
	s QntDoc=rs.Data("quantdefault")
	s sc=xmlstr.WriteAttribute("id",goods_"@"_doc)
	$$$WriteElementTwice("Goods",GoodsFullName)
	$$$WriteElementTwice("PathName",Addr)
	$$$WriteElementTwice("Document",Document)
	$$$WriteElementTwice("Kontragent",Kontragent)
	$$$WriteElementTwice("Dat",$ZD(Dat,4))
	$$$WriteElementTwice("QntAll",QntAll)
	$$$WriteElementTwice("QntDoc",QntDoc)
  s sc=xmlstr.EndElement()
 }
 s sc=xmlstr.EndElement()
 $$$EndXML
 q 1
ShowReservesErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="ShowBrak">
<Description>
Вывести брак</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SearchProperty:%String="",SearchValue:%String="",Dates:%String=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ShowBrakErr"
 s dat1=$P(Dates,"@",1)
 s dat2=$P(Dates,"@",2)
 i dat1'="" s dat1=$ZDH(dat1,4)
 i dat2'="" s dat2=$ZDH(dat2,4)
 s Properties("GoodsFullName")="Goods->FullName"
 s Properties("PathName")="Common.SqlProcs_AddrPath(Address)"
 s Properties("DocName")="SourceDoc->Name"
 s Properties("KontrName")="SourceDoc->Kontr->Name"
 s Properties("DocDat")="%external(SourceDoc->CloseDate)"
 s Properties("Quantity")="Value2"
  $$$StartXML
  s sc=xmlstr.Element("AllHeaders")
	$$$WriteHeader("Goods","Товар",200)
	$$$WriteHeader("PathName","Расположение",250)
	$$$WriteHeader("Document","№ документа",90)
	$$$WriteHeader("SourceDoc--Kontr--Name","Контрагент",150)
	$$$WriteHeader("Dat","Дата",80)
	$$$WriteHeader("Quantity","Количество",80)
 s sc=xmlstr.EndElement()
 s sc=xmlstr.Element("AllObjects")
 s rs=##class(%ResultSet).%New()
 s SqlQuery="select ID,Goods->FullName as GoodsFullName,Goods as GoodsId,"
 s SqlQuery=SqlQuery_"Common.SqlProcs_AddrPath(Address) as PathName,"
 s SqlQuery=SqlQuery_"SourceDoc->Name as DocName,"
 s SqlQuery=SqlQuery_"SourceDoc->Kontr->Name as KontrName,"
 s SqlQuery=SqlQuery_"SourceDoc->CloseDate as DocDat,"
 s SqlQuery=SqlQuery_"Qnt"
 s SqlQuery=SqlQuery_" from Store.Brak"
 s SqlQuery=SqlQuery_" where SourceDoc->CloseDate<="_dat2
 i +dat1 s SqlQuery=SqlQuery_" and SourceDoc->CloseDate>="_dat1
 if SearchProperty'=""
 {
	f i=1:1:$L(SearchProperty,"--")
	{
		s SearchPropertyNew=$G(SearchPropertyNew)_$P(SearchProperty,"--",i)_"->"
	}
	s SearchPropertyNew=$E(SearchPropertyNew,1,$L(SearchPropertyNew)-2)
 	s SqlQuery=SqlQuery_" and "_SearchPropertyNew_" %STARTSWITH '"_SearchValue_"'"
 }

 s ok=rs.Prepare(SqlQuery)
 i $$$ISERR(ok) $$$WriteObjError(ok)
 s ok=rs.Execute()
 i $$$ISERR(ok) $$$WriteObjError(ok)
 while rs.Next() {
  s sc=xmlstr.Element("OneObject")
	s ID=rs.Data("ID")
	s Goods=rs.Data("GoodsFullName")
	s Addr=rs.Data("PathName")
	s Document=rs.Data("DocName")
	s Kontragent=rs.Data("KontrName")
	s Dat=rs.Data("DocDat")
	s Qnt=rs.Data("Qnt")
	s GoodsId=rs.Data("GoodsId")
	s:Dat Dat=$ZD(Dat,4)
 	s sc=xmlstr.WriteAttribute("id",ID)
	$$$WriteElementTwice("Goods",Goods)
	$$$WriteElementTwice("PathName",Addr)
	$$$WriteElementTwice("Document",Document)
	$$$WriteElementTwice("SourceDoc--Kontr--Name",Kontragent)
	$$$WriteElementTwice("Dat",Dat)
	$$$WriteElementTwice("Quantity",Qnt) 	
  s sc=xmlstr.EndElement()
 }
 s sc=xmlstr.EndElement()
 //$$$WriteElementTwice("comment",SqlQuery)
 $$$EndXML
 q 1
ShowBrakErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="FindGoods">
<Description>
Вывести товары и ячейки на которых они лежат</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Abbr="",Model="",Name=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="FindGoodsErr"
 s glob=$NA(^mtempFindGoods($J))
 k @glob
 s sql="select ID,FullName from Goods.Goods where"
 if Abbr '= "" s sql=sql_$S($L(sql)>41:" and",1:"")_" Abbr LIKE '"_Abbr_"%'"
 if Model '= "" s sql=sql_$S($L(sql)>41:" and",1:"")_" Property3609 LIKE '"_Model_"%'"
 if Name '= "" s sql=sql_$S($L(sql)>41:" and",1:"")_" Name LIKE '%"_Name_"%'"
 s rs=##class(%ResultSet).%New()
 s ok=rs.Prepare(sql)
 if '+ok $$$WriteObjError(ok) q 0
 s ok=rs.Execute()
 if '+ok $$$WriteObjError(ok) q 0
 while rs.Next() {
  s ID=rs.Data("ID")
  s FullName=rs.Data("FullName")
  s @glob@("Goods",ID,"FullName")=FullName
  s GoodsIDsList=$G(GoodsIDsList)_ID_","
 }

 s GoodsIDsList=$E($G(GoodsIDsList),1,$L($G(GoodsIDsList))-1)
 
 //выбираем свободное количество и резерв
 if +GoodsIDsList {
 	s sql="select Address,Goods,Value1,Value2 from Store.Quantity where Goods in ("_GoodsIDsList_")"
 	s rs=##class(%ResultSet).%New()
 	s ok=rs.Prepare(sql)
 	if '+ok $$$WriteObjError(ok) q 0
 	s ok=rs.Execute()
 	if '+ok $$$WriteObjError(ok) q 0
 	while rs.Next() {
  		s Address=rs.Data("Address")
  		s Goods=rs.Data("Goods")
  		s Value1=rs.Data("Value1")
  		s Value2=rs.Data("Value2")
  		s @glob@("Goods",Goods,"Address",Address,"Value1")=Value1
  		s @glob@("Goods",Goods,"Address",Address,"Value2")=Value2
 	}
 }
 
 //выбираем брак
 if +GoodsIDsList {
 	s sql="select Address,Goods,Qnt from Store.Brak where Goods in ("_GoodsIDsList_")"
 	s rs=##class(%ResultSet).%New()
 	s ok=rs.Prepare(sql)
 	if '+ok $$$WriteObjError(ok) q 0
 	s ok=rs.Execute()
 	if '+ok $$$WriteObjError(ok) q 0
 	while rs.Next() {
  		s Address=rs.Data("Address")
  		s Goods=rs.Data("Goods")
  		s Qnt=rs.Data("Qnt")
  		s @glob@("Goods",Goods,"Address",Address,"Brak")=Qnt
 	}
 }
 
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	$$$WriteHeader("Goods","Товар",200)
	$$$WriteHeader("PathName","Расположение",350)
	$$$WriteHeader("Quantity","Свободно",60)
	$$$WriteHeader("Rezerv","Резерв",60)
	$$$WriteHeader("Brak","Брак",60)
 s sc=xmlstr.EndElement()
 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@glob@("Goods",i)) q:i=""  d
 . f j="" f  s j=$O(@glob@("Goods",i,"Address",j)) q:j=""  d
 . . s sc=xmlstr.Element("OneObject")
 . . s sc=xmlstr.WriteAttribute("id",i)
 . . $$$WriteElementTwice("Goods",$G(@glob@("Goods",i,"FullName")))
 . . $$$WriteElementTwice("PathName",$$GetPath(j))
 . . $$$WriteElementTwice("Quantity",$G(@glob@("Goods",i,"Address",j,"Value1")))
 . . $$$WriteElementTwice("Rezerv",$G(@glob@("Goods",i,"Address",j,"Value2")))
 . . $$$WriteElementTwice("Brak",$G(@glob@("Goods",i,"Address",j,"Brak")))
 . .  s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 if '+GoodsIDsList $$$WriteComment("Не найден ни один товар c параметрами: Модель="_Model_" Аббревиатура="_Abbr_" Наименование="_Name)
 $$$EndXML
 q 1
FindGoodsErr
 $$$WriteError($ZE)
 q 0
GetPath(j)
 if $D(@glob@("Address",j)) q @glob@("Address",j)
 s Address=##class(Store.Action).AddressPath(j)
 s @glob@("Address",j)=Address
 q Address
]]></Implementation>
</Method>

<Method name="ZapchastiForModel">
<Description>
метод показывает запчасти принадлежащие модели
вызывается со страницы Attach2Model.csp</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GoodsId:%String=0,p2,p3</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s ParentObj = ##class(Goods.Goods).%OpenId(GoodsId)
 s glob=$NA(^mtempZapchastiForModel($J))

 if '$ISOBJECT(ParentObj) d  q 1
 . $$$StartXML
 . $$$WriteComment("Ошибка. Товар "_GoodsId_" не существует.")
 . $$$EndXML
 
 $$$StartXML
 s sc=xmlstr.Element("AllHeaders")
	$$$WriteHeader("FullName","Полное наименование",200)
	$$$WriteHeader("codedetail","Код детали",350)
	$$$WriteHeader("Property5300","Номер по схеме",120)
	$$$WriteHeader("EnglishName","Англ. наименование",60)
 s sc=xmlstr.EndElement()
 
 &sql(declare ZapchastiForModelc cursor for
 select ID,FullName,codedetail,Property5300,EnglishName
 into :ID,:FullName,:codedetail,:Property5300,:EnglishName
 from Goods.Goods
 where Tovar = :GoodsId)
 &sql(open ZapchastiForModelc)
 f  &sql(fetch ZapchastiForModelc) q:SQLCODE  d
 . i $i(count)
 . f i="ID","FullName","codedetail","Property5300","EnglishName" d
 . . s @glob@("Goods",count,i)=@i
 &sql(close ZapchastiForModelc)
 
 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@glob@("Goods",i)) q:i=""  d
 . s sc=xmlstr.Element("OneObject")
 . s sc=xmlstr.WriteAttribute("id",$G(@glob@("Goods",i,"ID")))
 . $$$WriteElementTwice("FullName",$G(@glob@("Goods",i,"FullName")))
 . $$$WriteElementTwice("codedetail",$G(@glob@("Goods",i,"codedetail")))
 . $$$WriteElementTwice("Property5300",$G(@glob@("Goods",i,"Property5300")))
 . $$$WriteElementTwice("EnglishName",$G(@glob@("Goods",i,"EnglishName")))
 .  s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 if '+$G(count) $$$WriteComment("Не найдена ни одна запчасть принадлежащая товару ")
 $$$EndXML
 
 k @glob
 q 1
]]></Implementation>
</Method>

<Method name="ShowDetailsSent">
<ClassMethod>1</ClassMethod>
<FormalSpec>Federal="",dat1="",dat2=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 s $ZT="ShowDetailsSentErr"
 s dat1=$S(dat1="":"",1:$ZDH(dat1,4))
 s dat2=$S(dat2="":"",1:$ZDH(dat2,4))
	
 $$$StartXML
 s glob=$NA(^mtempSDSReport($J))
 k @glob
 
 s sc=xmlstr.Element("AllHeaders")
 	$$$WriteHeader("Nmb","№ п/п",40)
 	$$$WriteHeader("ClName","Название АСЦ",130)
 	$$$WriteHeader("Dat","Дата заявки",80)
 	$$$WriteHeader("City","Город",80)
 	$$$WriteHeader("Req","Заявка",60)
 	$$$WriteHeader("Opl","гарантия/платно",60)
 	$$$WriteHeader("Qnt","к-во заказанных з/ч",60)
 	$$$WriteHeader("RQnt","к-во отправленных з/ч",60)
 	$$$WriteHeader("Perc","% выполнения",60)
 	$$$WriteHeader("Uns","не отправленные з/ч",200)
 s sc=xmlstr.EndElement()

 //выберем все инструкции руководителя (
 &sql(declare SDS cursor
 	for select ID,Dat,Kontr->City,RashOplatType->Name,innerinstr,Kontr->Name,Name
 	into :ID,:Dat,:KontrCity,:RashOplatTypeName,:innerinstr,:KontrName,:Name
 	from Operation.Instructions
 	where (Stat=2) AND (Oper=10) 
 	and (Kontr->Federal=:Federal or :Federal=null)
 	and Dat>=:dat1 and Dat<=:dat2
 )
 &sql(open SDS)
 f  &sql(fetch SDS) q:SQLCODE  d
 . f i="ID","Dat","KontrCity","RashOplatTypeName","innerinstr","KontrName","Name" d
 . . s @glob@(ID,i)=@i
 . if $G(@glob@(ID,"Dat")) s @glob@(ID,"Dat")=$ZD(@glob@(ID,"Dat"),4)
 &sql(close SDS)
 //
 s InstrId="" f  s InstrId=$O(@glob@(InstrId)) q:InstrId=""  d
 . s innerinstr=@glob@(InstrId,"innerinstr")
 . s (Commonquantreal,CommonQuantity)=0,UnSentGoods=""
 . //цикл по строкам внутренней инструкции
 . &sql(declare SDS2 cursor for
 select ID,Goods->FullName,quantreal,Quantity
 into :ID,:GoodsFullName,:quantreal,:Quantity
 from Docs.StorageOutItems
 where doc=:innerinstr)
 . &sql(open SDS2)
 . f  &sql(fetch SDS2) q:SQLCODE  d
 . . if quantreal<Quantity s UnSentGoods=UnSentGoods_GoodsFullName_", "
 . . s Commonquantreal=Commonquantreal+quantreal
 . . s CommonQuantity=CommonQuantity+Quantity
 . &sql(close SDS2)
 . s @glob@(InstrId,"UnSentGoods")=$E(UnSentGoods,1,$L(UnSentGoods)-2)
 . s:CommonQuantity @glob@(InstrId,"Percent")=$J((Commonquantreal/CommonQuantity)*100,"",2)_"%"
 . s @glob@(InstrId,"quantreal")=Commonquantreal
 . s @glob@(InstrId,"Quantity")=CommonQuantity

 s sc=xmlstr.Element("AllObjects")
 s i="" f  s i=$O(@glob@(i)) q:i=""  d
 . s sc=xmlstr.Element("OneObject")
 . s sc=xmlstr.WriteAttribute("id",i)
 . $$$WriteElementTwice("Nmb",$I(AllCount))
 . $$$WriteElementTwice("ClName",$G(@glob@(i,"KontrName")))
 . $$$WriteElementTwice("Dat",$G(@glob@(i,"Dat")))
 . $$$WriteElementTwice("City",$G(@glob@(i,"KontrCity")))
 . $$$WriteElementTwice("Req",$G(@glob@(i,"Name")))
 . $$$WriteElementTwice("Opl",$G(@glob@(i,"RashOplatTypeName")))
 . $$$WriteElementTwice("Qnt",$G(@glob@(i,"Quantity")))
 . $$$WriteElementTwice("RQnt",$G(@glob@(i,"quantreal")))
 . $$$WriteElementTwice("Perc",$G(@glob@(i,"Percent"))) 
 . $$$WriteElementTwice("Uns",$G(@glob@(i,"UnSentGoods")))
 .  s sc=xmlstr.EndElement()
 s sc=xmlstr.EndElement()
 
 $$$EndXML
 k @glob
 q 1
ShowDetailsSentErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при формировании таблицы."
]]></Implementation>
</Method>
</Class>


<Class name="Store.Action">
<IncludeCode>xmlmacros</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeCreated>60344,24669.502716</TimeCreated>

<Method name="CreateLevel">
<ClassMethod>1</ClassMethod>
<FormalSpec>name,quant,code,sub,Comment,tempstore,sta</FormalSpec>
<Implementation><![CDATA[
 s depot=%session.Data("depot")
 s $ZT="CreateLevelErr",ok=1
 i (sub=1)&(code'="") d
 . &sql(select id,Currentsize,Currentweight into :id,:Currentsize,:Currentweight from Store.Address where Code=:code and Depot=:depot)
 . q:SQLCODE
 . i Currentsize>0 s ok="Невозможно разбить ячейку с товарами." q
 . i Currentweight>0 s ok="Невозможно разбить ячейку с товарами." q
 . &sql(select Value1 into :Value1 from Store.Quantity where Address=:id)
 . i 'SQLCODE&(+$G(Value1)>0) s ok="Невозможно разбить ячейку с товарами." q
 q:'+ok ok
 i sub=1 s ok=..GetLastSubItem(depot,.code)
 e  s ok=..GetLastItem(depot,.code)
 q:'+ok ok
 //s sizze=$S(curval=1:3981.3,curval=2:4516.8,curval=3:21840,1:0)
 
 f i=0+sta:1:quant+sta-1 d
 . s addr=##class(Store.Address).%New()
 . d addr.DepotSetObjectId(depot)
 . s addr.Name=name_$S(quant>1:" "_i,1:"")
 . //s addr.Name=name_"-"_$S(quant>1:""_i,1:"")
 . s $P(code,"*",$L(code,"*"))=+$P(code,"*",$L(code,"*"))+1
 . s addr.Code=code
 . s addr.Comment=$G(Comment)
 . //s addr.oldnumb=$G(name)_"-"_i
 . s addr.tempstore=+$G(tempstore)
 . //s addr.Size1=sizze
 . s ok=addr.%Save()
 . i '+ok $$$WriteObjError(ok) q

 q ok
CreateLevelErr
 q $ZE
]]></Implementation>
</Method>

<Method name="GetLastItem">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Depot,&Code]]></FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetLastItemErr"
 s Parent=$Piece(Code,"*",1,$Length(Code,"*")-1)
 /*
 if Parent'=""{
 &sql(select top 1 Code into :Code from Store.Address where Parent=:Parent and Depot=:Depot order by Code desc)}
 else{
 &sql(select top 1 Code into :Code from Store.Address where Parent is Null and Depot=:Depot order by Code desc)
 }
 */
 &sql(declare zzd2 cursor for 
 select Code into :lCode from Store.Address 
 where NULLIF(Parent,:Parent) is Null and Depot=:Depot)
 &sql(open zzd2)
 //s:(SQLCODE=100)&(%ROWCOUNT=0) Code="*0"
 i SQLCODE<0 $$$WriteError("GetLastSubItem SQLCODE="_SQLCODE) &sql(close zzd2) q "Извините ошибка при формировании адреса ячейки"
 f  &sql(fetch zzd2) q:SQLCODE  d
 . s t=$P(lCode,"*",$L(lCode,"*"))
 . i t>+$G(res) s res=t
 &sql(close zzd2)
 //s $P(Code,"*",$L(Code,"*"))=+$P(Code,"*",$L(Code,"*"))+1
 i $G(res)="" s Code="*"
 i Code="" s Code="*"
 s $P(Code,"*",$L(Code,"*"))=+$G(res)
 q 1
GetLastItemErr
 q $ZE
]]></Implementation>
</Method>

<Method name="GetLastSubItem">
<Description><![CDATA[
Получить последнюю ячейку на данном уровне
<br><var>Depot</var> - ID склада
<br><var>Code</var> - Код ячейки]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Depot,&Code]]></FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetLastSubItemErr"
 //&sql(select top 1 Code into :LasSubCode from Store.Address where Parent=:Code and Depot=:Depot order by Code desc)
 &sql(declare zzd cursor for 
 select id,Code into :id,:LasSubCode 
 from Store.Address 
 where Parent=:Code and Depot=:Depot)
 &sql(open zzd)
 i SQLCODE<0 $$$WriteError("GetLastSubItem SQLCODE="_SQLCODE) &sql(close zzd) q "Извините ошибка при формировании адреса ячейки"
 f  &sql(fetch zzd) q:SQLCODE  d
 . s t=$P(LasSubCode,"*",$L(LasSubCode,"*"))
 . i t>+$G(res) s res=t
 &sql(close zzd)
 
 //s:(SQLCODE=100)&(%ROWCOUNT=0) LasSubCode=Code_"*0"
 //s $P(LasSubCode,"*",$L(LasSubCode,"*"))=+$P(LasSubCode,"*",$L(LasSubCode,"*"))+1
 s Code=Code_"*"_(+$G(res))
 q 1
GetLastSubItemErr
 q $ZE
]]></Implementation>
</Method>

<Method name="GetChilds">
<Description><![CDATA[
Получить строку с потомками данной ячейки хранения
<br><var>Code</var> - Код ячейки хранения (например *1*1)
<br><var>depot</var> - ID склада]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Code="",depot=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetChildsErr"
 s:depot="" depot=%session.Data("depot")
 s sql="select ID,Code,Name,Comment,tempstore,Currentsize,Size1 from Store.Address where depot="_depot_" and ISNULL(Parent,'')='"_Code_"'"
 s result=##class(%ResultSet).%New()
 d result.Prepare(sql)
 s result.RuntimeMode=2
 s ok=result.Execute()
 s res=""
 While result.Next() {
  s OutString=""
  s $P(OutString,"~",1)=result.Get("ID")
  s $P(OutString,"~",2)=result.Get("Code")
  s $P(OutString,"~",3)=result.Get("Name")
  s $P(OutString,"~",4)=result.Get("Comment")
  s $P(OutString,"~",5)=result.Get("tempstore")
  s percentusage=0
  s Currentsize=+result.Get("Currentsize")
  s Size=+result.Get("Size1")
  i Size>0 s percentusage=$J((Currentsize/Size)*100,".",0)
  s $P(OutString,"~",6)=percentusage
  s res=res_OutString_"#@#"
 }
 q res
GetChildsErr
 q $ZE
]]></Implementation>
</Method>

<Method name="SaveQuantFromInstr">
<Description><![CDATA[
сохранить количество товара указанное в инструкции
<var>docid</var> - id инструкции]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>docid</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SaveQuantFromInstrErr"
 s err="Извините, при записи остатков произошла ошибка"
 s doc=##class(Docs.Super).%OpenId(docid)
 if $ISOBJECT(doc.Kontr) s KontrId = doc.Kontr.%Id()
 s tempGlob=$NA(^mtempTempGlob("SaveQuantFromInstr",$I)) k @tempGlob
 q:+##class(Docs.Action).CheckFinal(doc) "Документ уже обработан"
 i '$ISOBJECT(doc) $$$WriteError("SaveQuantFromInstr Не открылся "_docid_" в Docs.Super") q err
 s DocumentClass=$S($ISOBJECT(doc.DocumentClass):doc.DocumentClass.%Id(),1:doc.DocumentClass)
  
 Set key = "",ok=1
 TSTART
 
 // если переданный документ это инструкция по размещению
 if DocumentClass="Docs.StorageIn" {
  s PrihodType=doc.PrihodType
  Do 
  {
     i '$ISOBJECT(doc.Items) $$$WriteError("SaveQuantFromInstr документ класса Docs.StorageIn не имеет Items(???)")
     Set item = doc.Items.GetNext(.key)
  	 q:'$ISOBJECT(item)
     s itemGoods=item.Goods
     s itemquantreal=item.quantreal
     if itemquantreal="" s ok="Для товара "_item.Goods.FullName_" не указано количество." q
     i '$ISOBJECT(item.addr) s ok="Для товара "_item.Goods.FullName_" не указано место на складе. Укажите места для всех товаров и повторите обработку документа." q
     i PrihodType s ok=..savequantBrak(itemGoods,item.addr,itemquantreal,,doc.Source) //это приход брака
     e  s ok=..savequant(itemGoods,item.addr,itemquantreal)
     q:'+ok
  } While (key '= "")
 }
 
 // если переданный документ это инструкция по отгрузке 
 if DocumentClass="Docs.StorageOut" {
  s Brak=doc.Brak
  Do {
     i $I(iio)
     Set item = doc.Items.GetNext(.key)
     if $ISOBJECT(item) {
      s itemGoods=item.Goods
      s itemPrice=item.Price
      s itemGoodsId=item.Goods.%Id()
      s itemquantreal=item.quantreal
      if itemquantreal="" s ok="Для товара "_item.Goods.FullName_" не указано количество." q
      s itemGoodsFullName=item.Goods.FullName
      s quantdefault = item.quantdefault
      s itemId = item.%Id()
      
      if (+item.quantreal>0)&&('$ISOBJECT(item.addr)) s ok="Ошибка. Для товара "_itemGoodsFullName_" не указана ячейка на складе." q
      
     if (+item.quantreal>0)&&($ISOBJECT(item.addr)) {
       #; если инструкция по браку, то удаляем из брака, иначе из обычного количества 
       if Brak {
        s ok=..RemQuantBrak(itemGoods,item.addr,$G(KontrId),itemquantreal)
       } else {
      if ($ISOBJECT(item.StoreQntID)),(item.StoreQntID.Address.%Id()'=item.addr.%Id()) {
        d ##class(Docs.StorageOutItems).RemoveReserve(item.StoreQntID.%Id(),item.Quantity,itemId)
        s item.StoreQntID=""
      }
        #;s ok=..remquant(itemGoods,item.addr,itemquantreal,item.StoreQntID,quantdefault,itemId)
        s ok=..RemoveQuantity(itemGoods,item.addr,itemquantreal,item.StoreQntID,quantdefault,itemId)
        s ^mtempArt("rrr",itemId)=ok
       }
     }
     
     //если был резерв и сняли меньше чем ставили в резерв, то снимем остальное
     if (item.Quantity>item.quantreal)&($ISOBJECT(item.StoreQntID)) d ##class(Docs.StorageOutItems).RemoveReserve(item.StoreQntID.%Id(),item.Quantity-item.quantreal,itemId)
      s @tempGlob@(itemGoodsId)=$G(@tempGlob@(itemGoodsId))+itemquantreal
      s item.Total=$J(itemquantreal*itemPrice,".",2)
     }
     q:'+ok
   } While (key '= "")
   
  q:'+ok ok
   // введем в расходную накладную реальное количество
  s ok=..ChangeRashQuant(doc.Source,tempGlob)
  s kagent=doc.Source.Kontr
  if $ISOBJECT(kagent){
   s sd=doc.Source,sdk=sd.Kontr
   s balance=sdk.Balance,docsum=sd.Summa
   s newBalance=balance-docsum
   s sdk.Balance=newBalance
   d ##class(Account.Kontragent).Change(kagent.%Id(),sd.%Id(),-docsum)
  }
  
  
  q:'+ok ok
  j ##class(Kontragent.Action).SendMail(doc.Source.%Id(),"Docs.Rash")
  s ok=doc.%Save()
  i '+ok $$$WriteObjError(ok) s ok=err
  s innerkurs=$$$TunesVariableGlobal("innerkurs")
  s doc.Source.RubSumma=$J(doc.Source.Summa*innerkurs,"",2)
 }
 
 i '+ok TROLLBACK  q ok
 s ok=##class(Docs.Action).SetFinal(doc)
 i '+ok TROLLBACK  q ok
 s ok=##class(Docs.Action).SetFinal(doc.Source)
 i '+ok TROLLBACK  q ok
 s ok=##class(Operation.InstrActions).pickasanswer(doc)
 TCOMMIT
 k @tempGlob
 q 1
SaveQuantFromInstrErr
 $$$WriteError($ZE)
 q "Извините, при записи остатков произошла ошибка."
]]></Implementation>
</Method>

<Method name="ChangeRashQuant">
<Description>
Сохранить количество товара в расходной накладной
doc - объект или id расходной накладной
tempGlob - ссылка на глобал где хранятся (товар)=количество</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>doc="",tempGlob</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ChangeRashQuantErr"
 i '$ISOBJECT(doc) s doc=##class(Docs.Rash).%OpenId(doc)
 i '$ISOBJECT(doc) $$$WriteError("ChangeRashQuant - не удалось открыть расходную накладную "_doc) q "Извините, внутренняя ошибка при изменении количества в расходной накладной"
 s key="",DocSumm=0
 //посчитаем и запишем сколько строк в расходной накладной приходится на каждый товар
 s rs=##class(%ResultSet).%New()
 s sql="select count(id) as GoodsCount,Goods from Docs.RashItems where doc='"_doc.%Id()_"' group by Goods"
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "Ошибка при подсчёте количества товаров в расходной накладной "_doc.Name
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "Ошибка при подсчёте количества товаров в расходной накладной "_doc.Name
 while rs.Next(){
  s GoodsItemsCount(rs.Data("Goods"))=rs.Data("GoodsCount")
 }
 
 Do {
    Set item = doc.Items.GetNext(.key)
    if $ISOBJECT(item) {
     s itemGoodsId=item.Goods.%Id()
     i $I(StrGoodsCount(itemGoodsId)) //считаем сколько строк с этим товаром мы уже прошли
     s Price=item.Price
     s Quantity=+$G(@tempGlob@(itemGoodsId)) //суммарное количество этого товара в документе
     s GoodsItemsCount=$G(GoodsItemsCount(itemGoodsId),1) //количество строк с этим товаром в расходной накладной
     s qnt=Quantity\GoodsItemsCount //количество записываемое в текущую строку расходной накладной
     //если проходим последнюю строку в этой расходной с этим товаром, то к количеству товара прибавляем остаток от деления суммарного количества товара в документе на кол. строк с этим товаром
     i StrGoodsCount(itemGoodsId)=GoodsItemsCount s qnt=qnt+(Quantity#GoodsItemsCount)
     s item.Quantity=qnt
     s Total=$J(Price*qnt,".",2)
     s item.Total=Total
     s DocSumm=$G(DocSumm)+Total
    }
 } While (key '= "")
 s doc.Summa=+$G(DocSumm)
 s ok=doc.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, внутренняя ошибка при сохрании количества в накладной"
 q 1
ChangeRashQuantErr
 $$$WriteError($ZE)
 q "Извините, внутренняя ошибка при сохрании количества в расходной накладной"
]]></Implementation>
</Method>

<Method name="savequantBrak">
<Description><![CDATA[
Добавить товар в ячейку в таблицу брака
<br><var>Goods</var>  - товар (ID или объект)
<br><var>Address</var> - адрес (ID или объект)
<br><var>Value</var> - количество
<br><var>notcompute</var> - если 1 то предыдущее значение не учитывается
<br><var>SourceDoc</var> - Документ - основание]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Address,Value=0,notcompute=0,SourceDoc=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="savequantErr"
 
 s ok=..validate(Goods,Address,Value)
 i '+ok q ok
 i '$ISOBJECT(Goods) d
 . s GoodsId=Goods
 . s Goods=##class(Goods.Goods).%OpenId(Goods)
 e  s GoodsId=Goods.%Id()
  i '$ISOBJECT(Address) d
 . s AddressId=Address
 . s Address=##class(Store.Address).%OpenId(Address)
 e  s AddressId=Address.%Id()

 if '$ISOBJECT(SourceDoc) q "Для товара "_Goods.FullName_" не указан документ источник брака. Брак не может быть принят."
 if '$ISOBJECT(SourceDoc.Kontr) q "В документе "_SourceDoc.Name_" от "_$ZD(SourceDoc.Dat,4)_" не указан контрагент. Брак не может быть принят."
 s KontrId = SourceDoc.Kontr.%Id()
 
 //попробуем найти id у которого уже есть такой товар, ячейка и контрагент
  &sql(select ID into :StoreBrakId from Store.Brak where Goods=:GoodsId and Address=:AddressId and Kontr=:KontrId)
  if SQLCODE<0 d  q "Извините. Ошибка при попытке занести остатки по браку."
  . $$$WriteError("select ID from Store.Brak where Goods="_Goods_" and Address="_Address_" and Kontr="_KontrId_" SQLODE="_SQLCODE)
  if SQLCODE s StoreBrakId=""
 
 //создадим или откроем ячейку 
   if +$G(StoreBrakId) s storeobj=##class(Store.Brak).%OpenId(StoreBrakId)
  if '$ISOBJECT($G(storeobj)) s storeobj=##class(Store.Brak).%New()
  s storeobj.Goods=Goods
  s storeobj.Address=Address
  s storeobj.Qnt=Value
  d storeobj.KontrSetObjectId(KontrId)
  d storeobj.SourceDocSetObjectId(SourceDoc.%Id())
  s ok=storeobj.%Save()
  k storeobj
  i '+ok $$$WriteObjError(ok) q "Извините. При записи остатков произошла ошибка."
 
 //интересно нахрена я обнулял всю ячейку???
 //i 'notcompute s Address.Currentweight=0,Address.Currentsize=0
  s Address.Currentweight=Address.Currentweight+(+Goods.Weight*Value)
  s Address.Currentsize=Address.Currentsize+(+Goods.Size1*Value)
  s ok=Address.%Save()
  i '+ok $$$WriteObjError(ok) q "Извините. При записи остатков произошла ошибка."
 q 1
savequantErr
 $$$WriteError($ZE)
 q "Извините. При записи остатков произошла ошибка."
]]></Implementation>
</Method>

<Method name="savequant">
<Description><![CDATA[
Добавить товар в ячейку
<br><var>Goods</var>  - товар (ID или объект)
<br><var>Address</var> - адрес (ID или объект)
<br><var>Value</var> - количество
<br><var>notcompute</var> - если 1 то предыдущее значение не учитывается]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Address,Value=0,notcompute=0</FormalSpec>
<Implementation><![CDATA[
 s $ZT="savequantErr"
 i 'notcompute s ok=..validate(Goods,Address,Value)
 i 'notcompute,'+ok q ok
 i '$ISOBJECT(Goods) d
 . s GoodsId=Goods
 . s Goods=##class(Goods.Goods).%OpenId(Goods)
 e  s GoodsId=Goods.%Id()
  i '$ISOBJECT(Address) d
 . s AddressId=Address
 . s Address=##class(Store.Address).%OpenId(Address)
 e  s AddressId=Address.%Id()
 &sql(select ID into :storeid from Store.Quantity where Address=:AddressId and Goods=:GoodsId)
 if SQLCODE=100 s storeid=""
 i SQLCODE<0 $$$WriteError("savequant %SQLCODE="_SQLCODE_" Address="_AddressId_" and Goods="_GoodsId) q "Внутренняя ошибка при записи количества в базу. Операция невозможна."
 i storeid="" d
 . s storeobj=##class(Store.Quantity).%New()
 . s storeobj.Goods=Goods
 . s storeobj.Address=Address
 . s storeobj.Value1=Value
 . s storeobj.Value2=0
 e  d
 . s storeobj=##class(Store.Quantity).%OpenId(storeid)
 . i notcompute s storeobj.Value1=0 //если укажут что не учитывать предыдущее значение то предыдущее значение обнулим
 . s storeobj.Value1=storeobj.Value1+$G(Value)
 s ok=storeobj.%Save()
 k storeobj
 i '+ok $$$WriteObjError(ok) q "Извините, при записи остатков произошла ошибка."
 i notcompute s Address.Currentweight=0,Address.Currentsize=0
 s Address.Currentweight=Address.Currentweight+(+Goods.Weight*Value)
 s Address.Currentsize=Address.Currentsize+(+Goods.Size1*Value)
 s ok=Address.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините, при записи остатков произошла ошибка"
 q 1
savequantErr
 $$$WriteError($ZE)
 q "Извините. При записи остатков произошла ошибка."
]]></Implementation>
</Method>

<Method name="remquant">
<Description>
Устаревшая реализация метода списания количества товара с ячейки
remquant - remove quantity</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Address="",Value=0,StoreQntID,quantdefault,docitemId</FormalSpec>
<Private>1</Private>
<Implementation><![CDATA[
 s $ZT="remquantErr",err="Извините, операция списания остатков вызвала ошибку."

 i Value=0 q 1

 s allright='$$$TunesVariable("allowminus") //если 0 значит не всё в порядке и можно количество выводить в минус
 
 i '$ISOBJECT(Goods) d
 . s GoodsId=Goods
 . s Goods=##class(Goods.Goods).%OpenId(Goods)
 e  s GoodsId=Goods.%Id()

 s GoodsFullName=$S($ISOBJECT(Goods):Goods.FullName,1:"")
 i Address="" q "Для товара "_$G(GoodsFullName)_" ("_Value_" шт.) не указано место."
 //i Address="" s Address=1254  //!!! если не указали ячейку, выписываем из "не распределённых" 1 склада
 
 i '$ISOBJECT(Address) d
 . s AddressId=Address
 . s Address=##class(Store.Address).%OpenId(Address)
 e  s AddressId=Address.%Id()
 i '$ISOBJECT(Goods) q "Не указан товар."
 i '$ISOBJECT(Address) q "Для товара "_Goods.FullName_" не указана ячейка."
 s error=1
 
 // если конкретно указали ячейку в Store.Quantity то берём из неё, иначе ищем эту ячейку по адресу и товару
 if $ISOBJECT($G(StoreQntID)) d
 . s storeid=StoreQntID.%Id()
 . //если указали ID в Store.Quantity то количество забираем из резерва (а в резерв перегнали когда создавали документ)
 . s QuantityProperty="Value2"
 . //если вдруг указали другую ячейку, а мы в этой уже резерв поставили
 else  d
 . &sql(select ID into :storeid from Store.Quantity where Address=:AddressId and Goods=:GoodsId)
 . if (SQLCODE=100)&(allright) s error="В ячейке "_..AddressPath(Address)_" нет товара "_Goods.FullName
 . i SQLCODE<0 $$$WriteError("remquant %SQLCODE="_SQLCODE_" Address="_AddressId_" and Goods="_GoodsId) s error=err
 . //если не указан ID в Store.Quantity то количество забираем из Value1
 . s QuantityProperty="Value1"
 q:'+error error
 
 
 
 s:$G(storeid)'="" storeobj=##class(Store.Quantity).%OpenId(storeid)
 i '$ISOBJECT($G(storeobj)) d
 . s storeobj=##class(Store.Quantity).%New()
 . d storeobj.GoodsSetObjectId(GoodsId)
 . d storeobj.AddressSetObjectId(AddressId)
 . s storeobj.Value1=0
 . s storeobj.Value2=0
 
 if ($ZOBJPROPERTY(storeobj,QuantityProperty)<$G(Value))&(allright) q "Обнаружена попытка забрать товар "_GoodsFullName_" "_$G(Value)_" штук из ячейки в которой "_$ZOBJPROPERTY(storeobj,QuantityProperty)_" штук"
 
 s $ZOBJPROPERTY(storeobj,QuantityProperty)=$ZOBJPROPERTY(storeobj,QuantityProperty)-$G(Value)
 s ok=storeobj.%Save()
 i (storeobj.Value1=0)&(storeobj.Value2=0) d storeobj.%DeleteId(storeobj.%Id())
 k storeobj
 i '+ok $$$WriteObjError(ok) q "Извините. При записи остатков произошла ошибка."
 s Address.Currentweight=Address.Currentweight-(+Goods.Weight*Value)
 s Address.Currentsize=Address.Currentsize-(+Goods.Size1*Value)
 s ok=Address.%Save()
 
 /*
 //если был резерв и если сняли меньше чем был резерв
 if QuantityProperty="Value2",quantdefault>Value d
 . //сколько лишнего осталось в резерве
 . s FinallyJustRemoveReserve = quantdefault-Value
 . d ##class(Docs.StorageOutItems).RemoveReserve(storeid,RemoveReserve,docitemId)
 */
 
 i '+ok $$$WriteObjError(ok) q "Извините. При записи остатков произошла ошибка."
 q 1
remquantErr
 $$$WriteError($ZE)
 q "Извините. При записи остатков произошла ошибка."
]]></Implementation>
</Method>

<Method name="RemoveQuantity">
<Description><![CDATA[
Списание товара из ячейки (remquant - RemoveQuantity)
<br><var>Good</var> - Товар (ID или объект <class>Goods.Goods</class>)
<br><var>Cell</var> - Ячейка (ID или объект <class>Store.Address</class>)
<br><var>Amount</var> - Количество
<br><var>Portion</var> - Порция (ID или объект) <class>Store.Quantity</class> откуда брали количество (где убирать резерв)
<br><var>Need</var> - какое количество просили в накладной (!!! В алгоритме не используется)
<br><var>RowId</var> - id строчки в инструкции (!!! в алгоритме не используется)

<br/>Возвращает 1 в случае успеха или ошибку (строка c описанием) 
<br/>Доп. эффекты: если порция обнуляется, то этот метод удалит ее
<br/>              если порции нет, то (при настройке allowMinus=1) этот  метод создаст ее]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Good:Goods.Goods,Cell:Store.Cell,Amount:%Float=0,Portion:Store.Quantity="",Need:%Float,RowId:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 #; нулевое количество, можно ничего не делать
 Q:Amount=0 1  
 
 #; Проверка и нормализация входных параметров
 s Good=$g(Good),Cell=$g(Cell),Value=+$g(Value),Portion=$g(Portion)
 #; Переход на идентификаторы
 s:$IsObject(Good) Good=Good.%Id() 
 s:$IsObject(Cell) Cell=Cell.%Id()
 s:$IsObject(Portion) Portion=Portion.%Id()

 #; Goods.Goods
 Q:Good="" "Не указан товар"
 #; название товара 
 s goodName="" &sql(Select FullName Into :goodName From Goods.Goods Where ID=:Good)
 

 #;Store.Address
 if Cell="" Q "Для товара "_$G(goodName)_" ("_Amount_" шт.) не указана ячейка."
  
 #;Store.Quantity
 #;списываем по умолчанию с основного количества
 #;но если указали Portion, то количество забираем из зарезервированого количества резерва 
 #;(а в резерв перегнали когда создавали документ) 
 s fromReserve=0 s:Portion'="" fromReserve=1 
 
 #;Если порцию не указали, то ищем ее по адресу и товару
 if Portion="" {
  &sql(select ID into :Portion from Store.Quantity where Address=:Cell and Goods=:Good)
 }
 
 #; Смотрим настройки. Можно ли списывать в минус
 s allowMinus=$$$TunesVariable("allowminus") ;если 0 значит не всё в порядке и можно количество выводить в минус
 
 #;порцию так и не нашли и отрицательное количество запрещено
 if Portion=""&('allowMinus) 
 {
   Q "В ячейке "_..AddressPath(Cell)_" нет товара "_goodName_"."
 } 
 
 if Portion=""&(allowMinus) {
  #;порцию не нашли, но отрицательное количество разрешено  
  #;тогда создаем нулевую порцию
  s Portion=##class(Store.Quantity).%New()
  d Portion.GoodsSetObjectId(Good)
  d Portion.AddressSetObjectId(Cell)
  s Portion.Value1=0, Portion.Value2=0
  s sc=Portion.%Save() 
  if 'sc k Portion Q "Не удалось создать новую порцию товара "_goodName_": "_$system.Status.GetOneErrorText(sc)
  s Portion=Portion.%Id() ;запоминая закрываем
 }
  
 
 
 #; начинаем списание
 TSTART
  
 #;блокировка ячейки
 s Cell=##class(Store.Address).%OpenId(Cell,4,.sc)
 if 'sc {
   TROLLBACK
   Q "Не удалось получить эксклюзивный доступ к ячейке "_$system.Status.GetOneErrorText(sc)
 }
 
 #; блокировка порции
 s Portion=##class(Store.Quantity).%OpenId(Portion,4,.sc) 
 if 'sc {
   TROLLBACK
   Q "Не удалось получить эксклюзивный доступ к порции: "_$system.Status.GetOneErrorText(sc)
 }
 
 #; блокировка описания товара
 s Good=##class(Goods.Goods).%OpenId(Good,4,.sc)
 if 'sc {
   TROLLBACK
   Q "Не удалось получить эксклюзивный доступ к товару: "_$system.Status.GetOneErrorText(sc)
 }

 #;остатки проверяем после блокировки ячейки
 #;проверить остаток порции с учетом настройки "Запрет отрицательных"
 s amount=""
 if 'fromReserve { ;какое количество проверяем
   s amount=Portion.Value1
 } else {
   s amount=Portion.Value2
 } 
 

 s tempglob = $NA(^mtempArt("RemoveQuantity"))
 k @tempglob
 s countmtemp = $I(@tempglob)
 s @tempglob@(countmtemp,Good.FullName,"Need")=Need
 s @tempglob@(countmtemp,Good.FullName,"Amount")=Amount
 s @tempglob@(countmtemp,Good.FullName,"amount")=amount
 s @tempglob@(countmtemp,Good.FullName,"fromReserve")=fromReserve
 s @tempglob@(countmtemp,Good.FullName,"RowId")=$G(RowId)
 s @tempglob@(countmtemp,Good.FullName,"Адрес")=..AddressPath(Portion.Address)
 s @tempglob@(countmtemp,Good.FullName,"Portion.%Id")=Portion.%Id()
 
 if amount<Amount&&('allowMinus) { 
  ;количества недостаточно и отрицательный остаток запрещен
  TROLLBACK
  Q "Попытка забрать товар "_Good.FullName_" в количестве "_Amount
   _" ед. из ячейки, в которой "_$S(fromReserve=1:" зарезервировано ",1:"")_amount_" ед."
   _" Выберите другую ячейку"
 }


 #;списать товар с основного или зарезервированного количества
 if 'fromReserve {
   s Portion.Value1=amount-Amount
   s @tempglob@(countmtemp,Good.FullName,"списываем")="С основного"
   
 } else {
   s Portion.Value2=amount-Amount
   s @tempglob@(countmtemp,Good.FullName,"списываем")="С резерва"
 }

 

 

 if Portion.Value2<0
 {
	 TROLLBACK
	 
	 q "Извините, невозможно списать товар с резерва "_Good.FullName_" так как при количестве "_Amount_" ("_Need_") резерв может стать меньше нуля: "_Portion.Value2
 }
 
 if Portion.Value1<0
 {
	 TROLLBACK
	 q "Извините, невозможно списать товар "_Good.FullName_" так как его количество может стать меньше нуля: "_Portion.Value1
 }
 
 s sc=Portion.%Save()
 if 'sc {
  TROLLBACK
  Q "Ошибка при списании товара "_Good.FullName_": "_$system.Status.GetOneErrorText(sc)_" "_Portion.%Id()
 }
 
 #;уменьшить вес и объем ячейки на количество списанного товара
 s cellWeight=Cell.Currentweight, goodWeight=Good.Weight * Amount
 s Cell.Currentweight = cellWeight-goodWeight
 
 s cellSize=Cell.Currentsize, goodSize=Good.Size1 * Amount
 s Cell.Currentsize=cellSize-goodSize
 
 s sc=Cell.%Save()
 
 #; обработка результатов
 if 'sc {
   TROLLBACK  ;вернуть все взад
   Q "При списании товара "_Good.FullName_" произошла обновления свойств ячейки: "_$system.Status.GetOneErrorText(sc)
 }
 
 TCOMMIT
 
 #;сервисная функция
 #;проверить остатки основного и зарезервированного количества
 #;,если нулевые, удалить пустую порцию из ячейки
 if (Portion.Value1=0)&(Portion.Value2=0) {
   d ##class(Store.Quantity).%DeleteId(Portion.%Id())
 }
  
 k Portion,Cell,Good
 Q 1
]]></Implementation>
</Method>

<Method name="RemQuantBrak">
<Description><![CDATA[
Удалить товар из таблицы брака
<br>Goods - товар (ID или объект Goods.Goods)
<br>Address - адрес ячейки (ID или объект Store.Address)
<br>Kontragent - адрес ячейки (ID или объект Store.Address)
<br>Value - количество]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Address,Kontragent,Value=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if Value = 0 q 1
 s $ZT="RemQuantBrakErr"
 if $ISOBJECT(Goods) d
 . s GoodsId=Goods.%Id()
 else  s GoodsId=Goods
 
 if $ISOBJECT(Address) d
 . s AddressId=Address.%Id()
 else  s AddressId=Address
 
 if $ISOBJECT(Address) s Address=Address.%Id()
 &sql(SELECT ID,Qnt 
  INTO :ID,:Qnt 
  FROM Store.Brak 
  WHERE Address=:AddressId 
  AND Goods=:GoodsId 
  AND (Kontr=:Kontragent OR :Kontragent=''))
 
 if SQLCODE q "Невозможно найти "_$$GoodsFullName(Goods)_" по адресу "_##class(Store.Action).AddressPath(AddressId,0)
 if Value>Qnt q "Обнаружена попытка забрать некондиционный товар "_$$GoodsFullName(Goods)_" "_Value_" шт. из ячейки "_##class(Store.Action).AddressPath(AddressId,0)_" в которой "_Qnt_" шт."
 if Value=Qnt &sql(delete From Store.Brak where ID=:ID)
 else  &sql(update Store.Brak set Qnt=Qnt-:Value where ID=:ID)
 if SQLCODE<0 d  q "Извините. Ошибка при списании некондиционного товара."
 . $$$WriteError("SQLCODE="_SQLCODE)
 q 1
GoodsFullName(Goods)
 if '$ISOBJECT(Goods) s Goods=##class(Goods.Goods).%OpenId(GoodsId)
 if '$ISOBJECT(Goods) s GoodsFullName="Неизвестный товар "_Goods
 else  set GoodsFullName=Goods.FullName 
 q GoodsFullName
RemQuantBrakErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при списании некондиционного товара."
]]></Implementation>
</Method>

<Method name="GetQuantByGoods">
<Description><![CDATA[
Получить количество по ID товара
<br><var>goods</var> - ID Товара
<br><var>quant</var> - количество Товара]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[goods,&quant]]></FormalSpec>
<Implementation><![CDATA[
 s $ZT="GetQuantByGoodsErr"
 &sql(declare zzz cursor for select Address->Depot As depot,Value1,Value2 into :depot,:Value,:Value2 from Store.Quantity where Goods=:goods)
 &sql(open zzz)
 &sql(FETCH zzz)
 While (SQLCODE = 0) {
  s quant=$G(quant)+Value
  s quant(depot)=$G(quant(depot))+Value
  s quant(depot,"rezerv")=$G(quant(depot,"rezerv"))+Value2
  &sql(FETCH zzz)
 }
 &sql(close zzz)
 q 1
GetQuantByGoodsErr
 $$$WriteError($ZE)
 q "Ошибка при подсчёте количества"
]]></Implementation>
</Method>

<Method name="getquantaddr">
<Description><![CDATA[
Получить количество товара в ячейке
<br><var>goods</var> - ID Товара
<br><var>addr</var> - ID ячейки]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>goods,addr</FormalSpec>
<Implementation><![CDATA[
 &sql(select Value1 into :Value1 from Store.Quantity where Address=:addr and Goods=:goods)
 i SQLCODE $$$WriteError("getquantaddr SQLCODE="_SQLCODE) q 0
 q Value1
]]></Implementation>
</Method>

<Method name="validate">
<Description><![CDATA[
Подтвердить возможность доложить товар в ячейку
<br><var>Goods</var> - товар (ID или объект)
<br><var>Address</var> - адрес (ID или объект)
<br><var>Value</var> - количество]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Address,Value</FormalSpec>
<Implementation><![CDATA[
 s $ZT="validateErr"
 i $isobject($G(%session)) d
 . s user=$G(%session.Data("user"),"undef")
 e  d
 . s user="undef"
 s:'$ISOBJECT(Goods) Goods=##class(Goods.Goods).%OpenId(Goods)
 i '$ISOBJECT(Address) d
 . s Address=##class(Store.Address).%OpenId(Address)
 . s savetemp=1 //метод вызван с использованием id ячейки, стало быть со страницы
 e  s savetemp=0 //метод вызван с использованием объекта ячейки, стало быть из метода сохранения остатков
 s AddressId=Address.%Id()
 s goodsize=Goods.Size1
 s goodweight=Goods.Weight
 s goodname=Goods.Name
 s maxsize=Address.Size1
 s currentsize=Address.Currentsize+$G(^mtempAddress(user,AddressId,"size"))
 s maxweight=Address.Weight
 s currentweight=Address.Currentweight+$G(^mtempAddress(user,AddressId,"weight"))
 s sizevalid=1,weightvalid=1
 i (goodsize'="")&(maxsize'=""){
  i (goodsize*Value)+currentsize>maxsize s sizevalid="Текущий объём ячейки ("_currentsize_") плюс объём товара "_goodname_" ("_(goodsize*Value)_") превышает максимально возможный объём ячейки ("_maxsize_") с адресом "_..AddressPath(Address)
 }
 i (goodweight'="")&(maxweight'=""){
  i (goodweight*Value)+currentweight>maxweight s weightvalid="Текущий вес товара в ячейке ("_currentweight_") плюс вес товара "_goodname_" ("_(goodweight*Value)_") превышает максимально возможный вес для ячейки ("_maxweight_") с адресом "_..AddressPath(Address)
 }
 i sizevalid&weightvalid d
 . s ret=1
 . s:savetemp ^mtempAddress(user,AddressId,"weight")=(goodweight*Value)+$G(^mtempAddress(user,AddressId,"weight"))
 . s:savetemp ^mtempAddress(user,AddressId,"size")=(goodsize*Value)+$G(^mtempAddress(user,AddressId,"size"))
 i ('+sizevalid)&('+weightvalid) q sizevalid_" а также "_weightvalid
 i '+sizevalid q sizevalid
 i '+weightvalid q weightvalid
 q 1
validateErr
 $$$WriteError($ZE)
 q "Извините. При проверке условий записи остатков произошла ошибка."
]]></Implementation>
</Method>

<Method name="KillTempAddress">
<Description>
Убить временную глобаль</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 k ^mtempAddress($G(%session.Data("user"),"undef"))
 q
]]></Implementation>
</Method>

<Method name="AddressPath">
<Description><![CDATA[
Вернуть строку состоящую из ячеек-родителей данной ячейки
<br><var></var> - ячейка (ID или объект)
<br><var>addtag</var> - добавлять HTML таги к имени]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>AddressId,addtag:%Boolean=0</FormalSpec>
<Implementation><![CDATA[
 i $ISOBJECT(AddressId) s addr=AddressId
 e  s addr=##class(Store.Address).%OpenId(AddressId)
 i '$ISOBJECT(addr) q ""
 if $ISOBJECT($G(%session)) d
 . s delimeter=$G(%session.Data("addressdelim")," - ")
 e  s delimeter="-"
 s Depot=addr.Depot.%Id()
 s Parent=addr.Parent
 i addtag s str="<b><u>"_addr.Name_"</u></b>"
 e  s str=addr.Name
 while (Parent'=""){
 &sql(select Parent,Name into :Parent,:Name from Store.Address where Code=:Parent and Depot=:Depot)
 q:SQLCODE
 i $I(count)
 s str(count)=Name_delimeter
 
 }
 s i="" f  s i=$O(str(i)) q:i=""  d
 . s str=str(i)_str
 q str
]]></Implementation>
</Method>

<Method name="SetPrice">
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods,Price,typcen,Dat="",Tim=""</FormalSpec>
<Implementation><![CDATA[
 s $ZT="SetPriceErr"
 s:Dat="" Dat=+$H
 s:Tim="" Tim=$P($H,",",2)
 s prc=##class(Store.Price).%New()
 s prc.Price=+Price
 s prc.Tim=+Tim
 s prc.Dat=+Dat
 d prc.typcenSetObjectId(typcen)
 //d prc.StrSetObjectId(TovStr)
 d prc.GoodsSetObjectId(Goods)
 //d prc.DepotSetObjectId(Depot)
 s ok=prc.%Save()
 i '+ok $$$WriteObjError(ok) q "Извините. При записи цены возникла ошибка."
 q 1
SetPriceErr
 $$$WriteError($ZE)
 q "Извините. При записи цены возникла ошибка."
]]></Implementation>
</Method>

<Method name="getlastcena">
<ClassMethod>1</ClassMethod>
<FormalSpec>Goods</FormalSpec>
<Implementation><![CDATA[
 q:Goods="" 0
 &sql(select max(Dat) into :Dat from Store.Price where Goods=:Goods)
 i SQLCODE=100 q $$FindGoodsPrice(Goods)
 &sql(select max(Tim) into :Tim from Store.Price where Goods=:Goods)
 i SQLCODE=100 q $$FindGoodsPrice(Goods)
 &sql(select Price into :Price from Store.Price  where Goods=:Goods and Dat=:Dat and Tim=:Tim)
 i SQLCODE=100 q $$FindGoodsPrice(Goods)
 q Price
FindGoodsPrice(Goods)
 &sql(select Price into :Price from Goods.Goods where ID=:Goods)
 i 'SQLCODE q Price
 e  q 0
]]></Implementation>
</Method>

<Method name="CellsMultiChange">
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlstream="",docid="",documentclass</FormalSpec>
<Implementation><![CDATA[
 s ok=##class(Docs.Action).parsexml(xmlstream,docid,documentclass,.types,.DocData)
 q:'+ok ok
 s ok=..savemulticell(documentclass, DocData, .types)
 q:'+ok ok
 q ok
]]></Implementation>
</Method>

<Method name="savemulticell">
<ClassMethod>1</ClassMethod>
<FormalSpec>documentclass,DocData,types</FormalSpec>
<Implementation><![CDATA[
 s addr=@DocData
 i addr="" $$$WriteError("savemulticell Не указана ячейка") q
 s addrobj=##class(Store.Address).%OpenId(addr)
 i '$ISOBJECT(addrobj) $$$WriteError("savemulticell не удалось открыть ячейку id="_addr) q
 s depot=addrobj.Depot.%Id()
 s code=addrobj.Code
 k addrobj
 s i="" f  s i=$O(@DocData@("head",i)) q:i=""  d
 . s text=$G(@DocData@("head",i))
 . i text="" q
 . s str=$G(str)_i_"='"_text_"', "
 s str=$E(str,1,$L(str)-2)
 i str="" q
 s rs=##class(%Library.ResultSet).%New()
 s sql="UPDATE Store.Address set "_str_" where Depot="_depot_" and Parent %STARTSWITH '"_code_"'"
 s ok=rs.Prepare(sql)
 i '+ok $$$WriteObjError(ok) q "Извините, при сохранении параметров вознкла ошибка"
 s ok=rs.Execute()
 i '+ok $$$WriteObjError(ok) q "Извините, при сохранении параметров вознкла ошибка"
 q 1
]]></Implementation>
</Method>

<Method name="deletecell">
<ClassMethod>1</ClassMethod>
<FormalSpec>cid</FormalSpec>
<Implementation><![CDATA[
  q:cid="" "Не указан код ячейки"
  
  s cell=##class(Store.Address).%OpenId(cid)
  q:'$ISOBJECT(cell) "Не удалось найти ячейку с указанным кодом"
  i cell.Currentsize>0 q "Невозможно удалить заполненную ячейку"
  i cell.Currentweight>0 q "Невозможно удалить заполненную ячейку"
  s code=cell.Code
  &sql(select count(ID) into :count from Store.Address where Parent=:code)
  i count>0 q "Невозможно удалить ячейку содержащую другие ячейки"
  &sql(select Sum(Value1) into :summa from Store.Quantity where Address=:cid)
  i (summa>0)&('SQLCODE) q "Невозможно удалить заполненную ячейку"
  &sql(delete from Store.Quantity where Address=:cid)
  i SQLCODE<0 $$$WriteError("1 deletecell cid="_cid_" SQLCODE="_SQLCODE) q "Извините, внутренняя ошибка при удалении ячейки"
  &sql(delete from Store.Address where ID=:cid)
  i SQLCODE<0 $$$WriteError("1 deletecell cid="_cid_" SQLCODE="_SQLCODE) q "Извините, внутренняя ошибка при удалении ячейки"
  q 1
]]></Implementation>
</Method>

<Method name="changename">
<ClassMethod>1</ClassMethod>
<FormalSpec>cid,newname</FormalSpec>
<Implementation><![CDATA[
 q:cid=""
 s cell=##class(Store.Address).%OpenId(cid)
 q:'$ISOBJECT(cell)
 s cell.Name=newname
 d cell.%Save()
 q
]]></Implementation>
</Method>

<Method name="GetAddrByTovar">
<ClassMethod>1</ClassMethod>
<FormalSpec>goodsid,q1,q2</FormalSpec>
<Implementation><![CDATA[
  $$$StartXML
  s sc=xmlstr.Element("AllHeaders")
   $$$WriteHeader("skl","Склад",80)
   $$$WriteHeader("addr","Адрес",150)
   $$$WriteHeader("kol","Количество",80)
  s sc=xmlstr.EndElement()
   s sc=xmlstr.Element("AllObjects")
    s rs=##class(%Library.ResultSet).%New()
    s sql="select Address->Depot->Name as depnam,Address,Value1 from Store.Quantity where Goods="_goodsid
    s ok=rs.Prepare(sql)
    i '+ok $$$WriteObjError(ok) d  q
    . s sc=xmlstr.EndElement()
    . $$$EndXML
    s ok=rs.Execute()
    i '+ok $$$WriteObjError(ok) d  q
    . s sc=xmlstr.EndElement()
    . $$$EndXML
    While rs.Next() {
      s sc=xmlstr.Element("OneObject")
      s addr=$G(rs.Data("Address"))
      s addrpath=##class(Store.Action).AddressPath(addr)
    $$$WriteElementTwice("skl",$G(rs.Data("depnam")))
    $$$WriteElementTwice("addr",addrpath)
      $$$WriteElementTwice("kol",$G(rs.Data("Value1")))
      s sc=xmlstr.EndElement()
    }
  s sc=xmlstr.EndElement()
  $$$EndXML
 q 1
]]></Implementation>
</Method>

<Method name="recalcstore">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 s $ZT="recalcstoreErr"
 &sql(update Store.Address set Currentsize=0,Currentweight=0)
  &sql(declare dd cursor for 
 select Address,Address->Currentsize,Address->Currentweight,Goods,Goods->Size1,Value1,Goods->Weight
 into :addr,:addrsize,:addrweight,:goods,:goodssize,:value1,:Weight
 from Store.Quantity)
 &sql(open dd)
 f  &sql(fetch dd) q:SQLCODE  d
 . s address=##class(Store.Address).%OpenId(addr)
 . s address.Currentsize=addrsize+(goodssize*value1)
 . s address.Currentweight=addrweight+(Weight*value1)
 . d address.%Save()
 . k address
 &sql(close dd)
 q 1
recalcstoreErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="ClearCell">
<ClassMethod>1</ClassMethod>
<FormalSpec>cellid,cellcode,depot</FormalSpec>
<Implementation><![CDATA[
 s $ZT="ClearCellErr"
 s err="Извините, ошибка программы при очистке ячейки"
 q:cellid="" err
 d ClearItSelf(cellid)
 &sql(declare gf cursor for 
 select id,code into :cellid,:cd from Store.Address where Parent %STARTSWITH :cellcode and Depot=:depot)
 &sql(open gf)
 f  &sql(fetch gf) q:SQLCODE  d
 . d ClearItSelf(cellid)
 &sql(close gf)
 q 1
ClearCellErr
 $$$WriteError($ZE)
 q "Извините, ошибка программы при очистке ячейки"
ClearItSelf(cell)
 &sql(delete from Store.Quantity where Address=:cell)
 s cellobj=##class(Store.Address).%OpenId(cell)
 d:$ISOBJECT(cellobj)
 . s cellobj.Currentsize=0
 . s cellobj.Currentweight=0
 . d cellobj.%Save()
 q
]]></Implementation>
</Method>

<Method name="BlockCells">
<Description>
Блокировать / разблокировать ячейки</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Cell,Block=0</FormalSpec>
<Implementation><![CDATA[
 s $ZT="BlockCellsErr"
 i '$ISOBJECT(Cell) s addrobj=##class(Store.Address).%OpenId(Cell)
 e  s addrobj=Cell
 i '$ISOBJECT(addrobj) q 1
 s depot=addrobj.Depot.%Id()
 s code=addrobj.Code_"*"
 //блокируем всё подмножество ячеек
 &sql(update Store.Address Set block=:Block where Code %Startswith :code and Depot=:depot)
 q 1
BlockCellsErr
 $$$WriteError($ZE)
 q "Ошибка при блокировке ячеек"
]]></Implementation>
</Method>

<Method name="FindGoodsPlaces">
<Description><![CDATA[
Найти места где расположен товар
<br>GoodsId - Искомый товар
<br>Found - массив с найденными ячейками и количествами
<br>  Found(0,)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[GoodsId:%String,&Found:%String]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 k Found
 s Found=0
 s $ZT="FindGoodsPlacesErr"
 &sql(declare konga cursor for select ID,Value1,Address into :ID,:Value1,:Address from Store.Quantity where Goods=:GoodsId and Value1>0)
 &sql(open konga)
 f  &sql(fetch konga) q:SQLCODE  d
 . i $I(count)
 . s Found(0,Address)=Value1
 . s Found(0,Address,"ID")=ID
 . s Found(1,Value1)=Address
 . s Found(1,Value1,"ID")=ID
 . s Found=Found+Value1
 &sql(close konga)
 q 1
FindGoodsPlacesErr
 $$$WriteError($ZE)
 q "Извините. Ошибка при отборе товара"
]]></Implementation>
</Method>
</Class>


<Class name="Store.Address">
<Description>
Структура адреса</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,64789.414885</TimeCreated>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Depot</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Index name="DepotIndex">
<Properties>Depot</Properties>
</Index>

<Property name="Code">
<Description>
Элемент адреса</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Элемент адреса"/>
</Property>

<Index name="NewIndex1">
<Properties>Code</Properties>
</Index>

<Index name="DepotCodeIDX">
<Description>
Надо сделать уникальным !!!</Description>
<Properties>Depot,Code</Properties>
</Index>

<Method name="GetByCode">
<Description>
Поиск ид по коду</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s id="" &sql(Select ID Into :id From Store.Address Where Code=:code) 
 Q:'SQLCODE id Q ""
]]></Implementation>
</Method>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Index name="NameIDX">
<Description>
Индекс по наименованию</Description>
<Properties>Name</Properties>
</Index>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Parent">
<Description>
Родительский код
Неудачно...</Description>
<Type>%String</Type>
<SqlComputeCode> Set {*} = ##class(Store.Address).GetParent({Code})</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<SqlComputeOnChange>Code</SqlComputeOnChange>
<Parameter name="CAPTION" value="Родитель"/>
</Property>

<Index name="ParentIndex">
<Properties>Parent</Properties>
</Index>

<Method name="GetParent">
<Description>
Вычисление родителя по коду</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s code=$g(code) Q:code="" ""
 Q $P(code,"*",1,$L(code,"*")-1)
]]></Implementation>
</Method>

<Property name="ParentID">
<Description>
Свойство для использования через SQL</Description>
<Type>Store.Address</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}= ##class(Store.Address).GetParentID({Depot},{Code}) </SqlComputeCode>
<SqlComputed>1</SqlComputed>
<SqlComputeOnChange>Code</SqlComputeOnChange>
</Property>

<Method name="GetParentID">
<ClassMethod>1</ClassMethod>
<FormalSpec>depot:%String,code:%String</FormalSpec>
<ReturnType>%Integer</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 s pcode=..GetParent(code) 
 s pid="" &sql(Select TOP 1 ID Into :pid From Store.Address Where Depot=:depot And Code=:pcode)
 Q pid
]]></Implementation>
</Method>

<Index name="ParentIDX">
<Description>
Могут быть проблемы с его перестройкой</Description>
<Properties>ParentID</Properties>
</Index>

<Property name="Percent">
<Description>
Процент заполнения места хранения</Description>
<Type>%Integer</Type>
<Calculated>1</Calculated>
<SqlComputeCode> Set {*}=##class(Store.Address).CalcPercent({CurrentSize},{Size1}) </SqlComputeCode>
<SqlComputed>1</SqlComputed>
</Property>

<Method name="CalcPercent">
<Description>
Расчет процента заполнения</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>part:%String,whole:%String</FormalSpec>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
 q:+$g(part)=0 0
 q:+$g(whole)=0 0
 s perc=part/whole*100
 if perc<0 s perc=perc*-1
 Q +$j(perc,0,0)
]]></Implementation>
</Method>

<Method name="HasChild">
<Description>
Есть дочерние узлы?</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[
 Q:'..%ExistsId(id) 0
 s child="" &sql(Select TOP 1 ID Into :child From Store.Address Where ParentID = :id)
 Q child
]]></Implementation>
</Method>

<Property name="tempstore">
<Description>
Временное хранение</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Временное хранение"/>
</Property>

<Property name="Size1">
<Description>
Максимальный объём ячейки</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Currentsize">
<Description>
Текущий объём ячейки</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Weight">
<Description>
Максимальная нагрузка на ячейку</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Currentweight">
<Description>
Текущая нагрузка на ячейку</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="oldnumb">
<Description>
Старый номер</Description>
<Type>%String</Type>
</Property>

<Property name="speed">
<Description>
Скорость доступа</Description>
<Type>%Numeric</Type>
</Property>

<Index name="speedind">
<Properties>speed</Properties>
</Index>

<Property name="block">
<Description>
Состояние</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Используется,Заблокировано"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Property name="AddressName">
<Description>
Адрес ячейки</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode>Set {AddressName}=##class(Store.Action).AddressPath({ID})</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Query name="Common">
<Type>%SQLQuery</Type>
<FormalSpec>Depot</FormalSpec>
<SqlQuery>SELECT Parent,Code,Name,ID FROM "Address"
where Depot=:Depot
 ORDER BY Code</SqlQuery>
</Query>

<Method name="%OnNew">
<FormalSpec>initvalue:%CacheString</FormalSpec>
<Private>1</Private>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d:$g(initvalue("Depot"))'="" ..DepotSetObjectId($g(initvalue("Depot")))
 s ..Code=$g(initvalue("Code")), ..Name=$g(initvalue("Name"))
 s ..Size1=$g(initvalue("Size1")), ..Weight=$g(initvalue("Weight"))
 s ..Currentsize=$g(initvalue("Currentsize")), ..Currentweight=$g(initvalue("Currentweight"))
 
 Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.AddressD</DataLocation>
<DefaultData>AddressDefaultData</DefaultData>
<IdLocation>^Store.AddressD</IdLocation>
<IndexLocation>^Store.AddressI</IndexLocation>
<StreamLocation>^Store.AddressS</StreamLocation>
<Data name="AddressDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Depot</Value>
</Value>
<Value name="3">
<Value>Zone</Value>
</Value>
<Value name="4">
<Value>Comment</Value>
</Value>
<Value name="5">
<Value>Element</Value>
</Value>
<Value name="6">
<Value>Name</Value>
</Value>
<Value name="7">
<Value>MaxValue</Value>
</Value>
<Value name="8">
<Value>Code</Value>
</Value>
<Value name="9">
<Value>Parent</Value>
</Value>
<Value name="10">
<Value>Draw</Value>
</Value>
<Value name="11">
<Value>tempstore</Value>
</Value>
<Value name="12">
<Value>tempztore</Value>
</Value>
<Value name="13">
<Value>Currentsize</Value>
</Value>
<Value name="14">
<Value>Currentweight</Value>
</Value>
<Value name="15">
<Value>Maxsize</Value>
</Value>
<Value name="16">
<Value>Maxweight</Value>
</Value>
<Value name="17">
<Value>Size</Value>
</Value>
<Value name="18">
<Value>Weight</Value>
</Value>
<Value name="19">
<Value>Size1</Value>
</Value>
<Value name="20">
<Value>oldnumb</Value>
</Value>
<Value name="21">
<Value>speed</Value>
</Value>
<Value name="22">
<Value>block</Value>
</Value>
<Value name="23">
<Value>ParentId</Value>
</Value>
<Value name="24">
<Value>oParent</Value>
</Value>
<Value name="25">
<Value>Parent2</Value>
</Value>
<Value name="26">
<Value>Custom</Value>
</Value>
<Value name="27">
<Value>Test</Value>
</Value>
<Value name="28">
<Value>Percent</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.AddressOld">
<Description>
Структура адреса</Description>
<Super>%Persistent</Super>
<TimeCreated>62301,60132.204748</TimeCreated>

<Property name="Depot">
<Description>
Склад</Description>
<Type>Depot</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Index name="DepotIndex">
<Properties>Depot</Properties>
</Index>

<Property name="Code">
<Description>
Элемент адреса</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Элемент адреса"/>
</Property>

<Index name="NewIndex1">
<Properties>Code</Properties>
</Index>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Parent">
<Description>
Родитель</Description>
<Type>%String</Type>
<SqlComputeCode> Set {*} = $Piece({Code},"*",1,$Length({Code},"*")-1)</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value="Родитель"/>
</Property>

<Index name="ParentIndex">
<Properties>Parent</Properties>
</Index>

<Property name="tempstore">
<Description>
Временное хранение</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Временное хранение"/>
</Property>

<Property name="Size1">
<Description>
Максимальный объём ячейки</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Currentsize">
<Description>
Текущий объём ячейки</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Weight">
<Description>
Максимальная нагрузка на ячейку</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="Currentweight">
<Description>
Текущая нагрузка на ячейку</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="3"/>
</Property>

<Property name="oldnumb">
<Description>
Старый номер</Description>
<Type>%String</Type>
</Property>

<Property name="speed">
<Description>
Скорость доступа</Description>
<Type>%Numeric</Type>
</Property>

<Index name="speedind">
<Properties>speed</Properties>
</Index>

<Property name="block">
<Description>
Состояние</Description>
<Type>%String</Type>
<InitialExpression>1</InitialExpression>
<Parameter name="DISPLAYLIST" value=",Используется,Заблокировано"/>
<Parameter name="VALUELIST" value=",1,0"/>
</Property>

<Property name="AddressName">
<Description>
Адрес ячейки</Description>
<Type>%String</Type>
<Calculated>1</Calculated>
<SqlComputeCode>Set {AddressName}=##class(Store.Action).AddressPath({ID})</SqlComputeCode>
<SqlComputed>1</SqlComputed>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Query name="Common">
<Type>%SQLQuery</Type>
<FormalSpec>Depot</FormalSpec>
<SqlQuery>SELECT Parent,Code,Name,ID FROM "Address"
where Depot=:Depot
 ORDER BY Code</SqlQuery>
</Query>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.AddressOldD</DataLocation>
<DefaultData>AddressOldDefaultData</DefaultData>
<IdLocation>^Store.AddressOldD</IdLocation>
<IndexLocation>^Store.AddressOldI</IndexLocation>
<StreamLocation>^Store.AddressOldS</StreamLocation>
<Data name="AddressOldDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>block</Value>
</Value>
<Value name="3">
<Value>Code</Value>
</Value>
<Value name="4">
<Value>Comment</Value>
</Value>
<Value name="5">
<Value>Currentsize</Value>
</Value>
<Value name="6">
<Value>Currentweight</Value>
</Value>
<Value name="7">
<Value>Depot</Value>
</Value>
<Value name="8">
<Value>Name</Value>
</Value>
<Value name="9">
<Value>oldnumb</Value>
</Value>
<Value name="10">
<Value>Parent</Value>
</Value>
<Value name="11">
<Value>Size1</Value>
</Value>
<Value name="12">
<Value>speed</Value>
</Value>
<Value name="13">
<Value>tempstore</Value>
</Value>
<Value name="14">
<Value>Weight</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Brak">
<Description>
Брак</Description>
<Super>%Persistent</Super>
<TimeCreated>60955,53796.276033</TimeCreated>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
</Property>

<Index name="GoodsInd">
<Properties>Goods</Properties>
</Index>

<Property name="Address">
<Description>
Место на складе</Description>
<Type>Store.Address</Type>
</Property>

<Index name="AddressInd">
<Properties>Address</Properties>
</Index>

<Property name="Qnt">
<Description>
Количество</Description>
<Type>%Numeric</Type>
</Property>

<Property name="SourceDoc">
<Description>
Документ - основание приёма</Description>
<Type>Docs.Super</Type>
</Property>

<Index name="SourceDocInd">
<Properties>SourceDoc</Properties>
</Index>

<Property name="Kontr">
<Description>
Контрагент</Description>
<Type>Common.Kontragent</Type>
</Property>

<Index name="Kontragent">
<Properties>Kontr</Properties>
</Index>

<Index name="NewIndex1">
<Data>Qnt</Data>
<Properties>Goods,Address,Kontr</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.BrakD</DataLocation>
<DefaultData>BrakDefaultData</DefaultData>
<IdLocation>^Store.BrakD</IdLocation>
<IndexLocation>^Store.BrakI</IndexLocation>
<StreamLocation>^Store.BrakS</StreamLocation>
<Data name="BrakDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Address</Value>
</Value>
<Value name="3">
<Value>Goods</Value>
</Value>
<Value name="4">
<Value>Qnt</Value>
</Value>
<Value name="5">
<Value>SourceDoc</Value>
</Value>
<Value name="6">
<Value>Kontragent</Value>
</Value>
<Value name="7">
<Value>Kontr</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Cell">
<Super>%Persistent</Super>
<TimeCreated>60319,65466.449598</TimeCreated>

<Property name="Address">
<Description>
Адрес ячейки</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Адрес ячейки"/>
</Property>

<Index name="AddressIndex">
<Properties>Address</Properties>
</Index>

<Property name="Paramater">
<Description>
Параметр хранения</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Параметр хранения"/>
</Property>

<Property name="Value">
<Description>
Значение</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Значение"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.CellD</DataLocation>
<DefaultData>CellDefaultData</DefaultData>
<IdLocation>^Store.CellD</IdLocation>
<IndexLocation>^Store.CellI</IndexLocation>
<StreamLocation>^Store.CellS</StreamLocation>
<Data name="CellDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Address</Value>
</Value>
<Value name="3">
<Value>Paramater</Value>
</Value>
<Value name="4">
<Value>Value</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Depot">
<Description>
Склады</Description>
<Super>%Persistent,%XML.Adaptor</Super>
<TimeCreated>60319,62879.753586</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
</Property>

<Property name="Comment">
<Description>
Описание</Description>
<Type>%String</Type>
</Property>

<Query name="Common">
<Type>%SQLQuery</Type>
<SqlQuery>SELECT %ID,Name,Comment FROM Depot
 ORDER BY Name</SqlQuery>
<Parameter name="CONTAINID" value="1"/>
</Query>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.DepotD</DataLocation>
<DefaultData>DepotDefaultData</DefaultData>
<IdLocation>^Store.DepotD</IdLocation>
<IndexLocation>^Store.DepotI</IndexLocation>
<StreamLocation>^Store.DepotS</StreamLocation>
<Data name="DepotDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comment</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.GarantAction">
<Description>
Действия с гарантийными талонами</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%RegisteredObject</Super>
<TimeCreated>61344,42762.339015</TimeCreated>

<Method name="CheckSerialAndGarantNumber">
<Description>
Проверить соответствие гарантийного номера и серийного номера</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Garant:%String="",Serial:%String="",&ErrorText:%String="",&IsActual:%Boolean]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 if Garant="" q 0
 s SerialInBase = ##class(Common.Dictionary2).GetPropertyValue(Garant,"serial")
 if SerialInBase'="",Serial'=SerialInBase q 0
 q
]]></Implementation>
</Method>

<Method name="SetGarantNotActual">
<Description>
Пометить гарантийный как недействительный</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Garant:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 if Garant="" q
 s return = 1
 s Property9194ListIndex = ##class(Common.Dictionary2).GetPropertyListIndex("Property9194",.DataLocation,.IndexLocation)
 //поле Актуальность
 if $D(@DataLocation@(Garant)) d
 . s $LIST(@DataLocation@(Garant),Property9194ListIndex)=2
 else  d
 . s obj=##class(Common.Dictionary2).%New()
 . s obj.Name = Garant
 . s obj.Property9194 = 2
 . s ok = obj.%Save()
 . if $$$ISERR(ok) d
 . . s return = "Извините, ошибка при установке актуальности гарантийного талона "_Garant
 . . $$$WriteObjError(ok)
 q return
]]></Implementation>
</Method>
</Class>


<Class name="Store.Measures">
<Super>%Persistent</Super>
<TimeCreated>60386,83433.772024</TimeCreated>

<Property name="Type">
<Description>
Тип</Description>
<Type>%String</Type>
</Property>

<Index name="TypeInd">
<Properties>Type</Properties>
</Index>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
</Property>

<Property name="Factor">
<Description>
Коэффициент</Description>
<Type>%Numeric</Type>
<Parameter name="SCALE" value="6"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.MeasuresD</DataLocation>
<DefaultData>MeasuresDefaultData</DefaultData>
<IdLocation>^Store.MeasuresD</IdLocation>
<IndexLocation>^Store.MeasuresI</IndexLocation>
<StreamLocation>^Store.MeasuresS</StreamLocation>
<Data name="MeasuresDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Factor</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Type</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Params">
<Description>
Параметры хранения</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,67195.774833</TimeCreated>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование"/>
</Property>

<Property name="Comments">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Type">
<Description>
Тип</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Тип"/>
<Parameter name="DISPLAYLIST" value=",Числовой,Строчный"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="TypeIndex">
<Properties>Type</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.ParamsD</DataLocation>
<DefaultData>ParamsDefaultData</DefaultData>
<IdLocation>^Store.ParamsD</IdLocation>
<IndexLocation>^Store.ParamsI</IndexLocation>
<StreamLocation>^Store.ParamsS</StreamLocation>
<Data name="ParamsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Comments</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Type</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Price">
<Description>
Справочник цен</Description>
<Super>%Persistent</Super>
<TimeCreated>60380,69054.322077</TimeCreated>

<Property name="Price">
<Description>
Цена</Description>
<Type>%Numeric</Type>
</Property>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
</Property>

<Property name="typcen">
<Description>
Тип цены</Description>
<Type>Common.Dictionary6</Type>
</Property>

<Index name="typcenind">
<Properties>typcen</Properties>
</Index>

<Property name="Dat">
<Description>
Дата</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="Datind">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время</Description>
<Type>%Time</Type>
<InitialExpression>$PIECE($H,",",2)</InitialExpression>
</Property>

<Index name="Timind">
<Properties>Tim</Properties>
</Index>

<Property name="User1">
<Description>
Оператор</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="main">
<Data>Price</Data>
<Properties>Goods,typcen,Dat,Tim</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.PriceD</DataLocation>
<DefaultData>PriceDefaultData</DefaultData>
<IdLocation>^Store.PriceD</IdLocation>
<IndexLocation>^Store.PriceI</IndexLocation>
<StreamLocation>^Store.PriceS</StreamLocation>
<Data name="PriceDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Dat</Value>
</Value>
<Value name="3">
<Value>Goods</Value>
</Value>
<Value name="4">
<Value>Price</Value>
</Value>
<Value name="5">
<Value>Str</Value>
</Value>
<Value name="6">
<Value>Tim</Value>
</Value>
<Value name="7">
<Value>Depot</Value>
</Value>
<Value name="8">
<Value>typcen</Value>
</Value>
<Value name="9">
<Value>User1</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Quantity">
<Description>
Количество товара в данной ячейке</Description>
<Super>%Persistent</Super>
<TimeCreated>60320,38564.55821</TimeCreated>

<Property name="Address">
<Description>
Адрес</Description>
<Type>Store.Address</Type>
<Required>1</Required>
<Parameter name="CAPTION" value="Адрес"/>
</Property>

<Index name="AddressIndex">
<Properties>Address</Properties>
</Index>

<Property name="Goods">
<Description>
Товар</Description>
<Type>Goods.Goods</Type>
<Parameter name="CAPTION" value="Товар"/>
</Property>

<Index name="GoodsIndex">
<Properties>Goods</Properties>
</Index>

<Property name="Value1">
<Description>
Количество товара</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Количество"/>
</Property>

<Property name="Value2">
<Description>
Зарезервировано</Description>
<Type>%String</Type>
<InitialExpression>0</InitialExpression>
<Parameter name="CAPTION" value="Зарезервировано"/>
</Property>

<Method name="%OnBeforeSave">
<Description><![CDATA[
This callback method is invoked by the <METHOD>%Save</METHOD> method to 
provide notification that the object is being saved. It is called before 
any data is written to disk.

<P><VAR>insert</VAR> will be set to 1 if this object is being saved for the first time.

<P>If this method returns an error then the call to <METHOD>%Save</METHOD> will fail.]]></Description>
<FormalSpec>insert:%Boolean</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if %this.Value1<0 q '$$$OK
	if %this.Value2<0 q '$$$OK
	Quit $$$OK
]]></Implementation>
</Method>

<Index name="GoodAddrUnique">
<Description>
Уникальность товара и адреса</Description>
<Properties>Goods,Address</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.QuantityD</DataLocation>
<DefaultData>QuantityDefaultData</DefaultData>
<IdLocation>^Store.QuantityD</IdLocation>
<IndexLocation>^Store.QuantityI</IndexLocation>
<StreamLocation>^Store.QuantityS</StreamLocation>
<Data name="QuantityDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Address</Value>
</Value>
<Value name="3">
<Value>Goods</Value>
</Value>
<Value name="4">
<Value>Value</Value>
</Value>
<Value name="5">
<Value>UpakValue</Value>
</Value>
<Value name="6">
<Value>Value1</Value>
</Value>
<Value name="7">
<Value>Value2</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Store.Zone">
<Description>
Зоны складов</Description>
<Super>%Persistent</Super>
<TimeCreated>60319,63086.724572</TimeCreated>

<Property name="Depot">
<Description>
Склад которому принадлежит зона</Description>
<Type>Depot</Type>
<Parameter name="CAPTION" value="Склад"/>
</Property>

<Property name="Name">
<Description>
Наименование зоны</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Наименование зоны"/>
</Property>

<Property name="Comment">
<Description>
Справочная информация</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Справочная информация"/>
</Property>

<Property name="Type">
<Description>
Тип</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value="Тип"/>
</Property>

<Index name="DepotIndex">
<Properties>Depot</Properties>
</Index>

<Index name="TypeIndex">
<Properties>Type</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Store.ZoneD</DataLocation>
<DefaultData>ZoneDefaultData</DefaultData>
<IdLocation>^Store.ZoneD</IdLocation>
<IndexLocation>^Store.ZoneI</IndexLocation>
<StreamLocation>^Store.ZoneS</StreamLocation>
<Data name="ZoneDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Depot</Value>
</Value>
<Value name="3">
<Value>Name</Value>
</Value>
<Value name="4">
<Value>Comment</Value>
</Value>
<Value name="5">
<Value>Type</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="User.instument">
<Description>
</Description>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>_SYSTEM</Owner>
<ProcedureBlock>0</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>instument</SqlTableName>
<StorageStrategy/>
<Super>%Persistent</Super>
<TimeCreated>60541,57163.508644</TimeCreated>

<Property name="ID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="price">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^User.instumentD</DataLocation>
<DefaultData>instumentDefaultData</DefaultData>
<IdLocation>^User.instumentD</IdLocation>
<IndexLocation>^User.instumentI</IndexLocation>
<StreamLocation>^User.instumentS</StreamLocation>
<Data name="instumentDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>ID</Value>
</Value>
<Value name="3">
<Value>price</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="User.REGION">
<Description>
</Description>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>_SYSTEM</Owner>
<ProcedureBlock>0</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>REGION</SqlTableName>
<StorageStrategy/>
<Super>%Persistent</Super>
<TimeCreated>60541,36909.183598</TimeCreated>

<Method name="%ResolveConcurrencyConflict">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[oid:%ObjectIdentity,objSS:%SYNC.SyncSet,iPtr:%Integer,&bAcceptYours:%Boolean=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ q 1
]]></Implementation>
</Method>

<Parameter name="GUIDENABLED">
<Default>1</Default>
</Parameter>

<Parameter name="OBJJOURNAL">
<Default>1</Default>
</Parameter>

<Property name="KOD">
<Description>
Код 1</Description>
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="KODind">
<Properties>KOD</Properties>
</Index>

<Property name="KOD1">
<Description>
Код 2</Description>
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="KOD1ind">
<Properties>KOD1</Properties>
</Index>

<Property name="KOD2">
<Description>
Код 3</Description>
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="KOD2ind">
<Properties>KOD2</Properties>
</Index>

<Property name="Name">
<Description>
Наименование</Description>
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>5</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Index name="NameInd">
<Properties>Name</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^User.REGIOND</DataLocation>
<DefaultData>REGIONDefaultData</DefaultData>
<IdLocation>^User.REGIOND</IdLocation>
<IndexLocation>^User.REGIONI</IndexLocation>
<StreamLocation>^User.REGIONS</StreamLocation>
<Data name="REGIONDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>KOD</Value>
</Value>
<Value name="3">
<Value>KOD1</Value>
</Value>
<Value name="4">
<Value>KOD2</Value>
</Value>
<Value name="5">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="User.Settings">
<Super>%Persistent</Super>
<TimeCreated>63023,67452.862811</TimeCreated>

<Property name="User1">
<Type>Users.Dates</Type>
</Property>

<Property name="SettingName">
</Property>

<Property name="SettingValue">
<Type>%String</Type>
<Parameter name="MAXLEN" value="3000"/>
</Property>

<Method name="GetSettingValue">
<Description>
Получить значение настройки для текущего пользователя</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SettingName</FormalSpec>
<Implementation><![CDATA[
	s SessionUser = $S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")
	if SessionUser="" q ""
	
	&sql(select SettingValue
		into :SettingValue
		from Settings
		where SettingName = :SettingName
			and User1=:SessionUser)
	if SQLCODE s SettingValue=""
	
	q SettingValue
]]></Implementation>
</Method>

<Method name="SetSettingValue">
<Description>
Установить значение настройки для текущего пользователя</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SettingName,SettingValue</FormalSpec>
<Implementation><![CDATA[
	s SessionUser = $S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:77)
	if SessionUser="" q ""
	
	&sql(select id into :id 
		from Settings 
		where SettingName = :SettingName
			and User1=:SessionUser)
			
	if SQLCODE
	{
		&sql(insert into Settings 
		(SettingName,SettingValue,User1)
		VALUES
		(:SettingName,:SettingValue,:SessionUser))
	}
	else
	{
		&sql(update Settings Set
			SettingName = :SettingName,
			SettingValue = :SettingValue,
			User1 = :SessionUser
			where id=:id)
	}
	
	q
]]></Implementation>
</Method>

<Index name="NewIndex1">
<Data>SettingValue</Data>
<Properties>User1,SettingName</Properties>
<Unique>1</Unique>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^User.SettingsD</DataLocation>
<DefaultData>SettingsDefaultData</DefaultData>
<IdLocation>^User.SettingsD</IdLocation>
<IndexLocation>^User.SettingsI</IndexLocation>
<StreamLocation>^User.SettingsS</StreamLocation>
<Data name="SettingsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>SettingName</Value>
</Value>
<Value name="3">
<Value>SettingValue</Value>
</Value>
<Value name="4">
<Value>User1</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="User.TOV">
<Description>
</Description>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>_SYSTEM</Owner>
<ProcedureBlock>0</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>TOV</SqlTableName>
<StorageStrategy/>
<Super>%Persistent</Super>
<TimeCreated>60506,58007.616752</TimeCreated>

<Property name="ABLACK">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>34</SqlColumnNumber>
<SqlFieldName>A_BLACK</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ACCID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>9</SqlColumnNumber>
<SqlFieldName>ACC_ID</SqlFieldName>
<Parameter name="MAXLEN" value="30"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AIBAL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>45</SqlColumnNumber>
<SqlFieldName>A_IBAL</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AICONS">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>41</SqlColumnNumber>
<SqlFieldName>A_ICONS</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AIFIN">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>44</SqlColumnNumber>
<SqlFieldName>A_IFIN</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AIMAIN">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>42</SqlColumnNumber>
<SqlFieldName>A_IMAIN</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AINAKL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>43</SqlColumnNumber>
<SqlFieldName>A_INAKL</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AMINREM">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>35</SqlColumnNumber>
<SqlFieldName>A_MINREM</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ANUM">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>32</SqlColumnNumber>
<SqlFieldName>A_NUM</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ANUMBOX">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>33</SqlColumnNumber>
<SqlFieldName>A_NUMBOX</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AOBAL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>40</SqlColumnNumber>
<SqlFieldName>A_OBAL</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AOCONS">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>36</SqlColumnNumber>
<SqlFieldName>A_OCONS</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AOFIN">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>39</SqlColumnNumber>
<SqlFieldName>A_OFIN</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AOMAIN">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>37</SqlColumnNumber>
<SqlFieldName>A_OMAIN</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="AONAKL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>38</SqlColumnNumber>
<SqlFieldName>A_ONAKL</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ARTICLE">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>20</SqlColumnNumber>
<Parameter name="MAXLEN" value="20"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="BBLACK">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>29</SqlColumnNumber>
<SqlFieldName>B_BLACK</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="BICONS">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>31</SqlColumnNumber>
<SqlFieldName>B_ICONS</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="BNUM">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>28</SqlColumnNumber>
<SqlFieldName>B_NUM</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="BOCONS">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>30</SqlColumnNumber>
<SqlFieldName>B_OCONS</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CLASSID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>7</SqlColumnNumber>
<SqlFieldName>CLASS_ID</SqlFieldName>
<Parameter name="MAXLEN" value="21"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CODE">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>6</SqlColumnNumber>
<Parameter name="MAXLEN" value="20"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CODE1">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>21</SqlColumnNumber>
<Parameter name="MAXLEN" value="20"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="COUNTRY">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>62</SqlColumnNumber>
<Parameter name="MAXLEN" value="30"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="DCOST">
<Type>%Library.TimeStamp</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>14</SqlColumnNumber>
<SqlFieldName>D_COST</SqlFieldName>
</Property>

<Property name="DPRICE">
<Type>%Library.TimeStamp</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>13</SqlColumnNumber>
<SqlFieldName>D_PRICE</SqlFieldName>
</Property>

<Property name="DTOV">
<Type>%Library.TimeStamp</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>12</SqlColumnNumber>
<SqlFieldName>D_TOV</SqlFieldName>
</Property>

<Property name="DUPDATE">
<Type>%Library.TimeStamp</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>11</SqlColumnNumber>
<SqlFieldName>D_UPDATE</SqlFieldName>
</Property>

<Property name="GTD">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>63</SqlColumnNumber>
<Parameter name="MAXLEN" value="26"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LABEL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>5</SqlColumnNumber>
<Parameter name="MAXLEN" value="20"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LBOX">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>19</SqlColumnNumber>
<SqlFieldName>L_BOX</SqlFieldName>
</Property>

<Property name="LCOSTNDS">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>17</SqlColumnNumber>
<SqlFieldName>L_COSTNDS</SqlFieldName>
</Property>

<Property name="LDEL">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>60</SqlColumnNumber>
<SqlFieldName>L_DEL</SqlFieldName>
</Property>

<Property name="LPRICE">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>15</SqlColumnNumber>
<SqlFieldName>L_PRICE</SqlFieldName>
</Property>

<Property name="LPRICENDS">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>18</SqlColumnNumber>
<SqlFieldName>L_PRICENDS</SqlFieldName>
</Property>

<Property name="LSHORT">
<Type>%Library.Boolean</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>16</SqlColumnNumber>
<SqlFieldName>L_SHORT</SqlFieldName>
</Property>

<Property name="MINBOX">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>23</SqlColumnNumber>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="NAME">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="100"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="NNETTO">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>46</SqlColumnNumber>
<SqlFieldName>N_NETTO</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ONENAME">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>22</SqlColumnNumber>
<SqlFieldName>ONE_NAME</SqlFieldName>
<Parameter name="MAXLEN" value="8"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PNDS">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>24</SqlColumnNumber>
<SqlFieldName>P_NDS</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PSALENAL">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>26</SqlColumnNumber>
<SqlFieldName>P_SALENAL</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PSPEC">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>25</SqlColumnNumber>
<SqlFieldName>P_SPEC</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="PTORG">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>27</SqlColumnNumber>
<SqlFieldName>P_TORG</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="RCOST">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>47</SqlColumnNumber>
<SqlFieldName>R_COST</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="RPRCDO">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>49</SqlColumnNumber>
<SqlFieldName>R_PRCDO</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="RPRCUP">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>50</SqlColumnNumber>
<SqlFieldName>R_PRCUP</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="RPRICE">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>48</SqlColumnNumber>
<SqlFieldName>R_PRICE</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="TSEND">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>61</SqlColumnNumber>
<SqlFieldName>T_SEND</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="TYPE">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VALID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>8</SqlColumnNumber>
<SqlFieldName>VAL_ID</SqlFieldName>
<Parameter name="MAXLEN" value="6"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VCOST">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>51</SqlColumnNumber>
<SqlFieldName>V_COST</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRCDO">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>58</SqlColumnNumber>
<SqlFieldName>V_PRCDO</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRCUP">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>59</SqlColumnNumber>
<SqlFieldName>V_PRCUP</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>52</SqlColumnNumber>
<SqlFieldName>V_PRICE</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE1">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>53</SqlColumnNumber>
<SqlFieldName>V_PRICE1</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE2">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>54</SqlColumnNumber>
<SqlFieldName>V_PRICE2</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE3">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>55</SqlColumnNumber>
<SqlFieldName>V_PRICE3</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE4">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>56</SqlColumnNumber>
<SqlFieldName>V_PRICE4</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="VPRICE5">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>57</SqlColumnNumber>
<SqlFieldName>V_PRICE5</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="WORKID">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>10</SqlColumnNumber>
<SqlFieldName>WORK_ID</SqlFieldName>
<Parameter name="MAXLEN" value="4"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^User.TOVD</DataLocation>
<DefaultData>TOVDefaultData</DefaultData>
<IdLocation>^User.TOVD</IdLocation>
<IndexLocation>^User.TOVI</IndexLocation>
<StreamLocation>^User.TOVS</StreamLocation>
<Data name="TOVDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>ABLACK</Value>
</Value>
<Value name="3">
<Value>ACCID</Value>
</Value>
<Value name="4">
<Value>AIBAL</Value>
</Value>
<Value name="5">
<Value>AICONS</Value>
</Value>
<Value name="6">
<Value>AIFIN</Value>
</Value>
<Value name="7">
<Value>AIMAIN</Value>
</Value>
<Value name="8">
<Value>AINAKL</Value>
</Value>
<Value name="9">
<Value>AMINREM</Value>
</Value>
<Value name="10">
<Value>ANUM</Value>
</Value>
<Value name="11">
<Value>ANUMBOX</Value>
</Value>
<Value name="12">
<Value>AOBAL</Value>
</Value>
<Value name="13">
<Value>AOCONS</Value>
</Value>
<Value name="14">
<Value>AOFIN</Value>
</Value>
<Value name="15">
<Value>AOMAIN</Value>
</Value>
<Value name="16">
<Value>AONAKL</Value>
</Value>
<Value name="17">
<Value>ARTICLE</Value>
</Value>
<Value name="18">
<Value>BBLACK</Value>
</Value>
<Value name="19">
<Value>BICONS</Value>
</Value>
<Value name="20">
<Value>BNUM</Value>
</Value>
<Value name="21">
<Value>BOCONS</Value>
</Value>
<Value name="22">
<Value>CLASSID</Value>
</Value>
<Value name="23">
<Value>CODE</Value>
</Value>
<Value name="24">
<Value>CODE1</Value>
</Value>
<Value name="25">
<Value>COUNTRY</Value>
</Value>
<Value name="26">
<Value>DCOST</Value>
</Value>
<Value name="27">
<Value>DPRICE</Value>
</Value>
<Value name="28">
<Value>DTOV</Value>
</Value>
<Value name="29">
<Value>DUPDATE</Value>
</Value>
<Value name="30">
<Value>GTD</Value>
</Value>
<Value name="31">
<Value>ID</Value>
</Value>
<Value name="32">
<Value>LABEL</Value>
</Value>
<Value name="33">
<Value>LBOX</Value>
</Value>
<Value name="34">
<Value>LCOSTNDS</Value>
</Value>
<Value name="35">
<Value>LDEL</Value>
</Value>
<Value name="36">
<Value>LPRICE</Value>
</Value>
<Value name="37">
<Value>LPRICENDS</Value>
</Value>
<Value name="38">
<Value>LSHORT</Value>
</Value>
<Value name="39">
<Value>MINBOX</Value>
</Value>
<Value name="40">
<Value>NAME</Value>
</Value>
<Value name="41">
<Value>NNETTO</Value>
</Value>
<Value name="42">
<Value>ONENAME</Value>
</Value>
<Value name="43">
<Value>PNDS</Value>
</Value>
<Value name="44">
<Value>PSALENAL</Value>
</Value>
<Value name="45">
<Value>PSPEC</Value>
</Value>
<Value name="46">
<Value>PTORG</Value>
</Value>
<Value name="47">
<Value>RCOST</Value>
</Value>
<Value name="48">
<Value>RPRCDO</Value>
</Value>
<Value name="49">
<Value>RPRCUP</Value>
</Value>
<Value name="50">
<Value>RPRICE</Value>
</Value>
<Value name="51">
<Value>TSEND</Value>
</Value>
<Value name="52">
<Value>TYPE</Value>
</Value>
<Value name="53">
<Value>VALID</Value>
</Value>
<Value name="54">
<Value>VCOST</Value>
</Value>
<Value name="55">
<Value>VPRCDO</Value>
</Value>
<Value name="56">
<Value>VPRCUP</Value>
</Value>
<Value name="57">
<Value>VPRICE</Value>
</Value>
<Value name="58">
<Value>VPRICE1</Value>
</Value>
<Value name="59">
<Value>VPRICE2</Value>
</Value>
<Value name="60">
<Value>VPRICE3</Value>
</Value>
<Value name="61">
<Value>VPRICE4</Value>
</Value>
<Value name="62">
<Value>VPRICE5</Value>
</Value>
<Value name="63">
<Value>WORKID</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="User.valera">
<Description>
</Description>
<ClassType>persistent</ClassType>
<DdlAllowed>1</DdlAllowed>
<Owner>_SYSTEM</Owner>
<ProcedureBlock>0</ProcedureBlock>
<SqlRowIdPrivate>1</SqlRowIdPrivate>
<SqlTableName>valera</SqlTableName>
<StorageStrategy/>
<Super>%Persistent</Super>
<TimeCreated>60541,57593.687823</TimeCreated>

<Property name="Property7053">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>3</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="code">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>6</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="model">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>4</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="name">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>5</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="number">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>2</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="price">
<Type>%Library.String</Type>
<Collection/>
<Required>0</Required>
<SqlColumnNumber>7</SqlColumnNumber>
<Parameter name="MAXLEN" value="255"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^User.valeraD</DataLocation>
<DefaultData>valeraDefaultData</DefaultData>
<IdLocation>^User.valeraD</IdLocation>
<IndexLocation>^User.valeraI</IndexLocation>
<StreamLocation>^User.valeraS</StreamLocation>
<Data name="valeraDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>code</Value>
</Value>
<Value name="3">
<Value>model</Value>
</Value>
<Value name="4">
<Value>name</Value>
</Value>
<Value name="5">
<Value>number</Value>
</Value>
<Value name="6">
<Value>price</Value>
</Value>
<Value name="7">
<Value>Property7053</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.Dates">
<Description>
Данные пользователей</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%Persistent</Super>
<TimeCreated>60369,60019.41823</TimeCreated>

<Property name="Name">
<Description>
Ф.И.О пользователя</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Property name="Login">
<Description>
Логин</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Property name="Password">
<Description>
Пароль</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Property name="Rol">
<Description>
Роль</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Method name="SaveUser">
<ClassMethod>1</ClassMethod>
<FormalSpec>famil:%String,logi:%String,passwor:%String,rol:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s pass=$System.Encryption.MD5Hash(passwor)
	&sql(insert into Users.Dates (Name,Login,Password,Rol)
	values(:famil,:logi,:pass,:rol))
	q
]]></Implementation>
</Method>

<Method name="DeleteUser">
<ClassMethod>1</ClassMethod>
<FormalSpec>iden:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s qwer=0
	&sql(select Rol into:role from Users.Dates where ID=:iden)
	&sql(select count(ID) into :count from Users.Dates Where Rol=:role)
	if count>1 {&sql(delete from Users.Dates Where ID=:iden) q}else {&sql(select count(ID) into :countnum from Users.Roles where NameFunction=6)} 
	if countnum=1	{q "Невозможно удалить данного пользователя"} else {&sql(declare curs cursor for select Name into :namerol from Users.Roles Where NameFunction=6)
	&sql(open curs)
	f  &sql(fetch curs) q:SQLCODE  d
	.i $I(i)
	.s namerol(i)=namerol
	&sql(close curs)}
	f j=1:1:i q:SQLCODE  d
	.s param=namerol(j)
	.&sql(select count(ID) into :counter from Users.Dates where Rol=:param)
	.s qwer=qwer+counter
	i qwer>1 {&sql(delete from Users.Dates Where ID=:iden) q} else {q "Невозможно удалить данного пользователя"}
	q
]]></Implementation>
</Method>

<Method name="Input">
<ClassMethod>1</ClassMethod>
<FormalSpec>login1:%String,password:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
    &sql( select Login into:logname
    from Users.Dates where Login=:login1&Password=:pass)
 	q logname
]]></Implementation>
</Method>

<Method name="check">
<ClassMethod>1</ClassMethod>
<FormalSpec>login,pass</FormalSpec>
<Implementation><![CDATA[
 s passw=$System.Encryption.MD5Hash(pass)
 q:login="" "Не указано имя пользователя"
 q:passw="" "Не указан пароль"
 &sql(select ID,Password into :ID,:Password from Users.Dates where Login=:login)
 q:SQLCODE=100 "Не найден пользователь с указанным именем"
 q:passw'=Password "Пароль указан неверно"
 q ID
]]></Implementation>
</Method>

<Method name="UpdateUser">
<ClassMethod>1</ClassMethod>
<FormalSpec>famil="",log="",pas="",rol="",identificator=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s $ZT="UpdateUserErr"
	q:identificator="" 1
	s usr=##class(Users.Dates).%OpenId(identificator)
	q:'$ISOBJECT(usr) 1
	s:famil'="" usr.Name=famil
	s:log'="" usr.Login=log
	s:pas'="" usr.Password=$System.Encryption.MD5Hash(pas)
	s:rol'="" usr.Rol=rol
	s ok=usr.%Save()
	q:ok=1
	q 1
	s counter=0
 &sql(select Login,Name,Password,Rol  into :login,:name,:pass,:roles from Users.Dates where ID=:identificator) //считываю старые данные
	i pas'="" s password=$System.Encryption.MD5Hash(pas) else  s password=pass
	i roles=rol {&sql(update Users.Dates set Name=:famil,Login=:log,Password=:password where ID=:identificator) q} //если роль не меняется,то изменяем
	&sql(declare perscurs cursor for select Rol into :namerol from Users.Dates)
	&sql(open perscurs)
	f  &sql(fetch perscurs) q:SQLCODE  d
	.i $I(i)
	.s namerol(i)=namerol
	&sql(close perscurs)
	f j=1:1:i d
	.s namerole=namerol(j) //находим все роли пользователей 
	.&sql(select count(ID) into :count from Users.Roles where Name=:namerole&NameFunction=6)
	.s counter=counter+count //находим сколько пользователей имеют доступ к настройкам
	i counter>1 {&sql(update Users.Dates set Name=:famil,Login=:log,Password=:password where ID=:identificator) q}
	q 1
UpdateUserErr
 $$$WriteError($ZE)
 q 1
]]></Implementation>
</Method>

<Method name="GetPropertyListIndex">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec><![CDATA[PropertyName:%String="",&DataLocation:%String=""]]></FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
 Do %code.WriteLine(" s DataLocation="""_%compiledclass.Storages.GetAt(1).DataLocation_"""")
 Do %code.WriteLine(" q:PropertyName="""" """"")
 s number=""
 s StorageStrategy=%compiledclass.Storages.GetAt(1)
 f i=1:1:StorageStrategy.Data.Count() d  q:StorageData.Name[%compiledclass.SqlTableName
 . s StorageData=StorageStrategy.Data.GetAt(i)
 s data=StorageData.Values.GetNext(.number)
 while $ISOBJECT(data) {
 	s PropertyName=data.Value
 	s ListIndex=data.Name
 	Do %code.WriteLine(" s Prop( """ _ PropertyName _ """)="_ListIndex)
 	s data=StorageData.Values.GetNext(.number)
 	} 	
 Do %code.WriteLine(" Quit $G(Prop(PropertyName))")
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPropertyValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>ID:%String="",Property:%String=""</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q:ID=""
 q:Property=""
 s PropertyNumber=..GetPropertyListIndex(Property,.DataLocation)
 q:Property=""
 q $ZSTRIP($LG(@DataLocation@(ID),PropertyNumber),"<W")
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.DatesD</DataLocation>
<DefaultData>DatesDefaultData</DefaultData>
<IdLocation>^Users.DatesD</IdLocation>
<IndexLocation>^Users.DatesI</IndexLocation>
<StreamLocation>^Users.DatesS</StreamLocation>
<Data name="DatesDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Family</Value>
</Value>
<Value name="3">
<Value>Login</Value>
</Value>
<Value name="4">
<Value>Password</Value>
</Value>
<Value name="5">
<Value>Role</Value>
</Value>
<Value name="6">
<Value>Rol</Value>
</Value>
<Value name="7">
<Value>Name</Value>
</Value>
<Value name="8">
<Value>AspectID</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.Functions">
<Description>
Функции</Description>
<Super>%Persistent</Super>
<TimeCreated>60407,58581.772904</TimeCreated>

<Property name="Name">
<Description>
Название функции</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Property name="Description">
<Description>
Описание функции</Description>
<Type>%String</Type>
</Property>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.FunctionsD</DataLocation>
<DefaultData>FunctionsDefaultData</DefaultData>
<IdLocation>^Users.FunctionsD</IdLocation>
<IndexLocation>^Users.FunctionsI</IndexLocation>
<StreamLocation>^Users.FunctionsS</StreamLocation>
<Data name="FunctionsDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>Description</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.FunctionUser">
<Description>
Функции пользователя</Description>
<Super>%Persistent</Super>
<TimeCreated>60399,47244.799868</TimeCreated>

<Method name="ReadRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>userid,Rol</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	k ^func(userid)
	//в параметре получаем имя роли
	&sql(declare sdf cursor for 
	select NameFunction into :func
	from Users.Roles where Name=:Rol)
    &sql(open sdf)
    f  &sql(fetch sdf) q:SQLCODE  d
    . s ^func(userid,func)=1 //запишем все функции данной роли данному юзеру
    &sql(close sdf)
	q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.FunctionUserD</DataLocation>
<DefaultData>FunctionUserDefaultData</DefaultData>
<IdLocation>^Users.FunctionUserD</IdLocation>
<IndexLocation>^Users.FunctionUserI</IndexLocation>
<StreamLocation>^Users.FunctionUserS</StreamLocation>
<Data name="FunctionUserDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.Journal">
<Description>
Журнал доступа</Description>
<Super>%Persistent</Super>
<TimeCreated>60727,74683.092582</TimeCreated>

<Property name="User1">
<Description>
Пользователь</Description>
<Type>Users.Dates</Type>
<InitialExpression>$S($ISOBJECT($G(%session)):$G(%session.Data("user")),1:"")</InitialExpression>
</Property>

<Index name="User1Ind">
<Properties>User1</Properties>
</Index>

<Property name="Dat">
<Description>
Дата доступа</Description>
<Type>%Date</Type>
<InitialExpression>+$H</InitialExpression>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatInd">
<Properties>Dat</Properties>
</Index>

<Property name="Tim">
<Description>
Время доступа</Description>
<Type>%Time</Type>
<InitialExpression>$PIECE($H,",",2)</InitialExpression>
</Property>

<Index name="TimInd">
<Properties>Tim</Properties>
</Index>

<Property name="DatOut">
<Description>
Дата выхода</Description>
<Type>%Date</Type>
<Parameter name="FORMAT" value="4"/>
</Property>

<Index name="DatOutInd">
<Properties>Dat</Properties>
</Index>

<Property name="TimOut">
<Description>
Время выхода</Description>
<Type>%Time</Type>
</Property>

<Index name="TimOutInd">
<Properties>Tim</Properties>
</Index>

<Property name="UserIP">
<Description>
IP компьютера</Description>
<Type>%String</Type>
</Property>

<Index name="UserIPInd">
<Properties>UserIP</Properties>
</Index>

<Property name="SessionID">
<Description>
ID сессии</Description>
<Type>%String</Type>
<Parameter name="CAPTION" value=",display=none"/>
</Property>

<Index name="SessionIDInd">
<Properties>SessionID</Properties>
</Index>

<Property name="LogOutType">
<Description>
Тип выхода</Description>
<Type>%String</Type>
<Parameter name="DISPLAYLIST" value=",Нормальный,Автоматический"/>
<Parameter name="VALUELIST" value=",1,2"/>
</Property>

<Index name="LogOutTypeInd">
<Properties>LogOutType</Properties>
</Index>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.JournalD</DataLocation>
<DefaultData>JournalDefaultData</DefaultData>
<IdLocation>^Users.JournalD</IdLocation>
<IndexLocation>^Users.JournalI</IndexLocation>
<StreamLocation>^Users.JournalS</StreamLocation>
<Data name="JournalDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Dat</Value>
</Value>
<Value name="3">
<Value>DatOut</Value>
</Value>
<Value name="4">
<Value>Tim</Value>
</Value>
<Value name="5">
<Value>TimOut</Value>
</Value>
<Value name="6">
<Value>User1</Value>
</Value>
<Value name="7">
<Value>UserIP</Value>
</Value>
<Value name="8">
<Value>SessionID</Value>
</Value>
<Value name="9">
<Value>NormalLogOut</Value>
</Value>
<Value name="10">
<Value>LogOutType</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.NameRoles">
<Description>
Названия ролей</Description>
<Super>%Persistent</Super>
<TimeCreated>60397,76051.877616</TimeCreated>

<Property name="Name">
<Description>
Название роли</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Method name="SaveRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>role:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&sql(insert into Users.NameRoles (Name)
	values(:role))
]]></Implementation>
</Method>

<Method name="DeleteRoles">
<ClassMethod>1</ClassMethod>
<FormalSpec>iden:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&sql(delete from Users.NameRoles Where ID=:iden)
	q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.NameRolesD</DataLocation>
<DefaultData>NameRolesDefaultData</DefaultData>
<IdLocation>^Users.NameRolesD</IdLocation>
<IndexLocation>^Users.NameRolesI</IndexLocation>
<StreamLocation>^Users.NameRolesS</StreamLocation>
<Data name="NameRolesDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.OptionRoles">
<Description>
Свойства ролей</Description>
<Super>%Persistent</Super>
<TimeCreated>60383,61596.621277</TimeCreated>

<Property name="Name">
<Description>
Имя роли </Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Method name="SaveRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>role:%String,func1:%String,func2:%String,func3:%String,func4:%String,func5:%String,func6:%String,func7:%String,func8:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	//&sql(insert into Users.OptionRoles (NameRole,GoodsRole,DocRole,DictsRole,SotreRole,OpersRole,ChiefRole,TunesRole,EmployeeRole)
	//values(:role,:func1,:func2,:func3,:func4,:func5,:func6,:func7,:func8))
	q
]]></Implementation>
</Method>

<Method name="DeleteRoles">
<ClassMethod>1</ClassMethod>
<FormalSpec>iden:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	//&sql(delete from Users.OptionRoles Where ID=:iden)
	q
]]></Implementation>
</Method>

<Method name="ReadRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>roleident,num</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
   s ^qwer=1
 /*
	&sql(select GoodsRole,DocRole,DictsRole,SotreRole,OpersRole,ChiefRole,TunesRole,EmployeeRole
	into :func1,:func2,:func3,:func4,:func5,:func6,:func7,:func8
	from Users.OptionRoles
	where ID=:roleident
	)
 */
	i num=1 s per=func1
	i num=2 s per=func2
	i num=3 s per=func3
	i num=4 s per=func4
	i num=5 s per=func5
	i num=6 s per=func6
	i num=7 s per=func7
	i num=8 s per=func8
	q per
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.OptionRolesD</DataLocation>
<DefaultData>OptionRolesDefaultData</DefaultData>
<IdLocation>^Users.OptionRolesD</IdLocation>
<IndexLocation>^Users.OptionRolesI</IndexLocation>
<StreamLocation>^Users.OptionRolesS</StreamLocation>
<Data name="OptionRolesDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>ChiefRole</Value>
</Value>
<Value name="3">
<Value>DictsRole</Value>
</Value>
<Value name="4">
<Value>DocRole</Value>
</Value>
<Value name="5">
<Value>EmployeeRole</Value>
</Value>
<Value name="6">
<Value>GoodsRole</Value>
</Value>
<Value name="7">
<Value>NameRole</Value>
</Value>
<Value name="8">
<Value>OpersRole</Value>
</Value>
<Value name="9">
<Value>SotreRole</Value>
</Value>
<Value name="10">
<Value>TunesRole</Value>
</Value>
<Value name="11">
<Value>Name</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.RenameGlobal">
<Super>%Persistent</Super>
<TimeCreated>60460,76842.066988</TimeCreated>

<Method name="Rename">
<ClassMethod>1</ClassMethod>
<FormalSpec>Globalname:%String,Globalvalue:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	i Globalvalue="" q @Globalname //@Globalname
	s @Globalname=Globalvalue
	q @Globalname
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.RenameGlobalD</DataLocation>
<DefaultData>RenameGlobalDefaultData</DefaultData>
<IdLocation>^Users.RenameGlobalD</IdLocation>
<IndexLocation>^Users.RenameGlobalI</IndexLocation>
<StreamLocation>^Users.RenameGlobalS</StreamLocation>
<Data name="RenameGlobalDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Users.Roles">
<Description>
Роли</Description>
<IncludeCode>xmlmacros</IncludeCode>
<Super>%Persistent</Super>
<TimeCreated>60382,34466.269813</TimeCreated>

<Property name="NameFunction">
<Description>
Имя пользователя</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Property name="Name">
<Description>
Имя роли</Description>
<Type>%String</Type>
<Required>1</Required>
</Property>

<Method name="SaveRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>role:%String,str:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	f i=1:1 s func(i)=$P(str,"~",i+1) q:func(i)=""  d
	.s func=func(i)
	.&sql(insert into Users.Roles (Name,NameFunction) values(:role,:func))
	q
]]></Implementation>
</Method>

<Method name="DeleteRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>name:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	&sql(select count(ID) into :count from Users.Roles Where NameFunction=6)
	if count=1 q "Невозможно удалить данную роль"
	&sql(delete from Users.Roles Where Name=:name)
	&sql(delete from Users.Dates Where Rol=:name)
	q 1
]]></Implementation>
</Method>

<Method name="ReadRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>name,numbers</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
   &sql(select ID into :ident from Users.Roles where Name=:name)
	s numbers=ident+numbers-1
	s j=ident+7
	f i=ident:1:j d
	.&sql(select NameFunction into :namefunc from Users.Roles where ID=:i) 
	.i namefunc'="0" s func(i)=1 
	.i namefunc="0" s func(i)=0
	q func(numbers)
]]></Implementation>
</Method>

<Method name="RenameRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>lastname,newname,str</FormalSpec>
<Implementation><![CDATA[
	s $ZT="RenameRoleErr"
	s nameroleup=""
	f i=1:1 s func(i)=$P(str,"~",i+1) q:func(i)=""  d
	i $G(func(6))=6 d ##class(Users.Roles).UpdateRole(lastname,newname,str) q
	&sql(select Name from Users.Roles where Name=:lastname&NameFunction=6) //ищем есть ли у роли функция настройки
	i SQLCODE=100 d ##class(Users.Roles).UpdateRole(lastname,newname,str) q //изменяем
	&sql(select count(ID) into :count from Users.Roles where NameFunction=6) // проверяем сколько ролей с функцией настройки
	i count>1  d ##class(Users.Roles).UpdateRole(lastname,newname,str) q nameroleup //изменяем
	q 1
RenameRoleErr
 $$$WriteError($ZE)
 q 0
]]></Implementation>
</Method>

<Method name="UpdateRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>lastnamerole,newnamerole,str</FormalSpec>
<Implementation><![CDATA[
	&sql(delete from Users.Roles Where Name=:lastnamerole)
	d ##class(Users.Roles).SaveRole(newnamerole,str) 
	&sql(update  Users.Dates set Rol=:newnamerole where Rol=:lastnamerole)
	&sql(update  Users.NameRoles set Name=:newnamerole where Name=:lastnamerole)
	q
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Users.RolesD</DataLocation>
<DefaultData>RolesDefaultData</DefaultData>
<IdLocation>^Users.RolesD</IdLocation>
<IndexLocation>^Users.RolesI</IndexLocation>
<StreamLocation>^Users.RolesS</StreamLocation>
<Data name="RolesDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>NameRole</Value>
</Value>
<Value name="3">
<Value>NameUser</Value>
</Value>
<Value name="4">
<Value>Name</Value>
</Value>
<Value name="5">
<Value>NameFunction</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="Utils.Class">
<Description>
Вкусняшки для работы с описаниями класса</Description>
<Super>%RegisteredObject</Super>
<TimeCreated>62670,44534.629015</TimeCreated>

<Method name="wVDList">
<Description><![CDATA[
Выводит Value/Display список значений 
для свойства <var>prop</var> класса <var>class</var> 
в формате <example>значение:отображение; значение:отображение;</example>
Используется в интерфейсных классах с jqgrid компонентом
для инициализации списка возможных значений в поле
и построения элемента select]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class:%String="",prop:%String=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s property=$g(class)_"||"_$g(prop) ;id свойства 
	s params="" &sql(Select parameters Into :params From %Dictionary.CompiledProperty Where ID1=:property)
 s list=$LFS(params,","),key=0,param=""
 /*
 * EXAMPLE: ,CALCSELECTIVITY=1,CAPTION=,COLLATION=,CONTENT=STRING,DISPLAYLIST=,Создана,Утверждена,Принята,Укомплектовано,Отправлено в офис,Отправлено c товаром,Отправлено из офиса,Отправлено экпресс-почтой,Нет в наличии,Отклонена,Самовывоз,Отправлено транспортной компанией,Завершена,EXTERNALSQLNAME=,JAVATYPE=,MAXLEN=50,MINLEN=,PATTERN=,SELECTIVITY=,TRUNCATE=0,VALUELIST=,1,2,3,4,5,6,7,8,8.5,8.6,8.7,8.9,9,XSDTYPE=string 
 */
 k dlist, vlist
 while $LISTNEXT(list,key,param) { //цикл по всем параметрам
			
			if param="DISPLAYLIST=" { ;начиная с этого момента вычленяем элементы
				s dkey=key,dparam=""
				while $LISTNEXT(list,dkey,dparam){ Q:dparam["="
				 #;собираем список ОТОБРАЖЕНИЯ
					s dlist($i(dlist))=dparam
				}
				s key=dkey, param=dparam ;восстановили контекст основного поиска
			}
			
			if param="VALUELIST=" { ;начиная с этого момента вычленяем элементы
				s vkey=key,vparam=""
				while $LISTNEXT(list,vkey,vparam){ Q:vparam["="
				 #;собираем список ЗНАЧЕНИЙ
					s vlist($i(vlist))=vparam
				}
				s key=vkey, param=vparam ;восстановили контекст основного поиска
			}
			
	}
	#; выводим в формате значение:отображение; значение:отображение;
 w "':;" ;первое пустое значение
 s i="" for { s i=$o(vlist(i)) Q:i=""
	 s value=$g(vlist(i)), display=$g(dlist(i)) s:display="" display=value
	 w value,":",display s next=$o(vlist(i)) w $S(next'="":";",1:"")
	}
 w "'"
 Q ""
]]></Implementation>
</Method>
</Class>


<Class name="Utils.Propis">
<Description>
Сумма рублей прописью
http://www.nestor.minsk.by/kg/2002/04/kg20411.html
Возьмем число 123 345 123 345 (разбиты по триадам справа налево)
Его пропись:
сто двадцать три миллиарда триста сорок пять миллионов сто двадцать три тысячи триста сорок пять". 
Особенности:
1 - один,одна,одно, 2 - два,две
1 рубль,2 рубля,5 рублей
1 копейка,2 копейки,5 копеек
тысяча - женский род
миллион, миллиард и т.д - мужской</Description>
<TimeCreated>62354,49824.646263</TimeCreated>

<Method name="Write">
<Description>
род: 0-средний,1-мужской,2-женский
словарь целой части
in=1(мужской), in(10)="рублей", in(5)="рублей", in(2)="рубля", in(1)="рубель", in(-1)="рублей"
словарь дробной части
dn=2(женский), dn(10)="копеек", in(5)="копеек", in(2)="копейки", in(1)="копейка", dn(-1)="копеек"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[num:%String,&in:%String="1",&dn:%String="2"]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 #define Средний 0 
 #define Мужской 1
 #define Женский 2
 s num=$j(+$g(num),0,2), int=$p(num,"."), dec=$p(num,".",2)
 
 #;заполнение словарей целой и дробной части по умолчанию
 if $d(in)<10 { ;если не определен словарь целой части
		s in=1, in(10)="рублей", in(5)="рублей", in(2)="рубля", in(1)="рубль", in(-1)="рублей"
 }
 if $d(dn)<10 { ;если не определен словарь дробной части
		s dn=2, dn(10)="копеек", dn(5)="копеек", dn(2)="копейки", dn(1)="копейка", dn(-1)="копеек"
 }
 s propis=$$is(int,.in)_" "_$$is(dec,.dn)
 #; хак
 s:+num=0 propis="ноль "_$g(in(10))_" 00 "_$g(dn(10))
 s $e(propis)=$zcvt($e(propis),"U") ;Выделение заглавной буквы
 Q propis
 
is(int,names) ;разбор целого числа по триадам справа налево
 s len=$l(int),lvl=0,nnn=""
 for pos=len:-3:0 {
	s lvl=lvl+1, nnn=$e(int,pos-2,pos) Q:nnn="" 
	s nnn=$j(nnn,3,0), nnn=$tr(nnn," ","0"), nnn=$e(nnn,1,3) ;нормализация триады
	s rd=names ;запоминаем род
	s tname=$$ls(lvl,nnn,.rd) ;название уровня триады может изменить род
	s int(lvl)=$$ts(nnn,rd)_" "_tname ;собираем триаду
 }
 
 s list=$LB(""),pos=0 ;заполняем список триадами в порядке обратном разбору на триады
 s i="" for { s i=$o(int(i),-1) q:i=""
 	 s pos=pos+1, $LI(list,pos)=$g(int(i))
 }
 
 #;согласуем текст числа со словарем ресурсов, анализируя последние две цифры
 s n21=$e(int,len-1,len) 
 s:n21>20 n21=$e(n21,2) ;после 20 -  интересует значение только последней цифры
 
 #;выбираем из словаря название
 s name="", i="" for { s i=$o(names(i),-1) Q:i=""  
 	if n21>=i s name=$g(names(i)) Q
 }
 s value=$LTS(list," ") ;список в строку
 Q value_$S(value'=" ":name,1:"") ;добавляем название
 

ls(lvl,nnn,rd)  ;возвращает название триады в зависимости от позиции
	Q:lvl<2 ""  ;у первой триады нет названия
	s n21=+$e(nnn,2,3) s:n21>20 n21=$e(n21,2) 

	if lvl=2 { ;исключение 
		s rd=2 ;женский род
		Q:n21>10&&(n21<20) "тысяч"
		if n21=1 Q "тысяча"
		Q:n21>1&&(n21<5) "тысячи"
		Q "тысяч"
	}	
	
	s lvlname=$CASE(lvl,
		3:"миллион",4:"миллиард",5:"биллион",6:"биллиард",7:"триллион",8:"триллиард",9:"квадриллион",
		10:"квинтиллион",11:"секстиллион",12:"септиллион",13:"октиллион",14:"нониллион",15:"дециллион"
		,:"запредельно много"
	)
	
	s fix=""
	if n21>10&&(n21<20) {
		s fix="ов"
	} elseif n21=1 {
		s fix=""
	} elseif n21>1&&(n21<5) {
		s fix="а"
	} elseif n21>4 {
		s fix="ов"	
	}
	
	Q lvlname_fix
 
ts(nnn,род)  ;Возвращает название чисел триады: 321 - триста двадцать один 
	s nnn=$g(nnn) Q:nnn="" ""
	#;w !,"Триада: ",nnn,"; Род: ",род
	s n3=$e(nnn,1), n2=$e(nnn,2), n1=$e(nnn,3), n21=+$e(nnn,2,3)
	s сотни=$$ns(3,n3),десятки="",единицы=""
	if n21>19 {
		s десятки=$$ns(2,n2,род), единицы=$$ns(1,n1,род)
	} elseif n21>10 {
		s единицы=$$ns(4,n1,род)
	} else {
		s десятки=$$ns(2,n2,род), единицы=$$ns(1,n1,род)	
	}
	s list=""
	s:сотни'="" list=сотни
	s:десятки'="" list=list_$S(list="":"",1:" ")_десятки
	s:единицы'="" list=list_$S(list="":"",1:" ")_единицы
 Q list

ns(разряд,цифра,род=1) ;Возвращает название числа в триаде
	#;w !,"разряд: ",разряд,"; цифра: ",цифра,"; род: ",род
	#define test(%r,%c) разряд=%r&&(цифра=%c)
	#define testEx(%r,%c,%rd) разряд=%r&&(цифра=%c)&&(род=%rd)
	
	Q:$$$testEx(1,1,$$$Средний) "одно" Q:$$$testEx(1,1,$$$Мужской) "один" Q:$$$testEx(1,1,$$$Женский) "одна"  
	Q:$$$testEx(1,2,$$$Женский) "две" Q:$$$test(1,2) "два" 
	
	Q:$$$test(1,3) "три" Q:$$$test(1,4) "четыре" Q:$$$test(1,5) "пять"
	Q:$$$test(1,6) "шесть" Q:$$$test(1,7) "семь" Q:$$$test(1,8) "восемь" Q:$$$test(1,9) "девять" 
	
	Q:$$$test(2,1) "десять" Q:$$$test(2,2) "двадцать" Q:$$$test(2,3) "тридцать" Q:$$$test(2,4) "сорок" Q:$$$test(2,5) "пятьдесят"
	Q:$$$test(2,6) "шестьдесят" Q:$$$test(2,7) "семьдесят" Q:$$$test(2,8) "восемьдесят" Q:$$$test(2,9) "девяносто" 
	
	Q:$$$test(3,1) "сто" Q:$$$test(3,2) "двести" Q:$$$test(3,3) "триста" Q:$$$test(3,4) "четыреста" Q:$$$test(3,5) "пятьсот"
	Q:$$$test(3,6) "шестьсот" Q:$$$test(3,7) "семьсот" Q:$$$test(3,8) "восемьсот" Q:$$$test(3,9) "девятьсот" 
	
	Q:$$$test(4,1) "одиннадцать" Q:$$$test(4,2) "двенадцать" Q:$$$test(4,3) "тринадцать" Q:$$$test(4,4) "четырнадцать" Q:$$$test(4,5) "пятнадцать"
	Q:$$$test(4,6) "шестнадцать" Q:$$$test(4,7) "семнадцать" Q:$$$test(4,8) "восемнадцать" Q:$$$test(4,9) "девятнадцать" 
	
	Q ""
]]></Implementation>
</Method>
</Class>
</Export>

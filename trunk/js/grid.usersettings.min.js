(function(c){var l=!this.JSON?function(a){return c.obj2json(a)}:function(a){return JSON.stringify(a)},k=function(a,b){var d=l(b);c.cookie(a,d)},j=function(a){a=c.cookie(a);return c.parseJSON(a)||{}},m=function(a,b){c(a).jqGrid("navButtonAdd",b,{id:"bSetColumns",caption:"",title:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c/\u0421\u043a\u0440\u044b\u0442\u044c \u043a\u043e\u043b\u043e\u043d\u043a\u0438",buttonicon:"ui-icon-newwin",onClickButton:function(){c(a).setColumns({width:350,colnameview:false});
return false},position:"last",cursor:"pointer"})},n=function(a,b){var d=c(b),i=d.attr("id")+"_cxmn",e=c("<div id='"+i+"' class='contextMenu' style='display:none'></div>").appendTo(c("body")),h=c("<ul></ul>").appendTo(e),f={};d.find(".ui-pg-button").each(function(){var a=c(this);if(!(a.find(".ui-separator").size()>0)){var b=a.attr("id")+"_cxmi",d=a.attr("title"),e=a.find(".ui-pg-div");e.text()!==""&&(e=e.html(),c("<li id='"+b+"'></li>").appendTo(h).attr("title",d).html(e).find("span.ui-icon").css("display",
"inline-block"),f[b]=function(){a.click()})}});c(a).contextMenu(i,c.extend({bindings:f}))},o=function(a,b){if(a&&b){if(b.width&&b.width-0>0)a.width=b.width;if(b.height&&b.height-0>0)a.height=b.height;if(b.sortname&&(a.sortname=b.sortname,b.sortorder))a.sortorder=b.sortorder;if(b.colModel&&a.colModel)for(var d=a.colModel,c=b.colModel,e=d.length,h=0;h<e;h++){var f=d[h],g=c[f.name];if(g){if(g.width&&g.width-0>0)f.width=g.width;if(g.hidden!==void 0&&g.hidden!==null)f.hidden=g.hidden?true:false}}if(b.cord&&
a.colModel){d=a.colModel;c=d.length;e=[];for(h=0;h<c;h++)f=d[h],e[b.cord[f.name]]=f;a.colModel=e}}};c.jgrid.extend({userSettings:function(a){var b=c(this),d=b.attr("id"),a=c.extend(a,{sortable:{update:function(){for(var a=b.jqGrid("getGridParam","colModel"),c=b.jqGrid("getGridParam","rownumbers"),f=b.jqGrid("getGridParam","multiselect"),a=a.slice(c?1:0),a=a.slice(f?1:0),c={},f=a.length,g=0;g<f;g++)c[a[g].name]=g;a=j(d);a.cord=c;k(d,a)}},onSortCol:function(a,b,c){b=j(d);b.sortname=a;b.sortorder=c;
k(d,b)},resizeStop:function(a,h){var f=b.jqGrid("getGridParam","colModel")[h].name,g=j(d);g.colModel=g.colModel||{};var i={};i[f]={width:a};c.extend(g.colModel,i);k(d,g)}}),i=j(d);o(a,i);return a},improve:function(a){var a=a||{},b={contextMenu:true};c.extend(b,a);return this.each(function(){var a=c(this),i=a.attr("id"),e=a.jqGrid("getGridParam","pager"),h=c(e+"_center"),f=h.prev();h.remove();f.css("width","70%");m(a,e);b.contextMenu&&n(a,e);a.jqGrid("gridResize",{stop:function(a,b){var d=c("#gview_"+
i+" .ui-jqgrid-bdiv").height(),f=b.size.width,e=j(i);e.width=f;e.height=d;k(i,e)}});a.bind("jqGridShowHideCol",function(a,b,d){a=j(i)||{};a.colModel=a.colModel||{};var e={};e[d]={hidden:!b};c.extend(a.colModel,e);k(i,a)})})}})})(jQuery);

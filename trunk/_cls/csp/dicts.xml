<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.dicts">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62301,49214.330495</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load()"">"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,!
	If '(login=7) Goto %csp00001 ;{
	Write !,"	"
	Write "<input type=""text"" id=""EdtTest"" style=""width:300px"">"
	Write "<input type=""button"" id=""testBtn"" value=""Тест быстрого окошка с товарами"" onclick=""TestFastGoods();"">"
	Write "<br><br>",!
	Write "	"
	Write "<input type=""text"" id=""edtText"" style=""width:300px"">"
	Write !,"<input type=""button"" value=""test"" onclick=""alert(eval(edtText.value));"">"
	Write !
%csp00001	;}
	Write !,!,"<TABLE cellSpacing=0 width=""100%"" celpadding=""0"" >",!
	Write "<TR>",!
	Write "<td width=10%>"
	Write "<img alt=""Обновить раздел"" src=""images/refresh.gif"" onclick=""window.location.reload()"">"
	Write "</td>",!
	Write "<TD width=80% align=center style=""BACKGROUND: rgb(233,243,255); FONT-size: 18px ; font-family: arial; COLOR: rgb(0,0,102); BORDER-BOTTOM: rgb(0,0,102) 1px solid"" colspan=2><strong>Справочники</strong></TD>",!
	Write "<td width=10% align=right>"
	Write "<a href=""help/dictshelp.htm"">"
	Write "<img src=""images/BIGHelp.bmp"" width=""20"" height=25 border=0>"
	Write "</a>"
	Write "</td>",!
	Write "</TABLE>",!
	Write !,"<br>",!
	Write "<fieldset><legend>Справочники</legend>",!
	Write " <SKLADList:listview width=100% height=150 id=""dictionary"" onAddColumns=""ShowList()"" ClassName=""Common.Dicts"" zonDblClick=""Item()"" zClick=""ShowProps()""/><br>",!
	Write "  "
	Write !,"<img src=""images/new.gif"" onmouseover=""newtov1.src='images/Onnew.gif'"" onmouseout=""newtov1.src='images/new.gif'""  id=""newtov1"" name=""newtov1"" alt=""Создать справочник"" onclick=""Item()"" style="""">"
	Write !,"  "
	Write "<!--",!
	Write "  <sklad:LittleButton name=""edit"" id=""edititem"" onclick=""Item(dictionary.ItemID)"" alt=""Редактировать справочник"">",!
	Write "  -->"
	Write !,"  "
	Write !,"<img src=""images/new+.gif"" onmouseover=""newprop.src='images/Onnew+.gif'"" onmouseout=""newprop.src='images/new+.gif'""  id=""newprop"" name=""newprop"" alt=""Добавить поле справочника"" onclick=""AddProp()"" style="""">"
	Write !,"</fieldset>",!
	Write "<br>",!
	Write "<span id=""namfld"">"
	Write "</span>"
	Write "&nbsp;"
	Write "<input type=""text"" id=""fldval"" onkeyup=""gg();"">"
	Write !,"<span id=""KontrGroup"" style=""display:none"">"
	Write "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",!
	Write "	Вид деятельности: ",!
	Write "	"
	Write "<select id=""KontrGroupSel"" onchange=""showdictionary()"">"
	Write !,"	"
	w ##class(Docs.Action2).GetDisplaylistOptions(,"Common.Kontragent||Property2506")
	Write !,"	"
	Write "</select>"
	Write !,"</span>"
	Write !,!,"<fieldset ><legend id=""CurrentDictName""></legend>",!
	Write "<!--",!
	Write "<SKLAD2:table id=""PropTable"" width=400 height=200 DisplaySecondCol=""none"" />",!
	Write "-->"
	Write !,"<SKLADList:listview width=100% height=150 id=""currentdict"" zonDblClick=""addrecord(currentdict.ItemID);"" zonColumnClick=""colclick()"" onAddColumns=""showdictionary()"" /><br>",!
	Write "<table width=100%><tr><td>",!
	Write "  "
	Write !,"<img src=""images/new.gif"" onmouseover=""newrec.src='images/Onnew.gif'"" onmouseout=""newrec.src='images/new.gif'""  id=""newrec"" name=""newrec"" alt=""Создать запись"" onclick=""addrecord()"" style="""">"
	Write !,"  "
	Write !,"<img src=""images/edit.gif"" onmouseover=""addrec.src='images/Onedit.gif'"" onmouseout=""addrec.src='images/edit.gif'""  id=""addrec"" name=""addrec"" alt=""Редактировать запись"" onclick=""addrecord(currentdict.ItemID)"" style="""">"
	Write !,"  "
	If '(HaveRightsForGoods) Goto %csp00002 ;{
	Write !,"  	"
	Write !,"<img src=""images/del.gif"" onmouseover=""btnDelete.src='images/Ondel.gif'"" onmouseout=""btnDelete.src='images/del.gif'""  id=""btnDelete"" name=""btnDelete"" alt=""Удалить запись"" onclick=""fnDeleteItem(currentdict.ItemID)"" style=""display:none"">"
	Write !,"  "
%csp00002	;}
	Write " ",!
	Write "  "
	Write "<span id=""EditList"" style=""display:none"">"
	Write !,"   "
	Write !,"<img src=""images/history.gif"" onmouseover=""btnKontrListEdit.src='images/Onhistory.gif'"" onmouseout=""btnKontrListEdit.src='images/history.gif'""  id=""btnKontrListEdit"" name=""btnKontrListEdit"" alt=""Редактировать список контрагентов"" onclick=""fnKontrList()"" style="""">"
	Write !,"  "
	Write !,"<img src=""images/user.gif"" onmouseover=""btnUser.src='images/Onuser.gif'"" onmouseout=""btnUser.src='images/user.gif'""  id=""btnUser"" name=""btnUser"" alt=""История общения с контрагентом"" onclick=""fnMeetingResult()"" style="""">"
	Write !,"</span>"
	Write !,"</td>",!
	Write "<td align=right>",!
	Write "Поддерживать таблицу в актуальном состоянии",!
	Write "<input type=checkbox id=""makeShowDict"" checked style=""width:20pt;border:none;"">"
	Write !,"</td>",!
	Write "</tr>",!
	Write "</fieldset>",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !,!
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<script language=""Jscript"">"
	Write !,"GoodsWindow = ""ok"";",!
	Write "ColCode="""";",!
	Write "sessionid="""_(%session.SessionId)_""";",!
	Write "var where="""";",!
	Write "GoodsWindow = """";",!
	Write !,"function load()",!
	Write "{",!
	Write "	//currentdict.attachEvent(""onAddColumns"", showdictionary)",!
	Write "	dictionary.LoadHeaders();",!
	Write "}",!
	Write !,"function Item(ItemID)",!
	Write "{",!
	Write "	ItemID=ReturnSpace(ItemID)",!
	Write "	mok=window.showModalDialog(""CreateNewDict.csp"",ItemID+"";""+dictionary.ClassName,""center:yes;status:no;dialogHeight:400px;dialogWidth:400px;resizable:yes;"")",!
	Write "	if(mok==null)return false",!
	Write "	if(mok==1){ShowList()}",!
	Write "}",!
	Write !,"function ShowList()",!
	Write "{",!
	Write "	dictionary.DownLoad();",!
	Write "}",!
	Write !,"function AddProp()",!
	Write "{",!
	Write "	ItemID=ReturnSpace(dictionary.ItemID)",!
	Write "	if(ItemID=="""")return",!
	Write "	ok=window.showModalDialog(""AddGoodsProp2.csp?ItemID=""+ItemID,ItemID,""center:yes;status:no;dialogHeight:330px;resizable:yes"")",!
	Write "	if(ok==1){ShowList();return false;}",!
	Write "	if(ok==null){return false;}",!
	Write "	alert(ok)",!
	Write "}",!
	Write !,"function ShowProps()",!
	Write "{",!
	Write "	ItemID=ReturnSpace(dictionary.ItemID);",!
	Write "	//PropTable.ClearRows();",!
	Write "	//PropTable.DownLoadPairs(ItemID,'');	",!
	Write "	CurrentDictName.innerText=dictionary.ItemName;",!
	Write "	currentdict.ClassName=ItemID;",!
	Write "	var made=false;",!
	Write "	if(ItemID==""Common.Dictionary4""){",!
	Write "		//товар и его аналоги",!
	Write "		currentdict.loadfrommethod(""Reports.ShowTables.showanalogs"","""");",!
	Write "		var made=true;",!
	Write "		if(typeof btnDelete == ""object""){btnDelete.style.display=""inline"";}",!
	Write "	}",!
	Write "	else{if(typeof btnDelete == ""object""){btnDelete.style.display=""none"";}}",!
	Write "	if(ItemID==""Common.Dictionary2""){",!
	Write "		//гарантийные талоны",!
	Write "		currentdict.loadfrommethod(""Reports.ShowTables.showgarants"","""");",!
	Write "		var made=true;",!
	Write "	}	",!
	Write "	var AdditionalFields="""";  //добавочные поля",!
	Write "	if(ItemID==""Common.Dictionary10""){var AdditionalFields=""Property7148->ModelNumber~Модель~~~@%String~~~~~#@#""}",!
	Write "	if(!made){currentdict.LoadHeaders("""","""",AdditionalFields);}",!
	Write "}",!
	Write !,"function showdictionary(where)",!
	Write "{",!
	Write "	if(!makeShowDict.checked)return",!
	Write "	where=ReturnSpace(where);",!
	Write "	var made=false;",!
	Write "	KontrGroup.style.display=""none"";",!
	Write "	EditList.style.display=""none"";",!
	Write "	if(currentdict.ClassName==""Common.Dictionary4""){",!
	Write "		currentdict.loadfrommethod(""Reports.ShowTables.showanalogs"",where);",!
	Write "		var made=true;",!
	Write "	}",!
	Write "	if(currentdict.ClassName==""Common.Dictionary2""){",!
	Write "		currentdict.loadfrommethod(""Reports.ShowTables.showgarants"",where);",!
	Write "		var made=true;",!
	Write "	} ",!
	Write "	if(currentdict.ClassName==""Common.Kontragent""){",!
	Write "		KontrGroup.style.display=""inline"";",!
	Write "		EditList.style.display=""inline"";",!
	Write "		var Add="""";",!
	Write "		if(where!=""""){var Add="" and "";}",!
	Write "		if(KontrGroupSel.value!=""""){",!
	Write "			where=where+Add+""Property2506=""+KontrGroupSel.value;",!
	Write "			}",!
	Write "	}",!
	Write "	if(!made)",!
	Write "	{",!
	Write "		//alert(where);",!
	Write "		currentdict.DownLoad(where);",!
	Write "	}",!
	Write "}",!
	Write !,"//создать новую запись",!
	Write "function addrecord(currentrecord)",!
	Write "{",!
	Write "	var currentrecord=ReturnSpace(currentrecord)",!
	Write "	var currentclass=currentdict.ClassName;",!
	Write "	var made=false;",!
	Write "	if((currentclass==""Common.Kontragent"")&(currentrecord!=""""))",!
	Write "	{",!
	Write "		ok=window.showModalDialog(""kontragent.csp?KontrId=""+currentrecord,"""",""center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;"")",!
	Write "		var made=true;",!
	Write "	}",!
	Write "	",!
	Write "	if((currentclass==""Common.Dictionary2"")&(currentrecord!=""""))",!
	Write "	{",!
	Write "		ok=window.showModalDialog(""garant.csp?GarantId=""+currentrecord,currentrecord+"";""+currentclass,""center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;"")",!
	Write "		var made=true;",!
	Write "	}",!
	Write "		",!
	Write "	if((currentclass==""Common.Dictionary2"")&(currentrecord==""""))",!
	Write "	{",!
	Write "		ok=window.showModalDialog(""ManyGarants.csp"",currentrecord+"";""+currentclass,""center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;"")",!
	Write "		var made=true;",!
	Write "	}",!
	Write "	if(!made){ok=window.showModalDialog(""DictItem.csp"",currentrecord+"";""+currentclass,""center:yes;status:no;dialogHeight:350px;dialogWidth:400px;resizable:yes;"")}",!
	Write "	if(ok!=null)showdictionary()",!
	Write "}",!
	Write !,"function gg()",!
	Write "{",!
	Write "	if(ColCode=="""")return false;",!
	Write "	var ItemID=ReturnSpace(dictionary.ItemID);",!
	Write "	//if(ItemID==""Common.Dictionary2""){where = ColCode+"" LIKE '%""+fldval.value+""%'"";}",!
	Write "	//else{where = ColCode+"" %STARTSWITH '""+fldval.value+""'"";}",!
	Write "	where = ColCode+"" %STARTSWITH '""+fldval.value+""'"";",!
	Write "	//alert(""where = "" + where);",!
	Write "	if(fldval.value=="""")where="""";",!
	Write "	showdictionary(where);",!
	Write "}",!
	Write !,"function colclick(){",!
	Write "	if(currentdict.ColType==""%Date""){alert(""Поля с датами не обрабатываются"");return false;}",!
	Write "	namfld.innerText=currentdict.ColName;",!
	Write "	ColCode=currentdict.ColCode;",!
	Write "}",!
	Write !,"function fnKontrList(){",!
	Write "var ok=window.showModalDialog(""KontragentsListEdit.csp?Where=""+where,"""",""center:yes;status:no;dialogHeight:650px;dialogWidth:1000px;resizable:yes;"")",!
	Write "if((ok!=null)&&(makeShowDict.checked)){showdictionary(where)}",!
	Write "}",!
	Write !,"function showReport8(){",!
	Write "var Dates=rep7dat1.value+""@""+rep7dat2.value;",!
	Write "report8.loadfrommethod(""Reports.Analyzis.OtpravkaKontragentu"",Dates,TovarIDs,KontrID)",!
	Write "}",!
	Write !,"function fnMeetingResult(){",!
	Write "var KontrId=currentdict.ItemID;",!
	Write "if(KontrId=="""")return;",!
	Write "var ok=window.showModalDialog(""KontrMeetingResult.csp?Kontr=""+KontrId,"""",""center:yes;status:no;dialogHeight:600px;dialogWidth:800px;resizable:yes;"")",!
	Write "}",!
	Write !,"function fnDeleteItem(CurrentID)",!
	Write "{",!
	Write " var ok = "_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Common.Common.DeleteItem:csp.dicts"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',currentdict.ClassName,CurrentID);",!
	Write " if(isNaN(ok)){alert(ok);}",!
	Write " else{showdictionary(where);}",!
	Write "}",!
	Write !,"function TestFastGoods()",!
	Write "{",!
	Write "	alert(window.parent.GoodsWindow);",!
	Write "	return;",!
	Write "	",!
	Write "	if(typeof(frameElement.document.all.MainFrameSet.tag) == ""object"")",!
	Write "	{",!
	Write "		alert(frameElement.document.all.MainFrameSet.tag.tagName)	",!
	Write "		frameElement.document.all.MainFrameSet.tag.dialogTop = ""100px"";",!
	Write "	}",!
	Write "	else",!
	Write "	{",!
	Write "		frameElement.document.all.MainFrameSet.tag = showModelessDialog(""selectgoods3.csp"",document,""center:yes;status:no;dialogHeight:700px;dialogWidth:800px;resizable:yes;"");",!
	Write "	}",!
	Write "	alert(frameElement.document.all.MainFrameSet.tag);",!
	Write "}",!
	Write !,"</script>"
	Write !,(..HyperEventHead())
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLADList XMLNS:SKLAD2>"
	Write !,"<IMPORT NAMESPACE=""SKLADList"" IMPLEMENTATION=""htc/listview2.htc"">",!
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
  s login=$G(%session.Data("user"))
  i '+login s %response.ServerSideRedirect="norights.csp" 
  i '##class(Common.Rights).getrights(login,4) s %response.ServerSideRedirect="norights.csp" 
  s HaveRightsForGoods = ##class(Common.Rights).getrights(login,9)
  q 1
 
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\dicts.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/dicts.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>62164,44659</Default>
</Parameter>
</Class>
</Export>

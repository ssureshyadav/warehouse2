<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.tovprice">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62174,57958.559194</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load();"" onkeypress=""ManageWindow();"">"
	Write !,"<table cellpadding=0 cellspacing=0 width=100% border=0><tr>",!
	Write "<td valign=top>",!
	Write "<fieldset><legend>Основные свойства</legend>",!
	Write "<SKLAD2:table id=""PropTable"" width=360 height=200 />",!
	Write "</fieldset>",!
	Write "</td>",!
	Write "<td>",!
	Write "<fieldset><legend>Новая цена</legend>",!
	Write "<SKLAD2:table id=""newpr"" width=300 height=200 onLoadComplete=""setfornewpr()"" />",!
	Write "</fieldset>",!
	Write "</td>",!
	Write "</tr>",!
	Write "<tr><td colspan=2>",!
	Write "<fieldset><legend>История цен</legend>",!
	Write "<input type=""checkbox"" id=""allpr"" style=""width:15px;border:0"" onclick=""loadprices()"">"
	Write " Все цены",!
	Write " <SKLADList:listview width=100% height=135 id=""tp"" />",!
	Write "</fieldset>",!
	Write "</td></tr>",!
	Write "<tr><td colspan=2 align=center>",!
	If '(allow) Goto %csp00001 ;{
	Write !,!,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun()"" TITLE=""""><center>Да</center></span>"
	Write !
%csp00001	;}
	Write !,"&nbsp;&nbsp;&nbsp;"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.close()"" TITLE=""""><center>Отмена</center></span>"
	Write "</td></tr>",!
	Write "</table>",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s goodsid=$G(%request.Data("goodsid",1))
	s login=$G(%session.Data("user"))
	s allow=##class(Common.Rights).getrights(login,8)
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<title>"_($G(%session.Data("systemname")))_"</title>",!
	Write "<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""Jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<script language=""JScript"">"
	Write !,"sessionid="""_(%session.SessionId)_""";",!
	Write !,"var NodeData = new Array();",!
	Write "GoodsId= """_(goodsid)_""";",!
	Write !,"function startFun(){",!
	Write "xmldoc=newpr.GetXmlContent();",!
	Write "addnode(xmldoc,""Goods"",GoodsId+""@Goods.Goods"")",!
	Write "ok=SplitSendXml("""",""Store.Price"",xmldoc,"""","""_(%session.SessionId)_""")",!
	Write "if(isNaN(ok)){",!
	Write "	alert(ok);}",!
	Write "else{",!
	Write "	alert(""Новая цена успешно сохранена"");",!
	Write "	loadprices();}",!
	Write !,"}",!
	Write !,"function LoadList(){",!
	Write "PropTable.DownLoadPairs('Goods.Goods',GoodsId);",!
	Write "newpr.DownLoadPairs('Store.Price','',""Tim,Depot,Goods"");",!
	Write "}",!
	Write !,"function load(){",!
	Write "LoadList();",!
	Write "loadprices();",!
	Write "}",!
	Write !,"function loadprices(){",!
	Write "tp.loadfrommethod(""Goods.GoodsAction.prices"",GoodsId,allpr.checked);",!
	Write "}",!
	Write !,"function setfornewpr(){",!
	Write "newpr.setCellValue(""Dat"","""_($ZD($H,4))_""");",!
	Write "}",!
	Write !,"</script>"
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLAD2 XMLNS:SKLADList>"
	Write !,"<IMPORT NAMESPACE=""SKLADList"" IMPLEMENTATION=""htc/listview2.htc"">",!
	Write "<IMPORT NAMESPACE=""SKLAD2"" IMPLEMENTATION=""htc/table.htc"">",!
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\tovprice.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/tovprice.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>62164,41693</Default>
</Parameter>
</Class>
</Export>

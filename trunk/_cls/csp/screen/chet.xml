<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.screen.chet">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62194,42569.209248</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body>"
	Write !,"	<p class=""xlsFont"">",!
	Write "		<b>ПОСТАВЩИК "_($G(ppname))_"<br />",!
	Write "		Адрес: "_($G(ppadress))_"	",!
	Write "	</b>	",!
	Write "	</p>",!
	Write "	<p style=""margin: 40px"">",!
	Write "	<table><tr><td>",!
	Write "	<p align=""center"" style=""margin: 2px""><b>Образец заполнения платежного поручения</b></p>",!
	Write "	<table cellpadding=""2"" cellspacing=""0"" border=""1"" style=""border-collapse: collapse"" bordercolor=""#000000"">",!
	Write "		<tr>",!
	Write "			<td style=""border-bottom: 0px;""><b>Получатель:</b></td>",!
	Write "			<td style=""border-bottom: 0px;"" width=""80"">&nbsp;</td>",!
	Write "			<td style=""border-bottom: 0px;"">&nbsp;</td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td style=""border-top: 0px""><b>"_($G(ppname))_" ИНН "_($G(ppinn))_" КПП "_($G(ppkpp))_"</b></td>",!
	Write "			<td style=""border-top: 0px""><b>Сч</b></td>",!
	Write "			<td style=""border-top: 0px""><b>",!
	Write "			"_($G(pprsch))_"</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td style=""border-bottom: 0px"">",!
	Write "			<b>Банк получателя</b></td>",!
	Write "			<td><b>"
	Write "<span lang=""ru"">"
	Write "БИК"
	Write "</span>"
	Write "</b></td>",!
	Write "			<td style=""border-bottom: 0px""><b>"_($G(ppbik))_"</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td style=""border-top: 0px""><b>"_($G(ppbankname))_" "_($G(ppbankcity))_"</b><br /><br /></td>",!
	Write "			<td valign=""top""><b>"
	Write "<span lang=""ru"">"
	Write "Сч"
	Write "</span>"
	Write "</b></td>",!
	Write "			<td valign=""top"" style=""border-top: 0px""><b>"_($G(ppksch))_"</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td>&nbsp;</td>",!
	Write "			<td>&nbsp;</td>",!
	Write "			<td>&nbsp;</td>",!
	Write "		</tr>",!
	Write "	</table>",!
	Write "	</td>",!
	Write "	</tr></table>",!
	Write "	</p>",!
	Write "	",!
	Write "	<p style=""margin: 40px"" class=""xlsFont"">",!
	Write "		<b>Счет No "_($G(docname))_" ОТ "_($G(docdate))_".</b>",!
	Write "	</p>	",!
	Write !,"	<p class=""xlsFont"">",!
	Write "		<b>Заказчик: "_($G(zpname))_" АДРЕС: "_($G(zpadress))_"<br />",!
	Write "		Плательщик: "_($G(zpname))_" АДРЕС: "_($G(zpadress))_"<br /><br />	",!
	Write "		Договор N_______________от__________________<br /></b>	",!
	Write "	</p>	",!
	Write "		",!
	Write "	<table cellpadding=""2"" style=""border-collapse: collapse"" border=""1"" bordercolor=""#000000"">",!
	Write "		<tr>",!
	Write "			<td><b>N п/п</b></td>",!
	Write "			<td width=""323""><b>Наименование</b></td>",!
	Write "			<td><b>Ед.изм</b></td>",!
	Write "			<td><b>Кол-во</b></td>",!
	Write "			<td><b>Цена</b></td>",!
	Write "			<td><b>Цена с НДС</b></td>",!
	Write "			<td><b>Сумма</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td>&nbsp;</td>",!
	Write "			<td></td>",!
	Write "			<td>&nbsp;</td>",!
	Write "			<td>&nbsp;</td>",!
	Write "			<td><b>("
	Write "<span lang=""ru"">"
	Write "руб"
	Write "</span>"
	Write ")</b></td>",!
	Write "			<td><b>("
	Write "<span lang=""ru"">"
	Write "руб"
	Write "</span>"
	Write ")</b></td>",!
	Write "			<td><b>("
	Write "<span lang=""ru"">"
	Write "руб"
	Write "</span>"
	Write ")</b></td>",!
	Write "		</tr>",!
	Write !," "
	d:$ISOBJECT(doc.Items)
	. s tot=0,totquant=0
	. s i="" f  s i=doc.Items.Next(i) q:i=""  d
	. . s item=doc.Items.GetAt(i)
	. . s:$ISOBJECT(item.Goods) goods=item.Goods.FullName
	. . s quant=item.Quantity
	. . Q:quant=0	//ПРОПУСКАЕМ строки с нулевым количеством
	. . i $I(count)
	. . s itempr=item.Price
	. . if NDSinside="false" d  //если НДС НЕ включён в цену товара
	. . . s price=$J(kurs*itempr,".",2)
	. . . s summabeznds=$J(price*quant,".",2)
	. . . s summaotnds=$J(summabeznds-(summabeznds*antinds),".",2)
	. . . s pricends=summaotnds+summabeznds
	. . if NDSinside="true" d                    //если НДС включён в цену товара
	. . . s price=$J(kurs*itempr*antinds,".",2)
	. . . s summabeznds=$J(price*quant,".",2)
	. . . s summaotnds=$J(summabeznds*nds,".",2)
	. . . s pricends=summaotnds+summabeznds
	. . //s price=$J(kurs*itempr*antinds,".",2)
	. . //s pricends=$J(kurs*itempr,".",2)
	. . //s total=$J(item.Total*kurs,".",2) до 24 04 07
	. . s total=summaotnds+summabeznds
	. . s pricends=$J(total/quant,".",2)
	. . s tot=tot+total
	. . w "<tr>"
	. . w "<td>"_count_"</td>"
	. . w "<td style='mso-height-source:userset'>"_$G(goods)_"</td>"
	. . w "<td></td>"
	. . w "<td>"_quant_"</td>"
	. . w "<td>"_price_"</td>"
	. . w "<td>"_pricends_"</td>"
	. . w "<td>"_total_"</td>" 
	. . w "</tr>"
	s VsegoKOplate=tot
	i NDSinside="false" s ItogoBezNDS=$J(VsegoKOplate*antinds,".",2),ItogoNDS=VsegoKOplate-ItogoBezNDS
	Write !,"		<tr>",!
	Write "			<td colspan=""6"" align=""right""><b>Итого без НДС:</b></td>",!
	Write "			<td><b>"_($G(ItogoBezNDS))_"</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td colspan=""6"" align=""right""><b>Итого НДС:</b></td>",!
	Write "			<td><b>"_($G(ItogoNDS))_"</b></td>",!
	Write "		</tr>",!
	Write "		<tr>",!
	Write "			<td colspan=""6"" align=""right""><b>Всего к оплате:</b></td>",!
	Write "			<td><b>"_($G(VsegoKOplate))_"</b></td>",!
	Write "		</tr>",!
	Write "	</table>",!
	Write "	",!
	Write "	<p>"_(NdsDescription)_"</p>",!
	Write "	<p class=""xlsFont""><b>К оплате: ",!
	Write "			"
	Write "<script src=""./screen/ru_convert_moneyvalue.js"" language=""javascript"">"
	Write "</script>"
	Write !,"			"
	Write "<script language=""javascript"">"
	Write !,"				document.write(""<b>""+ru_convert_moneyvalue("""_(+$G(VsegoKOplate))_""")+""</b>"");",!
	Write "			"
	Write "</script>"
	Write "	",!
	Write "	",!
	if +$G(ItogoNDS)
	{
	w "<br>В том числе НДС: "
	w "<script language=""javascript"">",!
	w "document.write('<b>'+ru_convert_moneyvalue('"_ItogoNDS_"')+'</b>');",!
	w "</"_"script>",!
	}
	Write !,"	</b></p>",!
	Write "	<p class=""xlsFont"" style=""margin: 40px;""><b>",!
	Write "	Руководитель предприятия_____________________<br /><br />	",!
	Write "	Главный бухгалтер____________________________",!
	Write "	</b>",!
	Write "	</p>	",!
	Write "	"
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !
	s mn(1)="января",mn(2)="февраля",mn(3)="марта",mn(4)="апреля",mn(5)="мая",mn(6)="июня",mn(7)="июля",mn(8)="августа",mn(9)="сентября",mn(10)="октября",mn(11)="ноября",mn(12)="декабря"
	s kontr2=%request.Get("kontr2")
	s kontr=%request.Get("kontr")
	s docid=%request.Get("id")
	s DocDate=%request.Get("DocDate")
	s docname="Платежное поручение"
	s NDSinside=%request.Get("NDSinside")
	s CalculateInRubles=%request.Get("CalculateInRubles")
	s doc=##class(Docs.Rash).%OpenId(docid)
	d:$ISOBJECT(doc)
	. s docname=doc.Name_"-П"
	. s:doc.Dat'="" docdate=$ZD(doc.Dat,4)
	. s:DocDate'="" docdate=DocDate
	. q:$G(docdate)=""
	. s docdate=$P(docdate,"/",1)_" "_mn(+$P(docdate,"/",2))_" "_$P(docdate,"/",3)
	. s kurs=doc.kurs
	. if '+kurs s kurs=doc.RubSumma/doc.Summa
	// Поставщик и Получатель
	s k=##class(Common.Kontragent).%OpenId(kontr)
	d:$ISOBJECT(k)
	. s ppname=k.Name
	. s ppadress=k.Address
	. s bank=k.bank
	. d:$ISOBJECT(bank)
	. . s ppbankname=bank.pbank
	. . s ppbankcity=bank.city
	. . s ppkpp=bank.kpp
	. . s ppinn=bank.inn
	. . s ppbik=bank.bik
	. . s pprsch=bank.rsch
	. . s ppksch=bank.ksch
	. . s ppcode=bank.code
	. . s ppokpo=bank.okpo
	// Заказчик и плательщик
	s k=##class(Common.Kontragent).%OpenId(kontr2)
	d:$ISOBJECT(k)
	. s zpname=k.Name
	. s zpadress=k.Address
	. s bank=k.bank
	. d:$ISOBJECT(bank)
	. . s zpbankname=bank.pbank
	. . s zpbankcity=bank.city
	. . s zpkpp=bank.kpp
	. . s zpinn=bank.inn
	. . s zpbik=bank.bik
	. . s zprsch=bank.rsch
	. . s zpksch=bank.ksch
	. . s zpcode=bank.code
	. . s zpokpo=bank.okpo
	s waste=##class(Goods.GoodsAction).kurs(.other)
	s:'+$G(kurs) kurs=waste
	s kurs2=$J(kurs,".",2)
	//если указали не пересчитывать в рубли, то курс - единица, то есть оставляем те цифры, которые в документе
	if CalculateInRubles="false" s kurs=1
	s nds=+$G(other("nds"))/100
	s nsp=+$G(other("nsp"))/100
	s antinds=1/(1+nds)
	i NDSinside="true" s NdsDescription="НДС включен в цену товара"
	i NDSinside="false" s NdsDescription="НДС не включен в цену товара"
	Write !,!
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"		"
	Write "<meta http-equiv=""Content-Type"" content=""text/html; charset=windows-1251"">"
	Write !,"		"
	Write "<meta http-equiv=""Content-Language"" content=""ru"">"
	Write !,"		"
	Write "<style>"
	Write !,"			.xlsFont { font-family: Arial; font-size: 9pt }",!
	Write "			td { font-family: Arial; font-size: 9pt }",!
	Write "		"
	Write "</style>"
	Write !,"	<title>Счёт "_($G(docname))_"</title>",!
	Write "	"
	Write "</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !,!,"	"
	Do ..OnPageHEAD()
	Write !,"	",!
	Write "	"
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
 if %request.Get("word")="on"
 {
  set %response.ContentType = "application/msword"
  do %response.SetHeader("Content-Disposition","attachment;word.doc")
  set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
 }
  q 1
 
]]></Implementation>
</Method>

<Parameter name="CHARSET">
<Default>windows-1251</Default>
</Parameter>

<Parameter name="CONTENTTYPE">
<Default>text/html</Default>
</Parameter>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\screen\chet.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/screen/chet.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>62164,66073</Default>
</Parameter>
</Class>
</Export>

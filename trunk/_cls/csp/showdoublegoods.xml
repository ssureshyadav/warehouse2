<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.showdoublegoods">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>61760,44094.072353</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body>"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,!,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.location.href='tuneup.csp'"" TITLE=""""><center>Назад</center></span>"
	Write "<br>",!
	//s GoodsId=19542
	s glob=$NA(^mtempArt($I))  
	k @glob
	&sql(declare hu cursor for select Goods,Goods->FullName,count(Goods) into GoodsId,GoodsName,GoodsCount from Goods.GoodsGroup where Goods->aspektid is null group by Goods)
	&sql(open hu)
	f  &sql(fetch hu) q:SQLCODE  d
	. q:GoodsCount=1
	. s @glob@(GoodsId)=GoodsCount
	. s @glob@(GoodsId,"GoodsName")=GoodsName
	&sql(close hu)
	s i="" f  s i=$O(@glob@(i)) q:i=""  d
	. s OldGroup=""
	. i $i(count)
	. w "<table><tr><td>"_count_"<td><h4>"_@glob@(i,"GoodsName")_"</h4></tr><table>"
	. &sql(declare rt cursor for select Groups,Groups->Name,Common.SqlProcs_GroupFullName(Groups) into Groups,GroupsName,GroupFullName from Goods.GoodsGroup where Goods=:i)
	. &sql(open rt)
	. f  &sql(fetch rt) q:SQLCODE  d
	. . q:Groups=OldGroup
	. . s UniqueID=i_"l"_Groups
	. . w "<li id=""li"_UniqueID_"""> <img src=""images/del+.gif"" onclick=""RemoveFromGroup('"_Groups_"','"_i_"','"_UniqueID_"')"" onmouseover=""del"_UniqueID_".src='images/Ondel+.gif'"" onmouseout=""del"_UniqueID_".src='images/del+.gif'""  id=""del"_UniqueID_""" name=""del"_UniqueID_""" alt=""Убрать из группы""> "_GroupFullName,!
	. . s OldGroup=Groups
	. &sql(close rt)
	. w "<hr width=80%>"
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,!,"<!-- Put your page Title here -->"
	Write !,"<title>	Товары дублирующиеся в группах </title>",!
	Write "<script language=""JScript"">"
	Write !,"function RemoveFromGroup(Groups,Goods,UniqueID){",!
	Write "	if(!window.confirm(""Удалить товар из группы?""))return",!
	Write "	var ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.RemoveFromGroup:csp.showdoublegoods"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',Goods,Groups)",!
	Write "	if(isNaN(ok)){alert(ok);}",!
	Write "	else{document.getElementById(""li""+UniqueID).style.display=""none"";}",!
	Write "}",!
	Write "</script>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,(..HyperEventHead())
	Write !,!,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !,!
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\ShowDoubleGoods.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/ShowDoubleGoods.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>60817,78998</Default>
</Parameter>
</Class>
</Export>

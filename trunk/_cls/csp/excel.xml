<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.excel">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62194,38432.58511</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body>"
	Write !
	Write !
	s xmlobj=%request.Content
	w "<table border=1>"
	s i=0
	s sess=%request.Get("sessionid")
	s act=%request.Get("act")
	s %session=%session.GetSession(sess)
	s usr=$G(%session.Data("user"),"undef")
	s glob=$NA(^mtempReport(usr))
	i act="put" d
	. s:$ISOBJECT(xmlobj) ok=##class(Docs.Action).parsexml(xmlobj,1,"",.t,glob,1)
	i act="get" d
	. s i="" f  s i=$O(@glob@("head",i)) q:i=""  d
	. . s heads(@glob@("head",i,"number"))=i
	. w "<tr>"
	. s i="" f  s i=$O(heads(i)) q:i=""  d
	. . w "<td bgcolor='#dedede'>"
	. . w $G(@glob@("head",heads(i)))
	. . w "</td>"
	. w "</tr>"
	. s y="" f  s y=$O(@glob@("body",y)) q:y=""  d
	. . w "<tr>"
	. . s i="" f  s i=$O(heads(i)) q:i=""  d
	. . . w "<td>"
	. . . w $TR($G(@glob@("body",y,heads(i))),".",",")
	. . . w "</td>"
	. . w "</tr>"
	w "</table>"
	Write !,"</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !,!,"<!--",!
	Write "такой метод должен поприсутствовать",!
	Write "ClassMethod OnPreHTTP() As %Boolean",!
	Write "{",!
	Write "            set %response.ContentType = ""application/x-msexcel""",!
	Write "            do %response.SetHeader(""Content-Disposition"",""attachment;excel.xls"")",!
	Write "            set %response.Expires = ""Thu, 01 Apr 2003 00:00:00 GMT""",!
	Write "            quit 1",!
	Write "}",!
	Write "<csp:class super=""csp.excelfile""> ",!
	Write "-->"
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<meta http-equiv=Content-Type content=""text/html; charset=windows-1251"">"
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
  set %response.ContentType = "application/x-msexcel"
  do %response.SetHeader("Content-Disposition","attachment;excel.xls")
  set %response.Expires = "Thu, 01 Apr 2003 00:00:00 GMT"
  Quit 1
 
]]></Implementation>
</Method>

<Parameter name="CHARSET">
<Default>windows-1251</Default>
</Parameter>

<Parameter name="CONTENTTYPE">
<Default>text/html</Default>
</Parameter>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\excel.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/excel.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61772,83630</Default>
</Parameter>
</Class>
</Export>

<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.users">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62193,54619.54448</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load()"">"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,"<table width=80%><tr><td>",!
	Write "<form id=""my"" name=""my"">"
	Write !,..InsertHiddenFields(""),!
	Write !,"Введите Ф.И.О:</td><td>",!
	Write "<input type=""text"" name=""family"" width=100 value="""_(zfamil)_""">"
	Write "</td></tr><tr><td>",!
	Write "Введите Login:</td><td>",!
	Write "<input type=""text"" name=""login"" value="""_(zlogin)_""">"
	Write "<br></td></tr><tr><td>",!
	Write "Введите пароль:</td><td>",!
	Write "<input type=""password"" name=""password"" value="""_(zpass)_""">"
	Write "</td></tr><tr><td>",!
	Write "Введите подтверждение пароля:</td><td>",!
	Write "<input type=""password"" name=""password1"" value="""_(zpass1)_""">"
	Write "</td></tr><tr><td>&nbsp</td></tr>",!
	Write "<tr><td>Роль:</td>",!
	Write "<td>",!
	Write "</form>"
	Write !,"<select name=""roles"" ID=""roles"">"
	Write !,"</select>"
	Write !,"</td></tr><tr><td>&nbsp</td></tr><tr><td>",!
	Write "<input type=""button"" value=""Сохранить"" onclick=""Saves()"">"
	Write "</td></tr>",!
	Write !,"</table>",!
	Write "<IE:DOWNLOAD id=""downloader"" STYLE=""behavior:url(#default#download)"" />",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !,!
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write "<script language=""JScript"">"
	Write !,"function Saves(){",!
	Write " famil=document.my.family.value;",!
	Write " log=document.my.login.value;",!
	Write " pas=document.my.password.value;",!
	Write " pas1=document.my.password1.value;",!
	Write "rol=roles.options[roles.selectedIndex].text ;",!
	Write "if (famil==""""){alert(""ведите Ф.И.О""); document.my.family.focus(); return false};",!
	Write "if (log==""""){alert(""ведите Login""); document.my.login.focus();return false;};",!
	Write "if (pas==""""){alert(""ведите Пароль""); document.my.password.focus(); return false};",!
	Write "if (pas1==""""){alert(""ведите подтверждение пароля""); return false};",!
	Write "if (pas!=pas1){alert(""пароли не совпадают""); return false};",!
	Write "if(!window.confirm(""Создать ""+rol+"" ""+famil))return false; ",!
	Write ($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Users.Dates.SaveUser:csp.users"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',famil,log,pas,rol);",!
	Write "window.returnValue=1;",!
	Write "window.close();",!
	Write "}",!
	Write "function load(){",!
	Write "downloader.startDownload('Data.csp?class=Users.NameRoles&fields=ID,Name', putCatalogue);",!
	Write "}",!
	Write !,"function putCatalogue(text){",!
	Write "addOptions(text,""roles"");",!
	Write "}",!
	Write "</script>"
	Write !,"<title>	Пользователь </title>",!
	Write !,(..HyperEventHead())
	Write "</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !,"<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""Jscript"" src=""common.js"">"
	Write "</script>"
	Write !
	s family=$G(%request.Data("family",1))
	s login=$G(%request.Data("login",1)) 
	s password=$G(%request.Data("password",1))
	s zfamil=%request.Get("family") 
	s zlogin=%request.Get("login") 
	s zpass=%request.Get("password") 
	s zpass1=%request.Get("password1") 
	s role=%request.Get("role") 
	Write !
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
  s login=$G(%session.Data("user"))
  i '+login s %response.ServerSideRedirect="norights.csp" 
  q 1
 
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\Users.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/Users.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61711,69776</Default>
</Parameter>
</Class>
</Export>

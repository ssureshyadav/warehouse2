<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.makescet">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62194,42552.098583</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load();"" onkeypress=""ManageWindow();"">"
	Write !,"<b><center>Формирование "_($G(formirovanie))_"</center></b>",!
	Write "<table>",!
	Write "<tr><td>Дата документа</td><td>"
	Write "<div onclick=""OpenCalendar(this)"" name=""Dat"" id=""Dat"" style=""border:solid 1 grey;width:150px;cursor:hand"">"
	Write "</div>"
	Write "</td></tr>",!
	Write "<tr><td>Плательщик</td><td><SKLAD2:table id=""PropTable1"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp1Complite()""/></td></tr>",!
	Write "<tr><td>Получатель платежа</td><td><SKLAD2:table id=""PropTable2"" width=260 ClassName=""Docs.Super"" onLoadComplete=""LoadProp2Complite()""/></td></tr>",!
	Write !,"<tr>",!
	Write "	<td>К платежно расчетному документу №</td><td> "
	Write "<input type=""text"" name=""cv1"" size=""20"">"
	Write "</td>",!
	Write "</tr>",!
	Write !,"<tr>",!
	Write "	<td>НДС включён в цену товара</td><td> "
	Write "<input type=""checkbox"" name=""NDSinside"" CHECKED style=""width:15px;border:none"">"
	Write "</td>",!
	Write "</tr>",!
	Write "<tr>",!
	Write "	<td>Пересчитывать в рубли</td><td> "
	Write "<input type=""checkbox"" name=""CalculateInRubles"" CHECKED style=""width:15px;border:none"">"
	Write "</td>",!
	Write "</tr>",!
	Write !,"<!-- <tr><td>Рассчитывать рублёвую сумму на дату документа</td><td> <input type=""checkbox"" name=""KursFromDoc"" id=""KursFromDoc"" CHECKED ></td></tr> -->"
	Write !,"</table>",!
	Write "<center><br>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun();"" TITLE=""""><center>Да</center></span>"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""window.close()"" TITLE=""""><center>Отмена</center></span>"
	Write "</center>",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s docid=%request.Get("docid")
	s class=%request.Get("class")
	// Получатель платежа
	s SelfKontragentID=%request.GetCookie("SelfKontragentID")
	d:SelfKontragentID'=""
	. s SelfKontragentObj=##class(Common.Kontragent).%OpenId(SelfKontragentID)
	. q:'$ISOBJECT(SelfKontragentObj)
	. s SelfKontragentName=$ZCVT(SelfKontragentObj.Name,"O","JS")
	s formirovanie=$S(class="Docs.Chet":"счета на оплату",class="factura":"счет-фактуры",1:"")
	s DocObject=##class(Docs.Super).%OpenId(docid)
	d:$ISOBJECT(DocObject)
	. s DocDate=$ZD(DocObject.Dat,4)
	. s KontrID=DocObject.Kontr.%Id()
	. s KontrName=$ZCVT(DocObject.Kontr.Name,"O","JS")
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<title>"_($G(%session.Data("systemname")))_"</title>",!
	Write "<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""Jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<script language=""JScript"">"
	Write !,"var sessionid="""_(%session.SessionId)_""";",!
	Write "var docid="""_($G(docid))_""";",!
	Write "var clas="""_($G(class))_""";",!
	Write "var DocDate="""_($G(DocDate))_""";",!
	Write "var KontrID="""_($G(KontrID))_""";",!
	Write "var KontrName="""_($G(KontrName))_""";",!
	Write "var SelfKontragentID="""_($G(SelfKontragentID))_""";",!
	Write "var SelfKontragentName="""_($G(SelfKontragentName))_""";",!
	Write "window.dialogHeight=""275px"";",!
	Write "window.dialogWidth=""600px"";",!
	Write !,"function startFun(){",!
	Write "var k1=PropTable1.item(""Kontr"")",!
	Write "var k2=PropTable2.item(""Kontr"")",!
	Write "SetCookie(""SelfKontragentID"",k2);",!
	Write "if(k1==""""){alert(""Не заполнено поле ПЛАТЕЛЬЩИК"");return}",!
	Write "if(k2==""""){alert(""Не заполнено поле ПОЛУЧАТЕЛЬ ПЛАТЕЖА"");return}",!
	Write "window.open(""print.csp?id=""+docid+""&class=""+clas+""&kontr=""+k2+""&kontr2=""+k1+""&cv1=""+cv1.value+""&NDSinside=""+NDSinside.checked+""&DocDate=""+Dat.innerText+""&sessionid=""+sessionid+""&CalculateInRubles=""+CalculateInRubles.checked);",!
	Write "}",!
	Write !,"function load(){",!
	Write "Dat.innerText=DocDate;",!
	Write "//SelfKontragentID=ReturnSpace(GetCookie(""SelfKontragentID""));",!
	Write "PropTable1.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "PropTable2.DownLoadPairs("""","""",""Dat,Tim,Summa,Name,DocumentClass,Stat,Source,User1,Depot,Comment,CloseDate,CloseTime,CloseUser"");",!
	Write "}",!
	Write !,"function OpenCalendar(InputObj){",!
	Write "var newDate=window.showModalDialog(""calendar.csp"","""",""center:yes;status:no;dialogHeight:350px;dialogWidth:310px;resizable:yes;"");",!
	Write "if(ReturnSpace(newDate)!=""""){InputObj.innerText=newDate;}",!
	Write "}",!
	Write !,"function LoadProp1Complite(){",!
	Write "	PropTable1.setCellValue(""Kontr"",KontrName,KontrID);",!
	Write "}",!
	Write !,"function LoadProp2Complite(){",!
	Write "	if(SelfKontragentID!="""")",!
	Write "	{",!
	Write "	PropTable2.setCellValue(""Kontr"",SelfKontragentName,SelfKontragentID);",!
	Write "	}",!
	Write "}",!
	Write !,"</script>"
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLAD2>"
	Write !,"<IMPORT NAMESPACE=""SKLAD2"" IMPLEMENTATION=""htc/table.htc"" >",!
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\makescet.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/makescet.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>62164,65870</Default>
</Parameter>
</Class>
</Export>

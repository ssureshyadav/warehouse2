<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.importfile">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>60957,42899.864783</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onclick=""menu1.style.display='none'"">"
	Write !,($G(ok)),!
	Write "<form enctype=""multipart/form-data"" method=""post"">"
	Write !,..InsertHiddenFields(""),!
	Write !,"Импортировать и компилировать xml<br>",!
	Write "<input name=""oFile1"" id=""oFile1"" size=30 type=file>"
	Write !,"<input type=""submit"" value=""ок"">"
	Write !,"</form>"
	Write !,!,"</div>",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !
	//<csp:CLASS SUPER="%CSP.Page,csp.super">
	s goodsid=%request.Get("GoodsId")
	//s f=..cspfile()
	s joiu=$TR($G(f),"\","?")
	d:%request.ContentType="multipart/form-data"
	. s obj=%request.MimeData("oFile1",1)
	. q:'$ISOBJECT(obj)
	. //s f=$P(f,"\",1,$L(f,"\")-1)_"\GoodsImages\"
	. s f=$P($ZU(86),"\",1,2)_"\CSP\sklad2\"
	. s filename=goodsid_$P(obj.FileName,"\",$L(obj.FileName,"\"))
	. s filepath=f_filename
	. s file=##class(%File).%New(filepath)
	. Do file.Open("WSN")
	. d file.CopyFrom(obj)
	. s ok=file.%Save()
	. i '+ok d
	. . Do DecomposeStatus^%apiOBJ(ok,.Err)
	. . s ^Errors($H,"err")=Err(Err)
	. e  d
	. . s ok=$SYSTEM.OBJ.Load(filepath,.q1,.q2,.q3)
	. . i '+ok d
	. . . Do DecomposeStatus^%apiOBJ(ok,.Err)
	. . . s ^Errors($H,"err")=Err(Err)
	. . s ok1=$SYSTEM.OBJ.CompileList(.q3)
	. . i '+ok1 d
	. . . Do DecomposeStatus^%apiOBJ(ok1,.Err)
	. . . s ^Errors($H,"err")=Err(Err)
	. . i ok&ok1 s ok="Всё ОК"
	. . e  s ok="Какие то ошибки"
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<title>"_($G(%session.Data("systemname")))_"</title>",!
	Write "<script language=""Jscript"">"
	Write !,!,"</script>"
	Write !,"<STYLE>"
	Write !,".menuItem {font-family:sans-serif;font-size:10pt;width:100;padding-left:20;",!
	Write "   background-Color:menu;color:black}",!
	Write ".highlightItem {font-family:sans-serif;font-size:10pt;width:100;padding-left:20;",!
	Write "   background-Color:highlight;color:white}",!
	Write "</STYLE>"
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html>"
	Write !
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cache52\csp\sklad2\ImportFile.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/ImportFile.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>60957,30263</Default>
</Parameter>
</Class>
</Export>

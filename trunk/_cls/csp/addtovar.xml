<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.addtovar">
<ClassType/>
<Hidden>1</Hidden>
<Import>User</Import>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeCreated>62196,37574.924326</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Do ..OnPageCSPROOT()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageBODY">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<body onload=""load();"" onkeypress=""ManageWindow2();"">"
	Write !,(##class(%CSP.Response).HyperEventBody())
	Write !,"<center><h3>Группа "
	Write "<span id=""GrupName"">"
	Write "</span>"
	Write "</h3></center>",!
	Write "<table cellpadding=0 cellspacing=0 width=100% border=0><tr>",!
	Write "<td width=50% align=center valign=top>",!
	Write "<fieldset style=""width:250px""><legend>Основные свойства</legend>",!
	Write "<SKLAD2:table id=""PropTable"" width=350 height=400 Silent=""Price""/>",!
	Write "</fieldset>",!
	Write "</td>",!
	Write "<td width=50% align=certer valign=top>",!
	Write "<fieldset style=""width:215px""><legend>Дополнительные свойства</legend>",!
	Write "<SKLADz:treeview id=""trViewProp"" width=200 height=400 ShowImages=0 ImagesPath="""_(%session.Data("ImagesPath"))_""" border=0 />",!
	Write "</fieldset>",!
	Write "</td></tr>",!
	Write "<tr><td colspan=2 align=center style=""height:28px;"" valign=middle>"
	Write "<div id=""NodeDatastrLayer"" style=""display:none"">"
	Write "<span id=""NodeDatastrText"">"
	Write "</span>"
	Write "&nbsp;"
	Write "<input type=""text"" id=""NodeDatastr"" onkeypress=""ManageTextBox(this.id);"">"
	Write !,!,"<img src=""images/ok.gif"" onmouseover=""okBut.src='images/Onok.gif'"" onmouseout=""okBut.src='images/ok.gif'""  id=""okBut"" name=""okBut"" alt="""" onclick=""okTextBox('NodeDatastr')"" style="""">"
	Write !,!,"<img src=""images/del.gif"" onmouseover=""cancelBut.src='images/Ondel.gif'"" onmouseout=""cancelBut.src='images/del.gif'""  id=""cancelBut"" name=""cancelBut"" alt="""" onclick=""cancelTextBox('NodeDatastr')"" style="""">"
	Write !,"</div>"
	Write "<img src=""images/brace.gif"" width=1 height=19>"
	Write "</td></tr>",!
	Write "<tr><td colspan=2 align=center>",!
	Write "	"
	If '(Access9func=1) Goto %csp00001 ;{
	Write !,"		"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""startFun()"" TITLE=""""><center>Да</center></span>"
	Write !,"	"
%csp00001	;}
	Write "	",!
	Write "	&nbsp;&nbsp;&nbsp;"
	Write !,"<span class=ButtonDiv ID="""" style=""cursor:hand;"" onmouseover=""this.className='ButtonDivHover'"" onmouseout=""this.className='ButtonDiv'"" onclick=""windowclose()"" TITLE=""""><center>Отмена</center></span>"
	Write "</td></tr>",!
	Write "</table>",!
	Write "</body>"
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write !
	Do ..OnPageHTML()
]]></Implementation>
</Method>

<Method name="OnPageHEAD">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<head>"
	Write !,"<title>"_($G(%session.Data("systemname")))_"</title>",!
	Write "<link href=""style.css"" type=text/css rel=stylesheet>"
	Write !,"<script language=""Jscript"" src=""common.js"">"
	Write "</script>"
	Write !,"<script language=""JScript"">"
	Write !,"var NodeData = new Array();",!
	Write !,"Arguments=window.dialogArguments.split(InnerSplitter);",!
	Write "if(Arguments[1]==null){alert(""Не указана группа товара!"");}",!
	Write "Catalogue=ReturnSpace(Arguments[0]);",!
	Write "GroupId=  ReturnSpace(Arguments[1]);",!
	Write "GroupCode=ReturnSpace(Arguments[2]);",!
	Write "GoodsId=  ReturnSpace(Arguments[3]);",!
	Write "GroupName=ReturnSpace(Arguments[4]);",!
	Write "//Классификатор+InnerSplitter+IDГруппы+InnerSplitter+КодГруппы+InnerSplitter+IDТовара",!
	Write !,"function startFun(){",!
	Write "if(GoodsId!=""""){question=""Внести изменения?""}",!
	Write "else{question=""Создать товар?""}",!
	Write "if(!window.confirm(question))return false;",!
	Write "NamesStr=PropTable.names;",!
	Write "RowDataStr=PropTable.ColumnData(1);",!
	Write "NodesStr=trViewProp.IDsStr;",!
	Write "NodesDataStr=trViewProp.ValuesStr;",!
	Write "TypesStr=PropTable.ColumnTypes(1);",!
	Write "ok="_($case(%session.BrokerImplementation,1:"cspRunServerMethod",2:"cspHttpServerMethod",:"cspSelectServerMethod"))_"('"_(..Encrypt($listbuild("Goods.GoodsAction.SaveGoods:csp.addtovar"))_$select(%session.UseSessionCookie'=2:"&CSPCHD="_%session.CSPSessionCookie,1:""))_"',GroupId,NamesStr,RowDataStr,TypesStr,NodesStr,NodesDataStr,GoodsId)",!
	Write "if(ok==1){returnValue=1;window.close();}",!
	Write "else{alert(ok);}",!
	Write "}",!
	Write !,"function LoadList(){",!
	Write "PropTable.DownLoadPairs('',GoodsId,""FullName,ModelNumber"","""",""Tovar"");",!
	Write "LoadPropTree2(""trViewProp"",GoodsId,GroupCode,Catalogue);",!
	Write "}",!
	Write "function load(){",!
	Write "LoadList()",!
	Write "trViewProp.onClick=""Click()""",!
	Write "GrupName.innerText=GroupName;",!
	Write "}",!
	Write !,"function Click(){",!
	Write "NodeDatastrLayer.style.display=""inline"";",!
	Write "NodeDatastrText.innerText=trViewProp.NodeCaption;",!
	Write "NodeDatastr.value=trViewProp.NodeValue;",!
	Write "NodeDatastr.focus();",!
	Write "}",!
	Write !,"function ConvertArray(Arr){",!
	Write "res=""""",!
	Write "for (z = 0; z < Arr.length; z++){",!
	Write "  res=res+Arr[z]+""~"";",!
	Write "}",!
	Write "return res;",!
	Write "}",!
	Write !,"function ManageTextBox(element){",!
	Write "if(window.event.keyCode==13){okTextBox(element);}",!
	Write "if(window.event.keyCode==27){cancelTextBox(element);}",!
	Write "}",!
	Write !,"function okTextBox(element){",!
	Write "	document.getElementById(element+""Layer"").style.display=""none"";",!
	Write "	trViewProp.NodeValue=ReturnSpace(document.getElementById(element).value);",!
	Write "}",!
	Write "function cancelTextBox(element){",!
	Write "	document.getElementById(element+""Layer"").style.display=""none"";",!
	Write "}",!
	Write "function ManageWindow2(element){",!
	Write "if(event.srcElement.tagName==""INPUT"")return false;",!
	Write "if(window.event.keyCode==13)",!
	Write "	{",!
	Write "	"_($G(Func9Refuse)),!
	Write "	startFun();",!
	Write "	}",!
	Write "if(window.event.keyCode==27)windowclose();",!
	Write "}",!
	Write "</script>"
	Write !,(..HyperEventHead())
	Write !,"</head>"
]]></Implementation>
</Method>

<Method name="OnPageHTML">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	Write "<html XMLNS:SKLADz XMLNS:SKLAD2>"
	Write !,"<IMPORT NAMESPACE=""SKLADz"" IMPLEMENTATION=""htc/treeview.htc"">",!
	Write "<IMPORT NAMESPACE=""SKLAD2"" IMPLEMENTATION=""htc/table.htc"">",!
	Do ..OnPageHEAD()
	Write !
	Do ..OnPageBODY()
	Write !,"</html>"
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Language>cache</Language>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
  s login=$G(%session.Data("user"))
  i '+login s %response.ServerSideRedirect="norights.csp" 
  i '##class(Common.Rights).getrights(login,1) s %response.ServerSideRedirect="norights.csp" 
  s Access9func=##class(Common.Rights).getrights(login,9)
  if 'Access9func s Func9Refuse="return;"
  q 1
 
]]></Implementation>
</Method>

<Parameter name="CSPFILE">
<Default>c:\cachesys\csp\sklad2\AddTovar.csp</Default>
</Parameter>

<Parameter name="CSPURL">
<Default>/csp/sklad2/AddTovar.csp</Default>
</Parameter>

<Parameter name="FileTimestamp">
<Default>61205,47791</Default>
</Parameter>
</Class>
</Export>

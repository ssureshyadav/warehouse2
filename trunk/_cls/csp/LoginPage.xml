<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="20">
<Class name="csp.LoginPage">
<Description>
Страница для тестового входа в систему</Description>
<Super>csp.Design</Super>
<TimeCreated>62345,67445.025845</TimeCreated>

<Method name="ValidateUser">
<ClassMethod>1</ClassMethod>
<FormalSpec>user,password,depot</FormalSpec>
<Implementation><![CDATA[
  s login=##class(Common.Rights).login(user,password,depot,"c:",$ZU(67,15,$JOB))
  w "alert(",..QuoteJS(login),");window.location='csp.EmpLight3.cls'"
]]></Implementation>
</Method>

<Method name="wCss">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	d ##super()
	&html<<style type="text/css">
	#tblLogin {border-collapse:collapse; border:solid 1px #333;margin:10% auto;}
	#tblLogin td {padding:3px;}
	label {color:#555;}
   </style>>
	Q ""
]]></Implementation>
</Method>

<Method name="wBody">
<Description>
write содержимое страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
 #define g(%name) $g(%request.Data(%name,1))
 s user=$$$g("user"), password=$$$g("password"), depot=$$$g("depot")
 s sysDrive=$$$g("SystemDrive") s:sysDrive="" sysDrive="c:"
 s onload="" ;функция обработчик при загрузке 
 s login="" ;результат проверки пользователя 
 s REMOTEADDR=%request.GetCgiEnv("REMOTE_ADDR") ;c какого ip
 
 #;s username=$g(%session.Data("user")) ;берем из сессии
 
 &html<
 <form name="forma" id="forma">
 	<input type="hidden" id="SystemDrive" name="SystemDrive">
 		<table id="tblLogin"><caption>Регистрация в системе #($USERNAME)# #($ZU(67,15,$JOB))#</caption><tr>
		<td><label for="depot">Склад:</label></td>
		<td><select id="depot" name="depot" style="width:100%;">>
 			d ##class(csp.StoreSelect).wDepotOptions(depot)
 	&html<</select>
		</td>
	</tr>
	<tr>
		<td><label for="user">Имя пользователя:</label></td>
		<td><input type="text" id="user" name="user" value=#($G(%session.Data("login")))#></td>
	</tr>
	<tr>
		<td><label for="password">Пароль:</label></td>
		<td><input type="password" id="password" name="password" value=#($G(%session.Data("passworders")))#></td>
	</tr>
	<tr>
		<td></td><td><button id="btnLogin" onclick="#call(..ValidateUser(forma.user.value,forma.password.value,forma.depot.value))#">Войти</button></td>
	</tr>
	</table>
</form>
<div id="MustExist" name="MustExist" style="display:none">>
 #;Здесь лежат названия файлов которые должны быть на локальном диске
 s i="" for { s i=$O(^MustExist(i)) q:i=""  w i,"/" }
 &html<</div>>
 if login=7 {
	&html<<input type="text" id="edtText" style="width:300px">
	<input type="button" value="test" onclick="alert(eval(edtText.value));">>
 }

 &html<<script type="text/javascript" language="jscript"></script>
 	<script type="text/javascript" src="common.js"></script>>
	
	Q ""
]]></Implementation>
</Method>

<Method name="wTitle">
<Description>
write заголовок страницы</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&args:%String=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	w !,"Система складского учёта"
	Q ""
]]></Implementation>
</Method>
</Class>
</Export>
